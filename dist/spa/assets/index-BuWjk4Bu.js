var LW=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var Y9e=LW((uTe,Gz)=>{function PR(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in n)){const o=Object.getOwnPropertyDescriptor(r,s);o&&Object.defineProperty(n,s,o.get?o:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();function ay(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function jW(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function r(){var s=!1;try{s=this instanceof r}catch{}return s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var s=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:function(){return n[r]}})}),t}var M3={exports:{}},Bm={},L3={exports:{}},Ln={};var EE;function BW(){if(EE)return Ln;EE=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),i=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),d=Symbol.iterator;function f(V){return V===null||typeof V!="object"?null:(V=d&&V[d]||V["@@iterator"],typeof V=="function"?V:null)}var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,v={};function y(V,K,J){this.props=V,this.context=K,this.refs=v,this.updater=J||p}y.prototype.isReactComponent={},y.prototype.setState=function(V,K){if(typeof V!="object"&&typeof V!="function"&&V!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,V,K,"setState")},y.prototype.forceUpdate=function(V){this.updater.enqueueForceUpdate(this,V,"forceUpdate")};function b(){}b.prototype=y.prototype;function w(V,K,J){this.props=V,this.context=K,this.refs=v,this.updater=J||p}var S=w.prototype=new b;S.constructor=w,x(S,y.prototype),S.isPureReactComponent=!0;var k=Array.isArray,N=Object.prototype.hasOwnProperty,I={current:null},T={key:!0,ref:!0,__self:!0,__source:!0};function F(V,K,J){var oe,Z={},de=null,pe=null;if(K!=null)for(oe in K.ref!==void 0&&(pe=K.ref),K.key!==void 0&&(de=""+K.key),K)N.call(K,oe)&&!T.hasOwnProperty(oe)&&(Z[oe]=K[oe]);var Ce=arguments.length-2;if(Ce===1)Z.children=J;else if(1<Ce){for(var Ae=Array(Ce),ze=0;ze<Ce;ze++)Ae[ze]=arguments[ze+2];Z.children=Ae}if(V&&V.defaultProps)for(oe in Ce=V.defaultProps,Ce)Z[oe]===void 0&&(Z[oe]=Ce[oe]);return{$$typeof:n,type:V,key:de,ref:pe,props:Z,_owner:I.current}}function R(V,K){return{$$typeof:n,type:V.type,key:K,ref:V.ref,props:V.props,_owner:V._owner}}function D(V){return typeof V=="object"&&V!==null&&V.$$typeof===n}function A(V){var K={"=":"=0",":":"=2"};return"$"+V.replace(/[=:]/g,function(J){return K[J]})}var P=/\/+/g;function B(V,K){return typeof V=="object"&&V!==null&&V.key!=null?A(""+V.key):K.toString(36)}function L(V,K,J,oe,Z){var de=typeof V;(de==="undefined"||de==="boolean")&&(V=null);var pe=!1;if(V===null)pe=!0;else switch(de){case"string":case"number":pe=!0;break;case"object":switch(V.$$typeof){case n:case e:pe=!0}}if(pe)return pe=V,Z=Z(pe),V=oe===""?"."+B(pe,0):oe,k(Z)?(J="",V!=null&&(J=V.replace(P,"$&/")+"/"),L(Z,K,J,"",function(ze){return ze})):Z!=null&&(D(Z)&&(Z=R(Z,J+(!Z.key||pe&&pe.key===Z.key?"":(""+Z.key).replace(P,"$&/")+"/")+V)),K.push(Z)),1;if(pe=0,oe=oe===""?".":oe+":",k(V))for(var Ce=0;Ce<V.length;Ce++){de=V[Ce];var Ae=oe+B(de,Ce);pe+=L(de,K,J,Ae,Z)}else if(Ae=f(V),typeof Ae=="function")for(V=Ae.call(V),Ce=0;!(de=V.next()).done;)de=de.value,Ae=oe+B(de,Ce++),pe+=L(de,K,J,Ae,Z);else if(de==="object")throw K=String(V),Error("Objects are not valid as a React child (found: "+(K==="[object Object]"?"object with keys {"+Object.keys(V).join(", ")+"}":K)+"). If you meant to render a collection of children, use an array instead.");return pe}function W(V,K,J){if(V==null)return V;var oe=[],Z=0;return L(V,oe,"","",function(de){return K.call(J,de,Z++)}),oe}function H(V){if(V._status===-1){var K=V._result;K=K(),K.then(function(J){(V._status===0||V._status===-1)&&(V._status=1,V._result=J)},function(J){(V._status===0||V._status===-1)&&(V._status=2,V._result=J)}),V._status===-1&&(V._status=0,V._result=K)}if(V._status===1)return V._result.default;throw V._result}var G={current:null},M={transition:null},j={ReactCurrentDispatcher:G,ReactCurrentBatchConfig:M,ReactCurrentOwner:I};function z(){throw Error("act(...) is not supported in production builds of React.")}return Ln.Children={map:W,forEach:function(V,K,J){W(V,function(){K.apply(this,arguments)},J)},count:function(V){var K=0;return W(V,function(){K++}),K},toArray:function(V){return W(V,function(K){return K})||[]},only:function(V){if(!D(V))throw Error("React.Children.only expected to receive a single React element child.");return V}},Ln.Component=y,Ln.Fragment=t,Ln.Profiler=s,Ln.PureComponent=w,Ln.StrictMode=r,Ln.Suspense=l,Ln.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=j,Ln.act=z,Ln.cloneElement=function(V,K,J){if(V==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+V+".");var oe=x({},V.props),Z=V.key,de=V.ref,pe=V._owner;if(K!=null){if(K.ref!==void 0&&(de=K.ref,pe=I.current),K.key!==void 0&&(Z=""+K.key),V.type&&V.type.defaultProps)var Ce=V.type.defaultProps;for(Ae in K)N.call(K,Ae)&&!T.hasOwnProperty(Ae)&&(oe[Ae]=K[Ae]===void 0&&Ce!==void 0?Ce[Ae]:K[Ae])}var Ae=arguments.length-2;if(Ae===1)oe.children=J;else if(1<Ae){Ce=Array(Ae);for(var ze=0;ze<Ae;ze++)Ce[ze]=arguments[ze+2];oe.children=Ce}return{$$typeof:n,type:V.type,key:Z,ref:de,props:oe,_owner:pe}},Ln.createContext=function(V){return V={$$typeof:i,_currentValue:V,_currentValue2:V,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},V.Provider={$$typeof:o,_context:V},V.Consumer=V},Ln.createElement=F,Ln.createFactory=function(V){var K=F.bind(null,V);return K.type=V,K},Ln.createRef=function(){return{current:null}},Ln.forwardRef=function(V){return{$$typeof:a,render:V}},Ln.isValidElement=D,Ln.lazy=function(V){return{$$typeof:u,_payload:{_status:-1,_result:V},_init:H}},Ln.memo=function(V,K){return{$$typeof:c,type:V,compare:K===void 0?null:K}},Ln.startTransition=function(V){var K=M.transition;M.transition={};try{V()}finally{M.transition=K}},Ln.unstable_act=z,Ln.useCallback=function(V,K){return G.current.useCallback(V,K)},Ln.useContext=function(V){return G.current.useContext(V)},Ln.useDebugValue=function(){},Ln.useDeferredValue=function(V){return G.current.useDeferredValue(V)},Ln.useEffect=function(V,K){return G.current.useEffect(V,K)},Ln.useId=function(){return G.current.useId()},Ln.useImperativeHandle=function(V,K,J){return G.current.useImperativeHandle(V,K,J)},Ln.useInsertionEffect=function(V,K){return G.current.useInsertionEffect(V,K)},Ln.useLayoutEffect=function(V,K){return G.current.useLayoutEffect(V,K)},Ln.useMemo=function(V,K){return G.current.useMemo(V,K)},Ln.useReducer=function(V,K,J){return G.current.useReducer(V,K,J)},Ln.useRef=function(V){return G.current.useRef(V)},Ln.useState=function(V){return G.current.useState(V)},Ln.useSyncExternalStore=function(V,K,J){return G.current.useSyncExternalStore(V,K,J)},Ln.useTransition=function(){return G.current.useTransition()},Ln.version="18.3.1",Ln}var IE;function fk(){return IE||(IE=1,L3.exports=BW()),L3.exports}var TE;function VW(){if(TE)return Bm;TE=1;var n=fk(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,s=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function i(a,l,c){var u,d={},f=null,p=null;c!==void 0&&(f=""+c),l.key!==void 0&&(f=""+l.key),l.ref!==void 0&&(p=l.ref);for(u in l)r.call(l,u)&&!o.hasOwnProperty(u)&&(d[u]=l[u]);if(a&&a.defaultProps)for(u in l=a.defaultProps,l)d[u]===void 0&&(d[u]=l[u]);return{$$typeof:e,type:a,key:f,ref:p,props:d,_owner:s.current}}return Bm.Fragment=t,Bm.jsx=i,Bm.jsxs=i,Bm}var _E;function zW(){return _E||(_E=1,M3.exports=VW()),M3.exports}var m=zW(),_=fk();const Ve=ay(_),ly=PR({__proto__:null,default:Ve},[_]),WW=1,UW=1e6;let j3=0;function HW(){return j3=(j3+1)%Number.MAX_SAFE_INTEGER,j3.toString()}const B3=new Map,RE=n=>{if(B3.has(n))return;const e=setTimeout(()=>{B3.delete(n),lg({type:"REMOVE_TOAST",toastId:n})},UW);B3.set(n,e)},GW=(n,e)=>{switch(e.type){case"ADD_TOAST":return{...n,toasts:[e.toast,...n.toasts].slice(0,WW)};case"UPDATE_TOAST":return{...n,toasts:n.toasts.map(t=>t.id===e.toast.id?{...t,...e.toast}:t)};case"DISMISS_TOAST":{const{toastId:t}=e;return t?RE(t):n.toasts.forEach(r=>{RE(r.id)}),{...n,toasts:n.toasts.map(r=>r.id===t||t===void 0?{...r,open:!1}:r)}}case"REMOVE_TOAST":return e.toastId===void 0?{...n,toasts:[]}:{...n,toasts:n.toasts.filter(t=>t.id!==e.toastId)}}},Rv=[];let Dv={toasts:[]};function lg(n){Dv=GW(Dv,n),Rv.forEach(e=>{e(Dv)})}function qW({...n}){const e=HW(),t=s=>lg({type:"UPDATE_TOAST",toast:{...s,id:e}}),r=()=>lg({type:"DISMISS_TOAST",toastId:e});return lg({type:"ADD_TOAST",toast:{...n,id:e,open:!0,onOpenChange:s=>{s||r()}}}),{id:e,dismiss:r,update:t}}function pd(){const[n,e]=_.useState(Dv);return _.useEffect(()=>(Rv.push(e),()=>{const t=Rv.indexOf(e);t>-1&&Rv.splice(t,1)}),[n]),{...n,toast:qW,dismiss:t=>lg({type:"DISMISS_TOAST",toastId:t})}}var V3={exports:{}},pi={},z3={exports:{}},W3={};var DE;function KW(){return DE||(DE=1,(function(n){function e(M,j){var z=M.length;M.push(j);e:for(;0<z;){var V=z-1>>>1,K=M[V];if(0<s(K,j))M[V]=j,M[z]=K,z=V;else break e}}function t(M){return M.length===0?null:M[0]}function r(M){if(M.length===0)return null;var j=M[0],z=M.pop();if(z!==j){M[0]=z;e:for(var V=0,K=M.length,J=K>>>1;V<J;){var oe=2*(V+1)-1,Z=M[oe],de=oe+1,pe=M[de];if(0>s(Z,z))de<K&&0>s(pe,Z)?(M[V]=pe,M[de]=z,V=de):(M[V]=Z,M[oe]=z,V=oe);else if(de<K&&0>s(pe,z))M[V]=pe,M[de]=z,V=de;else break e}}return j}function s(M,j){var z=M.sortIndex-j.sortIndex;return z!==0?z:M.id-j.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;n.unstable_now=function(){return o.now()}}else{var i=Date,a=i.now();n.unstable_now=function(){return i.now()-a}}var l=[],c=[],u=1,d=null,f=3,p=!1,x=!1,v=!1,y=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function S(M){for(var j=t(c);j!==null;){if(j.callback===null)r(c);else if(j.startTime<=M)r(c),j.sortIndex=j.expirationTime,e(l,j);else break;j=t(c)}}function k(M){if(v=!1,S(M),!x)if(t(l)!==null)x=!0,H(N);else{var j=t(c);j!==null&&G(k,j.startTime-M)}}function N(M,j){x=!1,v&&(v=!1,b(F),F=-1),p=!0;var z=f;try{for(S(j),d=t(l);d!==null&&(!(d.expirationTime>j)||M&&!A());){var V=d.callback;if(typeof V=="function"){d.callback=null,f=d.priorityLevel;var K=V(d.expirationTime<=j);j=n.unstable_now(),typeof K=="function"?d.callback=K:d===t(l)&&r(l),S(j)}else r(l);d=t(l)}if(d!==null)var J=!0;else{var oe=t(c);oe!==null&&G(k,oe.startTime-j),J=!1}return J}finally{d=null,f=z,p=!1}}var I=!1,T=null,F=-1,R=5,D=-1;function A(){return!(n.unstable_now()-D<R)}function P(){if(T!==null){var M=n.unstable_now();D=M;var j=!0;try{j=T(!0,M)}finally{j?B():(I=!1,T=null)}}else I=!1}var B;if(typeof w=="function")B=function(){w(P)};else if(typeof MessageChannel<"u"){var L=new MessageChannel,W=L.port2;L.port1.onmessage=P,B=function(){W.postMessage(null)}}else B=function(){y(P,0)};function H(M){T=M,I||(I=!0,B())}function G(M,j){F=y(function(){M(n.unstable_now())},j)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(M){M.callback=null},n.unstable_continueExecution=function(){x||p||(x=!0,H(N))},n.unstable_forceFrameRate=function(M){0>M||125<M?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<M?Math.floor(1e3/M):5},n.unstable_getCurrentPriorityLevel=function(){return f},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(M){switch(f){case 1:case 2:case 3:var j=3;break;default:j=f}var z=f;f=j;try{return M()}finally{f=z}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(M,j){switch(M){case 1:case 2:case 3:case 4:case 5:break;default:M=3}var z=f;f=M;try{return j()}finally{f=z}},n.unstable_scheduleCallback=function(M,j,z){var V=n.unstable_now();switch(typeof z=="object"&&z!==null?(z=z.delay,z=typeof z=="number"&&0<z?V+z:V):z=V,M){case 1:var K=-1;break;case 2:K=250;break;case 5:K=1073741823;break;case 4:K=1e4;break;default:K=5e3}return K=z+K,M={id:u++,callback:j,priorityLevel:M,startTime:z,expirationTime:K,sortIndex:-1},z>V?(M.sortIndex=z,e(c,M),t(l)===null&&M===t(c)&&(v?(b(F),F=-1):v=!0,G(k,z-V))):(M.sortIndex=K,e(l,M),x||p||(x=!0,H(N))),M},n.unstable_shouldYield=A,n.unstable_wrapCallback=function(M){var j=f;return function(){var z=f;f=j;try{return M.apply(this,arguments)}finally{f=z}}}})(W3)),W3}var AE;function XW(){return AE||(AE=1,z3.exports=KW()),z3.exports}var $E;function YW(){if($E)return pi;$E=1;var n=fk(),e=XW();function t(h){for(var g="https://reactjs.org/docs/error-decoder.html?invariant="+h,C=1;C<arguments.length;C++)g+="&args[]="+encodeURIComponent(arguments[C]);return"Minified React error #"+h+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r=new Set,s={};function o(h,g){i(h,g),i(h+"Capture",g)}function i(h,g){for(s[h]=g,h=0;h<g.length;h++)r.add(g[h])}var a=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),l=Object.prototype.hasOwnProperty,c=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,u={},d={};function f(h){return l.call(d,h)?!0:l.call(u,h)?!1:c.test(h)?d[h]=!0:(u[h]=!0,!1)}function p(h,g,C,E){if(C!==null&&C.type===0)return!1;switch(typeof g){case"function":case"symbol":return!0;case"boolean":return E?!1:C!==null?!C.acceptsBooleans:(h=h.toLowerCase().slice(0,5),h!=="data-"&&h!=="aria-");default:return!1}}function x(h,g,C,E){if(g===null||typeof g>"u"||p(h,g,C,E))return!0;if(E)return!1;if(C!==null)switch(C.type){case 3:return!g;case 4:return g===!1;case 5:return isNaN(g);case 6:return isNaN(g)||1>g}return!1}function v(h,g,C,E,$,O,U){this.acceptsBooleans=g===2||g===3||g===4,this.attributeName=E,this.attributeNamespace=$,this.mustUseProperty=C,this.propertyName=h,this.type=g,this.sanitizeURL=O,this.removeEmptyString=U}var y={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(h){y[h]=new v(h,0,!1,h,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(h){var g=h[0];y[g]=new v(g,1,!1,h[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(h){y[h]=new v(h,2,!1,h.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(h){y[h]=new v(h,2,!1,h,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(h){y[h]=new v(h,3,!1,h.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(h){y[h]=new v(h,3,!0,h,null,!1,!1)}),["capture","download"].forEach(function(h){y[h]=new v(h,4,!1,h,null,!1,!1)}),["cols","rows","size","span"].forEach(function(h){y[h]=new v(h,6,!1,h,null,!1,!1)}),["rowSpan","start"].forEach(function(h){y[h]=new v(h,5,!1,h.toLowerCase(),null,!1,!1)});var b=/[\-:]([a-z])/g;function w(h){return h[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(h){var g=h.replace(b,w);y[g]=new v(g,1,!1,h,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(h){var g=h.replace(b,w);y[g]=new v(g,1,!1,h,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(h){var g=h.replace(b,w);y[g]=new v(g,1,!1,h,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(h){y[h]=new v(h,1,!1,h.toLowerCase(),null,!1,!1)}),y.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(h){y[h]=new v(h,1,!1,h.toLowerCase(),null,!0,!0)});function S(h,g,C,E){var $=y.hasOwnProperty(g)?y[g]:null;($!==null?$.type!==0:E||!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(x(g,C,$,E)&&(C=null),E||$===null?f(g)&&(C===null?h.removeAttribute(g):h.setAttribute(g,""+C)):$.mustUseProperty?h[$.propertyName]=C===null?$.type===3?!1:"":C:(g=$.attributeName,E=$.attributeNamespace,C===null?h.removeAttribute(g):($=$.type,C=$===3||$===4&&C===!0?"":""+C,E?h.setAttributeNS(E,g,C):h.setAttribute(g,C))))}var k=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,N=Symbol.for("react.element"),I=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),F=Symbol.for("react.strict_mode"),R=Symbol.for("react.profiler"),D=Symbol.for("react.provider"),A=Symbol.for("react.context"),P=Symbol.for("react.forward_ref"),B=Symbol.for("react.suspense"),L=Symbol.for("react.suspense_list"),W=Symbol.for("react.memo"),H=Symbol.for("react.lazy"),G=Symbol.for("react.offscreen"),M=Symbol.iterator;function j(h){return h===null||typeof h!="object"?null:(h=M&&h[M]||h["@@iterator"],typeof h=="function"?h:null)}var z=Object.assign,V;function K(h){if(V===void 0)try{throw Error()}catch(C){var g=C.stack.trim().match(/\n( *(at )?)/);V=g&&g[1]||""}return`
`+V+h}var J=!1;function oe(h,g){if(!h||J)return"";J=!0;var C=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(g)if(g=function(){throw Error()},Object.defineProperty(g.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(g,[])}catch(Fe){var E=Fe}Reflect.construct(h,[],g)}else{try{g.call()}catch(Fe){E=Fe}h.call(g.prototype)}else{try{throw Error()}catch(Fe){E=Fe}h()}}catch(Fe){if(Fe&&E&&typeof Fe.stack=="string"){for(var $=Fe.stack.split(`
`),O=E.stack.split(`
`),U=$.length-1,ne=O.length-1;1<=U&&0<=ne&&$[U]!==O[ne];)ne--;for(;1<=U&&0<=ne;U--,ne--)if($[U]!==O[ne]){if(U!==1||ne!==1)do if(U--,ne--,0>ne||$[U]!==O[ne]){var le=`
`+$[U].replace(" at new "," at ");return h.displayName&&le.includes("<anonymous>")&&(le=le.replace("<anonymous>",h.displayName)),le}while(1<=U&&0<=ne);break}}}finally{J=!1,Error.prepareStackTrace=C}return(h=h?h.displayName||h.name:"")?K(h):""}function Z(h){switch(h.tag){case 5:return K(h.type);case 16:return K("Lazy");case 13:return K("Suspense");case 19:return K("SuspenseList");case 0:case 2:case 15:return h=oe(h.type,!1),h;case 11:return h=oe(h.type.render,!1),h;case 1:return h=oe(h.type,!0),h;default:return""}}function de(h){if(h==null)return null;if(typeof h=="function")return h.displayName||h.name||null;if(typeof h=="string")return h;switch(h){case T:return"Fragment";case I:return"Portal";case R:return"Profiler";case F:return"StrictMode";case B:return"Suspense";case L:return"SuspenseList"}if(typeof h=="object")switch(h.$$typeof){case A:return(h.displayName||"Context")+".Consumer";case D:return(h._context.displayName||"Context")+".Provider";case P:var g=h.render;return h=h.displayName,h||(h=g.displayName||g.name||"",h=h!==""?"ForwardRef("+h+")":"ForwardRef"),h;case W:return g=h.displayName||null,g!==null?g:de(h.type)||"Memo";case H:g=h._payload,h=h._init;try{return de(h(g))}catch{}}return null}function pe(h){var g=h.type;switch(h.tag){case 24:return"Cache";case 9:return(g.displayName||"Context")+".Consumer";case 10:return(g._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return h=g.render,h=h.displayName||h.name||"",g.displayName||(h!==""?"ForwardRef("+h+")":"ForwardRef");case 7:return"Fragment";case 5:return g;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return de(g);case 8:return g===F?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g}return null}function Ce(h){switch(typeof h){case"boolean":case"number":case"string":case"undefined":return h;case"object":return h;default:return""}}function Ae(h){var g=h.type;return(h=h.nodeName)&&h.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function ze(h){var g=Ae(h)?"checked":"value",C=Object.getOwnPropertyDescriptor(h.constructor.prototype,g),E=""+h[g];if(!h.hasOwnProperty(g)&&typeof C<"u"&&typeof C.get=="function"&&typeof C.set=="function"){var $=C.get,O=C.set;return Object.defineProperty(h,g,{configurable:!0,get:function(){return $.call(this)},set:function(U){E=""+U,O.call(this,U)}}),Object.defineProperty(h,g,{enumerable:C.enumerable}),{getValue:function(){return E},setValue:function(U){E=""+U},stopTracking:function(){h._valueTracker=null,delete h[g]}}}}function et(h){h._valueTracker||(h._valueTracker=ze(h))}function gt(h){if(!h)return!1;var g=h._valueTracker;if(!g)return!0;var C=g.getValue(),E="";return h&&(E=Ae(h)?h.checked?"true":"false":h.value),h=E,h!==C?(g.setValue(h),!0):!1}function dt(h){if(h=h||(typeof document<"u"?document:void 0),typeof h>"u")return null;try{return h.activeElement||h.body}catch{return h.body}}function Ct(h,g){var C=g.checked;return z({},g,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:C??h._wrapperState.initialChecked})}function lt(h,g){var C=g.defaultValue==null?"":g.defaultValue,E=g.checked!=null?g.checked:g.defaultChecked;C=Ce(g.value!=null?g.value:C),h._wrapperState={initialChecked:E,initialValue:C,controlled:g.type==="checkbox"||g.type==="radio"?g.checked!=null:g.value!=null}}function bt(h,g){g=g.checked,g!=null&&S(h,"checked",g,!1)}function rn(h,g){bt(h,g);var C=Ce(g.value),E=g.type;if(C!=null)E==="number"?(C===0&&h.value===""||h.value!=C)&&(h.value=""+C):h.value!==""+C&&(h.value=""+C);else if(E==="submit"||E==="reset"){h.removeAttribute("value");return}g.hasOwnProperty("value")?vn(h,g.type,C):g.hasOwnProperty("defaultValue")&&vn(h,g.type,Ce(g.defaultValue)),g.checked==null&&g.defaultChecked!=null&&(h.defaultChecked=!!g.defaultChecked)}function Ft(h,g,C){if(g.hasOwnProperty("value")||g.hasOwnProperty("defaultValue")){var E=g.type;if(!(E!=="submit"&&E!=="reset"||g.value!==void 0&&g.value!==null))return;g=""+h._wrapperState.initialValue,C||g===h.value||(h.value=g),h.defaultValue=g}C=h.name,C!==""&&(h.name=""),h.defaultChecked=!!h._wrapperState.initialChecked,C!==""&&(h.name=C)}function vn(h,g,C){(g!=="number"||dt(h.ownerDocument)!==h)&&(C==null?h.defaultValue=""+h._wrapperState.initialValue:h.defaultValue!==""+C&&(h.defaultValue=""+C))}var te=Array.isArray;function q(h,g,C,E){if(h=h.options,g){g={};for(var $=0;$<C.length;$++)g["$"+C[$]]=!0;for(C=0;C<h.length;C++)$=g.hasOwnProperty("$"+h[C].value),h[C].selected!==$&&(h[C].selected=$),$&&E&&(h[C].defaultSelected=!0)}else{for(C=""+Ce(C),g=null,$=0;$<h.length;$++){if(h[$].value===C){h[$].selected=!0,E&&(h[$].defaultSelected=!0);return}g!==null||h[$].disabled||(g=h[$])}g!==null&&(g.selected=!0)}}function ke(h,g){if(g.dangerouslySetInnerHTML!=null)throw Error(t(91));return z({},g,{value:void 0,defaultValue:void 0,children:""+h._wrapperState.initialValue})}function He(h,g){var C=g.value;if(C==null){if(C=g.children,g=g.defaultValue,C!=null){if(g!=null)throw Error(t(92));if(te(C)){if(1<C.length)throw Error(t(93));C=C[0]}g=C}g==null&&(g=""),C=g}h._wrapperState={initialValue:Ce(C)}}function Ke(h,g){var C=Ce(g.value),E=Ce(g.defaultValue);C!=null&&(C=""+C,C!==h.value&&(h.value=C),g.defaultValue==null&&h.defaultValue!==C&&(h.defaultValue=C)),E!=null&&(h.defaultValue=""+E)}function Be(h){var g=h.textContent;g===h._wrapperState.initialValue&&g!==""&&g!==null&&(h.value=g)}function ct(h){switch(h){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Nt(h,g){return h==null||h==="http://www.w3.org/1999/xhtml"?ct(g):h==="http://www.w3.org/2000/svg"&&g==="foreignObject"?"http://www.w3.org/1999/xhtml":h}var Rt,sn=(function(h){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(g,C,E,$){MSApp.execUnsafeLocalFunction(function(){return h(g,C,E,$)})}:h})(function(h,g){if(h.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in h)h.innerHTML=g;else{for(Rt=Rt||document.createElement("div"),Rt.innerHTML="<svg>"+g.valueOf().toString()+"</svg>",g=Rt.firstChild;h.firstChild;)h.removeChild(h.firstChild);for(;g.firstChild;)h.appendChild(g.firstChild)}});function Kn(h,g){if(g){var C=h.firstChild;if(C&&C===h.lastChild&&C.nodeType===3){C.nodeValue=g;return}}h.textContent=g}var Ee={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ge=["Webkit","ms","Moz","O"];Object.keys(Ee).forEach(function(h){Ge.forEach(function(g){g=g+h.charAt(0).toUpperCase()+h.substring(1),Ee[g]=Ee[h]})});function Q(h,g,C){return g==null||typeof g=="boolean"||g===""?"":C||typeof g!="number"||g===0||Ee.hasOwnProperty(h)&&Ee[h]?(""+g).trim():g+"px"}function ht(h,g){h=h.style;for(var C in g)if(g.hasOwnProperty(C)){var E=C.indexOf("--")===0,$=Q(C,g[C],E);C==="float"&&(C="cssFloat"),E?h.setProperty(C,$):h[C]=$}}var it=z({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Yt(h,g){if(g){if(it[h]&&(g.children!=null||g.dangerouslySetInnerHTML!=null))throw Error(t(137,h));if(g.dangerouslySetInnerHTML!=null){if(g.children!=null)throw Error(t(60));if(typeof g.dangerouslySetInnerHTML!="object"||!("__html"in g.dangerouslySetInnerHTML))throw Error(t(61))}if(g.style!=null&&typeof g.style!="object")throw Error(t(62))}}function cn(h,g){if(h.indexOf("-")===-1)return typeof g.is=="string";switch(h){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Lt=null;function On(h){return h=h.target||h.srcElement||window,h.correspondingUseElement&&(h=h.correspondingUseElement),h.nodeType===3?h.parentNode:h}var An=null,Jn=null,nr=null;function gr(h){if(h=Nm(h)){if(typeof An!="function")throw Error(t(280));var g=h.stateNode;g&&(g=ex(g),An(h.stateNode,h.type,g))}}function _i(h){Jn?nr?nr.push(h):nr=[h]:Jn=h}function xt(){if(Jn){var h=Jn,g=nr;if(nr=Jn=null,gr(h),g)for(h=0;h<g.length;h++)gr(g[h])}}function In(h,g){return h(g)}function _n(){}var xr=!1;function cr(h,g,C){if(xr)return h(g,C);xr=!0;try{return In(h,g,C)}finally{xr=!1,(Jn!==null||nr!==null)&&(_n(),xt())}}function kr(h,g){var C=h.stateNode;if(C===null)return null;var E=ex(C);if(E===null)return null;C=E[g];e:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(E=!E.disabled)||(h=h.type,E=!(h==="button"||h==="input"||h==="select"||h==="textarea")),h=!E;break e;default:h=!1}if(h)return null;if(C&&typeof C!="function")throw Error(t(231,g,typeof C));return C}var fr=!1;if(a)try{var bn={};Object.defineProperty(bn,"passive",{get:function(){fr=!0}}),window.addEventListener("test",bn,bn),window.removeEventListener("test",bn,bn)}catch{fr=!1}function Sr(h,g,C,E,$,O,U,ne,le){var Fe=Array.prototype.slice.call(arguments,3);try{g.apply(C,Fe)}catch(st){this.onError(st)}}var ls=!1,ia=null,Nr=!1,Te=null,Re={onError:function(h){ls=!0,ia=h}};function we(h,g,C,E,$,O,U,ne,le){ls=!1,ia=null,Sr.apply(Re,arguments)}function qe(h,g,C,E,$,O,U,ne,le){if(we.apply(this,arguments),ls){if(ls){var Fe=ia;ls=!1,ia=null}else throw Error(t(198));Nr||(Nr=!0,Te=Fe)}}function Xe(h){var g=h,C=h;if(h.alternate)for(;g.return;)g=g.return;else{h=g;do g=h,(g.flags&4098)!==0&&(C=g.return),h=g.return;while(h)}return g.tag===3?C:null}function wt(h){if(h.tag===13){var g=h.memoizedState;if(g===null&&(h=h.alternate,h!==null&&(g=h.memoizedState)),g!==null)return g.dehydrated}return null}function pt(h){if(Xe(h)!==h)throw Error(t(188))}function Ut(h){var g=h.alternate;if(!g){if(g=Xe(h),g===null)throw Error(t(188));return g!==h?null:h}for(var C=h,E=g;;){var $=C.return;if($===null)break;var O=$.alternate;if(O===null){if(E=$.return,E!==null){C=E;continue}break}if($.child===O.child){for(O=$.child;O;){if(O===C)return pt($),h;if(O===E)return pt($),g;O=O.sibling}throw Error(t(188))}if(C.return!==E.return)C=$,E=O;else{for(var U=!1,ne=$.child;ne;){if(ne===C){U=!0,C=$,E=O;break}if(ne===E){U=!0,E=$,C=O;break}ne=ne.sibling}if(!U){for(ne=O.child;ne;){if(ne===C){U=!0,C=O,E=$;break}if(ne===E){U=!0,E=O,C=$;break}ne=ne.sibling}if(!U)throw Error(t(189))}}if(C.alternate!==E)throw Error(t(190))}if(C.tag!==3)throw Error(t(188));return C.stateNode.current===C?h:g}function Tt(h){return h=Ut(h),h!==null?qt(h):null}function qt(h){if(h.tag===5||h.tag===6)return h;for(h=h.child;h!==null;){var g=qt(h);if(g!==null)return g;h=h.sibling}return null}var ve=e.unstable_scheduleCallback,ae=e.unstable_cancelCallback,ce=e.unstable_shouldYield,Pe=e.unstable_requestPaint,Ie=e.unstable_now,Ye=e.unstable_getCurrentPriorityLevel,vt=e.unstable_ImmediatePriority,jt=e.unstable_UserBlockingPriority,tt=e.unstable_NormalPriority,Kt=e.unstable_LowPriority,Vn=e.unstable_IdlePriority,Nn=null,vr=null;function Un(h){if(vr&&typeof vr.onCommitFiberRoot=="function")try{vr.onCommitFiberRoot(Nn,h,void 0,(h.current.flags&128)===128)}catch{}}var Wn=Math.clz32?Math.clz32:yw,ur=Math.log,rh=Math.LN2;function yw(h){return h>>>=0,h===0?32:31-(ur(h)/rh|0)|0}var ru=64,su=4194304;function Oa(h){switch(h&-h){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return h&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return h&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return h}}function io(h,g){var C=h.pendingLanes;if(C===0)return 0;var E=0,$=h.suspendedLanes,O=h.pingedLanes,U=C&268435455;if(U!==0){var ne=U&~$;ne!==0?E=Oa(ne):(O&=U,O!==0&&(E=Oa(O)))}else U=C&~$,U!==0?E=Oa(U):O!==0&&(E=Oa(O));if(E===0)return 0;if(g!==0&&g!==E&&(g&$)===0&&($=E&-E,O=g&-g,$>=O||$===16&&(O&4194240)!==0))return g;if((E&4)!==0&&(E|=C&16),g=h.entangledLanes,g!==0)for(h=h.entanglements,g&=E;0<g;)C=31-Wn(g),$=1<<C,E|=h[C],g&=~$;return E}function Ma(h,g){switch(h){case 1:case 2:case 4:return g+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function vl(h,g){for(var C=h.suspendedLanes,E=h.pingedLanes,$=h.expirationTimes,O=h.pendingLanes;0<O;){var U=31-Wn(O),ne=1<<U,le=$[U];le===-1?((ne&C)===0||(ne&E)!==0)&&($[U]=Ma(ne,g)):le<=g&&(h.expiredLanes|=ne),O&=~ne}}function Td(h){return h=h.pendingLanes&-1073741825,h!==0?h:h&1073741824?1073741824:0}function _d(){var h=ru;return ru<<=1,(ru&4194240)===0&&(ru=64),h}function Ri(h){for(var g=[],C=0;31>C;C++)g.push(h);return g}function yc(h,g,C){h.pendingLanes|=g,g!==536870912&&(h.suspendedLanes=0,h.pingedLanes=0),h=h.eventTimes,g=31-Wn(g),h[g]=C}function ou(h,g){var C=h.pendingLanes&~g;h.pendingLanes=g,h.suspendedLanes=0,h.pingedLanes=0,h.expiredLanes&=g,h.mutableReadLanes&=g,h.entangledLanes&=g,g=h.entanglements;var E=h.eventTimes;for(h=h.expirationTimes;0<C;){var $=31-Wn(C),O=1<<$;g[$]=0,E[$]=-1,h[$]=-1,C&=~O}}function fm(h,g){var C=h.entangledLanes|=g;for(h=h.entanglements;C;){var E=31-Wn(C),$=1<<E;$&g|h[E]&g&&(h[E]|=g),C&=~$}}var rr=0;function Us(h){return h&=-h,1<h?4<h?(h&268435455)!==0?16:536870912:4:1}var sh,Rd,aa,hm,oh,la=!1,Dd=[],Di=null,ii=null,_r=null,yl=new Map,bc=new Map,Hs=[],wc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ai(h,g){switch(h){case"focusin":case"focusout":Di=null;break;case"dragenter":case"dragleave":ii=null;break;case"mouseover":case"mouseout":_r=null;break;case"pointerover":case"pointerout":yl.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":bc.delete(g.pointerId)}}function bl(h,g,C,E,$,O){return h===null||h.nativeEvent!==O?(h={blockedOn:g,domEventName:C,eventSystemFlags:E,nativeEvent:O,targetContainers:[$]},g!==null&&(g=Nm(g),g!==null&&Rd(g)),h):(h.eventSystemFlags|=E,g=h.targetContainers,$!==null&&g.indexOf($)===-1&&g.push($),h)}function Ad(h,g,C,E,$){switch(g){case"focusin":return Di=bl(Di,h,g,C,E,$),!0;case"dragenter":return ii=bl(ii,h,g,C,E,$),!0;case"mouseover":return _r=bl(_r,h,g,C,E,$),!0;case"pointerover":var O=$.pointerId;return yl.set(O,bl(yl.get(O)||null,h,g,C,E,$)),!0;case"gotpointercapture":return O=$.pointerId,bc.set(O,bl(bc.get(O)||null,h,g,C,E,$)),!0}return!1}function Ho(h){var g=Ld(h.target);if(g!==null){var C=Xe(g);if(C!==null){if(g=C.tag,g===13){if(g=wt(C),g!==null){h.blockedOn=g,oh(h.priority,function(){aa(C)});return}}else if(g===3&&C.stateNode.current.memoizedState.isDehydrated){h.blockedOn=C.tag===3?C.stateNode.containerInfo:null;return}}}h.blockedOn=null}function wl(h){if(h.blockedOn!==null)return!1;for(var g=h.targetContainers;0<g.length;){var C=ih(h.domEventName,h.eventSystemFlags,g[0],h.nativeEvent);if(C===null){C=h.nativeEvent;var E=new C.constructor(C.type,C);Lt=E,C.target.dispatchEvent(E),Lt=null}else return g=Nm(C),g!==null&&Rd(g),h.blockedOn=C,!1;g.shift()}return!0}function pm(h,g,C){wl(h)&&C.delete(g)}function La(){la=!1,Di!==null&&wl(Di)&&(Di=null),ii!==null&&wl(ii)&&(ii=null),_r!==null&&wl(_r)&&(_r=null),yl.forEach(pm),bc.forEach(pm)}function $i(h,g){h.blockedOn===g&&(h.blockedOn=null,la||(la=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,La)))}function Fi(h){function g($){return $i($,h)}if(0<Dd.length){$i(Dd[0],h);for(var C=1;C<Dd.length;C++){var E=Dd[C];E.blockedOn===h&&(E.blockedOn=null)}}for(Di!==null&&$i(Di,h),ii!==null&&$i(ii,h),_r!==null&&$i(_r,h),yl.forEach(g),bc.forEach(g),C=0;C<Hs.length;C++)E=Hs[C],E.blockedOn===h&&(E.blockedOn=null);for(;0<Hs.length&&(C=Hs[0],C.blockedOn===null);)Ho(C),C.blockedOn===null&&Hs.shift()}var Cl=k.ReactCurrentBatchConfig,$d=!0;function iu(h,g,C,E){var $=rr,O=Cl.transition;Cl.transition=null;try{rr=1,au(h,g,C,E)}finally{rr=$,Cl.transition=O}}function Fd(h,g,C,E){var $=rr,O=Cl.transition;Cl.transition=null;try{rr=4,au(h,g,C,E)}finally{rr=$,Cl.transition=O}}function au(h,g,C,E){if($d){var $=ih(h,g,C,E);if($===null)Iw(h,g,E,wr,C),Ai(h,E);else if(Ad($,h,g,C,E))E.stopPropagation();else if(Ai(h,E),g&4&&-1<wc.indexOf(h)){for(;$!==null;){var O=Nm($);if(O!==null&&sh(O),O=ih(h,g,C,E),O===null&&Iw(h,g,E,wr,C),O===$)break;$=O}$!==null&&E.stopPropagation()}else Iw(h,g,E,null,C)}}var wr=null;function ih(h,g,C,E){if(wr=null,h=On(E),h=Ld(h),h!==null)if(g=Xe(h),g===null)h=null;else if(C=g.tag,C===13){if(h=wt(g),h!==null)return h;h=null}else if(C===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;h=null}else g!==h&&(h=null);return wr=h,null}function mm(h){switch(h){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ye()){case vt:return 1;case jt:return 4;case tt:case Kt:return 16;case Vn:return 536870912;default:return 16}default:return 16}}var Gs=null,lu=null,Pd=null;function T0(){if(Pd)return Pd;var h,g=lu,C=g.length,E,$="value"in Gs?Gs.value:Gs.textContent,O=$.length;for(h=0;h<C&&g[h]===$[h];h++);var U=C-h;for(E=1;E<=U&&g[C-E]===$[O-E];E++);return Pd=$.slice(h,1<E?1-E:void 0)}function Od(h){var g=h.keyCode;return"charCode"in h?(h=h.charCode,h===0&&g===13&&(h=13)):h=g,h===10&&(h=13),32<=h||h===13?h:0}function ah(){return!0}function _0(){return!1}function bo(h){function g(C,E,$,O,U){this._reactName=C,this._targetInst=$,this.type=E,this.nativeEvent=O,this.target=U,this.currentTarget=null;for(var ne in h)h.hasOwnProperty(ne)&&(C=h[ne],this[ne]=C?C(O):O[ne]);return this.isDefaultPrevented=(O.defaultPrevented!=null?O.defaultPrevented:O.returnValue===!1)?ah:_0,this.isPropagationStopped=_0,this}return z(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var C=this.nativeEvent;C&&(C.preventDefault?C.preventDefault():typeof C.returnValue!="unknown"&&(C.returnValue=!1),this.isDefaultPrevented=ah)},stopPropagation:function(){var C=this.nativeEvent;C&&(C.stopPropagation?C.stopPropagation():typeof C.cancelBubble!="unknown"&&(C.cancelBubble=!0),this.isPropagationStopped=ah)},persist:function(){},isPersistent:ah}),g}var an={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(h){return h.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},gm=bo(an),cu=z({},an,{view:0,detail:0}),R0=bo(cu),ja,lh,uu,Pi=z({},cu,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Oi,button:0,buttons:0,relatedTarget:function(h){return h.relatedTarget===void 0?h.fromElement===h.srcElement?h.toElement:h.fromElement:h.relatedTarget},movementX:function(h){return"movementX"in h?h.movementX:(h!==uu&&(uu&&h.type==="mousemove"?(ja=h.screenX-uu.screenX,lh=h.screenY-uu.screenY):lh=ja=0,uu=h),ja)},movementY:function(h){return"movementY"in h?h.movementY:lh}}),xm=bo(Pi),D0=z({},Pi,{dataTransfer:0}),ch=bo(D0),du=z({},cu,{relatedTarget:0}),Md=bo(du),uh=z({},an,{animationName:0,elapsedTime:0,pseudoElement:0}),A0=bo(uh),$0=z({},an,{clipboardData:function(h){return"clipboardData"in h?h.clipboardData:window.clipboardData}}),fu=bo($0),hu=z({},an,{data:0}),vm=bo(hu),F0={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},P0={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},O0={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function M0(h){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(h):(h=O0[h])?!!g[h]:!1}function Oi(){return M0}var wo=z({},cu,{key:function(h){if(h.key){var g=F0[h.key]||h.key;if(g!=="Unidentified")return g}return h.type==="keypress"?(h=Od(h),h===13?"Enter":String.fromCharCode(h)):h.type==="keydown"||h.type==="keyup"?P0[h.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Oi,charCode:function(h){return h.type==="keypress"?Od(h):0},keyCode:function(h){return h.type==="keydown"||h.type==="keyup"?h.keyCode:0},which:function(h){return h.type==="keypress"?Od(h):h.type==="keydown"||h.type==="keyup"?h.keyCode:0}}),kl=bo(wo),L0=z({},Pi,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ym=bo(L0),j0=z({},cu,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Oi}),B0=bo(j0),V0=z({},an,{propertyName:0,elapsedTime:0,pseudoElement:0}),z0=bo(V0),W0=z({},Pi,{deltaX:function(h){return"deltaX"in h?h.deltaX:"wheelDeltaX"in h?-h.wheelDeltaX:0},deltaY:function(h){return"deltaY"in h?h.deltaY:"wheelDeltaY"in h?-h.wheelDeltaY:"wheelDelta"in h?-h.wheelDelta:0},deltaZ:0,deltaMode:0}),U0=bo(W0),H0=[9,13,27,32],dh=a&&"CompositionEvent"in window,pu=null;a&&"documentMode"in document&&(pu=document.documentMode);var bw=a&&"TextEvent"in window&&!pu,G0=a&&(!dh||pu&&8<pu&&11>=pu),q0=" ",he=!1;function re(h,g){switch(h){case"keyup":return H0.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Je(h){return h=h.detail,typeof h=="object"&&"data"in h?h.data:null}var rt=!1;function _t(h,g){switch(h){case"compositionend":return Je(g);case"keypress":return g.which!==32?null:(he=!0,q0);case"textInput":return h=g.data,h===q0&&he?null:h;default:return null}}function mt(h,g){if(rt)return h==="compositionend"||!dh&&re(h,g)?(h=T0(),Pd=lu=Gs=null,rt=!1,h):null;switch(h){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return G0&&g.locale!=="ko"?null:g.data;default:return null}}var We={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ot(h){var g=h&&h.nodeName&&h.nodeName.toLowerCase();return g==="input"?!!We[h.type]:g==="textarea"}function un(h,g,C,E){_i(E),g=Z0(g,"onChange"),0<g.length&&(C=new gm("onChange","change",null,C,E),h.push({event:C,listeners:g}))}var pn=null,Xn=null;function Zr(h){zN(h,0)}function _s(h){var g=xh(h);if(gt(g))return h}function ai(h,g){if(h==="change")return g}var ca=!1;if(a){var ua;if(a){var da="oninput"in document;if(!da){var Sl=document.createElement("div");Sl.setAttribute("oninput","return;"),da=typeof Sl.oninput=="function"}ua=da}else ua=!1;ca=ua&&(!document.documentMode||9<document.documentMode)}function Ba(){pn&&(pn.detachEvent("onpropertychange",mu),Xn=pn=null)}function mu(h){if(h.propertyName==="value"&&_s(Xn)){var g=[];un(g,Xn,h,On(h)),cr(Zr,g)}}function Qn(h,g,C){h==="focusin"?(Ba(),pn=g,Xn=C,pn.attachEvent("onpropertychange",mu)):h==="focusout"&&Ba()}function qs(h){if(h==="selectionchange"||h==="keyup"||h==="keydown")return _s(Xn)}function ao(h,g){if(h==="click")return _s(g)}function Go(h,g){if(h==="input"||h==="change")return _s(g)}function fa(h,g){return h===g&&(h!==0||1/h===1/g)||h!==h&&g!==g}var Jr=typeof Object.is=="function"?Object.is:fa;function li(h,g){if(Jr(h,g))return!0;if(typeof h!="object"||h===null||typeof g!="object"||g===null)return!1;var C=Object.keys(h),E=Object.keys(g);if(C.length!==E.length)return!1;for(E=0;E<C.length;E++){var $=C[E];if(!l.call(g,$)||!Jr(h[$],g[$]))return!1}return!0}function ha(h){for(;h&&h.firstChild;)h=h.firstChild;return h}function fh(h,g){var C=ha(h);h=0;for(var E;C;){if(C.nodeType===3){if(E=h+C.textContent.length,h<=g&&E>=g)return{node:C,offset:g-h};h=E}e:{for(;C;){if(C.nextSibling){C=C.nextSibling;break e}C=C.parentNode}C=void 0}C=ha(C)}}function Mi(h,g){return h&&g?h===g?!0:h&&h.nodeType===3?!1:g&&g.nodeType===3?Mi(h,g.parentNode):"contains"in h?h.contains(g):h.compareDocumentPosition?!!(h.compareDocumentPosition(g)&16):!1:!1}function Nl(){for(var h=window,g=dt();g instanceof h.HTMLIFrameElement;){try{var C=typeof g.contentWindow.location.href=="string"}catch{C=!1}if(C)h=g.contentWindow;else break;g=dt(h.document)}return g}function hh(h){var g=h&&h.nodeName&&h.nodeName.toLowerCase();return g&&(g==="input"&&(h.type==="text"||h.type==="search"||h.type==="tel"||h.type==="url"||h.type==="password")||g==="textarea"||h.contentEditable==="true")}function gu(h){var g=Nl(),C=h.focusedElem,E=h.selectionRange;if(g!==C&&C&&C.ownerDocument&&Mi(C.ownerDocument.documentElement,C)){if(E!==null&&hh(C)){if(g=E.start,h=E.end,h===void 0&&(h=g),"selectionStart"in C)C.selectionStart=g,C.selectionEnd=Math.min(h,C.value.length);else if(h=(g=C.ownerDocument||document)&&g.defaultView||window,h.getSelection){h=h.getSelection();var $=C.textContent.length,O=Math.min(E.start,$);E=E.end===void 0?O:Math.min(E.end,$),!h.extend&&O>E&&($=E,E=O,O=$),$=fh(C,O);var U=fh(C,E);$&&U&&(h.rangeCount!==1||h.anchorNode!==$.node||h.anchorOffset!==$.offset||h.focusNode!==U.node||h.focusOffset!==U.offset)&&(g=g.createRange(),g.setStart($.node,$.offset),h.removeAllRanges(),O>E?(h.addRange(g),h.extend(U.node,U.offset)):(g.setEnd(U.node,U.offset),h.addRange(g)))}}for(g=[],h=C;h=h.parentNode;)h.nodeType===1&&g.push({element:h,left:h.scrollLeft,top:h.scrollTop});for(typeof C.focus=="function"&&C.focus(),C=0;C<g.length;C++)h=g[C],h.element.scrollLeft=h.left,h.element.scrollTop=h.top}}var El=a&&"documentMode"in document&&11>=document.documentMode,Co=null,ww=null,bm=null,Cw=!1;function $N(h,g,C){var E=C.window===C?C.document:C.nodeType===9?C:C.ownerDocument;Cw||Co==null||Co!==dt(E)||(E=Co,"selectionStart"in E&&hh(E)?E={start:E.selectionStart,end:E.selectionEnd}:(E=(E.ownerDocument&&E.ownerDocument.defaultView||window).getSelection(),E={anchorNode:E.anchorNode,anchorOffset:E.anchorOffset,focusNode:E.focusNode,focusOffset:E.focusOffset}),bm&&li(bm,E)||(bm=E,E=Z0(ww,"onSelect"),0<E.length&&(g=new gm("onSelect","select",null,g,C),h.push({event:g,listeners:E}),g.target=Co)))}function K0(h,g){var C={};return C[h.toLowerCase()]=g.toLowerCase(),C["Webkit"+h]="webkit"+g,C["Moz"+h]="moz"+g,C}var ph={animationend:K0("Animation","AnimationEnd"),animationiteration:K0("Animation","AnimationIteration"),animationstart:K0("Animation","AnimationStart"),transitionend:K0("Transition","TransitionEnd")},kw={},FN={};a&&(FN=document.createElement("div").style,"AnimationEvent"in window||(delete ph.animationend.animation,delete ph.animationiteration.animation,delete ph.animationstart.animation),"TransitionEvent"in window||delete ph.transitionend.transition);function X0(h){if(kw[h])return kw[h];if(!ph[h])return h;var g=ph[h],C;for(C in g)if(g.hasOwnProperty(C)&&C in FN)return kw[h]=g[C];return h}var PN=X0("animationend"),ON=X0("animationiteration"),MN=X0("animationstart"),LN=X0("transitionend"),jN=new Map,BN="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function xu(h,g){jN.set(h,g),o(g,[h])}for(var Sw=0;Sw<BN.length;Sw++){var Nw=BN[Sw],qz=Nw.toLowerCase(),Kz=Nw[0].toUpperCase()+Nw.slice(1);xu(qz,"on"+Kz)}xu(PN,"onAnimationEnd"),xu(ON,"onAnimationIteration"),xu(MN,"onAnimationStart"),xu("dblclick","onDoubleClick"),xu("focusin","onFocus"),xu("focusout","onBlur"),xu(LN,"onTransitionEnd"),i("onMouseEnter",["mouseout","mouseover"]),i("onMouseLeave",["mouseout","mouseover"]),i("onPointerEnter",["pointerout","pointerover"]),i("onPointerLeave",["pointerout","pointerover"]),o("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),o("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),o("onBeforeInput",["compositionend","keypress","textInput","paste"]),o("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var wm="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Xz=new Set("cancel close invalid load scroll toggle".split(" ").concat(wm));function VN(h,g,C){var E=h.type||"unknown-event";h.currentTarget=C,qe(E,g,void 0,h),h.currentTarget=null}function zN(h,g){g=(g&4)!==0;for(var C=0;C<h.length;C++){var E=h[C],$=E.event;E=E.listeners;e:{var O=void 0;if(g)for(var U=E.length-1;0<=U;U--){var ne=E[U],le=ne.instance,Fe=ne.currentTarget;if(ne=ne.listener,le!==O&&$.isPropagationStopped())break e;VN($,ne,Fe),O=le}else for(U=0;U<E.length;U++){if(ne=E[U],le=ne.instance,Fe=ne.currentTarget,ne=ne.listener,le!==O&&$.isPropagationStopped())break e;VN($,ne,Fe),O=le}}}if(Nr)throw h=Te,Nr=!1,Te=null,h}function Fr(h,g){var C=g[$w];C===void 0&&(C=g[$w]=new Set);var E=h+"__bubble";C.has(E)||(WN(g,h,2,!1),C.add(E))}function Ew(h,g,C){var E=0;g&&(E|=4),WN(C,h,E,g)}var Y0="_reactListening"+Math.random().toString(36).slice(2);function Cm(h){if(!h[Y0]){h[Y0]=!0,r.forEach(function(C){C!=="selectionchange"&&(Xz.has(C)||Ew(C,!1,h),Ew(C,!0,h))});var g=h.nodeType===9?h:h.ownerDocument;g===null||g[Y0]||(g[Y0]=!0,Ew("selectionchange",!1,g))}}function WN(h,g,C,E){switch(mm(g)){case 1:var $=iu;break;case 4:$=Fd;break;default:$=au}C=$.bind(null,g,C,h),$=void 0,!fr||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||($=!0),E?$!==void 0?h.addEventListener(g,C,{capture:!0,passive:$}):h.addEventListener(g,C,!0):$!==void 0?h.addEventListener(g,C,{passive:$}):h.addEventListener(g,C,!1)}function Iw(h,g,C,E,$){var O=E;if((g&1)===0&&(g&2)===0&&E!==null)e:for(;;){if(E===null)return;var U=E.tag;if(U===3||U===4){var ne=E.stateNode.containerInfo;if(ne===$||ne.nodeType===8&&ne.parentNode===$)break;if(U===4)for(U=E.return;U!==null;){var le=U.tag;if((le===3||le===4)&&(le=U.stateNode.containerInfo,le===$||le.nodeType===8&&le.parentNode===$))return;U=U.return}for(;ne!==null;){if(U=Ld(ne),U===null)return;if(le=U.tag,le===5||le===6){E=O=U;continue e}ne=ne.parentNode}}E=E.return}cr(function(){var Fe=O,st=On(C),at=[];e:{var nt=jN.get(h);if(nt!==void 0){var Dt=gm,Bt=h;switch(h){case"keypress":if(Od(C)===0)break e;case"keydown":case"keyup":Dt=kl;break;case"focusin":Bt="focus",Dt=Md;break;case"focusout":Bt="blur",Dt=Md;break;case"beforeblur":case"afterblur":Dt=Md;break;case"click":if(C.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Dt=xm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Dt=ch;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Dt=B0;break;case PN:case ON:case MN:Dt=A0;break;case LN:Dt=z0;break;case"scroll":Dt=R0;break;case"wheel":Dt=U0;break;case"copy":case"cut":case"paste":Dt=fu;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Dt=ym}var Ht=(g&4)!==0,cs=!Ht&&h==="scroll",Se=Ht?nt!==null?nt+"Capture":null:nt;Ht=[];for(var xe=Fe,_e;xe!==null;){_e=xe;var ft=_e.stateNode;if(_e.tag===5&&ft!==null&&(_e=ft,Se!==null&&(ft=kr(xe,Se),ft!=null&&Ht.push(km(xe,ft,_e)))),cs)break;xe=xe.return}0<Ht.length&&(nt=new Dt(nt,Bt,null,C,st),at.push({event:nt,listeners:Ht}))}}if((g&7)===0){e:{if(nt=h==="mouseover"||h==="pointerover",Dt=h==="mouseout"||h==="pointerout",nt&&C!==Lt&&(Bt=C.relatedTarget||C.fromElement)&&(Ld(Bt)||Bt[Cc]))break e;if((Dt||nt)&&(nt=st.window===st?st:(nt=st.ownerDocument)?nt.defaultView||nt.parentWindow:window,Dt?(Bt=C.relatedTarget||C.toElement,Dt=Fe,Bt=Bt?Ld(Bt):null,Bt!==null&&(cs=Xe(Bt),Bt!==cs||Bt.tag!==5&&Bt.tag!==6)&&(Bt=null)):(Dt=null,Bt=Fe),Dt!==Bt)){if(Ht=xm,ft="onMouseLeave",Se="onMouseEnter",xe="mouse",(h==="pointerout"||h==="pointerover")&&(Ht=ym,ft="onPointerLeave",Se="onPointerEnter",xe="pointer"),cs=Dt==null?nt:xh(Dt),_e=Bt==null?nt:xh(Bt),nt=new Ht(ft,xe+"leave",Dt,C,st),nt.target=cs,nt.relatedTarget=_e,ft=null,Ld(st)===Fe&&(Ht=new Ht(Se,xe+"enter",Bt,C,st),Ht.target=_e,Ht.relatedTarget=cs,ft=Ht),cs=ft,Dt&&Bt)t:{for(Ht=Dt,Se=Bt,xe=0,_e=Ht;_e;_e=mh(_e))xe++;for(_e=0,ft=Se;ft;ft=mh(ft))_e++;for(;0<xe-_e;)Ht=mh(Ht),xe--;for(;0<_e-xe;)Se=mh(Se),_e--;for(;xe--;){if(Ht===Se||Se!==null&&Ht===Se.alternate)break t;Ht=mh(Ht),Se=mh(Se)}Ht=null}else Ht=null;Dt!==null&&UN(at,nt,Dt,Ht,!1),Bt!==null&&cs!==null&&UN(at,cs,Bt,Ht,!0)}}e:{if(nt=Fe?xh(Fe):window,Dt=nt.nodeName&&nt.nodeName.toLowerCase(),Dt==="select"||Dt==="input"&&nt.type==="file")var Zt=ai;else if(Ot(nt))if(ca)Zt=Go;else{Zt=qs;var dn=Qn}else(Dt=nt.nodeName)&&Dt.toLowerCase()==="input"&&(nt.type==="checkbox"||nt.type==="radio")&&(Zt=ao);if(Zt&&(Zt=Zt(h,Fe))){un(at,Zt,C,st);break e}dn&&dn(h,nt,Fe),h==="focusout"&&(dn=nt._wrapperState)&&dn.controlled&&nt.type==="number"&&vn(nt,"number",nt.value)}switch(dn=Fe?xh(Fe):window,h){case"focusin":(Ot(dn)||dn.contentEditable==="true")&&(Co=dn,ww=Fe,bm=null);break;case"focusout":bm=ww=Co=null;break;case"mousedown":Cw=!0;break;case"contextmenu":case"mouseup":case"dragend":Cw=!1,$N(at,C,st);break;case"selectionchange":if(El)break;case"keydown":case"keyup":$N(at,C,st)}var fn;if(dh)e:{switch(h){case"compositionstart":var gn="onCompositionStart";break e;case"compositionend":gn="onCompositionEnd";break e;case"compositionupdate":gn="onCompositionUpdate";break e}gn=void 0}else rt?re(h,C)&&(gn="onCompositionEnd"):h==="keydown"&&C.keyCode===229&&(gn="onCompositionStart");gn&&(G0&&C.locale!=="ko"&&(rt||gn!=="onCompositionStart"?gn==="onCompositionEnd"&&rt&&(fn=T0()):(Gs=st,lu="value"in Gs?Gs.value:Gs.textContent,rt=!0)),dn=Z0(Fe,gn),0<dn.length&&(gn=new vm(gn,h,null,C,st),at.push({event:gn,listeners:dn}),fn?gn.data=fn:(fn=Je(C),fn!==null&&(gn.data=fn)))),(fn=bw?_t(h,C):mt(h,C))&&(Fe=Z0(Fe,"onBeforeInput"),0<Fe.length&&(st=new vm("onBeforeInput","beforeinput",null,C,st),at.push({event:st,listeners:Fe}),st.data=fn))}zN(at,g)})}function km(h,g,C){return{instance:h,listener:g,currentTarget:C}}function Z0(h,g){for(var C=g+"Capture",E=[];h!==null;){var $=h,O=$.stateNode;$.tag===5&&O!==null&&($=O,O=kr(h,C),O!=null&&E.unshift(km(h,O,$)),O=kr(h,g),O!=null&&E.push(km(h,O,$))),h=h.return}return E}function mh(h){if(h===null)return null;do h=h.return;while(h&&h.tag!==5);return h||null}function UN(h,g,C,E,$){for(var O=g._reactName,U=[];C!==null&&C!==E;){var ne=C,le=ne.alternate,Fe=ne.stateNode;if(le!==null&&le===E)break;ne.tag===5&&Fe!==null&&(ne=Fe,$?(le=kr(C,O),le!=null&&U.unshift(km(C,le,ne))):$||(le=kr(C,O),le!=null&&U.push(km(C,le,ne)))),C=C.return}U.length!==0&&h.push({event:g,listeners:U})}var Yz=/\r\n?/g,Zz=/\u0000|\uFFFD/g;function HN(h){return(typeof h=="string"?h:""+h).replace(Yz,`
`).replace(Zz,"")}function J0(h,g,C){if(g=HN(g),HN(h)!==g&&C)throw Error(t(425))}function Q0(){}var Tw=null,_w=null;function Rw(h,g){return h==="textarea"||h==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var Dw=typeof setTimeout=="function"?setTimeout:void 0,Jz=typeof clearTimeout=="function"?clearTimeout:void 0,GN=typeof Promise=="function"?Promise:void 0,Qz=typeof queueMicrotask=="function"?queueMicrotask:typeof GN<"u"?function(h){return GN.resolve(null).then(h).catch(eW)}:Dw;function eW(h){setTimeout(function(){throw h})}function Aw(h,g){var C=g,E=0;do{var $=C.nextSibling;if(h.removeChild(C),$&&$.nodeType===8)if(C=$.data,C==="/$"){if(E===0){h.removeChild($),Fi(g);return}E--}else C!=="$"&&C!=="$?"&&C!=="$!"||E++;C=$}while(C);Fi(g)}function vu(h){for(;h!=null;h=h.nextSibling){var g=h.nodeType;if(g===1||g===3)break;if(g===8){if(g=h.data,g==="$"||g==="$!"||g==="$?")break;if(g==="/$")return null}}return h}function qN(h){h=h.previousSibling;for(var g=0;h;){if(h.nodeType===8){var C=h.data;if(C==="$"||C==="$!"||C==="$?"){if(g===0)return h;g--}else C==="/$"&&g++}h=h.previousSibling}return null}var gh=Math.random().toString(36).slice(2),Il="__reactFiber$"+gh,Sm="__reactProps$"+gh,Cc="__reactContainer$"+gh,$w="__reactEvents$"+gh,tW="__reactListeners$"+gh,nW="__reactHandles$"+gh;function Ld(h){var g=h[Il];if(g)return g;for(var C=h.parentNode;C;){if(g=C[Cc]||C[Il]){if(C=g.alternate,g.child!==null||C!==null&&C.child!==null)for(h=qN(h);h!==null;){if(C=h[Il])return C;h=qN(h)}return g}h=C,C=h.parentNode}return null}function Nm(h){return h=h[Il]||h[Cc],!h||h.tag!==5&&h.tag!==6&&h.tag!==13&&h.tag!==3?null:h}function xh(h){if(h.tag===5||h.tag===6)return h.stateNode;throw Error(t(33))}function ex(h){return h[Sm]||null}var Fw=[],vh=-1;function yu(h){return{current:h}}function Pr(h){0>vh||(h.current=Fw[vh],Fw[vh]=null,vh--)}function Rr(h,g){vh++,Fw[vh]=h.current,h.current=g}var bu={},ko=yu(bu),ci=yu(!1),jd=bu;function yh(h,g){var C=h.type.contextTypes;if(!C)return bu;var E=h.stateNode;if(E&&E.__reactInternalMemoizedUnmaskedChildContext===g)return E.__reactInternalMemoizedMaskedChildContext;var $={},O;for(O in C)$[O]=g[O];return E&&(h=h.stateNode,h.__reactInternalMemoizedUnmaskedChildContext=g,h.__reactInternalMemoizedMaskedChildContext=$),$}function ui(h){return h=h.childContextTypes,h!=null}function tx(){Pr(ci),Pr(ko)}function KN(h,g,C){if(ko.current!==bu)throw Error(t(168));Rr(ko,g),Rr(ci,C)}function XN(h,g,C){var E=h.stateNode;if(g=g.childContextTypes,typeof E.getChildContext!="function")return C;E=E.getChildContext();for(var $ in E)if(!($ in g))throw Error(t(108,pe(h)||"Unknown",$));return z({},C,E)}function nx(h){return h=(h=h.stateNode)&&h.__reactInternalMemoizedMergedChildContext||bu,jd=ko.current,Rr(ko,h),Rr(ci,ci.current),!0}function YN(h,g,C){var E=h.stateNode;if(!E)throw Error(t(169));C?(h=XN(h,g,jd),E.__reactInternalMemoizedMergedChildContext=h,Pr(ci),Pr(ko),Rr(ko,h)):Pr(ci),Rr(ci,C)}var kc=null,rx=!1,Pw=!1;function ZN(h){kc===null?kc=[h]:kc.push(h)}function rW(h){rx=!0,ZN(h)}function wu(){if(!Pw&&kc!==null){Pw=!0;var h=0,g=rr;try{var C=kc;for(rr=1;h<C.length;h++){var E=C[h];do E=E(!0);while(E!==null)}kc=null,rx=!1}catch($){throw kc!==null&&(kc=kc.slice(h+1)),ve(vt,wu),$}finally{rr=g,Pw=!1}}return null}var bh=[],wh=0,sx=null,ox=0,pa=[],ma=0,Bd=null,Sc=1,Nc="";function Vd(h,g){bh[wh++]=ox,bh[wh++]=sx,sx=h,ox=g}function JN(h,g,C){pa[ma++]=Sc,pa[ma++]=Nc,pa[ma++]=Bd,Bd=h;var E=Sc;h=Nc;var $=32-Wn(E)-1;E&=~(1<<$),C+=1;var O=32-Wn(g)+$;if(30<O){var U=$-$%5;O=(E&(1<<U)-1).toString(32),E>>=U,$-=U,Sc=1<<32-Wn(g)+$|C<<$|E,Nc=O+h}else Sc=1<<O|C<<$|E,Nc=h}function Ow(h){h.return!==null&&(Vd(h,1),JN(h,1,0))}function Mw(h){for(;h===sx;)sx=bh[--wh],bh[wh]=null,ox=bh[--wh],bh[wh]=null;for(;h===Bd;)Bd=pa[--ma],pa[ma]=null,Nc=pa[--ma],pa[ma]=null,Sc=pa[--ma],pa[ma]=null}var Li=null,ji=null,Br=!1,Va=null;function QN(h,g){var C=ya(5,null,null,0);C.elementType="DELETED",C.stateNode=g,C.return=h,g=h.deletions,g===null?(h.deletions=[C],h.flags|=16):g.push(C)}function e7(h,g){switch(h.tag){case 5:var C=h.type;return g=g.nodeType!==1||C.toLowerCase()!==g.nodeName.toLowerCase()?null:g,g!==null?(h.stateNode=g,Li=h,ji=vu(g.firstChild),!0):!1;case 6:return g=h.pendingProps===""||g.nodeType!==3?null:g,g!==null?(h.stateNode=g,Li=h,ji=null,!0):!1;case 13:return g=g.nodeType!==8?null:g,g!==null?(C=Bd!==null?{id:Sc,overflow:Nc}:null,h.memoizedState={dehydrated:g,treeContext:C,retryLane:1073741824},C=ya(18,null,null,0),C.stateNode=g,C.return=h,h.child=C,Li=h,ji=null,!0):!1;default:return!1}}function Lw(h){return(h.mode&1)!==0&&(h.flags&128)===0}function jw(h){if(Br){var g=ji;if(g){var C=g;if(!e7(h,g)){if(Lw(h))throw Error(t(418));g=vu(C.nextSibling);var E=Li;g&&e7(h,g)?QN(E,C):(h.flags=h.flags&-4097|2,Br=!1,Li=h)}}else{if(Lw(h))throw Error(t(418));h.flags=h.flags&-4097|2,Br=!1,Li=h}}}function t7(h){for(h=h.return;h!==null&&h.tag!==5&&h.tag!==3&&h.tag!==13;)h=h.return;Li=h}function ix(h){if(h!==Li)return!1;if(!Br)return t7(h),Br=!0,!1;var g;if((g=h.tag!==3)&&!(g=h.tag!==5)&&(g=h.type,g=g!=="head"&&g!=="body"&&!Rw(h.type,h.memoizedProps)),g&&(g=ji)){if(Lw(h))throw n7(),Error(t(418));for(;g;)QN(h,g),g=vu(g.nextSibling)}if(t7(h),h.tag===13){if(h=h.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(t(317));e:{for(h=h.nextSibling,g=0;h;){if(h.nodeType===8){var C=h.data;if(C==="/$"){if(g===0){ji=vu(h.nextSibling);break e}g--}else C!=="$"&&C!=="$!"&&C!=="$?"||g++}h=h.nextSibling}ji=null}}else ji=Li?vu(h.stateNode.nextSibling):null;return!0}function n7(){for(var h=ji;h;)h=vu(h.nextSibling)}function Ch(){ji=Li=null,Br=!1}function Bw(h){Va===null?Va=[h]:Va.push(h)}var sW=k.ReactCurrentBatchConfig;function Em(h,g,C){if(h=C.ref,h!==null&&typeof h!="function"&&typeof h!="object"){if(C._owner){if(C=C._owner,C){if(C.tag!==1)throw Error(t(309));var E=C.stateNode}if(!E)throw Error(t(147,h));var $=E,O=""+h;return g!==null&&g.ref!==null&&typeof g.ref=="function"&&g.ref._stringRef===O?g.ref:(g=function(U){var ne=$.refs;U===null?delete ne[O]:ne[O]=U},g._stringRef=O,g)}if(typeof h!="string")throw Error(t(284));if(!C._owner)throw Error(t(290,h))}return h}function ax(h,g){throw h=Object.prototype.toString.call(g),Error(t(31,h==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":h))}function r7(h){var g=h._init;return g(h._payload)}function s7(h){function g(Se,xe){if(h){var _e=Se.deletions;_e===null?(Se.deletions=[xe],Se.flags|=16):_e.push(xe)}}function C(Se,xe){if(!h)return null;for(;xe!==null;)g(Se,xe),xe=xe.sibling;return null}function E(Se,xe){for(Se=new Map;xe!==null;)xe.key!==null?Se.set(xe.key,xe):Se.set(xe.index,xe),xe=xe.sibling;return Se}function $(Se,xe){return Se=_u(Se,xe),Se.index=0,Se.sibling=null,Se}function O(Se,xe,_e){return Se.index=_e,h?(_e=Se.alternate,_e!==null?(_e=_e.index,_e<xe?(Se.flags|=2,xe):_e):(Se.flags|=2,xe)):(Se.flags|=1048576,xe)}function U(Se){return h&&Se.alternate===null&&(Se.flags|=2),Se}function ne(Se,xe,_e,ft){return xe===null||xe.tag!==6?(xe=D3(_e,Se.mode,ft),xe.return=Se,xe):(xe=$(xe,_e),xe.return=Se,xe)}function le(Se,xe,_e,ft){var Zt=_e.type;return Zt===T?st(Se,xe,_e.props.children,ft,_e.key):xe!==null&&(xe.elementType===Zt||typeof Zt=="object"&&Zt!==null&&Zt.$$typeof===H&&r7(Zt)===xe.type)?(ft=$(xe,_e.props),ft.ref=Em(Se,xe,_e),ft.return=Se,ft):(ft=Dx(_e.type,_e.key,_e.props,null,Se.mode,ft),ft.ref=Em(Se,xe,_e),ft.return=Se,ft)}function Fe(Se,xe,_e,ft){return xe===null||xe.tag!==4||xe.stateNode.containerInfo!==_e.containerInfo||xe.stateNode.implementation!==_e.implementation?(xe=A3(_e,Se.mode,ft),xe.return=Se,xe):(xe=$(xe,_e.children||[]),xe.return=Se,xe)}function st(Se,xe,_e,ft,Zt){return xe===null||xe.tag!==7?(xe=Xd(_e,Se.mode,ft,Zt),xe.return=Se,xe):(xe=$(xe,_e),xe.return=Se,xe)}function at(Se,xe,_e){if(typeof xe=="string"&&xe!==""||typeof xe=="number")return xe=D3(""+xe,Se.mode,_e),xe.return=Se,xe;if(typeof xe=="object"&&xe!==null){switch(xe.$$typeof){case N:return _e=Dx(xe.type,xe.key,xe.props,null,Se.mode,_e),_e.ref=Em(Se,null,xe),_e.return=Se,_e;case I:return xe=A3(xe,Se.mode,_e),xe.return=Se,xe;case H:var ft=xe._init;return at(Se,ft(xe._payload),_e)}if(te(xe)||j(xe))return xe=Xd(xe,Se.mode,_e,null),xe.return=Se,xe;ax(Se,xe)}return null}function nt(Se,xe,_e,ft){var Zt=xe!==null?xe.key:null;if(typeof _e=="string"&&_e!==""||typeof _e=="number")return Zt!==null?null:ne(Se,xe,""+_e,ft);if(typeof _e=="object"&&_e!==null){switch(_e.$$typeof){case N:return _e.key===Zt?le(Se,xe,_e,ft):null;case I:return _e.key===Zt?Fe(Se,xe,_e,ft):null;case H:return Zt=_e._init,nt(Se,xe,Zt(_e._payload),ft)}if(te(_e)||j(_e))return Zt!==null?null:st(Se,xe,_e,ft,null);ax(Se,_e)}return null}function Dt(Se,xe,_e,ft,Zt){if(typeof ft=="string"&&ft!==""||typeof ft=="number")return Se=Se.get(_e)||null,ne(xe,Se,""+ft,Zt);if(typeof ft=="object"&&ft!==null){switch(ft.$$typeof){case N:return Se=Se.get(ft.key===null?_e:ft.key)||null,le(xe,Se,ft,Zt);case I:return Se=Se.get(ft.key===null?_e:ft.key)||null,Fe(xe,Se,ft,Zt);case H:var dn=ft._init;return Dt(Se,xe,_e,dn(ft._payload),Zt)}if(te(ft)||j(ft))return Se=Se.get(_e)||null,st(xe,Se,ft,Zt,null);ax(xe,ft)}return null}function Bt(Se,xe,_e,ft){for(var Zt=null,dn=null,fn=xe,gn=xe=0,Ys=null;fn!==null&&gn<_e.length;gn++){fn.index>gn?(Ys=fn,fn=null):Ys=fn.sibling;var sr=nt(Se,fn,_e[gn],ft);if(sr===null){fn===null&&(fn=Ys);break}h&&fn&&sr.alternate===null&&g(Se,fn),xe=O(sr,xe,gn),dn===null?Zt=sr:dn.sibling=sr,dn=sr,fn=Ys}if(gn===_e.length)return C(Se,fn),Br&&Vd(Se,gn),Zt;if(fn===null){for(;gn<_e.length;gn++)fn=at(Se,_e[gn],ft),fn!==null&&(xe=O(fn,xe,gn),dn===null?Zt=fn:dn.sibling=fn,dn=fn);return Br&&Vd(Se,gn),Zt}for(fn=E(Se,fn);gn<_e.length;gn++)Ys=Dt(fn,Se,gn,_e[gn],ft),Ys!==null&&(h&&Ys.alternate!==null&&fn.delete(Ys.key===null?gn:Ys.key),xe=O(Ys,xe,gn),dn===null?Zt=Ys:dn.sibling=Ys,dn=Ys);return h&&fn.forEach(function(Ru){return g(Se,Ru)}),Br&&Vd(Se,gn),Zt}function Ht(Se,xe,_e,ft){var Zt=j(_e);if(typeof Zt!="function")throw Error(t(150));if(_e=Zt.call(_e),_e==null)throw Error(t(151));for(var dn=Zt=null,fn=xe,gn=xe=0,Ys=null,sr=_e.next();fn!==null&&!sr.done;gn++,sr=_e.next()){fn.index>gn?(Ys=fn,fn=null):Ys=fn.sibling;var Ru=nt(Se,fn,sr.value,ft);if(Ru===null){fn===null&&(fn=Ys);break}h&&fn&&Ru.alternate===null&&g(Se,fn),xe=O(Ru,xe,gn),dn===null?Zt=Ru:dn.sibling=Ru,dn=Ru,fn=Ys}if(sr.done)return C(Se,fn),Br&&Vd(Se,gn),Zt;if(fn===null){for(;!sr.done;gn++,sr=_e.next())sr=at(Se,sr.value,ft),sr!==null&&(xe=O(sr,xe,gn),dn===null?Zt=sr:dn.sibling=sr,dn=sr);return Br&&Vd(Se,gn),Zt}for(fn=E(Se,fn);!sr.done;gn++,sr=_e.next())sr=Dt(fn,Se,gn,sr.value,ft),sr!==null&&(h&&sr.alternate!==null&&fn.delete(sr.key===null?gn:sr.key),xe=O(sr,xe,gn),dn===null?Zt=sr:dn.sibling=sr,dn=sr);return h&&fn.forEach(function(MW){return g(Se,MW)}),Br&&Vd(Se,gn),Zt}function cs(Se,xe,_e,ft){if(typeof _e=="object"&&_e!==null&&_e.type===T&&_e.key===null&&(_e=_e.props.children),typeof _e=="object"&&_e!==null){switch(_e.$$typeof){case N:e:{for(var Zt=_e.key,dn=xe;dn!==null;){if(dn.key===Zt){if(Zt=_e.type,Zt===T){if(dn.tag===7){C(Se,dn.sibling),xe=$(dn,_e.props.children),xe.return=Se,Se=xe;break e}}else if(dn.elementType===Zt||typeof Zt=="object"&&Zt!==null&&Zt.$$typeof===H&&r7(Zt)===dn.type){C(Se,dn.sibling),xe=$(dn,_e.props),xe.ref=Em(Se,dn,_e),xe.return=Se,Se=xe;break e}C(Se,dn);break}else g(Se,dn);dn=dn.sibling}_e.type===T?(xe=Xd(_e.props.children,Se.mode,ft,_e.key),xe.return=Se,Se=xe):(ft=Dx(_e.type,_e.key,_e.props,null,Se.mode,ft),ft.ref=Em(Se,xe,_e),ft.return=Se,Se=ft)}return U(Se);case I:e:{for(dn=_e.key;xe!==null;){if(xe.key===dn)if(xe.tag===4&&xe.stateNode.containerInfo===_e.containerInfo&&xe.stateNode.implementation===_e.implementation){C(Se,xe.sibling),xe=$(xe,_e.children||[]),xe.return=Se,Se=xe;break e}else{C(Se,xe);break}else g(Se,xe);xe=xe.sibling}xe=A3(_e,Se.mode,ft),xe.return=Se,Se=xe}return U(Se);case H:return dn=_e._init,cs(Se,xe,dn(_e._payload),ft)}if(te(_e))return Bt(Se,xe,_e,ft);if(j(_e))return Ht(Se,xe,_e,ft);ax(Se,_e)}return typeof _e=="string"&&_e!==""||typeof _e=="number"?(_e=""+_e,xe!==null&&xe.tag===6?(C(Se,xe.sibling),xe=$(xe,_e),xe.return=Se,Se=xe):(C(Se,xe),xe=D3(_e,Se.mode,ft),xe.return=Se,Se=xe),U(Se)):C(Se,xe)}return cs}var kh=s7(!0),o7=s7(!1),lx=yu(null),cx=null,Sh=null,Vw=null;function zw(){Vw=Sh=cx=null}function Ww(h){var g=lx.current;Pr(lx),h._currentValue=g}function Uw(h,g,C){for(;h!==null;){var E=h.alternate;if((h.childLanes&g)!==g?(h.childLanes|=g,E!==null&&(E.childLanes|=g)):E!==null&&(E.childLanes&g)!==g&&(E.childLanes|=g),h===C)break;h=h.return}}function Nh(h,g){cx=h,Vw=Sh=null,h=h.dependencies,h!==null&&h.firstContext!==null&&((h.lanes&g)!==0&&(di=!0),h.firstContext=null)}function ga(h){var g=h._currentValue;if(Vw!==h)if(h={context:h,memoizedValue:g,next:null},Sh===null){if(cx===null)throw Error(t(308));Sh=h,cx.dependencies={lanes:0,firstContext:h}}else Sh=Sh.next=h;return g}var zd=null;function Hw(h){zd===null?zd=[h]:zd.push(h)}function i7(h,g,C,E){var $=g.interleaved;return $===null?(C.next=C,Hw(g)):(C.next=$.next,$.next=C),g.interleaved=C,Ec(h,E)}function Ec(h,g){h.lanes|=g;var C=h.alternate;for(C!==null&&(C.lanes|=g),C=h,h=h.return;h!==null;)h.childLanes|=g,C=h.alternate,C!==null&&(C.childLanes|=g),C=h,h=h.return;return C.tag===3?C.stateNode:null}var Cu=!1;function Gw(h){h.updateQueue={baseState:h.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function a7(h,g){h=h.updateQueue,g.updateQueue===h&&(g.updateQueue={baseState:h.baseState,firstBaseUpdate:h.firstBaseUpdate,lastBaseUpdate:h.lastBaseUpdate,shared:h.shared,effects:h.effects})}function Ic(h,g){return{eventTime:h,lane:g,tag:0,payload:null,callback:null,next:null}}function ku(h,g,C){var E=h.updateQueue;if(E===null)return null;if(E=E.shared,(er&2)!==0){var $=E.pending;return $===null?g.next=g:(g.next=$.next,$.next=g),E.pending=g,Ec(h,C)}return $=E.interleaved,$===null?(g.next=g,Hw(E)):(g.next=$.next,$.next=g),E.interleaved=g,Ec(h,C)}function ux(h,g,C){if(g=g.updateQueue,g!==null&&(g=g.shared,(C&4194240)!==0)){var E=g.lanes;E&=h.pendingLanes,C|=E,g.lanes=C,fm(h,C)}}function l7(h,g){var C=h.updateQueue,E=h.alternate;if(E!==null&&(E=E.updateQueue,C===E)){var $=null,O=null;if(C=C.firstBaseUpdate,C!==null){do{var U={eventTime:C.eventTime,lane:C.lane,tag:C.tag,payload:C.payload,callback:C.callback,next:null};O===null?$=O=U:O=O.next=U,C=C.next}while(C!==null);O===null?$=O=g:O=O.next=g}else $=O=g;C={baseState:E.baseState,firstBaseUpdate:$,lastBaseUpdate:O,shared:E.shared,effects:E.effects},h.updateQueue=C;return}h=C.lastBaseUpdate,h===null?C.firstBaseUpdate=g:h.next=g,C.lastBaseUpdate=g}function dx(h,g,C,E){var $=h.updateQueue;Cu=!1;var O=$.firstBaseUpdate,U=$.lastBaseUpdate,ne=$.shared.pending;if(ne!==null){$.shared.pending=null;var le=ne,Fe=le.next;le.next=null,U===null?O=Fe:U.next=Fe,U=le;var st=h.alternate;st!==null&&(st=st.updateQueue,ne=st.lastBaseUpdate,ne!==U&&(ne===null?st.firstBaseUpdate=Fe:ne.next=Fe,st.lastBaseUpdate=le))}if(O!==null){var at=$.baseState;U=0,st=Fe=le=null,ne=O;do{var nt=ne.lane,Dt=ne.eventTime;if((E&nt)===nt){st!==null&&(st=st.next={eventTime:Dt,lane:0,tag:ne.tag,payload:ne.payload,callback:ne.callback,next:null});e:{var Bt=h,Ht=ne;switch(nt=g,Dt=C,Ht.tag){case 1:if(Bt=Ht.payload,typeof Bt=="function"){at=Bt.call(Dt,at,nt);break e}at=Bt;break e;case 3:Bt.flags=Bt.flags&-65537|128;case 0:if(Bt=Ht.payload,nt=typeof Bt=="function"?Bt.call(Dt,at,nt):Bt,nt==null)break e;at=z({},at,nt);break e;case 2:Cu=!0}}ne.callback!==null&&ne.lane!==0&&(h.flags|=64,nt=$.effects,nt===null?$.effects=[ne]:nt.push(ne))}else Dt={eventTime:Dt,lane:nt,tag:ne.tag,payload:ne.payload,callback:ne.callback,next:null},st===null?(Fe=st=Dt,le=at):st=st.next=Dt,U|=nt;if(ne=ne.next,ne===null){if(ne=$.shared.pending,ne===null)break;nt=ne,ne=nt.next,nt.next=null,$.lastBaseUpdate=nt,$.shared.pending=null}}while(!0);if(st===null&&(le=at),$.baseState=le,$.firstBaseUpdate=Fe,$.lastBaseUpdate=st,g=$.shared.interleaved,g!==null){$=g;do U|=$.lane,$=$.next;while($!==g)}else O===null&&($.shared.lanes=0);Hd|=U,h.lanes=U,h.memoizedState=at}}function c7(h,g,C){if(h=g.effects,g.effects=null,h!==null)for(g=0;g<h.length;g++){var E=h[g],$=E.callback;if($!==null){if(E.callback=null,E=C,typeof $!="function")throw Error(t(191,$));$.call(E)}}}var Im={},Tl=yu(Im),Tm=yu(Im),_m=yu(Im);function Wd(h){if(h===Im)throw Error(t(174));return h}function qw(h,g){switch(Rr(_m,g),Rr(Tm,h),Rr(Tl,Im),h=g.nodeType,h){case 9:case 11:g=(g=g.documentElement)?g.namespaceURI:Nt(null,"");break;default:h=h===8?g.parentNode:g,g=h.namespaceURI||null,h=h.tagName,g=Nt(g,h)}Pr(Tl),Rr(Tl,g)}function Eh(){Pr(Tl),Pr(Tm),Pr(_m)}function u7(h){Wd(_m.current);var g=Wd(Tl.current),C=Nt(g,h.type);g!==C&&(Rr(Tm,h),Rr(Tl,C))}function Kw(h){Tm.current===h&&(Pr(Tl),Pr(Tm))}var Hr=yu(0);function fx(h){for(var g=h;g!==null;){if(g.tag===13){var C=g.memoizedState;if(C!==null&&(C=C.dehydrated,C===null||C.data==="$?"||C.data==="$!"))return g}else if(g.tag===19&&g.memoizedProps.revealOrder!==void 0){if((g.flags&128)!==0)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===h)break;for(;g.sibling===null;){if(g.return===null||g.return===h)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var Xw=[];function Yw(){for(var h=0;h<Xw.length;h++)Xw[h]._workInProgressVersionPrimary=null;Xw.length=0}var hx=k.ReactCurrentDispatcher,Zw=k.ReactCurrentBatchConfig,Ud=0,Gr=null,Rs=null,Ks=null,px=!1,Rm=!1,Dm=0,oW=0;function So(){throw Error(t(321))}function Jw(h,g){if(g===null)return!1;for(var C=0;C<g.length&&C<h.length;C++)if(!Jr(h[C],g[C]))return!1;return!0}function Qw(h,g,C,E,$,O){if(Ud=O,Gr=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,hx.current=h===null||h.memoizedState===null?cW:uW,h=C(E,$),Rm){O=0;do{if(Rm=!1,Dm=0,25<=O)throw Error(t(301));O+=1,Ks=Rs=null,g.updateQueue=null,hx.current=dW,h=C(E,$)}while(Rm)}if(hx.current=xx,g=Rs!==null&&Rs.next!==null,Ud=0,Ks=Rs=Gr=null,px=!1,g)throw Error(t(300));return h}function e3(){var h=Dm!==0;return Dm=0,h}function _l(){var h={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ks===null?Gr.memoizedState=Ks=h:Ks=Ks.next=h,Ks}function xa(){if(Rs===null){var h=Gr.alternate;h=h!==null?h.memoizedState:null}else h=Rs.next;var g=Ks===null?Gr.memoizedState:Ks.next;if(g!==null)Ks=g,Rs=h;else{if(h===null)throw Error(t(310));Rs=h,h={memoizedState:Rs.memoizedState,baseState:Rs.baseState,baseQueue:Rs.baseQueue,queue:Rs.queue,next:null},Ks===null?Gr.memoizedState=Ks=h:Ks=Ks.next=h}return Ks}function Am(h,g){return typeof g=="function"?g(h):g}function t3(h){var g=xa(),C=g.queue;if(C===null)throw Error(t(311));C.lastRenderedReducer=h;var E=Rs,$=E.baseQueue,O=C.pending;if(O!==null){if($!==null){var U=$.next;$.next=O.next,O.next=U}E.baseQueue=$=O,C.pending=null}if($!==null){O=$.next,E=E.baseState;var ne=U=null,le=null,Fe=O;do{var st=Fe.lane;if((Ud&st)===st)le!==null&&(le=le.next={lane:0,action:Fe.action,hasEagerState:Fe.hasEagerState,eagerState:Fe.eagerState,next:null}),E=Fe.hasEagerState?Fe.eagerState:h(E,Fe.action);else{var at={lane:st,action:Fe.action,hasEagerState:Fe.hasEagerState,eagerState:Fe.eagerState,next:null};le===null?(ne=le=at,U=E):le=le.next=at,Gr.lanes|=st,Hd|=st}Fe=Fe.next}while(Fe!==null&&Fe!==O);le===null?U=E:le.next=ne,Jr(E,g.memoizedState)||(di=!0),g.memoizedState=E,g.baseState=U,g.baseQueue=le,C.lastRenderedState=E}if(h=C.interleaved,h!==null){$=h;do O=$.lane,Gr.lanes|=O,Hd|=O,$=$.next;while($!==h)}else $===null&&(C.lanes=0);return[g.memoizedState,C.dispatch]}function n3(h){var g=xa(),C=g.queue;if(C===null)throw Error(t(311));C.lastRenderedReducer=h;var E=C.dispatch,$=C.pending,O=g.memoizedState;if($!==null){C.pending=null;var U=$=$.next;do O=h(O,U.action),U=U.next;while(U!==$);Jr(O,g.memoizedState)||(di=!0),g.memoizedState=O,g.baseQueue===null&&(g.baseState=O),C.lastRenderedState=O}return[O,E]}function d7(){}function f7(h,g){var C=Gr,E=xa(),$=g(),O=!Jr(E.memoizedState,$);if(O&&(E.memoizedState=$,di=!0),E=E.queue,r3(m7.bind(null,C,E,h),[h]),E.getSnapshot!==g||O||Ks!==null&&Ks.memoizedState.tag&1){if(C.flags|=2048,$m(9,p7.bind(null,C,E,$,g),void 0,null),Xs===null)throw Error(t(349));(Ud&30)!==0||h7(C,g,$)}return $}function h7(h,g,C){h.flags|=16384,h={getSnapshot:g,value:C},g=Gr.updateQueue,g===null?(g={lastEffect:null,stores:null},Gr.updateQueue=g,g.stores=[h]):(C=g.stores,C===null?g.stores=[h]:C.push(h))}function p7(h,g,C,E){g.value=C,g.getSnapshot=E,g7(g)&&x7(h)}function m7(h,g,C){return C(function(){g7(g)&&x7(h)})}function g7(h){var g=h.getSnapshot;h=h.value;try{var C=g();return!Jr(h,C)}catch{return!0}}function x7(h){var g=Ec(h,1);g!==null&&Ha(g,h,1,-1)}function v7(h){var g=_l();return typeof h=="function"&&(h=h()),g.memoizedState=g.baseState=h,h={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Am,lastRenderedState:h},g.queue=h,h=h.dispatch=lW.bind(null,Gr,h),[g.memoizedState,h]}function $m(h,g,C,E){return h={tag:h,create:g,destroy:C,deps:E,next:null},g=Gr.updateQueue,g===null?(g={lastEffect:null,stores:null},Gr.updateQueue=g,g.lastEffect=h.next=h):(C=g.lastEffect,C===null?g.lastEffect=h.next=h:(E=C.next,C.next=h,h.next=E,g.lastEffect=h)),h}function y7(){return xa().memoizedState}function mx(h,g,C,E){var $=_l();Gr.flags|=h,$.memoizedState=$m(1|g,C,void 0,E===void 0?null:E)}function gx(h,g,C,E){var $=xa();E=E===void 0?null:E;var O=void 0;if(Rs!==null){var U=Rs.memoizedState;if(O=U.destroy,E!==null&&Jw(E,U.deps)){$.memoizedState=$m(g,C,O,E);return}}Gr.flags|=h,$.memoizedState=$m(1|g,C,O,E)}function b7(h,g){return mx(8390656,8,h,g)}function r3(h,g){return gx(2048,8,h,g)}function w7(h,g){return gx(4,2,h,g)}function C7(h,g){return gx(4,4,h,g)}function k7(h,g){if(typeof g=="function")return h=h(),g(h),function(){g(null)};if(g!=null)return h=h(),g.current=h,function(){g.current=null}}function S7(h,g,C){return C=C!=null?C.concat([h]):null,gx(4,4,k7.bind(null,g,h),C)}function s3(){}function N7(h,g){var C=xa();g=g===void 0?null:g;var E=C.memoizedState;return E!==null&&g!==null&&Jw(g,E[1])?E[0]:(C.memoizedState=[h,g],h)}function E7(h,g){var C=xa();g=g===void 0?null:g;var E=C.memoizedState;return E!==null&&g!==null&&Jw(g,E[1])?E[0]:(h=h(),C.memoizedState=[h,g],h)}function I7(h,g,C){return(Ud&21)===0?(h.baseState&&(h.baseState=!1,di=!0),h.memoizedState=C):(Jr(C,g)||(C=_d(),Gr.lanes|=C,Hd|=C,h.baseState=!0),g)}function iW(h,g){var C=rr;rr=C!==0&&4>C?C:4,h(!0);var E=Zw.transition;Zw.transition={};try{h(!1),g()}finally{rr=C,Zw.transition=E}}function T7(){return xa().memoizedState}function aW(h,g,C){var E=Iu(h);if(C={lane:E,action:C,hasEagerState:!1,eagerState:null,next:null},_7(h))R7(g,C);else if(C=i7(h,g,C,E),C!==null){var $=Ko();Ha(C,h,E,$),D7(C,g,E)}}function lW(h,g,C){var E=Iu(h),$={lane:E,action:C,hasEagerState:!1,eagerState:null,next:null};if(_7(h))R7(g,$);else{var O=h.alternate;if(h.lanes===0&&(O===null||O.lanes===0)&&(O=g.lastRenderedReducer,O!==null))try{var U=g.lastRenderedState,ne=O(U,C);if($.hasEagerState=!0,$.eagerState=ne,Jr(ne,U)){var le=g.interleaved;le===null?($.next=$,Hw(g)):($.next=le.next,le.next=$),g.interleaved=$;return}}catch{}finally{}C=i7(h,g,$,E),C!==null&&($=Ko(),Ha(C,h,E,$),D7(C,g,E))}}function _7(h){var g=h.alternate;return h===Gr||g!==null&&g===Gr}function R7(h,g){Rm=px=!0;var C=h.pending;C===null?g.next=g:(g.next=C.next,C.next=g),h.pending=g}function D7(h,g,C){if((C&4194240)!==0){var E=g.lanes;E&=h.pendingLanes,C|=E,g.lanes=C,fm(h,C)}}var xx={readContext:ga,useCallback:So,useContext:So,useEffect:So,useImperativeHandle:So,useInsertionEffect:So,useLayoutEffect:So,useMemo:So,useReducer:So,useRef:So,useState:So,useDebugValue:So,useDeferredValue:So,useTransition:So,useMutableSource:So,useSyncExternalStore:So,useId:So,unstable_isNewReconciler:!1},cW={readContext:ga,useCallback:function(h,g){return _l().memoizedState=[h,g===void 0?null:g],h},useContext:ga,useEffect:b7,useImperativeHandle:function(h,g,C){return C=C!=null?C.concat([h]):null,mx(4194308,4,k7.bind(null,g,h),C)},useLayoutEffect:function(h,g){return mx(4194308,4,h,g)},useInsertionEffect:function(h,g){return mx(4,2,h,g)},useMemo:function(h,g){var C=_l();return g=g===void 0?null:g,h=h(),C.memoizedState=[h,g],h},useReducer:function(h,g,C){var E=_l();return g=C!==void 0?C(g):g,E.memoizedState=E.baseState=g,h={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:h,lastRenderedState:g},E.queue=h,h=h.dispatch=aW.bind(null,Gr,h),[E.memoizedState,h]},useRef:function(h){var g=_l();return h={current:h},g.memoizedState=h},useState:v7,useDebugValue:s3,useDeferredValue:function(h){return _l().memoizedState=h},useTransition:function(){var h=v7(!1),g=h[0];return h=iW.bind(null,h[1]),_l().memoizedState=h,[g,h]},useMutableSource:function(){},useSyncExternalStore:function(h,g,C){var E=Gr,$=_l();if(Br){if(C===void 0)throw Error(t(407));C=C()}else{if(C=g(),Xs===null)throw Error(t(349));(Ud&30)!==0||h7(E,g,C)}$.memoizedState=C;var O={value:C,getSnapshot:g};return $.queue=O,b7(m7.bind(null,E,O,h),[h]),E.flags|=2048,$m(9,p7.bind(null,E,O,C,g),void 0,null),C},useId:function(){var h=_l(),g=Xs.identifierPrefix;if(Br){var C=Nc,E=Sc;C=(E&~(1<<32-Wn(E)-1)).toString(32)+C,g=":"+g+"R"+C,C=Dm++,0<C&&(g+="H"+C.toString(32)),g+=":"}else C=oW++,g=":"+g+"r"+C.toString(32)+":";return h.memoizedState=g},unstable_isNewReconciler:!1},uW={readContext:ga,useCallback:N7,useContext:ga,useEffect:r3,useImperativeHandle:S7,useInsertionEffect:w7,useLayoutEffect:C7,useMemo:E7,useReducer:t3,useRef:y7,useState:function(){return t3(Am)},useDebugValue:s3,useDeferredValue:function(h){var g=xa();return I7(g,Rs.memoizedState,h)},useTransition:function(){var h=t3(Am)[0],g=xa().memoizedState;return[h,g]},useMutableSource:d7,useSyncExternalStore:f7,useId:T7,unstable_isNewReconciler:!1},dW={readContext:ga,useCallback:N7,useContext:ga,useEffect:r3,useImperativeHandle:S7,useInsertionEffect:w7,useLayoutEffect:C7,useMemo:E7,useReducer:n3,useRef:y7,useState:function(){return n3(Am)},useDebugValue:s3,useDeferredValue:function(h){var g=xa();return Rs===null?g.memoizedState=h:I7(g,Rs.memoizedState,h)},useTransition:function(){var h=n3(Am)[0],g=xa().memoizedState;return[h,g]},useMutableSource:d7,useSyncExternalStore:f7,useId:T7,unstable_isNewReconciler:!1};function za(h,g){if(h&&h.defaultProps){g=z({},g),h=h.defaultProps;for(var C in h)g[C]===void 0&&(g[C]=h[C]);return g}return g}function o3(h,g,C,E){g=h.memoizedState,C=C(E,g),C=C==null?g:z({},g,C),h.memoizedState=C,h.lanes===0&&(h.updateQueue.baseState=C)}var vx={isMounted:function(h){return(h=h._reactInternals)?Xe(h)===h:!1},enqueueSetState:function(h,g,C){h=h._reactInternals;var E=Ko(),$=Iu(h),O=Ic(E,$);O.payload=g,C!=null&&(O.callback=C),g=ku(h,O,$),g!==null&&(Ha(g,h,$,E),ux(g,h,$))},enqueueReplaceState:function(h,g,C){h=h._reactInternals;var E=Ko(),$=Iu(h),O=Ic(E,$);O.tag=1,O.payload=g,C!=null&&(O.callback=C),g=ku(h,O,$),g!==null&&(Ha(g,h,$,E),ux(g,h,$))},enqueueForceUpdate:function(h,g){h=h._reactInternals;var C=Ko(),E=Iu(h),$=Ic(C,E);$.tag=2,g!=null&&($.callback=g),g=ku(h,$,E),g!==null&&(Ha(g,h,E,C),ux(g,h,E))}};function A7(h,g,C,E,$,O,U){return h=h.stateNode,typeof h.shouldComponentUpdate=="function"?h.shouldComponentUpdate(E,O,U):g.prototype&&g.prototype.isPureReactComponent?!li(C,E)||!li($,O):!0}function $7(h,g,C){var E=!1,$=bu,O=g.contextType;return typeof O=="object"&&O!==null?O=ga(O):($=ui(g)?jd:ko.current,E=g.contextTypes,O=(E=E!=null)?yh(h,$):bu),g=new g(C,O),h.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=vx,h.stateNode=g,g._reactInternals=h,E&&(h=h.stateNode,h.__reactInternalMemoizedUnmaskedChildContext=$,h.__reactInternalMemoizedMaskedChildContext=O),g}function F7(h,g,C,E){h=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(C,E),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(C,E),g.state!==h&&vx.enqueueReplaceState(g,g.state,null)}function i3(h,g,C,E){var $=h.stateNode;$.props=C,$.state=h.memoizedState,$.refs={},Gw(h);var O=g.contextType;typeof O=="object"&&O!==null?$.context=ga(O):(O=ui(g)?jd:ko.current,$.context=yh(h,O)),$.state=h.memoizedState,O=g.getDerivedStateFromProps,typeof O=="function"&&(o3(h,g,O,C),$.state=h.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof $.getSnapshotBeforeUpdate=="function"||typeof $.UNSAFE_componentWillMount!="function"&&typeof $.componentWillMount!="function"||(g=$.state,typeof $.componentWillMount=="function"&&$.componentWillMount(),typeof $.UNSAFE_componentWillMount=="function"&&$.UNSAFE_componentWillMount(),g!==$.state&&vx.enqueueReplaceState($,$.state,null),dx(h,C,$,E),$.state=h.memoizedState),typeof $.componentDidMount=="function"&&(h.flags|=4194308)}function Ih(h,g){try{var C="",E=g;do C+=Z(E),E=E.return;while(E);var $=C}catch(O){$=`
Error generating stack: `+O.message+`
`+O.stack}return{value:h,source:g,stack:$,digest:null}}function a3(h,g,C){return{value:h,source:null,stack:C??null,digest:g??null}}function l3(h,g){try{console.error(g.value)}catch(C){setTimeout(function(){throw C})}}var fW=typeof WeakMap=="function"?WeakMap:Map;function P7(h,g,C){C=Ic(-1,C),C.tag=3,C.payload={element:null};var E=g.value;return C.callback=function(){Nx||(Nx=!0,k3=E),l3(h,g)},C}function O7(h,g,C){C=Ic(-1,C),C.tag=3;var E=h.type.getDerivedStateFromError;if(typeof E=="function"){var $=g.value;C.payload=function(){return E($)},C.callback=function(){l3(h,g)}}var O=h.stateNode;return O!==null&&typeof O.componentDidCatch=="function"&&(C.callback=function(){l3(h,g),typeof E!="function"&&(Nu===null?Nu=new Set([this]):Nu.add(this));var U=g.stack;this.componentDidCatch(g.value,{componentStack:U!==null?U:""})}),C}function M7(h,g,C){var E=h.pingCache;if(E===null){E=h.pingCache=new fW;var $=new Set;E.set(g,$)}else $=E.get(g),$===void 0&&($=new Set,E.set(g,$));$.has(C)||($.add(C),h=EW.bind(null,h,g,C),g.then(h,h))}function L7(h){do{var g;if((g=h.tag===13)&&(g=h.memoizedState,g=g!==null?g.dehydrated!==null:!0),g)return h;h=h.return}while(h!==null);return null}function j7(h,g,C,E,$){return(h.mode&1)===0?(h===g?h.flags|=65536:(h.flags|=128,C.flags|=131072,C.flags&=-52805,C.tag===1&&(C.alternate===null?C.tag=17:(g=Ic(-1,1),g.tag=2,ku(C,g,1))),C.lanes|=1),h):(h.flags|=65536,h.lanes=$,h)}var hW=k.ReactCurrentOwner,di=!1;function qo(h,g,C,E){g.child=h===null?o7(g,null,C,E):kh(g,h.child,C,E)}function B7(h,g,C,E,$){C=C.render;var O=g.ref;return Nh(g,$),E=Qw(h,g,C,E,O,$),C=e3(),h!==null&&!di?(g.updateQueue=h.updateQueue,g.flags&=-2053,h.lanes&=~$,Tc(h,g,$)):(Br&&C&&Ow(g),g.flags|=1,qo(h,g,E,$),g.child)}function V7(h,g,C,E,$){if(h===null){var O=C.type;return typeof O=="function"&&!R3(O)&&O.defaultProps===void 0&&C.compare===null&&C.defaultProps===void 0?(g.tag=15,g.type=O,z7(h,g,O,E,$)):(h=Dx(C.type,null,E,g,g.mode,$),h.ref=g.ref,h.return=g,g.child=h)}if(O=h.child,(h.lanes&$)===0){var U=O.memoizedProps;if(C=C.compare,C=C!==null?C:li,C(U,E)&&h.ref===g.ref)return Tc(h,g,$)}return g.flags|=1,h=_u(O,E),h.ref=g.ref,h.return=g,g.child=h}function z7(h,g,C,E,$){if(h!==null){var O=h.memoizedProps;if(li(O,E)&&h.ref===g.ref)if(di=!1,g.pendingProps=E=O,(h.lanes&$)!==0)(h.flags&131072)!==0&&(di=!0);else return g.lanes=h.lanes,Tc(h,g,$)}return c3(h,g,C,E,$)}function W7(h,g,C){var E=g.pendingProps,$=E.children,O=h!==null?h.memoizedState:null;if(E.mode==="hidden")if((g.mode&1)===0)g.memoizedState={baseLanes:0,cachePool:null,transitions:null},Rr(_h,Bi),Bi|=C;else{if((C&1073741824)===0)return h=O!==null?O.baseLanes|C:C,g.lanes=g.childLanes=1073741824,g.memoizedState={baseLanes:h,cachePool:null,transitions:null},g.updateQueue=null,Rr(_h,Bi),Bi|=h,null;g.memoizedState={baseLanes:0,cachePool:null,transitions:null},E=O!==null?O.baseLanes:C,Rr(_h,Bi),Bi|=E}else O!==null?(E=O.baseLanes|C,g.memoizedState=null):E=C,Rr(_h,Bi),Bi|=E;return qo(h,g,$,C),g.child}function U7(h,g){var C=g.ref;(h===null&&C!==null||h!==null&&h.ref!==C)&&(g.flags|=512,g.flags|=2097152)}function c3(h,g,C,E,$){var O=ui(C)?jd:ko.current;return O=yh(g,O),Nh(g,$),C=Qw(h,g,C,E,O,$),E=e3(),h!==null&&!di?(g.updateQueue=h.updateQueue,g.flags&=-2053,h.lanes&=~$,Tc(h,g,$)):(Br&&E&&Ow(g),g.flags|=1,qo(h,g,C,$),g.child)}function H7(h,g,C,E,$){if(ui(C)){var O=!0;nx(g)}else O=!1;if(Nh(g,$),g.stateNode===null)bx(h,g),$7(g,C,E),i3(g,C,E,$),E=!0;else if(h===null){var U=g.stateNode,ne=g.memoizedProps;U.props=ne;var le=U.context,Fe=C.contextType;typeof Fe=="object"&&Fe!==null?Fe=ga(Fe):(Fe=ui(C)?jd:ko.current,Fe=yh(g,Fe));var st=C.getDerivedStateFromProps,at=typeof st=="function"||typeof U.getSnapshotBeforeUpdate=="function";at||typeof U.UNSAFE_componentWillReceiveProps!="function"&&typeof U.componentWillReceiveProps!="function"||(ne!==E||le!==Fe)&&F7(g,U,E,Fe),Cu=!1;var nt=g.memoizedState;U.state=nt,dx(g,E,U,$),le=g.memoizedState,ne!==E||nt!==le||ci.current||Cu?(typeof st=="function"&&(o3(g,C,st,E),le=g.memoizedState),(ne=Cu||A7(g,C,ne,E,nt,le,Fe))?(at||typeof U.UNSAFE_componentWillMount!="function"&&typeof U.componentWillMount!="function"||(typeof U.componentWillMount=="function"&&U.componentWillMount(),typeof U.UNSAFE_componentWillMount=="function"&&U.UNSAFE_componentWillMount()),typeof U.componentDidMount=="function"&&(g.flags|=4194308)):(typeof U.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=E,g.memoizedState=le),U.props=E,U.state=le,U.context=Fe,E=ne):(typeof U.componentDidMount=="function"&&(g.flags|=4194308),E=!1)}else{U=g.stateNode,a7(h,g),ne=g.memoizedProps,Fe=g.type===g.elementType?ne:za(g.type,ne),U.props=Fe,at=g.pendingProps,nt=U.context,le=C.contextType,typeof le=="object"&&le!==null?le=ga(le):(le=ui(C)?jd:ko.current,le=yh(g,le));var Dt=C.getDerivedStateFromProps;(st=typeof Dt=="function"||typeof U.getSnapshotBeforeUpdate=="function")||typeof U.UNSAFE_componentWillReceiveProps!="function"&&typeof U.componentWillReceiveProps!="function"||(ne!==at||nt!==le)&&F7(g,U,E,le),Cu=!1,nt=g.memoizedState,U.state=nt,dx(g,E,U,$);var Bt=g.memoizedState;ne!==at||nt!==Bt||ci.current||Cu?(typeof Dt=="function"&&(o3(g,C,Dt,E),Bt=g.memoizedState),(Fe=Cu||A7(g,C,Fe,E,nt,Bt,le)||!1)?(st||typeof U.UNSAFE_componentWillUpdate!="function"&&typeof U.componentWillUpdate!="function"||(typeof U.componentWillUpdate=="function"&&U.componentWillUpdate(E,Bt,le),typeof U.UNSAFE_componentWillUpdate=="function"&&U.UNSAFE_componentWillUpdate(E,Bt,le)),typeof U.componentDidUpdate=="function"&&(g.flags|=4),typeof U.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof U.componentDidUpdate!="function"||ne===h.memoizedProps&&nt===h.memoizedState||(g.flags|=4),typeof U.getSnapshotBeforeUpdate!="function"||ne===h.memoizedProps&&nt===h.memoizedState||(g.flags|=1024),g.memoizedProps=E,g.memoizedState=Bt),U.props=E,U.state=Bt,U.context=le,E=Fe):(typeof U.componentDidUpdate!="function"||ne===h.memoizedProps&&nt===h.memoizedState||(g.flags|=4),typeof U.getSnapshotBeforeUpdate!="function"||ne===h.memoizedProps&&nt===h.memoizedState||(g.flags|=1024),E=!1)}return u3(h,g,C,E,O,$)}function u3(h,g,C,E,$,O){U7(h,g);var U=(g.flags&128)!==0;if(!E&&!U)return $&&YN(g,C,!1),Tc(h,g,O);E=g.stateNode,hW.current=g;var ne=U&&typeof C.getDerivedStateFromError!="function"?null:E.render();return g.flags|=1,h!==null&&U?(g.child=kh(g,h.child,null,O),g.child=kh(g,null,ne,O)):qo(h,g,ne,O),g.memoizedState=E.state,$&&YN(g,C,!0),g.child}function G7(h){var g=h.stateNode;g.pendingContext?KN(h,g.pendingContext,g.pendingContext!==g.context):g.context&&KN(h,g.context,!1),qw(h,g.containerInfo)}function q7(h,g,C,E,$){return Ch(),Bw($),g.flags|=256,qo(h,g,C,E),g.child}var d3={dehydrated:null,treeContext:null,retryLane:0};function f3(h){return{baseLanes:h,cachePool:null,transitions:null}}function K7(h,g,C){var E=g.pendingProps,$=Hr.current,O=!1,U=(g.flags&128)!==0,ne;if((ne=U)||(ne=h!==null&&h.memoizedState===null?!1:($&2)!==0),ne?(O=!0,g.flags&=-129):(h===null||h.memoizedState!==null)&&($|=1),Rr(Hr,$&1),h===null)return jw(g),h=g.memoizedState,h!==null&&(h=h.dehydrated,h!==null)?((g.mode&1)===0?g.lanes=1:h.data==="$!"?g.lanes=8:g.lanes=1073741824,null):(U=E.children,h=E.fallback,O?(E=g.mode,O=g.child,U={mode:"hidden",children:U},(E&1)===0&&O!==null?(O.childLanes=0,O.pendingProps=U):O=Ax(U,E,0,null),h=Xd(h,E,C,null),O.return=g,h.return=g,O.sibling=h,g.child=O,g.child.memoizedState=f3(C),g.memoizedState=d3,h):h3(g,U));if($=h.memoizedState,$!==null&&(ne=$.dehydrated,ne!==null))return pW(h,g,U,E,ne,$,C);if(O){O=E.fallback,U=g.mode,$=h.child,ne=$.sibling;var le={mode:"hidden",children:E.children};return(U&1)===0&&g.child!==$?(E=g.child,E.childLanes=0,E.pendingProps=le,g.deletions=null):(E=_u($,le),E.subtreeFlags=$.subtreeFlags&14680064),ne!==null?O=_u(ne,O):(O=Xd(O,U,C,null),O.flags|=2),O.return=g,E.return=g,E.sibling=O,g.child=E,E=O,O=g.child,U=h.child.memoizedState,U=U===null?f3(C):{baseLanes:U.baseLanes|C,cachePool:null,transitions:U.transitions},O.memoizedState=U,O.childLanes=h.childLanes&~C,g.memoizedState=d3,E}return O=h.child,h=O.sibling,E=_u(O,{mode:"visible",children:E.children}),(g.mode&1)===0&&(E.lanes=C),E.return=g,E.sibling=null,h!==null&&(C=g.deletions,C===null?(g.deletions=[h],g.flags|=16):C.push(h)),g.child=E,g.memoizedState=null,E}function h3(h,g){return g=Ax({mode:"visible",children:g},h.mode,0,null),g.return=h,h.child=g}function yx(h,g,C,E){return E!==null&&Bw(E),kh(g,h.child,null,C),h=h3(g,g.pendingProps.children),h.flags|=2,g.memoizedState=null,h}function pW(h,g,C,E,$,O,U){if(C)return g.flags&256?(g.flags&=-257,E=a3(Error(t(422))),yx(h,g,U,E)):g.memoizedState!==null?(g.child=h.child,g.flags|=128,null):(O=E.fallback,$=g.mode,E=Ax({mode:"visible",children:E.children},$,0,null),O=Xd(O,$,U,null),O.flags|=2,E.return=g,O.return=g,E.sibling=O,g.child=E,(g.mode&1)!==0&&kh(g,h.child,null,U),g.child.memoizedState=f3(U),g.memoizedState=d3,O);if((g.mode&1)===0)return yx(h,g,U,null);if($.data==="$!"){if(E=$.nextSibling&&$.nextSibling.dataset,E)var ne=E.dgst;return E=ne,O=Error(t(419)),E=a3(O,E,void 0),yx(h,g,U,E)}if(ne=(U&h.childLanes)!==0,di||ne){if(E=Xs,E!==null){switch(U&-U){case 4:$=2;break;case 16:$=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:$=32;break;case 536870912:$=268435456;break;default:$=0}$=($&(E.suspendedLanes|U))!==0?0:$,$!==0&&$!==O.retryLane&&(O.retryLane=$,Ec(h,$),Ha(E,h,$,-1))}return _3(),E=a3(Error(t(421))),yx(h,g,U,E)}return $.data==="$?"?(g.flags|=128,g.child=h.child,g=IW.bind(null,h),$._reactRetry=g,null):(h=O.treeContext,ji=vu($.nextSibling),Li=g,Br=!0,Va=null,h!==null&&(pa[ma++]=Sc,pa[ma++]=Nc,pa[ma++]=Bd,Sc=h.id,Nc=h.overflow,Bd=g),g=h3(g,E.children),g.flags|=4096,g)}function X7(h,g,C){h.lanes|=g;var E=h.alternate;E!==null&&(E.lanes|=g),Uw(h.return,g,C)}function p3(h,g,C,E,$){var O=h.memoizedState;O===null?h.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:E,tail:C,tailMode:$}:(O.isBackwards=g,O.rendering=null,O.renderingStartTime=0,O.last=E,O.tail=C,O.tailMode=$)}function Y7(h,g,C){var E=g.pendingProps,$=E.revealOrder,O=E.tail;if(qo(h,g,E.children,C),E=Hr.current,(E&2)!==0)E=E&1|2,g.flags|=128;else{if(h!==null&&(h.flags&128)!==0)e:for(h=g.child;h!==null;){if(h.tag===13)h.memoizedState!==null&&X7(h,C,g);else if(h.tag===19)X7(h,C,g);else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===g)break e;for(;h.sibling===null;){if(h.return===null||h.return===g)break e;h=h.return}h.sibling.return=h.return,h=h.sibling}E&=1}if(Rr(Hr,E),(g.mode&1)===0)g.memoizedState=null;else switch($){case"forwards":for(C=g.child,$=null;C!==null;)h=C.alternate,h!==null&&fx(h)===null&&($=C),C=C.sibling;C=$,C===null?($=g.child,g.child=null):($=C.sibling,C.sibling=null),p3(g,!1,$,C,O);break;case"backwards":for(C=null,$=g.child,g.child=null;$!==null;){if(h=$.alternate,h!==null&&fx(h)===null){g.child=$;break}h=$.sibling,$.sibling=C,C=$,$=h}p3(g,!0,C,null,O);break;case"together":p3(g,!1,null,null,void 0);break;default:g.memoizedState=null}return g.child}function bx(h,g){(g.mode&1)===0&&h!==null&&(h.alternate=null,g.alternate=null,g.flags|=2)}function Tc(h,g,C){if(h!==null&&(g.dependencies=h.dependencies),Hd|=g.lanes,(C&g.childLanes)===0)return null;if(h!==null&&g.child!==h.child)throw Error(t(153));if(g.child!==null){for(h=g.child,C=_u(h,h.pendingProps),g.child=C,C.return=g;h.sibling!==null;)h=h.sibling,C=C.sibling=_u(h,h.pendingProps),C.return=g;C.sibling=null}return g.child}function mW(h,g,C){switch(g.tag){case 3:G7(g),Ch();break;case 5:u7(g);break;case 1:ui(g.type)&&nx(g);break;case 4:qw(g,g.stateNode.containerInfo);break;case 10:var E=g.type._context,$=g.memoizedProps.value;Rr(lx,E._currentValue),E._currentValue=$;break;case 13:if(E=g.memoizedState,E!==null)return E.dehydrated!==null?(Rr(Hr,Hr.current&1),g.flags|=128,null):(C&g.child.childLanes)!==0?K7(h,g,C):(Rr(Hr,Hr.current&1),h=Tc(h,g,C),h!==null?h.sibling:null);Rr(Hr,Hr.current&1);break;case 19:if(E=(C&g.childLanes)!==0,(h.flags&128)!==0){if(E)return Y7(h,g,C);g.flags|=128}if($=g.memoizedState,$!==null&&($.rendering=null,$.tail=null,$.lastEffect=null),Rr(Hr,Hr.current),E)break;return null;case 22:case 23:return g.lanes=0,W7(h,g,C)}return Tc(h,g,C)}var Z7,m3,J7,Q7;Z7=function(h,g){for(var C=g.child;C!==null;){if(C.tag===5||C.tag===6)h.appendChild(C.stateNode);else if(C.tag!==4&&C.child!==null){C.child.return=C,C=C.child;continue}if(C===g)break;for(;C.sibling===null;){if(C.return===null||C.return===g)return;C=C.return}C.sibling.return=C.return,C=C.sibling}},m3=function(){},J7=function(h,g,C,E){var $=h.memoizedProps;if($!==E){h=g.stateNode,Wd(Tl.current);var O=null;switch(C){case"input":$=Ct(h,$),E=Ct(h,E),O=[];break;case"select":$=z({},$,{value:void 0}),E=z({},E,{value:void 0}),O=[];break;case"textarea":$=ke(h,$),E=ke(h,E),O=[];break;default:typeof $.onClick!="function"&&typeof E.onClick=="function"&&(h.onclick=Q0)}Yt(C,E);var U;C=null;for(Fe in $)if(!E.hasOwnProperty(Fe)&&$.hasOwnProperty(Fe)&&$[Fe]!=null)if(Fe==="style"){var ne=$[Fe];for(U in ne)ne.hasOwnProperty(U)&&(C||(C={}),C[U]="")}else Fe!=="dangerouslySetInnerHTML"&&Fe!=="children"&&Fe!=="suppressContentEditableWarning"&&Fe!=="suppressHydrationWarning"&&Fe!=="autoFocus"&&(s.hasOwnProperty(Fe)?O||(O=[]):(O=O||[]).push(Fe,null));for(Fe in E){var le=E[Fe];if(ne=$?.[Fe],E.hasOwnProperty(Fe)&&le!==ne&&(le!=null||ne!=null))if(Fe==="style")if(ne){for(U in ne)!ne.hasOwnProperty(U)||le&&le.hasOwnProperty(U)||(C||(C={}),C[U]="");for(U in le)le.hasOwnProperty(U)&&ne[U]!==le[U]&&(C||(C={}),C[U]=le[U])}else C||(O||(O=[]),O.push(Fe,C)),C=le;else Fe==="dangerouslySetInnerHTML"?(le=le?le.__html:void 0,ne=ne?ne.__html:void 0,le!=null&&ne!==le&&(O=O||[]).push(Fe,le)):Fe==="children"?typeof le!="string"&&typeof le!="number"||(O=O||[]).push(Fe,""+le):Fe!=="suppressContentEditableWarning"&&Fe!=="suppressHydrationWarning"&&(s.hasOwnProperty(Fe)?(le!=null&&Fe==="onScroll"&&Fr("scroll",h),O||ne===le||(O=[])):(O=O||[]).push(Fe,le))}C&&(O=O||[]).push("style",C);var Fe=O;(g.updateQueue=Fe)&&(g.flags|=4)}},Q7=function(h,g,C,E){C!==E&&(g.flags|=4)};function Fm(h,g){if(!Br)switch(h.tailMode){case"hidden":g=h.tail;for(var C=null;g!==null;)g.alternate!==null&&(C=g),g=g.sibling;C===null?h.tail=null:C.sibling=null;break;case"collapsed":C=h.tail;for(var E=null;C!==null;)C.alternate!==null&&(E=C),C=C.sibling;E===null?g||h.tail===null?h.tail=null:h.tail.sibling=null:E.sibling=null}}function No(h){var g=h.alternate!==null&&h.alternate.child===h.child,C=0,E=0;if(g)for(var $=h.child;$!==null;)C|=$.lanes|$.childLanes,E|=$.subtreeFlags&14680064,E|=$.flags&14680064,$.return=h,$=$.sibling;else for($=h.child;$!==null;)C|=$.lanes|$.childLanes,E|=$.subtreeFlags,E|=$.flags,$.return=h,$=$.sibling;return h.subtreeFlags|=E,h.childLanes=C,g}function gW(h,g,C){var E=g.pendingProps;switch(Mw(g),g.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return No(g),null;case 1:return ui(g.type)&&tx(),No(g),null;case 3:return E=g.stateNode,Eh(),Pr(ci),Pr(ko),Yw(),E.pendingContext&&(E.context=E.pendingContext,E.pendingContext=null),(h===null||h.child===null)&&(ix(g)?g.flags|=4:h===null||h.memoizedState.isDehydrated&&(g.flags&256)===0||(g.flags|=1024,Va!==null&&(E3(Va),Va=null))),m3(h,g),No(g),null;case 5:Kw(g);var $=Wd(_m.current);if(C=g.type,h!==null&&g.stateNode!=null)J7(h,g,C,E,$),h.ref!==g.ref&&(g.flags|=512,g.flags|=2097152);else{if(!E){if(g.stateNode===null)throw Error(t(166));return No(g),null}if(h=Wd(Tl.current),ix(g)){E=g.stateNode,C=g.type;var O=g.memoizedProps;switch(E[Il]=g,E[Sm]=O,h=(g.mode&1)!==0,C){case"dialog":Fr("cancel",E),Fr("close",E);break;case"iframe":case"object":case"embed":Fr("load",E);break;case"video":case"audio":for($=0;$<wm.length;$++)Fr(wm[$],E);break;case"source":Fr("error",E);break;case"img":case"image":case"link":Fr("error",E),Fr("load",E);break;case"details":Fr("toggle",E);break;case"input":lt(E,O),Fr("invalid",E);break;case"select":E._wrapperState={wasMultiple:!!O.multiple},Fr("invalid",E);break;case"textarea":He(E,O),Fr("invalid",E)}Yt(C,O),$=null;for(var U in O)if(O.hasOwnProperty(U)){var ne=O[U];U==="children"?typeof ne=="string"?E.textContent!==ne&&(O.suppressHydrationWarning!==!0&&J0(E.textContent,ne,h),$=["children",ne]):typeof ne=="number"&&E.textContent!==""+ne&&(O.suppressHydrationWarning!==!0&&J0(E.textContent,ne,h),$=["children",""+ne]):s.hasOwnProperty(U)&&ne!=null&&U==="onScroll"&&Fr("scroll",E)}switch(C){case"input":et(E),Ft(E,O,!0);break;case"textarea":et(E),Be(E);break;case"select":case"option":break;default:typeof O.onClick=="function"&&(E.onclick=Q0)}E=$,g.updateQueue=E,E!==null&&(g.flags|=4)}else{U=$.nodeType===9?$:$.ownerDocument,h==="http://www.w3.org/1999/xhtml"&&(h=ct(C)),h==="http://www.w3.org/1999/xhtml"?C==="script"?(h=U.createElement("div"),h.innerHTML="<script><\/script>",h=h.removeChild(h.firstChild)):typeof E.is=="string"?h=U.createElement(C,{is:E.is}):(h=U.createElement(C),C==="select"&&(U=h,E.multiple?U.multiple=!0:E.size&&(U.size=E.size))):h=U.createElementNS(h,C),h[Il]=g,h[Sm]=E,Z7(h,g,!1,!1),g.stateNode=h;e:{switch(U=cn(C,E),C){case"dialog":Fr("cancel",h),Fr("close",h),$=E;break;case"iframe":case"object":case"embed":Fr("load",h),$=E;break;case"video":case"audio":for($=0;$<wm.length;$++)Fr(wm[$],h);$=E;break;case"source":Fr("error",h),$=E;break;case"img":case"image":case"link":Fr("error",h),Fr("load",h),$=E;break;case"details":Fr("toggle",h),$=E;break;case"input":lt(h,E),$=Ct(h,E),Fr("invalid",h);break;case"option":$=E;break;case"select":h._wrapperState={wasMultiple:!!E.multiple},$=z({},E,{value:void 0}),Fr("invalid",h);break;case"textarea":He(h,E),$=ke(h,E),Fr("invalid",h);break;default:$=E}Yt(C,$),ne=$;for(O in ne)if(ne.hasOwnProperty(O)){var le=ne[O];O==="style"?ht(h,le):O==="dangerouslySetInnerHTML"?(le=le?le.__html:void 0,le!=null&&sn(h,le)):O==="children"?typeof le=="string"?(C!=="textarea"||le!=="")&&Kn(h,le):typeof le=="number"&&Kn(h,""+le):O!=="suppressContentEditableWarning"&&O!=="suppressHydrationWarning"&&O!=="autoFocus"&&(s.hasOwnProperty(O)?le!=null&&O==="onScroll"&&Fr("scroll",h):le!=null&&S(h,O,le,U))}switch(C){case"input":et(h),Ft(h,E,!1);break;case"textarea":et(h),Be(h);break;case"option":E.value!=null&&h.setAttribute("value",""+Ce(E.value));break;case"select":h.multiple=!!E.multiple,O=E.value,O!=null?q(h,!!E.multiple,O,!1):E.defaultValue!=null&&q(h,!!E.multiple,E.defaultValue,!0);break;default:typeof $.onClick=="function"&&(h.onclick=Q0)}switch(C){case"button":case"input":case"select":case"textarea":E=!!E.autoFocus;break e;case"img":E=!0;break e;default:E=!1}}E&&(g.flags|=4)}g.ref!==null&&(g.flags|=512,g.flags|=2097152)}return No(g),null;case 6:if(h&&g.stateNode!=null)Q7(h,g,h.memoizedProps,E);else{if(typeof E!="string"&&g.stateNode===null)throw Error(t(166));if(C=Wd(_m.current),Wd(Tl.current),ix(g)){if(E=g.stateNode,C=g.memoizedProps,E[Il]=g,(O=E.nodeValue!==C)&&(h=Li,h!==null))switch(h.tag){case 3:J0(E.nodeValue,C,(h.mode&1)!==0);break;case 5:h.memoizedProps.suppressHydrationWarning!==!0&&J0(E.nodeValue,C,(h.mode&1)!==0)}O&&(g.flags|=4)}else E=(C.nodeType===9?C:C.ownerDocument).createTextNode(E),E[Il]=g,g.stateNode=E}return No(g),null;case 13:if(Pr(Hr),E=g.memoizedState,h===null||h.memoizedState!==null&&h.memoizedState.dehydrated!==null){if(Br&&ji!==null&&(g.mode&1)!==0&&(g.flags&128)===0)n7(),Ch(),g.flags|=98560,O=!1;else if(O=ix(g),E!==null&&E.dehydrated!==null){if(h===null){if(!O)throw Error(t(318));if(O=g.memoizedState,O=O!==null?O.dehydrated:null,!O)throw Error(t(317));O[Il]=g}else Ch(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;No(g),O=!1}else Va!==null&&(E3(Va),Va=null),O=!0;if(!O)return g.flags&65536?g:null}return(g.flags&128)!==0?(g.lanes=C,g):(E=E!==null,E!==(h!==null&&h.memoizedState!==null)&&E&&(g.child.flags|=8192,(g.mode&1)!==0&&(h===null||(Hr.current&1)!==0?Ds===0&&(Ds=3):_3())),g.updateQueue!==null&&(g.flags|=4),No(g),null);case 4:return Eh(),m3(h,g),h===null&&Cm(g.stateNode.containerInfo),No(g),null;case 10:return Ww(g.type._context),No(g),null;case 17:return ui(g.type)&&tx(),No(g),null;case 19:if(Pr(Hr),O=g.memoizedState,O===null)return No(g),null;if(E=(g.flags&128)!==0,U=O.rendering,U===null)if(E)Fm(O,!1);else{if(Ds!==0||h!==null&&(h.flags&128)!==0)for(h=g.child;h!==null;){if(U=fx(h),U!==null){for(g.flags|=128,Fm(O,!1),E=U.updateQueue,E!==null&&(g.updateQueue=E,g.flags|=4),g.subtreeFlags=0,E=C,C=g.child;C!==null;)O=C,h=E,O.flags&=14680066,U=O.alternate,U===null?(O.childLanes=0,O.lanes=h,O.child=null,O.subtreeFlags=0,O.memoizedProps=null,O.memoizedState=null,O.updateQueue=null,O.dependencies=null,O.stateNode=null):(O.childLanes=U.childLanes,O.lanes=U.lanes,O.child=U.child,O.subtreeFlags=0,O.deletions=null,O.memoizedProps=U.memoizedProps,O.memoizedState=U.memoizedState,O.updateQueue=U.updateQueue,O.type=U.type,h=U.dependencies,O.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext}),C=C.sibling;return Rr(Hr,Hr.current&1|2),g.child}h=h.sibling}O.tail!==null&&Ie()>Rh&&(g.flags|=128,E=!0,Fm(O,!1),g.lanes=4194304)}else{if(!E)if(h=fx(U),h!==null){if(g.flags|=128,E=!0,C=h.updateQueue,C!==null&&(g.updateQueue=C,g.flags|=4),Fm(O,!0),O.tail===null&&O.tailMode==="hidden"&&!U.alternate&&!Br)return No(g),null}else 2*Ie()-O.renderingStartTime>Rh&&C!==1073741824&&(g.flags|=128,E=!0,Fm(O,!1),g.lanes=4194304);O.isBackwards?(U.sibling=g.child,g.child=U):(C=O.last,C!==null?C.sibling=U:g.child=U,O.last=U)}return O.tail!==null?(g=O.tail,O.rendering=g,O.tail=g.sibling,O.renderingStartTime=Ie(),g.sibling=null,C=Hr.current,Rr(Hr,E?C&1|2:C&1),g):(No(g),null);case 22:case 23:return T3(),E=g.memoizedState!==null,h!==null&&h.memoizedState!==null!==E&&(g.flags|=8192),E&&(g.mode&1)!==0?(Bi&1073741824)!==0&&(No(g),g.subtreeFlags&6&&(g.flags|=8192)):No(g),null;case 24:return null;case 25:return null}throw Error(t(156,g.tag))}function xW(h,g){switch(Mw(g),g.tag){case 1:return ui(g.type)&&tx(),h=g.flags,h&65536?(g.flags=h&-65537|128,g):null;case 3:return Eh(),Pr(ci),Pr(ko),Yw(),h=g.flags,(h&65536)!==0&&(h&128)===0?(g.flags=h&-65537|128,g):null;case 5:return Kw(g),null;case 13:if(Pr(Hr),h=g.memoizedState,h!==null&&h.dehydrated!==null){if(g.alternate===null)throw Error(t(340));Ch()}return h=g.flags,h&65536?(g.flags=h&-65537|128,g):null;case 19:return Pr(Hr),null;case 4:return Eh(),null;case 10:return Ww(g.type._context),null;case 22:case 23:return T3(),null;case 24:return null;default:return null}}var wx=!1,Eo=!1,vW=typeof WeakSet=="function"?WeakSet:Set,Pt=null;function Th(h,g){var C=h.ref;if(C!==null)if(typeof C=="function")try{C(null)}catch(E){Qr(h,g,E)}else C.current=null}function g3(h,g,C){try{C()}catch(E){Qr(h,g,E)}}var eE=!1;function yW(h,g){if(Tw=$d,h=Nl(),hh(h)){if("selectionStart"in h)var C={start:h.selectionStart,end:h.selectionEnd};else e:{C=(C=h.ownerDocument)&&C.defaultView||window;var E=C.getSelection&&C.getSelection();if(E&&E.rangeCount!==0){C=E.anchorNode;var $=E.anchorOffset,O=E.focusNode;E=E.focusOffset;try{C.nodeType,O.nodeType}catch{C=null;break e}var U=0,ne=-1,le=-1,Fe=0,st=0,at=h,nt=null;t:for(;;){for(var Dt;at!==C||$!==0&&at.nodeType!==3||(ne=U+$),at!==O||E!==0&&at.nodeType!==3||(le=U+E),at.nodeType===3&&(U+=at.nodeValue.length),(Dt=at.firstChild)!==null;)nt=at,at=Dt;for(;;){if(at===h)break t;if(nt===C&&++Fe===$&&(ne=U),nt===O&&++st===E&&(le=U),(Dt=at.nextSibling)!==null)break;at=nt,nt=at.parentNode}at=Dt}C=ne===-1||le===-1?null:{start:ne,end:le}}else C=null}C=C||{start:0,end:0}}else C=null;for(_w={focusedElem:h,selectionRange:C},$d=!1,Pt=g;Pt!==null;)if(g=Pt,h=g.child,(g.subtreeFlags&1028)!==0&&h!==null)h.return=g,Pt=h;else for(;Pt!==null;){g=Pt;try{var Bt=g.alternate;if((g.flags&1024)!==0)switch(g.tag){case 0:case 11:case 15:break;case 1:if(Bt!==null){var Ht=Bt.memoizedProps,cs=Bt.memoizedState,Se=g.stateNode,xe=Se.getSnapshotBeforeUpdate(g.elementType===g.type?Ht:za(g.type,Ht),cs);Se.__reactInternalSnapshotBeforeUpdate=xe}break;case 3:var _e=g.stateNode.containerInfo;_e.nodeType===1?_e.textContent="":_e.nodeType===9&&_e.documentElement&&_e.removeChild(_e.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(ft){Qr(g,g.return,ft)}if(h=g.sibling,h!==null){h.return=g.return,Pt=h;break}Pt=g.return}return Bt=eE,eE=!1,Bt}function Pm(h,g,C){var E=g.updateQueue;if(E=E!==null?E.lastEffect:null,E!==null){var $=E=E.next;do{if(($.tag&h)===h){var O=$.destroy;$.destroy=void 0,O!==void 0&&g3(g,C,O)}$=$.next}while($!==E)}}function Cx(h,g){if(g=g.updateQueue,g=g!==null?g.lastEffect:null,g!==null){var C=g=g.next;do{if((C.tag&h)===h){var E=C.create;C.destroy=E()}C=C.next}while(C!==g)}}function x3(h){var g=h.ref;if(g!==null){var C=h.stateNode;switch(h.tag){case 5:h=C;break;default:h=C}typeof g=="function"?g(h):g.current=h}}function tE(h){var g=h.alternate;g!==null&&(h.alternate=null,tE(g)),h.child=null,h.deletions=null,h.sibling=null,h.tag===5&&(g=h.stateNode,g!==null&&(delete g[Il],delete g[Sm],delete g[$w],delete g[tW],delete g[nW])),h.stateNode=null,h.return=null,h.dependencies=null,h.memoizedProps=null,h.memoizedState=null,h.pendingProps=null,h.stateNode=null,h.updateQueue=null}function nE(h){return h.tag===5||h.tag===3||h.tag===4}function rE(h){e:for(;;){for(;h.sibling===null;){if(h.return===null||nE(h.return))return null;h=h.return}for(h.sibling.return=h.return,h=h.sibling;h.tag!==5&&h.tag!==6&&h.tag!==18;){if(h.flags&2||h.child===null||h.tag===4)continue e;h.child.return=h,h=h.child}if(!(h.flags&2))return h.stateNode}}function v3(h,g,C){var E=h.tag;if(E===5||E===6)h=h.stateNode,g?C.nodeType===8?C.parentNode.insertBefore(h,g):C.insertBefore(h,g):(C.nodeType===8?(g=C.parentNode,g.insertBefore(h,C)):(g=C,g.appendChild(h)),C=C._reactRootContainer,C!=null||g.onclick!==null||(g.onclick=Q0));else if(E!==4&&(h=h.child,h!==null))for(v3(h,g,C),h=h.sibling;h!==null;)v3(h,g,C),h=h.sibling}function y3(h,g,C){var E=h.tag;if(E===5||E===6)h=h.stateNode,g?C.insertBefore(h,g):C.appendChild(h);else if(E!==4&&(h=h.child,h!==null))for(y3(h,g,C),h=h.sibling;h!==null;)y3(h,g,C),h=h.sibling}var lo=null,Wa=!1;function Su(h,g,C){for(C=C.child;C!==null;)sE(h,g,C),C=C.sibling}function sE(h,g,C){if(vr&&typeof vr.onCommitFiberUnmount=="function")try{vr.onCommitFiberUnmount(Nn,C)}catch{}switch(C.tag){case 5:Eo||Th(C,g);case 6:var E=lo,$=Wa;lo=null,Su(h,g,C),lo=E,Wa=$,lo!==null&&(Wa?(h=lo,C=C.stateNode,h.nodeType===8?h.parentNode.removeChild(C):h.removeChild(C)):lo.removeChild(C.stateNode));break;case 18:lo!==null&&(Wa?(h=lo,C=C.stateNode,h.nodeType===8?Aw(h.parentNode,C):h.nodeType===1&&Aw(h,C),Fi(h)):Aw(lo,C.stateNode));break;case 4:E=lo,$=Wa,lo=C.stateNode.containerInfo,Wa=!0,Su(h,g,C),lo=E,Wa=$;break;case 0:case 11:case 14:case 15:if(!Eo&&(E=C.updateQueue,E!==null&&(E=E.lastEffect,E!==null))){$=E=E.next;do{var O=$,U=O.destroy;O=O.tag,U!==void 0&&((O&2)!==0||(O&4)!==0)&&g3(C,g,U),$=$.next}while($!==E)}Su(h,g,C);break;case 1:if(!Eo&&(Th(C,g),E=C.stateNode,typeof E.componentWillUnmount=="function"))try{E.props=C.memoizedProps,E.state=C.memoizedState,E.componentWillUnmount()}catch(ne){Qr(C,g,ne)}Su(h,g,C);break;case 21:Su(h,g,C);break;case 22:C.mode&1?(Eo=(E=Eo)||C.memoizedState!==null,Su(h,g,C),Eo=E):Su(h,g,C);break;default:Su(h,g,C)}}function oE(h){var g=h.updateQueue;if(g!==null){h.updateQueue=null;var C=h.stateNode;C===null&&(C=h.stateNode=new vW),g.forEach(function(E){var $=TW.bind(null,h,E);C.has(E)||(C.add(E),E.then($,$))})}}function Ua(h,g){var C=g.deletions;if(C!==null)for(var E=0;E<C.length;E++){var $=C[E];try{var O=h,U=g,ne=U;e:for(;ne!==null;){switch(ne.tag){case 5:lo=ne.stateNode,Wa=!1;break e;case 3:lo=ne.stateNode.containerInfo,Wa=!0;break e;case 4:lo=ne.stateNode.containerInfo,Wa=!0;break e}ne=ne.return}if(lo===null)throw Error(t(160));sE(O,U,$),lo=null,Wa=!1;var le=$.alternate;le!==null&&(le.return=null),$.return=null}catch(Fe){Qr($,g,Fe)}}if(g.subtreeFlags&12854)for(g=g.child;g!==null;)iE(g,h),g=g.sibling}function iE(h,g){var C=h.alternate,E=h.flags;switch(h.tag){case 0:case 11:case 14:case 15:if(Ua(g,h),Rl(h),E&4){try{Pm(3,h,h.return),Cx(3,h)}catch(Ht){Qr(h,h.return,Ht)}try{Pm(5,h,h.return)}catch(Ht){Qr(h,h.return,Ht)}}break;case 1:Ua(g,h),Rl(h),E&512&&C!==null&&Th(C,C.return);break;case 5:if(Ua(g,h),Rl(h),E&512&&C!==null&&Th(C,C.return),h.flags&32){var $=h.stateNode;try{Kn($,"")}catch(Ht){Qr(h,h.return,Ht)}}if(E&4&&($=h.stateNode,$!=null)){var O=h.memoizedProps,U=C!==null?C.memoizedProps:O,ne=h.type,le=h.updateQueue;if(h.updateQueue=null,le!==null)try{ne==="input"&&O.type==="radio"&&O.name!=null&&bt($,O),cn(ne,U);var Fe=cn(ne,O);for(U=0;U<le.length;U+=2){var st=le[U],at=le[U+1];st==="style"?ht($,at):st==="dangerouslySetInnerHTML"?sn($,at):st==="children"?Kn($,at):S($,st,at,Fe)}switch(ne){case"input":rn($,O);break;case"textarea":Ke($,O);break;case"select":var nt=$._wrapperState.wasMultiple;$._wrapperState.wasMultiple=!!O.multiple;var Dt=O.value;Dt!=null?q($,!!O.multiple,Dt,!1):nt!==!!O.multiple&&(O.defaultValue!=null?q($,!!O.multiple,O.defaultValue,!0):q($,!!O.multiple,O.multiple?[]:"",!1))}$[Sm]=O}catch(Ht){Qr(h,h.return,Ht)}}break;case 6:if(Ua(g,h),Rl(h),E&4){if(h.stateNode===null)throw Error(t(162));$=h.stateNode,O=h.memoizedProps;try{$.nodeValue=O}catch(Ht){Qr(h,h.return,Ht)}}break;case 3:if(Ua(g,h),Rl(h),E&4&&C!==null&&C.memoizedState.isDehydrated)try{Fi(g.containerInfo)}catch(Ht){Qr(h,h.return,Ht)}break;case 4:Ua(g,h),Rl(h);break;case 13:Ua(g,h),Rl(h),$=h.child,$.flags&8192&&(O=$.memoizedState!==null,$.stateNode.isHidden=O,!O||$.alternate!==null&&$.alternate.memoizedState!==null||(C3=Ie())),E&4&&oE(h);break;case 22:if(st=C!==null&&C.memoizedState!==null,h.mode&1?(Eo=(Fe=Eo)||st,Ua(g,h),Eo=Fe):Ua(g,h),Rl(h),E&8192){if(Fe=h.memoizedState!==null,(h.stateNode.isHidden=Fe)&&!st&&(h.mode&1)!==0)for(Pt=h,st=h.child;st!==null;){for(at=Pt=st;Pt!==null;){switch(nt=Pt,Dt=nt.child,nt.tag){case 0:case 11:case 14:case 15:Pm(4,nt,nt.return);break;case 1:Th(nt,nt.return);var Bt=nt.stateNode;if(typeof Bt.componentWillUnmount=="function"){E=nt,C=nt.return;try{g=E,Bt.props=g.memoizedProps,Bt.state=g.memoizedState,Bt.componentWillUnmount()}catch(Ht){Qr(E,C,Ht)}}break;case 5:Th(nt,nt.return);break;case 22:if(nt.memoizedState!==null){cE(at);continue}}Dt!==null?(Dt.return=nt,Pt=Dt):cE(at)}st=st.sibling}e:for(st=null,at=h;;){if(at.tag===5){if(st===null){st=at;try{$=at.stateNode,Fe?(O=$.style,typeof O.setProperty=="function"?O.setProperty("display","none","important"):O.display="none"):(ne=at.stateNode,le=at.memoizedProps.style,U=le!=null&&le.hasOwnProperty("display")?le.display:null,ne.style.display=Q("display",U))}catch(Ht){Qr(h,h.return,Ht)}}}else if(at.tag===6){if(st===null)try{at.stateNode.nodeValue=Fe?"":at.memoizedProps}catch(Ht){Qr(h,h.return,Ht)}}else if((at.tag!==22&&at.tag!==23||at.memoizedState===null||at===h)&&at.child!==null){at.child.return=at,at=at.child;continue}if(at===h)break e;for(;at.sibling===null;){if(at.return===null||at.return===h)break e;st===at&&(st=null),at=at.return}st===at&&(st=null),at.sibling.return=at.return,at=at.sibling}}break;case 19:Ua(g,h),Rl(h),E&4&&oE(h);break;case 21:break;default:Ua(g,h),Rl(h)}}function Rl(h){var g=h.flags;if(g&2){try{e:{for(var C=h.return;C!==null;){if(nE(C)){var E=C;break e}C=C.return}throw Error(t(160))}switch(E.tag){case 5:var $=E.stateNode;E.flags&32&&(Kn($,""),E.flags&=-33);var O=rE(h);y3(h,O,$);break;case 3:case 4:var U=E.stateNode.containerInfo,ne=rE(h);v3(h,ne,U);break;default:throw Error(t(161))}}catch(le){Qr(h,h.return,le)}h.flags&=-3}g&4096&&(h.flags&=-4097)}function bW(h,g,C){Pt=h,aE(h)}function aE(h,g,C){for(var E=(h.mode&1)!==0;Pt!==null;){var $=Pt,O=$.child;if($.tag===22&&E){var U=$.memoizedState!==null||wx;if(!U){var ne=$.alternate,le=ne!==null&&ne.memoizedState!==null||Eo;ne=wx;var Fe=Eo;if(wx=U,(Eo=le)&&!Fe)for(Pt=$;Pt!==null;)U=Pt,le=U.child,U.tag===22&&U.memoizedState!==null?uE($):le!==null?(le.return=U,Pt=le):uE($);for(;O!==null;)Pt=O,aE(O),O=O.sibling;Pt=$,wx=ne,Eo=Fe}lE(h)}else($.subtreeFlags&8772)!==0&&O!==null?(O.return=$,Pt=O):lE(h)}}function lE(h){for(;Pt!==null;){var g=Pt;if((g.flags&8772)!==0){var C=g.alternate;try{if((g.flags&8772)!==0)switch(g.tag){case 0:case 11:case 15:Eo||Cx(5,g);break;case 1:var E=g.stateNode;if(g.flags&4&&!Eo)if(C===null)E.componentDidMount();else{var $=g.elementType===g.type?C.memoizedProps:za(g.type,C.memoizedProps);E.componentDidUpdate($,C.memoizedState,E.__reactInternalSnapshotBeforeUpdate)}var O=g.updateQueue;O!==null&&c7(g,O,E);break;case 3:var U=g.updateQueue;if(U!==null){if(C=null,g.child!==null)switch(g.child.tag){case 5:C=g.child.stateNode;break;case 1:C=g.child.stateNode}c7(g,U,C)}break;case 5:var ne=g.stateNode;if(C===null&&g.flags&4){C=ne;var le=g.memoizedProps;switch(g.type){case"button":case"input":case"select":case"textarea":le.autoFocus&&C.focus();break;case"img":le.src&&(C.src=le.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(g.memoizedState===null){var Fe=g.alternate;if(Fe!==null){var st=Fe.memoizedState;if(st!==null){var at=st.dehydrated;at!==null&&Fi(at)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}Eo||g.flags&512&&x3(g)}catch(nt){Qr(g,g.return,nt)}}if(g===h){Pt=null;break}if(C=g.sibling,C!==null){C.return=g.return,Pt=C;break}Pt=g.return}}function cE(h){for(;Pt!==null;){var g=Pt;if(g===h){Pt=null;break}var C=g.sibling;if(C!==null){C.return=g.return,Pt=C;break}Pt=g.return}}function uE(h){for(;Pt!==null;){var g=Pt;try{switch(g.tag){case 0:case 11:case 15:var C=g.return;try{Cx(4,g)}catch(le){Qr(g,C,le)}break;case 1:var E=g.stateNode;if(typeof E.componentDidMount=="function"){var $=g.return;try{E.componentDidMount()}catch(le){Qr(g,$,le)}}var O=g.return;try{x3(g)}catch(le){Qr(g,O,le)}break;case 5:var U=g.return;try{x3(g)}catch(le){Qr(g,U,le)}}}catch(le){Qr(g,g.return,le)}if(g===h){Pt=null;break}var ne=g.sibling;if(ne!==null){ne.return=g.return,Pt=ne;break}Pt=g.return}}var wW=Math.ceil,kx=k.ReactCurrentDispatcher,b3=k.ReactCurrentOwner,va=k.ReactCurrentBatchConfig,er=0,Xs=null,ms=null,co=0,Bi=0,_h=yu(0),Ds=0,Om=null,Hd=0,Sx=0,w3=0,Mm=null,fi=null,C3=0,Rh=1/0,_c=null,Nx=!1,k3=null,Nu=null,Ex=!1,Eu=null,Ix=0,Lm=0,S3=null,Tx=-1,_x=0;function Ko(){return(er&6)!==0?Ie():Tx!==-1?Tx:Tx=Ie()}function Iu(h){return(h.mode&1)===0?1:(er&2)!==0&&co!==0?co&-co:sW.transition!==null?(_x===0&&(_x=_d()),_x):(h=rr,h!==0||(h=window.event,h=h===void 0?16:mm(h.type)),h)}function Ha(h,g,C,E){if(50<Lm)throw Lm=0,S3=null,Error(t(185));yc(h,C,E),((er&2)===0||h!==Xs)&&(h===Xs&&((er&2)===0&&(Sx|=C),Ds===4&&Tu(h,co)),hi(h,E),C===1&&er===0&&(g.mode&1)===0&&(Rh=Ie()+500,rx&&wu()))}function hi(h,g){var C=h.callbackNode;vl(h,g);var E=io(h,h===Xs?co:0);if(E===0)C!==null&&ae(C),h.callbackNode=null,h.callbackPriority=0;else if(g=E&-E,h.callbackPriority!==g){if(C!=null&&ae(C),g===1)h.tag===0?rW(fE.bind(null,h)):ZN(fE.bind(null,h)),Qz(function(){(er&6)===0&&wu()}),C=null;else{switch(Us(E)){case 1:C=vt;break;case 4:C=jt;break;case 16:C=tt;break;case 536870912:C=Vn;break;default:C=tt}C=bE(C,dE.bind(null,h))}h.callbackPriority=g,h.callbackNode=C}}function dE(h,g){if(Tx=-1,_x=0,(er&6)!==0)throw Error(t(327));var C=h.callbackNode;if(Dh()&&h.callbackNode!==C)return null;var E=io(h,h===Xs?co:0);if(E===0)return null;if((E&30)!==0||(E&h.expiredLanes)!==0||g)g=Rx(h,E);else{g=E;var $=er;er|=2;var O=pE();(Xs!==h||co!==g)&&(_c=null,Rh=Ie()+500,qd(h,g));do try{SW();break}catch(ne){hE(h,ne)}while(!0);zw(),kx.current=O,er=$,ms!==null?g=0:(Xs=null,co=0,g=Ds)}if(g!==0){if(g===2&&($=Td(h),$!==0&&(E=$,g=N3(h,$))),g===1)throw C=Om,qd(h,0),Tu(h,E),hi(h,Ie()),C;if(g===6)Tu(h,E);else{if($=h.current.alternate,(E&30)===0&&!CW($)&&(g=Rx(h,E),g===2&&(O=Td(h),O!==0&&(E=O,g=N3(h,O))),g===1))throw C=Om,qd(h,0),Tu(h,E),hi(h,Ie()),C;switch(h.finishedWork=$,h.finishedLanes=E,g){case 0:case 1:throw Error(t(345));case 2:Kd(h,fi,_c);break;case 3:if(Tu(h,E),(E&130023424)===E&&(g=C3+500-Ie(),10<g)){if(io(h,0)!==0)break;if($=h.suspendedLanes,($&E)!==E){Ko(),h.pingedLanes|=h.suspendedLanes&$;break}h.timeoutHandle=Dw(Kd.bind(null,h,fi,_c),g);break}Kd(h,fi,_c);break;case 4:if(Tu(h,E),(E&4194240)===E)break;for(g=h.eventTimes,$=-1;0<E;){var U=31-Wn(E);O=1<<U,U=g[U],U>$&&($=U),E&=~O}if(E=$,E=Ie()-E,E=(120>E?120:480>E?480:1080>E?1080:1920>E?1920:3e3>E?3e3:4320>E?4320:1960*wW(E/1960))-E,10<E){h.timeoutHandle=Dw(Kd.bind(null,h,fi,_c),E);break}Kd(h,fi,_c);break;case 5:Kd(h,fi,_c);break;default:throw Error(t(329))}}}return hi(h,Ie()),h.callbackNode===C?dE.bind(null,h):null}function N3(h,g){var C=Mm;return h.current.memoizedState.isDehydrated&&(qd(h,g).flags|=256),h=Rx(h,g),h!==2&&(g=fi,fi=C,g!==null&&E3(g)),h}function E3(h){fi===null?fi=h:fi.push.apply(fi,h)}function CW(h){for(var g=h;;){if(g.flags&16384){var C=g.updateQueue;if(C!==null&&(C=C.stores,C!==null))for(var E=0;E<C.length;E++){var $=C[E],O=$.getSnapshot;$=$.value;try{if(!Jr(O(),$))return!1}catch{return!1}}}if(C=g.child,g.subtreeFlags&16384&&C!==null)C.return=g,g=C;else{if(g===h)break;for(;g.sibling===null;){if(g.return===null||g.return===h)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function Tu(h,g){for(g&=~w3,g&=~Sx,h.suspendedLanes|=g,h.pingedLanes&=~g,h=h.expirationTimes;0<g;){var C=31-Wn(g),E=1<<C;h[C]=-1,g&=~E}}function fE(h){if((er&6)!==0)throw Error(t(327));Dh();var g=io(h,0);if((g&1)===0)return hi(h,Ie()),null;var C=Rx(h,g);if(h.tag!==0&&C===2){var E=Td(h);E!==0&&(g=E,C=N3(h,E))}if(C===1)throw C=Om,qd(h,0),Tu(h,g),hi(h,Ie()),C;if(C===6)throw Error(t(345));return h.finishedWork=h.current.alternate,h.finishedLanes=g,Kd(h,fi,_c),hi(h,Ie()),null}function I3(h,g){var C=er;er|=1;try{return h(g)}finally{er=C,er===0&&(Rh=Ie()+500,rx&&wu())}}function Gd(h){Eu!==null&&Eu.tag===0&&(er&6)===0&&Dh();var g=er;er|=1;var C=va.transition,E=rr;try{if(va.transition=null,rr=1,h)return h()}finally{rr=E,va.transition=C,er=g,(er&6)===0&&wu()}}function T3(){Bi=_h.current,Pr(_h)}function qd(h,g){h.finishedWork=null,h.finishedLanes=0;var C=h.timeoutHandle;if(C!==-1&&(h.timeoutHandle=-1,Jz(C)),ms!==null)for(C=ms.return;C!==null;){var E=C;switch(Mw(E),E.tag){case 1:E=E.type.childContextTypes,E!=null&&tx();break;case 3:Eh(),Pr(ci),Pr(ko),Yw();break;case 5:Kw(E);break;case 4:Eh();break;case 13:Pr(Hr);break;case 19:Pr(Hr);break;case 10:Ww(E.type._context);break;case 22:case 23:T3()}C=C.return}if(Xs=h,ms=h=_u(h.current,null),co=Bi=g,Ds=0,Om=null,w3=Sx=Hd=0,fi=Mm=null,zd!==null){for(g=0;g<zd.length;g++)if(C=zd[g],E=C.interleaved,E!==null){C.interleaved=null;var $=E.next,O=C.pending;if(O!==null){var U=O.next;O.next=$,E.next=U}C.pending=E}zd=null}return h}function hE(h,g){do{var C=ms;try{if(zw(),hx.current=xx,px){for(var E=Gr.memoizedState;E!==null;){var $=E.queue;$!==null&&($.pending=null),E=E.next}px=!1}if(Ud=0,Ks=Rs=Gr=null,Rm=!1,Dm=0,b3.current=null,C===null||C.return===null){Ds=1,Om=g,ms=null;break}e:{var O=h,U=C.return,ne=C,le=g;if(g=co,ne.flags|=32768,le!==null&&typeof le=="object"&&typeof le.then=="function"){var Fe=le,st=ne,at=st.tag;if((st.mode&1)===0&&(at===0||at===11||at===15)){var nt=st.alternate;nt?(st.updateQueue=nt.updateQueue,st.memoizedState=nt.memoizedState,st.lanes=nt.lanes):(st.updateQueue=null,st.memoizedState=null)}var Dt=L7(U);if(Dt!==null){Dt.flags&=-257,j7(Dt,U,ne,O,g),Dt.mode&1&&M7(O,Fe,g),g=Dt,le=Fe;var Bt=g.updateQueue;if(Bt===null){var Ht=new Set;Ht.add(le),g.updateQueue=Ht}else Bt.add(le);break e}else{if((g&1)===0){M7(O,Fe,g),_3();break e}le=Error(t(426))}}else if(Br&&ne.mode&1){var cs=L7(U);if(cs!==null){(cs.flags&65536)===0&&(cs.flags|=256),j7(cs,U,ne,O,g),Bw(Ih(le,ne));break e}}O=le=Ih(le,ne),Ds!==4&&(Ds=2),Mm===null?Mm=[O]:Mm.push(O),O=U;do{switch(O.tag){case 3:O.flags|=65536,g&=-g,O.lanes|=g;var Se=P7(O,le,g);l7(O,Se);break e;case 1:ne=le;var xe=O.type,_e=O.stateNode;if((O.flags&128)===0&&(typeof xe.getDerivedStateFromError=="function"||_e!==null&&typeof _e.componentDidCatch=="function"&&(Nu===null||!Nu.has(_e)))){O.flags|=65536,g&=-g,O.lanes|=g;var ft=O7(O,ne,g);l7(O,ft);break e}}O=O.return}while(O!==null)}gE(C)}catch(Zt){g=Zt,ms===C&&C!==null&&(ms=C=C.return);continue}break}while(!0)}function pE(){var h=kx.current;return kx.current=xx,h===null?xx:h}function _3(){(Ds===0||Ds===3||Ds===2)&&(Ds=4),Xs===null||(Hd&268435455)===0&&(Sx&268435455)===0||Tu(Xs,co)}function Rx(h,g){var C=er;er|=2;var E=pE();(Xs!==h||co!==g)&&(_c=null,qd(h,g));do try{kW();break}catch($){hE(h,$)}while(!0);if(zw(),er=C,kx.current=E,ms!==null)throw Error(t(261));return Xs=null,co=0,Ds}function kW(){for(;ms!==null;)mE(ms)}function SW(){for(;ms!==null&&!ce();)mE(ms)}function mE(h){var g=yE(h.alternate,h,Bi);h.memoizedProps=h.pendingProps,g===null?gE(h):ms=g,b3.current=null}function gE(h){var g=h;do{var C=g.alternate;if(h=g.return,(g.flags&32768)===0){if(C=gW(C,g,Bi),C!==null){ms=C;return}}else{if(C=xW(C,g),C!==null){C.flags&=32767,ms=C;return}if(h!==null)h.flags|=32768,h.subtreeFlags=0,h.deletions=null;else{Ds=6,ms=null;return}}if(g=g.sibling,g!==null){ms=g;return}ms=g=h}while(g!==null);Ds===0&&(Ds=5)}function Kd(h,g,C){var E=rr,$=va.transition;try{va.transition=null,rr=1,NW(h,g,C,E)}finally{va.transition=$,rr=E}return null}function NW(h,g,C,E){do Dh();while(Eu!==null);if((er&6)!==0)throw Error(t(327));C=h.finishedWork;var $=h.finishedLanes;if(C===null)return null;if(h.finishedWork=null,h.finishedLanes=0,C===h.current)throw Error(t(177));h.callbackNode=null,h.callbackPriority=0;var O=C.lanes|C.childLanes;if(ou(h,O),h===Xs&&(ms=Xs=null,co=0),(C.subtreeFlags&2064)===0&&(C.flags&2064)===0||Ex||(Ex=!0,bE(tt,function(){return Dh(),null})),O=(C.flags&15990)!==0,(C.subtreeFlags&15990)!==0||O){O=va.transition,va.transition=null;var U=rr;rr=1;var ne=er;er|=4,b3.current=null,yW(h,C),iE(C,h),gu(_w),$d=!!Tw,_w=Tw=null,h.current=C,bW(C),Pe(),er=ne,rr=U,va.transition=O}else h.current=C;if(Ex&&(Ex=!1,Eu=h,Ix=$),O=h.pendingLanes,O===0&&(Nu=null),Un(C.stateNode),hi(h,Ie()),g!==null)for(E=h.onRecoverableError,C=0;C<g.length;C++)$=g[C],E($.value,{componentStack:$.stack,digest:$.digest});if(Nx)throw Nx=!1,h=k3,k3=null,h;return(Ix&1)!==0&&h.tag!==0&&Dh(),O=h.pendingLanes,(O&1)!==0?h===S3?Lm++:(Lm=0,S3=h):Lm=0,wu(),null}function Dh(){if(Eu!==null){var h=Us(Ix),g=va.transition,C=rr;try{if(va.transition=null,rr=16>h?16:h,Eu===null)var E=!1;else{if(h=Eu,Eu=null,Ix=0,(er&6)!==0)throw Error(t(331));var $=er;for(er|=4,Pt=h.current;Pt!==null;){var O=Pt,U=O.child;if((Pt.flags&16)!==0){var ne=O.deletions;if(ne!==null){for(var le=0;le<ne.length;le++){var Fe=ne[le];for(Pt=Fe;Pt!==null;){var st=Pt;switch(st.tag){case 0:case 11:case 15:Pm(8,st,O)}var at=st.child;if(at!==null)at.return=st,Pt=at;else for(;Pt!==null;){st=Pt;var nt=st.sibling,Dt=st.return;if(tE(st),st===Fe){Pt=null;break}if(nt!==null){nt.return=Dt,Pt=nt;break}Pt=Dt}}}var Bt=O.alternate;if(Bt!==null){var Ht=Bt.child;if(Ht!==null){Bt.child=null;do{var cs=Ht.sibling;Ht.sibling=null,Ht=cs}while(Ht!==null)}}Pt=O}}if((O.subtreeFlags&2064)!==0&&U!==null)U.return=O,Pt=U;else e:for(;Pt!==null;){if(O=Pt,(O.flags&2048)!==0)switch(O.tag){case 0:case 11:case 15:Pm(9,O,O.return)}var Se=O.sibling;if(Se!==null){Se.return=O.return,Pt=Se;break e}Pt=O.return}}var xe=h.current;for(Pt=xe;Pt!==null;){U=Pt;var _e=U.child;if((U.subtreeFlags&2064)!==0&&_e!==null)_e.return=U,Pt=_e;else e:for(U=xe;Pt!==null;){if(ne=Pt,(ne.flags&2048)!==0)try{switch(ne.tag){case 0:case 11:case 15:Cx(9,ne)}}catch(Zt){Qr(ne,ne.return,Zt)}if(ne===U){Pt=null;break e}var ft=ne.sibling;if(ft!==null){ft.return=ne.return,Pt=ft;break e}Pt=ne.return}}if(er=$,wu(),vr&&typeof vr.onPostCommitFiberRoot=="function")try{vr.onPostCommitFiberRoot(Nn,h)}catch{}E=!0}return E}finally{rr=C,va.transition=g}}return!1}function xE(h,g,C){g=Ih(C,g),g=P7(h,g,1),h=ku(h,g,1),g=Ko(),h!==null&&(yc(h,1,g),hi(h,g))}function Qr(h,g,C){if(h.tag===3)xE(h,h,C);else for(;g!==null;){if(g.tag===3){xE(g,h,C);break}else if(g.tag===1){var E=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof E.componentDidCatch=="function"&&(Nu===null||!Nu.has(E))){h=Ih(C,h),h=O7(g,h,1),g=ku(g,h,1),h=Ko(),g!==null&&(yc(g,1,h),hi(g,h));break}}g=g.return}}function EW(h,g,C){var E=h.pingCache;E!==null&&E.delete(g),g=Ko(),h.pingedLanes|=h.suspendedLanes&C,Xs===h&&(co&C)===C&&(Ds===4||Ds===3&&(co&130023424)===co&&500>Ie()-C3?qd(h,0):w3|=C),hi(h,g)}function vE(h,g){g===0&&((h.mode&1)===0?g=1:(g=su,su<<=1,(su&130023424)===0&&(su=4194304)));var C=Ko();h=Ec(h,g),h!==null&&(yc(h,g,C),hi(h,C))}function IW(h){var g=h.memoizedState,C=0;g!==null&&(C=g.retryLane),vE(h,C)}function TW(h,g){var C=0;switch(h.tag){case 13:var E=h.stateNode,$=h.memoizedState;$!==null&&(C=$.retryLane);break;case 19:E=h.stateNode;break;default:throw Error(t(314))}E!==null&&E.delete(g),vE(h,C)}var yE;yE=function(h,g,C){if(h!==null)if(h.memoizedProps!==g.pendingProps||ci.current)di=!0;else{if((h.lanes&C)===0&&(g.flags&128)===0)return di=!1,mW(h,g,C);di=(h.flags&131072)!==0}else di=!1,Br&&(g.flags&1048576)!==0&&JN(g,ox,g.index);switch(g.lanes=0,g.tag){case 2:var E=g.type;bx(h,g),h=g.pendingProps;var $=yh(g,ko.current);Nh(g,C),$=Qw(null,g,E,h,$,C);var O=e3();return g.flags|=1,typeof $=="object"&&$!==null&&typeof $.render=="function"&&$.$$typeof===void 0?(g.tag=1,g.memoizedState=null,g.updateQueue=null,ui(E)?(O=!0,nx(g)):O=!1,g.memoizedState=$.state!==null&&$.state!==void 0?$.state:null,Gw(g),$.updater=vx,g.stateNode=$,$._reactInternals=g,i3(g,E,h,C),g=u3(null,g,E,!0,O,C)):(g.tag=0,Br&&O&&Ow(g),qo(null,g,$,C),g=g.child),g;case 16:E=g.elementType;e:{switch(bx(h,g),h=g.pendingProps,$=E._init,E=$(E._payload),g.type=E,$=g.tag=RW(E),h=za(E,h),$){case 0:g=c3(null,g,E,h,C);break e;case 1:g=H7(null,g,E,h,C);break e;case 11:g=B7(null,g,E,h,C);break e;case 14:g=V7(null,g,E,za(E.type,h),C);break e}throw Error(t(306,E,""))}return g;case 0:return E=g.type,$=g.pendingProps,$=g.elementType===E?$:za(E,$),c3(h,g,E,$,C);case 1:return E=g.type,$=g.pendingProps,$=g.elementType===E?$:za(E,$),H7(h,g,E,$,C);case 3:e:{if(G7(g),h===null)throw Error(t(387));E=g.pendingProps,O=g.memoizedState,$=O.element,a7(h,g),dx(g,E,null,C);var U=g.memoizedState;if(E=U.element,O.isDehydrated)if(O={element:E,isDehydrated:!1,cache:U.cache,pendingSuspenseBoundaries:U.pendingSuspenseBoundaries,transitions:U.transitions},g.updateQueue.baseState=O,g.memoizedState=O,g.flags&256){$=Ih(Error(t(423)),g),g=q7(h,g,E,C,$);break e}else if(E!==$){$=Ih(Error(t(424)),g),g=q7(h,g,E,C,$);break e}else for(ji=vu(g.stateNode.containerInfo.firstChild),Li=g,Br=!0,Va=null,C=o7(g,null,E,C),g.child=C;C;)C.flags=C.flags&-3|4096,C=C.sibling;else{if(Ch(),E===$){g=Tc(h,g,C);break e}qo(h,g,E,C)}g=g.child}return g;case 5:return u7(g),h===null&&jw(g),E=g.type,$=g.pendingProps,O=h!==null?h.memoizedProps:null,U=$.children,Rw(E,$)?U=null:O!==null&&Rw(E,O)&&(g.flags|=32),U7(h,g),qo(h,g,U,C),g.child;case 6:return h===null&&jw(g),null;case 13:return K7(h,g,C);case 4:return qw(g,g.stateNode.containerInfo),E=g.pendingProps,h===null?g.child=kh(g,null,E,C):qo(h,g,E,C),g.child;case 11:return E=g.type,$=g.pendingProps,$=g.elementType===E?$:za(E,$),B7(h,g,E,$,C);case 7:return qo(h,g,g.pendingProps,C),g.child;case 8:return qo(h,g,g.pendingProps.children,C),g.child;case 12:return qo(h,g,g.pendingProps.children,C),g.child;case 10:e:{if(E=g.type._context,$=g.pendingProps,O=g.memoizedProps,U=$.value,Rr(lx,E._currentValue),E._currentValue=U,O!==null)if(Jr(O.value,U)){if(O.children===$.children&&!ci.current){g=Tc(h,g,C);break e}}else for(O=g.child,O!==null&&(O.return=g);O!==null;){var ne=O.dependencies;if(ne!==null){U=O.child;for(var le=ne.firstContext;le!==null;){if(le.context===E){if(O.tag===1){le=Ic(-1,C&-C),le.tag=2;var Fe=O.updateQueue;if(Fe!==null){Fe=Fe.shared;var st=Fe.pending;st===null?le.next=le:(le.next=st.next,st.next=le),Fe.pending=le}}O.lanes|=C,le=O.alternate,le!==null&&(le.lanes|=C),Uw(O.return,C,g),ne.lanes|=C;break}le=le.next}}else if(O.tag===10)U=O.type===g.type?null:O.child;else if(O.tag===18){if(U=O.return,U===null)throw Error(t(341));U.lanes|=C,ne=U.alternate,ne!==null&&(ne.lanes|=C),Uw(U,C,g),U=O.sibling}else U=O.child;if(U!==null)U.return=O;else for(U=O;U!==null;){if(U===g){U=null;break}if(O=U.sibling,O!==null){O.return=U.return,U=O;break}U=U.return}O=U}qo(h,g,$.children,C),g=g.child}return g;case 9:return $=g.type,E=g.pendingProps.children,Nh(g,C),$=ga($),E=E($),g.flags|=1,qo(h,g,E,C),g.child;case 14:return E=g.type,$=za(E,g.pendingProps),$=za(E.type,$),V7(h,g,E,$,C);case 15:return z7(h,g,g.type,g.pendingProps,C);case 17:return E=g.type,$=g.pendingProps,$=g.elementType===E?$:za(E,$),bx(h,g),g.tag=1,ui(E)?(h=!0,nx(g)):h=!1,Nh(g,C),$7(g,E,$),i3(g,E,$,C),u3(null,g,E,!0,h,C);case 19:return Y7(h,g,C);case 22:return W7(h,g,C)}throw Error(t(156,g.tag))};function bE(h,g){return ve(h,g)}function _W(h,g,C,E){this.tag=h,this.key=C,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=E,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ya(h,g,C,E){return new _W(h,g,C,E)}function R3(h){return h=h.prototype,!(!h||!h.isReactComponent)}function RW(h){if(typeof h=="function")return R3(h)?1:0;if(h!=null){if(h=h.$$typeof,h===P)return 11;if(h===W)return 14}return 2}function _u(h,g){var C=h.alternate;return C===null?(C=ya(h.tag,g,h.key,h.mode),C.elementType=h.elementType,C.type=h.type,C.stateNode=h.stateNode,C.alternate=h,h.alternate=C):(C.pendingProps=g,C.type=h.type,C.flags=0,C.subtreeFlags=0,C.deletions=null),C.flags=h.flags&14680064,C.childLanes=h.childLanes,C.lanes=h.lanes,C.child=h.child,C.memoizedProps=h.memoizedProps,C.memoizedState=h.memoizedState,C.updateQueue=h.updateQueue,g=h.dependencies,C.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},C.sibling=h.sibling,C.index=h.index,C.ref=h.ref,C}function Dx(h,g,C,E,$,O){var U=2;if(E=h,typeof h=="function")R3(h)&&(U=1);else if(typeof h=="string")U=5;else e:switch(h){case T:return Xd(C.children,$,O,g);case F:U=8,$|=8;break;case R:return h=ya(12,C,g,$|2),h.elementType=R,h.lanes=O,h;case B:return h=ya(13,C,g,$),h.elementType=B,h.lanes=O,h;case L:return h=ya(19,C,g,$),h.elementType=L,h.lanes=O,h;case G:return Ax(C,$,O,g);default:if(typeof h=="object"&&h!==null)switch(h.$$typeof){case D:U=10;break e;case A:U=9;break e;case P:U=11;break e;case W:U=14;break e;case H:U=16,E=null;break e}throw Error(t(130,h==null?h:typeof h,""))}return g=ya(U,C,g,$),g.elementType=h,g.type=E,g.lanes=O,g}function Xd(h,g,C,E){return h=ya(7,h,E,g),h.lanes=C,h}function Ax(h,g,C,E){return h=ya(22,h,E,g),h.elementType=G,h.lanes=C,h.stateNode={isHidden:!1},h}function D3(h,g,C){return h=ya(6,h,null,g),h.lanes=C,h}function A3(h,g,C){return g=ya(4,h.children!==null?h.children:[],h.key,g),g.lanes=C,g.stateNode={containerInfo:h.containerInfo,pendingChildren:null,implementation:h.implementation},g}function DW(h,g,C,E,$){this.tag=g,this.containerInfo=h,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ri(0),this.expirationTimes=Ri(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ri(0),this.identifierPrefix=E,this.onRecoverableError=$,this.mutableSourceEagerHydrationData=null}function $3(h,g,C,E,$,O,U,ne,le){return h=new DW(h,g,C,ne,le),g===1?(g=1,O===!0&&(g|=8)):g=0,O=ya(3,null,null,g),h.current=O,O.stateNode=h,O.memoizedState={element:E,isDehydrated:C,cache:null,transitions:null,pendingSuspenseBoundaries:null},Gw(O),h}function AW(h,g,C){var E=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:I,key:E==null?null:""+E,children:h,containerInfo:g,implementation:C}}function wE(h){if(!h)return bu;h=h._reactInternals;e:{if(Xe(h)!==h||h.tag!==1)throw Error(t(170));var g=h;do{switch(g.tag){case 3:g=g.stateNode.context;break e;case 1:if(ui(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break e}}g=g.return}while(g!==null);throw Error(t(171))}if(h.tag===1){var C=h.type;if(ui(C))return XN(h,C,g)}return g}function CE(h,g,C,E,$,O,U,ne,le){return h=$3(C,E,!0,h,$,O,U,ne,le),h.context=wE(null),C=h.current,E=Ko(),$=Iu(C),O=Ic(E,$),O.callback=g??null,ku(C,O,$),h.current.lanes=$,yc(h,$,E),hi(h,E),h}function $x(h,g,C,E){var $=g.current,O=Ko(),U=Iu($);return C=wE(C),g.context===null?g.context=C:g.pendingContext=C,g=Ic(O,U),g.payload={element:h},E=E===void 0?null:E,E!==null&&(g.callback=E),h=ku($,g,U),h!==null&&(Ha(h,$,U,O),ux(h,$,U)),U}function Fx(h){if(h=h.current,!h.child)return null;switch(h.child.tag){case 5:return h.child.stateNode;default:return h.child.stateNode}}function kE(h,g){if(h=h.memoizedState,h!==null&&h.dehydrated!==null){var C=h.retryLane;h.retryLane=C!==0&&C<g?C:g}}function F3(h,g){kE(h,g),(h=h.alternate)&&kE(h,g)}function $W(){return null}var SE=typeof reportError=="function"?reportError:function(h){console.error(h)};function P3(h){this._internalRoot=h}Px.prototype.render=P3.prototype.render=function(h){var g=this._internalRoot;if(g===null)throw Error(t(409));$x(h,g,null,null)},Px.prototype.unmount=P3.prototype.unmount=function(){var h=this._internalRoot;if(h!==null){this._internalRoot=null;var g=h.containerInfo;Gd(function(){$x(null,h,null,null)}),g[Cc]=null}};function Px(h){this._internalRoot=h}Px.prototype.unstable_scheduleHydration=function(h){if(h){var g=hm();h={blockedOn:null,target:h,priority:g};for(var C=0;C<Hs.length&&g!==0&&g<Hs[C].priority;C++);Hs.splice(C,0,h),C===0&&Ho(h)}};function O3(h){return!(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)}function Ox(h){return!(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11&&(h.nodeType!==8||h.nodeValue!==" react-mount-point-unstable "))}function NE(){}function FW(h,g,C,E,$){if($){if(typeof E=="function"){var O=E;E=function(){var Fe=Fx(U);O.call(Fe)}}var U=CE(g,E,h,0,null,!1,!1,"",NE);return h._reactRootContainer=U,h[Cc]=U.current,Cm(h.nodeType===8?h.parentNode:h),Gd(),U}for(;$=h.lastChild;)h.removeChild($);if(typeof E=="function"){var ne=E;E=function(){var Fe=Fx(le);ne.call(Fe)}}var le=$3(h,0,!1,null,null,!1,!1,"",NE);return h._reactRootContainer=le,h[Cc]=le.current,Cm(h.nodeType===8?h.parentNode:h),Gd(function(){$x(g,le,C,E)}),le}function Mx(h,g,C,E,$){var O=C._reactRootContainer;if(O){var U=O;if(typeof $=="function"){var ne=$;$=function(){var le=Fx(U);ne.call(le)}}$x(g,U,h,$)}else U=FW(C,g,h,$,E);return Fx(U)}sh=function(h){switch(h.tag){case 3:var g=h.stateNode;if(g.current.memoizedState.isDehydrated){var C=Oa(g.pendingLanes);C!==0&&(fm(g,C|1),hi(g,Ie()),(er&6)===0&&(Rh=Ie()+500,wu()))}break;case 13:Gd(function(){var E=Ec(h,1);if(E!==null){var $=Ko();Ha(E,h,1,$)}}),F3(h,1)}},Rd=function(h){if(h.tag===13){var g=Ec(h,134217728);if(g!==null){var C=Ko();Ha(g,h,134217728,C)}F3(h,134217728)}},aa=function(h){if(h.tag===13){var g=Iu(h),C=Ec(h,g);if(C!==null){var E=Ko();Ha(C,h,g,E)}F3(h,g)}},hm=function(){return rr},oh=function(h,g){var C=rr;try{return rr=h,g()}finally{rr=C}},An=function(h,g,C){switch(g){case"input":if(rn(h,C),g=C.name,C.type==="radio"&&g!=null){for(C=h;C.parentNode;)C=C.parentNode;for(C=C.querySelectorAll("input[name="+JSON.stringify(""+g)+'][type="radio"]'),g=0;g<C.length;g++){var E=C[g];if(E!==h&&E.form===h.form){var $=ex(E);if(!$)throw Error(t(90));gt(E),rn(E,$)}}}break;case"textarea":Ke(h,C);break;case"select":g=C.value,g!=null&&q(h,!!C.multiple,g,!1)}},In=I3,_n=Gd;var PW={usingClientEntryPoint:!1,Events:[Nm,xh,ex,_i,xt,I3]},jm={findFiberByHostInstance:Ld,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},OW={bundleType:jm.bundleType,version:jm.version,rendererPackageName:jm.rendererPackageName,rendererConfig:jm.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:k.ReactCurrentDispatcher,findHostInstanceByFiber:function(h){return h=Tt(h),h===null?null:h.stateNode},findFiberByHostInstance:jm.findFiberByHostInstance||$W,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Lx=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Lx.isDisabled&&Lx.supportsFiber)try{Nn=Lx.inject(OW),vr=Lx}catch{}}return pi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=PW,pi.createPortal=function(h,g){var C=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!O3(g))throw Error(t(200));return AW(h,g,null,C)},pi.createRoot=function(h,g){if(!O3(h))throw Error(t(299));var C=!1,E="",$=SE;return g!=null&&(g.unstable_strictMode===!0&&(C=!0),g.identifierPrefix!==void 0&&(E=g.identifierPrefix),g.onRecoverableError!==void 0&&($=g.onRecoverableError)),g=$3(h,1,!1,null,null,C,!1,E,$),h[Cc]=g.current,Cm(h.nodeType===8?h.parentNode:h),new P3(g)},pi.findDOMNode=function(h){if(h==null)return null;if(h.nodeType===1)return h;var g=h._reactInternals;if(g===void 0)throw typeof h.render=="function"?Error(t(188)):(h=Object.keys(h).join(","),Error(t(268,h)));return h=Tt(g),h=h===null?null:h.stateNode,h},pi.flushSync=function(h){return Gd(h)},pi.hydrate=function(h,g,C){if(!Ox(g))throw Error(t(200));return Mx(null,h,g,!0,C)},pi.hydrateRoot=function(h,g,C){if(!O3(h))throw Error(t(405));var E=C!=null&&C.hydratedSources||null,$=!1,O="",U=SE;if(C!=null&&(C.unstable_strictMode===!0&&($=!0),C.identifierPrefix!==void 0&&(O=C.identifierPrefix),C.onRecoverableError!==void 0&&(U=C.onRecoverableError)),g=CE(g,null,h,1,C??null,$,!1,O,U),h[Cc]=g.current,Cm(h),E)for(h=0;h<E.length;h++)C=E[h],$=C._getVersion,$=$(C._source),g.mutableSourceEagerHydrationData==null?g.mutableSourceEagerHydrationData=[C,$]:g.mutableSourceEagerHydrationData.push(C,$);return new Px(g)},pi.render=function(h,g,C){if(!Ox(g))throw Error(t(200));return Mx(null,h,g,!1,C)},pi.unmountComponentAtNode=function(h){if(!Ox(h))throw Error(t(40));return h._reactRootContainer?(Gd(function(){Mx(null,null,h,!1,function(){h._reactRootContainer=null,h[Cc]=null})}),!0):!1},pi.unstable_batchedUpdates=I3,pi.unstable_renderSubtreeIntoContainer=function(h,g,C,E){if(!Ox(C))throw Error(t(200));if(h==null||h._reactInternals===void 0)throw Error(t(38));return Mx(h,g,C,!1,E)},pi.version="18.3.1-next-f1338f8080-20240426",pi}var FE;function OR(){if(FE)return V3.exports;FE=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),V3.exports=YW(),V3.exports}var cy=OR();const MR=ay(cy);function zr(n,e,{checkForDefaultPrevented:t=!0}={}){return function(s){if(n?.(s),t===!1||!s.defaultPrevented)return e?.(s)}}function PE(n,e){if(typeof n=="function")return n(e);n!=null&&(n.current=e)}function qg(...n){return e=>{let t=!1;const r=n.map(s=>{const o=PE(s,e);return!t&&typeof o=="function"&&(t=!0),o});if(t)return()=>{for(let s=0;s<r.length;s++){const o=r[s];typeof o=="function"?o():PE(n[s],null)}}}}function ti(...n){return _.useCallback(qg(...n),n)}function ZW(n,e){const t=_.createContext(e),r=o=>{const{children:i,...a}=o,l=_.useMemo(()=>a,Object.values(a));return m.jsx(t.Provider,{value:l,children:i})};r.displayName=n+"Provider";function s(o){const i=_.useContext(t);if(i)return i;if(e!==void 0)return e;throw new Error(`\`${o}\` must be used within \`${n}\``)}return[r,s]}function Kg(n,e=[]){let t=[];function r(o,i){const a=_.createContext(i),l=t.length;t=[...t,i];const c=d=>{const{scope:f,children:p,...x}=d,v=f?.[n]?.[l]||a,y=_.useMemo(()=>x,Object.values(x));return m.jsx(v.Provider,{value:y,children:p})};c.displayName=o+"Provider";function u(d,f){const p=f?.[n]?.[l]||a,x=_.useContext(p);if(x)return x;if(i!==void 0)return i;throw new Error(`\`${d}\` must be used within \`${o}\``)}return[c,u]}const s=()=>{const o=t.map(i=>_.createContext(i));return function(a){const l=a?.[n]||o;return _.useMemo(()=>({[`__scope${n}`]:{...a,[n]:l}}),[a,l])}};return s.scopeName=n,[r,JW(s,...e)]}function JW(...n){const e=n[0];if(n.length===1)return e;const t=()=>{const r=n.map(s=>({useScope:s(),scopeName:s.scopeName}));return function(o){const i=r.reduce((a,{useScope:l,scopeName:c})=>{const d=l(o)[`__scope${c}`];return{...a,...d}},{});return _.useMemo(()=>({[`__scope${e.scopeName}`]:i}),[i])}};return t.scopeName=e.scopeName,t}function OE(n){const e=QW(n),t=_.forwardRef((r,s)=>{const{children:o,...i}=r,a=_.Children.toArray(o),l=a.find(tU);if(l){const c=l.props.children,u=a.map(d=>d===l?_.Children.count(c)>1?_.Children.only(null):_.isValidElement(c)?c.props.children:null:d);return m.jsx(e,{...i,ref:s,children:_.isValidElement(c)?_.cloneElement(c,void 0,u):null})}return m.jsx(e,{...i,ref:s,children:o})});return t.displayName=`${n}.Slot`,t}function QW(n){const e=_.forwardRef((t,r)=>{const{children:s,...o}=t;if(_.isValidElement(s)){const i=rU(s),a=nU(o,s.props);return s.type!==_.Fragment&&(a.ref=r?qg(r,i):i),_.cloneElement(s,a)}return _.Children.count(s)>1?_.Children.only(null):null});return e.displayName=`${n}.SlotClone`,e}var eU=Symbol("radix.slottable");function tU(n){return _.isValidElement(n)&&typeof n.type=="function"&&"__radixId"in n.type&&n.type.__radixId===eU}function nU(n,e){const t={...e};for(const r in e){const s=n[r],o=e[r];/^on[A-Z]/.test(r)?s&&o?t[r]=(...a)=>{const l=o(...a);return s(...a),l}:s&&(t[r]=s):r==="style"?t[r]={...s,...o}:r==="className"&&(t[r]=[s,o].filter(Boolean).join(" "))}return{...n,...t}}function rU(n){let e=Object.getOwnPropertyDescriptor(n.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=Object.getOwnPropertyDescriptor(n,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}function sU(n){const e=n+"CollectionProvider",[t,r]=Kg(e),[s,o]=t(e,{collectionRef:{current:null},itemMap:new Map}),i=v=>{const{scope:y,children:b}=v,w=Ve.useRef(null),S=Ve.useRef(new Map).current;return m.jsx(s,{scope:y,itemMap:S,collectionRef:w,children:b})};i.displayName=e;const a=n+"CollectionSlot",l=OE(a),c=Ve.forwardRef((v,y)=>{const{scope:b,children:w}=v,S=o(a,b),k=ti(y,S.collectionRef);return m.jsx(l,{ref:k,children:w})});c.displayName=a;const u=n+"CollectionItemSlot",d="data-radix-collection-item",f=OE(u),p=Ve.forwardRef((v,y)=>{const{scope:b,children:w,...S}=v,k=Ve.useRef(null),N=ti(y,k),I=o(u,b);return Ve.useEffect(()=>(I.itemMap.set(k,{ref:k,...S}),()=>void I.itemMap.delete(k))),m.jsx(f,{[d]:"",ref:N,children:w})});p.displayName=u;function x(v){const y=o(n+"CollectionConsumer",v);return Ve.useCallback(()=>{const w=y.collectionRef.current;if(!w)return[];const S=Array.from(w.querySelectorAll(`[${d}]`));return Array.from(y.itemMap.values()).sort((I,T)=>S.indexOf(I.ref.current)-S.indexOf(T.ref.current))},[y.collectionRef,y.itemMap])}return[{Provider:i,Slot:c,ItemSlot:p},x,r]}function oU(n){const e=iU(n),t=_.forwardRef((r,s)=>{const{children:o,...i}=r,a=_.Children.toArray(o),l=a.find(lU);if(l){const c=l.props.children,u=a.map(d=>d===l?_.Children.count(c)>1?_.Children.only(null):_.isValidElement(c)?c.props.children:null:d);return m.jsx(e,{...i,ref:s,children:_.isValidElement(c)?_.cloneElement(c,void 0,u):null})}return m.jsx(e,{...i,ref:s,children:o})});return t.displayName=`${n}.Slot`,t}function iU(n){const e=_.forwardRef((t,r)=>{const{children:s,...o}=t;if(_.isValidElement(s)){const i=uU(s),a=cU(o,s.props);return s.type!==_.Fragment&&(a.ref=r?qg(r,i):i),_.cloneElement(s,a)}return _.Children.count(s)>1?_.Children.only(null):null});return e.displayName=`${n}.SlotClone`,e}var aU=Symbol("radix.slottable");function lU(n){return _.isValidElement(n)&&typeof n.type=="function"&&"__radixId"in n.type&&n.type.__radixId===aU}function cU(n,e){const t={...e};for(const r in e){const s=n[r],o=e[r];/^on[A-Z]/.test(r)?s&&o?t[r]=(...a)=>{const l=o(...a);return s(...a),l}:s&&(t[r]=s):r==="style"?t[r]={...s,...o}:r==="className"&&(t[r]=[s,o].filter(Boolean).join(" "))}return{...n,...t}}function uU(n){let e=Object.getOwnPropertyDescriptor(n.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=Object.getOwnPropertyDescriptor(n,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}var dU=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Is=dU.reduce((n,e)=>{const t=oU(`Primitive.${e}`),r=_.forwardRef((s,o)=>{const{asChild:i,...a}=s,l=i?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),m.jsx(l,{...a,ref:o})});return r.displayName=`Primitive.${e}`,{...n,[e]:r}},{});function LR(n,e){n&&cy.flushSync(()=>n.dispatchEvent(e))}function sc(n){const e=_.useRef(n);return _.useEffect(()=>{e.current=n}),_.useMemo(()=>(...t)=>e.current?.(...t),[])}function fU(n,e=globalThis?.document){const t=sc(n);_.useEffect(()=>{const r=s=>{s.key==="Escape"&&t(s)};return e.addEventListener("keydown",r,{capture:!0}),()=>e.removeEventListener("keydown",r,{capture:!0})},[t,e])}var hU="DismissableLayer",_4="dismissableLayer.update",pU="dismissableLayer.pointerDownOutside",mU="dismissableLayer.focusOutside",ME,jR=_.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),uy=_.forwardRef((n,e)=>{const{disableOutsidePointerEvents:t=!1,onEscapeKeyDown:r,onPointerDownOutside:s,onFocusOutside:o,onInteractOutside:i,onDismiss:a,...l}=n,c=_.useContext(jR),[u,d]=_.useState(null),f=u?.ownerDocument??globalThis?.document,[,p]=_.useState({}),x=ti(e,T=>d(T)),v=Array.from(c.layers),[y]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),b=v.indexOf(y),w=u?v.indexOf(u):-1,S=c.layersWithOutsidePointerEventsDisabled.size>0,k=w>=b,N=xU(T=>{const F=T.target,R=[...c.branches].some(D=>D.contains(F));!k||R||(s?.(T),i?.(T),T.defaultPrevented||a?.())},f),I=vU(T=>{const F=T.target;[...c.branches].some(D=>D.contains(F))||(o?.(T),i?.(T),T.defaultPrevented||a?.())},f);return fU(T=>{w===c.layers.size-1&&(r?.(T),!T.defaultPrevented&&a&&(T.preventDefault(),a()))},f),_.useEffect(()=>{if(u)return t&&(c.layersWithOutsidePointerEventsDisabled.size===0&&(ME=f.body.style.pointerEvents,f.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(u)),c.layers.add(u),LE(),()=>{t&&c.layersWithOutsidePointerEventsDisabled.size===1&&(f.body.style.pointerEvents=ME)}},[u,f,t,c]),_.useEffect(()=>()=>{u&&(c.layers.delete(u),c.layersWithOutsidePointerEventsDisabled.delete(u),LE())},[u,c]),_.useEffect(()=>{const T=()=>p({});return document.addEventListener(_4,T),()=>document.removeEventListener(_4,T)},[]),m.jsx(Is.div,{...l,ref:x,style:{pointerEvents:S?k?"auto":"none":void 0,...n.style},onFocusCapture:zr(n.onFocusCapture,I.onFocusCapture),onBlurCapture:zr(n.onBlurCapture,I.onBlurCapture),onPointerDownCapture:zr(n.onPointerDownCapture,N.onPointerDownCapture)})});uy.displayName=hU;var gU="DismissableLayerBranch",BR=_.forwardRef((n,e)=>{const t=_.useContext(jR),r=_.useRef(null),s=ti(e,r);return _.useEffect(()=>{const o=r.current;if(o)return t.branches.add(o),()=>{t.branches.delete(o)}},[t.branches]),m.jsx(Is.div,{...n,ref:s})});BR.displayName=gU;function xU(n,e=globalThis?.document){const t=sc(n),r=_.useRef(!1),s=_.useRef(()=>{});return _.useEffect(()=>{const o=a=>{if(a.target&&!r.current){let l=function(){VR(pU,t,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",s.current),s.current=l,e.addEventListener("click",s.current,{once:!0})):l()}else e.removeEventListener("click",s.current);r.current=!1},i=window.setTimeout(()=>{e.addEventListener("pointerdown",o)},0);return()=>{window.clearTimeout(i),e.removeEventListener("pointerdown",o),e.removeEventListener("click",s.current)}},[e,t]),{onPointerDownCapture:()=>r.current=!0}}function vU(n,e=globalThis?.document){const t=sc(n),r=_.useRef(!1);return _.useEffect(()=>{const s=o=>{o.target&&!r.current&&VR(mU,t,{originalEvent:o},{discrete:!1})};return e.addEventListener("focusin",s),()=>e.removeEventListener("focusin",s)},[e,t]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function LE(){const n=new CustomEvent(_4);document.dispatchEvent(n)}function VR(n,e,t,{discrete:r}){const s=t.originalEvent.target,o=new CustomEvent(n,{bubbles:!1,cancelable:!0,detail:t});e&&s.addEventListener(n,e,{once:!0}),r?LR(s,o):s.dispatchEvent(o)}var yU=uy,bU=BR,jc=globalThis?.document?_.useLayoutEffect:()=>{},wU="Portal",hk=_.forwardRef((n,e)=>{const{container:t,...r}=n,[s,o]=_.useState(!1);jc(()=>o(!0),[]);const i=t||s&&globalThis?.document?.body;return i?MR.createPortal(m.jsx(Is.div,{...r,ref:e}),i):null});hk.displayName=wU;function CU(n,e){return _.useReducer((t,r)=>e[t][r]??t,n)}var Bp=n=>{const{present:e,children:t}=n,r=kU(e),s=typeof t=="function"?t({present:r.isPresent}):_.Children.only(t),o=ti(r.ref,SU(s));return typeof t=="function"||r.isPresent?_.cloneElement(s,{ref:o}):null};Bp.displayName="Presence";function kU(n){const[e,t]=_.useState(),r=_.useRef(null),s=_.useRef(n),o=_.useRef("none"),i=n?"mounted":"unmounted",[a,l]=CU(i,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return _.useEffect(()=>{const c=jx(r.current);o.current=a==="mounted"?c:"none"},[a]),jc(()=>{const c=r.current,u=s.current;if(u!==n){const f=o.current,p=jx(c);n?l("MOUNT"):p==="none"||c?.display==="none"?l("UNMOUNT"):l(u&&f!==p?"ANIMATION_OUT":"UNMOUNT"),s.current=n}},[n,l]),jc(()=>{if(e){let c;const u=e.ownerDocument.defaultView??window,d=p=>{const v=jx(r.current).includes(CSS.escape(p.animationName));if(p.target===e&&v&&(l("ANIMATION_END"),!s.current)){const y=e.style.animationFillMode;e.style.animationFillMode="forwards",c=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=y)})}},f=p=>{p.target===e&&(o.current=jx(r.current))};return e.addEventListener("animationstart",f),e.addEventListener("animationcancel",d),e.addEventListener("animationend",d),()=>{u.clearTimeout(c),e.removeEventListener("animationstart",f),e.removeEventListener("animationcancel",d),e.removeEventListener("animationend",d)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:_.useCallback(c=>{r.current=c?getComputedStyle(c):null,t(c)},[])}}function jx(n){return n?.animationName||"none"}function SU(n){let e=Object.getOwnPropertyDescriptor(n.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=Object.getOwnPropertyDescriptor(n,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}var NU=ly[" useInsertionEffect ".trim().toString()]||jc;function zR({prop:n,defaultProp:e,onChange:t=()=>{},caller:r}){const[s,o,i]=EU({defaultProp:e,onChange:t}),a=n!==void 0,l=a?n:s;{const u=_.useRef(n!==void 0);_.useEffect(()=>{const d=u.current;d!==a&&console.warn(`${r} is changing from ${d?"controlled":"uncontrolled"} to ${a?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),u.current=a},[a,r])}const c=_.useCallback(u=>{if(a){const d=IU(u)?u(n):u;d!==n&&i.current?.(d)}else o(u)},[a,n,o,i]);return[l,c]}function EU({defaultProp:n,onChange:e}){const[t,r]=_.useState(n),s=_.useRef(t),o=_.useRef(e);return NU(()=>{o.current=e},[e]),_.useEffect(()=>{s.current!==t&&(o.current?.(t),s.current=t)},[t,s]),[t,r,o]}function IU(n){return typeof n=="function"}var TU=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),_U="VisuallyHidden",dy=_.forwardRef((n,e)=>m.jsx(Is.span,{...n,ref:e,style:{...TU,...n.style}}));dy.displayName=_U;var RU=dy,pk="ToastProvider",[mk,DU,AU]=sU("Toast"),[WR]=Kg("Toast",[AU]),[$U,fy]=WR(pk),UR=n=>{const{__scopeToast:e,label:t="Notification",duration:r=5e3,swipeDirection:s="right",swipeThreshold:o=50,children:i}=n,[a,l]=_.useState(null),[c,u]=_.useState(0),d=_.useRef(!1),f=_.useRef(!1);return t.trim()||console.error(`Invalid prop \`label\` supplied to \`${pk}\`. Expected non-empty \`string\`.`),m.jsx(mk.Provider,{scope:e,children:m.jsx($U,{scope:e,label:t,duration:r,swipeDirection:s,swipeThreshold:o,toastCount:c,viewport:a,onViewportChange:l,onToastAdd:_.useCallback(()=>u(p=>p+1),[]),onToastRemove:_.useCallback(()=>u(p=>p-1),[]),isFocusedToastEscapeKeyDownRef:d,isClosePausedRef:f,children:i})})};UR.displayName=pk;var HR="ToastViewport",FU=["F8"],R4="toast.viewportPause",D4="toast.viewportResume",GR=_.forwardRef((n,e)=>{const{__scopeToast:t,hotkey:r=FU,label:s="Notifications ({hotkey})",...o}=n,i=fy(HR,t),a=DU(t),l=_.useRef(null),c=_.useRef(null),u=_.useRef(null),d=_.useRef(null),f=ti(e,d,i.onViewportChange),p=r.join("+").replace(/Key/g,"").replace(/Digit/g,""),x=i.toastCount>0;_.useEffect(()=>{const y=b=>{r.length!==0&&r.every(S=>b[S]||b.code===S)&&d.current?.focus()};return document.addEventListener("keydown",y),()=>document.removeEventListener("keydown",y)},[r]),_.useEffect(()=>{const y=l.current,b=d.current;if(x&&y&&b){const w=()=>{if(!i.isClosePausedRef.current){const I=new CustomEvent(R4);b.dispatchEvent(I),i.isClosePausedRef.current=!0}},S=()=>{if(i.isClosePausedRef.current){const I=new CustomEvent(D4);b.dispatchEvent(I),i.isClosePausedRef.current=!1}},k=I=>{!y.contains(I.relatedTarget)&&S()},N=()=>{y.contains(document.activeElement)||S()};return y.addEventListener("focusin",w),y.addEventListener("focusout",k),y.addEventListener("pointermove",w),y.addEventListener("pointerleave",N),window.addEventListener("blur",w),window.addEventListener("focus",S),()=>{y.removeEventListener("focusin",w),y.removeEventListener("focusout",k),y.removeEventListener("pointermove",w),y.removeEventListener("pointerleave",N),window.removeEventListener("blur",w),window.removeEventListener("focus",S)}}},[x,i.isClosePausedRef]);const v=_.useCallback(({tabbingDirection:y})=>{const w=a().map(S=>{const k=S.ref.current,N=[k,...qU(k)];return y==="forwards"?N:N.reverse()});return(y==="forwards"?w.reverse():w).flat()},[a]);return _.useEffect(()=>{const y=d.current;if(y){const b=w=>{const S=w.altKey||w.ctrlKey||w.metaKey;if(w.key==="Tab"&&!S){const N=document.activeElement,I=w.shiftKey;if(w.target===y&&I){c.current?.focus();return}const R=v({tabbingDirection:I?"backwards":"forwards"}),D=R.findIndex(A=>A===N);U3(R.slice(D+1))?w.preventDefault():I?c.current?.focus():u.current?.focus()}};return y.addEventListener("keydown",b),()=>y.removeEventListener("keydown",b)}},[a,v]),m.jsxs(bU,{ref:l,role:"region","aria-label":s.replace("{hotkey}",p),tabIndex:-1,style:{pointerEvents:x?void 0:"none"},children:[x&&m.jsx(A4,{ref:c,onFocusFromOutsideViewport:()=>{const y=v({tabbingDirection:"forwards"});U3(y)}}),m.jsx(mk.Slot,{scope:t,children:m.jsx(Is.ol,{tabIndex:-1,...o,ref:f})}),x&&m.jsx(A4,{ref:u,onFocusFromOutsideViewport:()=>{const y=v({tabbingDirection:"backwards"});U3(y)}})]})});GR.displayName=HR;var qR="ToastFocusProxy",A4=_.forwardRef((n,e)=>{const{__scopeToast:t,onFocusFromOutsideViewport:r,...s}=n,o=fy(qR,t);return m.jsx(dy,{tabIndex:0,...s,ref:e,style:{position:"fixed"},onFocus:i=>{const a=i.relatedTarget;!o.viewport?.contains(a)&&r()}})});A4.displayName=qR;var Xg="Toast",PU="toast.swipeStart",OU="toast.swipeMove",MU="toast.swipeCancel",LU="toast.swipeEnd",KR=_.forwardRef((n,e)=>{const{forceMount:t,open:r,defaultOpen:s,onOpenChange:o,...i}=n,[a,l]=zR({prop:r,defaultProp:s??!0,onChange:o,caller:Xg});return m.jsx(Bp,{present:t||a,children:m.jsx(VU,{open:a,...i,ref:e,onClose:()=>l(!1),onPause:sc(n.onPause),onResume:sc(n.onResume),onSwipeStart:zr(n.onSwipeStart,c=>{c.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:zr(n.onSwipeMove,c=>{const{x:u,y:d}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","move"),c.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${u}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${d}px`)}),onSwipeCancel:zr(n.onSwipeCancel,c=>{c.currentTarget.setAttribute("data-swipe","cancel"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:zr(n.onSwipeEnd,c=>{const{x:u,y:d}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","end"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${u}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${d}px`),l(!1)})})})});KR.displayName=Xg;var[jU,BU]=WR(Xg,{onClose(){}}),VU=_.forwardRef((n,e)=>{const{__scopeToast:t,type:r="foreground",duration:s,open:o,onClose:i,onEscapeKeyDown:a,onPause:l,onResume:c,onSwipeStart:u,onSwipeMove:d,onSwipeCancel:f,onSwipeEnd:p,...x}=n,v=fy(Xg,t),[y,b]=_.useState(null),w=ti(e,L=>b(L)),S=_.useRef(null),k=_.useRef(null),N=s||v.duration,I=_.useRef(0),T=_.useRef(N),F=_.useRef(0),{onToastAdd:R,onToastRemove:D}=v,A=sc(()=>{y?.contains(document.activeElement)&&v.viewport?.focus(),i()}),P=_.useCallback(L=>{!L||L===1/0||(window.clearTimeout(F.current),I.current=new Date().getTime(),F.current=window.setTimeout(A,L))},[A]);_.useEffect(()=>{const L=v.viewport;if(L){const W=()=>{P(T.current),c?.()},H=()=>{const G=new Date().getTime()-I.current;T.current=T.current-G,window.clearTimeout(F.current),l?.()};return L.addEventListener(R4,H),L.addEventListener(D4,W),()=>{L.removeEventListener(R4,H),L.removeEventListener(D4,W)}}},[v.viewport,N,l,c,P]),_.useEffect(()=>{o&&!v.isClosePausedRef.current&&P(N)},[o,N,v.isClosePausedRef,P]),_.useEffect(()=>(R(),()=>D()),[R,D]);const B=_.useMemo(()=>y?tD(y):null,[y]);return v.viewport?m.jsxs(m.Fragment,{children:[B&&m.jsx(zU,{__scopeToast:t,role:"status","aria-live":r==="foreground"?"assertive":"polite",children:B}),m.jsx(jU,{scope:t,onClose:A,children:cy.createPortal(m.jsx(mk.ItemSlot,{scope:t,children:m.jsx(yU,{asChild:!0,onEscapeKeyDown:zr(a,()=>{v.isFocusedToastEscapeKeyDownRef.current||A(),v.isFocusedToastEscapeKeyDownRef.current=!1}),children:m.jsx(Is.li,{tabIndex:0,"data-state":o?"open":"closed","data-swipe-direction":v.swipeDirection,...x,ref:w,style:{userSelect:"none",touchAction:"none",...n.style},onKeyDown:zr(n.onKeyDown,L=>{L.key==="Escape"&&(a?.(L.nativeEvent),L.nativeEvent.defaultPrevented||(v.isFocusedToastEscapeKeyDownRef.current=!0,A()))}),onPointerDown:zr(n.onPointerDown,L=>{L.button===0&&(S.current={x:L.clientX,y:L.clientY})}),onPointerMove:zr(n.onPointerMove,L=>{if(!S.current)return;const W=L.clientX-S.current.x,H=L.clientY-S.current.y,G=!!k.current,M=["left","right"].includes(v.swipeDirection),j=["left","up"].includes(v.swipeDirection)?Math.min:Math.max,z=M?j(0,W):0,V=M?0:j(0,H),K=L.pointerType==="touch"?10:2,J={x:z,y:V},oe={originalEvent:L,delta:J};G?(k.current=J,Bx(OU,d,oe,{discrete:!1})):jE(J,v.swipeDirection,K)?(k.current=J,Bx(PU,u,oe,{discrete:!1}),L.target.setPointerCapture(L.pointerId)):(Math.abs(W)>K||Math.abs(H)>K)&&(S.current=null)}),onPointerUp:zr(n.onPointerUp,L=>{const W=k.current,H=L.target;if(H.hasPointerCapture(L.pointerId)&&H.releasePointerCapture(L.pointerId),k.current=null,S.current=null,W){const G=L.currentTarget,M={originalEvent:L,delta:W};jE(W,v.swipeDirection,v.swipeThreshold)?Bx(LU,p,M,{discrete:!0}):Bx(MU,f,M,{discrete:!0}),G.addEventListener("click",j=>j.preventDefault(),{once:!0})}})})})}),v.viewport)})]}):null}),zU=n=>{const{__scopeToast:e,children:t,...r}=n,s=fy(Xg,e),[o,i]=_.useState(!1),[a,l]=_.useState(!1);return HU(()=>i(!0)),_.useEffect(()=>{const c=window.setTimeout(()=>l(!0),1e3);return()=>window.clearTimeout(c)},[]),a?null:m.jsx(hk,{asChild:!0,children:m.jsx(dy,{...r,children:o&&m.jsxs(m.Fragment,{children:[s.label," ",t]})})})},WU="ToastTitle",XR=_.forwardRef((n,e)=>{const{__scopeToast:t,...r}=n;return m.jsx(Is.div,{...r,ref:e})});XR.displayName=WU;var UU="ToastDescription",YR=_.forwardRef((n,e)=>{const{__scopeToast:t,...r}=n;return m.jsx(Is.div,{...r,ref:e})});YR.displayName=UU;var ZR="ToastAction",JR=_.forwardRef((n,e)=>{const{altText:t,...r}=n;return t.trim()?m.jsx(eD,{altText:t,asChild:!0,children:m.jsx(gk,{...r,ref:e})}):(console.error(`Invalid prop \`altText\` supplied to \`${ZR}\`. Expected non-empty \`string\`.`),null)});JR.displayName=ZR;var QR="ToastClose",gk=_.forwardRef((n,e)=>{const{__scopeToast:t,...r}=n,s=BU(QR,t);return m.jsx(eD,{asChild:!0,children:m.jsx(Is.button,{type:"button",...r,ref:e,onClick:zr(n.onClick,s.onClose)})})});gk.displayName=QR;var eD=_.forwardRef((n,e)=>{const{__scopeToast:t,altText:r,...s}=n;return m.jsx(Is.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":r||void 0,...s,ref:e})});function tD(n){const e=[];return Array.from(n.childNodes).forEach(r=>{if(r.nodeType===r.TEXT_NODE&&r.textContent&&e.push(r.textContent),GU(r)){const s=r.ariaHidden||r.hidden||r.style.display==="none",o=r.dataset.radixToastAnnounceExclude==="";if(!s)if(o){const i=r.dataset.radixToastAnnounceAlt;i&&e.push(i)}else e.push(...tD(r))}}),e}function Bx(n,e,t,{discrete:r}){const s=t.originalEvent.currentTarget,o=new CustomEvent(n,{bubbles:!0,cancelable:!0,detail:t});e&&s.addEventListener(n,e,{once:!0}),r?LR(s,o):s.dispatchEvent(o)}var jE=(n,e,t=0)=>{const r=Math.abs(n.x),s=Math.abs(n.y),o=r>s;return e==="left"||e==="right"?o&&r>t:!o&&s>t};function HU(n=()=>{}){const e=sc(n);jc(()=>{let t=0,r=0;return t=window.requestAnimationFrame(()=>r=window.requestAnimationFrame(e)),()=>{window.cancelAnimationFrame(t),window.cancelAnimationFrame(r)}},[e])}function GU(n){return n.nodeType===n.ELEMENT_NODE}function qU(n){const e=[],t=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const s=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||s?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function U3(n){const e=document.activeElement;return n.some(t=>t===e?!0:(t.focus(),document.activeElement!==e))}var KU=UR,nD=GR,rD=KR,sD=XR,oD=YR,iD=JR,aD=gk;function lD(n){var e,t,r="";if(typeof n=="string"||typeof n=="number")r+=n;else if(typeof n=="object")if(Array.isArray(n)){var s=n.length;for(e=0;e<s;e++)n[e]&&(t=lD(n[e]))&&(r&&(r+=" "),r+=t)}else for(t in n)n[t]&&(r&&(r+=" "),r+=t);return r}function cD(){for(var n,e,t=0,r="",s=arguments.length;t<s;t++)(n=arguments[t])&&(e=lD(n))&&(r&&(r+=" "),r+=e);return r}const BE=n=>typeof n=="boolean"?`${n}`:n===0?"0":n,VE=cD,uD=(n,e)=>t=>{var r;if(e?.variants==null)return VE(n,t?.class,t?.className);const{variants:s,defaultVariants:o}=e,i=Object.keys(s).map(c=>{const u=t?.[c],d=o?.[c];if(u===null)return null;const f=BE(u)||BE(d);return s[c][f]}),a=t&&Object.entries(t).reduce((c,u)=>{let[d,f]=u;return f===void 0||(c[d]=f),c},{}),l=e==null||(r=e.compoundVariants)===null||r===void 0?void 0:r.reduce((c,u)=>{let{class:d,className:f,...p}=u;return Object.entries(p).every(x=>{let[v,y]=x;return Array.isArray(y)?y.includes({...o,...a}[v]):{...o,...a}[v]===y})?[...c,d,f]:c},[]);return VE(n,i,l,t?.class,t?.className)};const XU=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),YU=n=>n.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase()),zE=n=>{const e=YU(n);return e.charAt(0).toUpperCase()+e.slice(1)},dD=(...n)=>n.filter((e,t,r)=>!!e&&e.trim()!==""&&r.indexOf(e)===t).join(" ").trim(),ZU=n=>{for(const e in n)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};var JU={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const QU=_.forwardRef(({color:n="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:r,className:s="",children:o,iconNode:i,...a},l)=>_.createElement("svg",{ref:l,...JU,width:e,height:e,stroke:n,strokeWidth:r?Number(t)*24/Number(e):t,className:dD("lucide",s),...!o&&!ZU(a)&&{"aria-hidden":"true"},...a},[...i.map(([c,u])=>_.createElement(c,u)),...Array.isArray(o)?o:[o]]));const eH=(n,e)=>{const t=_.forwardRef(({className:r,...s},o)=>_.createElement(QU,{ref:o,iconNode:e,className:dD(`lucide-${XU(zE(n))}`,`lucide-${n}`,r),...s}));return t.displayName=zE(n),t};const tH=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],fD=eH("x",tH),xk="-",nH=n=>{const e=sH(n),{conflictingClassGroups:t,conflictingClassGroupModifiers:r}=n;return{getClassGroupId:i=>{const a=i.split(xk);return a[0]===""&&a.length!==1&&a.shift(),hD(a,e)||rH(i)},getConflictingClassGroupIds:(i,a)=>{const l=t[i]||[];return a&&r[i]?[...l,...r[i]]:l}}},hD=(n,e)=>{if(n.length===0)return e.classGroupId;const t=n[0],r=e.nextPart.get(t),s=r?hD(n.slice(1),r):void 0;if(s)return s;if(e.validators.length===0)return;const o=n.join(xk);return e.validators.find(({validator:i})=>i(o))?.classGroupId},WE=/^\[(.+)\]$/,rH=n=>{if(WE.test(n)){const e=WE.exec(n)[1],t=e?.substring(0,e.indexOf(":"));if(t)return"arbitrary.."+t}},sH=n=>{const{theme:e,prefix:t}=n,r={nextPart:new Map,validators:[]};return iH(Object.entries(n.classGroups),t).forEach(([o,i])=>{$4(i,r,o,e)}),r},$4=(n,e,t,r)=>{n.forEach(s=>{if(typeof s=="string"){const o=s===""?e:UE(e,s);o.classGroupId=t;return}if(typeof s=="function"){if(oH(s)){$4(s(r),e,t,r);return}e.validators.push({validator:s,classGroupId:t});return}Object.entries(s).forEach(([o,i])=>{$4(i,UE(e,o),t,r)})})},UE=(n,e)=>{let t=n;return e.split(xk).forEach(r=>{t.nextPart.has(r)||t.nextPart.set(r,{nextPart:new Map,validators:[]}),t=t.nextPart.get(r)}),t},oH=n=>n.isThemeGetter,iH=(n,e)=>e?n.map(([t,r])=>{const s=r.map(o=>typeof o=="string"?e+o:typeof o=="object"?Object.fromEntries(Object.entries(o).map(([i,a])=>[e+i,a])):o);return[t,s]}):n,aH=n=>{if(n<1)return{get:()=>{},set:()=>{}};let e=0,t=new Map,r=new Map;const s=(o,i)=>{t.set(o,i),e++,e>n&&(e=0,r=t,t=new Map)};return{get(o){let i=t.get(o);if(i!==void 0)return i;if((i=r.get(o))!==void 0)return s(o,i),i},set(o,i){t.has(o)?t.set(o,i):s(o,i)}}},pD="!",lH=n=>{const{separator:e,experimentalParseClassName:t}=n,r=e.length===1,s=e[0],o=e.length,i=a=>{const l=[];let c=0,u=0,d;for(let y=0;y<a.length;y++){let b=a[y];if(c===0){if(b===s&&(r||a.slice(y,y+o)===e)){l.push(a.slice(u,y)),u=y+o;continue}if(b==="/"){d=y;continue}}b==="["?c++:b==="]"&&c--}const f=l.length===0?a:a.substring(u),p=f.startsWith(pD),x=p?f.substring(1):f,v=d&&d>u?d-u:void 0;return{modifiers:l,hasImportantModifier:p,baseClassName:x,maybePostfixModifierPosition:v}};return t?a=>t({className:a,parseClassName:i}):i},cH=n=>{if(n.length<=1)return n;const e=[];let t=[];return n.forEach(r=>{r[0]==="["?(e.push(...t.sort(),r),t=[]):t.push(r)}),e.push(...t.sort()),e},uH=n=>({cache:aH(n.cacheSize),parseClassName:lH(n),...nH(n)}),dH=/\s+/,fH=(n,e)=>{const{parseClassName:t,getClassGroupId:r,getConflictingClassGroupIds:s}=e,o=[],i=n.trim().split(dH);let a="";for(let l=i.length-1;l>=0;l-=1){const c=i[l],{modifiers:u,hasImportantModifier:d,baseClassName:f,maybePostfixModifierPosition:p}=t(c);let x=!!p,v=r(x?f.substring(0,p):f);if(!v){if(!x){a=c+(a.length>0?" "+a:a);continue}if(v=r(f),!v){a=c+(a.length>0?" "+a:a);continue}x=!1}const y=cH(u).join(":"),b=d?y+pD:y,w=b+v;if(o.includes(w))continue;o.push(w);const S=s(v,x);for(let k=0;k<S.length;++k){const N=S[k];o.push(b+N)}a=c+(a.length>0?" "+a:a)}return a};function hH(){let n=0,e,t,r="";for(;n<arguments.length;)(e=arguments[n++])&&(t=mD(e))&&(r&&(r+=" "),r+=t);return r}const mD=n=>{if(typeof n=="string")return n;let e,t="";for(let r=0;r<n.length;r++)n[r]&&(e=mD(n[r]))&&(t&&(t+=" "),t+=e);return t};function pH(n,...e){let t,r,s,o=i;function i(l){const c=e.reduce((u,d)=>d(u),n());return t=uH(c),r=t.cache.get,s=t.cache.set,o=a,a(l)}function a(l){const c=r(l);if(c)return c;const u=fH(l,t);return s(l,u),u}return function(){return o(hH.apply(null,arguments))}}const Or=n=>{const e=t=>t[n]||[];return e.isThemeGetter=!0,e},gD=/^\[(?:([a-z-]+):)?(.+)\]$/i,mH=/^\d+\/\d+$/,gH=new Set(["px","full","screen"]),xH=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,vH=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,yH=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,bH=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,wH=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Rc=n=>np(n)||gH.has(n)||mH.test(n),Du=n=>Vp(n,"length",_H),np=n=>!!n&&!Number.isNaN(Number(n)),H3=n=>Vp(n,"number",np),Vm=n=>!!n&&Number.isInteger(Number(n)),CH=n=>n.endsWith("%")&&np(n.slice(0,-1)),Rn=n=>gD.test(n),Au=n=>xH.test(n),kH=new Set(["length","size","percentage"]),SH=n=>Vp(n,kH,xD),NH=n=>Vp(n,"position",xD),EH=new Set(["image","url"]),IH=n=>Vp(n,EH,DH),TH=n=>Vp(n,"",RH),zm=()=>!0,Vp=(n,e,t)=>{const r=gD.exec(n);return r?r[1]?typeof e=="string"?r[1]===e:e.has(r[1]):t(r[2]):!1},_H=n=>vH.test(n)&&!yH.test(n),xD=()=>!1,RH=n=>bH.test(n),DH=n=>wH.test(n),AH=()=>{const n=Or("colors"),e=Or("spacing"),t=Or("blur"),r=Or("brightness"),s=Or("borderColor"),o=Or("borderRadius"),i=Or("borderSpacing"),a=Or("borderWidth"),l=Or("contrast"),c=Or("grayscale"),u=Or("hueRotate"),d=Or("invert"),f=Or("gap"),p=Or("gradientColorStops"),x=Or("gradientColorStopPositions"),v=Or("inset"),y=Or("margin"),b=Or("opacity"),w=Or("padding"),S=Or("saturate"),k=Or("scale"),N=Or("sepia"),I=Or("skew"),T=Or("space"),F=Or("translate"),R=()=>["auto","contain","none"],D=()=>["auto","hidden","clip","visible","scroll"],A=()=>["auto",Rn,e],P=()=>[Rn,e],B=()=>["",Rc,Du],L=()=>["auto",np,Rn],W=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],H=()=>["solid","dashed","dotted","double","none"],G=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],M=()=>["start","end","center","between","around","evenly","stretch"],j=()=>["","0",Rn],z=()=>["auto","avoid","all","avoid-page","page","left","right","column"],V=()=>[np,Rn];return{cacheSize:500,separator:":",theme:{colors:[zm],spacing:[Rc,Du],blur:["none","",Au,Rn],brightness:V(),borderColor:[n],borderRadius:["none","","full",Au,Rn],borderSpacing:P(),borderWidth:B(),contrast:V(),grayscale:j(),hueRotate:V(),invert:j(),gap:P(),gradientColorStops:[n],gradientColorStopPositions:[CH,Du],inset:A(),margin:A(),opacity:V(),padding:P(),saturate:V(),scale:V(),sepia:j(),skew:V(),space:P(),translate:P()},classGroups:{aspect:[{aspect:["auto","square","video",Rn]}],container:["container"],columns:[{columns:[Au]}],"break-after":[{"break-after":z()}],"break-before":[{"break-before":z()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...W(),Rn]}],overflow:[{overflow:D()}],"overflow-x":[{"overflow-x":D()}],"overflow-y":[{"overflow-y":D()}],overscroll:[{overscroll:R()}],"overscroll-x":[{"overscroll-x":R()}],"overscroll-y":[{"overscroll-y":R()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[v]}],"inset-x":[{"inset-x":[v]}],"inset-y":[{"inset-y":[v]}],start:[{start:[v]}],end:[{end:[v]}],top:[{top:[v]}],right:[{right:[v]}],bottom:[{bottom:[v]}],left:[{left:[v]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Vm,Rn]}],basis:[{basis:A()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Rn]}],grow:[{grow:j()}],shrink:[{shrink:j()}],order:[{order:["first","last","none",Vm,Rn]}],"grid-cols":[{"grid-cols":[zm]}],"col-start-end":[{col:["auto",{span:["full",Vm,Rn]},Rn]}],"col-start":[{"col-start":L()}],"col-end":[{"col-end":L()}],"grid-rows":[{"grid-rows":[zm]}],"row-start-end":[{row:["auto",{span:[Vm,Rn]},Rn]}],"row-start":[{"row-start":L()}],"row-end":[{"row-end":L()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Rn]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Rn]}],gap:[{gap:[f]}],"gap-x":[{"gap-x":[f]}],"gap-y":[{"gap-y":[f]}],"justify-content":[{justify:["normal",...M()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...M(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...M(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[w]}],px:[{px:[w]}],py:[{py:[w]}],ps:[{ps:[w]}],pe:[{pe:[w]}],pt:[{pt:[w]}],pr:[{pr:[w]}],pb:[{pb:[w]}],pl:[{pl:[w]}],m:[{m:[y]}],mx:[{mx:[y]}],my:[{my:[y]}],ms:[{ms:[y]}],me:[{me:[y]}],mt:[{mt:[y]}],mr:[{mr:[y]}],mb:[{mb:[y]}],ml:[{ml:[y]}],"space-x":[{"space-x":[T]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[T]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Rn,e]}],"min-w":[{"min-w":[Rn,e,"min","max","fit"]}],"max-w":[{"max-w":[Rn,e,"none","full","min","max","fit","prose",{screen:[Au]},Au]}],h:[{h:[Rn,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Rn,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Rn,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Rn,e,"auto","min","max","fit"]}],"font-size":[{text:["base",Au,Du]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",H3]}],"font-family":[{font:[zm]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Rn]}],"line-clamp":[{"line-clamp":["none",np,H3]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Rc,Rn]}],"list-image":[{"list-image":["none",Rn]}],"list-style-type":[{list:["none","disc","decimal",Rn]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[n]}],"placeholder-opacity":[{"placeholder-opacity":[b]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[n]}],"text-opacity":[{"text-opacity":[b]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...H(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Rc,Du]}],"underline-offset":[{"underline-offset":["auto",Rc,Rn]}],"text-decoration-color":[{decoration:[n]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:P()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Rn]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Rn]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[b]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...W(),NH]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",SH]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},IH]}],"bg-color":[{bg:[n]}],"gradient-from-pos":[{from:[x]}],"gradient-via-pos":[{via:[x]}],"gradient-to-pos":[{to:[x]}],"gradient-from":[{from:[p]}],"gradient-via":[{via:[p]}],"gradient-to":[{to:[p]}],rounded:[{rounded:[o]}],"rounded-s":[{"rounded-s":[o]}],"rounded-e":[{"rounded-e":[o]}],"rounded-t":[{"rounded-t":[o]}],"rounded-r":[{"rounded-r":[o]}],"rounded-b":[{"rounded-b":[o]}],"rounded-l":[{"rounded-l":[o]}],"rounded-ss":[{"rounded-ss":[o]}],"rounded-se":[{"rounded-se":[o]}],"rounded-ee":[{"rounded-ee":[o]}],"rounded-es":[{"rounded-es":[o]}],"rounded-tl":[{"rounded-tl":[o]}],"rounded-tr":[{"rounded-tr":[o]}],"rounded-br":[{"rounded-br":[o]}],"rounded-bl":[{"rounded-bl":[o]}],"border-w":[{border:[a]}],"border-w-x":[{"border-x":[a]}],"border-w-y":[{"border-y":[a]}],"border-w-s":[{"border-s":[a]}],"border-w-e":[{"border-e":[a]}],"border-w-t":[{"border-t":[a]}],"border-w-r":[{"border-r":[a]}],"border-w-b":[{"border-b":[a]}],"border-w-l":[{"border-l":[a]}],"border-opacity":[{"border-opacity":[b]}],"border-style":[{border:[...H(),"hidden"]}],"divide-x":[{"divide-x":[a]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[a]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[b]}],"divide-style":[{divide:H()}],"border-color":[{border:[s]}],"border-color-x":[{"border-x":[s]}],"border-color-y":[{"border-y":[s]}],"border-color-s":[{"border-s":[s]}],"border-color-e":[{"border-e":[s]}],"border-color-t":[{"border-t":[s]}],"border-color-r":[{"border-r":[s]}],"border-color-b":[{"border-b":[s]}],"border-color-l":[{"border-l":[s]}],"divide-color":[{divide:[s]}],"outline-style":[{outline:["",...H()]}],"outline-offset":[{"outline-offset":[Rc,Rn]}],"outline-w":[{outline:[Rc,Du]}],"outline-color":[{outline:[n]}],"ring-w":[{ring:B()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[n]}],"ring-opacity":[{"ring-opacity":[b]}],"ring-offset-w":[{"ring-offset":[Rc,Du]}],"ring-offset-color":[{"ring-offset":[n]}],shadow:[{shadow:["","inner","none",Au,TH]}],"shadow-color":[{shadow:[zm]}],opacity:[{opacity:[b]}],"mix-blend":[{"mix-blend":[...G(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":G()}],filter:[{filter:["","none"]}],blur:[{blur:[t]}],brightness:[{brightness:[r]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",Au,Rn]}],grayscale:[{grayscale:[c]}],"hue-rotate":[{"hue-rotate":[u]}],invert:[{invert:[d]}],saturate:[{saturate:[S]}],sepia:[{sepia:[N]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[t]}],"backdrop-brightness":[{"backdrop-brightness":[r]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[c]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[u]}],"backdrop-invert":[{"backdrop-invert":[d]}],"backdrop-opacity":[{"backdrop-opacity":[b]}],"backdrop-saturate":[{"backdrop-saturate":[S]}],"backdrop-sepia":[{"backdrop-sepia":[N]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[i]}],"border-spacing-x":[{"border-spacing-x":[i]}],"border-spacing-y":[{"border-spacing-y":[i]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Rn]}],duration:[{duration:V()}],ease:[{ease:["linear","in","out","in-out",Rn]}],delay:[{delay:V()}],animate:[{animate:["none","spin","ping","pulse","bounce",Rn]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[k]}],"scale-x":[{"scale-x":[k]}],"scale-y":[{"scale-y":[k]}],rotate:[{rotate:[Vm,Rn]}],"translate-x":[{"translate-x":[F]}],"translate-y":[{"translate-y":[F]}],"skew-x":[{"skew-x":[I]}],"skew-y":[{"skew-y":[I]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Rn]}],accent:[{accent:["auto",n]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Rn]}],"caret-color":[{caret:[n]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":P()}],"scroll-mx":[{"scroll-mx":P()}],"scroll-my":[{"scroll-my":P()}],"scroll-ms":[{"scroll-ms":P()}],"scroll-me":[{"scroll-me":P()}],"scroll-mt":[{"scroll-mt":P()}],"scroll-mr":[{"scroll-mr":P()}],"scroll-mb":[{"scroll-mb":P()}],"scroll-ml":[{"scroll-ml":P()}],"scroll-p":[{"scroll-p":P()}],"scroll-px":[{"scroll-px":P()}],"scroll-py":[{"scroll-py":P()}],"scroll-ps":[{"scroll-ps":P()}],"scroll-pe":[{"scroll-pe":P()}],"scroll-pt":[{"scroll-pt":P()}],"scroll-pr":[{"scroll-pr":P()}],"scroll-pb":[{"scroll-pb":P()}],"scroll-pl":[{"scroll-pl":P()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Rn]}],fill:[{fill:[n,"none"]}],"stroke-w":[{stroke:[Rc,Du,H3]}],stroke:[{stroke:[n,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},$H=pH(AH);function ra(...n){return $H(cD(n))}const FH=KU,vD=_.forwardRef(({className:n,...e},t)=>m.jsx(nD,{ref:t,className:ra("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",n),...e}));vD.displayName=nD.displayName;const PH=uD("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),yD=_.forwardRef(({className:n,variant:e,...t},r)=>m.jsx(rD,{ref:r,className:ra(PH({variant:e}),n),...t}));yD.displayName=rD.displayName;const OH=_.forwardRef(({className:n,...e},t)=>m.jsx(iD,{ref:t,className:ra("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",n),...e}));OH.displayName=iD.displayName;const bD=_.forwardRef(({className:n,...e},t)=>m.jsx(aD,{ref:t,className:ra("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",n),"toast-close":"",...e,children:m.jsx(fD,{className:"h-4 w-4"})}));bD.displayName=aD.displayName;const wD=_.forwardRef(({className:n,...e},t)=>m.jsx(sD,{ref:t,className:ra("text-sm font-semibold",n),...e}));wD.displayName=sD.displayName;const CD=_.forwardRef(({className:n,...e},t)=>m.jsx(oD,{ref:t,className:ra("text-sm opacity-90",n),...e}));CD.displayName=oD.displayName;function MH(){const{toasts:n}=pd();return m.jsxs(FH,{children:[n.map(function({id:e,title:t,description:r,action:s,...o}){return m.jsxs(yD,{...o,children:[m.jsxs("div",{className:"grid gap-1",children:[t&&m.jsx(wD,{children:t}),r&&m.jsx(CD,{children:r})]}),s,m.jsx(bD,{})]},e)}),m.jsx(vD,{})]})}var Vx={},HE;function LH(){if(HE)return Vx;HE=1;var n=OR();return Vx.createRoot=n.createRoot,Vx.hydrateRoot=n.hydrateRoot,Vx}var jH=LH(),BH=(n,e,t,r,s,o,i,a)=>{let l=document.documentElement,c=["light","dark"];function u(p){(Array.isArray(n)?n:[n]).forEach(x=>{let v=x==="class",y=v&&o?s.map(b=>o[b]||b):s;v?(l.classList.remove(...y),l.classList.add(o&&o[p]?o[p]:p)):l.setAttribute(x,p)}),d(p)}function d(p){a&&c.includes(p)&&(l.style.colorScheme=p)}function f(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}if(r)u(r);else try{let p=localStorage.getItem(e)||t,x=i&&p==="system"?f():p;u(x)}catch{}},VH=_.createContext(void 0),zH={setTheme:n=>{},themes:[]},WH=()=>{var n;return(n=_.useContext(VH))!=null?n:zH};_.memo(({forcedTheme:n,storageKey:e,attribute:t,enableSystem:r,enableColorScheme:s,defaultTheme:o,value:i,themes:a,nonce:l,scriptProps:c})=>{let u=JSON.stringify([t,e,o,n,a,i,r,s]).slice(1,-1);return _.createElement("script",{...c,suppressHydrationWarning:!0,nonce:typeof window>"u"?l:"",dangerouslySetInnerHTML:{__html:`(${BH.toString()})(${u})`}})});var UH=n=>{switch(n){case"success":return qH;case"info":return XH;case"warning":return KH;case"error":return YH;default:return null}},HH=Array(12).fill(0),GH=({visible:n,className:e})=>Ve.createElement("div",{className:["sonner-loading-wrapper",e].filter(Boolean).join(" "),"data-visible":n},Ve.createElement("div",{className:"sonner-spinner"},HH.map((t,r)=>Ve.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${r}`})))),qH=Ve.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Ve.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),KH=Ve.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},Ve.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),XH=Ve.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Ve.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),YH=Ve.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Ve.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),ZH=Ve.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},Ve.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),Ve.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),JH=()=>{let[n,e]=Ve.useState(document.hidden);return Ve.useEffect(()=>{let t=()=>{e(document.hidden)};return document.addEventListener("visibilitychange",t),()=>window.removeEventListener("visibilitychange",t)},[]),n},F4=1,QH=class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{let t=this.subscribers.indexOf(e);this.subscribers.splice(t,1)}),this.publish=e=>{this.subscribers.forEach(t=>t(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var t;let{message:r,...s}=e,o=typeof e?.id=="number"||((t=e.id)==null?void 0:t.length)>0?e.id:F4++,i=this.toasts.find(l=>l.id===o),a=e.dismissible===void 0?!0:e.dismissible;return this.dismissedToasts.has(o)&&this.dismissedToasts.delete(o),i?this.toasts=this.toasts.map(l=>l.id===o?(this.publish({...l,...e,id:o,title:r}),{...l,...e,id:o,dismissible:a,title:r}):l):this.addToast({title:r,...s,dismissible:a,id:o}),o},this.dismiss=e=>(this.dismissedToasts.add(e),e||this.toasts.forEach(t=>{this.subscribers.forEach(r=>r({id:t.id,dismiss:!0}))}),this.subscribers.forEach(t=>t({id:e,dismiss:!0})),e),this.message=(e,t)=>this.create({...t,message:e}),this.error=(e,t)=>this.create({...t,message:e,type:"error"}),this.success=(e,t)=>this.create({...t,type:"success",message:e}),this.info=(e,t)=>this.create({...t,type:"info",message:e}),this.warning=(e,t)=>this.create({...t,type:"warning",message:e}),this.loading=(e,t)=>this.create({...t,type:"loading",message:e}),this.promise=(e,t)=>{if(!t)return;let r;t.loading!==void 0&&(r=this.create({...t,promise:e,type:"loading",message:t.loading,description:typeof t.description!="function"?t.description:void 0}));let s=e instanceof Promise?e:e(),o=r!==void 0,i,a=s.then(async c=>{if(i=["resolve",c],Ve.isValidElement(c))o=!1,this.create({id:r,type:"default",message:c});else if(tG(c)&&!c.ok){o=!1;let u=typeof t.error=="function"?await t.error(`HTTP error! status: ${c.status}`):t.error,d=typeof t.description=="function"?await t.description(`HTTP error! status: ${c.status}`):t.description;this.create({id:r,type:"error",message:u,description:d})}else if(t.success!==void 0){o=!1;let u=typeof t.success=="function"?await t.success(c):t.success,d=typeof t.description=="function"?await t.description(c):t.description;this.create({id:r,type:"success",message:u,description:d})}}).catch(async c=>{if(i=["reject",c],t.error!==void 0){o=!1;let u=typeof t.error=="function"?await t.error(c):t.error,d=typeof t.description=="function"?await t.description(c):t.description;this.create({id:r,type:"error",message:u,description:d})}}).finally(()=>{var c;o&&(this.dismiss(r),r=void 0),(c=t.finally)==null||c.call(t)}),l=()=>new Promise((c,u)=>a.then(()=>i[0]==="reject"?u(i[1]):c(i[1])).catch(u));return typeof r!="string"&&typeof r!="number"?{unwrap:l}:Object.assign(r,{unwrap:l})},this.custom=(e,t)=>{let r=t?.id||F4++;return this.create({jsx:e(r),id:r,...t}),r},this.getActiveToasts=()=>this.toasts.filter(e=>!this.dismissedToasts.has(e.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},gi=new QH,eG=(n,e)=>{let t=e?.id||F4++;return gi.addToast({title:n,...e,id:t}),t},tG=n=>n&&typeof n=="object"&&"ok"in n&&typeof n.ok=="boolean"&&"status"in n&&typeof n.status=="number",nG=eG,rG=()=>gi.toasts,sG=()=>gi.getActiveToasts();Object.assign(nG,{success:gi.success,info:gi.info,warning:gi.warning,error:gi.error,custom:gi.custom,message:gi.message,promise:gi.promise,dismiss:gi.dismiss,loading:gi.loading},{getHistory:rG,getToasts:sG});function oG(n,{insertAt:e}={}){if(typeof document>"u")return;let t=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",e==="top"&&t.firstChild?t.insertBefore(r,t.firstChild):t.appendChild(r),r.styleSheet?r.styleSheet.cssText=n:r.appendChild(document.createTextNode(n))}oG(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function zx(n){return n.label!==void 0}var iG=3,aG="32px",lG="16px",GE=4e3,cG=356,uG=14,dG=20,fG=200;function Ga(...n){return n.filter(Boolean).join(" ")}function hG(n){let[e,t]=n.split("-"),r=[];return e&&r.push(e),t&&r.push(t),r}var pG=n=>{var e,t,r,s,o,i,a,l,c,u,d;let{invert:f,toast:p,unstyled:x,interacting:v,setHeights:y,visibleToasts:b,heights:w,index:S,toasts:k,expanded:N,removeToast:I,defaultRichColors:T,closeButton:F,style:R,cancelButtonStyle:D,actionButtonStyle:A,className:P="",descriptionClassName:B="",duration:L,position:W,gap:H,loadingIcon:G,expandByDefault:M,classNames:j,icons:z,closeButtonAriaLabel:V="Close toast",pauseWhenPageIsHidden:K}=n,[J,oe]=Ve.useState(null),[Z,de]=Ve.useState(null),[pe,Ce]=Ve.useState(!1),[Ae,ze]=Ve.useState(!1),[et,gt]=Ve.useState(!1),[dt,Ct]=Ve.useState(!1),[lt,bt]=Ve.useState(!1),[rn,Ft]=Ve.useState(0),[vn,te]=Ve.useState(0),q=Ve.useRef(p.duration||L||GE),ke=Ve.useRef(null),He=Ve.useRef(null),Ke=S===0,Be=S+1<=b,ct=p.type,Nt=p.dismissible!==!1,Rt=p.className||"",sn=p.descriptionClassName||"",Kn=Ve.useMemo(()=>w.findIndex(xt=>xt.toastId===p.id)||0,[w,p.id]),Ee=Ve.useMemo(()=>{var xt;return(xt=p.closeButton)!=null?xt:F},[p.closeButton,F]),Ge=Ve.useMemo(()=>p.duration||L||GE,[p.duration,L]),Q=Ve.useRef(0),ht=Ve.useRef(0),it=Ve.useRef(0),Yt=Ve.useRef(null),[cn,Lt]=W.split("-"),On=Ve.useMemo(()=>w.reduce((xt,In,_n)=>_n>=Kn?xt:xt+In.height,0),[w,Kn]),An=JH(),Jn=p.invert||f,nr=ct==="loading";ht.current=Ve.useMemo(()=>Kn*H+On,[Kn,On]),Ve.useEffect(()=>{q.current=Ge},[Ge]),Ve.useEffect(()=>{Ce(!0)},[]),Ve.useEffect(()=>{let xt=He.current;if(xt){let In=xt.getBoundingClientRect().height;return te(In),y(_n=>[{toastId:p.id,height:In,position:p.position},..._n]),()=>y(_n=>_n.filter(xr=>xr.toastId!==p.id))}},[y,p.id]),Ve.useLayoutEffect(()=>{if(!pe)return;let xt=He.current,In=xt.style.height;xt.style.height="auto";let _n=xt.getBoundingClientRect().height;xt.style.height=In,te(_n),y(xr=>xr.find(cr=>cr.toastId===p.id)?xr.map(cr=>cr.toastId===p.id?{...cr,height:_n}:cr):[{toastId:p.id,height:_n,position:p.position},...xr])},[pe,p.title,p.description,y,p.id]);let gr=Ve.useCallback(()=>{ze(!0),Ft(ht.current),y(xt=>xt.filter(In=>In.toastId!==p.id)),setTimeout(()=>{I(p)},fG)},[p,I,y,ht]);Ve.useEffect(()=>{if(p.promise&&ct==="loading"||p.duration===1/0||p.type==="loading")return;let xt;return N||v||K&&An?(()=>{if(it.current<Q.current){let In=new Date().getTime()-Q.current;q.current=q.current-In}it.current=new Date().getTime()})():q.current!==1/0&&(Q.current=new Date().getTime(),xt=setTimeout(()=>{var In;(In=p.onAutoClose)==null||In.call(p,p),gr()},q.current)),()=>clearTimeout(xt)},[N,v,p,ct,K,An,gr]),Ve.useEffect(()=>{p.delete&&gr()},[gr,p.delete]);function _i(){var xt,In,_n;return z!=null&&z.loading?Ve.createElement("div",{className:Ga(j?.loader,(xt=p?.classNames)==null?void 0:xt.loader,"sonner-loader"),"data-visible":ct==="loading"},z.loading):G?Ve.createElement("div",{className:Ga(j?.loader,(In=p?.classNames)==null?void 0:In.loader,"sonner-loader"),"data-visible":ct==="loading"},G):Ve.createElement(GH,{className:Ga(j?.loader,(_n=p?.classNames)==null?void 0:_n.loader),visible:ct==="loading"})}return Ve.createElement("li",{tabIndex:0,ref:He,className:Ga(P,Rt,j?.toast,(e=p?.classNames)==null?void 0:e.toast,j?.default,j?.[ct],(t=p?.classNames)==null?void 0:t[ct]),"data-sonner-toast":"","data-rich-colors":(r=p.richColors)!=null?r:T,"data-styled":!(p.jsx||p.unstyled||x),"data-mounted":pe,"data-promise":!!p.promise,"data-swiped":lt,"data-removed":Ae,"data-visible":Be,"data-y-position":cn,"data-x-position":Lt,"data-index":S,"data-front":Ke,"data-swiping":et,"data-dismissible":Nt,"data-type":ct,"data-invert":Jn,"data-swipe-out":dt,"data-swipe-direction":Z,"data-expanded":!!(N||M&&pe),style:{"--index":S,"--toasts-before":S,"--z-index":k.length-S,"--offset":`${Ae?rn:ht.current}px`,"--initial-height":M?"auto":`${vn}px`,...R,...p.style},onDragEnd:()=>{gt(!1),oe(null),Yt.current=null},onPointerDown:xt=>{nr||!Nt||(ke.current=new Date,Ft(ht.current),xt.target.setPointerCapture(xt.pointerId),xt.target.tagName!=="BUTTON"&&(gt(!0),Yt.current={x:xt.clientX,y:xt.clientY}))},onPointerUp:()=>{var xt,In,_n,xr;if(dt||!Nt)return;Yt.current=null;let cr=Number(((xt=He.current)==null?void 0:xt.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),kr=Number(((In=He.current)==null?void 0:In.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),fr=new Date().getTime()-((_n=ke.current)==null?void 0:_n.getTime()),bn=J==="x"?cr:kr,Sr=Math.abs(bn)/fr;if(Math.abs(bn)>=dG||Sr>.11){Ft(ht.current),(xr=p.onDismiss)==null||xr.call(p,p),de(J==="x"?cr>0?"right":"left":kr>0?"down":"up"),gr(),Ct(!0),bt(!1);return}gt(!1),oe(null)},onPointerMove:xt=>{var In,_n,xr,cr;if(!Yt.current||!Nt||((In=window.getSelection())==null?void 0:In.toString().length)>0)return;let kr=xt.clientY-Yt.current.y,fr=xt.clientX-Yt.current.x,bn=(_n=n.swipeDirections)!=null?_n:hG(W);!J&&(Math.abs(fr)>1||Math.abs(kr)>1)&&oe(Math.abs(fr)>Math.abs(kr)?"x":"y");let Sr={x:0,y:0};J==="y"?(bn.includes("top")||bn.includes("bottom"))&&(bn.includes("top")&&kr<0||bn.includes("bottom")&&kr>0)&&(Sr.y=kr):J==="x"&&(bn.includes("left")||bn.includes("right"))&&(bn.includes("left")&&fr<0||bn.includes("right")&&fr>0)&&(Sr.x=fr),(Math.abs(Sr.x)>0||Math.abs(Sr.y)>0)&&bt(!0),(xr=He.current)==null||xr.style.setProperty("--swipe-amount-x",`${Sr.x}px`),(cr=He.current)==null||cr.style.setProperty("--swipe-amount-y",`${Sr.y}px`)}},Ee&&!p.jsx?Ve.createElement("button",{"aria-label":V,"data-disabled":nr,"data-close-button":!0,onClick:nr||!Nt?()=>{}:()=>{var xt;gr(),(xt=p.onDismiss)==null||xt.call(p,p)},className:Ga(j?.closeButton,(s=p?.classNames)==null?void 0:s.closeButton)},(o=z?.close)!=null?o:ZH):null,p.jsx||_.isValidElement(p.title)?p.jsx?p.jsx:typeof p.title=="function"?p.title():p.title:Ve.createElement(Ve.Fragment,null,ct||p.icon||p.promise?Ve.createElement("div",{"data-icon":"",className:Ga(j?.icon,(i=p?.classNames)==null?void 0:i.icon)},p.promise||p.type==="loading"&&!p.icon?p.icon||_i():null,p.type!=="loading"?p.icon||z?.[ct]||UH(ct):null):null,Ve.createElement("div",{"data-content":"",className:Ga(j?.content,(a=p?.classNames)==null?void 0:a.content)},Ve.createElement("div",{"data-title":"",className:Ga(j?.title,(l=p?.classNames)==null?void 0:l.title)},typeof p.title=="function"?p.title():p.title),p.description?Ve.createElement("div",{"data-description":"",className:Ga(B,sn,j?.description,(c=p?.classNames)==null?void 0:c.description)},typeof p.description=="function"?p.description():p.description):null),_.isValidElement(p.cancel)?p.cancel:p.cancel&&zx(p.cancel)?Ve.createElement("button",{"data-button":!0,"data-cancel":!0,style:p.cancelButtonStyle||D,onClick:xt=>{var In,_n;zx(p.cancel)&&Nt&&((_n=(In=p.cancel).onClick)==null||_n.call(In,xt),gr())},className:Ga(j?.cancelButton,(u=p?.classNames)==null?void 0:u.cancelButton)},p.cancel.label):null,_.isValidElement(p.action)?p.action:p.action&&zx(p.action)?Ve.createElement("button",{"data-button":!0,"data-action":!0,style:p.actionButtonStyle||A,onClick:xt=>{var In,_n;zx(p.action)&&((_n=(In=p.action).onClick)==null||_n.call(In,xt),!xt.defaultPrevented&&gr())},className:Ga(j?.actionButton,(d=p?.classNames)==null?void 0:d.actionButton)},p.action.label):null))};function qE(){if(typeof window>"u"||typeof document>"u")return"ltr";let n=document.documentElement.getAttribute("dir");return n==="auto"||!n?window.getComputedStyle(document.documentElement).direction:n}function mG(n,e){let t={};return[n,e].forEach((r,s)=>{let o=s===1,i=o?"--mobile-offset":"--offset",a=o?lG:aG;function l(c){["top","right","bottom","left"].forEach(u=>{t[`${i}-${u}`]=typeof c=="number"?`${c}px`:c})}typeof r=="number"||typeof r=="string"?l(r):typeof r=="object"?["top","right","bottom","left"].forEach(c=>{r[c]===void 0?t[`${i}-${c}`]=a:t[`${i}-${c}`]=typeof r[c]=="number"?`${r[c]}px`:r[c]}):l(a)}),t}var gG=_.forwardRef(function(n,e){let{invert:t,position:r="bottom-right",hotkey:s=["altKey","KeyT"],expand:o,closeButton:i,className:a,offset:l,mobileOffset:c,theme:u="light",richColors:d,duration:f,style:p,visibleToasts:x=iG,toastOptions:v,dir:y=qE(),gap:b=uG,loadingIcon:w,icons:S,containerAriaLabel:k="Notifications",pauseWhenPageIsHidden:N}=n,[I,T]=Ve.useState([]),F=Ve.useMemo(()=>Array.from(new Set([r].concat(I.filter(K=>K.position).map(K=>K.position)))),[I,r]),[R,D]=Ve.useState([]),[A,P]=Ve.useState(!1),[B,L]=Ve.useState(!1),[W,H]=Ve.useState(u!=="system"?u:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),G=Ve.useRef(null),M=s.join("+").replace(/Key/g,"").replace(/Digit/g,""),j=Ve.useRef(null),z=Ve.useRef(!1),V=Ve.useCallback(K=>{T(J=>{var oe;return(oe=J.find(Z=>Z.id===K.id))!=null&&oe.delete||gi.dismiss(K.id),J.filter(({id:Z})=>Z!==K.id)})},[]);return Ve.useEffect(()=>gi.subscribe(K=>{if(K.dismiss){T(J=>J.map(oe=>oe.id===K.id?{...oe,delete:!0}:oe));return}setTimeout(()=>{MR.flushSync(()=>{T(J=>{let oe=J.findIndex(Z=>Z.id===K.id);return oe!==-1?[...J.slice(0,oe),{...J[oe],...K},...J.slice(oe+1)]:[K,...J]})})})}),[]),Ve.useEffect(()=>{if(u!=="system"){H(u);return}if(u==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?H("dark"):H("light")),typeof window>"u")return;let K=window.matchMedia("(prefers-color-scheme: dark)");try{K.addEventListener("change",({matches:J})=>{H(J?"dark":"light")})}catch{K.addListener(({matches:oe})=>{try{H(oe?"dark":"light")}catch(Z){console.error(Z)}})}},[u]),Ve.useEffect(()=>{I.length<=1&&P(!1)},[I]),Ve.useEffect(()=>{let K=J=>{var oe,Z;s.every(de=>J[de]||J.code===de)&&(P(!0),(oe=G.current)==null||oe.focus()),J.code==="Escape"&&(document.activeElement===G.current||(Z=G.current)!=null&&Z.contains(document.activeElement))&&P(!1)};return document.addEventListener("keydown",K),()=>document.removeEventListener("keydown",K)},[s]),Ve.useEffect(()=>{if(G.current)return()=>{j.current&&(j.current.focus({preventScroll:!0}),j.current=null,z.current=!1)}},[G.current]),Ve.createElement("section",{ref:e,"aria-label":`${k} ${M}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},F.map((K,J)=>{var oe;let[Z,de]=K.split("-");return I.length?Ve.createElement("ol",{key:K,dir:y==="auto"?qE():y,tabIndex:-1,ref:G,className:a,"data-sonner-toaster":!0,"data-theme":W,"data-y-position":Z,"data-lifted":A&&I.length>1&&!o,"data-x-position":de,style:{"--front-toast-height":`${((oe=R[0])==null?void 0:oe.height)||0}px`,"--width":`${cG}px`,"--gap":`${b}px`,...p,...mG(l,c)},onBlur:pe=>{z.current&&!pe.currentTarget.contains(pe.relatedTarget)&&(z.current=!1,j.current&&(j.current.focus({preventScroll:!0}),j.current=null))},onFocus:pe=>{pe.target instanceof HTMLElement&&pe.target.dataset.dismissible==="false"||z.current||(z.current=!0,j.current=pe.relatedTarget)},onMouseEnter:()=>P(!0),onMouseMove:()=>P(!0),onMouseLeave:()=>{B||P(!1)},onDragEnd:()=>P(!1),onPointerDown:pe=>{pe.target instanceof HTMLElement&&pe.target.dataset.dismissible==="false"||L(!0)},onPointerUp:()=>L(!1)},I.filter(pe=>!pe.position&&J===0||pe.position===K).map((pe,Ce)=>{var Ae,ze;return Ve.createElement(pG,{key:pe.id,icons:S,index:Ce,toast:pe,defaultRichColors:d,duration:(Ae=v?.duration)!=null?Ae:f,className:v?.className,descriptionClassName:v?.descriptionClassName,invert:t,visibleToasts:x,closeButton:(ze=v?.closeButton)!=null?ze:i,interacting:B,position:K,style:v?.style,unstyled:v?.unstyled,classNames:v?.classNames,cancelButtonStyle:v?.cancelButtonStyle,actionButtonStyle:v?.actionButtonStyle,removeToast:V,toasts:I.filter(et=>et.position==pe.position),heights:R.filter(et=>et.position==pe.position),setHeights:D,expandByDefault:o,gap:b,loadingIcon:w,expanded:A,pauseWhenPageIsHidden:N,swipeDirections:n.swipeDirections})})):null}))});const xG=({...n})=>{const{theme:e="system"}=WH();return m.jsx(gG,{theme:e,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...n})};var vG=ly[" useId ".trim().toString()]||(()=>{}),yG=0;function G3(n){const[e,t]=_.useState(vG());return jc(()=>{t(r=>r??String(yG++))},[n]),n||(e?`radix-${e}`:"")}const bG=["top","right","bottom","left"],nd=Math.min,Wi=Math.max,qv=Math.round,Wx=Math.floor,Kl=n=>({x:n,y:n}),wG={left:"right",right:"left",bottom:"top",top:"bottom"},CG={start:"end",end:"start"};function P4(n,e,t){return Wi(n,nd(e,t))}function Bc(n,e){return typeof n=="function"?n(e):n}function Vc(n){return n.split("-")[0]}function zp(n){return n.split("-")[1]}function vk(n){return n==="x"?"y":"x"}function yk(n){return n==="y"?"height":"width"}const kG=new Set(["top","bottom"]);function Hl(n){return kG.has(Vc(n))?"y":"x"}function bk(n){return vk(Hl(n))}function SG(n,e,t){t===void 0&&(t=!1);const r=zp(n),s=bk(n),o=yk(s);let i=s==="x"?r===(t?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[o]>e.floating[o]&&(i=Kv(i)),[i,Kv(i)]}function NG(n){const e=Kv(n);return[O4(n),e,O4(e)]}function O4(n){return n.replace(/start|end/g,e=>CG[e])}const KE=["left","right"],XE=["right","left"],EG=["top","bottom"],IG=["bottom","top"];function TG(n,e,t){switch(n){case"top":case"bottom":return t?e?XE:KE:e?KE:XE;case"left":case"right":return e?EG:IG;default:return[]}}function _G(n,e,t,r){const s=zp(n);let o=TG(Vc(n),t==="start",r);return s&&(o=o.map(i=>i+"-"+s),e&&(o=o.concat(o.map(O4)))),o}function Kv(n){return n.replace(/left|right|bottom|top/g,e=>wG[e])}function RG(n){return{top:0,right:0,bottom:0,left:0,...n}}function kD(n){return typeof n!="number"?RG(n):{top:n,right:n,bottom:n,left:n}}function Xv(n){const{x:e,y:t,width:r,height:s}=n;return{width:r,height:s,top:t,left:e,right:e+r,bottom:t+s,x:e,y:t}}function YE(n,e,t){let{reference:r,floating:s}=n;const o=Hl(e),i=bk(e),a=yk(i),l=Vc(e),c=o==="y",u=r.x+r.width/2-s.width/2,d=r.y+r.height/2-s.height/2,f=r[a]/2-s[a]/2;let p;switch(l){case"top":p={x:u,y:r.y-s.height};break;case"bottom":p={x:u,y:r.y+r.height};break;case"right":p={x:r.x+r.width,y:d};break;case"left":p={x:r.x-s.width,y:d};break;default:p={x:r.x,y:r.y}}switch(zp(e)){case"start":p[i]-=f*(t&&c?-1:1);break;case"end":p[i]+=f*(t&&c?-1:1);break}return p}const DG=async(n,e,t)=>{const{placement:r="bottom",strategy:s="absolute",middleware:o=[],platform:i}=t,a=o.filter(Boolean),l=await(i.isRTL==null?void 0:i.isRTL(e));let c=await i.getElementRects({reference:n,floating:e,strategy:s}),{x:u,y:d}=YE(c,r,l),f=r,p={},x=0;for(let v=0;v<a.length;v++){const{name:y,fn:b}=a[v],{x:w,y:S,data:k,reset:N}=await b({x:u,y:d,initialPlacement:r,placement:f,strategy:s,middlewareData:p,rects:c,platform:i,elements:{reference:n,floating:e}});u=w??u,d=S??d,p={...p,[y]:{...p[y],...k}},N&&x<=50&&(x++,typeof N=="object"&&(N.placement&&(f=N.placement),N.rects&&(c=N.rects===!0?await i.getElementRects({reference:n,floating:e,strategy:s}):N.rects),{x:u,y:d}=YE(c,f,l)),v=-1)}return{x:u,y:d,placement:f,strategy:s,middlewareData:p}};async function gg(n,e){var t;e===void 0&&(e={});const{x:r,y:s,platform:o,rects:i,elements:a,strategy:l}=n,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:f=!1,padding:p=0}=Bc(e,n),x=kD(p),y=a[f?d==="floating"?"reference":"floating":d],b=Xv(await o.getClippingRect({element:(t=await(o.isElement==null?void 0:o.isElement(y)))==null||t?y:y.contextElement||await(o.getDocumentElement==null?void 0:o.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),w=d==="floating"?{x:r,y:s,width:i.floating.width,height:i.floating.height}:i.reference,S=await(o.getOffsetParent==null?void 0:o.getOffsetParent(a.floating)),k=await(o.isElement==null?void 0:o.isElement(S))?await(o.getScale==null?void 0:o.getScale(S))||{x:1,y:1}:{x:1,y:1},N=Xv(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:w,offsetParent:S,strategy:l}):w);return{top:(b.top-N.top+x.top)/k.y,bottom:(N.bottom-b.bottom+x.bottom)/k.y,left:(b.left-N.left+x.left)/k.x,right:(N.right-b.right+x.right)/k.x}}const AG=n=>({name:"arrow",options:n,async fn(e){const{x:t,y:r,placement:s,rects:o,platform:i,elements:a,middlewareData:l}=e,{element:c,padding:u=0}=Bc(n,e)||{};if(c==null)return{};const d=kD(u),f={x:t,y:r},p=bk(s),x=yk(p),v=await i.getDimensions(c),y=p==="y",b=y?"top":"left",w=y?"bottom":"right",S=y?"clientHeight":"clientWidth",k=o.reference[x]+o.reference[p]-f[p]-o.floating[x],N=f[p]-o.reference[p],I=await(i.getOffsetParent==null?void 0:i.getOffsetParent(c));let T=I?I[S]:0;(!T||!await(i.isElement==null?void 0:i.isElement(I)))&&(T=a.floating[S]||o.floating[x]);const F=k/2-N/2,R=T/2-v[x]/2-1,D=nd(d[b],R),A=nd(d[w],R),P=D,B=T-v[x]-A,L=T/2-v[x]/2+F,W=P4(P,L,B),H=!l.arrow&&zp(s)!=null&&L!==W&&o.reference[x]/2-(L<P?D:A)-v[x]/2<0,G=H?L<P?L-P:L-B:0;return{[p]:f[p]+G,data:{[p]:W,centerOffset:L-W-G,...H&&{alignmentOffset:G}},reset:H}}}),$G=function(n){return n===void 0&&(n={}),{name:"flip",options:n,async fn(e){var t,r;const{placement:s,middlewareData:o,rects:i,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:f,fallbackStrategy:p="bestFit",fallbackAxisSideDirection:x="none",flipAlignment:v=!0,...y}=Bc(n,e);if((t=o.arrow)!=null&&t.alignmentOffset)return{};const b=Vc(s),w=Hl(a),S=Vc(a)===a,k=await(l.isRTL==null?void 0:l.isRTL(c.floating)),N=f||(S||!v?[Kv(a)]:NG(a)),I=x!=="none";!f&&I&&N.push(..._G(a,v,x,k));const T=[a,...N],F=await gg(e,y),R=[];let D=((r=o.flip)==null?void 0:r.overflows)||[];if(u&&R.push(F[b]),d){const L=SG(s,i,k);R.push(F[L[0]],F[L[1]])}if(D=[...D,{placement:s,overflows:R}],!R.every(L=>L<=0)){var A,P;const L=(((A=o.flip)==null?void 0:A.index)||0)+1,W=T[L];if(W&&(!(d==="alignment"?w!==Hl(W):!1)||D.every(M=>Hl(M.placement)===w?M.overflows[0]>0:!0)))return{data:{index:L,overflows:D},reset:{placement:W}};let H=(P=D.filter(G=>G.overflows[0]<=0).sort((G,M)=>G.overflows[1]-M.overflows[1])[0])==null?void 0:P.placement;if(!H)switch(p){case"bestFit":{var B;const G=(B=D.filter(M=>{if(I){const j=Hl(M.placement);return j===w||j==="y"}return!0}).map(M=>[M.placement,M.overflows.filter(j=>j>0).reduce((j,z)=>j+z,0)]).sort((M,j)=>M[1]-j[1])[0])==null?void 0:B[0];G&&(H=G);break}case"initialPlacement":H=a;break}if(s!==H)return{reset:{placement:H}}}return{}}}};function ZE(n,e){return{top:n.top-e.height,right:n.right-e.width,bottom:n.bottom-e.height,left:n.left-e.width}}function JE(n){return bG.some(e=>n[e]>=0)}const FG=function(n){return n===void 0&&(n={}),{name:"hide",options:n,async fn(e){const{rects:t}=e,{strategy:r="referenceHidden",...s}=Bc(n,e);switch(r){case"referenceHidden":{const o=await gg(e,{...s,elementContext:"reference"}),i=ZE(o,t.reference);return{data:{referenceHiddenOffsets:i,referenceHidden:JE(i)}}}case"escaped":{const o=await gg(e,{...s,altBoundary:!0}),i=ZE(o,t.floating);return{data:{escapedOffsets:i,escaped:JE(i)}}}default:return{}}}}},SD=new Set(["left","top"]);async function PG(n,e){const{placement:t,platform:r,elements:s}=n,o=await(r.isRTL==null?void 0:r.isRTL(s.floating)),i=Vc(t),a=zp(t),l=Hl(t)==="y",c=SD.has(i)?-1:1,u=o&&l?-1:1,d=Bc(e,n);let{mainAxis:f,crossAxis:p,alignmentAxis:x}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&typeof x=="number"&&(p=a==="end"?x*-1:x),l?{x:p*u,y:f*c}:{x:f*c,y:p*u}}const OG=function(n){return n===void 0&&(n=0),{name:"offset",options:n,async fn(e){var t,r;const{x:s,y:o,placement:i,middlewareData:a}=e,l=await PG(e,n);return i===((t=a.offset)==null?void 0:t.placement)&&(r=a.arrow)!=null&&r.alignmentOffset?{}:{x:s+l.x,y:o+l.y,data:{...l,placement:i}}}}},MG=function(n){return n===void 0&&(n={}),{name:"shift",options:n,async fn(e){const{x:t,y:r,placement:s}=e,{mainAxis:o=!0,crossAxis:i=!1,limiter:a={fn:y=>{let{x:b,y:w}=y;return{x:b,y:w}}},...l}=Bc(n,e),c={x:t,y:r},u=await gg(e,l),d=Hl(Vc(s)),f=vk(d);let p=c[f],x=c[d];if(o){const y=f==="y"?"top":"left",b=f==="y"?"bottom":"right",w=p+u[y],S=p-u[b];p=P4(w,p,S)}if(i){const y=d==="y"?"top":"left",b=d==="y"?"bottom":"right",w=x+u[y],S=x-u[b];x=P4(w,x,S)}const v=a.fn({...e,[f]:p,[d]:x});return{...v,data:{x:v.x-t,y:v.y-r,enabled:{[f]:o,[d]:i}}}}}},LG=function(n){return n===void 0&&(n={}),{options:n,fn(e){const{x:t,y:r,placement:s,rects:o,middlewareData:i}=e,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=Bc(n,e),u={x:t,y:r},d=Hl(s),f=vk(d);let p=u[f],x=u[d];const v=Bc(a,e),y=typeof v=="number"?{mainAxis:v,crossAxis:0}:{mainAxis:0,crossAxis:0,...v};if(l){const S=f==="y"?"height":"width",k=o.reference[f]-o.floating[S]+y.mainAxis,N=o.reference[f]+o.reference[S]-y.mainAxis;p<k?p=k:p>N&&(p=N)}if(c){var b,w;const S=f==="y"?"width":"height",k=SD.has(Vc(s)),N=o.reference[d]-o.floating[S]+(k&&((b=i.offset)==null?void 0:b[d])||0)+(k?0:y.crossAxis),I=o.reference[d]+o.reference[S]+(k?0:((w=i.offset)==null?void 0:w[d])||0)-(k?y.crossAxis:0);x<N?x=N:x>I&&(x=I)}return{[f]:p,[d]:x}}}},jG=function(n){return n===void 0&&(n={}),{name:"size",options:n,async fn(e){var t,r;const{placement:s,rects:o,platform:i,elements:a}=e,{apply:l=()=>{},...c}=Bc(n,e),u=await gg(e,c),d=Vc(s),f=zp(s),p=Hl(s)==="y",{width:x,height:v}=o.floating;let y,b;d==="top"||d==="bottom"?(y=d,b=f===(await(i.isRTL==null?void 0:i.isRTL(a.floating))?"start":"end")?"left":"right"):(b=d,y=f==="end"?"top":"bottom");const w=v-u.top-u.bottom,S=x-u.left-u.right,k=nd(v-u[y],w),N=nd(x-u[b],S),I=!e.middlewareData.shift;let T=k,F=N;if((t=e.middlewareData.shift)!=null&&t.enabled.x&&(F=S),(r=e.middlewareData.shift)!=null&&r.enabled.y&&(T=w),I&&!f){const D=Wi(u.left,0),A=Wi(u.right,0),P=Wi(u.top,0),B=Wi(u.bottom,0);p?F=x-2*(D!==0||A!==0?D+A:Wi(u.left,u.right)):T=v-2*(P!==0||B!==0?P+B:Wi(u.top,u.bottom))}await l({...e,availableWidth:F,availableHeight:T});const R=await i.getDimensions(a.floating);return x!==R.width||v!==R.height?{reset:{rects:!0}}:{}}}};function hy(){return typeof window<"u"}function Wp(n){return ND(n)?(n.nodeName||"").toLowerCase():"#document"}function Ji(n){var e;return(n==null||(e=n.ownerDocument)==null?void 0:e.defaultView)||window}function fc(n){var e;return(e=(ND(n)?n.ownerDocument:n.document)||window.document)==null?void 0:e.documentElement}function ND(n){return hy()?n instanceof Node||n instanceof Ji(n).Node:!1}function cl(n){return hy()?n instanceof Element||n instanceof Ji(n).Element:!1}function oc(n){return hy()?n instanceof HTMLElement||n instanceof Ji(n).HTMLElement:!1}function QE(n){return!hy()||typeof ShadowRoot>"u"?!1:n instanceof ShadowRoot||n instanceof Ji(n).ShadowRoot}const BG=new Set(["inline","contents"]);function Yg(n){const{overflow:e,overflowX:t,overflowY:r,display:s}=ul(n);return/auto|scroll|overlay|hidden|clip/.test(e+r+t)&&!BG.has(s)}const VG=new Set(["table","td","th"]);function zG(n){return VG.has(Wp(n))}const WG=[":popover-open",":modal"];function py(n){return WG.some(e=>{try{return n.matches(e)}catch{return!1}})}const UG=["transform","translate","scale","rotate","perspective"],HG=["transform","translate","scale","rotate","perspective","filter"],GG=["paint","layout","strict","content"];function wk(n){const e=Ck(),t=cl(n)?ul(n):n;return UG.some(r=>t[r]?t[r]!=="none":!1)||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||HG.some(r=>(t.willChange||"").includes(r))||GG.some(r=>(t.contain||"").includes(r))}function qG(n){let e=rd(n);for(;oc(e)&&!vp(e);){if(wk(e))return e;if(py(e))return null;e=rd(e)}return null}function Ck(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const KG=new Set(["html","body","#document"]);function vp(n){return KG.has(Wp(n))}function ul(n){return Ji(n).getComputedStyle(n)}function my(n){return cl(n)?{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}:{scrollLeft:n.scrollX,scrollTop:n.scrollY}}function rd(n){if(Wp(n)==="html")return n;const e=n.assignedSlot||n.parentNode||QE(n)&&n.host||fc(n);return QE(e)?e.host:e}function ED(n){const e=rd(n);return vp(e)?n.ownerDocument?n.ownerDocument.body:n.body:oc(e)&&Yg(e)?e:ED(e)}function xg(n,e,t){var r;e===void 0&&(e=[]),t===void 0&&(t=!0);const s=ED(n),o=s===((r=n.ownerDocument)==null?void 0:r.body),i=Ji(s);if(o){const a=M4(i);return e.concat(i,i.visualViewport||[],Yg(s)?s:[],a&&t?xg(a):[])}return e.concat(s,xg(s,[],t))}function M4(n){return n.parent&&Object.getPrototypeOf(n.parent)?n.frameElement:null}function ID(n){const e=ul(n);let t=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const s=oc(n),o=s?n.offsetWidth:t,i=s?n.offsetHeight:r,a=qv(t)!==o||qv(r)!==i;return a&&(t=o,r=i),{width:t,height:r,$:a}}function kk(n){return cl(n)?n:n.contextElement}function rp(n){const e=kk(n);if(!oc(e))return Kl(1);const t=e.getBoundingClientRect(),{width:r,height:s,$:o}=ID(e);let i=(o?qv(t.width):t.width)/r,a=(o?qv(t.height):t.height)/s;return(!i||!Number.isFinite(i))&&(i=1),(!a||!Number.isFinite(a))&&(a=1),{x:i,y:a}}const XG=Kl(0);function TD(n){const e=Ji(n);return!Ck()||!e.visualViewport?XG:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function YG(n,e,t){return e===void 0&&(e=!1),!t||e&&t!==Ji(n)?!1:e}function yf(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=!1);const s=n.getBoundingClientRect(),o=kk(n);let i=Kl(1);e&&(r?cl(r)&&(i=rp(r)):i=rp(n));const a=YG(o,t,r)?TD(o):Kl(0);let l=(s.left+a.x)/i.x,c=(s.top+a.y)/i.y,u=s.width/i.x,d=s.height/i.y;if(o){const f=Ji(o),p=r&&cl(r)?Ji(r):r;let x=f,v=M4(x);for(;v&&r&&p!==x;){const y=rp(v),b=v.getBoundingClientRect(),w=ul(v),S=b.left+(v.clientLeft+parseFloat(w.paddingLeft))*y.x,k=b.top+(v.clientTop+parseFloat(w.paddingTop))*y.y;l*=y.x,c*=y.y,u*=y.x,d*=y.y,l+=S,c+=k,x=Ji(v),v=M4(x)}}return Xv({width:u,height:d,x:l,y:c})}function gy(n,e){const t=my(n).scrollLeft;return e?e.left+t:yf(fc(n)).left+t}function _D(n,e){const t=n.getBoundingClientRect(),r=t.left+e.scrollLeft-gy(n,t),s=t.top+e.scrollTop;return{x:r,y:s}}function ZG(n){let{elements:e,rect:t,offsetParent:r,strategy:s}=n;const o=s==="fixed",i=fc(r),a=e?py(e.floating):!1;if(r===i||a&&o)return t;let l={scrollLeft:0,scrollTop:0},c=Kl(1);const u=Kl(0),d=oc(r);if((d||!d&&!o)&&((Wp(r)!=="body"||Yg(i))&&(l=my(r)),oc(r))){const p=yf(r);c=rp(r),u.x=p.x+r.clientLeft,u.y=p.y+r.clientTop}const f=i&&!d&&!o?_D(i,l):Kl(0);return{width:t.width*c.x,height:t.height*c.y,x:t.x*c.x-l.scrollLeft*c.x+u.x+f.x,y:t.y*c.y-l.scrollTop*c.y+u.y+f.y}}function JG(n){return Array.from(n.getClientRects())}function QG(n){const e=fc(n),t=my(n),r=n.ownerDocument.body,s=Wi(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),o=Wi(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let i=-t.scrollLeft+gy(n);const a=-t.scrollTop;return ul(r).direction==="rtl"&&(i+=Wi(e.clientWidth,r.clientWidth)-s),{width:s,height:o,x:i,y:a}}const eI=25;function eq(n,e){const t=Ji(n),r=fc(n),s=t.visualViewport;let o=r.clientWidth,i=r.clientHeight,a=0,l=0;if(s){o=s.width,i=s.height;const u=Ck();(!u||u&&e==="fixed")&&(a=s.offsetLeft,l=s.offsetTop)}const c=gy(r);if(c<=0){const u=r.ownerDocument,d=u.body,f=getComputedStyle(d),p=u.compatMode==="CSS1Compat"&&parseFloat(f.marginLeft)+parseFloat(f.marginRight)||0,x=Math.abs(r.clientWidth-d.clientWidth-p);x<=eI&&(o-=x)}else c<=eI&&(o+=c);return{width:o,height:i,x:a,y:l}}const tq=new Set(["absolute","fixed"]);function nq(n,e){const t=yf(n,!0,e==="fixed"),r=t.top+n.clientTop,s=t.left+n.clientLeft,o=oc(n)?rp(n):Kl(1),i=n.clientWidth*o.x,a=n.clientHeight*o.y,l=s*o.x,c=r*o.y;return{width:i,height:a,x:l,y:c}}function tI(n,e,t){let r;if(e==="viewport")r=eq(n,t);else if(e==="document")r=QG(fc(n));else if(cl(e))r=nq(e,t);else{const s=TD(n);r={x:e.x-s.x,y:e.y-s.y,width:e.width,height:e.height}}return Xv(r)}function RD(n,e){const t=rd(n);return t===e||!cl(t)||vp(t)?!1:ul(t).position==="fixed"||RD(t,e)}function rq(n,e){const t=e.get(n);if(t)return t;let r=xg(n,[],!1).filter(a=>cl(a)&&Wp(a)!=="body"),s=null;const o=ul(n).position==="fixed";let i=o?rd(n):n;for(;cl(i)&&!vp(i);){const a=ul(i),l=wk(i);!l&&a.position==="fixed"&&(s=null),(o?!l&&!s:!l&&a.position==="static"&&!!s&&tq.has(s.position)||Yg(i)&&!l&&RD(n,i))?r=r.filter(u=>u!==i):s=a,i=rd(i)}return e.set(n,r),r}function sq(n){let{element:e,boundary:t,rootBoundary:r,strategy:s}=n;const i=[...t==="clippingAncestors"?py(e)?[]:rq(e,this._c):[].concat(t),r],a=i[0],l=i.reduce((c,u)=>{const d=tI(e,u,s);return c.top=Wi(d.top,c.top),c.right=nd(d.right,c.right),c.bottom=nd(d.bottom,c.bottom),c.left=Wi(d.left,c.left),c},tI(e,a,s));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function oq(n){const{width:e,height:t}=ID(n);return{width:e,height:t}}function iq(n,e,t){const r=oc(e),s=fc(e),o=t==="fixed",i=yf(n,!0,o,e);let a={scrollLeft:0,scrollTop:0};const l=Kl(0);function c(){l.x=gy(s)}if(r||!r&&!o)if((Wp(e)!=="body"||Yg(s))&&(a=my(e)),r){const p=yf(e,!0,o,e);l.x=p.x+e.clientLeft,l.y=p.y+e.clientTop}else s&&c();o&&!r&&s&&c();const u=s&&!r&&!o?_D(s,a):Kl(0),d=i.left+a.scrollLeft-l.x-u.x,f=i.top+a.scrollTop-l.y-u.y;return{x:d,y:f,width:i.width,height:i.height}}function q3(n){return ul(n).position==="static"}function nI(n,e){if(!oc(n)||ul(n).position==="fixed")return null;if(e)return e(n);let t=n.offsetParent;return fc(n)===t&&(t=t.ownerDocument.body),t}function DD(n,e){const t=Ji(n);if(py(n))return t;if(!oc(n)){let s=rd(n);for(;s&&!vp(s);){if(cl(s)&&!q3(s))return s;s=rd(s)}return t}let r=nI(n,e);for(;r&&zG(r)&&q3(r);)r=nI(r,e);return r&&vp(r)&&q3(r)&&!wk(r)?t:r||qG(n)||t}const aq=async function(n){const e=this.getOffsetParent||DD,t=this.getDimensions,r=await t(n.floating);return{reference:iq(n.reference,await e(n.floating),n.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function lq(n){return ul(n).direction==="rtl"}const cq={convertOffsetParentRelativeRectToViewportRelativeRect:ZG,getDocumentElement:fc,getClippingRect:sq,getOffsetParent:DD,getElementRects:aq,getClientRects:JG,getDimensions:oq,getScale:rp,isElement:cl,isRTL:lq};function AD(n,e){return n.x===e.x&&n.y===e.y&&n.width===e.width&&n.height===e.height}function uq(n,e){let t=null,r;const s=fc(n);function o(){var a;clearTimeout(r),(a=t)==null||a.disconnect(),t=null}function i(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),o();const c=n.getBoundingClientRect(),{left:u,top:d,width:f,height:p}=c;if(a||e(),!f||!p)return;const x=Wx(d),v=Wx(s.clientWidth-(u+f)),y=Wx(s.clientHeight-(d+p)),b=Wx(u),S={rootMargin:-x+"px "+-v+"px "+-y+"px "+-b+"px",threshold:Wi(0,nd(1,l))||1};let k=!0;function N(I){const T=I[0].intersectionRatio;if(T!==l){if(!k)return i();T?i(!1,T):r=setTimeout(()=>{i(!1,1e-7)},1e3)}T===1&&!AD(c,n.getBoundingClientRect())&&i(),k=!1}try{t=new IntersectionObserver(N,{...S,root:s.ownerDocument})}catch{t=new IntersectionObserver(N,S)}t.observe(n)}return i(!0),o}function dq(n,e,t,r){r===void 0&&(r={});const{ancestorScroll:s=!0,ancestorResize:o=!0,elementResize:i=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=r,c=kk(n),u=s||o?[...c?xg(c):[],...xg(e)]:[];u.forEach(b=>{s&&b.addEventListener("scroll",t,{passive:!0}),o&&b.addEventListener("resize",t)});const d=c&&a?uq(c,t):null;let f=-1,p=null;i&&(p=new ResizeObserver(b=>{let[w]=b;w&&w.target===c&&p&&(p.unobserve(e),cancelAnimationFrame(f),f=requestAnimationFrame(()=>{var S;(S=p)==null||S.observe(e)})),t()}),c&&!l&&p.observe(c),p.observe(e));let x,v=l?yf(n):null;l&&y();function y(){const b=yf(n);v&&!AD(v,b)&&t(),v=b,x=requestAnimationFrame(y)}return t(),()=>{var b;u.forEach(w=>{s&&w.removeEventListener("scroll",t),o&&w.removeEventListener("resize",t)}),d?.(),(b=p)==null||b.disconnect(),p=null,l&&cancelAnimationFrame(x)}}const fq=OG,hq=MG,pq=$G,mq=jG,gq=FG,rI=AG,xq=LG,vq=(n,e,t)=>{const r=new Map,s={platform:cq,...t},o={...s.platform,_c:r};return DG(n,e,{...s,platform:o})};var yq=typeof document<"u",bq=function(){},Av=yq?_.useLayoutEffect:bq;function Yv(n,e){if(n===e)return!0;if(typeof n!=typeof e)return!1;if(typeof n=="function"&&n.toString()===e.toString())return!0;let t,r,s;if(n&&e&&typeof n=="object"){if(Array.isArray(n)){if(t=n.length,t!==e.length)return!1;for(r=t;r--!==0;)if(!Yv(n[r],e[r]))return!1;return!0}if(s=Object.keys(n),t=s.length,t!==Object.keys(e).length)return!1;for(r=t;r--!==0;)if(!{}.hasOwnProperty.call(e,s[r]))return!1;for(r=t;r--!==0;){const o=s[r];if(!(o==="_owner"&&n.$$typeof)&&!Yv(n[o],e[o]))return!1}return!0}return n!==n&&e!==e}function $D(n){return typeof window>"u"?1:(n.ownerDocument.defaultView||window).devicePixelRatio||1}function sI(n,e){const t=$D(n);return Math.round(e*t)/t}function K3(n){const e=_.useRef(n);return Av(()=>{e.current=n}),e}function wq(n){n===void 0&&(n={});const{placement:e="bottom",strategy:t="absolute",middleware:r=[],platform:s,elements:{reference:o,floating:i}={},transform:a=!0,whileElementsMounted:l,open:c}=n,[u,d]=_.useState({x:0,y:0,strategy:t,placement:e,middlewareData:{},isPositioned:!1}),[f,p]=_.useState(r);Yv(f,r)||p(r);const[x,v]=_.useState(null),[y,b]=_.useState(null),w=_.useCallback(M=>{M!==I.current&&(I.current=M,v(M))},[]),S=_.useCallback(M=>{M!==T.current&&(T.current=M,b(M))},[]),k=o||x,N=i||y,I=_.useRef(null),T=_.useRef(null),F=_.useRef(u),R=l!=null,D=K3(l),A=K3(s),P=K3(c),B=_.useCallback(()=>{if(!I.current||!T.current)return;const M={placement:e,strategy:t,middleware:f};A.current&&(M.platform=A.current),vq(I.current,T.current,M).then(j=>{const z={...j,isPositioned:P.current!==!1};L.current&&!Yv(F.current,z)&&(F.current=z,cy.flushSync(()=>{d(z)}))})},[f,e,t,A,P]);Av(()=>{c===!1&&F.current.isPositioned&&(F.current.isPositioned=!1,d(M=>({...M,isPositioned:!1})))},[c]);const L=_.useRef(!1);Av(()=>(L.current=!0,()=>{L.current=!1}),[]),Av(()=>{if(k&&(I.current=k),N&&(T.current=N),k&&N){if(D.current)return D.current(k,N,B);B()}},[k,N,B,D,R]);const W=_.useMemo(()=>({reference:I,floating:T,setReference:w,setFloating:S}),[w,S]),H=_.useMemo(()=>({reference:k,floating:N}),[k,N]),G=_.useMemo(()=>{const M={position:t,left:0,top:0};if(!H.floating)return M;const j=sI(H.floating,u.x),z=sI(H.floating,u.y);return a?{...M,transform:"translate("+j+"px, "+z+"px)",...$D(H.floating)>=1.5&&{willChange:"transform"}}:{position:t,left:j,top:z}},[t,a,H.floating,u.x,u.y]);return _.useMemo(()=>({...u,update:B,refs:W,elements:H,floatingStyles:G}),[u,B,W,H,G])}const Cq=n=>{function e(t){return{}.hasOwnProperty.call(t,"current")}return{name:"arrow",options:n,fn(t){const{element:r,padding:s}=typeof n=="function"?n(t):n;return r&&e(r)?r.current!=null?rI({element:r.current,padding:s}).fn(t):{}:r?rI({element:r,padding:s}).fn(t):{}}}},kq=(n,e)=>({...fq(n),options:[n,e]}),Sq=(n,e)=>({...hq(n),options:[n,e]}),Nq=(n,e)=>({...xq(n),options:[n,e]}),Eq=(n,e)=>({...pq(n),options:[n,e]}),Iq=(n,e)=>({...mq(n),options:[n,e]}),Tq=(n,e)=>({...gq(n),options:[n,e]}),_q=(n,e)=>({...Cq(n),options:[n,e]});var Rq="Arrow",FD=_.forwardRef((n,e)=>{const{children:t,width:r=10,height:s=5,...o}=n;return m.jsx(Is.svg,{...o,ref:e,width:r,height:s,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:n.asChild?t:m.jsx("polygon",{points:"0,0 30,0 15,10"})})});FD.displayName=Rq;var Dq=FD;function Aq(n){const[e,t]=_.useState(void 0);return jc(()=>{if(n){t({width:n.offsetWidth,height:n.offsetHeight});const r=new ResizeObserver(s=>{if(!Array.isArray(s)||!s.length)return;const o=s[0];let i,a;if("borderBoxSize"in o){const l=o.borderBoxSize,c=Array.isArray(l)?l[0]:l;i=c.inlineSize,a=c.blockSize}else i=n.offsetWidth,a=n.offsetHeight;t({width:i,height:a})});return r.observe(n,{box:"border-box"}),()=>r.unobserve(n)}else t(void 0)},[n]),e}var PD="Popper",[OD,MD]=Kg(PD),[Q9e,LD]=OD(PD),jD="PopperAnchor",BD=_.forwardRef((n,e)=>{const{__scopePopper:t,virtualRef:r,...s}=n,o=LD(jD,t),i=_.useRef(null),a=ti(e,i),l=_.useRef(null);return _.useEffect(()=>{const c=l.current;l.current=r?.current||i.current,c!==l.current&&o.onAnchorChange(l.current)}),r?null:m.jsx(Is.div,{...s,ref:a})});BD.displayName=jD;var Sk="PopperContent",[$q,Fq]=OD(Sk),VD=_.forwardRef((n,e)=>{const{__scopePopper:t,side:r="bottom",sideOffset:s=0,align:o="center",alignOffset:i=0,arrowPadding:a=0,avoidCollisions:l=!0,collisionBoundary:c=[],collisionPadding:u=0,sticky:d="partial",hideWhenDetached:f=!1,updatePositionStrategy:p="optimized",onPlaced:x,...v}=n,y=LD(Sk,t),[b,w]=_.useState(null),S=ti(e,pe=>w(pe)),[k,N]=_.useState(null),I=Aq(k),T=I?.width??0,F=I?.height??0,R=r+(o!=="center"?"-"+o:""),D=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},A=Array.isArray(c)?c:[c],P=A.length>0,B={padding:D,boundary:A.filter(Oq),altBoundary:P},{refs:L,floatingStyles:W,placement:H,isPositioned:G,middlewareData:M}=wq({strategy:"fixed",placement:R,whileElementsMounted:(...pe)=>dq(...pe,{animationFrame:p==="always"}),elements:{reference:y.anchor},middleware:[kq({mainAxis:s+F,alignmentAxis:i}),l&&Sq({mainAxis:!0,crossAxis:!1,limiter:d==="partial"?Nq():void 0,...B}),l&&Eq({...B}),Iq({...B,apply:({elements:pe,rects:Ce,availableWidth:Ae,availableHeight:ze})=>{const{width:et,height:gt}=Ce.reference,dt=pe.floating.style;dt.setProperty("--radix-popper-available-width",`${Ae}px`),dt.setProperty("--radix-popper-available-height",`${ze}px`),dt.setProperty("--radix-popper-anchor-width",`${et}px`),dt.setProperty("--radix-popper-anchor-height",`${gt}px`)}}),k&&_q({element:k,padding:a}),Mq({arrowWidth:T,arrowHeight:F}),f&&Tq({strategy:"referenceHidden",...B})]}),[j,z]=UD(H),V=sc(x);jc(()=>{G&&V?.()},[G,V]);const K=M.arrow?.x,J=M.arrow?.y,oe=M.arrow?.centerOffset!==0,[Z,de]=_.useState();return jc(()=>{b&&de(window.getComputedStyle(b).zIndex)},[b]),m.jsx("div",{ref:L.setFloating,"data-radix-popper-content-wrapper":"",style:{...W,transform:G?W.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Z,"--radix-popper-transform-origin":[M.transformOrigin?.x,M.transformOrigin?.y].join(" "),...M.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:n.dir,children:m.jsx($q,{scope:t,placedSide:j,onArrowChange:N,arrowX:K,arrowY:J,shouldHideArrow:oe,children:m.jsx(Is.div,{"data-side":j,"data-align":z,...v,ref:S,style:{...v.style,animation:G?void 0:"none"}})})})});VD.displayName=Sk;var zD="PopperArrow",Pq={top:"bottom",right:"left",bottom:"top",left:"right"},WD=_.forwardRef(function(e,t){const{__scopePopper:r,...s}=e,o=Fq(zD,r),i=Pq[o.placedSide];return m.jsx("span",{ref:o.onArrowChange,style:{position:"absolute",left:o.arrowX,top:o.arrowY,[i]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[o.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[o.placedSide],visibility:o.shouldHideArrow?"hidden":void 0},children:m.jsx(Dq,{...s,ref:t,style:{...s.style,display:"block"}})})});WD.displayName=zD;function Oq(n){return n!==null}var Mq=n=>({name:"transformOrigin",options:n,fn(e){const{placement:t,rects:r,middlewareData:s}=e,i=s.arrow?.centerOffset!==0,a=i?0:n.arrowWidth,l=i?0:n.arrowHeight,[c,u]=UD(t),d={start:"0%",center:"50%",end:"100%"}[u],f=(s.arrow?.x??0)+a/2,p=(s.arrow?.y??0)+l/2;let x="",v="";return c==="bottom"?(x=i?d:`${f}px`,v=`${-l}px`):c==="top"?(x=i?d:`${f}px`,v=`${r.floating.height+l}px`):c==="right"?(x=`${-l}px`,v=i?d:`${p}px`):c==="left"&&(x=`${r.floating.width+l}px`,v=i?d:`${p}px`),{data:{x,y:v}}}});function UD(n){const[e,t="center"]=n.split("-");return[e,t]}var Lq=BD,jq=VD,Bq=WD,Vq=Symbol("radix.slottable");function zq(n){const e=({children:t})=>m.jsx(m.Fragment,{children:t});return e.displayName=`${n}.Slottable`,e.__radixId=Vq,e}var[xy]=Kg("Tooltip",[MD]),Nk=MD(),HD="TooltipProvider",Wq=700,oI="tooltip.open",[Uq,GD]=xy(HD),qD=n=>{const{__scopeTooltip:e,delayDuration:t=Wq,skipDelayDuration:r=300,disableHoverableContent:s=!1,children:o}=n,i=_.useRef(!0),a=_.useRef(!1),l=_.useRef(0);return _.useEffect(()=>{const c=l.current;return()=>window.clearTimeout(c)},[]),m.jsx(Uq,{scope:e,isOpenDelayedRef:i,delayDuration:t,onOpen:_.useCallback(()=>{window.clearTimeout(l.current),i.current=!1},[]),onClose:_.useCallback(()=>{window.clearTimeout(l.current),l.current=window.setTimeout(()=>i.current=!0,r)},[r]),isPointerInTransitRef:a,onPointerInTransitChange:_.useCallback(c=>{a.current=c},[]),disableHoverableContent:s,children:o})};qD.displayName=HD;var KD="Tooltip",[eTe,vy]=xy(KD),L4="TooltipTrigger",Hq=_.forwardRef((n,e)=>{const{__scopeTooltip:t,...r}=n,s=vy(L4,t),o=GD(L4,t),i=Nk(t),a=_.useRef(null),l=ti(e,a,s.onTriggerChange),c=_.useRef(!1),u=_.useRef(!1),d=_.useCallback(()=>c.current=!1,[]);return _.useEffect(()=>()=>document.removeEventListener("pointerup",d),[d]),m.jsx(Lq,{asChild:!0,...i,children:m.jsx(Is.button,{"aria-describedby":s.open?s.contentId:void 0,"data-state":s.stateAttribute,...r,ref:l,onPointerMove:zr(n.onPointerMove,f=>{f.pointerType!=="touch"&&!u.current&&!o.isPointerInTransitRef.current&&(s.onTriggerEnter(),u.current=!0)}),onPointerLeave:zr(n.onPointerLeave,()=>{s.onTriggerLeave(),u.current=!1}),onPointerDown:zr(n.onPointerDown,()=>{s.open&&s.onClose(),c.current=!0,document.addEventListener("pointerup",d,{once:!0})}),onFocus:zr(n.onFocus,()=>{c.current||s.onOpen()}),onBlur:zr(n.onBlur,s.onClose),onClick:zr(n.onClick,s.onClose)})})});Hq.displayName=L4;var Gq="TooltipPortal",[tTe,qq]=xy(Gq,{forceMount:void 0}),yp="TooltipContent",XD=_.forwardRef((n,e)=>{const t=qq(yp,n.__scopeTooltip),{forceMount:r=t.forceMount,side:s="top",...o}=n,i=vy(yp,n.__scopeTooltip);return m.jsx(Bp,{present:r||i.open,children:i.disableHoverableContent?m.jsx(YD,{side:s,...o,ref:e}):m.jsx(Kq,{side:s,...o,ref:e})})}),Kq=_.forwardRef((n,e)=>{const t=vy(yp,n.__scopeTooltip),r=GD(yp,n.__scopeTooltip),s=_.useRef(null),o=ti(e,s),[i,a]=_.useState(null),{trigger:l,onClose:c}=t,u=s.current,{onPointerInTransitChange:d}=r,f=_.useCallback(()=>{a(null),d(!1)},[d]),p=_.useCallback((x,v)=>{const y=x.currentTarget,b={x:x.clientX,y:x.clientY},w=Qq(b,y.getBoundingClientRect()),S=eK(b,w),k=tK(v.getBoundingClientRect()),N=rK([...S,...k]);a(N),d(!0)},[d]);return _.useEffect(()=>()=>f(),[f]),_.useEffect(()=>{if(l&&u){const x=y=>p(y,u),v=y=>p(y,l);return l.addEventListener("pointerleave",x),u.addEventListener("pointerleave",v),()=>{l.removeEventListener("pointerleave",x),u.removeEventListener("pointerleave",v)}}},[l,u,p,f]),_.useEffect(()=>{if(i){const x=v=>{const y=v.target,b={x:v.clientX,y:v.clientY},w=l?.contains(y)||u?.contains(y),S=!nK(b,i);w?f():S&&(f(),c())};return document.addEventListener("pointermove",x),()=>document.removeEventListener("pointermove",x)}},[l,u,i,c,f]),m.jsx(YD,{...n,ref:o})}),[Xq,Yq]=xy(KD,{isInside:!1}),Zq=zq("TooltipContent"),YD=_.forwardRef((n,e)=>{const{__scopeTooltip:t,children:r,"aria-label":s,onEscapeKeyDown:o,onPointerDownOutside:i,...a}=n,l=vy(yp,t),c=Nk(t),{onClose:u}=l;return _.useEffect(()=>(document.addEventListener(oI,u),()=>document.removeEventListener(oI,u)),[u]),_.useEffect(()=>{if(l.trigger){const d=f=>{f.target?.contains(l.trigger)&&u()};return window.addEventListener("scroll",d,{capture:!0}),()=>window.removeEventListener("scroll",d,{capture:!0})}},[l.trigger,u]),m.jsx(uy,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:o,onPointerDownOutside:i,onFocusOutside:d=>d.preventDefault(),onDismiss:u,children:m.jsxs(jq,{"data-state":l.stateAttribute,...c,...a,ref:e,style:{...a.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[m.jsx(Zq,{children:r}),m.jsx(Xq,{scope:t,isInside:!0,children:m.jsx(RU,{id:l.contentId,role:"tooltip",children:s||r})})]})})});XD.displayName=yp;var ZD="TooltipArrow",Jq=_.forwardRef((n,e)=>{const{__scopeTooltip:t,...r}=n,s=Nk(t);return Yq(ZD,t).isInside?null:m.jsx(Bq,{...s,...r,ref:e})});Jq.displayName=ZD;function Qq(n,e){const t=Math.abs(e.top-n.y),r=Math.abs(e.bottom-n.y),s=Math.abs(e.right-n.x),o=Math.abs(e.left-n.x);switch(Math.min(t,r,s,o)){case o:return"left";case s:return"right";case t:return"top";case r:return"bottom";default:throw new Error("unreachable")}}function eK(n,e,t=5){const r=[];switch(e){case"top":r.push({x:n.x-t,y:n.y+t},{x:n.x+t,y:n.y+t});break;case"bottom":r.push({x:n.x-t,y:n.y-t},{x:n.x+t,y:n.y-t});break;case"left":r.push({x:n.x+t,y:n.y-t},{x:n.x+t,y:n.y+t});break;case"right":r.push({x:n.x-t,y:n.y-t},{x:n.x-t,y:n.y+t});break}return r}function tK(n){const{top:e,right:t,bottom:r,left:s}=n;return[{x:s,y:e},{x:t,y:e},{x:t,y:r},{x:s,y:r}]}function nK(n,e){const{x:t,y:r}=n;let s=!1;for(let o=0,i=e.length-1;o<e.length;i=o++){const a=e[o],l=e[i],c=a.x,u=a.y,d=l.x,f=l.y;u>r!=f>r&&t<(d-c)*(r-u)/(f-u)+c&&(s=!s)}return s}function rK(n){const e=n.slice();return e.sort((t,r)=>t.x<r.x?-1:t.x>r.x?1:t.y<r.y?-1:t.y>r.y?1:0),sK(e)}function sK(n){if(n.length<=1)return n.slice();const e=[];for(let r=0;r<n.length;r++){const s=n[r];for(;e.length>=2;){const o=e[e.length-1],i=e[e.length-2];if((o.x-i.x)*(s.y-i.y)>=(o.y-i.y)*(s.x-i.x))e.pop();else break}e.push(s)}e.pop();const t=[];for(let r=n.length-1;r>=0;r--){const s=n[r];for(;t.length>=2;){const o=t[t.length-1],i=t[t.length-2];if((o.x-i.x)*(s.y-i.y)>=(o.y-i.y)*(s.x-i.x))t.pop();else break}t.push(s)}return t.pop(),e.length===1&&t.length===1&&e[0].x===t[0].x&&e[0].y===t[0].y?e:e.concat(t)}var oK=qD,JD=XD;const iK=oK,aK=_.forwardRef(({className:n,sideOffset:e=4,...t},r)=>m.jsx(JD,{ref:r,sideOffset:e,className:ra("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n),...t}));aK.displayName=JD.displayName;var yy=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(n){return this.listeners.add(n),this.onSubscribe(),()=>{this.listeners.delete(n),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},lK={setTimeout:(n,e)=>setTimeout(n,e),clearTimeout:n=>clearTimeout(n),setInterval:(n,e)=>setInterval(n,e),clearInterval:n=>clearInterval(n)},cK=class{#e=lK;#t=!1;setTimeoutProvider(n){this.#e=n}setTimeout(n,e){return this.#e.setTimeout(n,e)}clearTimeout(n){this.#e.clearTimeout(n)}setInterval(n,e){return this.#e.setInterval(n,e)}clearInterval(n){this.#e.clearInterval(n)}},j4=new cK;function uK(n){setTimeout(n,0)}var by=typeof window>"u"||"Deno"in globalThis;function Xa(){}function dK(n,e){return typeof n=="function"?n(e):n}function fK(n){return typeof n=="number"&&n>=0&&n!==1/0}function hK(n,e){return Math.max(n+(e||0)-Date.now(),0)}function B4(n,e){return typeof n=="function"?n(e):n}function pK(n,e){return typeof n=="function"?n(e):n}function iI(n,e){const{type:t="all",exact:r,fetchStatus:s,predicate:o,queryKey:i,stale:a}=n;if(i){if(r){if(e.queryHash!==Ek(i,e.options))return!1}else if(!yg(e.queryKey,i))return!1}if(t!=="all"){const l=e.isActive();if(t==="active"&&!l||t==="inactive"&&l)return!1}return!(typeof a=="boolean"&&e.isStale()!==a||s&&s!==e.state.fetchStatus||o&&!o(e))}function aI(n,e){const{exact:t,status:r,predicate:s,mutationKey:o}=n;if(o){if(!e.options.mutationKey)return!1;if(t){if(vg(e.options.mutationKey)!==vg(o))return!1}else if(!yg(e.options.mutationKey,o))return!1}return!(r&&e.state.status!==r||s&&!s(e))}function Ek(n,e){return(e?.queryKeyHashFn||vg)(n)}function vg(n){return JSON.stringify(n,(e,t)=>V4(t)?Object.keys(t).sort().reduce((r,s)=>(r[s]=t[s],r),{}):t)}function yg(n,e){return n===e?!0:typeof n!=typeof e?!1:n&&e&&typeof n=="object"&&typeof e=="object"?Object.keys(e).every(t=>yg(n[t],e[t])):!1}var mK=Object.prototype.hasOwnProperty;function QD(n,e){if(n===e)return n;const t=lI(n)&&lI(e);if(!t&&!(V4(n)&&V4(e)))return e;const s=(t?n:Object.keys(n)).length,o=t?e:Object.keys(e),i=o.length,a=t?new Array(i):{};let l=0;for(let c=0;c<i;c++){const u=t?c:o[c],d=n[u],f=e[u];if(d===f){a[u]=d,(t?c<s:mK.call(n,u))&&l++;continue}if(d===null||f===null||typeof d!="object"||typeof f!="object"){a[u]=f;continue}const p=QD(d,f);a[u]=p,p===d&&l++}return s===i&&l===s?n:a}function lI(n){return Array.isArray(n)&&n.length===Object.keys(n).length}function V4(n){if(!cI(n))return!1;const e=n.constructor;if(e===void 0)return!0;const t=e.prototype;return!(!cI(t)||!t.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(n)!==Object.prototype)}function cI(n){return Object.prototype.toString.call(n)==="[object Object]"}function gK(n){return new Promise(e=>{j4.setTimeout(e,n)})}function xK(n,e,t){return typeof t.structuralSharing=="function"?t.structuralSharing(n,e):t.structuralSharing!==!1?QD(n,e):e}function vK(n,e,t=0){const r=[...n,e];return t&&r.length>t?r.slice(1):r}function yK(n,e,t=0){const r=[e,...n];return t&&r.length>t?r.slice(0,-1):r}var Ik=Symbol();function eA(n,e){return!n.queryFn&&e?.initialPromise?()=>e.initialPromise:!n.queryFn||n.queryFn===Ik?()=>Promise.reject(new Error(`Missing queryFn: '${n.queryHash}'`)):n.queryFn}var bK=class extends yy{#e;#t;#n;constructor(){super(),this.#n=n=>{if(!by&&window.addEventListener){const e=()=>n();return window.addEventListener("visibilitychange",e,!1),()=>{window.removeEventListener("visibilitychange",e)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(n){this.#n=n,this.#t?.(),this.#t=n(e=>{typeof e=="boolean"?this.setFocused(e):this.onFocus()})}setFocused(n){this.#e!==n&&(this.#e=n,this.onFocus())}onFocus(){const n=this.isFocused();this.listeners.forEach(e=>{e(n)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},tA=new bK;function wK(){let n,e;const t=new Promise((s,o)=>{n=s,e=o});t.status="pending",t.catch(()=>{});function r(s){Object.assign(t,s),delete t.resolve,delete t.reject}return t.resolve=s=>{r({status:"fulfilled",value:s}),n(s)},t.reject=s=>{r({status:"rejected",reason:s}),e(s)},t}var CK=uK;function kK(){let n=[],e=0,t=a=>{a()},r=a=>{a()},s=CK;const o=a=>{e?n.push(a):s(()=>{t(a)})},i=()=>{const a=n;n=[],a.length&&s(()=>{r(()=>{a.forEach(l=>{t(l)})})})};return{batch:a=>{let l;e++;try{l=a()}finally{e--,e||i()}return l},batchCalls:a=>(...l)=>{o(()=>{a(...l)})},schedule:o,setNotifyFunction:a=>{t=a},setBatchNotifyFunction:a=>{r=a},setScheduler:a=>{s=a}}}var Zo=kK(),SK=class extends yy{#e=!0;#t;#n;constructor(){super(),this.#n=n=>{if(!by&&window.addEventListener){const e=()=>n(!0),t=()=>n(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",t,!1),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(n){this.#n=n,this.#t?.(),this.#t=n(this.setOnline.bind(this))}setOnline(n){this.#e!==n&&(this.#e=n,this.listeners.forEach(t=>{t(n)}))}isOnline(){return this.#e}},Zv=new SK;function NK(n){return Math.min(1e3*2**n,3e4)}function nA(n){return(n??"online")==="online"?Zv.isOnline():!0}var z4=class extends Error{constructor(n){super("CancelledError"),this.revert=n?.revert,this.silent=n?.silent}};function rA(n){let e=!1,t=0,r;const s=wK(),o=()=>s.status!=="pending",i=v=>{if(!o()){const y=new z4(v);f(y),n.onCancel?.(y)}},a=()=>{e=!0},l=()=>{e=!1},c=()=>tA.isFocused()&&(n.networkMode==="always"||Zv.isOnline())&&n.canRun(),u=()=>nA(n.networkMode)&&n.canRun(),d=v=>{o()||(r?.(),s.resolve(v))},f=v=>{o()||(r?.(),s.reject(v))},p=()=>new Promise(v=>{r=y=>{(o()||c())&&v(y)},n.onPause?.()}).then(()=>{r=void 0,o()||n.onContinue?.()}),x=()=>{if(o())return;let v;const y=t===0?n.initialPromise:void 0;try{v=y??n.fn()}catch(b){v=Promise.reject(b)}Promise.resolve(v).then(d).catch(b=>{if(o())return;const w=n.retry??(by?0:3),S=n.retryDelay??NK,k=typeof S=="function"?S(t,b):S,N=w===!0||typeof w=="number"&&t<w||typeof w=="function"&&w(t,b);if(e||!N){f(b);return}t++,n.onFail?.(t,b),gK(k).then(()=>c()?void 0:p()).then(()=>{e?f(b):x()})})};return{promise:s,status:()=>s.status,cancel:i,continue:()=>(r?.(),s),cancelRetry:a,continueRetry:l,canStart:u,start:()=>(u()?x():p().then(x),s)}}var sA=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),fK(this.gcTime)&&(this.#e=j4.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(n){this.gcTime=Math.max(this.gcTime||0,n??(by?1/0:300*1e3))}clearGcTimeout(){this.#e&&(j4.clearTimeout(this.#e),this.#e=void 0)}},EK=class extends sA{#e;#t;#n;#s;#r;#i;#a;constructor(n){super(),this.#a=!1,this.#i=n.defaultOptions,this.setOptions(n.options),this.observers=[],this.#s=n.client,this.#n=this.#s.getQueryCache(),this.queryKey=n.queryKey,this.queryHash=n.queryHash,this.#e=dI(this.options),this.state=n.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#r?.promise}setOptions(n){if(this.options={...this.#i,...n},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const e=dI(this.options);e.data!==void 0&&(this.setState(uI(e.data,e.dataUpdatedAt)),this.#e=e)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#n.remove(this)}setData(n,e){const t=xK(this.state.data,n,this.options);return this.#o({data:t,type:"success",dataUpdatedAt:e?.updatedAt,manual:e?.manual}),t}setState(n,e){this.#o({type:"setState",state:n,setStateOptions:e})}cancel(n){const e=this.#r?.promise;return this.#r?.cancel(n),e?e.then(Xa).catch(Xa):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(n=>pK(n.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Ik||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(n=>B4(n.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(n=>n.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(n=0){return this.state.data===void 0?!0:n==="static"?!1:this.state.isInvalidated?!0:!hK(this.state.dataUpdatedAt,n)}onFocus(){this.observers.find(e=>e.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#r?.continue()}onOnline(){this.observers.find(e=>e.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#r?.continue()}addObserver(n){this.observers.includes(n)||(this.observers.push(n),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",query:this,observer:n}))}removeObserver(n){this.observers.includes(n)&&(this.observers=this.observers.filter(e=>e!==n),this.observers.length||(this.#r&&(this.#a?this.#r.cancel({revert:!0}):this.#r.cancelRetry()),this.scheduleGc()),this.#n.notify({type:"observerRemoved",query:this,observer:n}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#o({type:"invalidate"})}async fetch(n,e){if(this.state.fetchStatus!=="idle"&&this.#r?.status()!=="rejected"){if(this.state.data!==void 0&&e?.cancelRefetch)this.cancel({silent:!0});else if(this.#r)return this.#r.continueRetry(),this.#r.promise}if(n&&this.setOptions(n),!this.options.queryFn){const a=this.observers.find(l=>l.options.queryFn);a&&this.setOptions(a.options)}const t=new AbortController,r=a=>{Object.defineProperty(a,"signal",{enumerable:!0,get:()=>(this.#a=!0,t.signal)})},s=()=>{const a=eA(this.options,e),c=(()=>{const u={client:this.#s,queryKey:this.queryKey,meta:this.meta};return r(u),u})();return this.#a=!1,this.options.persister?this.options.persister(a,c,this):a(c)},i=(()=>{const a={fetchOptions:e,options:this.options,queryKey:this.queryKey,client:this.#s,state:this.state,fetchFn:s};return r(a),a})();this.options.behavior?.onFetch(i,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==i.fetchOptions?.meta)&&this.#o({type:"fetch",meta:i.fetchOptions?.meta}),this.#r=rA({initialPromise:e?.initialPromise,fn:i.fetchFn,onCancel:a=>{a instanceof z4&&a.revert&&this.setState({...this.#t,fetchStatus:"idle"}),t.abort()},onFail:(a,l)=>{this.#o({type:"failed",failureCount:a,error:l})},onPause:()=>{this.#o({type:"pause"})},onContinue:()=>{this.#o({type:"continue"})},retry:i.options.retry,retryDelay:i.options.retryDelay,networkMode:i.options.networkMode,canRun:()=>!0});try{const a=await this.#r.start();if(a===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(a),this.#n.config.onSuccess?.(a,this),this.#n.config.onSettled?.(a,this.state.error,this),a}catch(a){if(a instanceof z4){if(a.silent)return this.#r.promise;if(a.revert){if(this.state.data===void 0)throw a;return this.state.data}}throw this.#o({type:"error",error:a}),this.#n.config.onError?.(a,this),this.#n.config.onSettled?.(this.state.data,a,this),a}finally{this.scheduleGc()}}#o(n){const e=t=>{switch(n.type){case"failed":return{...t,fetchFailureCount:n.failureCount,fetchFailureReason:n.error};case"pause":return{...t,fetchStatus:"paused"};case"continue":return{...t,fetchStatus:"fetching"};case"fetch":return{...t,...IK(t.data,this.options),fetchMeta:n.meta??null};case"success":const r={...t,...uI(n.data,n.dataUpdatedAt),dataUpdateCount:t.dataUpdateCount+1,...!n.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=n.manual?r:void 0,r;case"error":const s=n.error;return{...t,error:s,errorUpdateCount:t.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:t.fetchFailureCount+1,fetchFailureReason:s,fetchStatus:"idle",status:"error"};case"invalidate":return{...t,isInvalidated:!0};case"setState":return{...t,...n.state}}};this.state=e(this.state),Zo.batch(()=>{this.observers.forEach(t=>{t.onQueryUpdate()}),this.#n.notify({query:this,type:"updated",action:n})})}};function IK(n,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:nA(e.networkMode)?"fetching":"paused",...n===void 0&&{error:null,status:"pending"}}}function uI(n,e){return{data:n,dataUpdatedAt:e??Date.now(),error:null,isInvalidated:!1,status:"success"}}function dI(n){const e=typeof n.initialData=="function"?n.initialData():n.initialData,t=e!==void 0,r=t?typeof n.initialDataUpdatedAt=="function"?n.initialDataUpdatedAt():n.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:t?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:t?"success":"pending",fetchStatus:"idle"}}function fI(n){return{onFetch:(e,t)=>{const r=e.options,s=e.fetchOptions?.meta?.fetchMore?.direction,o=e.state.data?.pages||[],i=e.state.data?.pageParams||[];let a={pages:[],pageParams:[]},l=0;const c=async()=>{let u=!1;const d=x=>{Object.defineProperty(x,"signal",{enumerable:!0,get:()=>(e.signal.aborted?u=!0:e.signal.addEventListener("abort",()=>{u=!0}),e.signal)})},f=eA(e.options,e.fetchOptions),p=async(x,v,y)=>{if(u)return Promise.reject();if(v==null&&x.pages.length)return Promise.resolve(x);const w=(()=>{const I={client:e.client,queryKey:e.queryKey,pageParam:v,direction:y?"backward":"forward",meta:e.options.meta};return d(I),I})(),S=await f(w),{maxPages:k}=e.options,N=y?yK:vK;return{pages:N(x.pages,S,k),pageParams:N(x.pageParams,v,k)}};if(s&&o.length){const x=s==="backward",v=x?TK:hI,y={pages:o,pageParams:i},b=v(r,y);a=await p(y,b,x)}else{const x=n??o.length;do{const v=l===0?i[0]??r.initialPageParam:hI(r,a);if(l>0&&v==null)break;a=await p(a,v),l++}while(l<x)}return a};e.options.persister?e.fetchFn=()=>e.options.persister?.(c,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},t):e.fetchFn=c}}}function hI(n,{pages:e,pageParams:t}){const r=e.length-1;return e.length>0?n.getNextPageParam(e[r],e,t[r],t):void 0}function TK(n,{pages:e,pageParams:t}){return e.length>0?n.getPreviousPageParam?.(e[0],e,t[0],t):void 0}var _K=class extends sA{#e;#t;#n;#s;constructor(n){super(),this.#e=n.client,this.mutationId=n.mutationId,this.#n=n.mutationCache,this.#t=[],this.state=n.state||RK(),this.setOptions(n.options),this.scheduleGc()}setOptions(n){this.options=n,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(n){this.#t.includes(n)||(this.#t.push(n),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",mutation:this,observer:n}))}removeObserver(n){this.#t=this.#t.filter(e=>e!==n),this.scheduleGc(),this.#n.notify({type:"observerRemoved",mutation:this,observer:n})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#n.remove(this))}continue(){return this.#s?.continue()??this.execute(this.state.variables)}async execute(n){const e=()=>{this.#r({type:"continue"})},t={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#s=rA({fn:()=>this.options.mutationFn?this.options.mutationFn(n,t):Promise.reject(new Error("No mutationFn found")),onFail:(o,i)=>{this.#r({type:"failed",failureCount:o,error:i})},onPause:()=>{this.#r({type:"pause"})},onContinue:e,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#n.canRun(this)});const r=this.state.status==="pending",s=!this.#s.canStart();try{if(r)e();else{this.#r({type:"pending",variables:n,isPaused:s}),await this.#n.config.onMutate?.(n,this,t);const i=await this.options.onMutate?.(n,t);i!==this.state.context&&this.#r({type:"pending",context:i,variables:n,isPaused:s})}const o=await this.#s.start();return await this.#n.config.onSuccess?.(o,n,this.state.context,this,t),await this.options.onSuccess?.(o,n,this.state.context,t),await this.#n.config.onSettled?.(o,null,this.state.variables,this.state.context,this,t),await this.options.onSettled?.(o,null,n,this.state.context,t),this.#r({type:"success",data:o}),o}catch(o){try{throw await this.#n.config.onError?.(o,n,this.state.context,this,t),await this.options.onError?.(o,n,this.state.context,t),await this.#n.config.onSettled?.(void 0,o,this.state.variables,this.state.context,this,t),await this.options.onSettled?.(void 0,o,n,this.state.context,t),o}finally{this.#r({type:"error",error:o})}}finally{this.#n.runNext(this)}}#r(n){const e=t=>{switch(n.type){case"failed":return{...t,failureCount:n.failureCount,failureReason:n.error};case"pause":return{...t,isPaused:!0};case"continue":return{...t,isPaused:!1};case"pending":return{...t,context:n.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:n.isPaused,status:"pending",variables:n.variables,submittedAt:Date.now()};case"success":return{...t,data:n.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...t,data:void 0,error:n.error,failureCount:t.failureCount+1,failureReason:n.error,isPaused:!1,status:"error"}}};this.state=e(this.state),Zo.batch(()=>{this.#t.forEach(t=>{t.onMutationUpdate(n)}),this.#n.notify({mutation:this,type:"updated",action:n})})}};function RK(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var DK=class extends yy{constructor(n={}){super(),this.config=n,this.#e=new Set,this.#t=new Map,this.#n=0}#e;#t;#n;build(n,e,t){const r=new _K({client:n,mutationCache:this,mutationId:++this.#n,options:n.defaultMutationOptions(e),state:t});return this.add(r),r}add(n){this.#e.add(n);const e=Ux(n);if(typeof e=="string"){const t=this.#t.get(e);t?t.push(n):this.#t.set(e,[n])}this.notify({type:"added",mutation:n})}remove(n){if(this.#e.delete(n)){const e=Ux(n);if(typeof e=="string"){const t=this.#t.get(e);if(t)if(t.length>1){const r=t.indexOf(n);r!==-1&&t.splice(r,1)}else t[0]===n&&this.#t.delete(e)}}this.notify({type:"removed",mutation:n})}canRun(n){const e=Ux(n);if(typeof e=="string"){const r=this.#t.get(e)?.find(s=>s.state.status==="pending");return!r||r===n}else return!0}runNext(n){const e=Ux(n);return typeof e=="string"?this.#t.get(e)?.find(r=>r!==n&&r.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){Zo.batch(()=>{this.#e.forEach(n=>{this.notify({type:"removed",mutation:n})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(n){const e={exact:!0,...n};return this.getAll().find(t=>aI(e,t))}findAll(n={}){return this.getAll().filter(e=>aI(n,e))}notify(n){Zo.batch(()=>{this.listeners.forEach(e=>{e(n)})})}resumePausedMutations(){const n=this.getAll().filter(e=>e.state.isPaused);return Zo.batch(()=>Promise.all(n.map(e=>e.continue().catch(Xa))))}};function Ux(n){return n.options.scope?.id}var AK=class extends yy{constructor(n={}){super(),this.config=n,this.#e=new Map}#e;build(n,e,t){const r=e.queryKey,s=e.queryHash??Ek(r,e);let o=this.get(s);return o||(o=new EK({client:n,queryKey:r,queryHash:s,options:n.defaultQueryOptions(e),state:t,defaultOptions:n.getQueryDefaults(r)}),this.add(o)),o}add(n){this.#e.has(n.queryHash)||(this.#e.set(n.queryHash,n),this.notify({type:"added",query:n}))}remove(n){const e=this.#e.get(n.queryHash);e&&(n.destroy(),e===n&&this.#e.delete(n.queryHash),this.notify({type:"removed",query:n}))}clear(){Zo.batch(()=>{this.getAll().forEach(n=>{this.remove(n)})})}get(n){return this.#e.get(n)}getAll(){return[...this.#e.values()]}find(n){const e={exact:!0,...n};return this.getAll().find(t=>iI(e,t))}findAll(n={}){const e=this.getAll();return Object.keys(n).length>0?e.filter(t=>iI(n,t)):e}notify(n){Zo.batch(()=>{this.listeners.forEach(e=>{e(n)})})}onFocus(){Zo.batch(()=>{this.getAll().forEach(n=>{n.onFocus()})})}onOnline(){Zo.batch(()=>{this.getAll().forEach(n=>{n.onOnline()})})}},$K=class{#e;#t;#n;#s;#r;#i;#a;#o;constructor(n={}){this.#e=n.queryCache||new AK,this.#t=n.mutationCache||new DK,this.#n=n.defaultOptions||{},this.#s=new Map,this.#r=new Map,this.#i=0}mount(){this.#i++,this.#i===1&&(this.#a=tA.subscribe(async n=>{n&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#o=Zv.subscribe(async n=>{n&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#i--,this.#i===0&&(this.#a?.(),this.#a=void 0,this.#o?.(),this.#o=void 0)}isFetching(n){return this.#e.findAll({...n,fetchStatus:"fetching"}).length}isMutating(n){return this.#t.findAll({...n,status:"pending"}).length}getQueryData(n){const e=this.defaultQueryOptions({queryKey:n});return this.#e.get(e.queryHash)?.state.data}ensureQueryData(n){const e=this.defaultQueryOptions(n),t=this.#e.build(this,e),r=t.state.data;return r===void 0?this.fetchQuery(n):(n.revalidateIfStale&&t.isStaleByTime(B4(e.staleTime,t))&&this.prefetchQuery(e),Promise.resolve(r))}getQueriesData(n){return this.#e.findAll(n).map(({queryKey:e,state:t})=>{const r=t.data;return[e,r]})}setQueryData(n,e,t){const r=this.defaultQueryOptions({queryKey:n}),o=this.#e.get(r.queryHash)?.state.data,i=dK(e,o);if(i!==void 0)return this.#e.build(this,r).setData(i,{...t,manual:!0})}setQueriesData(n,e,t){return Zo.batch(()=>this.#e.findAll(n).map(({queryKey:r})=>[r,this.setQueryData(r,e,t)]))}getQueryState(n){const e=this.defaultQueryOptions({queryKey:n});return this.#e.get(e.queryHash)?.state}removeQueries(n){const e=this.#e;Zo.batch(()=>{e.findAll(n).forEach(t=>{e.remove(t)})})}resetQueries(n,e){const t=this.#e;return Zo.batch(()=>(t.findAll(n).forEach(r=>{r.reset()}),this.refetchQueries({type:"active",...n},e)))}cancelQueries(n,e={}){const t={revert:!0,...e},r=Zo.batch(()=>this.#e.findAll(n).map(s=>s.cancel(t)));return Promise.all(r).then(Xa).catch(Xa)}invalidateQueries(n,e={}){return Zo.batch(()=>(this.#e.findAll(n).forEach(t=>{t.invalidate()}),n?.refetchType==="none"?Promise.resolve():this.refetchQueries({...n,type:n?.refetchType??n?.type??"active"},e)))}refetchQueries(n,e={}){const t={...e,cancelRefetch:e.cancelRefetch??!0},r=Zo.batch(()=>this.#e.findAll(n).filter(s=>!s.isDisabled()&&!s.isStatic()).map(s=>{let o=s.fetch(void 0,t);return t.throwOnError||(o=o.catch(Xa)),s.state.fetchStatus==="paused"?Promise.resolve():o}));return Promise.all(r).then(Xa)}fetchQuery(n){const e=this.defaultQueryOptions(n);e.retry===void 0&&(e.retry=!1);const t=this.#e.build(this,e);return t.isStaleByTime(B4(e.staleTime,t))?t.fetch(e):Promise.resolve(t.state.data)}prefetchQuery(n){return this.fetchQuery(n).then(Xa).catch(Xa)}fetchInfiniteQuery(n){return n.behavior=fI(n.pages),this.fetchQuery(n)}prefetchInfiniteQuery(n){return this.fetchInfiniteQuery(n).then(Xa).catch(Xa)}ensureInfiniteQueryData(n){return n.behavior=fI(n.pages),this.ensureQueryData(n)}resumePausedMutations(){return Zv.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#n}setDefaultOptions(n){this.#n=n}setQueryDefaults(n,e){this.#s.set(vg(n),{queryKey:n,defaultOptions:e})}getQueryDefaults(n){const e=[...this.#s.values()],t={};return e.forEach(r=>{yg(n,r.queryKey)&&Object.assign(t,r.defaultOptions)}),t}setMutationDefaults(n,e){this.#r.set(vg(n),{mutationKey:n,defaultOptions:e})}getMutationDefaults(n){const e=[...this.#r.values()],t={};return e.forEach(r=>{yg(n,r.mutationKey)&&Object.assign(t,r.defaultOptions)}),t}defaultQueryOptions(n){if(n._defaulted)return n;const e={...this.#n.queries,...this.getQueryDefaults(n.queryKey),...n,_defaulted:!0};return e.queryHash||(e.queryHash=Ek(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===Ik&&(e.enabled=!1),e}defaultMutationOptions(n){return n?._defaulted?n:{...this.#n.mutations,...n?.mutationKey&&this.getMutationDefaults(n.mutationKey),...n,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},FK=_.createContext(void 0),PK=({client:n,children:e})=>(_.useEffect(()=>(n.mount(),()=>{n.unmount()}),[n]),m.jsx(FK.Provider,{value:n,children:e}));function bg(){return bg=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},bg.apply(this,arguments)}var ju;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(ju||(ju={}));const pI="popstate";function OK(n){n===void 0&&(n={});function e(r,s){let{pathname:o,search:i,hash:a}=r.location;return W4("",{pathname:o,search:i,hash:a},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function t(r,s){return typeof s=="string"?s:iA(s)}return LK(e,t,null,n)}function Ms(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function oA(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function MK(){return Math.random().toString(36).substr(2,8)}function mI(n,e){return{usr:n.state,key:n.key,idx:e}}function W4(n,e,t,r){return t===void 0&&(t=null),bg({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof e=="string"?Up(e):e,{state:t,key:e&&e.key||r||MK()})}function iA(n){let{pathname:e="/",search:t="",hash:r=""}=n;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function Up(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substr(t),n=n.substr(0,t));let r=n.indexOf("?");r>=0&&(e.search=n.substr(r),n=n.substr(0,r)),n&&(e.pathname=n)}return e}function LK(n,e,t,r){r===void 0&&(r={});let{window:s=document.defaultView,v5Compat:o=!1}=r,i=s.history,a=ju.Pop,l=null,c=u();c==null&&(c=0,i.replaceState(bg({},i.state,{idx:c}),""));function u(){return(i.state||{idx:null}).idx}function d(){a=ju.Pop;let y=u(),b=y==null?null:y-c;c=y,l&&l({action:a,location:v.location,delta:b})}function f(y,b){a=ju.Push;let w=W4(v.location,y,b);c=u()+1;let S=mI(w,c),k=v.createHref(w);try{i.pushState(S,"",k)}catch(N){if(N instanceof DOMException&&N.name==="DataCloneError")throw N;s.location.assign(k)}o&&l&&l({action:a,location:v.location,delta:1})}function p(y,b){a=ju.Replace;let w=W4(v.location,y,b);c=u();let S=mI(w,c),k=v.createHref(w);i.replaceState(S,"",k),o&&l&&l({action:a,location:v.location,delta:0})}function x(y){let b=s.location.origin!=="null"?s.location.origin:s.location.href,w=typeof y=="string"?y:iA(y);return w=w.replace(/ $/,"%20"),Ms(b,"No window.location.(origin|href) available to create URL for href: "+w),new URL(w,b)}let v={get action(){return a},get location(){return n(s,i)},listen(y){if(l)throw new Error("A history only accepts one active listener");return s.addEventListener(pI,d),l=y,()=>{s.removeEventListener(pI,d),l=null}},createHref(y){return e(s,y)},createURL:x,encodeLocation(y){let b=x(y);return{pathname:b.pathname,search:b.search,hash:b.hash}},push:f,replace:p,go(y){return i.go(y)}};return v}var gI;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(gI||(gI={}));function jK(n,e,t){return t===void 0&&(t="/"),BK(n,e,t)}function BK(n,e,t,r){let s=typeof e=="string"?Up(e):e,o=cA(s.pathname||"/",t);if(o==null)return null;let i=aA(n);VK(i);let a=null;for(let l=0;a==null&&l<i.length;++l){let c=QK(o);a=YK(i[l],c)}return a}function aA(n,e,t,r){e===void 0&&(e=[]),t===void 0&&(t=[]),r===void 0&&(r="");let s=(o,i,a)=>{let l={relativePath:a===void 0?o.path||"":a,caseSensitive:o.caseSensitive===!0,childrenIndex:i,route:o};l.relativePath.startsWith("/")&&(Ms(l.relativePath.startsWith(r),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(r.length));let c=ff([r,l.relativePath]),u=t.concat(l);o.children&&o.children.length>0&&(Ms(o.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+c+'".')),aA(o.children,e,u,c)),!(o.path==null&&!o.index)&&e.push({path:c,score:KK(c,o.index),routesMeta:u})};return n.forEach((o,i)=>{var a;if(o.path===""||!((a=o.path)!=null&&a.includes("?")))s(o,i);else for(let l of lA(o.path))s(o,i,l)}),e}function lA(n){let e=n.split("/");if(e.length===0)return[];let[t,...r]=e,s=t.endsWith("?"),o=t.replace(/\?$/,"");if(r.length===0)return s?[o,""]:[o];let i=lA(r.join("/")),a=[];return a.push(...i.map(l=>l===""?o:[o,l].join("/"))),s&&a.push(...i),a.map(l=>n.startsWith("/")&&l===""?"/":l)}function VK(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:XK(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}const zK=/^:[\w-]+$/,WK=3,UK=2,HK=1,GK=10,qK=-2,xI=n=>n==="*";function KK(n,e){let t=n.split("/"),r=t.length;return t.some(xI)&&(r+=qK),e&&(r+=UK),t.filter(s=>!xI(s)).reduce((s,o)=>s+(zK.test(o)?WK:o===""?HK:GK),r)}function XK(n,e){return n.length===e.length&&n.slice(0,-1).every((r,s)=>r===e[s])?n[n.length-1]-e[e.length-1]:0}function YK(n,e,t){let{routesMeta:r}=n,s={},o="/",i=[];for(let a=0;a<r.length;++a){let l=r[a],c=a===r.length-1,u=o==="/"?e:e.slice(o.length)||"/",d=ZK({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},u),f=l.route;if(!d)return null;Object.assign(s,d.params),i.push({params:s,pathname:ff([o,d.pathname]),pathnameBase:oX(ff([o,d.pathnameBase])),route:f}),d.pathnameBase!=="/"&&(o=ff([o,d.pathnameBase]))}return i}function ZK(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,r]=JK(n.path,n.caseSensitive,n.end),s=e.match(t);if(!s)return null;let o=s[0],i=o.replace(/(.)\/+$/,"$1"),a=s.slice(1);return{params:r.reduce((c,u,d)=>{let{paramName:f,isOptional:p}=u;if(f==="*"){let v=a[d]||"";i=o.slice(0,o.length-v.length).replace(/(.)\/+$/,"$1")}const x=a[d];return p&&!x?c[f]=void 0:c[f]=(x||"").replace(/%2F/g,"/"),c},{}),pathname:o,pathnameBase:i,pattern:n}}function JK(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),oA(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let r=[],s="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(i,a,l)=>(r.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(r.push({paramName:"*"}),s+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?s+="\\/*$":n!==""&&n!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function QK(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return oA(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),n}}function cA(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=n.charAt(t);return r&&r!=="/"?null:n.slice(t)||"/"}function eX(n,e){e===void 0&&(e="/");let{pathname:t,search:r="",hash:s=""}=typeof n=="string"?Up(n):n;return{pathname:t?t.startsWith("/")?t:tX(t,e):e,search:iX(r),hash:aX(s)}}function tX(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(s=>{s===".."?t.length>1&&t.pop():s!=="."&&t.push(s)}),t.length>1?t.join("/"):"/"}function X3(n,e,t,r){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function nX(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function rX(n,e){let t=nX(n);return e?t.map((r,s)=>s===t.length-1?r.pathname:r.pathnameBase):t.map(r=>r.pathnameBase)}function sX(n,e,t,r){r===void 0&&(r=!1);let s;typeof n=="string"?s=Up(n):(s=bg({},n),Ms(!s.pathname||!s.pathname.includes("?"),X3("?","pathname","search",s)),Ms(!s.pathname||!s.pathname.includes("#"),X3("#","pathname","hash",s)),Ms(!s.search||!s.search.includes("#"),X3("#","search","hash",s)));let o=n===""||s.pathname==="",i=o?"/":s.pathname,a;if(i==null)a=t;else{let d=e.length-1;if(!r&&i.startsWith("..")){let f=i.split("/");for(;f[0]==="..";)f.shift(),d-=1;s.pathname=f.join("/")}a=d>=0?e[d]:"/"}let l=eX(s,a),c=i&&i!=="/"&&i.endsWith("/"),u=(o||i===".")&&t.endsWith("/");return!l.pathname.endsWith("/")&&(c||u)&&(l.pathname+="/"),l}const ff=n=>n.join("/").replace(/\/\/+/g,"/"),oX=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),iX=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,aX=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function lX(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const uA=["post","put","patch","delete"];new Set(uA);const cX=["get",...uA];new Set(cX);function wg(){return wg=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},wg.apply(this,arguments)}const Tk=_.createContext(null),uX=_.createContext(null),wy=_.createContext(null),Cy=_.createContext(null),jf=_.createContext({outlet:null,matches:[],isDataRoute:!1}),dA=_.createContext(null);function ky(){return _.useContext(Cy)!=null}function hc(){return ky()||Ms(!1),_.useContext(Cy).location}function fA(n){_.useContext(wy).static||_.useLayoutEffect(n)}function si(){let{isDataRoute:n}=_.useContext(jf);return n?SX():dX()}function dX(){ky()||Ms(!1);let n=_.useContext(Tk),{basename:e,future:t,navigator:r}=_.useContext(wy),{matches:s}=_.useContext(jf),{pathname:o}=hc(),i=JSON.stringify(rX(s,t.v7_relativeSplatPath)),a=_.useRef(!1);return fA(()=>{a.current=!0}),_.useCallback(function(c,u){if(u===void 0&&(u={}),!a.current)return;if(typeof c=="number"){r.go(c);return}let d=sX(c,JSON.parse(i),o,u.relative==="path");n==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:ff([e,d.pathname])),(u.replace?r.replace:r.push)(d,u.state,u)},[e,r,i,o,n])}function fX(){let{matches:n}=_.useContext(jf),e=n[n.length-1];return e?e.params:{}}function hX(n,e){return pX(n,e)}function pX(n,e,t,r){ky()||Ms(!1);let{navigator:s}=_.useContext(wy),{matches:o}=_.useContext(jf),i=o[o.length-1],a=i?i.params:{};i&&i.pathname;let l=i?i.pathnameBase:"/";i&&i.route;let c=hc(),u;if(e){var d;let y=typeof e=="string"?Up(e):e;l==="/"||(d=y.pathname)!=null&&d.startsWith(l)||Ms(!1),u=y}else u=c;let f=u.pathname||"/",p=f;if(l!=="/"){let y=l.replace(/^\//,"").split("/");p="/"+f.replace(/^\//,"").split("/").slice(y.length).join("/")}let x=jK(n,{pathname:p}),v=yX(x&&x.map(y=>Object.assign({},y,{params:Object.assign({},a,y.params),pathname:ff([l,s.encodeLocation?s.encodeLocation(y.pathname).pathname:y.pathname]),pathnameBase:y.pathnameBase==="/"?l:ff([l,s.encodeLocation?s.encodeLocation(y.pathnameBase).pathname:y.pathnameBase])})),o,t,r);return e&&v?_.createElement(Cy.Provider,{value:{location:wg({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:ju.Pop}},v):v}function mX(){let n=kX(),e=lX(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return _.createElement(_.Fragment,null,_.createElement("h2",null,"Unexpected Application Error!"),_.createElement("h3",{style:{fontStyle:"italic"}},e),t?_.createElement("pre",{style:s},t):null,null)}const gX=_.createElement(mX,null);class xX extends _.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?_.createElement(jf.Provider,{value:this.props.routeContext},_.createElement(dA.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function vX(n){let{routeContext:e,match:t,children:r}=n,s=_.useContext(Tk);return s&&s.static&&s.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=t.route.id),_.createElement(jf.Provider,{value:e},r)}function yX(n,e,t,r){var s;if(e===void 0&&(e=[]),t===void 0&&(t=null),r===void 0&&(r=null),n==null){var o;if(!t)return null;if(t.errors)n=t.matches;else if((o=r)!=null&&o.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let i=n,a=(s=t)==null?void 0:s.errors;if(a!=null){let u=i.findIndex(d=>d.route.id&&a?.[d.route.id]!==void 0);u>=0||Ms(!1),i=i.slice(0,Math.min(i.length,u+1))}let l=!1,c=-1;if(t&&r&&r.v7_partialHydration)for(let u=0;u<i.length;u++){let d=i[u];if((d.route.HydrateFallback||d.route.hydrateFallbackElement)&&(c=u),d.route.id){let{loaderData:f,errors:p}=t,x=d.route.loader&&f[d.route.id]===void 0&&(!p||p[d.route.id]===void 0);if(d.route.lazy||x){l=!0,c>=0?i=i.slice(0,c+1):i=[i[0]];break}}}return i.reduceRight((u,d,f)=>{let p,x=!1,v=null,y=null;t&&(p=a&&d.route.id?a[d.route.id]:void 0,v=d.route.errorElement||gX,l&&(c<0&&f===0?(NX("route-fallback"),x=!0,y=null):c===f&&(x=!0,y=d.route.hydrateFallbackElement||null)));let b=e.concat(i.slice(0,f+1)),w=()=>{let S;return p?S=v:x?S=y:d.route.Component?S=_.createElement(d.route.Component,null):d.route.element?S=d.route.element:S=u,_.createElement(vX,{match:d,routeContext:{outlet:u,matches:b,isDataRoute:t!=null},children:S})};return t&&(d.route.ErrorBoundary||d.route.errorElement||f===0)?_.createElement(xX,{location:t.location,revalidation:t.revalidation,component:v,error:p,children:w(),routeContext:{outlet:null,matches:b,isDataRoute:!0}}):w()},null)}var hA=(function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n})(hA||{}),pA=(function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n})(pA||{});function bX(n){let e=_.useContext(Tk);return e||Ms(!1),e}function wX(n){let e=_.useContext(uX);return e||Ms(!1),e}function CX(n){let e=_.useContext(jf);return e||Ms(!1),e}function mA(n){let e=CX(),t=e.matches[e.matches.length-1];return t.route.id||Ms(!1),t.route.id}function kX(){var n;let e=_.useContext(dA),t=wX(),r=mA();return e!==void 0?e:(n=t.errors)==null?void 0:n[r]}function SX(){let{router:n}=bX(hA.UseNavigateStable),e=mA(pA.UseNavigateStable),t=_.useRef(!1);return fA(()=>{t.current=!0}),_.useCallback(function(s,o){o===void 0&&(o={}),t.current&&(typeof s=="number"?n.navigate(s):n.navigate(s,wg({fromRouteId:e},o)))},[n,e])}const vI={};function NX(n,e,t){vI[n]||(vI[n]=!0)}function EX(n,e){n?.v7_startTransition,n?.v7_relativeSplatPath}function Zs(n){Ms(!1)}function IX(n){let{basename:e="/",children:t=null,location:r,navigationType:s=ju.Pop,navigator:o,static:i=!1,future:a}=n;ky()&&Ms(!1);let l=e.replace(/^\/*/,"/"),c=_.useMemo(()=>({basename:l,navigator:o,static:i,future:wg({v7_relativeSplatPath:!1},a)}),[l,a,o,i]);typeof r=="string"&&(r=Up(r));let{pathname:u="/",search:d="",hash:f="",state:p=null,key:x="default"}=r,v=_.useMemo(()=>{let y=cA(u,l);return y==null?null:{location:{pathname:y,search:d,hash:f,state:p,key:x},navigationType:s}},[l,u,d,f,p,x,s]);return v==null?null:_.createElement(wy.Provider,{value:c},_.createElement(Cy.Provider,{children:t,value:v}))}function TX(n){let{children:e,location:t}=n;return hX(U4(e),t)}new Promise(()=>{});function U4(n,e){e===void 0&&(e=[]);let t=[];return _.Children.forEach(n,(r,s)=>{if(!_.isValidElement(r))return;let o=[...e,s];if(r.type===_.Fragment){t.push.apply(t,U4(r.props.children,o));return}r.type!==Zs&&Ms(!1),!r.props.index||!r.props.children||Ms(!1);let i={id:r.props.id||o.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(i.children=U4(r.props.children,o)),t.push(i)}),t}function H4(n){return n===void 0&&(n=""),new URLSearchParams(typeof n=="string"||Array.isArray(n)||n instanceof URLSearchParams?n:Object.keys(n).reduce((e,t)=>{let r=n[t];return e.concat(Array.isArray(r)?r.map(s=>[t,s]):[[t,r]])},[]))}function _X(n,e){let t=H4(n);return e&&e.forEach((r,s)=>{t.has(s)||e.getAll(s).forEach(o=>{t.append(s,o)})}),t}const RX="6";try{window.__reactRouterVersion=RX}catch{}const DX="startTransition",yI=ly[DX];function AX(n){let{basename:e,children:t,future:r,window:s}=n,o=_.useRef();o.current==null&&(o.current=OK({window:s,v5Compat:!0}));let i=o.current,[a,l]=_.useState({action:i.action,location:i.location}),{v7_startTransition:c}=r||{},u=_.useCallback(d=>{c&&yI?yI(()=>l(d)):l(d)},[l,c]);return _.useLayoutEffect(()=>i.listen(u),[i,u]),_.useEffect(()=>EX(r),[r]),_.createElement(IX,{basename:e,children:t,location:a.location,navigationType:a.action,navigator:i,future:r})}var bI;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(bI||(bI={}));var wI;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(wI||(wI={}));function $X(n){let e=_.useRef(H4(n)),t=_.useRef(!1),r=hc(),s=_.useMemo(()=>_X(r.search,t.current?null:e.current),[r.search]),o=si(),i=_.useCallback((a,l)=>{const c=H4(typeof a=="function"?a(s):a);t.current=!0,o("?"+c,l)},[o,s]);return[s,i]}function gA({onMobileMenuToggle:n,isMobileMenuOpen:e}){return m.jsxs("header",{className:"flex w-full h-10 sm:h-11 px-3 sm:px-4 items-center justify-between flex-shrink-0 border-b border-border bg-background",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-[68px] h-[35px] flex-shrink-0 relative",children:m.jsxs("svg",{className:"w-[62px] h-[14px] flex-shrink-0 absolute left-[1px] top-[10.5px]",width:"64",height:"15",viewBox:"0 0 64 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("path",{d:"M19.6451 5.60708C20.4605 4.62689 21.4477 4.13672 22.6065 4.13672C23.2074 4.13672 23.76 4.30211 24.2643 4.63275C24.7686 4.96347 25.1548 5.38861 25.4231 5.90825L25.5679 4.29617H27.6281V14.0394H25.5679L25.4231 12.4096C25.1548 12.9293 24.7686 13.3544 24.2643 13.6851C23.76 14.0158 23.2074 14.1811 22.6065 14.1811C21.4477 14.1811 20.4605 13.691 19.6451 12.7107C18.8296 11.7187 18.4219 10.5318 18.4219 9.15007C18.4219 7.76827 18.8296 6.58727 19.6451 5.60708ZM21.3833 10.957C21.8339 11.4648 22.3812 11.7187 23.025 11.7187C23.6795 11.7187 24.2321 11.4707 24.6827 10.9747C25.1334 10.4668 25.3587 9.85864 25.3587 9.15007C25.3587 8.4415 25.1334 7.83916 24.6827 7.34313C24.2321 6.83529 23.6795 6.58141 23.025 6.58141C22.3812 6.58141 21.8339 6.83529 21.3833 7.34313C20.9327 7.83916 20.7073 8.4415 20.7073 9.15007C20.7073 9.85864 20.9327 10.461 21.3833 10.957ZM29.5129 4.29617H31.573L31.734 5.69564C32.2598 4.71545 33.1343 4.22535 34.3575 4.22535C34.6686 4.22535 34.9369 4.24896 35.1622 4.29617L34.6954 6.68771C34.5667 6.6641 34.4755 6.65223 34.4219 6.65223C33.6707 6.65223 33.0431 6.90618 32.5387 7.41402C32.0344 7.90998 31.7823 8.7544 31.7823 9.9472V14.0394H29.5129V4.29617ZM37.3457 5.62482C38.2255 4.64456 39.2932 4.15446 40.5485 4.15446C41.2996 4.15446 42.0025 4.34932 42.657 4.73906C43.3115 5.11698 43.8534 5.63069 44.2825 6.28024L42.4156 7.6443C41.9542 7.00655 41.3319 6.68771 40.5485 6.68771C39.9262 6.68771 39.3951 6.92979 38.9551 7.41402C38.5153 7.89818 38.2953 8.48277 38.2953 9.16781C38.2953 9.86457 38.5153 10.455 38.9551 10.9393C39.3951 11.4235 39.9262 11.6656 40.5485 11.6656C41.3748 11.6656 42.0078 11.3113 42.4477 10.6027L44.3308 11.9844C43.9124 12.6576 43.3705 13.195 42.7052 13.5965C42.04 13.998 41.3211 14.1988 40.5485 14.1988C39.2932 14.1988 38.2202 13.7087 37.3296 12.7285C36.4498 11.7365 36.0098 10.5495 36.0098 9.16781C36.0098 7.78601 36.4551 6.60501 37.3457 5.62482ZM46.619 5.62482C47.4989 4.64456 48.5665 4.15446 49.8219 4.15446C51.0773 4.15446 52.1503 4.65049 53.0409 5.64249C53.9422 6.62275 54.3929 7.79781 54.3929 9.16781C54.3929 10.5495 53.9476 11.7305 53.057 12.7107C52.1557 13.7028 51.0773 14.1988 49.8219 14.1988C48.5665 14.1988 47.4935 13.7087 46.603 12.7285C45.7231 11.7365 45.2832 10.5495 45.2832 9.16781C45.2832 7.78601 45.7285 6.60501 46.619 5.62482ZM47.5687 9.16781C47.5687 9.86457 47.7886 10.455 48.2285 10.9393C48.6685 11.4235 49.1996 11.6656 49.8219 11.6656C50.455 11.6656 50.9915 11.4235 51.4314 10.9393C51.8713 10.455 52.0913 9.86457 52.0913 9.16781C52.0913 8.48277 51.8713 7.89818 51.4314 7.41402C50.9915 6.92979 50.455 6.68771 49.8219 6.68771C49.1996 6.68771 48.6685 6.92979 48.2285 7.41402C47.7886 7.89818 47.5687 8.48277 47.5687 9.16781ZM55.8398 14.0394V4.29617H57.9L58.0448 5.71338C58.3024 5.24096 58.6404 4.86303 59.0588 4.5796C59.488 4.28437 59.9709 4.13672 60.5073 4.13672C61.5803 4.13672 62.428 4.54419 63.0504 5.35906C63.6834 6.17393 63.9999 7.40808 63.9999 9.0615V14.0394H61.7466V9.0615C61.7466 8.24663 61.5696 7.63249 61.2155 7.21915C60.8722 6.79401 60.443 6.58141 59.928 6.58141C59.4022 6.58141 58.9676 6.79401 58.6243 7.21915C58.2809 7.63249 58.1092 8.24663 58.1092 9.0615V14.0394H55.8398Z",fill:"#323238"}),m.jsx("path",{d:"M14.3486 12.068C14.6548 12.6673 14.2196 13.3786 13.5466 13.3786H3.02185C2.3453 13.3786 1.91028 12.6605 2.22355 12.0608L7.54372 1.87698C7.8823 1.22887 8.81128 1.23303 9.14404 1.88415L14.3486 12.068Z",stroke:"#D83A52",strokeWidth:"2.42826"})]})}),m.jsx("svg",{className:"w-0 h-5 flex-shrink-0 stroke-1 stroke-border",width:"2",height:"21",viewBox:"0 0 2 21",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M1 0.332031V20.332",stroke:"#D0D4E4"})}),m.jsx("div",{className:"flex w-[86px] h-[35px] p-[5.5px_3.313px_7px_3px] justify-center items-center flex-shrink-0",children:m.jsxs("svg",{className:"w-20 h-[23px] flex-shrink-0",width:"80",height:"23",viewBox:"0 0 80 23",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("g",{clipPath:"url(#clip0_2641_20372)",children:m.jsx("path",{d:"M1.79875 10.5468C1.79875 9.30919 1.17188 8.28658 0 7.42773H2.72375C3.2039 7.79347 3.59293 8.26535 3.86041 8.80645C4.1279 9.34755 4.26659 9.94321 4.26563 10.5468C4.26659 11.1504 4.1279 11.7461 3.86041 12.2872C3.59293 12.8283 3.2039 13.3002 2.72375 13.6659C3.60813 14.0347 4.11125 14.9348 4.11125 16.2231V18.6777H1.645V16.2231C1.645 14.9961 1.05938 14.1372 0.000625 13.6666C1.1725 12.8071 1.79875 11.7845 1.79875 10.5468ZM7.14375 10.5468C7.14375 9.30919 6.51688 8.28658 5.345 7.42773H8.06938C8.54941 7.79354 8.93832 8.26544 9.20569 8.80654C9.47307 9.34764 9.61166 9.94326 9.61063 10.5468C9.61166 11.1504 9.47307 11.746 9.20569 12.2871C8.93832 12.8282 8.54941 13.3001 8.06938 13.6659C8.95313 14.0347 9.45688 14.9348 9.45688 16.2231V18.6777H6.99V16.2231C6.99 14.9961 6.40375 14.1372 5.345 13.6666C6.51688 12.8071 7.14375 11.4524 7.14375 10.5468ZM12.49 10.5468C12.49 9.30919 11.8631 8.28658 10.6913 7.42773H13.415C13.8951 7.79347 14.2842 8.26535 14.5517 8.80645C14.8191 9.34755 14.9578 9.94321 14.9569 10.5468C14.9578 11.1504 14.8191 11.7461 14.5517 12.2872C14.2842 12.8283 13.8951 13.3002 13.415 13.6659C14.2994 14.0347 14.8025 14.9348 14.8025 16.2231V18.6777H12.3356V16.2231C12.3356 14.9961 11.75 14.1372 10.6913 13.6666C11.8631 12.8071 12.49 11.7845 12.49 10.5468ZM22.47 16.6338H20.6V9.47296H25.195C27.405 9.47296 28.4944 10.2918 28.4944 11.6313C28.4944 12.5414 27.96 13.2265 26.9631 13.5747C27.9906 13.7278 28.4531 14.2697 28.4531 15.2417V16.6325H26.5619V15.3236C26.5619 14.5048 26.1506 14.1779 25.0713 14.1779H22.4713V16.6338H22.47ZM25.0913 10.5162H22.47V13.1352H25.0706C26.0163 13.1352 26.6019 12.6133 26.6019 11.7951C26.6019 10.9869 26.0581 10.5162 25.0913 10.5162ZM31.7419 9.47296H29.8713V16.6338H31.7419V9.47296ZM37.4775 14.3004H35.1956V16.6325H33.3244V9.47296H37.5181C39.7281 9.47296 40.89 10.3937 40.89 11.867C40.89 13.3903 39.7081 14.3004 37.4775 14.3004ZM37.4363 10.5162H35.1956V13.2571H37.4156C38.3819 13.2571 38.9781 12.7665 38.9781 11.877C38.9781 11.0075 38.3819 10.5162 37.4363 10.5162ZM46.1531 14.3004H43.8713V16.6325H42V9.47296H46.1938C48.4038 9.47296 49.5656 10.3937 49.5656 11.867C49.5656 13.3903 48.3831 14.3004 46.1531 14.3004ZM46.1119 10.5162H43.8713V13.2571H46.0913C47.0575 13.2571 47.6538 12.7665 47.6538 11.877C47.6538 11.0075 47.0575 10.5162 46.1119 10.5162ZM52.5463 9.47296V15.5686H57.2131V16.6338H50.6756V9.47296H52.5463ZM60.2544 9.47296H58.3838V16.6338H60.2544V9.47296ZM63.0713 11.8664V16.6338H61.8375V9.47296H63.2369L68.335 14.2391V9.47296H69.5688V16.6338H68.1706L63.0713 11.8664ZM75.675 10.3118C73.8963 10.3118 72.735 11.4369 72.735 13.114C72.735 14.7704 73.845 15.7937 75.5719 15.7937H75.695C76.2813 15.7937 76.9388 15.6705 77.5456 15.4768V13.5434H74.5238V12.5208H79.375V15.8855C78.3681 16.4075 76.8463 16.8169 75.6131 16.8169H75.4488C72.6113 16.8169 70.7819 15.323 70.7819 13.1546C70.7819 11.0069 72.6631 9.28919 75.5513 9.28919H75.7156C76.9188 9.28919 78.2956 9.66736 79.3138 10.2605L78.7788 11.1294C77.8644 10.6287 76.7744 10.3118 75.7981 10.3118H75.675Z",fill:"black"})}),m.jsx("defs",{children:m.jsx("clipPath",{id:"clip0_2641_20372",children:m.jsx("rect",{width:"79.6875",height:"22.5",fill:"white",transform:"translate(0 0.332031)"})})})]})})]}),m.jsx("div",{className:"sm:hidden",children:m.jsx("button",{onClick:()=>n&&n(),"aria-controls":"mobile-step-sidebar","aria-expanded":!!e,className:"flex items-center justify-center w-6 h-6",children:m.jsx("svg",{className:"w-6 h-6",viewBox:"0 0 24 25",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M3 12.332H21M3 6.33203H21M3 18.332H21",stroke:"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})})})]})}function Jv({sections:n,currentStep:e}){const t=n.map((r,s)=>({number:s+1,title:r.name,description:r.sectionType==="personalInformation"?"Please provide your basic personal information to begin the identity verification process.":r.sectionType==="documents"?"Choose a valid government-issued ID (like a passport, driver's license, or national ID) and upload a clear photo of it.":"Take a live selfie to confirm you are the person in the ID document.",isActive:s+1===e,isCompleted:s+1<e}));return m.jsx("aside",{className:"w-80 bg-white h-full",children:m.jsx("div",{className:"flex flex-col gap-1 p-2",children:t.map((r,s)=>m.jsx("div",{className:"relative",children:m.jsxs("div",{className:"flex items-start gap-3",children:[m.jsxs("div",{className:"flex flex-col items-center relative z-10",children:[m.jsxs("div",{className:"relative",children:[m.jsx("svg",{width:"28",height:"28",viewBox:"0 0 28 28",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"flex-shrink-0",children:m.jsx("circle",{cx:"14",cy:"14",r:"13.25",fill:r.isActive||r.isCompleted?"#0073EA":"white",stroke:r.isActive||r.isCompleted?"#0073EA":"#D0D4E4",strokeWidth:"1.5"})}),m.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:m.jsx("span",{className:`font-roboto text-[13px] font-normal leading-none ${r.isActive||r.isCompleted?"text-white":"text-[#42526E]"}`,children:r.number})})]}),s<t.length-1&&m.jsx("div",{className:"mt-2 mb-2",children:m.jsx("div",{className:`w-0 h-16 sm:h-20 md:h-24 lg:h-28 xl:h-32 border-l-2 ${r.isCompleted?"border-[#0073EA]":"border-[#D0D4E4]"}`})})]}),m.jsx("div",{className:`flex-1 rounded-lg p-3 ${r.isActive?"bg-[#E6F1FD]":"bg-white"} ${s<t.length-1?"mb-1":""}`,children:m.jsxs("div",{className:"flex flex-col gap-1",children:[m.jsx("h3",{className:`font-roboto text-[15px] font-bold leading-6 ${r.isActive,"text-[#323238]"}`,children:r.title}),m.jsxs("div",{className:"font-roboto text-[13px] font-medium text-[#323238] leading-normal",children:["Step ",r.number]}),m.jsx("p",{className:`font-figtree text-[13px] font-normal leading-5 mt-1 ${r.isActive?"text-[#172B4D]":"text-[#42526E]"}`,children:r.description})]})})]})},r.number))})})}function xA({isOpen:n,onClose:e,onAgree:t}){const[r,s]=_.useState({shareDetails:!1,allowVerification:!1,dataStorage:!1,privacyPolicy:!1}),[o,i]=_.useState(!1),a=(d,f)=>{const p={...r,[d]:f};s(p);const x=Object.values(p).every(Boolean);i(x)},l=d=>{i(d),s({shareDetails:d,allowVerification:d,dataStorage:d,privacyPolicy:d})},c=Object.values(r).every(Boolean),u=()=>{c&&t()};return _.useEffect(()=>{if(!n)return;const d=document.body,f=document.documentElement,p=d.style.overflow,x=d.style.paddingRight,v=window.innerWidth-f.clientWidth;v>0&&(d.style.paddingRight=`${v}px`),d.style.overflow="hidden";const y=b=>b.preventDefault();return document.addEventListener("touchmove",y,{passive:!1}),()=>{d.style.overflow=p,d.style.paddingRight=x,document.removeEventListener("touchmove",y)}},[n]),n?m.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"consent-title",children:m.jsxs("div",{className:"flex w-full max-w-[800px] mx-4 flex-col items-center gap-6 rounded-lg bg-background shadow-lg max-h-[90vh] overflow-hidden",children:[m.jsx("div",{className:"flex h-[52px] py-2.5 px-5 justify-center items-center self-stretch rounded-t border-b border-border bg-background",children:m.jsx("div",{id:"consent-title",className:"text-text-primary font-figtree text-lg font-bold leading-[26px]",children:"Identity Verification Consent"})}),m.jsxs("div",{className:"flex py-3 px-5 flex-col items-start gap-4 self-stretch overflow-y-auto",children:[m.jsxs("div",{className:"flex flex-col items-start gap-4",children:[m.jsx("div",{className:"text-text-primary font-roboto text-base font-bold",children:"To verify your identity securely and meet legal requirements, we need your consent to:"}),m.jsx("div",{className:"flex flex-col items-start gap-2",children:["1. Use your personal details (name, email, phone, address, ID)","2. Scan your ID document (Aadhaar, PAN, or Passport)","3. Capture your selfie or video to confirm it's really you","4. Verify your ID with official sources (like DigiLocker or UIDAI)","5. Store your data for XX days for audit and compliance"].map((d,f)=>m.jsx("div",{className:"text-text-secondary font-roboto text-sm",children:d},f))})]}),m.jsxs("div",{className:"flex flex-col items-start gap-4 self-stretch",children:[m.jsx("div",{className:"text-text-primary font-roboto text-base font-bold",children:"Please Confirm"}),m.jsxs("div",{className:"flex flex-col items-start gap-2 self-stretch",children:[m.jsxs("div",{className:"flex items-center gap-2 self-stretch",children:[m.jsx("input",{type:"checkbox",id:"shareDetails",checked:r.shareDetails,onChange:d=>a("shareDetails",d.target.checked),className:"w-4 h-4 rounded border border-input-border bg-background"}),m.jsx("label",{htmlFor:"shareDetails",className:"text-text-secondary font-roboto text-sm",children:"I agree to share my details, documents, and selfie/video for identity verification"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("input",{type:"checkbox",id:"allowVerification",checked:r.allowVerification,onChange:d=>a("allowVerification",d.target.checked),className:"w-4 h-4 rounded border border-input-border bg-background"}),m.jsx("label",{htmlFor:"allowVerification",className:"text-text-secondary font-roboto text-sm",children:"I allow my data to be verified with official authorities"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("input",{type:"checkbox",id:"dataStorage",checked:r.dataStorage,onChange:d=>a("dataStorage",d.target.checked),className:"w-4 h-4 rounded border border-input-border bg-background"}),m.jsx("label",{htmlFor:"dataStorage",className:"text-text-secondary font-roboto text-sm",children:"I understand my data will be stored for XX days after verification"})]})]})]}),m.jsx("div",{className:"flex items-start gap-2 self-stretch",children:m.jsxs("div",{className:"text-text-secondary font-roboto text-sm leading-normal",children:["By continuing, you agree to our terms and privacy policy. You can"," ",m.jsx("span",{className:"text-primary cursor-pointer hover:underline",children:"update your consent preferences or revoke consent here"}),". For more details, read our"," ",m.jsx("span",{className:"text-primary cursor-pointer hover:underline",children:"Privacy Policy"}),". If you have any questions or need help, feel free to reach out to us at amritemail.com."]})}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("input",{type:"checkbox",id:"privacyPolicy",checked:r.privacyPolicy,onChange:d=>a("privacyPolicy",d.target.checked),className:"w-4 h-4 rounded border border-input-border bg-background"}),m.jsx("label",{htmlFor:"privacyPolicy",className:"text-text-secondary font-roboto text-sm",children:"I have read and agree to the Privacy Policy."})]})]}),m.jsxs("div",{className:"flex w-full h-[70px] py-5 px-5 justify-between items-center rounded-b border-t border-border bg-background shadow-sm",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("input",{type:"checkbox",id:"agreeToAll",checked:o,onChange:d=>l(d.target.checked),className:"w-4 h-4 rounded border border-input-border bg-background"}),m.jsx("label",{htmlFor:"agreeToAll",className:"text-text-secondary font-roboto text-sm",children:"Agree to all"})]}),m.jsx("div",{className:"flex justify-end items-start",children:m.jsx("button",{onClick:u,disabled:!c,className:`flex h-8 py-2 px-4 justify-center items-center gap-2 rounded ${c?"bg-primary hover:bg-primary/90":"bg-primary/50 cursor-not-allowed"}`,children:m.jsx("span",{className:"text-white font-roboto text-[13px] font-medium",children:"I Agree"})})})]})]})}):null}var Y3="focusScope.autoFocusOnMount",Z3="focusScope.autoFocusOnUnmount",CI={bubbles:!1,cancelable:!0},FX="FocusScope",vA=_.forwardRef((n,e)=>{const{loop:t=!1,trapped:r=!1,onMountAutoFocus:s,onUnmountAutoFocus:o,...i}=n,[a,l]=_.useState(null),c=sc(s),u=sc(o),d=_.useRef(null),f=ti(e,v=>l(v)),p=_.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;_.useEffect(()=>{if(r){let v=function(S){if(p.paused||!a)return;const k=S.target;a.contains(k)?d.current=k:Ou(d.current,{select:!0})},y=function(S){if(p.paused||!a)return;const k=S.relatedTarget;k!==null&&(a.contains(k)||Ou(d.current,{select:!0}))},b=function(S){if(document.activeElement===document.body)for(const N of S)N.removedNodes.length>0&&Ou(a)};document.addEventListener("focusin",v),document.addEventListener("focusout",y);const w=new MutationObserver(b);return a&&w.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",v),document.removeEventListener("focusout",y),w.disconnect()}}},[r,a,p.paused]),_.useEffect(()=>{if(a){SI.add(p);const v=document.activeElement;if(!a.contains(v)){const b=new CustomEvent(Y3,CI);a.addEventListener(Y3,c),a.dispatchEvent(b),b.defaultPrevented||(PX(BX(yA(a)),{select:!0}),document.activeElement===v&&Ou(a))}return()=>{a.removeEventListener(Y3,c),setTimeout(()=>{const b=new CustomEvent(Z3,CI);a.addEventListener(Z3,u),a.dispatchEvent(b),b.defaultPrevented||Ou(v??document.body,{select:!0}),a.removeEventListener(Z3,u),SI.remove(p)},0)}}},[a,c,u,p]);const x=_.useCallback(v=>{if(!t&&!r||p.paused)return;const y=v.key==="Tab"&&!v.altKey&&!v.ctrlKey&&!v.metaKey,b=document.activeElement;if(y&&b){const w=v.currentTarget,[S,k]=OX(w);S&&k?!v.shiftKey&&b===k?(v.preventDefault(),t&&Ou(S,{select:!0})):v.shiftKey&&b===S&&(v.preventDefault(),t&&Ou(k,{select:!0})):b===w&&v.preventDefault()}},[t,r,p.paused]);return m.jsx(Is.div,{tabIndex:-1,...i,ref:f,onKeyDown:x})});vA.displayName=FX;function PX(n,{select:e=!1}={}){const t=document.activeElement;for(const r of n)if(Ou(r,{select:e}),document.activeElement!==t)return}function OX(n){const e=yA(n),t=kI(e,n),r=kI(e.reverse(),n);return[t,r]}function yA(n){const e=[],t=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const s=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||s?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function kI(n,e){for(const t of n)if(!MX(t,{upTo:e}))return t}function MX(n,{upTo:e}){if(getComputedStyle(n).visibility==="hidden")return!0;for(;n;){if(e!==void 0&&n===e)return!1;if(getComputedStyle(n).display==="none")return!0;n=n.parentElement}return!1}function LX(n){return n instanceof HTMLInputElement&&"select"in n}function Ou(n,{select:e=!1}={}){if(n&&n.focus){const t=document.activeElement;n.focus({preventScroll:!0}),n!==t&&LX(n)&&e&&n.select()}}var SI=jX();function jX(){let n=[];return{add(e){const t=n[0];e!==t&&t?.pause(),n=NI(n,e),n.unshift(e)},remove(e){n=NI(n,e),n[0]?.resume()}}}function NI(n,e){const t=[...n],r=t.indexOf(e);return r!==-1&&t.splice(r,1),t}function BX(n){return n.filter(e=>e.tagName!=="A")}var J3=0;function VX(){_.useEffect(()=>{const n=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",n[0]??EI()),document.body.insertAdjacentElement("beforeend",n[1]??EI()),J3++,()=>{J3===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),J3--}},[])}function EI(){const n=document.createElement("span");return n.setAttribute("data-radix-focus-guard",""),n.tabIndex=0,n.style.outline="none",n.style.opacity="0",n.style.position="fixed",n.style.pointerEvents="none",n}var Vl=function(){return Vl=Object.assign||function(e){for(var t,r=1,s=arguments.length;r<s;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},Vl.apply(this,arguments)};function bA(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t}function zX(n,e,t){if(t||arguments.length===2)for(var r=0,s=e.length,o;r<s;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))}var $v="right-scroll-bar-position",Fv="width-before-scroll-bar",WX="with-scroll-bars-hidden",UX="--removed-body-scroll-bar-size";function Q3(n,e){return typeof n=="function"?n(e):n&&(n.current=e),n}function HX(n,e){var t=_.useState(function(){return{value:n,callback:e,facade:{get current(){return t.value},set current(r){var s=t.value;s!==r&&(t.value=r,t.callback(r,s))}}}})[0];return t.callback=e,t.facade}var GX=typeof window<"u"?_.useLayoutEffect:_.useEffect,II=new WeakMap;function qX(n,e){var t=HX(null,function(r){return n.forEach(function(s){return Q3(s,r)})});return GX(function(){var r=II.get(t);if(r){var s=new Set(r),o=new Set(n),i=t.current;s.forEach(function(a){o.has(a)||Q3(a,null)}),o.forEach(function(a){s.has(a)||Q3(a,i)})}II.set(t,n)},[n]),t}function KX(n){return n}function XX(n,e){e===void 0&&(e=KX);var t=[],r=!1,s={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return t.length?t[t.length-1]:n},useMedium:function(o){var i=e(o,r);return t.push(i),function(){t=t.filter(function(a){return a!==i})}},assignSyncMedium:function(o){for(r=!0;t.length;){var i=t;t=[],i.forEach(o)}t={push:function(a){return o(a)},filter:function(){return t}}},assignMedium:function(o){r=!0;var i=[];if(t.length){var a=t;t=[],a.forEach(o),i=t}var l=function(){var u=i;i=[],u.forEach(o)},c=function(){return Promise.resolve().then(l)};c(),t={push:function(u){i.push(u),c()},filter:function(u){return i=i.filter(u),t}}}};return s}function YX(n){n===void 0&&(n={});var e=XX(null);return e.options=Vl({async:!0,ssr:!1},n),e}var wA=function(n){var e=n.sideCar,t=bA(n,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=e.read();if(!r)throw new Error("Sidecar medium not found");return _.createElement(r,Vl({},t))};wA.isSideCarExport=!0;function ZX(n,e){return n.useMedium(e),wA}var CA=YX(),eC=function(){},Sy=_.forwardRef(function(n,e){var t=_.useRef(null),r=_.useState({onScrollCapture:eC,onWheelCapture:eC,onTouchMoveCapture:eC}),s=r[0],o=r[1],i=n.forwardProps,a=n.children,l=n.className,c=n.removeScrollBar,u=n.enabled,d=n.shards,f=n.sideCar,p=n.noRelative,x=n.noIsolation,v=n.inert,y=n.allowPinchZoom,b=n.as,w=b===void 0?"div":b,S=n.gapMode,k=bA(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),N=f,I=qX([t,e]),T=Vl(Vl({},k),s);return _.createElement(_.Fragment,null,u&&_.createElement(N,{sideCar:CA,removeScrollBar:c,shards:d,noRelative:p,noIsolation:x,inert:v,setCallbacks:o,allowPinchZoom:!!y,lockRef:t,gapMode:S}),i?_.cloneElement(_.Children.only(a),Vl(Vl({},T),{ref:I})):_.createElement(w,Vl({},T,{className:l,ref:I}),a))});Sy.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};Sy.classNames={fullWidth:Fv,zeroRight:$v};var JX=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function QX(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var e=JX();return e&&n.setAttribute("nonce",e),n}function eY(n,e){n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}function tY(n){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(n)}var nY=function(){var n=0,e=null;return{add:function(t){n==0&&(e=QX())&&(eY(e,t),tY(e)),n++},remove:function(){n--,!n&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},rY=function(){var n=nY();return function(e,t){_.useEffect(function(){return n.add(e),function(){n.remove()}},[e&&t])}},kA=function(){var n=rY(),e=function(t){var r=t.styles,s=t.dynamic;return n(r,s),null};return e},sY={left:0,top:0,right:0,gap:0},tC=function(n){return parseInt(n||"",10)||0},oY=function(n){var e=window.getComputedStyle(document.body),t=e[n==="padding"?"paddingLeft":"marginLeft"],r=e[n==="padding"?"paddingTop":"marginTop"],s=e[n==="padding"?"paddingRight":"marginRight"];return[tC(t),tC(r),tC(s)]},iY=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return sY;var e=oY(n),t=document.documentElement.clientWidth,r=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,r-t+e[2]-e[0])}},aY=kA(),sp="data-scroll-locked",lY=function(n,e,t,r){var s=n.left,o=n.top,i=n.right,a=n.gap;return t===void 0&&(t="margin"),`
  .`.concat(WX,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(a,"px ").concat(r,`;
  }
  body[`).concat(sp,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(r,";"),t==="margin"&&`
    padding-left: `.concat(s,`px;
    padding-top: `).concat(o,`px;
    padding-right: `).concat(i,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(r,`;
    `),t==="padding"&&"padding-right: ".concat(a,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat($v,` {
    right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(Fv,` {
    margin-right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat($v," .").concat($v,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(Fv," .").concat(Fv,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(sp,`] {
    `).concat(UX,": ").concat(a,`px;
  }
`)},TI=function(){var n=parseInt(document.body.getAttribute(sp)||"0",10);return isFinite(n)?n:0},cY=function(){_.useEffect(function(){return document.body.setAttribute(sp,(TI()+1).toString()),function(){var n=TI()-1;n<=0?document.body.removeAttribute(sp):document.body.setAttribute(sp,n.toString())}},[])},uY=function(n){var e=n.noRelative,t=n.noImportant,r=n.gapMode,s=r===void 0?"margin":r;cY();var o=_.useMemo(function(){return iY(s)},[s]);return _.createElement(aY,{styles:lY(o,!e,s,t?"":"!important")})},G4=!1;if(typeof window<"u")try{var Hx=Object.defineProperty({},"passive",{get:function(){return G4=!0,!0}});window.addEventListener("test",Hx,Hx),window.removeEventListener("test",Hx,Hx)}catch{G4=!1}var Ah=G4?{passive:!1}:!1,dY=function(n){return n.tagName==="TEXTAREA"},SA=function(n,e){if(!(n instanceof Element))return!1;var t=window.getComputedStyle(n);return t[e]!=="hidden"&&!(t.overflowY===t.overflowX&&!dY(n)&&t[e]==="visible")},fY=function(n){return SA(n,"overflowY")},hY=function(n){return SA(n,"overflowX")},_I=function(n,e){var t=e.ownerDocument,r=e;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var s=NA(n,r);if(s){var o=EA(n,r),i=o[1],a=o[2];if(i>a)return!0}r=r.parentNode}while(r&&r!==t.body);return!1},pY=function(n){var e=n.scrollTop,t=n.scrollHeight,r=n.clientHeight;return[e,t,r]},mY=function(n){var e=n.scrollLeft,t=n.scrollWidth,r=n.clientWidth;return[e,t,r]},NA=function(n,e){return n==="v"?fY(e):hY(e)},EA=function(n,e){return n==="v"?pY(e):mY(e)},gY=function(n,e){return n==="h"&&e==="rtl"?-1:1},xY=function(n,e,t,r,s){var o=gY(n,window.getComputedStyle(e).direction),i=o*r,a=t.target,l=e.contains(a),c=!1,u=i>0,d=0,f=0;do{if(!a)break;var p=EA(n,a),x=p[0],v=p[1],y=p[2],b=v-y-o*x;(x||b)&&NA(n,a)&&(d+=b,f+=x);var w=a.parentNode;a=w&&w.nodeType===Node.DOCUMENT_FRAGMENT_NODE?w.host:w}while(!l&&a!==document.body||l&&(e.contains(a)||e===a));return(u&&Math.abs(d)<1||!u&&Math.abs(f)<1)&&(c=!0),c},Gx=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},RI=function(n){return[n.deltaX,n.deltaY]},DI=function(n){return n&&"current"in n?n.current:n},vY=function(n,e){return n[0]===e[0]&&n[1]===e[1]},yY=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},bY=0,$h=[];function wY(n){var e=_.useRef([]),t=_.useRef([0,0]),r=_.useRef(),s=_.useState(bY++)[0],o=_.useState(kA)[0],i=_.useRef(n);_.useEffect(function(){i.current=n},[n]),_.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(s));var v=zX([n.lockRef.current],(n.shards||[]).map(DI),!0).filter(Boolean);return v.forEach(function(y){return y.classList.add("allow-interactivity-".concat(s))}),function(){document.body.classList.remove("block-interactivity-".concat(s)),v.forEach(function(y){return y.classList.remove("allow-interactivity-".concat(s))})}}},[n.inert,n.lockRef.current,n.shards]);var a=_.useCallback(function(v,y){if("touches"in v&&v.touches.length===2||v.type==="wheel"&&v.ctrlKey)return!i.current.allowPinchZoom;var b=Gx(v),w=t.current,S="deltaX"in v?v.deltaX:w[0]-b[0],k="deltaY"in v?v.deltaY:w[1]-b[1],N,I=v.target,T=Math.abs(S)>Math.abs(k)?"h":"v";if("touches"in v&&T==="h"&&I.type==="range")return!1;var F=_I(T,I);if(!F)return!0;if(F?N=T:(N=T==="v"?"h":"v",F=_I(T,I)),!F)return!1;if(!r.current&&"changedTouches"in v&&(S||k)&&(r.current=N),!N)return!0;var R=r.current||N;return xY(R,y,v,R==="h"?S:k)},[]),l=_.useCallback(function(v){var y=v;if(!(!$h.length||$h[$h.length-1]!==o)){var b="deltaY"in y?RI(y):Gx(y),w=e.current.filter(function(N){return N.name===y.type&&(N.target===y.target||y.target===N.shadowParent)&&vY(N.delta,b)})[0];if(w&&w.should){y.cancelable&&y.preventDefault();return}if(!w){var S=(i.current.shards||[]).map(DI).filter(Boolean).filter(function(N){return N.contains(y.target)}),k=S.length>0?a(y,S[0]):!i.current.noIsolation;k&&y.cancelable&&y.preventDefault()}}},[]),c=_.useCallback(function(v,y,b,w){var S={name:v,delta:y,target:b,should:w,shadowParent:CY(b)};e.current.push(S),setTimeout(function(){e.current=e.current.filter(function(k){return k!==S})},1)},[]),u=_.useCallback(function(v){t.current=Gx(v),r.current=void 0},[]),d=_.useCallback(function(v){c(v.type,RI(v),v.target,a(v,n.lockRef.current))},[]),f=_.useCallback(function(v){c(v.type,Gx(v),v.target,a(v,n.lockRef.current))},[]);_.useEffect(function(){return $h.push(o),n.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:f}),document.addEventListener("wheel",l,Ah),document.addEventListener("touchmove",l,Ah),document.addEventListener("touchstart",u,Ah),function(){$h=$h.filter(function(v){return v!==o}),document.removeEventListener("wheel",l,Ah),document.removeEventListener("touchmove",l,Ah),document.removeEventListener("touchstart",u,Ah)}},[]);var p=n.removeScrollBar,x=n.inert;return _.createElement(_.Fragment,null,x?_.createElement(o,{styles:yY(s)}):null,p?_.createElement(uY,{noRelative:n.noRelative,gapMode:n.gapMode}):null)}function CY(n){for(var e=null;n!==null;)n instanceof ShadowRoot&&(e=n.host,n=n.host),n=n.parentNode;return e}const kY=ZX(CA,wY);var IA=_.forwardRef(function(n,e){return _.createElement(Sy,Vl({},n,{ref:e,sideCar:kY}))});IA.classNames=Sy.classNames;var SY=function(n){if(typeof document>"u")return null;var e=Array.isArray(n)?n[0]:n;return e.ownerDocument.body},Fh=new WeakMap,qx=new WeakMap,Kx={},nC=0,TA=function(n){return n&&(n.host||TA(n.parentNode))},NY=function(n,e){return e.map(function(t){if(n.contains(t))return t;var r=TA(t);return r&&n.contains(r)?r:(console.error("aria-hidden",t,"in not contained inside",n,". Doing nothing"),null)}).filter(function(t){return!!t})},EY=function(n,e,t,r){var s=NY(e,Array.isArray(n)?n:[n]);Kx[t]||(Kx[t]=new WeakMap);var o=Kx[t],i=[],a=new Set,l=new Set(s),c=function(d){!d||a.has(d)||(a.add(d),c(d.parentNode))};s.forEach(c);var u=function(d){!d||l.has(d)||Array.prototype.forEach.call(d.children,function(f){if(a.has(f))u(f);else try{var p=f.getAttribute(r),x=p!==null&&p!=="false",v=(Fh.get(f)||0)+1,y=(o.get(f)||0)+1;Fh.set(f,v),o.set(f,y),i.push(f),v===1&&x&&qx.set(f,!0),y===1&&f.setAttribute(t,"true"),x||f.setAttribute(r,"true")}catch(b){console.error("aria-hidden: cannot operate on ",f,b)}})};return u(e),a.clear(),nC++,function(){i.forEach(function(d){var f=Fh.get(d)-1,p=o.get(d)-1;Fh.set(d,f),o.set(d,p),f||(qx.has(d)||d.removeAttribute(r),qx.delete(d)),p||d.removeAttribute(t)}),nC--,nC||(Fh=new WeakMap,Fh=new WeakMap,qx=new WeakMap,Kx={})}},IY=function(n,e,t){t===void 0&&(t="data-aria-hidden");var r=Array.from(Array.isArray(n)?n:[n]),s=SY(n);return s?(r.push.apply(r,Array.from(s.querySelectorAll("[aria-live], script"))),EY(r,s,t,"aria-hidden")):function(){return null}};function TY(n){const e=_Y(n),t=_.forwardRef((r,s)=>{const{children:o,...i}=r,a=_.Children.toArray(o),l=a.find(DY);if(l){const c=l.props.children,u=a.map(d=>d===l?_.Children.count(c)>1?_.Children.only(null):_.isValidElement(c)?c.props.children:null:d);return m.jsx(e,{...i,ref:s,children:_.isValidElement(c)?_.cloneElement(c,void 0,u):null})}return m.jsx(e,{...i,ref:s,children:o})});return t.displayName=`${n}.Slot`,t}function _Y(n){const e=_.forwardRef((t,r)=>{const{children:s,...o}=t;if(_.isValidElement(s)){const i=$Y(s),a=AY(o,s.props);return s.type!==_.Fragment&&(a.ref=r?qg(r,i):i),_.cloneElement(s,a)}return _.Children.count(s)>1?_.Children.only(null):null});return e.displayName=`${n}.SlotClone`,e}var RY=Symbol("radix.slottable");function DY(n){return _.isValidElement(n)&&typeof n.type=="function"&&"__radixId"in n.type&&n.type.__radixId===RY}function AY(n,e){const t={...e};for(const r in e){const s=n[r],o=e[r];/^on[A-Z]/.test(r)?s&&o?t[r]=(...a)=>{const l=o(...a);return s(...a),l}:s&&(t[r]=s):r==="style"?t[r]={...s,...o}:r==="className"&&(t[r]=[s,o].filter(Boolean).join(" "))}return{...n,...t}}function $Y(n){let e=Object.getOwnPropertyDescriptor(n.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=Object.getOwnPropertyDescriptor(n,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}var Ny="Dialog",[_A]=Kg(Ny),[FY,pl]=_A(Ny),RA=n=>{const{__scopeDialog:e,children:t,open:r,defaultOpen:s,onOpenChange:o,modal:i=!0}=n,a=_.useRef(null),l=_.useRef(null),[c,u]=zR({prop:r,defaultProp:s??!1,onChange:o,caller:Ny});return m.jsx(FY,{scope:e,triggerRef:a,contentRef:l,contentId:G3(),titleId:G3(),descriptionId:G3(),open:c,onOpenChange:u,onOpenToggle:_.useCallback(()=>u(d=>!d),[u]),modal:i,children:t})};RA.displayName=Ny;var DA="DialogTrigger",AA=_.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,s=pl(DA,t),o=ti(e,s.triggerRef);return m.jsx(Is.button,{type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":Dk(s.open),...r,ref:o,onClick:zr(n.onClick,s.onOpenToggle)})});AA.displayName=DA;var _k="DialogPortal",[PY,$A]=_A(_k,{forceMount:void 0}),FA=n=>{const{__scopeDialog:e,forceMount:t,children:r,container:s}=n,o=pl(_k,e);return m.jsx(PY,{scope:e,forceMount:t,children:_.Children.map(r,i=>m.jsx(Bp,{present:t||o.open,children:m.jsx(hk,{asChild:!0,container:s,children:i})}))})};FA.displayName=_k;var Qv="DialogOverlay",PA=_.forwardRef((n,e)=>{const t=$A(Qv,n.__scopeDialog),{forceMount:r=t.forceMount,...s}=n,o=pl(Qv,n.__scopeDialog);return o.modal?m.jsx(Bp,{present:r||o.open,children:m.jsx(MY,{...s,ref:e})}):null});PA.displayName=Qv;var OY=TY("DialogOverlay.RemoveScroll"),MY=_.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,s=pl(Qv,t);return m.jsx(IA,{as:OY,allowPinchZoom:!0,shards:[s.contentRef],children:m.jsx(Is.div,{"data-state":Dk(s.open),...r,ref:e,style:{pointerEvents:"auto",...r.style}})})}),bf="DialogContent",OA=_.forwardRef((n,e)=>{const t=$A(bf,n.__scopeDialog),{forceMount:r=t.forceMount,...s}=n,o=pl(bf,n.__scopeDialog);return m.jsx(Bp,{present:r||o.open,children:o.modal?m.jsx(LY,{...s,ref:e}):m.jsx(jY,{...s,ref:e})})});OA.displayName=bf;var LY=_.forwardRef((n,e)=>{const t=pl(bf,n.__scopeDialog),r=_.useRef(null),s=ti(e,t.contentRef,r);return _.useEffect(()=>{const o=r.current;if(o)return IY(o)},[]),m.jsx(MA,{...n,ref:s,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:zr(n.onCloseAutoFocus,o=>{o.preventDefault(),t.triggerRef.current?.focus()}),onPointerDownOutside:zr(n.onPointerDownOutside,o=>{const i=o.detail.originalEvent,a=i.button===0&&i.ctrlKey===!0;(i.button===2||a)&&o.preventDefault()}),onFocusOutside:zr(n.onFocusOutside,o=>o.preventDefault())})}),jY=_.forwardRef((n,e)=>{const t=pl(bf,n.__scopeDialog),r=_.useRef(!1),s=_.useRef(!1);return m.jsx(MA,{...n,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{n.onCloseAutoFocus?.(o),o.defaultPrevented||(r.current||t.triggerRef.current?.focus(),o.preventDefault()),r.current=!1,s.current=!1},onInteractOutside:o=>{n.onInteractOutside?.(o),o.defaultPrevented||(r.current=!0,o.detail.originalEvent.type==="pointerdown"&&(s.current=!0));const i=o.target;t.triggerRef.current?.contains(i)&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&s.current&&o.preventDefault()}})}),MA=_.forwardRef((n,e)=>{const{__scopeDialog:t,trapFocus:r,onOpenAutoFocus:s,onCloseAutoFocus:o,...i}=n,a=pl(bf,t),l=_.useRef(null),c=ti(e,l);return VX(),m.jsxs(m.Fragment,{children:[m.jsx(vA,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:s,onUnmountAutoFocus:o,children:m.jsx(uy,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":Dk(a.open),...i,ref:c,onDismiss:()=>a.onOpenChange(!1)})}),m.jsxs(m.Fragment,{children:[m.jsx(BY,{titleId:a.titleId}),m.jsx(zY,{contentRef:l,descriptionId:a.descriptionId})]})]})}),Rk="DialogTitle",LA=_.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,s=pl(Rk,t);return m.jsx(Is.h2,{id:s.titleId,...r,ref:e})});LA.displayName=Rk;var jA="DialogDescription",BA=_.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,s=pl(jA,t);return m.jsx(Is.p,{id:s.descriptionId,...r,ref:e})});BA.displayName=jA;var VA="DialogClose",zA=_.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,s=pl(VA,t);return m.jsx(Is.button,{type:"button",...r,ref:e,onClick:zr(n.onClick,()=>s.onOpenChange(!1))})});zA.displayName=VA;function Dk(n){return n?"open":"closed"}var WA="DialogTitleWarning",[nTe,UA]=ZW(WA,{contentName:bf,titleName:Rk,docsSlug:"dialog"}),BY=({titleId:n})=>{const e=UA(WA),t=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return _.useEffect(()=>{n&&(document.getElementById(n)||console.error(t))},[t,n]),null},VY="DialogDescriptionWarning",zY=({contentRef:n,descriptionId:e})=>{const r=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${UA(VY).contentName}}.`;return _.useEffect(()=>{const s=n.current?.getAttribute("aria-describedby");e&&s&&(document.getElementById(e)||console.warn(r))},[r,n,e]),null},WY=RA,UY=AA,HY=FA,HA=PA,GA=OA,qA=LA,KA=BA,XA=zA;const Zg=WY,YA=UY,GY=HY,ZA=XA,JA=_.forwardRef(({className:n,...e},t)=>m.jsx(HA,{ref:t,className:ra("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",n),...e}));JA.displayName=HA.displayName;const Hp=_.forwardRef(({className:n,children:e,...t},r)=>m.jsxs(GY,{children:[m.jsx(JA,{}),m.jsxs(GA,{ref:r,className:ra("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",n),...t,children:[e,m.jsxs(XA,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[m.jsx(fD,{className:"h-4 w-4"}),m.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Hp.displayName=GA.displayName;const QA=({className:n,...e})=>m.jsx("div",{className:ra("flex flex-col space-y-1.5 text-center sm:text-left",n),...e});QA.displayName="DialogHeader";const Gp=_.forwardRef(({className:n,...e},t)=>m.jsx(qA,{ref:t,className:ra("text-lg font-semibold leading-none tracking-tight",n),...e}));Gp.displayName=qA.displayName;const qY=_.forwardRef(({className:n,...e},t)=>m.jsx(KA,{ref:t,className:ra("text-sm text-muted-foreground",n),...e}));qY.displayName=KA.displayName;var KY=Symbol.for("react.lazy"),e2=ly[" use ".trim().toString()];function XY(n){return typeof n=="object"&&n!==null&&"then"in n}function e$(n){return n!=null&&typeof n=="object"&&"$$typeof"in n&&n.$$typeof===KY&&"_payload"in n&&XY(n._payload)}function YY(n){const e=JY(n),t=_.forwardRef((r,s)=>{let{children:o,...i}=r;e$(o)&&typeof e2=="function"&&(o=e2(o._payload));const a=_.Children.toArray(o),l=a.find(eZ);if(l){const c=l.props.children,u=a.map(d=>d===l?_.Children.count(c)>1?_.Children.only(null):_.isValidElement(c)?c.props.children:null:d);return m.jsx(e,{...i,ref:s,children:_.isValidElement(c)?_.cloneElement(c,void 0,u):null})}return m.jsx(e,{...i,ref:s,children:o})});return t.displayName=`${n}.Slot`,t}var ZY=YY("Slot");function JY(n){const e=_.forwardRef((t,r)=>{let{children:s,...o}=t;if(e$(s)&&typeof e2=="function"&&(s=e2(s._payload)),_.isValidElement(s)){const i=nZ(s),a=tZ(o,s.props);return s.type!==_.Fragment&&(a.ref=r?qg(r,i):i),_.cloneElement(s,a)}return _.Children.count(s)>1?_.Children.only(null):null});return e.displayName=`${n}.SlotClone`,e}var QY=Symbol("radix.slottable");function eZ(n){return _.isValidElement(n)&&typeof n.type=="function"&&"__radixId"in n.type&&n.type.__radixId===QY}function tZ(n,e){const t={...e};for(const r in e){const s=n[r],o=e[r];/^on[A-Z]/.test(r)?s&&o?t[r]=(...a)=>{const l=o(...a);return s(...a),l}:s&&(t[r]=s):r==="style"?t[r]={...s,...o}:r==="className"&&(t[r]=[s,o].filter(Boolean).join(" "))}return{...n,...t}}function nZ(n){let e=Object.getOwnPropertyDescriptor(n.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=Object.getOwnPropertyDescriptor(n,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}const rZ=uD("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),t$=_.forwardRef(({className:n,variant:e,size:t,asChild:r=!1,...s},o)=>{const i=r?ZY:"button";return m.jsx(i,{className:ra(rZ({variant:e,size:t,className:n})),ref:o,...s})});t$.displayName="Button";function n$({isOpen:n,onClose:e}){return m.jsx(Zg,{open:n,onOpenChange:t=>{t||e()},children:m.jsxs(Hp,{className:"max-w-[320px] sm:max-w-[400px] lg:max-w-[800px] p-0 gap-0 bg-white border border-border rounded-lg",children:[m.jsxs(QA,{className:"flex flex-row justify-between items-center p-4 sm:p-6 border-b border-border",children:[m.jsx(Gp,{className:"text-[#172B4D] font-figtree text-lg sm:text-xl font-bold leading-[30px]",children:"How does this work?"}),m.jsx("button",{onClick:e,className:"flex items-center justify-center w-6 h-6",children:m.jsx("svg",{className:"w-6 h-6",viewBox:"0 0 24 25",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M18 6.33203L6 18.332M6 6.33203L18 18.332",stroke:"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),m.jsxs("div",{className:"lg:hidden flex flex-col p-4 gap-4 bg-white",children:[m.jsx("div",{className:"text-[#172B4D] text-center font-roboto text-lg font-medium",children:"Continue Securely On Another Device"}),m.jsxs("div",{className:"flex flex-col items-start gap-4 p-4 bg-[#E6F1FD] rounded",children:[m.jsxs("div",{className:"flex items-center gap-3 self-stretch",children:[m.jsx("div",{className:"flex w-6 h-6 justify-center items-center rounded-full bg-[#0073EA]",children:m.jsx("span",{className:"text-white font-roboto text-[13px] font-medium",children:"1"})}),m.jsxs("div",{className:"flex flex-col flex-1",children:[m.jsx("div",{className:"text-[#323238] font-roboto text-[15px] font-bold",children:"Personal Information"}),m.jsx("div",{className:"text-[#323238] font-roboto text-[13px] font-normal",children:"Step 1"})]})]}),m.jsx("div",{className:"text-[#172B4D] font-figtree text-[13px] font-normal leading-5",children:"Please provide your basic personal information to begin the identity verification process."})]}),m.jsxs("div",{className:"flex flex-col items-start gap-4 p-4 bg-white rounded border border-border",children:[m.jsxs("div",{className:"flex items-center gap-3 self-stretch",children:[m.jsx("div",{className:"flex w-6 h-6 justify-center items-center rounded-full border border-border bg-white",children:m.jsx("span",{className:"text-[#42526E] font-roboto text-[13px] font-medium",children:"2"})}),m.jsxs("div",{className:"flex flex-col flex-1",children:[m.jsx("div",{className:"text-[#323238] font-roboto text-[15px] font-bold",children:"Identity Document"}),m.jsx("div",{className:"text-[#323238] font-roboto text-[13px] font-normal",children:"Step 2"})]})]}),m.jsx("div",{className:"text-[#42526E] font-figtree text-[13px] font-normal leading-5",children:"Choose a valid government-issued ID (like a passport, driver's license, or national ID) and upload a clear photo of it."})]}),m.jsxs("div",{className:"flex flex-col items-start gap-4 p-4 bg-white rounded border border-border",children:[m.jsxs("div",{className:"flex items-center gap-3 self-stretch",children:[m.jsx("div",{className:"flex w-6 h-6 justify-center items-center rounded-full border border-border bg-white",children:m.jsx("span",{className:"text-[#42526E] font-roboto text-[13px] font-medium",children:"3"})}),m.jsxs("div",{className:"flex flex-col flex-1",children:[m.jsx("div",{className:"text-[#323238] font-roboto text-[15px] font-bold",children:"Capture Selfie"}),m.jsx("div",{className:"text-[#323238] font-roboto text-[13px] font-normal",children:"Step 3"})]})]}),m.jsx("div",{className:"text-[#42526E] font-figtree text-[13px] font-normal leading-5",children:"Take a live selfie to confirm you are the person in the ID document. Make sure you're in a well-lit area and your face is clearly visible."})]}),m.jsxs("div",{className:"flex items-center justify-center p-4 bg-[#BBDBC9] rounded gap-2",children:[m.jsx("svg",{className:"w-[18px] h-[18px]",viewBox:"0 0 18 19",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M1.52363 9.33203C1.5234 9.23168 1.50369 9.13141 1.46449 9.03691L0.923408 7.72684C0.809093 7.45094 0.750045 7.15477 0.75 6.85612C0.749952 6.55732 0.808785 6.26142 0.92313 5.98535C1.03747 5.70928 1.2051 5.45845 1.41642 5.24719C1.62769 5.03599 1.87849 4.86847 2.1545 4.7542L3.46245 4.21241C3.65187 4.13409 3.80295 3.98368 3.88181 3.79447L4.42373 2.48614C4.65456 1.92882 5.09734 1.48603 5.65465 1.25517C6.21196 1.02432 6.83815 1.02432 7.39546 1.25517L8.70278 1.79671C8.89252 1.87503 9.10575 1.87493 9.29535 1.79626L9.29685 1.79565L10.6053 1.25597C11.1624 1.02543 11.7887 1.02535 12.3458 1.2561C12.903 1.48691 13.3457 1.92958 13.5766 2.48674L14.1055 3.76367C14.1102 3.77375 14.1147 3.78397 14.119 3.79434C14.1974 3.98396 14.3478 4.13471 14.5372 4.21351L15.8459 4.75561C16.4032 4.98646 16.8461 5.42926 17.0769 5.98657C17.3077 6.54388 17.3077 7.17007 17.0769 7.72739L16.5351 9.03541C16.4957 9.13036 16.4761 9.23161 16.4761 9.33226C16.4761 9.43291 16.4957 9.53371 16.5351 9.62866L17.0769 10.9367C17.3077 11.494 17.3077 12.1202 17.0769 12.6775C16.8461 13.2348 16.4032 13.6776 15.8459 13.9085L14.5372 14.4506C14.3478 14.5294 14.1974 14.6801 14.119 14.8697C14.1147 14.8801 14.1102 14.8903 14.1055 14.9004L13.5766 16.1773C13.3457 16.7345 12.903 17.1772 12.3458 17.408C11.7887 17.6387 11.1624 17.6387 10.6053 17.4081L9.29685 16.8684L9.29535 16.8678C9.10575 16.7891 8.89252 16.7891 8.70278 16.8674L7.39546 17.4089C6.83815 17.6398 6.21196 17.6398 5.65465 17.4089C5.09734 17.178 4.65456 16.7352 4.42373 16.178L3.88181 14.8696C3.80295 14.6804 3.65187 14.53 3.46245 14.4517L2.1545 13.9099C1.87849 13.7956 1.62769 13.6281 1.41642 13.4169C1.2051 13.2056 1.03747 12.9548 0.92313 12.6787C0.808785 12.4026 0.749952 12.1067 0.75 11.8079C0.750045 11.5093 0.809093 11.2131 0.923408 10.9372L1.46449 9.62716C1.50369 9.53266 1.5234 9.43238 1.52363 9.33203ZM12.1553 7.98736C12.4482 7.69447 12.4482 7.2196 12.1553 6.9267C11.8624 6.63381 11.3876 6.63381 11.0947 6.9267L8.25 9.77138L7.28033 8.80171C6.98744 8.50883 6.51256 8.50883 6.21967 8.80171C5.92678 9.09458 5.92678 9.56948 6.21967 9.86236L7.71968 11.3624C8.01255 11.6552 8.48745 11.6552 8.78032 11.3624L12.1553 7.98736Z",fill:"#258750"})}),m.jsx("div",{className:"text-[#172B4D] font-roboto text-[12px] font-normal leading-[22px]",children:"Complete the previous steps to enable selfie capture."})]})]}),m.jsxs("div",{className:"hidden lg:flex flex-col items-center gap-6 p-6 bg-white",children:[m.jsx("div",{className:"text-[#172B4D] text-center font-roboto text-lg font-medium",children:"Continue Securely On Another Device"}),m.jsxs("div",{className:"flex flex-col lg:flex-row items-center gap-8 w-full max-w-[705px]",children:[m.jsxs("div",{className:"flex flex-col items-center gap-4 min-w-[194px]",children:[m.jsxs("div",{className:"relative w-[183px] h-[183px]",children:[m.jsx("div",{className:"absolute inset-0 rounded-full border border-dashed border-[#C3C6D4] bg-white"}),m.jsx("div",{className:"absolute inset-[7px] rounded-full bg-gradient-to-br from-[rgba(0,115,234,0.1)] to-[rgba(255,255,255,0.1)]"}),m.jsxs("svg",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[85px] h-[124px]",viewBox:"0 0 85 125",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("path",{d:"M34.5 11H23.5V23",stroke:"#323238",strokeWidth:"2",strokeLinecap:"round"}),m.jsx("path",{d:"M46.5 69L57.5 69L57.5 58",stroke:"#323238",strokeWidth:"2",strokeLinecap:"round"}),m.jsx("path",{d:"M46.5 11H57.5V23",stroke:"#323238",strokeWidth:"2",strokeLinecap:"round"}),m.jsx("path",{d:"M34.5 69L23.5 69L23.5 58",stroke:"#323238",strokeWidth:"2",strokeLinecap:"round"}),m.jsx("rect",{x:"16.5",y:"1.5",width:"46",height:"68",stroke:"#0073EA",strokeWidth:"2",rx:"2",fill:"none"})]})]}),m.jsxs("div",{className:"flex flex-col items-center gap-1",children:[m.jsx("div",{className:"text-[#0073EA] font-roboto text-[15px] font-bold",children:"Step 1"}),m.jsx("div",{className:"w-[194px] text-[#676879] text-center font-roboto text-[13px] font-normal leading-5",children:"Scan this QR code with your device's camera. (mobile or tablet for example)"})]})]}),m.jsx("div",{className:"hidden lg:block",children:m.jsxs("svg",{className:"w-9 h-9 text-[#323238]",viewBox:"0 0 37 36",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("path",{d:"M20 26.25L27.5 18.75L20 11.25M9.5 26.25L17 18.75L9.5 11.25",stroke:"url(#paint0_linear_arrow1)",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),m.jsx("defs",{children:m.jsxs("linearGradient",{id:"paint0_linear_arrow1",x1:"26",y1:"10.5",x2:"5",y2:"11",gradientUnits:"userSpaceOnUse",children:[m.jsx("stop",{offset:"0.246914",stopColor:"#323238"}),m.jsx("stop",{offset:"1",stopColor:"white",stopOpacity:"0"})]})})]})}),m.jsxs("div",{className:"flex flex-col items-center gap-4 min-w-[187px]",children:[m.jsxs("div",{className:"relative w-[183px] h-[183px]",children:[m.jsx("div",{className:"absolute inset-0 rounded-full border border-dashed border-[#C3C6D4] bg-white"}),m.jsx("div",{className:"absolute inset-[7px] rounded-full bg-gradient-to-br from-[rgba(0,115,234,0.1)] to-[rgba(255,255,255,0.1)]"}),m.jsxs("svg",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[100px] h-[122px]",viewBox:"0 0 101 122",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("path",{d:"M42.5 68.4115V5.83815C42.5 3.19916 44.8845 1 47.865 1H90.135C93.0614 1 95.5 3.15029 95.5 5.83815V89.1618C95.5 91.8008 93.1155 94 90.135 94H68",stroke:"#0073EA",strokeWidth:"1.95513",strokeLinecap:"round"}),m.jsx("rect",{x:"54.5",y:"26.5",width:"29",height:"15",stroke:"#323238",strokeWidth:"2",rx:"1",fill:"none"}),m.jsx("rect",{x:"54.5",y:"11.5",width:"29",height:"8",stroke:"#323238",strokeWidth:"2",rx:"1",fill:"none"}),m.jsx("g",{filter:"url(#filter0_d_phone)",children:m.jsx("rect",{x:"54.5",y:"49",width:"31",height:"10",stroke:"#0073EA",strokeWidth:"2",rx:"1",fill:"none"})}),m.jsx("defs",{children:m.jsxs("filter",{id:"filter0_d_phone",x:"50.1927",y:"48",width:"39.6146",height:"18.6146",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[m.jsx("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),m.jsx("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),m.jsx("feOffset",{dy:"3.30729"}),m.jsx("feGaussianBlur",{stdDeviation:"1.65365"}),m.jsx("feComposite",{in2:"hardAlpha",operator:"out"}),m.jsx("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"}),m.jsx("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_phone"}),m.jsx("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_phone",result:"shape"})]})})]})]}),m.jsxs("div",{className:"flex flex-col items-center gap-1",children:[m.jsx("div",{className:"text-[#0073EA] font-roboto text-[15px] font-bold",children:"Step 2"}),m.jsx("div",{className:"text-[#676879] text-center font-roboto text-[13px] font-normal leading-5",children:"Tap the link that appears to open your verification session."})]})]}),m.jsx("div",{className:"hidden lg:block",children:m.jsxs("svg",{className:"w-5 h-[18px] text-[#323238]",viewBox:"0 0 21 17",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("path",{d:"M12 16.25L19.5 8.75L12 1.25M1.5 16.25L9 8.75L1.5 1.25",stroke:"url(#paint0_linear_arrow2)",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),m.jsx("defs",{children:m.jsxs("linearGradient",{id:"paint0_linear_arrow2",x1:"18",y1:"0.500001",x2:"-3",y2:"1",gradientUnits:"userSpaceOnUse",children:[m.jsx("stop",{offset:"0.246914",stopColor:"#323238"}),m.jsx("stop",{offset:"1",stopColor:"white",stopOpacity:"0"})]})})]})}),m.jsxs("div",{className:"flex flex-col items-center gap-4 min-w-[183px]",children:[m.jsxs("div",{className:"relative w-[183px] h-[183px]",children:[m.jsx("div",{className:"absolute inset-0 rounded-full border border-dashed border-[#C3C6D4] bg-white"}),m.jsx("div",{className:"absolute inset-[7px] rounded-full bg-gradient-to-br from-[rgba(0,115,234,0.1)] to-[rgba(255,255,255,0.1)]"}),m.jsxs("svg",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[85px] h-[124px]",viewBox:"0 0 85 125",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("path",{d:"M16.7891 61.7373V4.62095C16.7891 3.02189 18.0883 1.72266 19.6874 1.72266H62.9119C64.511 1.72266 65.8102 3.02189 65.8102 4.62095V40.0501",stroke:"#0073EA",strokeWidth:"1.99882",strokeLinecap:"round"}),m.jsx("path",{d:"M26.575 22.5L28.525 24.45L32.425 20.55M36 22.5C36 26.0898 33.0898 29 29.5 29C25.9101 29 23 26.0898 23 22.5C23 18.9101 25.9101 16 29.5 16C33.0898 16 36 18.9101 36 22.5Z",stroke:"#323238",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),m.jsx("g",{filter:"url(#filter0_d_check)",children:m.jsx("rect",{x:"26.5",y:"67",width:"28",height:"8",stroke:"#0073EA",strokeWidth:"2",rx:"1",fill:"none"})}),m.jsx("defs",{children:m.jsxs("filter",{id:"filter0_d_check",x:"22.1927",y:"66",width:"37.6146",height:"16.6146",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[m.jsx("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),m.jsx("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),m.jsx("feOffset",{dy:"3.30729"}),m.jsx("feGaussianBlur",{stdDeviation:"1.65365"}),m.jsx("feComposite",{in2:"hardAlpha",operator:"out"}),m.jsx("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"}),m.jsx("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_check"}),m.jsx("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_check",result:"shape"})]})})]})]}),m.jsxs("div",{className:"flex flex-col items-center gap-1",children:[m.jsx("div",{className:"text-[#0073EA] font-roboto text-[15px] font-bold",children:"Step 3"}),m.jsx("div",{className:"w-[180px] text-[#676879] text-center font-roboto text-[13px] font-normal leading-5",children:"Pick up where you left off - your progress is saved!"})]})]})]}),m.jsxs("div",{className:"text-[#172B4D] text-center font-roboto text-sm",children:["The link expires in ",m.jsx("span",{className:"font-bold",children:"10 minutes"})," ","for security."]})]}),m.jsx("div",{className:"flex justify-end items-center p-4 sm:p-6 border-t border-border bg-white",children:m.jsx(t$,{onClick:e,className:"h-[38px] px-4 bg-[#0073EA] text-white font-roboto text-[13px] font-medium rounded hover:bg-[#0073EA]/90 transition-colors",children:"Got it"})})]})})}var Jg=n=>n.type==="checkbox",af=n=>n instanceof Date,vi=n=>n==null;const r$=n=>typeof n=="object";var ks=n=>!vi(n)&&!Array.isArray(n)&&r$(n)&&!af(n),s$=n=>ks(n)&&n.target?Jg(n.target)?n.target.checked:n.target.value:n,sZ=n=>n.substring(0,n.search(/\.\d+(\.|$)/))||n,o$=(n,e)=>n.has(sZ(e)),oZ=n=>{const e=n.constructor&&n.constructor.prototype;return ks(e)&&e.hasOwnProperty("isPrototypeOf")},Ak=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function As(n){let e;const t=Array.isArray(n),r=typeof FileList<"u"?n instanceof FileList:!1;if(n instanceof Date)e=new Date(n);else if(!(Ak&&(n instanceof Blob||r))&&(t||ks(n)))if(e=t?[]:Object.create(Object.getPrototypeOf(n)),!t&&!oZ(n))e=n;else for(const s in n)n.hasOwnProperty(s)&&(e[s]=As(n[s]));else return n;return e}var Ey=n=>/^\w*$/.test(n),ts=n=>n===void 0,$k=n=>Array.isArray(n)?n.filter(Boolean):[],Fk=n=>$k(n.replace(/["|']|\]/g,"").split(/\.|\[/)),kt=(n,e,t)=>{if(!e||!ks(n))return t;const r=(Ey(e)?[e]:Fk(e)).reduce((s,o)=>vi(s)?s:s[o],n);return ts(r)||r===n?ts(n[e])?t:n[e]:r},Vi=n=>typeof n=="boolean",yr=(n,e,t)=>{let r=-1;const s=Ey(e)?[e]:Fk(e),o=s.length,i=o-1;for(;++r<o;){const a=s[r];let l=t;if(r!==i){const c=n[a];l=ks(c)||Array.isArray(c)?c:isNaN(+s[r+1])?{}:[]}if(a==="__proto__"||a==="constructor"||a==="prototype")return;n[a]=l,n=n[a]}};const t2={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},Qa={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},Dc={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},i$=Ve.createContext(null);i$.displayName="HookFormContext";const Pk=()=>Ve.useContext(i$);var a$=(n,e,t,r=!0)=>{const s={defaultValues:e._defaultValues};for(const o in n)Object.defineProperty(s,o,{get:()=>{const i=o;return e._proxyFormState[i]!==Qa.all&&(e._proxyFormState[i]=!r||Qa.all),t&&(t[i]=!0),n[i]}});return s};const Ok=typeof window<"u"?Ve.useLayoutEffect:Ve.useEffect;function iZ(n){const e=Pk(),{control:t=e.control,disabled:r,name:s,exact:o}=n||{},[i,a]=Ve.useState(t._formState),l=Ve.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1});return Ok(()=>t._subscribe({name:s,formState:l.current,exact:o,callback:c=>{!r&&a({...t._formState,...c})}}),[s,r,o]),Ve.useEffect(()=>{l.current.isValid&&t._setValid(!0)},[t]),Ve.useMemo(()=>a$(i,t,l.current,!1),[i,t])}var Hi=n=>typeof n=="string",q4=(n,e,t,r,s)=>Hi(n)?(r&&e.watch.add(n),kt(t,n,s)):Array.isArray(n)?n.map(o=>(r&&e.watch.add(o),kt(t,o))):(r&&(e.watchAll=!0),t),K4=n=>vi(n)||!r$(n);function el(n,e,t=new WeakSet){if(K4(n)||K4(e))return n===e;if(af(n)&&af(e))return n.getTime()===e.getTime();const r=Object.keys(n),s=Object.keys(e);if(r.length!==s.length)return!1;if(t.has(n)||t.has(e))return!0;t.add(n),t.add(e);for(const o of r){const i=n[o];if(!s.includes(o))return!1;if(o!=="ref"){const a=e[o];if(af(i)&&af(a)||ks(i)&&ks(a)||Array.isArray(i)&&Array.isArray(a)?!el(i,a,t):i!==a)return!1}}return!0}function aZ(n){const e=Pk(),{control:t=e.control,name:r,defaultValue:s,disabled:o,exact:i,compute:a}=n||{},l=Ve.useRef(s),c=Ve.useRef(a),u=Ve.useRef(void 0),d=Ve.useRef(t),f=Ve.useRef(r);c.current=a;const[p,x]=Ve.useState(()=>{const k=t._getWatch(r,l.current);return c.current?c.current(k):k}),v=Ve.useCallback(k=>{const N=q4(r,t._names,k||t._formValues,!1,l.current);return c.current?c.current(N):N},[t._formValues,t._names,r]),y=Ve.useCallback(k=>{if(!o){const N=q4(r,t._names,k||t._formValues,!1,l.current);if(c.current){const I=c.current(N);el(I,u.current)||(x(I),u.current=I)}else x(N)}},[t._formValues,t._names,o,r]);Ok(()=>((d.current!==t||!el(f.current,r))&&(d.current=t,f.current=r,y()),t._subscribe({name:r,formState:{values:!0},exact:i,callback:k=>{y(k.values)}})),[t,i,r,y]),Ve.useEffect(()=>t._removeUnmounted());const b=d.current!==t,w=f.current,S=Ve.useMemo(()=>{if(o)return null;const k=!b&&!el(w,r);return b||k?v():null},[o,b,r,w,v]);return S!==null?S:p}function lZ(n){const e=Pk(),{name:t,disabled:r,control:s=e.control,shouldUnregister:o,defaultValue:i}=n,a=o$(s._names.array,t),l=Ve.useMemo(()=>kt(s._formValues,t,kt(s._defaultValues,t,i)),[s,t,i]),c=aZ({control:s,name:t,defaultValue:l,exact:!0}),u=iZ({control:s,name:t,exact:!0}),d=Ve.useRef(n),f=Ve.useRef(void 0),p=Ve.useRef(s.register(t,{...n.rules,value:c,...Vi(n.disabled)?{disabled:n.disabled}:{}}));d.current=n;const x=Ve.useMemo(()=>Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!kt(u.errors,t)},isDirty:{enumerable:!0,get:()=>!!kt(u.dirtyFields,t)},isTouched:{enumerable:!0,get:()=>!!kt(u.touchedFields,t)},isValidating:{enumerable:!0,get:()=>!!kt(u.validatingFields,t)},error:{enumerable:!0,get:()=>kt(u.errors,t)}}),[u,t]),v=Ve.useCallback(S=>p.current.onChange({target:{value:s$(S),name:t},type:t2.CHANGE}),[t]),y=Ve.useCallback(()=>p.current.onBlur({target:{value:kt(s._formValues,t),name:t},type:t2.BLUR}),[t,s._formValues]),b=Ve.useCallback(S=>{const k=kt(s._fields,t);k&&S&&(k._f.ref={focus:()=>S.focus&&S.focus(),select:()=>S.select&&S.select(),setCustomValidity:N=>S.setCustomValidity(N),reportValidity:()=>S.reportValidity()})},[s._fields,t]),w=Ve.useMemo(()=>({name:t,value:c,...Vi(r)||u.disabled?{disabled:u.disabled||r}:{},onChange:v,onBlur:y,ref:b}),[t,r,u.disabled,v,y,b,c]);return Ve.useEffect(()=>{const S=s._options.shouldUnregister||o,k=f.current;k&&k!==t&&!a&&s.unregister(k),s.register(t,{...d.current.rules,...Vi(d.current.disabled)?{disabled:d.current.disabled}:{}});const N=(I,T)=>{const F=kt(s._fields,I);F&&F._f&&(F._f.mount=T)};if(N(t,!0),S){const I=As(kt(s._options.defaultValues,t,d.current.defaultValue));yr(s._defaultValues,t,I),ts(kt(s._formValues,t))&&yr(s._formValues,t,I)}return!a&&s.register(t),f.current=t,()=>{(a?S&&!s._state.action:S)?s.unregister(t):N(t,!1)}},[t,s,a,o]),Ve.useEffect(()=>{s._setDisabledField({disabled:r,name:t})},[r,t,s]),Ve.useMemo(()=>({field:w,formState:u,fieldState:x}),[w,u,x])}var Mk=(n,e,t,r,s)=>e?{...t[n],types:{...t[n]&&t[n].types?t[n].types:{},[r]:s||!0}}:{},cg=n=>Array.isArray(n)?n:[n],AI=()=>{let n=[];return{get observers(){return n},next:s=>{for(const o of n)o.next&&o.next(s)},subscribe:s=>(n.push(s),{unsubscribe:()=>{n=n.filter(o=>o!==s)}}),unsubscribe:()=>{n=[]}}};function l$(n,e){const t={};for(const r in n)if(n.hasOwnProperty(r)){const s=n[r],o=e[r];if(s&&ks(s)&&o){const i=l$(s,o);ks(i)&&(t[r]=i)}else n[r]&&(t[r]=o)}return t}var Xo=n=>ks(n)&&!Object.keys(n).length,Lk=n=>n.type==="file",tl=n=>typeof n=="function",n2=n=>{if(!Ak)return!1;const e=n?n.ownerDocument:0;return n instanceof(e&&e.defaultView?e.defaultView.HTMLElement:HTMLElement)},c$=n=>n.type==="select-multiple",jk=n=>n.type==="radio",cZ=n=>jk(n)||Jg(n),rC=n=>n2(n)&&n.isConnected;function uZ(n,e){const t=e.slice(0,-1).length;let r=0;for(;r<t;)n=ts(n)?r++:n[e[r++]];return n}function dZ(n){for(const e in n)if(n.hasOwnProperty(e)&&!ts(n[e]))return!1;return!0}function gs(n,e){const t=Array.isArray(e)?e:Ey(e)?[e]:Fk(e),r=t.length===1?n:uZ(n,t),s=t.length-1,o=t[s];return r&&delete r[o],s!==0&&(ks(r)&&Xo(r)||Array.isArray(r)&&dZ(r))&&gs(n,t.slice(0,-1)),n}var fZ=n=>{for(const e in n)if(tl(n[e]))return!0;return!1};function u$(n){return Array.isArray(n)||ks(n)&&!fZ(n)}function X4(n,e={}){for(const t in n)u$(n[t])?(e[t]=Array.isArray(n[t])?[]:{},X4(n[t],e[t])):ts(n[t])||(e[t]=!0);return e}function Gh(n,e,t){t||(t=X4(e));for(const r in n)u$(n[r])?ts(e)||K4(t[r])?t[r]=X4(n[r],Array.isArray(n[r])?[]:{}):Gh(n[r],vi(e)?{}:e[r],t[r]):t[r]=!el(n[r],e[r]);return t}const $I={value:!1,isValid:!1},FI={value:!0,isValid:!0};var d$=n=>{if(Array.isArray(n)){if(n.length>1){const e=n.filter(t=>t&&t.checked&&!t.disabled).map(t=>t.value);return{value:e,isValid:!!e.length}}return n[0].checked&&!n[0].disabled?n[0].attributes&&!ts(n[0].attributes.value)?ts(n[0].value)||n[0].value===""?FI:{value:n[0].value,isValid:!0}:FI:$I}return $I},f$=(n,{valueAsNumber:e,valueAsDate:t,setValueAs:r})=>ts(n)?n:e?n===""?NaN:n&&+n:t&&Hi(n)?new Date(n):r?r(n):n;const PI={isValid:!1,value:null};var h$=n=>Array.isArray(n)?n.reduce((e,t)=>t&&t.checked&&!t.disabled?{isValid:!0,value:t.value}:e,PI):PI;function OI(n){const e=n.ref;return Lk(e)?e.files:jk(e)?h$(n.refs).value:c$(e)?[...e.selectedOptions].map(({value:t})=>t):Jg(e)?d$(n.refs).value:f$(ts(e.value)?n.ref.value:e.value,n)}var hZ=(n,e,t,r)=>{const s={};for(const o of n){const i=kt(e,o);i&&yr(s,o,i._f)}return{criteriaMode:t,names:[...n],fields:s,shouldUseNativeValidation:r}},r2=n=>n instanceof RegExp,Wm=n=>ts(n)?n:r2(n)?n.source:ks(n)?r2(n.value)?n.value.source:n.value:n,MI=n=>({isOnSubmit:!n||n===Qa.onSubmit,isOnBlur:n===Qa.onBlur,isOnChange:n===Qa.onChange,isOnAll:n===Qa.all,isOnTouch:n===Qa.onTouched});const LI="AsyncFunction";var pZ=n=>!!n&&!!n.validate&&!!(tl(n.validate)&&n.validate.constructor.name===LI||ks(n.validate)&&Object.values(n.validate).find(e=>e.constructor.name===LI)),mZ=n=>n.mount&&(n.required||n.min||n.max||n.maxLength||n.minLength||n.pattern||n.validate),jI=(n,e,t)=>!t&&(e.watchAll||e.watch.has(n)||[...e.watch].some(r=>n.startsWith(r)&&/^\.\w+/.test(n.slice(r.length))));const ug=(n,e,t,r)=>{for(const s of t||Object.keys(n)){const o=kt(n,s);if(o){const{_f:i,...a}=o;if(i){if(i.refs&&i.refs[0]&&e(i.refs[0],s)&&!r)return!0;if(i.ref&&e(i.ref,i.name)&&!r)return!0;if(ug(a,e))break}else if(ks(a)&&ug(a,e))break}}};function BI(n,e,t){const r=kt(n,t);if(r||Ey(t))return{error:r,name:t};const s=t.split(".");for(;s.length;){const o=s.join("."),i=kt(e,o),a=kt(n,o);if(i&&!Array.isArray(i)&&t!==o)return{name:t};if(a&&a.type)return{name:o,error:a};if(a&&a.root&&a.root.type)return{name:`${o}.root`,error:a.root};s.pop()}return{name:t}}var gZ=(n,e,t,r)=>{t(n);const{name:s,...o}=n;return Xo(o)||Object.keys(o).length>=Object.keys(e).length||Object.keys(o).find(i=>e[i]===(!r||Qa.all))},xZ=(n,e,t)=>!n||!e||n===e||cg(n).some(r=>r&&(t?r===e:r.startsWith(e)||e.startsWith(r))),vZ=(n,e,t,r,s)=>s.isOnAll?!1:!t&&s.isOnTouch?!(e||n):(t?r.isOnBlur:s.isOnBlur)?!n:(t?r.isOnChange:s.isOnChange)?n:!0,yZ=(n,e)=>!$k(kt(n,e)).length&&gs(n,e),bZ=(n,e,t)=>{const r=cg(kt(n,t));return yr(r,"root",e[t]),yr(n,t,r),n};function VI(n,e,t="validate"){if(Hi(n)||Array.isArray(n)&&n.every(Hi)||Vi(n)&&!n)return{type:t,message:Hi(n)?n:"",ref:e}}var Ph=n=>ks(n)&&!r2(n)?n:{value:n,message:""},zI=async(n,e,t,r,s,o)=>{const{ref:i,refs:a,required:l,maxLength:c,minLength:u,min:d,max:f,pattern:p,validate:x,name:v,valueAsNumber:y,mount:b}=n._f,w=kt(t,v);if(!b||e.has(v))return{};const S=a?a[0]:i,k=P=>{s&&S.reportValidity&&(S.setCustomValidity(Vi(P)?"":P||""),S.reportValidity())},N={},I=jk(i),T=Jg(i),F=I||T,R=(y||Lk(i))&&ts(i.value)&&ts(w)||n2(i)&&i.value===""||w===""||Array.isArray(w)&&!w.length,D=Mk.bind(null,v,r,N),A=(P,B,L,W=Dc.maxLength,H=Dc.minLength)=>{const G=P?B:L;N[v]={type:P?W:H,message:G,ref:i,...D(P?W:H,G)}};if(o?!Array.isArray(w)||!w.length:l&&(!F&&(R||vi(w))||Vi(w)&&!w||T&&!d$(a).isValid||I&&!h$(a).isValid)){const{value:P,message:B}=Hi(l)?{value:!!l,message:l}:Ph(l);if(P&&(N[v]={type:Dc.required,message:B,ref:S,...D(Dc.required,B)},!r))return k(B),N}if(!R&&(!vi(d)||!vi(f))){let P,B;const L=Ph(f),W=Ph(d);if(!vi(w)&&!isNaN(w)){const H=i.valueAsNumber||w&&+w;vi(L.value)||(P=H>L.value),vi(W.value)||(B=H<W.value)}else{const H=i.valueAsDate||new Date(w),G=z=>new Date(new Date().toDateString()+" "+z),M=i.type=="time",j=i.type=="week";Hi(L.value)&&w&&(P=M?G(w)>G(L.value):j?w>L.value:H>new Date(L.value)),Hi(W.value)&&w&&(B=M?G(w)<G(W.value):j?w<W.value:H<new Date(W.value))}if((P||B)&&(A(!!P,L.message,W.message,Dc.max,Dc.min),!r))return k(N[v].message),N}if((c||u)&&!R&&(Hi(w)||o&&Array.isArray(w))){const P=Ph(c),B=Ph(u),L=!vi(P.value)&&w.length>+P.value,W=!vi(B.value)&&w.length<+B.value;if((L||W)&&(A(L,P.message,B.message),!r))return k(N[v].message),N}if(p&&!R&&Hi(w)){const{value:P,message:B}=Ph(p);if(r2(P)&&!w.match(P)&&(N[v]={type:Dc.pattern,message:B,ref:i,...D(Dc.pattern,B)},!r))return k(B),N}if(x){if(tl(x)){const P=await x(w,t),B=VI(P,S);if(B&&(N[v]={...B,...D(Dc.validate,B.message)},!r))return k(B.message),N}else if(ks(x)){let P={};for(const B in x){if(!Xo(P)&&!r)break;const L=VI(await x[B](w,t),S,B);L&&(P={...L,...D(B,L.message)},k(L.message),r&&(N[v]=P))}if(!Xo(P)&&(N[v]={ref:S,...P},!r))return N}}return k(!0),N};const wZ={mode:Qa.onSubmit,reValidateMode:Qa.onChange,shouldFocusError:!0};function CZ(n={}){let e={...wZ,...n},t={submitCount:0,isDirty:!1,isReady:!1,isLoading:tl(e.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1},r={},s=ks(e.defaultValues)||ks(e.values)?As(e.defaultValues||e.values)||{}:{},o=e.shouldUnregister?{}:As(s),i={action:!1,mount:!1,watch:!1},a={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},l,c=0;const u={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let d={...u};const f={array:AI(),state:AI()},p=e.criteriaMode===Qa.all,x=te=>q=>{clearTimeout(c),c=setTimeout(te,q)},v=async te=>{if(!e.disabled&&(u.isValid||d.isValid||te)){const q=e.resolver?Xo((await T()).errors):await R(r,!0);q!==t.isValid&&f.state.next({isValid:q})}},y=(te,q)=>{!e.disabled&&(u.isValidating||u.validatingFields||d.isValidating||d.validatingFields)&&((te||Array.from(a.mount)).forEach(ke=>{ke&&(q?yr(t.validatingFields,ke,q):gs(t.validatingFields,ke))}),f.state.next({validatingFields:t.validatingFields,isValidating:!Xo(t.validatingFields)}))},b=(te,q=[],ke,He,Ke=!0,Be=!0)=>{if(He&&ke&&!e.disabled){if(i.action=!0,Be&&Array.isArray(kt(r,te))){const ct=ke(kt(r,te),He.argA,He.argB);Ke&&yr(r,te,ct)}if(Be&&Array.isArray(kt(t.errors,te))){const ct=ke(kt(t.errors,te),He.argA,He.argB);Ke&&yr(t.errors,te,ct),yZ(t.errors,te)}if((u.touchedFields||d.touchedFields)&&Be&&Array.isArray(kt(t.touchedFields,te))){const ct=ke(kt(t.touchedFields,te),He.argA,He.argB);Ke&&yr(t.touchedFields,te,ct)}(u.dirtyFields||d.dirtyFields)&&(t.dirtyFields=Gh(s,o)),f.state.next({name:te,isDirty:A(te,q),dirtyFields:t.dirtyFields,errors:t.errors,isValid:t.isValid})}else yr(o,te,q)},w=(te,q)=>{yr(t.errors,te,q),f.state.next({errors:t.errors})},S=te=>{t.errors=te,f.state.next({errors:t.errors,isValid:!1})},k=(te,q,ke,He)=>{const Ke=kt(r,te);if(Ke){const Be=kt(o,te,ts(ke)?kt(s,te):ke);ts(Be)||He&&He.defaultChecked||q?yr(o,te,q?Be:OI(Ke._f)):L(te,Be),i.mount&&v()}},N=(te,q,ke,He,Ke)=>{let Be=!1,ct=!1;const Nt={name:te};if(!e.disabled){if(!ke||He){(u.isDirty||d.isDirty)&&(ct=t.isDirty,t.isDirty=Nt.isDirty=A(),Be=ct!==Nt.isDirty);const Rt=el(kt(s,te),q);ct=!!kt(t.dirtyFields,te),Rt?gs(t.dirtyFields,te):yr(t.dirtyFields,te,!0),Nt.dirtyFields=t.dirtyFields,Be=Be||(u.dirtyFields||d.dirtyFields)&&ct!==!Rt}if(ke){const Rt=kt(t.touchedFields,te);Rt||(yr(t.touchedFields,te,ke),Nt.touchedFields=t.touchedFields,Be=Be||(u.touchedFields||d.touchedFields)&&Rt!==ke)}Be&&Ke&&f.state.next(Nt)}return Be?Nt:{}},I=(te,q,ke,He)=>{const Ke=kt(t.errors,te),Be=(u.isValid||d.isValid)&&Vi(q)&&t.isValid!==q;if(e.delayError&&ke?(l=x(()=>w(te,ke)),l(e.delayError)):(clearTimeout(c),l=null,ke?yr(t.errors,te,ke):gs(t.errors,te)),(ke?!el(Ke,ke):Ke)||!Xo(He)||Be){const ct={...He,...Be&&Vi(q)?{isValid:q}:{},errors:t.errors,name:te};t={...t,...ct},f.state.next(ct)}},T=async te=>{y(te,!0);const q=await e.resolver(o,e.context,hZ(te||a.mount,r,e.criteriaMode,e.shouldUseNativeValidation));return y(te),q},F=async te=>{const{errors:q}=await T(te);if(te)for(const ke of te){const He=kt(q,ke);He?yr(t.errors,ke,He):gs(t.errors,ke)}else t.errors=q;return q},R=async(te,q,ke={valid:!0})=>{for(const He in te){const Ke=te[He];if(Ke){const{_f:Be,...ct}=Ke;if(Be){const Nt=a.array.has(Be.name),Rt=Ke._f&&pZ(Ke._f);Rt&&u.validatingFields&&y([Be.name],!0);const sn=await zI(Ke,a.disabled,o,p,e.shouldUseNativeValidation&&!q,Nt);if(Rt&&u.validatingFields&&y([Be.name]),sn[Be.name]&&(ke.valid=!1,q))break;!q&&(kt(sn,Be.name)?Nt?bZ(t.errors,sn,Be.name):yr(t.errors,Be.name,sn[Be.name]):gs(t.errors,Be.name))}!Xo(ct)&&await R(ct,q,ke)}}return ke.valid},D=()=>{for(const te of a.unMount){const q=kt(r,te);q&&(q._f.refs?q._f.refs.every(ke=>!rC(ke)):!rC(q._f.ref))&&pe(te)}a.unMount=new Set},A=(te,q)=>!e.disabled&&(te&&q&&yr(o,te,q),!el(z(),s)),P=(te,q,ke)=>q4(te,a,{...i.mount?o:ts(q)?s:Hi(te)?{[te]:q}:q},ke,q),B=te=>$k(kt(i.mount?o:s,te,e.shouldUnregister?kt(s,te,[]):[])),L=(te,q,ke={})=>{const He=kt(r,te);let Ke=q;if(He){const Be=He._f;Be&&(!Be.disabled&&yr(o,te,f$(q,Be)),Ke=n2(Be.ref)&&vi(q)?"":q,c$(Be.ref)?[...Be.ref.options].forEach(ct=>ct.selected=Ke.includes(ct.value)):Be.refs?Jg(Be.ref)?Be.refs.forEach(ct=>{(!ct.defaultChecked||!ct.disabled)&&(Array.isArray(Ke)?ct.checked=!!Ke.find(Nt=>Nt===ct.value):ct.checked=Ke===ct.value||!!Ke)}):Be.refs.forEach(ct=>ct.checked=ct.value===Ke):Lk(Be.ref)?Be.ref.value="":(Be.ref.value=Ke,Be.ref.type||f.state.next({name:te,values:As(o)})))}(ke.shouldDirty||ke.shouldTouch)&&N(te,Ke,ke.shouldTouch,ke.shouldDirty,!0),ke.shouldValidate&&j(te)},W=(te,q,ke)=>{for(const He in q){if(!q.hasOwnProperty(He))return;const Ke=q[He],Be=te+"."+He,ct=kt(r,Be);(a.array.has(te)||ks(Ke)||ct&&!ct._f)&&!af(Ke)?W(Be,Ke,ke):L(Be,Ke,ke)}},H=(te,q,ke={})=>{const He=kt(r,te),Ke=a.array.has(te),Be=As(q);yr(o,te,Be),Ke?(f.array.next({name:te,values:As(o)}),(u.isDirty||u.dirtyFields||d.isDirty||d.dirtyFields)&&ke.shouldDirty&&f.state.next({name:te,dirtyFields:Gh(s,o),isDirty:A(te,Be)})):He&&!He._f&&!vi(Be)?W(te,Be,ke):L(te,Be,ke),jI(te,a)&&f.state.next({...t,name:te}),f.state.next({name:i.mount?te:void 0,values:As(o)})},G=async te=>{i.mount=!0;const q=te.target;let ke=q.name,He=!0;const Ke=kt(r,ke),Be=Rt=>{He=Number.isNaN(Rt)||af(Rt)&&isNaN(Rt.getTime())||el(Rt,kt(o,ke,Rt))},ct=MI(e.mode),Nt=MI(e.reValidateMode);if(Ke){let Rt,sn;const Kn=q.type?OI(Ke._f):s$(te),Ee=te.type===t2.BLUR||te.type===t2.FOCUS_OUT,Ge=!mZ(Ke._f)&&!e.resolver&&!kt(t.errors,ke)&&!Ke._f.deps||vZ(Ee,kt(t.touchedFields,ke),t.isSubmitted,Nt,ct),Q=jI(ke,a,Ee);yr(o,ke,Kn),Ee?(!q||!q.readOnly)&&(Ke._f.onBlur&&Ke._f.onBlur(te),l&&l(0)):Ke._f.onChange&&Ke._f.onChange(te);const ht=N(ke,Kn,Ee),it=!Xo(ht)||Q;if(!Ee&&f.state.next({name:ke,type:te.type,values:As(o)}),Ge)return(u.isValid||d.isValid)&&(e.mode==="onBlur"?Ee&&v():Ee||v()),it&&f.state.next({name:ke,...Q?{}:ht});if(!Ee&&Q&&f.state.next({...t}),e.resolver){const{errors:Yt}=await T([ke]);if(Be(Kn),He){const cn=BI(t.errors,r,ke),Lt=BI(Yt,r,cn.name||ke);Rt=Lt.error,ke=Lt.name,sn=Xo(Yt)}}else y([ke],!0),Rt=(await zI(Ke,a.disabled,o,p,e.shouldUseNativeValidation))[ke],y([ke]),Be(Kn),He&&(Rt?sn=!1:(u.isValid||d.isValid)&&(sn=await R(r,!0)));He&&(Ke._f.deps&&(!Array.isArray(Ke._f.deps)||Ke._f.deps.length>0)&&j(Ke._f.deps),I(ke,sn,Rt,ht))}},M=(te,q)=>{if(kt(t.errors,q)&&te.focus)return te.focus(),1},j=async(te,q={})=>{let ke,He;const Ke=cg(te);if(e.resolver){const Be=await F(ts(te)?te:Ke);ke=Xo(Be),He=te?!Ke.some(ct=>kt(Be,ct)):ke}else te?(He=(await Promise.all(Ke.map(async Be=>{const ct=kt(r,Be);return await R(ct&&ct._f?{[Be]:ct}:ct)}))).every(Boolean),!(!He&&!t.isValid)&&v()):He=ke=await R(r);return f.state.next({...!Hi(te)||(u.isValid||d.isValid)&&ke!==t.isValid?{}:{name:te},...e.resolver||!te?{isValid:ke}:{},errors:t.errors}),q.shouldFocus&&!He&&ug(r,M,te?Ke:a.mount),He},z=(te,q)=>{let ke={...i.mount?o:s};return q&&(ke=l$(q.dirtyFields?t.dirtyFields:t.touchedFields,ke)),ts(te)?ke:Hi(te)?kt(ke,te):te.map(He=>kt(ke,He))},V=(te,q)=>({invalid:!!kt((q||t).errors,te),isDirty:!!kt((q||t).dirtyFields,te),error:kt((q||t).errors,te),isValidating:!!kt(t.validatingFields,te),isTouched:!!kt((q||t).touchedFields,te)}),K=te=>{te&&cg(te).forEach(q=>gs(t.errors,q)),f.state.next({errors:te?t.errors:{}})},J=(te,q,ke)=>{const He=(kt(r,te,{_f:{}})._f||{}).ref,Ke=kt(t.errors,te)||{},{ref:Be,message:ct,type:Nt,...Rt}=Ke;yr(t.errors,te,{...Rt,...q,ref:He}),f.state.next({name:te,errors:t.errors,isValid:!1}),ke&&ke.shouldFocus&&He&&He.focus&&He.focus()},oe=(te,q)=>tl(te)?f.state.subscribe({next:ke=>"values"in ke&&te(P(void 0,q),ke)}):P(te,q,!0),Z=te=>f.state.subscribe({next:q=>{xZ(te.name,q.name,te.exact)&&gZ(q,te.formState||u,rn,te.reRenderRoot)&&te.callback({values:{...o},...t,...q,defaultValues:s})}}).unsubscribe,de=te=>(i.mount=!0,d={...d,...te.formState},Z({...te,formState:d})),pe=(te,q={})=>{for(const ke of te?cg(te):a.mount)a.mount.delete(ke),a.array.delete(ke),q.keepValue||(gs(r,ke),gs(o,ke)),!q.keepError&&gs(t.errors,ke),!q.keepDirty&&gs(t.dirtyFields,ke),!q.keepTouched&&gs(t.touchedFields,ke),!q.keepIsValidating&&gs(t.validatingFields,ke),!e.shouldUnregister&&!q.keepDefaultValue&&gs(s,ke);f.state.next({values:As(o)}),f.state.next({...t,...q.keepDirty?{isDirty:A()}:{}}),!q.keepIsValid&&v()},Ce=({disabled:te,name:q})=>{(Vi(te)&&i.mount||te||a.disabled.has(q))&&(te?a.disabled.add(q):a.disabled.delete(q))},Ae=(te,q={})=>{let ke=kt(r,te);const He=Vi(q.disabled)||Vi(e.disabled);return yr(r,te,{...ke||{},_f:{...ke&&ke._f?ke._f:{ref:{name:te}},name:te,mount:!0,...q}}),a.mount.add(te),ke?Ce({disabled:Vi(q.disabled)?q.disabled:e.disabled,name:te}):k(te,!0,q.value),{...He?{disabled:q.disabled||e.disabled}:{},...e.progressive?{required:!!q.required,min:Wm(q.min),max:Wm(q.max),minLength:Wm(q.minLength),maxLength:Wm(q.maxLength),pattern:Wm(q.pattern)}:{},name:te,onChange:G,onBlur:G,ref:Ke=>{if(Ke){Ae(te,q),ke=kt(r,te);const Be=ts(Ke.value)&&Ke.querySelectorAll&&Ke.querySelectorAll("input,select,textarea")[0]||Ke,ct=cZ(Be),Nt=ke._f.refs||[];if(ct?Nt.find(Rt=>Rt===Be):Be===ke._f.ref)return;yr(r,te,{_f:{...ke._f,...ct?{refs:[...Nt.filter(rC),Be,...Array.isArray(kt(s,te))?[{}]:[]],ref:{type:Be.type,name:te}}:{ref:Be}}}),k(te,!1,void 0,Be)}else ke=kt(r,te,{}),ke._f&&(ke._f.mount=!1),(e.shouldUnregister||q.shouldUnregister)&&!(o$(a.array,te)&&i.action)&&a.unMount.add(te)}}},ze=()=>e.shouldFocusError&&ug(r,M,a.mount),et=te=>{Vi(te)&&(f.state.next({disabled:te}),ug(r,(q,ke)=>{const He=kt(r,ke);He&&(q.disabled=He._f.disabled||te,Array.isArray(He._f.refs)&&He._f.refs.forEach(Ke=>{Ke.disabled=He._f.disabled||te}))},0,!1))},gt=(te,q)=>async ke=>{let He;ke&&(ke.preventDefault&&ke.preventDefault(),ke.persist&&ke.persist());let Ke=As(o);if(f.state.next({isSubmitting:!0}),e.resolver){const{errors:Be,values:ct}=await T();t.errors=Be,Ke=As(ct)}else await R(r);if(a.disabled.size)for(const Be of a.disabled)gs(Ke,Be);if(gs(t.errors,"root"),Xo(t.errors)){f.state.next({errors:{}});try{await te(Ke,ke)}catch(Be){He=Be}}else q&&await q({...t.errors},ke),ze(),setTimeout(ze);if(f.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:Xo(t.errors)&&!He,submitCount:t.submitCount+1,errors:t.errors}),He)throw He},dt=(te,q={})=>{kt(r,te)&&(ts(q.defaultValue)?H(te,As(kt(s,te))):(H(te,q.defaultValue),yr(s,te,As(q.defaultValue))),q.keepTouched||gs(t.touchedFields,te),q.keepDirty||(gs(t.dirtyFields,te),t.isDirty=q.defaultValue?A(te,As(kt(s,te))):A()),q.keepError||(gs(t.errors,te),u.isValid&&v()),f.state.next({...t}))},Ct=(te,q={})=>{const ke=te?As(te):s,He=As(ke),Ke=Xo(te),Be=Ke?s:He;if(q.keepDefaultValues||(s=ke),!q.keepValues){if(q.keepDirtyValues){const ct=new Set([...a.mount,...Object.keys(Gh(s,o))]);for(const Nt of Array.from(ct))kt(t.dirtyFields,Nt)?yr(Be,Nt,kt(o,Nt)):H(Nt,kt(Be,Nt))}else{if(Ak&&ts(te))for(const ct of a.mount){const Nt=kt(r,ct);if(Nt&&Nt._f){const Rt=Array.isArray(Nt._f.refs)?Nt._f.refs[0]:Nt._f.ref;if(n2(Rt)){const sn=Rt.closest("form");if(sn){sn.reset();break}}}}if(q.keepFieldsRef)for(const ct of a.mount)H(ct,kt(Be,ct));else r={}}o=e.shouldUnregister?q.keepDefaultValues?As(s):{}:As(Be),f.array.next({values:{...Be}}),f.state.next({values:{...Be}})}a={mount:q.keepDirtyValues?a.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},i.mount=!u.isValid||!!q.keepIsValid||!!q.keepDirtyValues||!e.shouldUnregister&&!Xo(Be),i.watch=!!e.shouldUnregister,f.state.next({submitCount:q.keepSubmitCount?t.submitCount:0,isDirty:Ke?!1:q.keepDirty?t.isDirty:!!(q.keepDefaultValues&&!el(te,s)),isSubmitted:q.keepIsSubmitted?t.isSubmitted:!1,dirtyFields:Ke?{}:q.keepDirtyValues?q.keepDefaultValues&&o?Gh(s,o):t.dirtyFields:q.keepDefaultValues&&te?Gh(s,te):q.keepDirty?t.dirtyFields:{},touchedFields:q.keepTouched?t.touchedFields:{},errors:q.keepErrors?t.errors:{},isSubmitSuccessful:q.keepIsSubmitSuccessful?t.isSubmitSuccessful:!1,isSubmitting:!1,defaultValues:s})},lt=(te,q)=>Ct(tl(te)?te(o):te,q),bt=(te,q={})=>{const ke=kt(r,te),He=ke&&ke._f;if(He){const Ke=He.refs?He.refs[0]:He.ref;Ke.focus&&(Ke.focus(),q.shouldSelect&&tl(Ke.select)&&Ke.select())}},rn=te=>{t={...t,...te}},vn={control:{register:Ae,unregister:pe,getFieldState:V,handleSubmit:gt,setError:J,_subscribe:Z,_runSchema:T,_focusError:ze,_getWatch:P,_getDirty:A,_setValid:v,_setFieldArray:b,_setDisabledField:Ce,_setErrors:S,_getFieldArray:B,_reset:Ct,_resetDefaultValues:()=>tl(e.defaultValues)&&e.defaultValues().then(te=>{lt(te,e.resetOptions),f.state.next({isLoading:!1})}),_removeUnmounted:D,_disableForm:et,_subjects:f,_proxyFormState:u,get _fields(){return r},get _formValues(){return o},get _state(){return i},set _state(te){i=te},get _defaultValues(){return s},get _names(){return a},set _names(te){a=te},get _formState(){return t},get _options(){return e},set _options(te){e={...e,...te}}},subscribe:de,trigger:j,register:Ae,handleSubmit:gt,watch:oe,setValue:H,getValues:z,reset:lt,resetField:dt,clearErrors:K,unregister:pe,setError:J,setFocus:bt,getFieldState:V};return{...vn,formControl:vn}}function kZ(n={}){const e=Ve.useRef(void 0),t=Ve.useRef(void 0),[r,s]=Ve.useState({isDirty:!1,isValidating:!1,isLoading:tl(n.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:n.errors||{},disabled:n.disabled||!1,isReady:!1,defaultValues:tl(n.defaultValues)?void 0:n.defaultValues});if(!e.current)if(n.formControl)e.current={...n.formControl,formState:r},n.defaultValues&&!tl(n.defaultValues)&&n.formControl.reset(n.defaultValues,n.resetOptions);else{const{formControl:i,...a}=CZ(n);e.current={...a,formState:r}}const o=e.current.control;return o._options=n,Ok(()=>{const i=o._subscribe({formState:o._proxyFormState,callback:()=>s({...o._formState}),reRenderRoot:!0});return s(a=>({...a,isReady:!0})),o._formState.isReady=!0,i},[o]),Ve.useEffect(()=>o._disableForm(n.disabled),[o,n.disabled]),Ve.useEffect(()=>{n.mode&&(o._options.mode=n.mode),n.reValidateMode&&(o._options.reValidateMode=n.reValidateMode)},[o,n.mode,n.reValidateMode]),Ve.useEffect(()=>{n.errors&&(o._setErrors(n.errors),o._focusError())},[o,n.errors]),Ve.useEffect(()=>{n.shouldUnregister&&o._subjects.state.next({values:o._getWatch()})},[o,n.shouldUnregister]),Ve.useEffect(()=>{if(o._proxyFormState.isDirty){const i=o._getDirty();i!==r.isDirty&&o._subjects.state.next({isDirty:i})}},[o,r.isDirty]),Ve.useEffect(()=>{n.values&&!el(n.values,t.current)?(o._reset(n.values,{keepFieldsRef:!0,...o._options.resetOptions}),t.current=n.values,s(i=>({...i}))):o._resetDefaultValues()},[o,n.values]),Ve.useEffect(()=>{o._state.mount||(o._setValid(),o._state.mount=!0),o._state.watch&&(o._state.watch=!1,o._subjects.state.next({...o._formState})),o._removeUnmounted()}),e.current.formState=a$(r,o),e.current}const WI=(n,e,t)=>{if(n&&"reportValidity"in n){const r=kt(t,e);n.setCustomValidity(r&&r.message||""),n.reportValidity()}},Y4=(n,e)=>{for(const t in e.fields){const r=e.fields[t];r&&r.ref&&"reportValidity"in r.ref?WI(r.ref,t,n):r&&r.refs&&r.refs.forEach(s=>WI(s,t,n))}},UI=(n,e)=>{e.shouldUseNativeValidation&&Y4(n,e);const t={};for(const r in n){const s=kt(e.fields,r),o=Object.assign(n[r]||{},{ref:s&&s.ref});if(SZ(e.names||Object.keys(n),r)){const i=Object.assign({},kt(t,r));yr(i,"root",o),yr(t,r,i)}else yr(t,r,o)}return t},SZ=(n,e)=>{const t=HI(e);return n.some(r=>HI(r).match(`^${t}\\.\\d+`))};function HI(n){return n.replace(/\]|\[/g,"")}function p$(n,e,t){function r(a,l){var c;Object.defineProperty(a,"_zod",{value:a._zod??{},enumerable:!1}),(c=a._zod).traits??(c.traits=new Set),a._zod.traits.add(n),e(a,l);for(const u in i.prototype)u in a||Object.defineProperty(a,u,{value:i.prototype[u].bind(a)});a._zod.constr=i,a._zod.def=l}const s=t?.Parent??Object;class o extends s{}Object.defineProperty(o,"name",{value:n});function i(a){var l;const c=t?.Parent?new o:this;r(c,a),(l=c._zod).deferred??(l.deferred=[]);for(const u of c._zod.deferred)u();return c}return Object.defineProperty(i,"init",{value:r}),Object.defineProperty(i,Symbol.hasInstance,{value:a=>t?.Parent&&a instanceof t.Parent?!0:a?._zod?.traits?.has(n)}),Object.defineProperty(i,"name",{value:n}),i}class NZ extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}const EZ={};function m$(n){return EZ}function IZ(n,e){return typeof e=="bigint"?e.toString():e}const g$=Error.captureStackTrace?Error.captureStackTrace:(...n)=>{};function Xx(n){return typeof n=="string"?n:n?.message}function x$(n,e,t){const r={...n,path:n.path??[]};if(!n.message){const s=Xx(n.inst?._zod.def?.error?.(n))??Xx(e?.error?.(n))??Xx(t.customError?.(n))??Xx(t.localeError?.(n))??"Invalid input";r.message=s}return delete r.inst,delete r.continue,e?.reportInput||delete r.input,r}const v$=(n,e)=>{n.name="$ZodError",Object.defineProperty(n,"_zod",{value:n._zod,enumerable:!1}),Object.defineProperty(n,"issues",{value:e,enumerable:!1}),Object.defineProperty(n,"message",{get(){return JSON.stringify(e,IZ,2)},enumerable:!0}),Object.defineProperty(n,"toString",{value:()=>n.message,enumerable:!1})},TZ=p$("$ZodError",v$),y$=p$("$ZodError",v$,{Parent:Error}),_Z=n=>(e,t,r,s)=>{const o=r?Object.assign(r,{async:!1}):{async:!1},i=e._zod.run({value:t,issues:[]},o);if(i instanceof Promise)throw new NZ;if(i.issues.length){const a=new(s?.Err??n)(i.issues.map(l=>x$(l,o,m$())));throw g$(a,s?.callee),a}return i.value},RZ=_Z(y$),DZ=n=>async(e,t,r,s)=>{const o=r?Object.assign(r,{async:!0}):{async:!0};let i=e._zod.run({value:t,issues:[]},o);if(i instanceof Promise&&(i=await i),i.issues.length){const a=new(s?.Err??n)(i.issues.map(l=>x$(l,o,m$())));throw g$(a,s?.callee),a}return i.value},AZ=DZ(y$);function GI(n,e){try{var t=n()}catch(r){return e(r)}return t&&t.then?t.then(void 0,e):t}function $Z(n,e){for(var t={};n.length;){var r=n[0],s=r.code,o=r.message,i=r.path.join(".");if(!t[i])if("unionErrors"in r){var a=r.unionErrors[0].errors[0];t[i]={message:a.message,type:a.code}}else t[i]={message:o,type:s};if("unionErrors"in r&&r.unionErrors.forEach(function(u){return u.errors.forEach(function(d){return n.push(d)})}),e){var l=t[i].types,c=l&&l[r.code];t[i]=Mk(i,e,t,s,c?[].concat(c,r.message):r.message)}n.shift()}return t}function FZ(n,e){for(var t={};n.length;){var r=n[0],s=r.code,o=r.message,i=r.path.join(".");if(!t[i])if(r.code==="invalid_union"&&r.errors.length>0){var a=r.errors[0][0];t[i]={message:a.message,type:a.code}}else t[i]={message:o,type:s};if(r.code==="invalid_union"&&r.errors.forEach(function(u){return u.forEach(function(d){return n.push(d)})}),e){var l=t[i].types,c=l&&l[r.code];t[i]=Mk(i,e,t,s,c?[].concat(c,r.message):r.message)}n.shift()}return t}function PZ(n,e,t){if(t===void 0&&(t={}),(function(r){return"_def"in r&&typeof r._def=="object"&&"typeName"in r._def})(n))return function(r,s,o){try{return Promise.resolve(GI(function(){return Promise.resolve(n[t.mode==="sync"?"parse":"parseAsync"](r,e)).then(function(i){return o.shouldUseNativeValidation&&Y4({},o),{errors:{},values:t.raw?Object.assign({},r):i}})},function(i){if((function(a){return Array.isArray(a?.issues)})(i))return{values:{},errors:UI($Z(i.errors,!o.shouldUseNativeValidation&&o.criteriaMode==="all"),o)};throw i}))}catch(i){return Promise.reject(i)}};if((function(r){return"_zod"in r&&typeof r._zod=="object"})(n))return function(r,s,o){try{return Promise.resolve(GI(function(){return Promise.resolve((t.mode==="sync"?RZ:AZ)(n,r,e)).then(function(i){return o.shouldUseNativeValidation&&Y4({},o),{errors:{},values:t.raw?Object.assign({},r):i}})},function(i){if((function(a){return a instanceof TZ})(i))return{values:{},errors:UI(FZ(i.issues,!o.shouldUseNativeValidation&&o.criteriaMode==="all"),o)};throw i}))}catch(i){return Promise.reject(i)}};throw new Error("Invalid input: not a Zod schema")}var ir;(function(n){n.assertEqual=s=>{};function e(s){}n.assertIs=e;function t(s){throw new Error}n.assertNever=t,n.arrayToEnum=s=>{const o={};for(const i of s)o[i]=i;return o},n.getValidEnumValues=s=>{const o=n.objectKeys(s).filter(a=>typeof s[s[a]]!="number"),i={};for(const a of o)i[a]=s[a];return n.objectValues(i)},n.objectValues=s=>n.objectKeys(s).map(function(o){return s[o]}),n.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const o=[];for(const i in s)Object.prototype.hasOwnProperty.call(s,i)&&o.push(i);return o},n.find=(s,o)=>{for(const i of s)if(o(i))return i},n.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&Number.isFinite(s)&&Math.floor(s)===s;function r(s,o=" | "){return s.map(i=>typeof i=="string"?`'${i}'`:i).join(o)}n.joinValues=r,n.jsonStringifyReplacer=(s,o)=>typeof o=="bigint"?o.toString():o})(ir||(ir={}));var qI;(function(n){n.mergeShapes=(e,t)=>({...e,...t})})(qI||(qI={}));const Gt=ir.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Mu=n=>{switch(typeof n){case"undefined":return Gt.undefined;case"string":return Gt.string;case"number":return Number.isNaN(n)?Gt.nan:Gt.number;case"boolean":return Gt.boolean;case"function":return Gt.function;case"bigint":return Gt.bigint;case"symbol":return Gt.symbol;case"object":return Array.isArray(n)?Gt.array:n===null?Gt.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?Gt.promise:typeof Map<"u"&&n instanceof Map?Gt.map:typeof Set<"u"&&n instanceof Set?Gt.set:typeof Date<"u"&&n instanceof Date?Gt.date:Gt.object;default:return Gt.unknown}},ut=ir.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class zc extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(o){return o.message},r={_errors:[]},s=o=>{for(const i of o.issues)if(i.code==="invalid_union")i.unionErrors.map(s);else if(i.code==="invalid_return_type")s(i.returnTypeError);else if(i.code==="invalid_arguments")s(i.argumentsError);else if(i.path.length===0)r._errors.push(t(i));else{let a=r,l=0;for(;l<i.path.length;){const c=i.path[l];l===i.path.length-1?(a[c]=a[c]||{_errors:[]},a[c]._errors.push(t(i))):a[c]=a[c]||{_errors:[]},a=a[c],l++}}};return s(this),r}static assert(e){if(!(e instanceof zc))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ir.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},r=[];for(const s of this.issues)if(s.path.length>0){const o=s.path[0];t[o]=t[o]||[],t[o].push(e(s))}else r.push(e(s));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}zc.create=n=>new zc(n);const Z4=(n,e)=>{let t;switch(n.code){case ut.invalid_type:n.received===Gt.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case ut.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,ir.jsonStringifyReplacer)}`;break;case ut.unrecognized_keys:t=`Unrecognized key(s) in object: ${ir.joinValues(n.keys,", ")}`;break;case ut.invalid_union:t="Invalid input";break;case ut.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${ir.joinValues(n.options)}`;break;case ut.invalid_enum_value:t=`Invalid enum value. Expected ${ir.joinValues(n.options)}, received '${n.received}'`;break;case ut.invalid_arguments:t="Invalid function arguments";break;case ut.invalid_return_type:t="Invalid function return type";break;case ut.invalid_date:t="Invalid date";break;case ut.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:ir.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case ut.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="bigint"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case ut.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case ut.custom:t="Invalid input";break;case ut.invalid_intersection_types:t="Intersection results could not be merged";break;case ut.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case ut.not_finite:t="Number must be finite";break;default:t=e.defaultError,ir.assertNever(n)}return{message:t}};let OZ=Z4;function MZ(){return OZ}const LZ=n=>{const{data:e,path:t,errorMaps:r,issueData:s}=n,o=[...t,...s.path||[]],i={...s,path:o};if(s.message!==void 0)return{...s,path:o,message:s.message};let a="";const l=r.filter(c=>!!c).slice().reverse();for(const c of l)a=c(i,{data:e,defaultError:a}).message;return{...s,path:o,message:a}};function At(n,e){const t=MZ(),r=LZ({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,t,t===Z4?void 0:Z4].filter(s=>!!s)});n.common.issues.push(r)}class ta{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const r=[];for(const s of t){if(s.status==="aborted")return Cn;s.status==="dirty"&&e.dirty(),r.push(s.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){const r=[];for(const s of t){const o=await s.key,i=await s.value;r.push({key:o,value:i})}return ta.mergeObjectSync(e,r)}static mergeObjectSync(e,t){const r={};for(const s of t){const{key:o,value:i}=s;if(o.status==="aborted"||i.status==="aborted")return Cn;o.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),o.value!=="__proto__"&&(typeof i.value<"u"||s.alwaysSet)&&(r[o.value]=i.value)}return{status:e.value,value:r}}}const Cn=Object.freeze({status:"aborted"}),eg=n=>({status:"dirty",value:n}),Da=n=>({status:"valid",value:n}),KI=n=>n.status==="aborted",XI=n=>n.status==="dirty",bp=n=>n.status==="valid",s2=n=>typeof Promise<"u"&&n instanceof Promise;var Jt;(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e?.message})(Jt||(Jt={}));class sd{constructor(e,t,r,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=s}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const YI=(n,e)=>{if(bp(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new zc(n.common.issues);return this._error=t,this._error}}};function Bn(n){if(!n)return{};const{errorMap:e,invalid_type_error:t,required_error:r,description:s}=n;if(e&&(t||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(i,a)=>{const{message:l}=n;return i.code==="invalid_enum_value"?{message:l??a.defaultError}:typeof a.data>"u"?{message:l??r??a.defaultError}:i.code!=="invalid_type"?{message:a.defaultError}:{message:l??t??a.defaultError}},description:s}}class tr{get description(){return this._def.description}_getType(e){return Mu(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Mu(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new ta,ctx:{common:e.parent.common,data:e.data,parsedType:Mu(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(s2(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){const r={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Mu(e)},s=this._parseSync({data:e,path:r.path,parent:r});return YI(r,s)}"~validate"(e){const t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Mu(e)};if(!this["~standard"].async)try{const r=this._parseSync({data:e,path:[],parent:t});return bp(r)?{value:r.value}:{issues:t.common.issues}}catch(r){r?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(r=>bp(r)?{value:r.value}:{issues:t.common.issues})}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Mu(e)},s=this._parse({data:e,path:r.path,parent:r}),o=await(s2(s)?s:Promise.resolve(s));return YI(r,o)}refine(e,t){const r=s=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,o)=>{const i=e(s),a=()=>o.addIssue({code:ut.custom,...r(s)});return typeof Promise<"u"&&i instanceof Promise?i.then(l=>l?!0:(a(),!1)):i?!0:(a(),!1)})}refinement(e,t){return this._refinement((r,s)=>e(r)?!0:(s.addIssue(typeof t=="function"?t(r,s):t),!1))}_refinement(e){return new Cp({schema:this,typeName:kn.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return Ku.create(this,this._def)}nullable(){return kp.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Xl.create(this)}promise(){return l2.create(this,this._def)}or(e){return i2.create([this,e],this._def)}and(e){return a2.create(this,e,this._def)}transform(e){return new Cp({...Bn(this._def),schema:this,typeName:kn.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new e5({...Bn(this._def),innerType:this,defaultValue:t,typeName:kn.ZodDefault})}brand(){return new aJ({typeName:kn.ZodBranded,type:this,...Bn(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new t5({...Bn(this._def),innerType:this,catchValue:t,typeName:kn.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Bk.create(this,e)}readonly(){return n5.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const jZ=/^c[^\s-]{8,}$/i,BZ=/^[0-9a-z]+$/,VZ=/^[0-9A-HJKMNP-TV-Z]{26}$/i,zZ=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,WZ=/^[a-z0-9_-]{21}$/i,UZ=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,HZ=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,GZ=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,qZ="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let sC;const KZ=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,XZ=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,YZ=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,ZZ=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,JZ=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,QZ=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,b$="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",eJ=new RegExp(`^${b$}$`);function w$(n){let e="[0-5]\\d";n.precision?e=`${e}\\.\\d{${n.precision}}`:n.precision==null&&(e=`${e}(\\.\\d+)?`);const t=n.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function tJ(n){return new RegExp(`^${w$(n)}$`)}function nJ(n){let e=`${b$}T${w$(n)}`;const t=[];return t.push(n.local?"Z?":"Z"),n.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function rJ(n,e){return!!((e==="v4"||!e)&&KZ.test(n)||(e==="v6"||!e)&&YZ.test(n))}function sJ(n,e){if(!UZ.test(n))return!1;try{const[t]=n.split(".");if(!t)return!1;const r=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),s=JSON.parse(atob(r));return!(typeof s!="object"||s===null||"typ"in s&&s?.typ!=="JWT"||!s.alg||e&&s.alg!==e)}catch{return!1}}function oJ(n,e){return!!((e==="v4"||!e)&&XZ.test(n)||(e==="v6"||!e)&&ZZ.test(n))}class Bu extends tr{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==Gt.string){const o=this._getOrReturnCtx(e);return At(o,{code:ut.invalid_type,expected:Gt.string,received:o.parsedType}),Cn}const r=new ta;let s;for(const o of this._def.checks)if(o.kind==="min")e.data.length<o.value&&(s=this._getOrReturnCtx(e,s),At(s,{code:ut.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),r.dirty());else if(o.kind==="max")e.data.length>o.value&&(s=this._getOrReturnCtx(e,s),At(s,{code:ut.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),r.dirty());else if(o.kind==="length"){const i=e.data.length>o.value,a=e.data.length<o.value;(i||a)&&(s=this._getOrReturnCtx(e,s),i?At(s,{code:ut.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}):a&&At(s,{code:ut.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}),r.dirty())}else if(o.kind==="email")GZ.test(e.data)||(s=this._getOrReturnCtx(e,s),At(s,{validation:"email",code:ut.invalid_string,message:o.message}),r.dirty());else if(o.kind==="emoji")sC||(sC=new RegExp(qZ,"u")),sC.test(e.data)||(s=this._getOrReturnCtx(e,s),At(s,{validation:"emoji",code:ut.invalid_string,message:o.message}),r.dirty());else if(o.kind==="uuid")zZ.test(e.data)||(s=this._getOrReturnCtx(e,s),At(s,{validation:"uuid",code:ut.invalid_string,message:o.message}),r.dirty());else if(o.kind==="nanoid")WZ.test(e.data)||(s=this._getOrReturnCtx(e,s),At(s,{validation:"nanoid",code:ut.invalid_string,message:o.message}),r.dirty());else if(o.kind==="cuid")jZ.test(e.data)||(s=this._getOrReturnCtx(e,s),At(s,{validation:"cuid",code:ut.invalid_string,message:o.message}),r.dirty());else if(o.kind==="cuid2")BZ.test(e.data)||(s=this._getOrReturnCtx(e,s),At(s,{validation:"cuid2",code:ut.invalid_string,message:o.message}),r.dirty());else if(o.kind==="ulid")VZ.test(e.data)||(s=this._getOrReturnCtx(e,s),At(s,{validation:"ulid",code:ut.invalid_string,message:o.message}),r.dirty());else if(o.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),At(s,{validation:"url",code:ut.invalid_string,message:o.message}),r.dirty()}else o.kind==="regex"?(o.regex.lastIndex=0,o.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),At(s,{validation:"regex",code:ut.invalid_string,message:o.message}),r.dirty())):o.kind==="trim"?e.data=e.data.trim():o.kind==="includes"?e.data.includes(o.value,o.position)||(s=this._getOrReturnCtx(e,s),At(s,{code:ut.invalid_string,validation:{includes:o.value,position:o.position},message:o.message}),r.dirty()):o.kind==="toLowerCase"?e.data=e.data.toLowerCase():o.kind==="toUpperCase"?e.data=e.data.toUpperCase():o.kind==="startsWith"?e.data.startsWith(o.value)||(s=this._getOrReturnCtx(e,s),At(s,{code:ut.invalid_string,validation:{startsWith:o.value},message:o.message}),r.dirty()):o.kind==="endsWith"?e.data.endsWith(o.value)||(s=this._getOrReturnCtx(e,s),At(s,{code:ut.invalid_string,validation:{endsWith:o.value},message:o.message}),r.dirty()):o.kind==="datetime"?nJ(o).test(e.data)||(s=this._getOrReturnCtx(e,s),At(s,{code:ut.invalid_string,validation:"datetime",message:o.message}),r.dirty()):o.kind==="date"?eJ.test(e.data)||(s=this._getOrReturnCtx(e,s),At(s,{code:ut.invalid_string,validation:"date",message:o.message}),r.dirty()):o.kind==="time"?tJ(o).test(e.data)||(s=this._getOrReturnCtx(e,s),At(s,{code:ut.invalid_string,validation:"time",message:o.message}),r.dirty()):o.kind==="duration"?HZ.test(e.data)||(s=this._getOrReturnCtx(e,s),At(s,{validation:"duration",code:ut.invalid_string,message:o.message}),r.dirty()):o.kind==="ip"?rJ(e.data,o.version)||(s=this._getOrReturnCtx(e,s),At(s,{validation:"ip",code:ut.invalid_string,message:o.message}),r.dirty()):o.kind==="jwt"?sJ(e.data,o.alg)||(s=this._getOrReturnCtx(e,s),At(s,{validation:"jwt",code:ut.invalid_string,message:o.message}),r.dirty()):o.kind==="cidr"?oJ(e.data,o.version)||(s=this._getOrReturnCtx(e,s),At(s,{validation:"cidr",code:ut.invalid_string,message:o.message}),r.dirty()):o.kind==="base64"?JZ.test(e.data)||(s=this._getOrReturnCtx(e,s),At(s,{validation:"base64",code:ut.invalid_string,message:o.message}),r.dirty()):o.kind==="base64url"?QZ.test(e.data)||(s=this._getOrReturnCtx(e,s),At(s,{validation:"base64url",code:ut.invalid_string,message:o.message}),r.dirty()):ir.assertNever(o);return{status:r.value,value:e.data}}_regex(e,t,r){return this.refinement(s=>e.test(s),{validation:t,code:ut.invalid_string,...Jt.errToObj(r)})}_addCheck(e){return new Bu({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...Jt.errToObj(e)})}url(e){return this._addCheck({kind:"url",...Jt.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...Jt.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...Jt.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...Jt.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...Jt.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...Jt.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...Jt.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...Jt.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...Jt.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...Jt.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...Jt.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...Jt.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...Jt.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...Jt.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...Jt.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...Jt.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...Jt.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...Jt.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...Jt.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...Jt.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...Jt.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...Jt.errToObj(t)})}nonempty(e){return this.min(1,Jt.errToObj(e))}trim(){return new Bu({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Bu({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Bu({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Bu.create=n=>new Bu({checks:[],typeName:kn.ZodString,coerce:n?.coerce??!1,...Bn(n)});function iJ(n,e){const t=(n.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,s=t>r?t:r,o=Number.parseInt(n.toFixed(s).replace(".","")),i=Number.parseInt(e.toFixed(s).replace(".",""));return o%i/10**s}class Cg extends tr{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==Gt.number){const o=this._getOrReturnCtx(e);return At(o,{code:ut.invalid_type,expected:Gt.number,received:o.parsedType}),Cn}let r;const s=new ta;for(const o of this._def.checks)o.kind==="int"?ir.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),At(r,{code:ut.invalid_type,expected:"integer",received:"float",message:o.message}),s.dirty()):o.kind==="min"?(o.inclusive?e.data<o.value:e.data<=o.value)&&(r=this._getOrReturnCtx(e,r),At(r,{code:ut.too_small,minimum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),s.dirty()):o.kind==="max"?(o.inclusive?e.data>o.value:e.data>=o.value)&&(r=this._getOrReturnCtx(e,r),At(r,{code:ut.too_big,maximum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),s.dirty()):o.kind==="multipleOf"?iJ(e.data,o.value)!==0&&(r=this._getOrReturnCtx(e,r),At(r,{code:ut.not_multiple_of,multipleOf:o.value,message:o.message}),s.dirty()):o.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),At(r,{code:ut.not_finite,message:o.message}),s.dirty()):ir.assertNever(o);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,Jt.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Jt.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Jt.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Jt.toString(t))}setLimit(e,t,r,s){return new Cg({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:Jt.toString(s)}]})}_addCheck(e){return new Cg({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:Jt.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Jt.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Jt.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Jt.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Jt.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Jt.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:Jt.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Jt.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Jt.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&ir.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(t===null||r.value>t)&&(t=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}Cg.create=n=>new Cg({checks:[],typeName:kn.ZodNumber,coerce:n?.coerce||!1,...Bn(n)});class kg extends tr{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==Gt.bigint)return this._getInvalidInput(e);let r;const s=new ta;for(const o of this._def.checks)o.kind==="min"?(o.inclusive?e.data<o.value:e.data<=o.value)&&(r=this._getOrReturnCtx(e,r),At(r,{code:ut.too_small,type:"bigint",minimum:o.value,inclusive:o.inclusive,message:o.message}),s.dirty()):o.kind==="max"?(o.inclusive?e.data>o.value:e.data>=o.value)&&(r=this._getOrReturnCtx(e,r),At(r,{code:ut.too_big,type:"bigint",maximum:o.value,inclusive:o.inclusive,message:o.message}),s.dirty()):o.kind==="multipleOf"?e.data%o.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),At(r,{code:ut.not_multiple_of,multipleOf:o.value,message:o.message}),s.dirty()):ir.assertNever(o);return{status:s.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return At(t,{code:ut.invalid_type,expected:Gt.bigint,received:t.parsedType}),Cn}gte(e,t){return this.setLimit("min",e,!0,Jt.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Jt.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Jt.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Jt.toString(t))}setLimit(e,t,r,s){return new kg({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:Jt.toString(s)}]})}_addCheck(e){return new kg({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Jt.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Jt.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Jt.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Jt.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Jt.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}kg.create=n=>new kg({checks:[],typeName:kn.ZodBigInt,coerce:n?.coerce??!1,...Bn(n)});class ZI extends tr{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==Gt.boolean){const r=this._getOrReturnCtx(e);return At(r,{code:ut.invalid_type,expected:Gt.boolean,received:r.parsedType}),Cn}return Da(e.data)}}ZI.create=n=>new ZI({typeName:kn.ZodBoolean,coerce:n?.coerce||!1,...Bn(n)});class o2 extends tr{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==Gt.date){const o=this._getOrReturnCtx(e);return At(o,{code:ut.invalid_type,expected:Gt.date,received:o.parsedType}),Cn}if(Number.isNaN(e.data.getTime())){const o=this._getOrReturnCtx(e);return At(o,{code:ut.invalid_date}),Cn}const r=new ta;let s;for(const o of this._def.checks)o.kind==="min"?e.data.getTime()<o.value&&(s=this._getOrReturnCtx(e,s),At(s,{code:ut.too_small,message:o.message,inclusive:!0,exact:!1,minimum:o.value,type:"date"}),r.dirty()):o.kind==="max"?e.data.getTime()>o.value&&(s=this._getOrReturnCtx(e,s),At(s,{code:ut.too_big,message:o.message,inclusive:!0,exact:!1,maximum:o.value,type:"date"}),r.dirty()):ir.assertNever(o);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new o2({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:Jt.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:Jt.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}o2.create=n=>new o2({checks:[],coerce:n?.coerce||!1,typeName:kn.ZodDate,...Bn(n)});class JI extends tr{_parse(e){if(this._getType(e)!==Gt.symbol){const r=this._getOrReturnCtx(e);return At(r,{code:ut.invalid_type,expected:Gt.symbol,received:r.parsedType}),Cn}return Da(e.data)}}JI.create=n=>new JI({typeName:kn.ZodSymbol,...Bn(n)});class QI extends tr{_parse(e){if(this._getType(e)!==Gt.undefined){const r=this._getOrReturnCtx(e);return At(r,{code:ut.invalid_type,expected:Gt.undefined,received:r.parsedType}),Cn}return Da(e.data)}}QI.create=n=>new QI({typeName:kn.ZodUndefined,...Bn(n)});class e9 extends tr{_parse(e){if(this._getType(e)!==Gt.null){const r=this._getOrReturnCtx(e);return At(r,{code:ut.invalid_type,expected:Gt.null,received:r.parsedType}),Cn}return Da(e.data)}}e9.create=n=>new e9({typeName:kn.ZodNull,...Bn(n)});class t9 extends tr{constructor(){super(...arguments),this._any=!0}_parse(e){return Da(e.data)}}t9.create=n=>new t9({typeName:kn.ZodAny,...Bn(n)});class n9 extends tr{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Da(e.data)}}n9.create=n=>new n9({typeName:kn.ZodUnknown,...Bn(n)});class od extends tr{_parse(e){const t=this._getOrReturnCtx(e);return At(t,{code:ut.invalid_type,expected:Gt.never,received:t.parsedType}),Cn}}od.create=n=>new od({typeName:kn.ZodNever,...Bn(n)});class r9 extends tr{_parse(e){if(this._getType(e)!==Gt.undefined){const r=this._getOrReturnCtx(e);return At(r,{code:ut.invalid_type,expected:Gt.void,received:r.parsedType}),Cn}return Da(e.data)}}r9.create=n=>new r9({typeName:kn.ZodVoid,...Bn(n)});class Xl extends tr{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),s=this._def;if(t.parsedType!==Gt.array)return At(t,{code:ut.invalid_type,expected:Gt.array,received:t.parsedType}),Cn;if(s.exactLength!==null){const i=t.data.length>s.exactLength.value,a=t.data.length<s.exactLength.value;(i||a)&&(At(t,{code:i?ut.too_big:ut.too_small,minimum:a?s.exactLength.value:void 0,maximum:i?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(At(t,{code:ut.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(At(t,{code:ut.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((i,a)=>s.type._parseAsync(new sd(t,i,t.path,a)))).then(i=>ta.mergeArray(r,i));const o=[...t.data].map((i,a)=>s.type._parseSync(new sd(t,i,t.path,a)));return ta.mergeArray(r,o)}get element(){return this._def.type}min(e,t){return new Xl({...this._def,minLength:{value:e,message:Jt.toString(t)}})}max(e,t){return new Xl({...this._def,maxLength:{value:e,message:Jt.toString(t)}})}length(e,t){return new Xl({...this._def,exactLength:{value:e,message:Jt.toString(t)}})}nonempty(e){return this.min(1,e)}}Xl.create=(n,e)=>new Xl({type:n,minLength:null,maxLength:null,exactLength:null,typeName:kn.ZodArray,...Bn(e)});function qh(n){if(n instanceof xs){const e={};for(const t in n.shape){const r=n.shape[t];e[t]=Ku.create(qh(r))}return new xs({...n._def,shape:()=>e})}else return n instanceof Xl?new Xl({...n._def,type:qh(n.element)}):n instanceof Ku?Ku.create(qh(n.unwrap())):n instanceof kp?kp.create(qh(n.unwrap())):n instanceof wf?wf.create(n.items.map(e=>qh(e))):n}class xs extends tr{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=ir.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==Gt.object){const c=this._getOrReturnCtx(e);return At(c,{code:ut.invalid_type,expected:Gt.object,received:c.parsedType}),Cn}const{status:r,ctx:s}=this._processInputParams(e),{shape:o,keys:i}=this._getCached(),a=[];if(!(this._def.catchall instanceof od&&this._def.unknownKeys==="strip"))for(const c in s.data)i.includes(c)||a.push(c);const l=[];for(const c of i){const u=o[c],d=s.data[c];l.push({key:{status:"valid",value:c},value:u._parse(new sd(s,d,s.path,c)),alwaysSet:c in s.data})}if(this._def.catchall instanceof od){const c=this._def.unknownKeys;if(c==="passthrough")for(const u of a)l.push({key:{status:"valid",value:u},value:{status:"valid",value:s.data[u]}});else if(c==="strict")a.length>0&&(At(s,{code:ut.unrecognized_keys,keys:a}),r.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const c=this._def.catchall;for(const u of a){const d=s.data[u];l.push({key:{status:"valid",value:u},value:c._parse(new sd(s,d,s.path,u)),alwaysSet:u in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const c=[];for(const u of l){const d=await u.key,f=await u.value;c.push({key:d,value:f,alwaysSet:u.alwaysSet})}return c}).then(c=>ta.mergeObjectSync(r,c)):ta.mergeObjectSync(r,l)}get shape(){return this._def.shape()}strict(e){return Jt.errToObj,new xs({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,r)=>{const s=this._def.errorMap?.(t,r).message??r.defaultError;return t.code==="unrecognized_keys"?{message:Jt.errToObj(e).message??s}:{message:s}}}:{}})}strip(){return new xs({...this._def,unknownKeys:"strip"})}passthrough(){return new xs({...this._def,unknownKeys:"passthrough"})}extend(e){return new xs({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new xs({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:kn.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new xs({...this._def,catchall:e})}pick(e){const t={};for(const r of ir.objectKeys(e))e[r]&&this.shape[r]&&(t[r]=this.shape[r]);return new xs({...this._def,shape:()=>t})}omit(e){const t={};for(const r of ir.objectKeys(this.shape))e[r]||(t[r]=this.shape[r]);return new xs({...this._def,shape:()=>t})}deepPartial(){return qh(this)}partial(e){const t={};for(const r of ir.objectKeys(this.shape)){const s=this.shape[r];e&&!e[r]?t[r]=s:t[r]=s.optional()}return new xs({...this._def,shape:()=>t})}required(e){const t={};for(const r of ir.objectKeys(this.shape))if(e&&!e[r])t[r]=this.shape[r];else{let o=this.shape[r];for(;o instanceof Ku;)o=o._def.innerType;t[r]=o}return new xs({...this._def,shape:()=>t})}keyof(){return C$(ir.objectKeys(this.shape))}}xs.create=(n,e)=>new xs({shape:()=>n,unknownKeys:"strip",catchall:od.create(),typeName:kn.ZodObject,...Bn(e)});xs.strictCreate=(n,e)=>new xs({shape:()=>n,unknownKeys:"strict",catchall:od.create(),typeName:kn.ZodObject,...Bn(e)});xs.lazycreate=(n,e)=>new xs({shape:n,unknownKeys:"strip",catchall:od.create(),typeName:kn.ZodObject,...Bn(e)});class i2 extends tr{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;function s(o){for(const a of o)if(a.result.status==="valid")return a.result;for(const a of o)if(a.result.status==="dirty")return t.common.issues.push(...a.ctx.common.issues),a.result;const i=o.map(a=>new zc(a.ctx.common.issues));return At(t,{code:ut.invalid_union,unionErrors:i}),Cn}if(t.common.async)return Promise.all(r.map(async o=>{const i={...t,common:{...t.common,issues:[]},parent:null};return{result:await o._parseAsync({data:t.data,path:t.path,parent:i}),ctx:i}})).then(s);{let o;const i=[];for(const l of r){const c={...t,common:{...t.common,issues:[]},parent:null},u=l._parseSync({data:t.data,path:t.path,parent:c});if(u.status==="valid")return u;u.status==="dirty"&&!o&&(o={result:u,ctx:c}),c.common.issues.length&&i.push(c.common.issues)}if(o)return t.common.issues.push(...o.ctx.common.issues),o.result;const a=i.map(l=>new zc(l));return At(t,{code:ut.invalid_union,unionErrors:a}),Cn}}get options(){return this._def.options}}i2.create=(n,e)=>new i2({options:n,typeName:kn.ZodUnion,...Bn(e)});function J4(n,e){const t=Mu(n),r=Mu(e);if(n===e)return{valid:!0,data:n};if(t===Gt.object&&r===Gt.object){const s=ir.objectKeys(e),o=ir.objectKeys(n).filter(a=>s.indexOf(a)!==-1),i={...n,...e};for(const a of o){const l=J4(n[a],e[a]);if(!l.valid)return{valid:!1};i[a]=l.data}return{valid:!0,data:i}}else if(t===Gt.array&&r===Gt.array){if(n.length!==e.length)return{valid:!1};const s=[];for(let o=0;o<n.length;o++){const i=n[o],a=e[o],l=J4(i,a);if(!l.valid)return{valid:!1};s.push(l.data)}return{valid:!0,data:s}}else return t===Gt.date&&r===Gt.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}class a2 extends tr{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),s=(o,i)=>{if(KI(o)||KI(i))return Cn;const a=J4(o.value,i.value);return a.valid?((XI(o)||XI(i))&&t.dirty(),{status:t.value,value:a.data}):(At(r,{code:ut.invalid_intersection_types}),Cn)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([o,i])=>s(o,i)):s(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}a2.create=(n,e,t)=>new a2({left:n,right:e,typeName:kn.ZodIntersection,...Bn(t)});class wf extends tr{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Gt.array)return At(r,{code:ut.invalid_type,expected:Gt.array,received:r.parsedType}),Cn;if(r.data.length<this._def.items.length)return At(r,{code:ut.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Cn;!this._def.rest&&r.data.length>this._def.items.length&&(At(r,{code:ut.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const o=[...r.data].map((i,a)=>{const l=this._def.items[a]||this._def.rest;return l?l._parse(new sd(r,i,r.path,a)):null}).filter(i=>!!i);return r.common.async?Promise.all(o).then(i=>ta.mergeArray(t,i)):ta.mergeArray(t,o)}get items(){return this._def.items}rest(e){return new wf({...this._def,rest:e})}}wf.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new wf({items:n,typeName:kn.ZodTuple,rest:null,...Bn(e)})};class s9 extends tr{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Gt.map)return At(r,{code:ut.invalid_type,expected:Gt.map,received:r.parsedType}),Cn;const s=this._def.keyType,o=this._def.valueType,i=[...r.data.entries()].map(([a,l],c)=>({key:s._parse(new sd(r,a,r.path,[c,"key"])),value:o._parse(new sd(r,l,r.path,[c,"value"]))}));if(r.common.async){const a=new Map;return Promise.resolve().then(async()=>{for(const l of i){const c=await l.key,u=await l.value;if(c.status==="aborted"||u.status==="aborted")return Cn;(c.status==="dirty"||u.status==="dirty")&&t.dirty(),a.set(c.value,u.value)}return{status:t.value,value:a}})}else{const a=new Map;for(const l of i){const c=l.key,u=l.value;if(c.status==="aborted"||u.status==="aborted")return Cn;(c.status==="dirty"||u.status==="dirty")&&t.dirty(),a.set(c.value,u.value)}return{status:t.value,value:a}}}}s9.create=(n,e,t)=>new s9({valueType:e,keyType:n,typeName:kn.ZodMap,...Bn(t)});class Sg extends tr{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Gt.set)return At(r,{code:ut.invalid_type,expected:Gt.set,received:r.parsedType}),Cn;const s=this._def;s.minSize!==null&&r.data.size<s.minSize.value&&(At(r,{code:ut.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&r.data.size>s.maxSize.value&&(At(r,{code:ut.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());const o=this._def.valueType;function i(l){const c=new Set;for(const u of l){if(u.status==="aborted")return Cn;u.status==="dirty"&&t.dirty(),c.add(u.value)}return{status:t.value,value:c}}const a=[...r.data.values()].map((l,c)=>o._parse(new sd(r,l,r.path,c)));return r.common.async?Promise.all(a).then(l=>i(l)):i(a)}min(e,t){return new Sg({...this._def,minSize:{value:e,message:Jt.toString(t)}})}max(e,t){return new Sg({...this._def,maxSize:{value:e,message:Jt.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}Sg.create=(n,e)=>new Sg({valueType:n,minSize:null,maxSize:null,typeName:kn.ZodSet,...Bn(e)});class o9 extends tr{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}o9.create=(n,e)=>new o9({getter:n,typeName:kn.ZodLazy,...Bn(e)});class Q4 extends tr{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return At(t,{received:t.data,code:ut.invalid_literal,expected:this._def.value}),Cn}return{status:"valid",value:e.data}}get value(){return this._def.value}}Q4.create=(n,e)=>new Q4({value:n,typeName:kn.ZodLiteral,...Bn(e)});function C$(n,e){return new wp({values:n,typeName:kn.ZodEnum,...Bn(e)})}class wp extends tr{_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),r=this._def.values;return At(t,{expected:ir.joinValues(r),received:t.parsedType,code:ut.invalid_type}),Cn}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const t=this._getOrReturnCtx(e),r=this._def.values;return At(t,{received:t.data,code:ut.invalid_enum_value,options:r}),Cn}return Da(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return wp.create(e,{...this._def,...t})}exclude(e,t=this._def){return wp.create(this.options.filter(r=>!e.includes(r)),{...this._def,...t})}}wp.create=C$;class i9 extends tr{_parse(e){const t=ir.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==Gt.string&&r.parsedType!==Gt.number){const s=ir.objectValues(t);return At(r,{expected:ir.joinValues(s),received:r.parsedType,code:ut.invalid_type}),Cn}if(this._cache||(this._cache=new Set(ir.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const s=ir.objectValues(t);return At(r,{received:r.data,code:ut.invalid_enum_value,options:s}),Cn}return Da(e.data)}get enum(){return this._def.values}}i9.create=(n,e)=>new i9({values:n,typeName:kn.ZodNativeEnum,...Bn(e)});class l2 extends tr{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Gt.promise&&t.common.async===!1)return At(t,{code:ut.invalid_type,expected:Gt.promise,received:t.parsedType}),Cn;const r=t.parsedType===Gt.promise?t.data:Promise.resolve(t.data);return Da(r.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}}l2.create=(n,e)=>new l2({type:n,typeName:kn.ZodPromise,...Bn(e)});class Cp extends tr{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===kn.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),s=this._def.effect||null,o={addIssue:i=>{At(r,i),i.fatal?t.abort():t.dirty()},get path(){return r.path}};if(o.addIssue=o.addIssue.bind(o),s.type==="preprocess"){const i=s.transform(r.data,o);if(r.common.async)return Promise.resolve(i).then(async a=>{if(t.value==="aborted")return Cn;const l=await this._def.schema._parseAsync({data:a,path:r.path,parent:r});return l.status==="aborted"?Cn:l.status==="dirty"||t.value==="dirty"?eg(l.value):l});{if(t.value==="aborted")return Cn;const a=this._def.schema._parseSync({data:i,path:r.path,parent:r});return a.status==="aborted"?Cn:a.status==="dirty"||t.value==="dirty"?eg(a.value):a}}if(s.type==="refinement"){const i=a=>{const l=s.refinement(a,o);if(r.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(r.common.async===!1){const a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?Cn:(a.status==="dirty"&&t.dirty(),i(a.value),{status:t.value,value:a.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(a=>a.status==="aborted"?Cn:(a.status==="dirty"&&t.dirty(),i(a.value).then(()=>({status:t.value,value:a.value}))))}if(s.type==="transform")if(r.common.async===!1){const i=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!bp(i))return Cn;const a=s.transform(i.value,o);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:a}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(i=>bp(i)?Promise.resolve(s.transform(i.value,o)).then(a=>({status:t.value,value:a})):Cn);ir.assertNever(s)}}Cp.create=(n,e,t)=>new Cp({schema:n,typeName:kn.ZodEffects,effect:e,...Bn(t)});Cp.createWithPreprocess=(n,e,t)=>new Cp({schema:e,effect:{type:"preprocess",transform:n},typeName:kn.ZodEffects,...Bn(t)});class Ku extends tr{_parse(e){return this._getType(e)===Gt.undefined?Da(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ku.create=(n,e)=>new Ku({innerType:n,typeName:kn.ZodOptional,...Bn(e)});class kp extends tr{_parse(e){return this._getType(e)===Gt.null?Da(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}kp.create=(n,e)=>new kp({innerType:n,typeName:kn.ZodNullable,...Bn(e)});class e5 extends tr{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===Gt.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}e5.create=(n,e)=>new e5({innerType:n,typeName:kn.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...Bn(e)});class t5 extends tr{_parse(e){const{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return s2(s)?s.then(o=>({status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new zc(r.common.issues)},input:r.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new zc(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}t5.create=(n,e)=>new t5({innerType:n,typeName:kn.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...Bn(e)});class a9 extends tr{_parse(e){if(this._getType(e)!==Gt.nan){const r=this._getOrReturnCtx(e);return At(r,{code:ut.invalid_type,expected:Gt.nan,received:r.parsedType}),Cn}return{status:"valid",value:e.data}}}a9.create=n=>new a9({typeName:kn.ZodNaN,...Bn(n)});class aJ extends tr{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class Bk extends tr{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const o=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?Cn:o.status==="dirty"?(t.dirty(),eg(o.value)):this._def.out._parseAsync({data:o.value,path:r.path,parent:r})})();{const s=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?Cn:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:r.path,parent:r})}}static create(e,t){return new Bk({in:e,out:t,typeName:kn.ZodPipeline})}}class n5 extends tr{_parse(e){const t=this._def.innerType._parse(e),r=s=>(bp(s)&&(s.value=Object.freeze(s.value)),s);return s2(t)?t.then(s=>r(s)):r(t)}unwrap(){return this._def.innerType}}n5.create=(n,e)=>new n5({innerType:n,typeName:kn.ZodReadonly,...Bn(e)});var kn;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(kn||(kn={}));const xi=Bu.create;od.create;Xl.create;const Vk=xs.create,lJ=i2.create;a2.create;wf.create;const cJ=Q4.create;wp.create;l2.create;Ku.create;kp.create;const uJ={"+91":{min:10,max:10},"+1":{min:10,max:10},"+44":{min:10,max:10},"+61":{min:9,max:9},"+49":{min:10,max:11},"+33":{min:9,max:9},"+65":{min:8,max:8},"+971":{min:9,max:9},"+55":{min:10,max:11},"+81":{min:9,max:10}},l9=xi().min(2,"Must be at least 2 characters").regex(/^[A-Za-z\s]+$/,"Only letters and spaces are allowed"),Dl=(n,e,t=!0)=>n?e:t?lJ([cJ(""),e.optional()]):e.optional(),dJ=xi().regex(/^\d+$/,"Phone number must only contain digits"),r5=/^(0[1-9]|[12][0-9]|3[01])\/(0[1-9]|1[0-2])\/(19|20)\d\d$/;function Yx(n){const e=r5.exec(n);if(!e)return null;const t=Number(e[1]),r=Number(e[2])-1,s=Number(n.slice(-4)),o=new Date(Date.UTC(s,r,t));return o.getUTCFullYear()!==s||o.getUTCMonth()!==r||o.getUTCDate()!==t?null:o}function c9(n,e){const t=new Date,r=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate()));return new Date(Date.UTC(n.getUTCFullYear()+e,n.getUTCMonth(),n.getUTCDate()))<=r}const k$=n=>{const e=xi().email("Please enter a valid email address").min(1,"Please enter a valid email address"),t=xi().refine(a=>r5.test(a),{message:"Enter a valid DOB (DD/MM/YYYY)."}).refine(a=>Yx(a)!==null,{message:"Enter a valid DOB (DD/MM/YYYY)."}).refine(a=>{const l=Yx(a);return l?c9(l,18):!0},{message:"You must be at least 18 years old."}),r=xi().refine(a=>a===""||r5.test(a),{message:"Enter a valid DOB (DD/MM/YYYY)."}).refine(a=>a===""||Yx(a)!==null,{message:"Enter a valid DOB (DD/MM/YYYY)."}).refine(a=>{if(a==="")return!0;const l=Yx(a);return l?c9(l,18):!0},{message:"You must be at least 18 years old."}),s=n.dob?t:r,o=(a,l)=>xi().refine(c=>c===""||c.trim().length>=a,{message:l});return Vk({firstName:l9,lastName:l9,email:e,middleName:Dl(!!n.middleName,xi().trim().min(1,"Middle name is required")),gender:Dl(!!n.gender,xi().min(1,"Gender is required")),dateOfBirth:s,address:Dl(!!n.currentAddress,o(5,"Address must be at least 5 characters long")),city:Dl(!!n.currentCity,o(2,"City must be at least 2 characters long")),postalCode:Dl(!!n.currentPostal,xi().regex(/^\d{5,6}$/,"Enter a valid postal code")),permanentAddress:Dl(!!n.permanentAddress,o(5,"Permanent address must be at least 5 characters long")),permanentCity:Dl(!!n.permanentCity,o(2,"Permanent city must be at least 2 characters long")),permanentPostalCode:Dl(!!n.permanentPostal,xi().regex(/^\d{5,6}$/,"Enter a valid permanent postal code")),countryCode:Dl(!!n.phoneNumber,xi().min(1,"Please select a country code.")),phoneNumber:Dl(!!n.phoneNumber,dJ.min(1,"Please enter a valid phone number"))}).superRefine(({countryCode:a,phoneNumber:l},c)=>{const u=!l||l==="";if(!n.phoneNumber&&u||!a||!l)return;const d=uJ[a];if(!d)return;const f=l.length;(f<d.min||f>d.max)&&c.addIssue({code:ut.custom,path:["phoneNumber"],message:d.min===d.max?`Phone number must be exactly ${d.min} digits for ${a}.`:`Phone number must be ${d.min}${d.max} digits for ${a}.`})})};k$({phoneNumber:!0,gender:!1,currentAddress:!0,currentCity:!0,currentPostal:!0,permanentAddress:!0,permanentCity:!0,permanentPostal:!0,dob:!0,middleName:!1});function Vr(n){if(!n)return!1;const e=n.trim();return new RegExp("^\\p{L}{2,}$","u").test(e)}function Vu(n){const e=(n??"").trim();return e?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e):!1}const S$=[{dial:"+91",name:"India",min:10,max:10},{dial:"+1",name:"United States",min:10,max:10},{dial:"+44",name:"United Kingdom",min:10,max:10},{dial:"+61",name:"Australia",min:9,max:9},{dial:"+49",name:"Germany",min:10,max:11},{dial:"+33",name:"France",min:9,max:9},{dial:"+65",name:"Singapore",min:8,max:8},{dial:"+971",name:"United Arab Emirates",min:9,max:9},{dial:"+55",name:"Brazil",min:10,max:11},{dial:"+81",name:"Japan",min:9,max:10}];function N$(n){return(n??"").replace(/\D/g,"")}function zl(n,e){const t=N$(e),r=S$.find(s=>s.dial===n);return r?t.length>=r.min&&t.length<=r.max:t.length>=6&&t.length<=14}function fJ(n){const e=n.match(/^(\d{2})\/(\d{2})\/(\d{4})$/);if(!e)return null;const t=parseInt(e[1],10),r=parseInt(e[2],10)-1,s=parseInt(e[3],10),o=new Date(s,r,t);return o.getFullYear()!==s||o.getMonth()!==r||o.getDate()!==t?null:o}function zu(n,e=18){const t=fJ(n);if(!t)return!1;const r=new Date;return t>r?!1:hJ(t,r)>=e}function hJ(n,e=new Date){let t=e.getFullYear()-n.getFullYear();const r=e.getMonth()-n.getMonth();return(r<0||r===0&&e.getDate()<n.getDate())&&t--,t}function _o(n){if(!n)return!1;const e=n.replace(/\s+/g,"");return/^\d{5,6}$/.test(e)}function Ro(n){return n?n.trim().length>=5:!1}function E$(n){const{formData:e,setFormData:t,isEmailVerified:r,isPhoneVerified:s,onSendEmailOTP:o,onSendPhoneOTP:i,fieldConfig:a={},emailLocked:l}=n,c=a?.requiredToggles??{},u=M=>!!{dateOfBirth:!!c.dob,middleName:!!c.middleName,gender:!!c.gender,phoneNumber:!!c.phoneNumber,address:!!c.currentAddress,city:!!c.currentCity,postalCode:!!c.currentPostal,permanentAddress:!!c.permanentAddress,permanentCity:!!c.permanentCity,permanentPostalCode:!!c.permanentPostal}[M],d=({show:M})=>M?m.jsx("span",{className:"text-destructive",children:"*"}):null,f=M=>{if(!a||Object.keys(a).length===0)return["firstName","lastName","email"].includes(M);if(M==="currentAddress")return a.currentAddress===!0;if(M==="permanentAddress")return a.permanentAddress===!0;const z={firstName:"firstName",lastName:"lastName",email:"email",gender:"gender",dateOfBirth:"dateOfBirth",address:"currentAddress",city:"currentAddress",postalCode:"currentAddress",permanentCity:"permanentAddress",permanentPostalCode:"permanentAddress",phoneNumber:"phoneNumber",countryCode:"phoneNumber",middleName:"middleName"}[M];return z?a[z]===!0:!1},p=_.useMemo(()=>e,[]),x=_.useMemo(()=>k$(c),[c]),v=_.useMemo(()=>{const M=["firstName","lastName","email"];return c.dob&&M.push("dateOfBirth"),c.middleName&&M.push("middleName"),c.gender&&M.push("gender"),c.currentAddress&&M.push("address"),c.currentCity&&M.push("city"),c.currentPostal&&M.push("postalCode"),c.permanentAddress&&M.push("permanentAddress"),c.permanentCity&&M.push("permanentCity"),c.permanentPostal&&M.push("permanentPostalCode"),c.phoneNumber&&M.push("countryCode","phoneNumber"),M},[c]),{register:y,handleSubmit:b,setValue:w,watch:S,getValues:k,formState:{errors:N,touchedFields:I,dirtyFields:T},reset:F,clearErrors:R,trigger:D,control:A}=kZ({resolver:PZ(x),mode:"onBlur",reValidateMode:"onChange",shouldUnregister:!1,defaultValues:p}),{field:P}=lZ({name:"dateOfBirth",control:A}),B=_.useRef(!1),L=_.useRef(null);_.useEffect(()=>{B.current=!0,F(e,{keepDefaultValues:!1}),R();try{const j=v.filter(z=>{const V=e[z];return V!=null&&String(V).trim()!==""});j.length>0&&D(j)}catch{}const M=window.setTimeout(()=>{B.current=!1},0);return()=>window.clearTimeout(M)},[e,F,R,D,v]),_.useEffect(()=>{const M=S(j=>{B.current||(L.current&&window.clearTimeout(L.current),L.current=window.setTimeout(()=>{t(z=>({...z,...j}))},200))});return()=>{M.unsubscribe(),L.current&&window.clearTimeout(L.current)}},[S,t]);const W=M=>{if(!M)return"";const j=M.match(/^(\d{2})\/(\d{2})\/(\d{4})$/);if(!j)return"";const[,z,V,K]=j;return`${K}-${V}-${z}`},H=M=>{if(!M)return"";const[j,z,V]=M.split("-");return!j||!z||!V?"":`${V.padStart(2,"0")}/${z.padStart(2,"0")}/${j}`},G=M=>{};return m.jsx("form",{onSubmit:b(G),className:"flex flex-col items-start self-stretch",children:m.jsx("div",{className:"flex flex-col items-start gap-6 self-stretch",children:m.jsxs("div",{className:"flex flex-col items-start self-stretch",children:[m.jsxs("div",{className:"flex flex-col sm:flex-row items-start gap-4 sm:gap-6 self-stretch",children:[f("firstName")&&m.jsxs("div",{className:"flex flex-col items-start flex-1 w-full",children:[m.jsx("div",{className:"flex pb-2 items-start gap-2 self-stretch",children:m.jsx("div",{className:"flex h-2.5 flex-col justify-center flex-1 text-text-primary font-roboto text-[13px] font-normal leading-[18px]",children:m.jsxs("span",{className:"text-text-primary",children:["First Name ",m.jsx("span",{className:"text-destructive",children:" *"})]})})}),m.jsx("div",{className:`flex h-[38px] py-[15px] px-3 justify-between items-center self-stretch rounded border ${N.firstName?"border-destructive":"border-input-border"} bg-background`,children:m.jsx("div",{className:"flex items-center gap-2 flex-1",children:m.jsx("input",{type:"text",placeholder:"Enter Name",...y("firstName",{onChange:M=>w("firstName",M.target.value.replace(/[^\p{L}\s]/gu,""),{shouldValidate:!0})}),"aria-invalid":!!N.firstName,"aria-describedby":N.firstName?"err-firstName":void 0,className:"text-text-muted font-roboto text-[13px] font-normal leading-5 w-full bg-transparent border-none outline-none placeholder:text-text-muted"})})}),(()=>{const M=!!k("firstName"),j=!!(T.firstName||I.firstName);return!!N.firstName&&(j||M)?m.jsx("div",{id:"err-firstName",role:"alert",className:"text-destructive text-[12px] mt-1",children:N.firstName.message}):null})()]}),f("lastName")&&m.jsxs("div",{className:"flex flex-col items-start flex-1 w-full",children:[m.jsx("div",{className:"flex pb-2 items-start gap-2 self-stretch",children:m.jsx("div",{className:"flex h-2.5 flex-col justify-center flex-1 text-text-primary font-roboto text-[13px] font-normal leading-[18px]",children:m.jsxs("span",{className:"text-text-primary",children:["Last Name ",m.jsx("span",{className:"text-destructive",children:" *"})]})})}),m.jsx("div",{className:`flex h-[38px] py-[15px] px-3 justify-between items-center self-stretch rounded border ${N.lastName?"border-destructive":"border-input-border"} bg-background`,children:m.jsx("div",{className:"flex items-center gap-2 flex-1",children:m.jsx("input",{type:"text",placeholder:"Enter Your Full Name",...y("lastName",{onChange:M=>w("lastName",M.target.value.replace(/[^\p{L}\s]/gu,""),{shouldValidate:!0})}),"aria-invalid":!!N.lastName,"aria-describedby":N.lastName?"err-lastName":void 0,className:"text-text-muted font-roboto text-[13px] font-normal leading-5 w-full bg-transparent border-none outline-none placeholder:text-text-muted"})})}),(()=>{const M=!!k("lastName"),j=!!(T.lastName||I.lastName);return!!N.lastName&&(j||M)?m.jsx("div",{id:"err-lastName",role:"alert",className:"text-destructive text-[12px] mt-1",children:N.lastName.message}):null})()]})]}),m.jsxs("div",{className:"flex flex-col sm:flex-row items-start gap-4 sm:gap-6 self-stretch mt-6",children:[f("middleName")&&m.jsxs("div",{className:"flex flex-col items-start flex-1 w-full",children:[m.jsx("div",{className:"flex pb-2 items-start gap-2 self-stretch",children:m.jsx("div",{className:"flex h-2.5 flex-col justify-center flex-1 text-text-primary font-roboto text-[13px] font-normal leading-[18px]",children:m.jsxs("span",{className:"text-text-primary",children:["Middle Name ",m.jsx(d,{show:u("middleName")})]})})}),m.jsx("div",{className:"flex h-[38px] py-[15px] px-3 justify-between items-center self-stretch rounded border border-input-border bg-background",children:m.jsx("div",{className:"flex items-center gap-2 flex-1",children:m.jsx("input",{type:"text",placeholder:"Enter Name",...y("middleName"),className:"text-text-muted font-roboto text-[13px] font-normal leading-5 w-full bg-transparent border-none outline-none placeholder:text-text-muted"})})})]}),f("dateOfBirth")&&m.jsxs("div",{className:"flex w-full sm:flex-1 flex-col items-start",children:[m.jsx("div",{className:"flex pb-2 items-start gap-2 self-stretch",children:m.jsx("div",{className:"flex h-2.5 flex-col justify-center flex-1 text-text-primary font-roboto text-[13px] font-normal leading-[18px]",children:m.jsxs("span",{className:"text-text-primary",children:["Date Of Birth ",m.jsx(d,{show:u("dateOfBirth")})]})})}),m.jsx("div",{className:`flex h-[38px] py-[15px] px-3 justify-between items-center self-stretch rounded border ${N.dateOfBirth?"border-destructive":"border-input-border"} bg-background`,children:m.jsx("div",{className:"flex items-center gap-2 flex-1",children:m.jsx("input",{type:"date",placeholder:"DD/MM/YYYY",value:W(P.value),onChange:M=>P.onChange(H(M.target.value)),onBlur:P.onBlur,name:P.name,ref:P.ref,"aria-invalid":!!N.dateOfBirth,"aria-describedby":N.dateOfBirth?"err-dateOfBirth":void 0,className:"text-text-muted font-roboto text-[13px] font-normal leading-5 w-full bg-transparent border-none outline-none placeholder:text-text-muted"})})}),N.dateOfBirth&&m.jsx("div",{id:"err-dateOfBirth",role:"alert",className:"text-destructive text-[12px] mt-1",children:N.dateOfBirth.message})]})]}),m.jsx("div",{className:"flex flex-col items-start gap-6 self-stretch mt-6",children:m.jsxs("div",{className:"flex flex-col lg:flex-row items-start gap-4 lg:gap-6 self-stretch",children:[f("email")&&m.jsxs("div",{className:"flex flex-col items-start flex-1 w-full",children:[m.jsx("div",{className:"flex pb-2 items-start gap-2 self-stretch",children:m.jsx("div",{className:"flex h-2.5 flex-col justify-center flex-1 font-roboto text-[13px] font-normal leading-[18px]",children:m.jsxs("span",{className:"text-text-primary",children:["Email ",m.jsx("span",{className:"text-destructive",children:" *"})]})})}),m.jsxs("div",{className:"flex flex-col items-start gap-1 self-stretch",children:[m.jsxs("div",{className:`flex h-[38px] py-[15px] px-3 justify-between items-center self-stretch rounded border ${N.email?"border-destructive":"border-input-border"} bg-background`,children:[m.jsx("div",{className:"flex items-center gap-2 flex-1",children:m.jsx("input",{type:"email",placeholder:"Enter Your Email Address",...y("email",{onChange:M=>w("email",M.target.value.trim(),{shouldValidate:!0})}),disabled:!!l||r,"aria-invalid":!!N.email,"aria-describedby":N.email?"err-email":void 0,className:`text-text-muted font-roboto text-[13px] font-normal leading-5 w-full bg-transparent border-none outline-none placeholder:text-text-muted ${l||r?"opacity-75 cursor-not-allowed":""}`})}),m.jsx("button",{onClick:o,type:"button",disabled:!!N.email||!k("email")||r||!!l,"aria-disabled":!!N.email||!k("email")||r||!!l,className:`flex h-7 py-[9px] px-3 justify-center items-center gap-2 rounded bg-background ${N.email||!k("email")||r||l?"opacity-50 cursor-not-allowed":""}`,title:l?"Email is locked/verified":r?"Email already verified":k("email")?"Send verification OTP":"Enter a valid email first",children:m.jsx("span",{className:"text-primary font-figtree text-[12px] font-normal",children:l||r?"Verified":"Send OTP"})})]}),N.email?m.jsx("div",{id:"err-email",role:"alert",className:"text-destructive text-[12px] mt-1",children:N.email.message}):!r&&!l?m.jsx("div",{className:"text-text-muted text-[12px] mt-1",children:"Email verification is required to continue."}):null]})]}),f("phoneNumber")&&m.jsxs("div",{className:"flex flex-col items-start flex-1 w-full",children:[m.jsx("div",{className:"flex pb-2 items-start gap-2 self-stretch",children:m.jsx("div",{className:"flex h-2.5 flex-col justify-center flex-1 font-roboto text-[13px] font-normal leading-[18px]",children:m.jsxs("span",{className:"text-text-primary",children:["Phone Number ",m.jsx(d,{show:u("phoneNumber")})]})})}),m.jsxs("div",{className:"flex flex-col items-start gap-1 self-stretch",children:[m.jsxs("div",{className:`flex h-[38px] py-[15px] px-3 justify-between items-center self-stretch rounded border ${N.phoneNumber||N.countryCode?"border-destructive":"border-input-border"} bg-background`,children:[m.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[m.jsxs("select",{...y("countryCode",{onChange:M=>w("countryCode",M.target.value,{shouldValidate:!1}),onBlur:()=>{D("countryCode")}}),"aria-invalid":!!N.countryCode,"aria-describedby":N.countryCode?"err-countryCode":void 0,className:"text-text-muted font-roboto text-[13px] font-normal leading-5 bg-transparent outline-none border-r border-input-border pr-2 mr-2 min-w-[70px] max-w-[100px] flex-shrink-0",children:[m.jsx("option",{value:"",children:"Select"}),S$.map(M=>m.jsx("option",{value:M.dial,children:`${M.dial} ${M.name}`},M.dial))]}),m.jsx("input",{type:"tel",placeholder:"Enter Your Mobile Number",...y("phoneNumber",{onChange:M=>w("phoneNumber",N$(M.target.value),{shouldValidate:!1,shouldTouch:!0}),onBlur:M=>{D("phoneNumber")}}),"aria-invalid":!!N.phoneNumber,"aria-describedby":N.phoneNumber?"err-phoneNumber":void 0,className:"text-text-muted font-roboto text-[13px] font-normal leading-5 w-full bg-transparent border-none outline-none placeholder:text-text-muted"})]}),m.jsx("button",{onClick:i,type:"button",disabled:!!N.countryCode||!!N.phoneNumber||!k("phoneNumber")||!k("countryCode")||s,"aria-disabled":!!N.countryCode||!!N.phoneNumber||!k("phoneNumber")||!k("countryCode")||s,className:`flex h-7 py-[9px] px-3 justify-center items-center gap-2 rounded bg-background ${N.countryCode||N.phoneNumber||!k("phoneNumber")||!k("countryCode")||s?"opacity-50 cursor-not-allowed":""}`,children:m.jsx("span",{className:"text-primary font-figtree text-[12px] font-normal",children:s?"Verified":"Send OTP"})})]}),(()=>{const M=!!I.countryCode,j=!!I.phoneNumber,z=!!N.countryCode&&M,V=!!N.phoneNumber&&j;return z?m.jsx("div",{id:"err-countryCode",role:"alert",className:"text-destructive text-[12px] mt-1",children:N.countryCode.message}):V?m.jsx("div",{id:"err-phoneNumber",role:"alert",className:"text-destructive text-[12px] mt-1",children:N.phoneNumber.message}):s?null:m.jsx("div",{className:"text-text-muted text-[12px] mt-1"})})()]})]})]})}),f("gender")&&m.jsx("div",{className:"flex w-full items-start gap-4 lg:gap-6 mt-6",children:m.jsx("div",{className:"flex w-full lg:w-[458px] h-auto lg:h-14 items-start gap-4 lg:gap-6 flex-shrink-0",children:m.jsxs("div",{className:"flex w-full h-auto lg:h-14 flex-col items-start flex-1",children:[m.jsx("div",{className:"flex pb-2 items-start gap-2 self-stretch",children:m.jsxs("span",{className:"flex h-2.5 flex-col justify-center flex-1 text-text-primary font-roboto text-[13px] font-normal leading-[18px]",children:["Gender ",m.jsx(d,{show:u("gender")})]})}),m.jsx("div",{className:"flex flex-wrap items-start gap-2 sm:gap-3",children:["Male","Female","Non-Binary","Prefer Not To Say"].map(M=>m.jsxs("label",{className:"flex h-[38px] py-2 pr-2 items-center gap-2 rounded-full cursor-pointer",children:[m.jsxs("span",{className:"w-4 h-4 rounded-full border-[0.667px] border-step-inactive-border bg-background relative inline-flex items-center justify-center",children:[m.jsx("input",{type:"radio",value:M,...y("gender"),checked:S("gender")===M,onChange:()=>w("gender",M,{shouldValidate:!0,shouldTouch:!0}),className:"absolute inset-0 opacity-0 cursor-pointer","aria-label":M}),S("gender")===M&&m.jsx("span",{className:"absolute inset-1 rounded-full bg-primary"})]}),m.jsx("span",{className:"text-text-muted font-roboto text-[13px] font-normal leading-[22px]",children:M})]},M))})]})})}),f("currentAddress")&&m.jsxs("div",{className:"flex flex-col items-start gap-4 self-stretch w-full mt-6",children:[m.jsxs("div",{className:"flex pb-1 flex-col items-start gap-1 self-stretch",children:[m.jsxs("div",{className:"text-text-primary font-roboto text-[16px] font-bold leading-[26px]",children:["Current Address ",m.jsx("span",{className:"font-normal text-[13px] text-text-muted",children:"(as per ID)"})]}),m.jsx("div",{className:"self-stretch text-text-muted font-roboto text-[13px] font-normal leading-5",children:"Enter your current residential address exactly as shown on your government-issued ID."})]}),m.jsxs("div",{className:"flex flex-col items-start self-stretch w-full",children:[m.jsx("div",{className:"flex h-auto items-start gap-4 self-stretch w-full",children:m.jsxs("div",{className:"flex flex-col items-start flex-1 w-full",children:[m.jsx("div",{className:"flex pb-2 items-start gap-2 self-stretch",children:m.jsx("div",{className:"flex h-2.5 flex-col justify-center flex-1 text-text-primary font-roboto text-[13px] font-normal leading-[18px]",children:m.jsxs("span",{className:"text-text-primary",children:["Current Address ",m.jsx(d,{show:u("address")})]})})}),m.jsx("div",{className:`flex h-[38px] py-[15px] px-3 justify-between items-center self-stretch rounded border ${N.address?"border-destructive":"border-input-border"} bg-background w-full`,children:m.jsx("div",{className:"flex items-center gap-2 flex-1",children:m.jsx("input",{type:"text",placeholder:"e.g 123 MG Road, Shastri Nagar, Near City Park",...y("address"),"aria-invalid":!!N.address,"aria-describedby":N.address?"err-address":void 0,className:"text-text-muted font-roboto text-[13px] font-normal leading-5 w-full bg-transparent border-none outline-none placeholder:text-text-muted"})})}),N.address&&m.jsx("div",{id:"err-address",role:"alert",className:"text-destructive text-[12px] mt-1",children:N.address.message})]})}),m.jsxs("div",{className:"inline-flex flex-col sm:flex-row items-start gap-4 sm:gap-6 w-full mt-6",children:[m.jsxs("div",{className:"flex flex-col items-start w-full sm:flex-1",children:[m.jsx("div",{className:"flex pb-2 items-start gap-2 self-stretch",children:m.jsx("div",{className:"flex h-2.5 flex-col justify-center flex-1 text-text-primary font-roboto text-[13px] font-normal leading-[18px]",children:m.jsxs("span",{className:"text-text-primary",children:["City ",m.jsx(d,{show:u("city")})]})})}),m.jsx("div",{className:`flex h-[38px] py-[15px] px-3 justify-between items-center self-stretch rounded border ${N.city?"border-destructive":"border-input-border"} bg-background w-full`,children:m.jsx("div",{className:"flex items-center gap-2 flex-1",children:m.jsx("input",{type:"text",placeholder:"e.g Mumbai",...y("city"),"aria-invalid":!!N.city,"aria-describedby":N.city?"err-city":void 0,className:"text-text-muted font-roboto text-[13px] font-normal leading-5 w-full bg-transparent border-none outline-none placeholder:text-text-muted"})})}),N.city&&m.jsx("div",{id:"err-city",role:"alert",className:"text-destructive text-[12px] mt-1",children:N.city.message})]}),m.jsxs("div",{className:"flex flex-col items-start w-full sm:flex-1",children:[m.jsx("div",{className:"flex pb-2 items-start gap-2 self-stretch",children:m.jsx("div",{className:"flex h-2.5 flex-col justify-center flex-1 text-text-primary font-roboto text-[13px] font-normal leading-[18px]",children:m.jsxs("span",{className:"text-text-primary",children:["Postal Code ",m.jsx(d,{show:u("postalCode")})]})})}),m.jsx("div",{className:`flex h-[38px] py-[15px] px-3 justify-between items-center self-stretch rounded border ${N.postalCode?"border-destructive":"border-input-border"} bg-background w-full`,children:m.jsx("div",{className:"flex items-center gap-2 flex-1",children:m.jsx("input",{type:"text",placeholder:"e.g 432001",...y("postalCode"),"aria-invalid":!!N.postalCode,"aria-describedby":N.postalCode?"err-postalCode":void 0,className:"text-text-muted font-roboto text-[13px] font-normal leading-5 w-full bg-transparent border-none outline-none placeholder:text-text-muted"})})}),N.postalCode&&m.jsx("div",{id:"err-postalCode",role:"alert",className:"text-destructive text-[12px] mt-1",children:N.postalCode.message})]})]})]})]}),f("permanentAddress")&&m.jsxs("div",{className:"flex flex-col items-start gap-4 self-stretch w-full mt-6",children:[m.jsxs("div",{className:"flex pb-1 flex-col items-start gap-1 self-stretch",children:[m.jsxs("div",{className:"text-text-primary font-roboto text-[16px] font-bold leading-[26px]",children:["Permanent Address ",m.jsx("span",{className:"font-normal text-[13px] text-text-muted",children:"(as per ID)"})]}),m.jsx("div",{className:"self-stretch text-text-muted font-roboto text-[13px] font-normal leading-5",children:"Enter your permanent address exactly as shown on your government-issued ID."})]}),m.jsxs("div",{className:"flex flex-col items-start self-stretch w-full",children:[m.jsx("div",{className:"flex h-auto items-start gap-4 self-stretch w-full",children:m.jsxs("div",{className:"flex flex-col items-start flex-1 w-full",children:[m.jsx("div",{className:"flex pb-2 items-start gap-2 self-stretch",children:m.jsx("div",{className:"flex h-2.5 flex-col justify-center flex-1 text-text-primary font-roboto text-[13px] font-normal leading-[18px]",children:m.jsxs("span",{className:"text-text-primary",children:["Permanent Address ",m.jsx(d,{show:u("permanentAddress")})]})})}),m.jsx("div",{className:`flex h-[38px] py-[15px] px-3 justify-between items-center self-stretch rounded border ${N.permanentAddress?"border-destructive":"border-input-border"} bg-background w-full`,children:m.jsx("div",{className:"flex items-center gap-2 flex-1",children:m.jsx("input",{type:"text",placeholder:"e.g 456 Park Street, Gandhi Nagar, Near Mall",...y("permanentAddress"),"aria-invalid":!!N.permanentAddress,"aria-describedby":N.permanentAddress?"err-permanentAddress":void 0,className:"text-text-muted font-roboto text-[13px] font-normal leading-5 w-full bg-transparent border-none outline-none placeholder:text-text-muted"})})}),N.permanentAddress&&m.jsx("div",{id:"err-permanentAddress",role:"alert",className:"text-destructive text-[12px] mt-1",children:N.permanentAddress.message})]})}),m.jsxs("div",{className:"inline-flex flex-col sm:flex-row items-start gap-4 sm:gap-6 w-full mt-6",children:[m.jsxs("div",{className:"flex flex-col items-start w-full sm:flex-1",children:[m.jsx("div",{className:"flex pb-2 items-start gap-2 self-stretch",children:m.jsx("div",{className:"flex h-2.5 flex-col justify-center flex-1 text-text-primary font-roboto text-[13px] font-normal leading-[18px]",children:m.jsxs("span",{className:"text-text-primary",children:["Permanent City ",m.jsx(d,{show:u("permanentCity")})]})})}),m.jsx("div",{className:`flex h-[38px] py-[15px] px-3 justify-between items-center self-stretch rounded border ${N.permanentCity?"border-destructive":"border-input-border"} bg-background w-full`,children:m.jsx("div",{className:"flex items-center gap-2 flex-1",children:m.jsx("input",{type:"text",placeholder:"e.g Delhi",...y("permanentCity"),"aria-invalid":!!N.permanentCity,"aria-describedby":N.permanentCity?"err-permanentCity":void 0,className:"text-text-muted font-roboto text-[13px] font-normal leading-5 w-full bg-transparent border-none outline-none placeholder:text-text-muted"})})}),N.permanentCity&&m.jsx("div",{id:"err-permanentCity",role:"alert",className:"text-destructive text-[12px] mt-1",children:N.permanentCity.message})]}),m.jsxs("div",{className:"flex flex-col items-start w-full sm:flex-1",children:[m.jsx("div",{className:"flex pb-2 items-start gap-2 self-stretch",children:m.jsx("div",{className:"flex h-2.5 flex-col justify-center flex-1 text-text-primary font-roboto text-[13px] font-normal leading-[18px]",children:m.jsxs("span",{className:"text-text-primary",children:["Permanent Postal Code ",m.jsx(d,{show:u("permanentPostalCode")})]})})}),m.jsx("div",{className:`flex h-[38px] py-[15px] px-3 justify-between items-center self-stretch rounded border ${N.permanentPostalCode?"border-destructive":"border-input-border"} bg-background w-full`,children:m.jsx("div",{className:"flex items-center gap-2 flex-1",children:m.jsx("input",{type:"text",placeholder:"e.g 110001",...y("permanentPostalCode"),"aria-invalid":!!N.permanentPostalCode,"aria-describedby":N.permanentPostalCode?"err-permanentPostalCode":void 0,className:"text-text-muted font-roboto text-[13px] font-normal leading-5 w-full bg-transparent border-none outline-none placeholder:text-text-muted"})})}),N.permanentPostalCode&&m.jsx("div",{id:"err-permanentPostalCode",role:"alert",className:"text-destructive text-[12px] mt-1",children:N.permanentPostalCode.message})]})]})]})]})]})})})}const Pv=(n,e)=>{const t=e.toLowerCase().replace(/\s+/g,"_"),s={India:"IN","United States":"US","United Kingdom":"GB"}[n];if(!s)return console.warn(`Country "${n}" not found in mapping, using fallback ID`),"7579ebab-673f-401e-9395-075e9addf4a7";if(s==="IN"){const i={aadhaar_card:"7579ebab-673f-401e-9395-075e9addf4a7",voter_id:"7579ebab-673f-401e-9395-075e9addf4a7",passport:"7579ebab-673f-401e-9395-075e9addf4a7",indian_passport:"7579ebab-673f-401e-9395-075e9addf4a7",pan_card:"7579ebab-673f-401e-9395-075e9addf4a7",driving_license:"ffb98e04-4477-418b-b17e-e4e718d7f694",driver_license:"ffb98e04-4477-418b-b17e-e4e718d7f694"}[t];if(i)return console.log(`Selected document: ${e} (${t}) -> ID: ${i}`),i}return console.warn(`Document "${e}" not found for country "${n}", using fallback ID`),"7579ebab-673f-401e-9395-075e9addf4a7"};function I$(){try{return typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)})}catch{return`dev-${Math.random().toString(36).slice(2)}`}}function Ov(){let n=null;try{n=localStorage.getItem("device_fingerprint_desktop")}catch{n=null}if(!n){n=I$();try{localStorage.setItem("device_fingerprint_desktop",n)}catch{}}return n}function Kh(){let n=null;try{n=localStorage.getItem("device_fingerprint_mobile")}catch{n=null}if(!n){n=I$();try{localStorage.setItem("device_fingerprint_mobile",n)}catch{}}return n}function zk(){return typeof window<"u"&&window.location.pathname.includes("/HandoffPage/")?Kh():Ov()}const pJ="https://idvapi-test.arconnet.com:1019";function mJ({isOpen:n,onClose:e,onSubmit:t,previousFileIds:r,onUploaded:s,submissionId:o,country:i="",selectedDocumentName:a="",documentConfig:l}){const{toast:c}=pd(),[u,d]=_.useState(null),[f,p]=_.useState(null),[x,v]=_.useState(null),[y,b]=_.useState(!1),[w,S]=_.useState(!1),[k,N]=_.useState({front:!1,back:!1}),[I,T]=_.useState(r||{}),F=_.useRef(null),R=_.useRef(null),D=(G,M)=>{if(!l||!l.supportedCountries)return null;const j=l.supportedCountries.find(V=>V.countryName===G);if(!j)return null;const z=j.documents.find(V=>typeof V=="string"?V===M:V.title===M);return z&&typeof z!="string"&&z.documentDefinitionId?z.documentDefinitionId:null};_.useEffect(()=>(x&&n?A():P(),()=>{P()}),[x,n]),_.useEffect(()=>{n||(P(),v(null),d(null),p(null),N({front:!1,back:!1}),b(!1))},[n]);const A=async()=>{try{const G=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}});F.current&&(F.current.srcObject=G,R.current=G),b(!1)}catch(G){console.error("Error accessing camera:",G),b(!0);let M="Unable to access camera. ",j="Camera Error";G.name==="NotAllowedError"?M+="Please allow camera permissions and try again.":G.name==="NotSecureError"||window.location.protocol!=="https:"?(j="HTTPS Required",M="Camera access requires HTTPS. Please use a secure connection or try file upload instead."):G.name==="NotFoundError"?M+="No camera device found.":G.name==="NotReadableError"?M+="Camera is being used by another application.":M+="Please try file upload instead.",c({title:j,description:M,variant:"destructive"})}},P=()=>{R.current&&(R.current.getTracks().forEach(G=>G.stop()),R.current=null),F.current&&(F.current.srcObject=null)},B=async G=>{if(!F.current)return;const M=document.createElement("canvas");M.width=F.current.videoWidth,M.height=F.current.videoHeight;const j=M.getContext("2d");j&&(j.drawImage(F.current,0,0,M.width,M.height),M.toBlob(z=>{if(z){const V=M.toDataURL("image/jpeg",.8),K={blob:z,dataUrl:V};G==="front"?d(K):p(K),v(null),P(),c({title:"Image Captured",description:`${G==="front"?"Front":"Back"} side captured successfully.`})}},"image/jpeg",.8))},L=async(G,M)=>{try{S(!0);const j=new FormData;j.append("File",G.blob,`${M}-document.jpg`);let z=D(i,a);z||(console.warn(`CameraDialog: Document definition ID not found in config for ${a}, using fallback mapping`),z=Pv(i,a)),j.append("DocumentDefinitionId",z),j.append("Bucket","string");const V=o?.toString()||"1";console.log("CameraDialog: Using UserTemplateSubmissionId:",V),console.log("CameraDialog: Using DocumentDefinitionId:",z,"for document:",a,"(country:",i,")"),j.append("UserTemplateSubmissionId",V);const K=`${pJ}/api/Files/upload`,J=zk(),oe=await fetch(K,{method:"POST",body:j,headers:{"X-Device-Fingerprint":J}});if(oe.ok){const Z=await oe.json().catch(()=>({})),de=Z&&Z.file&&typeof Z.file.id=="number"&&Z.file.id||typeof Z.id=="number"&&Z.id||Z&&Z.mapping&&typeof Z.mapping.fileId=="number"&&Z.mapping.fileId||null,pe=Z?.file?.eTag||null;de&&(T(Ce=>({...Ce,[M]:de})),s?.(M,de),pe&&o&&localStorage.setItem(`cameraUpload_${o}_${M}_eTag`,pe)),N(Ce=>({...Ce,[M]:!0})),c({title:"Upload Successful",description:`${M==="front"?"Front":"Back"} side uploaded successfully.`})}else throw new Error(`POST failed: ${oe.statusText}`)}catch(j){console.error(`Error uploading ${M} image:`,j),c({title:"Upload Failed",description:`Failed to upload ${M} side. Please try again.`,variant:"destructive"})}finally{S(!1)}},W=G=>{G==="front"?(d(null),N(M=>({...M,front:!1}))):(p(null),N(M=>({...M,back:!1})))},H=()=>{if(k.front||k.back){const G=(k.front?1:0)+(k.back?1:0);c({title:"Done",description:`Document${G>1?"s":""} uploaded successfully.`});const M=u?.dataUrl||f?.dataUrl;t(M,I)}};return n?x?m.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black",children:m.jsxs("div",{className:"relative w-full h-full flex flex-col",children:[m.jsxs("div",{className:"flex h-16 justify-between items-center px-6 bg-black/50 text-white",children:[m.jsxs("div",{className:"text-xl font-bold",children:["Capture ",x==="front"?"Front":"Back"," Side"]}),m.jsx("button",{onClick:()=>{v(null),P()},className:"flex w-8 h-8 justify-center items-center rounded-full bg-white/20 hover:bg-white/30",children:m.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M15 5L5 15M5 5L15 15",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),m.jsx("div",{className:"flex-1 flex items-center justify-center",children:y?m.jsxs("div",{className:"text-white text-center max-w-sm",children:[m.jsx("div",{className:"text-xl mb-4",children:" Camera Unavailable"}),m.jsx("div",{className:"text-sm opacity-90 mb-4",children:window.location.protocol!=="https:"?"Camera access requires HTTPS. Please use a secure connection or try uploading a file instead.":"Unable to access camera. Please check permissions or try uploading a file instead."})]}):m.jsxs("div",{className:"relative",children:[m.jsx("video",{ref:F,autoPlay:!0,playsInline:!0,className:"max-w-full max-h-[380px] rounded-lg"}),m.jsx("div",{className:"absolute inset-0 border-2 border-white/50 rounded-lg pointer-events-none"})]})}),m.jsx("div",{className:"flex justify-center pb-8",children:m.jsx("button",{onClick:()=>B(x),disabled:y,className:"flex w-16 h-16 justify-center items-center rounded-full bg-white hover:bg-gray-100 disabled:bg-gray-400 disabled:cursor-not-allowed",children:m.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M12 16C14.2091 16 16 14.2091 16 12C16 9.79086 14.2091 8 12 8C9.79086 8 8 9.79086 8 12C8 14.2091 9.79086 16 12 16Z",fill:"black"})})})})]})}):m.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:m.jsxs("div",{className:"flex w-[800px] max-w-[90vw] max-h-[90vh] flex-col items-start rounded-lg bg-white overflow-auto",children:[m.jsxs("div",{className:"flex h-[58px] justify-between items-center self-stretch border-b border-[#D0D4E4] px-6",children:[m.jsx("div",{className:"flex items-center gap-2",children:m.jsx("div",{className:"text-[#172B4D] font-figtree text-xl font-bold leading-[30px]",children:"Capture Documents"})}),m.jsx("button",{onClick:e,className:"flex w-8 h-8 justify-center items-center gap-2.5 rounded-full bg-white hover:bg-gray-50",children:m.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M15 5L5 15M5 5L15 15",stroke:"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),m.jsxs("div",{className:"flex p-6 flex-col items-center gap-6 self-stretch bg-white",children:[m.jsx("div",{className:"text-[#172B4D] text-center font-roboto text-lg font-medium",children:"Capture clear images of both front and back sides."}),m.jsxs("div",{className:"flex flex-col sm:flex-row h-auto sm:h-[320px] items-center gap-6 px-4 sm:px-0",children:[m.jsxs("div",{className:"flex flex-1 min-w-0 h-auto sm:h-[320px] flex-col items-start",children:[m.jsx("div",{className:"flex w-full h-auto sm:h-[272px] flex-col items-center gap-7 flex-shrink-0",children:m.jsx("div",{className:"flex h-[272px] flex-col items-start flex-shrink-0 self-stretch",children:m.jsx("div",{className:"flex justify-center items-center gap-2 flex-1 self-stretch",children:m.jsx("div",{className:`flex flex-col justify-center items-center gap-2 flex-1 self-stretch rounded-t-lg border-2 ${u?"border-green-500 bg-green-50":"border-dashed border-[#C3C6D4] bg-white"}`,children:m.jsx("div",{className:"flex w-full max-w-[326px] h-auto sm:h-[262px] flex-col justify-center items-center gap-2 p-4",children:u?m.jsxs("div",{className:"flex flex-col items-center gap-2",children:[m.jsx("img",{src:u.dataUrl,alt:"Front side captured",className:"max-w-full max-h-32 rounded"}),m.jsx("div",{className:"text-green-600 font-medium text-sm",children:" Front side captured"}),m.jsx("button",{onClick:()=>W("front"),className:"text-blue-600 text-xs hover:underline",children:"Retake"})]}):m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"flex w-[52px] h-[52px] p-2 justify-center items-center flex-shrink-0 rounded-full bg-[#F6F7FB]",children:m.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 25",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("path",{d:"M1.99805 8.87722C1.99805 8.5269 1.99805 8.35174 2.01267 8.20421C2.15365 6.78127 3.27932 5.6556 4.70226 5.51462C4.84979 5.5 5.03441 5.5 5.40363 5.5C5.5459 5.5 5.61704 5.5 5.67744 5.49634C6.44866 5.44963 7.124 4.96288 7.41219 4.246C7.43476 4.18986 7.45586 4.12657 7.49805 4C7.54024 3.87343 7.56134 3.81014 7.58391 3.754C7.8721 3.03712 8.54744 2.55037 9.31866 2.50366C9.37906 2.5 9.44577 2.5 9.57919 2.5H14.4169C14.5503 2.5 14.617 2.5 14.6774 2.50366C15.4486 2.55037 16.124 3.03712 16.4121 3.754C16.4347 3.81014 16.4558 3.87343 16.498 4C16.5402 4.12657 16.5613 4.18986 16.5839 4.246C16.872 4.96288 17.5474 5.44963 18.3186 5.49634C18.379 5.5 18.4501 5.5 18.5924 5.5C18.9616 5.5 19.1463 5.5 19.2938 5.51462C20.7167 5.6556 21.8424 6.78127 21.9834 8.20421C21.998 8.35174 21.998 8.5269 21.998 8.87722V16.7C21.998 18.3802 21.998 19.2202 21.671 19.862C21.3834 20.4265 20.9245 20.8854 20.36 21.173C19.7182 21.5 18.8782 21.5 17.198 21.5H6.79805C5.11789 21.5 4.27781 21.5 3.63608 21.173C3.07159 20.8854 2.61265 20.4265 2.32503 19.862C1.99805 19.2202 1.99805 18.3802 1.99805 16.7V8.87722Z",stroke:"#676879",strokeWidth:"1.35",strokeLinecap:"round",strokeLinejoin:"round"}),m.jsx("path",{d:"M11.998 17C14.2071 17 15.998 15.2091 15.998 13C15.998 10.7909 14.2071 9 11.998 9C9.78891 9 7.99805 10.7909 7.99805 13C7.99805 15.2091 9.78891 17 11.998 17Z",stroke:"#676879",strokeWidth:"1.35",strokeLinecap:"round",strokeLinejoin:"round"})]})}),m.jsx("div",{className:"self-stretch text-[#172B4D] text-center font-roboto text-lg font-medium",children:"Front side of your document"}),m.jsx("div",{className:"text-[#676879] font-roboto text-xs font-normal leading-5",children:"Ensure the front side is in frame and well-lit."})]})})})})})}),m.jsx("div",{className:"flex w-full sm:w-[364px] h-12 p-2 flex-col items-end gap-2 flex-shrink-0 rounded-b border-t-0 bg-[#F6F7FB]",children:u?k.front?m.jsxs("button",{disabled:!0,className:"flex h-8 px-3 py-[9px] justify-center items-center gap-2 flex-shrink-0 rounded bg-green-600",children:[m.jsx("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M6 9L8 11L12 7",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),m.jsx("span",{className:"text-white font-roboto text-[13px] font-medium",children:"Uploaded"})]}):m.jsx("button",{onClick:()=>L(u,"front"),disabled:w,className:"flex h-8 px-3 py-[9px] justify-center items-center gap-2 flex-shrink-0 rounded bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400",children:m.jsx("span",{className:"text-white font-roboto text-[13px] font-medium",children:w?"Uploading...":"Upload"})}):m.jsxs("button",{onClick:()=>v("front"),className:"flex h-8 px-3 py-[9px] justify-center items-center gap-2 flex-shrink-0 rounded bg-[#0073EA] hover:bg-[#0073EA]/90",children:[m.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("path",{d:"M1.5 6.28292C1.5 6.02018 1.5 5.8888 1.51097 5.77816C1.6167 4.71095 2.46095 3.8667 3.52816 3.76096C3.6388 3.75 3.77727 3.75 4.05419 3.75C4.16089 3.75 4.21424 3.75 4.25954 3.74725C4.83796 3.71222 5.34446 3.34716 5.56061 2.8095C5.57753 2.7674 5.59336 2.71993 5.625 2.625C5.65664 2.53007 5.67247 2.4826 5.68939 2.4405C5.90554 1.90284 6.41204 1.53778 6.99046 1.50274C7.03576 1.5 7.08579 1.5 7.18585 1.5H10.8142C10.9142 1.5 10.9643 1.5 11.0096 1.50274C11.588 1.53778 12.0945 1.90284 12.3106 2.4405C12.3275 2.4826 12.3434 2.53007 12.375 2.625C12.4066 2.71993 12.4225 2.7674 12.4394 2.8095C12.6555 3.34716 13.1621 3.71222 13.7405 3.74725C13.7858 3.75 13.8391 3.75 13.9458 3.75C14.2227 3.75 14.3612 3.75 14.4718 3.76096C15.539 3.8667 16.3833 4.71095 16.489 5.77816C16.5 5.8888 16.5 6.02018 16.5 6.28292V12.15C16.5 13.4102 16.5 14.0401 16.2548 14.5215C16.0391 14.9449 15.6949 15.2891 15.2715 15.5048C14.7901 15.75 14.1602 15.75 12.9 15.75H5.1C3.83988 15.75 3.20982 15.75 2.72852 15.5048C2.30516 15.2891 1.96095 14.9449 1.74524 14.5215C1.5 14.0401 1.5 13.4102 1.5 12.15V6.28292Z",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),m.jsx("path",{d:"M9 12.375C10.6568 12.375 12 11.0318 12 9.375C12 7.71817 10.6568 6.375 9 6.375C7.34314 6.375 6 7.71817 6 9.375C6 11.0318 7.34314 12.375 9 12.375Z",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),m.jsx("span",{className:"text-white font-roboto text-[13px] font-medium",children:"Capture"})]})})]}),m.jsxs("div",{className:"flex flex-1 min-w-0 h-auto sm:h-[320px] flex-col items-start",children:[m.jsx("div",{className:"flex w-full h-auto sm:h-[272px] flex-col items-center gap-7 flex-shrink-0",children:m.jsx("div",{className:"flex h-[272px] flex-col items-start flex-shrink-0 self-stretch",children:m.jsx("div",{className:"flex justify-center items-center gap-2 flex-1 self-stretch",children:m.jsx("div",{className:`flex flex-col justify-center items-center gap-2 flex-1 self-stretch rounded-t-lg border-2 ${f?"border-green-500 bg-green-50":"border-dashed border-[#C3C6D4] bg-white"}`,children:m.jsx("div",{className:"flex w-full max-w-[326px] h-auto sm:h-[262px] flex-col justify-center items-center gap-2 p-4",children:f?m.jsxs("div",{className:"flex flex-col items-center gap-2",children:[m.jsx("img",{src:f.dataUrl,alt:"Back side captured",className:"max-w-full max-h-32 rounded"}),m.jsx("div",{className:"text-green-600 font-medium text-sm",children:" Back side captured"}),m.jsx("button",{onClick:()=>W("back"),className:"text-blue-600 text-xs hover:underline",children:"Retake"})]}):m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"flex w-[52px] h-[52px] p-2 justify-center items-center flex-shrink-0 rounded-full bg-[#F6F7FB]",children:m.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 25",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("path",{d:"M1.99805 8.87722C1.99805 8.5269 1.99805 8.35174 2.01267 8.20421C2.15365 6.78127 3.27932 5.6556 4.70226 5.51462C4.84979 5.5 5.03441 5.5 5.40363 5.5C5.5459 5.5 5.61704 5.5 5.67744 5.49634C6.44866 5.44963 7.124 4.96288 7.41219 4.246C7.43476 4.18986 7.45586 4.12657 7.49805 4C7.54024 3.87343 7.56134 3.81014 7.58391 3.754C7.8721 3.03712 8.54744 2.55037 9.31866 2.50366C9.37906 2.5 9.44577 2.5 9.57919 2.5H14.4169C14.5503 2.5 14.617 2.5 14.6774 2.50366C15.4486 2.55037 16.124 3.03712 16.4121 3.754C16.4347 3.81014 16.4558 3.87343 16.498 4C16.5402 4.12657 16.5613 4.18986 16.5839 4.246C16.872 4.96288 17.5474 5.44963 18.3186 5.49634C18.379 5.5 18.4501 5.5 18.5924 5.5C18.9616 5.5 19.1463 5.5 19.2938 5.51462C20.7167 5.6556 21.8424 6.78127 21.9834 8.20421C21.998 8.35174 21.998 8.5269 21.998 8.87722V16.7C21.998 18.3802 21.998 19.2202 21.671 19.862C21.3834 20.4265 20.9245 20.8854 20.36 21.173C19.7182 21.5 18.8782 21.5 17.198 21.5H6.79805C5.11789 21.5 4.27781 21.5 3.63608 21.173C3.07159 20.8854 2.61265 20.4265 2.32503 19.862C1.99805 19.2202 1.99805 18.3802 1.99805 16.7V8.87722Z",stroke:"#676879",strokeWidth:"1.35",strokeLinecap:"round",strokeLinejoin:"round"}),m.jsx("path",{d:"M11.998 17C14.2071 17 15.998 15.2091 15.998 13C15.998 10.7909 14.2071 9 11.998 9C9.78891 9 7.99805 10.7909 7.99805 13C7.99805 15.2091 9.78891 17 11.998 17Z",stroke:"#676879",strokeWidth:"1.35",strokeLinecap:"round",strokeLinejoin:"round"})]})}),m.jsx("div",{className:"self-stretch text-[#172B4D] text-center font-roboto text-lg font-medium",children:"Back side of your document"}),m.jsx("div",{className:"text-[#676879] font-roboto text-xs font-normal leading-5",children:"Ensure the back side is in frame and clearly visible."})]})})})})})}),m.jsx("div",{className:"flex w-full sm:w-[364px] h-12 p-2 flex-col items-end gap-2 flex-shrink-0 rounded-b border-t-0 bg-[#F6F7FB]",children:f?k.back?m.jsxs("button",{disabled:!0,className:"flex h-8 px-3 py-[9px] justify-center items-center gap-2 flex-shrink-0 rounded bg-green-600",children:[m.jsx("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M6 9L8 11L12 7",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),m.jsx("span",{className:"text-white font-roboto text-[13px] font-medium",children:"Uploaded"})]}):m.jsx("button",{onClick:()=>L(f,"back"),disabled:w,className:"flex h-8 px-3 py-[9px] justify-center items-center gap-2 flex-shrink-0 rounded bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400",children:m.jsx("span",{className:"text-white font-roboto text-[13px] font-medium",children:w?"Uploading...":"Upload"})}):m.jsxs("button",{onClick:()=>v("back"),className:"flex h-8 px-3 py-[9px] justify-center items-center gap-2 flex-shrink-0 rounded bg-[#0073EA] hover:bg-[#0073EA]/90",children:[m.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("path",{d:"M1.5 6.28292C1.5 6.02018 1.5 5.8888 1.51097 5.77816C1.6167 4.71095 2.46095 3.8667 3.52816 3.76096C3.6388 3.75 3.77727 3.75 4.05419 3.75C4.16089 3.75 4.21424 3.75 4.25954 3.74725C4.83796 3.71222 5.34446 3.34716 5.56061 2.8095C5.57753 2.7674 5.59336 2.71993 5.625 2.625C5.65664 2.53007 5.67247 2.4826 5.68939 2.4405C5.90554 1.90284 6.41204 1.53778 6.99046 1.50274C7.03576 1.5 7.08579 1.5 7.18585 1.5H10.8142C10.9142 1.5 10.9643 1.5 11.0096 1.50274C11.588 1.53778 12.0945 1.90284 12.3106 2.4405C12.3275 2.4826 12.3434 2.53007 12.375 2.625C12.4066 2.71993 12.4225 2.7674 12.4394 2.8095C12.6555 3.34716 13.1621 3.71222 13.7405 3.74725C13.7858 3.75 13.8391 3.75 13.9458 3.75C14.2227 3.75 14.3612 3.75 14.4718 3.76096C15.539 3.8667 16.3833 4.71095 16.489 5.77816C16.5 5.8888 16.5 6.02018 16.5 6.28292V12.15C16.5 13.4102 16.5 14.0401 16.2548 14.5215C16.0391 14.9449 15.6949 15.2891 15.2715 15.5048C14.7901 15.75 14.1602 15.75 12.9 15.75H5.1C3.83988 15.75 3.20982 15.75 2.72852 15.5048C2.30516 15.2891 1.96095 14.9449 1.74524 14.5215C1.5 14.0401 1.5 13.4102 1.5 12.15V6.28292Z",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),m.jsx("path",{d:"M9 12.375C10.6568 12.375 12 11.0318 12 9.375C12 7.71817 10.6568 6.375 9 6.375C7.34314 6.375 6 7.71817 6 9.375C6 11.0318 7.34314 12.375 9 12.375Z",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),m.jsx("span",{className:"text-white font-roboto text-[13px] font-medium",children:"Capture"})]})})]})]})]}),m.jsx("div",{className:"flex h-[68px] justify-end items-center gap-2 self-stretch border-t border-[#D0D4E4] bg-white px-6",children:m.jsx("button",{onClick:H,disabled:!k.front&&!k.back,className:`flex h-[38px] px-4 py-[11px] justify-center items-center gap-2 rounded ${k.front||k.back?"bg-green-600 hover:bg-green-700":"bg-gray-400 cursor-not-allowed"}`,children:m.jsx("span",{className:"text-white font-roboto text-[13px] font-medium",children:"Submit"})})})]})}):null}function gJ({isOpen:n,onClose:e,onSubmit:t}){const[r,s]=_.useState(null),[o,i]=_.useState(null),a=_.useRef(null),l=_.useRef(null),[c,u]=_.useState(""),[d,f]=_.useState(""),p=5*1024*1024,x=["image/jpeg","image/png","application/pdf"],v=[".jpg",".jpeg",".png",".pdf"];if(!n)return null;const y=k=>{const N=x.includes(k.type)||v.some(T=>k.name.toLowerCase().endsWith(T)),I=k.size<=p;return{typeOk:N,sizeOk:I}},b=k=>{const N=k.target.files?.[0]||null;if(!N){s(null),u("");return}const{typeOk:I,sizeOk:T}=y(N);if(!I||!T){s(null),u("Invalid file. Allowed: JPG, JPEG, PNG, PDF. Max 5MB.");return}u(""),s(N)},w=k=>{const N=k.target.files?.[0]||null;if(!N){i(null),f("");return}const{typeOk:I,sizeOk:T}=y(N);if(!I||!T){i(null),f("Invalid file. Allowed: JPG, JPEG, PNG, PDF. Max 5MB.");return}f(""),i(N)},S=()=>{r&&o&&!c&&!d&&t(r,o)};return m.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:m.jsxs("div",{className:"flex w-[800px] max-w-[90vw] max-h-[90vh] flex-col items-start rounded-lg bg-white overflow-auto",children:[m.jsxs("div",{className:"flex h-[58px] justify-between items-center self-stretch border-b border-[#D0D4E4] px-6",children:[m.jsx("div",{className:"flex items-center gap-2",children:m.jsx("div",{className:"text-[#172B4D] font-figtree text-xl font-bold leading-[30px]",children:"Upload Documents"})}),m.jsx("button",{onClick:e,className:"flex w-8 h-8 justify-center items-center gap-2.5 rounded-full bg-white hover:bg-gray-50",children:m.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M15 5L5 15M5 5L15 15",stroke:"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),m.jsxs("div",{className:"flex p-6 flex-col items-center gap-6 self-stretch bg-white",children:[m.jsx("div",{className:"text-[#172B4D] text-center font-roboto text-lg font-medium",children:"Upload clear images of both front and back sides."}),m.jsxs("div",{className:"flex flex-col sm:flex-row h-auto sm:h-[320px] items-center gap-6 px-4 sm:px-0",children:[m.jsxs("div",{className:"flex flex-1 min-w-0 h-auto sm:h-[320px] flex-col items-start",children:[m.jsx("div",{className:"flex w-full h-auto sm:h-[272px] flex-col items-center gap-7 flex-shrink-0",children:m.jsx("div",{className:"flex h-auto sm:h-[272px] flex-col items-start flex-shrink-0 self-stretch",children:m.jsx("div",{className:"flex justify-center items-center gap-2 flex-1 self-stretch",children:m.jsxs("div",{className:"flex flex-col justify-end items-center gap-2 flex-1 self-stretch rounded-t-lg border-2 border-dashed border-[#C3C6D4] bg-white cursor-pointer hover:bg-gray-50",onClick:()=>a.current?.click(),children:[m.jsxs("div",{className:"flex w-full max-w-[326px] h-auto sm:h-[262px] flex-col justify-center items-center gap-2",children:[m.jsx("div",{className:"flex w-12 h-12 p-2 justify-center items-center flex-shrink-0 rounded-full bg-[#F6F7FB]",children:m.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M7.76471 11.5294C6.88944 11.5294 6.4518 11.5294 6.09274 11.6256C5.11837 11.8867 4.35729 12.6478 4.09621 13.6221C4 13.9812 4 14.4188 4 15.2941V16.4235C4 18.0049 4 18.7955 4.30775 19.3995C4.57845 19.9308 5.01039 20.3627 5.54168 20.6334C6.14566 20.9412 6.93632 20.9412 8.51765 20.9412H16.4235C18.0049 20.9412 18.7955 20.9412 19.3995 20.6334C19.9308 20.3627 20.3627 19.9308 20.6334 19.3995C20.9412 18.7955 20.9412 18.0049 20.9412 16.4235V15.2941C20.9412 14.4188 20.9412 13.9812 20.845 13.6221C20.5839 12.6478 19.8228 11.8867 18.8485 11.6256C18.4894 11.5294 18.0518 11.5294 17.1765 11.5294M16.2353 7.76471L12.4706 4M12.4706 4L8.70588 7.76471M12.4706 4V15.2941",stroke:"#676879",strokeWidth:"1.41176",strokeLinecap:"round",strokeLinejoin:"round"})})}),m.jsx("div",{className:"self-stretch text-[#172B4D] text-center font-roboto text-lg font-medium",children:"Front side of your document"}),m.jsxs("div",{className:"text-center font-roboto text-[13px] font-medium",children:[m.jsxs("span",{className:"text-[#172B4D]",children:["Drag & Drop File Here or"," "]}),m.jsx("span",{className:"text-[#0073EA]",children:"Choose File"})]})]}),m.jsx("input",{ref:a,type:"file",accept:"image/jpeg,image/png,application/pdf",onChange:b,className:"hidden"})]})})})}),m.jsx("div",{className:"flex h-12 px-4 justify-center items-end gap-2 flex-shrink-0 self-stretch rounded-b bg-[#F6F7FB]",children:m.jsxs("div",{className:"flex justify-between items-center flex-1 self-stretch",children:[m.jsx("div",{className:"text-[#676879] font-roboto text-xs font-normal leading-5",children:"Supported Formats: JPG, JPEG, PNG, PDF"}),m.jsx("div",{className:"text-[#676879] font-roboto text-xs font-normal leading-5",children:"Maximum Size: 5MB"})]})})]}),m.jsxs("div",{className:"flex flex-1 min-w-0 h-auto sm:h-[320px] flex-col items-start",children:[m.jsx("div",{className:"flex w-full h-auto sm:h-[272px] flex-col items-center gap-7 flex-shrink-0",children:m.jsx("div",{className:"flex h-auto sm:h-[272px] flex-col items-start flex-shrink-0 self-stretch",children:m.jsx("div",{className:"flex justify-center items-center gap-2 flex-1 self-stretch",children:m.jsxs("div",{className:"flex flex-col justify-end items-center gap-2 flex-1 self-stretch rounded-t-lg border-2 border-dashed border-[#C3C6D4] bg-white cursor-pointer hover:bg-gray-50",onClick:()=>l.current?.click(),children:[m.jsxs("div",{className:"flex w-full max-w-[326px] h-auto sm:h-[262px] flex-col justify-center items-center gap-2",children:[m.jsx("div",{className:"flex w-12 h-12 p-2 justify-center items-center flex-shrink-0 rounded-full bg-[#F6F7FB]",children:m.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M7.76471 11.5294C6.88944 11.5294 6.4518 11.5294 6.09274 11.6256C5.11837 11.8867 4.35729 12.6478 4.09621 13.6221C4 13.9812 4 14.4188 4 15.2941V16.4235C4 18.0049 4 18.7955 4.30775 19.3995C4.57845 19.9308 5.01039 20.3627 5.54168 20.6334C6.14566 20.9412 6.93632 20.9412 8.51765 20.9412H16.4235C18.0049 20.9412 18.7955 20.9412 19.3995 20.6334C19.9308 20.3627 20.3627 19.9308 20.6334 19.3995C20.9412 18.7955 20.9412 18.0049 20.9412 16.4235V15.2941C20.9412 14.4188 20.9412 13.9812 20.845 13.6221C20.5839 12.6478 19.8228 11.8867 18.8485 11.6256C18.4894 11.5294 18.0518 11.5294 17.1765 11.5294M16.2353 7.76471L12.4706 4M12.4706 4L8.70588 7.76471M12.4706 4V15.2941",stroke:"#676879",strokeWidth:"1.41176",strokeLinecap:"round",strokeLinejoin:"round"})})}),m.jsx("div",{className:"self-stretch text-[#172B4D] text-center font-roboto text-lg font-medium",children:"Back side of your document"}),m.jsxs("div",{className:"text-center font-roboto text-[13px] font-medium",children:[m.jsxs("span",{className:"text-[#172B4D]",children:["Drag & Drop File Here or"," "]}),m.jsx("span",{className:"text-[#0073EA]",children:"Choose File"})]})]}),m.jsx("input",{ref:l,type:"file",accept:"image/jpeg,image/png,application/pdf",onChange:w,className:"hidden"})]})})})}),m.jsx("div",{className:"flex h-12 px-4 justify-center items-end gap-2 flex-shrink-0 self-stretch rounded-b bg-[#F6F7FB]",children:m.jsxs("div",{className:"flex justify-between items-center flex-1 self-stretch",children:[m.jsx("div",{className:"text-[#676879] font-roboto text-xs font-normal leading-5",children:"Supported Formats: JPG, JPEG, PNG, PDF"}),m.jsx("div",{className:"text-[#676879] font-roboto text-xs font-normal leading-5",children:"Maximum Size: 5MB"})]})})]})]})]}),m.jsxs("div",{className:"flex h-[68px] justify-between items-center gap-2 self-stretch border-t border-[#D0D4E4] bg-white px-6",children:[(c||d)&&m.jsx("div",{className:"text-destructive text-xs",children:c||d}),m.jsx("button",{onClick:S,disabled:!r||!o||!!c||!!d,className:`flex h-[38px] px-4 py-[11px] justify-center items-center gap-2 rounded ${r&&o&&!c&&!d?"bg-[#0073EA] hover:bg-[#0073EA]/90":"bg-[#0073EA]/50 cursor-not-allowed"}`,children:m.jsx("span",{className:"text-white font-roboto text-[13px] font-medium",children:"Submit"})})]})]})})}const xJ=({width:n=64,height:e=16})=>m.jsx("svg",{width:n,height:e,viewBox:"0 0 64 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M19.6451 6.27505C20.4605 5.29486 21.4477 4.80469 22.6065 4.80469C23.2074 4.80469 23.76 4.97008 24.2643 5.30072C24.7686 5.63143 25.1548 6.05658 25.4231 6.57622L25.5679 4.96414H27.6281V14.7073H25.5679L25.4231 13.0776C25.1548 13.5972 24.7686 14.0224 24.2643 14.353C23.76 14.6837 23.2074 14.8491 22.6065 14.8491C21.4477 14.8491 20.4605 14.359 19.6451 13.3787C18.8296 12.3867 18.4219 11.1998 18.4219 9.81804C18.4219 8.43624 18.8296 7.25524 19.6451 6.27505ZM21.3833 11.625C21.8339 12.1327 22.3812 12.3867 23.025 12.3867C23.6795 12.3867 24.2321 12.1387 24.6827 11.6426C25.1334 11.1348 25.3587 10.5266 25.3587 9.81804C25.3587 9.10947 25.1334 8.50713 24.6827 8.0111C24.2321 7.50326 23.6795 7.24938 23.025 7.24938C22.3812 7.24938 21.8339 7.50326 21.3833 8.0111C20.9327 8.50713 20.7073 9.10947 20.7073 9.81804C20.7073 10.5266 20.9327 11.1289 21.3833 11.625Z",fill:"#323238"})}),vJ=({width:n=80,height:e=23})=>m.jsxs("svg",{width:n,height:e,viewBox:"0 0 80 23",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("g",{clipPath:"url(#clip0_2641_13989)",children:m.jsx("path",{d:"M1.79875 10.2148C1.79875 8.97716 1.17188 7.95455 0 7.0957H2.72375C3.2039 7.46144 3.59293 7.93332 3.86041 8.47442C4.1279 9.01552 4.26659 9.61118 4.26563 10.2148C4.26659 10.8184 4.1279 11.4141 3.86041 11.9552C3.59293 12.4963 3.2039 12.9682 2.72375 13.3339C3.60813 13.7027 4.11125 14.6028 4.11125 15.8911V18.3457H1.645V15.8911C1.645 14.664 1.05938 13.8052 0.000625 13.3345C1.1725 12.4751 1.79875 11.4524 1.79875 10.2148Z",fill:"black"})}),m.jsx("defs",{children:m.jsx("clipPath",{id:"clip0_2641_13989",children:m.jsx("rect",{width:"79.6875",height:"22.5",fill:"white"})})})]}),yJ=({width:n=70,height:e=64})=>m.jsxs("svg",{width:n,height:e,viewBox:"0 0 70 64",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("path",{d:"M31.8463 3.46168C33.5384 1.60417 36.4616 1.60417 38.1537 3.46168L39.7836 5.25035C40.9063 6.48258 42.6437 6.94814 44.2321 6.44234L46.5378 5.70813C48.9322 4.94566 51.4637 6.40722 52.0005 8.86205L52.5175 11.2259C52.8737 12.8544 54.1456 14.1263 55.7741 14.4825L58.1379 14.9995C60.5928 15.5363 62.0543 18.0678 61.2919 20.4622L60.5577 22.7679C60.0519 24.3563 60.5174 26.0937 61.7496 27.2164L63.5383 28.8461C65.3958 30.5384 65.3958 33.4616 63.5383 35.1539L61.7496 36.7836C60.5174 37.9063 60.0519 39.6437 60.5577 41.2321L61.2919 43.5378C62.0543 45.9322 60.5928 48.4637 58.1379 49.0005L55.7741 49.5175C54.1456 49.8737 52.8737 51.1456 52.5175 52.7741L52.0005 55.1379C51.4637 57.5928 48.9322 59.0543 46.5378 58.2919L44.2321 57.5577C42.6437 57.0519 40.9063 57.5174 39.7836 58.7496L38.1537 60.5383C36.4616 62.3958 33.5384 62.3958 31.8463 60.5383L30.2164 58.7496C29.0937 57.5174 27.3563 57.0519 25.7679 57.5577L23.4622 58.2919C21.0678 59.0543 18.5363 57.5928 17.9995 55.1379L17.4825 52.7741C17.1263 51.1456 15.8544 49.8737 14.2259 49.5175L11.8621 49.0005C9.40722 48.4637 7.9457 45.9322 8.70817 43.5378L9.44238 41.2321C9.94818 39.6437 9.48262 37.9063 8.25039 36.7836L6.46172 35.1539C4.60421 33.4616 4.60421 30.5384 6.46172 28.8461L8.25039 27.2164C9.48262 26.0937 9.94818 24.3563 9.44238 22.7679L8.70817 20.4622C7.9457 18.0678 9.40722 15.5363 11.8621 14.9995L14.2259 14.4825C15.8544 14.1263 17.1263 12.8544 17.4825 11.2259L17.9995 8.86205C18.5363 6.40722 21.0678 4.94566 23.4622 5.70813L25.7679 6.44234C27.3563 6.94814 29.0937 6.48258 30.2164 5.25035L31.8463 3.46168Z",fill:"#258750"}),m.jsx("path",{d:"M47.8 24.533L31.6667 40.6663L24.3333 33.333",stroke:"white",strokeWidth:"3.52",strokeLinecap:"round",strokeLinejoin:"round"})]}),bJ=({className:n})=>m.jsx("svg",{className:n,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})}),Wk=({className:n})=>m.jsxs("svg",{className:n,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[m.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),m.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})]}),T$=({width:n=12,height:e=12})=>m.jsxs("svg",{width:n,height:e,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("path",{d:"M3.5 3.5L12.5 12.5",stroke:"#666",strokeWidth:"1.5",strokeLinecap:"round"}),m.jsx("path",{d:"M12.5 3.5L3.5 12.5",stroke:"#666",strokeWidth:"1.5",strokeLinecap:"round"})]});var Oh={},oC,u9;function wJ(){return u9||(u9=1,oC=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then}),oC}var iC={},$u={},d9;function Bf(){if(d9)return $u;d9=1;let n;const e=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];return $u.getSymbolSize=function(r){if(!r)throw new Error('"version" cannot be null or undefined');if(r<1||r>40)throw new Error('"version" should be in range from 1 to 40');return r*4+17},$u.getSymbolTotalCodewords=function(r){return e[r]},$u.getBCHDigit=function(t){let r=0;for(;t!==0;)r++,t>>>=1;return r},$u.setToSJISFunction=function(r){if(typeof r!="function")throw new Error('"toSJISFunc" is not a valid function.');n=r},$u.isKanjiModeEnabled=function(){return typeof n<"u"},$u.toSJIS=function(r){return n(r)},$u}var aC={},f9;function Uk(){return f9||(f9=1,(function(n){n.L={bit:1},n.M={bit:0},n.Q={bit:3},n.H={bit:2};function e(t){if(typeof t!="string")throw new Error("Param is not a string");switch(t.toLowerCase()){case"l":case"low":return n.L;case"m":case"medium":return n.M;case"q":case"quartile":return n.Q;case"h":case"high":return n.H;default:throw new Error("Unknown EC Level: "+t)}}n.isValid=function(r){return r&&typeof r.bit<"u"&&r.bit>=0&&r.bit<4},n.from=function(r,s){if(n.isValid(r))return r;try{return e(r)}catch{return s}}})(aC)),aC}var lC,h9;function CJ(){if(h9)return lC;h9=1;function n(){this.buffer=[],this.length=0}return n.prototype={get:function(e){const t=Math.floor(e/8);return(this.buffer[t]>>>7-e%8&1)===1},put:function(e,t){for(let r=0;r<t;r++)this.putBit((e>>>t-r-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(e){const t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}},lC=n,lC}var cC,p9;function kJ(){if(p9)return cC;p9=1;function n(e){if(!e||e<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=e,this.data=new Uint8Array(e*e),this.reservedBit=new Uint8Array(e*e)}return n.prototype.set=function(e,t,r,s){const o=e*this.size+t;this.data[o]=r,s&&(this.reservedBit[o]=!0)},n.prototype.get=function(e,t){return this.data[e*this.size+t]},n.prototype.xor=function(e,t,r){this.data[e*this.size+t]^=r},n.prototype.isReserved=function(e,t){return this.reservedBit[e*this.size+t]},cC=n,cC}var uC={},m9;function SJ(){return m9||(m9=1,(function(n){const e=Bf().getSymbolSize;n.getRowColCoords=function(r){if(r===1)return[];const s=Math.floor(r/7)+2,o=e(r),i=o===145?26:Math.ceil((o-13)/(2*s-2))*2,a=[o-7];for(let l=1;l<s-1;l++)a[l]=a[l-1]-i;return a.push(6),a.reverse()},n.getPositions=function(r){const s=[],o=n.getRowColCoords(r),i=o.length;for(let a=0;a<i;a++)for(let l=0;l<i;l++)a===0&&l===0||a===0&&l===i-1||a===i-1&&l===0||s.push([o[a],o[l]]);return s}})(uC)),uC}var dC={},g9;function NJ(){if(g9)return dC;g9=1;const n=Bf().getSymbolSize,e=7;return dC.getPositions=function(r){const s=n(r);return[[0,0],[s-e,0],[0,s-e]]},dC}var fC={},x9;function EJ(){return x9||(x9=1,(function(n){n.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const e={N1:3,N2:3,N3:40,N4:10};n.isValid=function(s){return s!=null&&s!==""&&!isNaN(s)&&s>=0&&s<=7},n.from=function(s){return n.isValid(s)?parseInt(s,10):void 0},n.getPenaltyN1=function(s){const o=s.size;let i=0,a=0,l=0,c=null,u=null;for(let d=0;d<o;d++){a=l=0,c=u=null;for(let f=0;f<o;f++){let p=s.get(d,f);p===c?a++:(a>=5&&(i+=e.N1+(a-5)),c=p,a=1),p=s.get(f,d),p===u?l++:(l>=5&&(i+=e.N1+(l-5)),u=p,l=1)}a>=5&&(i+=e.N1+(a-5)),l>=5&&(i+=e.N1+(l-5))}return i},n.getPenaltyN2=function(s){const o=s.size;let i=0;for(let a=0;a<o-1;a++)for(let l=0;l<o-1;l++){const c=s.get(a,l)+s.get(a,l+1)+s.get(a+1,l)+s.get(a+1,l+1);(c===4||c===0)&&i++}return i*e.N2},n.getPenaltyN3=function(s){const o=s.size;let i=0,a=0,l=0;for(let c=0;c<o;c++){a=l=0;for(let u=0;u<o;u++)a=a<<1&2047|s.get(c,u),u>=10&&(a===1488||a===93)&&i++,l=l<<1&2047|s.get(u,c),u>=10&&(l===1488||l===93)&&i++}return i*e.N3},n.getPenaltyN4=function(s){let o=0;const i=s.data.length;for(let l=0;l<i;l++)o+=s.data[l];return Math.abs(Math.ceil(o*100/i/5)-10)*e.N4};function t(r,s,o){switch(r){case n.Patterns.PATTERN000:return(s+o)%2===0;case n.Patterns.PATTERN001:return s%2===0;case n.Patterns.PATTERN010:return o%3===0;case n.Patterns.PATTERN011:return(s+o)%3===0;case n.Patterns.PATTERN100:return(Math.floor(s/2)+Math.floor(o/3))%2===0;case n.Patterns.PATTERN101:return s*o%2+s*o%3===0;case n.Patterns.PATTERN110:return(s*o%2+s*o%3)%2===0;case n.Patterns.PATTERN111:return(s*o%3+(s+o)%2)%2===0;default:throw new Error("bad maskPattern:"+r)}}n.applyMask=function(s,o){const i=o.size;for(let a=0;a<i;a++)for(let l=0;l<i;l++)o.isReserved(l,a)||o.xor(l,a,t(s,l,a))},n.getBestMask=function(s,o){const i=Object.keys(n.Patterns).length;let a=0,l=1/0;for(let c=0;c<i;c++){o(c),n.applyMask(c,s);const u=n.getPenaltyN1(s)+n.getPenaltyN2(s)+n.getPenaltyN3(s)+n.getPenaltyN4(s);n.applyMask(c,s),u<l&&(l=u,a=c)}return a}})(fC)),fC}var Zx={},v9;function _$(){if(v9)return Zx;v9=1;const n=Uk(),e=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],t=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];return Zx.getBlocksCount=function(s,o){switch(o){case n.L:return e[(s-1)*4+0];case n.M:return e[(s-1)*4+1];case n.Q:return e[(s-1)*4+2];case n.H:return e[(s-1)*4+3];default:return}},Zx.getTotalCodewordsCount=function(s,o){switch(o){case n.L:return t[(s-1)*4+0];case n.M:return t[(s-1)*4+1];case n.Q:return t[(s-1)*4+2];case n.H:return t[(s-1)*4+3];default:return}},Zx}var hC={},Um={},y9;function IJ(){if(y9)return Um;y9=1;const n=new Uint8Array(512),e=new Uint8Array(256);return(function(){let r=1;for(let s=0;s<255;s++)n[s]=r,e[r]=s,r<<=1,r&256&&(r^=285);for(let s=255;s<512;s++)n[s]=n[s-255]})(),Um.log=function(r){if(r<1)throw new Error("log("+r+")");return e[r]},Um.exp=function(r){return n[r]},Um.mul=function(r,s){return r===0||s===0?0:n[e[r]+e[s]]},Um}var b9;function TJ(){return b9||(b9=1,(function(n){const e=IJ();n.mul=function(r,s){const o=new Uint8Array(r.length+s.length-1);for(let i=0;i<r.length;i++)for(let a=0;a<s.length;a++)o[i+a]^=e.mul(r[i],s[a]);return o},n.mod=function(r,s){let o=new Uint8Array(r);for(;o.length-s.length>=0;){const i=o[0];for(let l=0;l<s.length;l++)o[l]^=e.mul(s[l],i);let a=0;for(;a<o.length&&o[a]===0;)a++;o=o.slice(a)}return o},n.generateECPolynomial=function(r){let s=new Uint8Array([1]);for(let o=0;o<r;o++)s=n.mul(s,new Uint8Array([1,e.exp(o)]));return s}})(hC)),hC}var pC,w9;function _J(){if(w9)return pC;w9=1;const n=TJ();function e(t){this.genPoly=void 0,this.degree=t,this.degree&&this.initialize(this.degree)}return e.prototype.initialize=function(r){this.degree=r,this.genPoly=n.generateECPolynomial(this.degree)},e.prototype.encode=function(r){if(!this.genPoly)throw new Error("Encoder not initialized");const s=new Uint8Array(r.length+this.degree);s.set(r);const o=n.mod(s,this.genPoly),i=this.degree-o.length;if(i>0){const a=new Uint8Array(this.degree);return a.set(o,i),a}return o},pC=e,pC}var mC={},gC={},xC={},C9;function R$(){return C9||(C9=1,xC.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40}),xC}var Al={},k9;function D$(){if(k9)return Al;k9=1;const n="[0-9]+",e="[A-Z $%*+\\-./:]+";let t="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";t=t.replace(/u/g,"\\u");const r="(?:(?![A-Z0-9 $%*+\\-./:]|"+t+`)(?:.|[\r
]))+`;Al.KANJI=new RegExp(t,"g"),Al.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),Al.BYTE=new RegExp(r,"g"),Al.NUMERIC=new RegExp(n,"g"),Al.ALPHANUMERIC=new RegExp(e,"g");const s=new RegExp("^"+t+"$"),o=new RegExp("^"+n+"$"),i=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");return Al.testKanji=function(l){return s.test(l)},Al.testNumeric=function(l){return o.test(l)},Al.testAlphanumeric=function(l){return i.test(l)},Al}var S9;function Vf(){return S9||(S9=1,(function(n){const e=R$(),t=D$();n.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},n.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},n.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},n.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},n.MIXED={bit:-1},n.getCharCountIndicator=function(o,i){if(!o.ccBits)throw new Error("Invalid mode: "+o);if(!e.isValid(i))throw new Error("Invalid version: "+i);return i>=1&&i<10?o.ccBits[0]:i<27?o.ccBits[1]:o.ccBits[2]},n.getBestModeForData=function(o){return t.testNumeric(o)?n.NUMERIC:t.testAlphanumeric(o)?n.ALPHANUMERIC:t.testKanji(o)?n.KANJI:n.BYTE},n.toString=function(o){if(o&&o.id)return o.id;throw new Error("Invalid mode")},n.isValid=function(o){return o&&o.bit&&o.ccBits};function r(s){if(typeof s!="string")throw new Error("Param is not a string");switch(s.toLowerCase()){case"numeric":return n.NUMERIC;case"alphanumeric":return n.ALPHANUMERIC;case"kanji":return n.KANJI;case"byte":return n.BYTE;default:throw new Error("Unknown mode: "+s)}}n.from=function(o,i){if(n.isValid(o))return o;try{return r(o)}catch{return i}}})(gC)),gC}var N9;function RJ(){return N9||(N9=1,(function(n){const e=Bf(),t=_$(),r=Uk(),s=Vf(),o=R$(),i=7973,a=e.getBCHDigit(i);function l(f,p,x){for(let v=1;v<=40;v++)if(p<=n.getCapacity(v,x,f))return v}function c(f,p){return s.getCharCountIndicator(f,p)+4}function u(f,p){let x=0;return f.forEach(function(v){const y=c(v.mode,p);x+=y+v.getBitsLength()}),x}function d(f,p){for(let x=1;x<=40;x++)if(u(f,x)<=n.getCapacity(x,p,s.MIXED))return x}n.from=function(p,x){return o.isValid(p)?parseInt(p,10):x},n.getCapacity=function(p,x,v){if(!o.isValid(p))throw new Error("Invalid QR Code version");typeof v>"u"&&(v=s.BYTE);const y=e.getSymbolTotalCodewords(p),b=t.getTotalCodewordsCount(p,x),w=(y-b)*8;if(v===s.MIXED)return w;const S=w-c(v,p);switch(v){case s.NUMERIC:return Math.floor(S/10*3);case s.ALPHANUMERIC:return Math.floor(S/11*2);case s.KANJI:return Math.floor(S/13);case s.BYTE:default:return Math.floor(S/8)}},n.getBestVersionForData=function(p,x){let v;const y=r.from(x,r.M);if(Array.isArray(p)){if(p.length>1)return d(p,y);if(p.length===0)return 1;v=p[0]}else v=p;return l(v.mode,v.getLength(),y)},n.getEncodedBits=function(p){if(!o.isValid(p)||p<7)throw new Error("Invalid QR Code version");let x=p<<12;for(;e.getBCHDigit(x)-a>=0;)x^=i<<e.getBCHDigit(x)-a;return p<<12|x}})(mC)),mC}var vC={},E9;function DJ(){if(E9)return vC;E9=1;const n=Bf(),e=1335,t=21522,r=n.getBCHDigit(e);return vC.getEncodedBits=function(o,i){const a=o.bit<<3|i;let l=a<<10;for(;n.getBCHDigit(l)-r>=0;)l^=e<<n.getBCHDigit(l)-r;return(a<<10|l)^t},vC}var yC={},bC,I9;function AJ(){if(I9)return bC;I9=1;const n=Vf();function e(t){this.mode=n.NUMERIC,this.data=t.toString()}return e.getBitsLength=function(r){return 10*Math.floor(r/3)+(r%3?r%3*3+1:0)},e.prototype.getLength=function(){return this.data.length},e.prototype.getBitsLength=function(){return e.getBitsLength(this.data.length)},e.prototype.write=function(r){let s,o,i;for(s=0;s+3<=this.data.length;s+=3)o=this.data.substr(s,3),i=parseInt(o,10),r.put(i,10);const a=this.data.length-s;a>0&&(o=this.data.substr(s),i=parseInt(o,10),r.put(i,a*3+1))},bC=e,bC}var wC,T9;function $J(){if(T9)return wC;T9=1;const n=Vf(),e=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function t(r){this.mode=n.ALPHANUMERIC,this.data=r}return t.getBitsLength=function(s){return 11*Math.floor(s/2)+6*(s%2)},t.prototype.getLength=function(){return this.data.length},t.prototype.getBitsLength=function(){return t.getBitsLength(this.data.length)},t.prototype.write=function(s){let o;for(o=0;o+2<=this.data.length;o+=2){let i=e.indexOf(this.data[o])*45;i+=e.indexOf(this.data[o+1]),s.put(i,11)}this.data.length%2&&s.put(e.indexOf(this.data[o]),6)},wC=t,wC}var CC,_9;function FJ(){if(_9)return CC;_9=1;const n=Vf();function e(t){this.mode=n.BYTE,typeof t=="string"?this.data=new TextEncoder().encode(t):this.data=new Uint8Array(t)}return e.getBitsLength=function(r){return r*8},e.prototype.getLength=function(){return this.data.length},e.prototype.getBitsLength=function(){return e.getBitsLength(this.data.length)},e.prototype.write=function(t){for(let r=0,s=this.data.length;r<s;r++)t.put(this.data[r],8)},CC=e,CC}var kC,R9;function PJ(){if(R9)return kC;R9=1;const n=Vf(),e=Bf();function t(r){this.mode=n.KANJI,this.data=r}return t.getBitsLength=function(s){return s*13},t.prototype.getLength=function(){return this.data.length},t.prototype.getBitsLength=function(){return t.getBitsLength(this.data.length)},t.prototype.write=function(r){let s;for(s=0;s<this.data.length;s++){let o=e.toSJIS(this.data[s]);if(o>=33088&&o<=40956)o-=33088;else if(o>=57408&&o<=60351)o-=49472;else throw new Error("Invalid SJIS character: "+this.data[s]+`
Make sure your charset is UTF-8`);o=(o>>>8&255)*192+(o&255),r.put(o,13)}},kC=t,kC}var SC={exports:{}},D9;function OJ(){return D9||(D9=1,(function(n){var e={single_source_shortest_paths:function(t,r,s){var o={},i={};i[r]=0;var a=e.PriorityQueue.make();a.push(r,0);for(var l,c,u,d,f,p,x,v,y;!a.empty();){l=a.pop(),c=l.value,d=l.cost,f=t[c]||{};for(u in f)f.hasOwnProperty(u)&&(p=f[u],x=d+p,v=i[u],y=typeof i[u]>"u",(y||v>x)&&(i[u]=x,a.push(u,x),o[u]=c))}if(typeof s<"u"&&typeof i[s]>"u"){var b=["Could not find a path from ",r," to ",s,"."].join("");throw new Error(b)}return o},extract_shortest_path_from_predecessor_list:function(t,r){for(var s=[],o=r;o;)s.push(o),t[o],o=t[o];return s.reverse(),s},find_path:function(t,r,s){var o=e.single_source_shortest_paths(t,r,s);return e.extract_shortest_path_from_predecessor_list(o,s)},PriorityQueue:{make:function(t){var r=e.PriorityQueue,s={},o;t=t||{};for(o in r)r.hasOwnProperty(o)&&(s[o]=r[o]);return s.queue=[],s.sorter=t.sorter||r.default_sorter,s},default_sorter:function(t,r){return t.cost-r.cost},push:function(t,r){var s={value:t,cost:r};this.queue.push(s),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};n.exports=e})(SC)),SC.exports}var A9;function MJ(){return A9||(A9=1,(function(n){const e=Vf(),t=AJ(),r=$J(),s=FJ(),o=PJ(),i=D$(),a=Bf(),l=OJ();function c(b){return unescape(encodeURIComponent(b)).length}function u(b,w,S){const k=[];let N;for(;(N=b.exec(S))!==null;)k.push({data:N[0],index:N.index,mode:w,length:N[0].length});return k}function d(b){const w=u(i.NUMERIC,e.NUMERIC,b),S=u(i.ALPHANUMERIC,e.ALPHANUMERIC,b);let k,N;return a.isKanjiModeEnabled()?(k=u(i.BYTE,e.BYTE,b),N=u(i.KANJI,e.KANJI,b)):(k=u(i.BYTE_KANJI,e.BYTE,b),N=[]),w.concat(S,k,N).sort(function(T,F){return T.index-F.index}).map(function(T){return{data:T.data,mode:T.mode,length:T.length}})}function f(b,w){switch(w){case e.NUMERIC:return t.getBitsLength(b);case e.ALPHANUMERIC:return r.getBitsLength(b);case e.KANJI:return o.getBitsLength(b);case e.BYTE:return s.getBitsLength(b)}}function p(b){return b.reduce(function(w,S){const k=w.length-1>=0?w[w.length-1]:null;return k&&k.mode===S.mode?(w[w.length-1].data+=S.data,w):(w.push(S),w)},[])}function x(b){const w=[];for(let S=0;S<b.length;S++){const k=b[S];switch(k.mode){case e.NUMERIC:w.push([k,{data:k.data,mode:e.ALPHANUMERIC,length:k.length},{data:k.data,mode:e.BYTE,length:k.length}]);break;case e.ALPHANUMERIC:w.push([k,{data:k.data,mode:e.BYTE,length:k.length}]);break;case e.KANJI:w.push([k,{data:k.data,mode:e.BYTE,length:c(k.data)}]);break;case e.BYTE:w.push([{data:k.data,mode:e.BYTE,length:c(k.data)}])}}return w}function v(b,w){const S={},k={start:{}};let N=["start"];for(let I=0;I<b.length;I++){const T=b[I],F=[];for(let R=0;R<T.length;R++){const D=T[R],A=""+I+R;F.push(A),S[A]={node:D,lastCount:0},k[A]={};for(let P=0;P<N.length;P++){const B=N[P];S[B]&&S[B].node.mode===D.mode?(k[B][A]=f(S[B].lastCount+D.length,D.mode)-f(S[B].lastCount,D.mode),S[B].lastCount+=D.length):(S[B]&&(S[B].lastCount=D.length),k[B][A]=f(D.length,D.mode)+4+e.getCharCountIndicator(D.mode,w))}}N=F}for(let I=0;I<N.length;I++)k[N[I]].end=0;return{map:k,table:S}}function y(b,w){let S;const k=e.getBestModeForData(b);if(S=e.from(w,k),S!==e.BYTE&&S.bit<k.bit)throw new Error('"'+b+'" cannot be encoded with mode '+e.toString(S)+`.
 Suggested mode is: `+e.toString(k));switch(S===e.KANJI&&!a.isKanjiModeEnabled()&&(S=e.BYTE),S){case e.NUMERIC:return new t(b);case e.ALPHANUMERIC:return new r(b);case e.KANJI:return new o(b);case e.BYTE:return new s(b)}}n.fromArray=function(w){return w.reduce(function(S,k){return typeof k=="string"?S.push(y(k,null)):k.data&&S.push(y(k.data,k.mode)),S},[])},n.fromString=function(w,S){const k=d(w,a.isKanjiModeEnabled()),N=x(k),I=v(N,S),T=l.find_path(I.map,"start","end"),F=[];for(let R=1;R<T.length-1;R++)F.push(I.table[T[R]].node);return n.fromArray(p(F))},n.rawSplit=function(w){return n.fromArray(d(w,a.isKanjiModeEnabled()))}})(yC)),yC}var $9;function LJ(){if($9)return iC;$9=1;const n=Bf(),e=Uk(),t=CJ(),r=kJ(),s=SJ(),o=NJ(),i=EJ(),a=_$(),l=_J(),c=RJ(),u=DJ(),d=Vf(),f=MJ();function p(I,T){const F=I.size,R=o.getPositions(T);for(let D=0;D<R.length;D++){const A=R[D][0],P=R[D][1];for(let B=-1;B<=7;B++)if(!(A+B<=-1||F<=A+B))for(let L=-1;L<=7;L++)P+L<=-1||F<=P+L||(B>=0&&B<=6&&(L===0||L===6)||L>=0&&L<=6&&(B===0||B===6)||B>=2&&B<=4&&L>=2&&L<=4?I.set(A+B,P+L,!0,!0):I.set(A+B,P+L,!1,!0))}}function x(I){const T=I.size;for(let F=8;F<T-8;F++){const R=F%2===0;I.set(F,6,R,!0),I.set(6,F,R,!0)}}function v(I,T){const F=s.getPositions(T);for(let R=0;R<F.length;R++){const D=F[R][0],A=F[R][1];for(let P=-2;P<=2;P++)for(let B=-2;B<=2;B++)P===-2||P===2||B===-2||B===2||P===0&&B===0?I.set(D+P,A+B,!0,!0):I.set(D+P,A+B,!1,!0)}}function y(I,T){const F=I.size,R=c.getEncodedBits(T);let D,A,P;for(let B=0;B<18;B++)D=Math.floor(B/3),A=B%3+F-8-3,P=(R>>B&1)===1,I.set(D,A,P,!0),I.set(A,D,P,!0)}function b(I,T,F){const R=I.size,D=u.getEncodedBits(T,F);let A,P;for(A=0;A<15;A++)P=(D>>A&1)===1,A<6?I.set(A,8,P,!0):A<8?I.set(A+1,8,P,!0):I.set(R-15+A,8,P,!0),A<8?I.set(8,R-A-1,P,!0):A<9?I.set(8,15-A-1+1,P,!0):I.set(8,15-A-1,P,!0);I.set(R-8,8,1,!0)}function w(I,T){const F=I.size;let R=-1,D=F-1,A=7,P=0;for(let B=F-1;B>0;B-=2)for(B===6&&B--;;){for(let L=0;L<2;L++)if(!I.isReserved(D,B-L)){let W=!1;P<T.length&&(W=(T[P]>>>A&1)===1),I.set(D,B-L,W),A--,A===-1&&(P++,A=7)}if(D+=R,D<0||F<=D){D-=R,R=-R;break}}}function S(I,T,F){const R=new t;F.forEach(function(L){R.put(L.mode.bit,4),R.put(L.getLength(),d.getCharCountIndicator(L.mode,I)),L.write(R)});const D=n.getSymbolTotalCodewords(I),A=a.getTotalCodewordsCount(I,T),P=(D-A)*8;for(R.getLengthInBits()+4<=P&&R.put(0,4);R.getLengthInBits()%8!==0;)R.putBit(0);const B=(P-R.getLengthInBits())/8;for(let L=0;L<B;L++)R.put(L%2?17:236,8);return k(R,I,T)}function k(I,T,F){const R=n.getSymbolTotalCodewords(T),D=a.getTotalCodewordsCount(T,F),A=R-D,P=a.getBlocksCount(T,F),B=R%P,L=P-B,W=Math.floor(R/P),H=Math.floor(A/P),G=H+1,M=W-H,j=new l(M);let z=0;const V=new Array(P),K=new Array(P);let J=0;const oe=new Uint8Array(I.buffer);for(let Ae=0;Ae<P;Ae++){const ze=Ae<L?H:G;V[Ae]=oe.slice(z,z+ze),K[Ae]=j.encode(V[Ae]),z+=ze,J=Math.max(J,ze)}const Z=new Uint8Array(R);let de=0,pe,Ce;for(pe=0;pe<J;pe++)for(Ce=0;Ce<P;Ce++)pe<V[Ce].length&&(Z[de++]=V[Ce][pe]);for(pe=0;pe<M;pe++)for(Ce=0;Ce<P;Ce++)Z[de++]=K[Ce][pe];return Z}function N(I,T,F,R){let D;if(Array.isArray(I))D=f.fromArray(I);else if(typeof I=="string"){let W=T;if(!W){const H=f.rawSplit(I);W=c.getBestVersionForData(H,F)}D=f.fromString(I,W||40)}else throw new Error("Invalid data");const A=c.getBestVersionForData(D,F);if(!A)throw new Error("The amount of data is too big to be stored in a QR Code");if(!T)T=A;else if(T<A)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+A+`.
`);const P=S(T,F,D),B=n.getSymbolSize(T),L=new r(B);return p(L,T),x(L),v(L,T),b(L,F,0),T>=7&&y(L,T),w(L,P),isNaN(R)&&(R=i.getBestMask(L,b.bind(null,L,F))),i.applyMask(R,L),b(L,F,R),{modules:L,version:T,errorCorrectionLevel:F,maskPattern:R,segments:D}}return iC.create=function(T,F){if(typeof T>"u"||T==="")throw new Error("No input text");let R=e.M,D,A;return typeof F<"u"&&(R=e.from(F.errorCorrectionLevel,e.M),D=c.from(F.version),A=i.from(F.maskPattern),F.toSJISFunc&&n.setToSJISFunction(F.toSJISFunc)),N(T,D,R,A)},iC}var NC={},EC={},F9;function A$(){return F9||(F9=1,(function(n){function e(t){if(typeof t=="number"&&(t=t.toString()),typeof t!="string")throw new Error("Color should be defined as hex string");let r=t.slice().replace("#","").split("");if(r.length<3||r.length===5||r.length>8)throw new Error("Invalid hex color: "+t);(r.length===3||r.length===4)&&(r=Array.prototype.concat.apply([],r.map(function(o){return[o,o]}))),r.length===6&&r.push("F","F");const s=parseInt(r.join(""),16);return{r:s>>24&255,g:s>>16&255,b:s>>8&255,a:s&255,hex:"#"+r.slice(0,6).join("")}}n.getOptions=function(r){r||(r={}),r.color||(r.color={});const s=typeof r.margin>"u"||r.margin===null||r.margin<0?4:r.margin,o=r.width&&r.width>=21?r.width:void 0,i=r.scale||4;return{width:o,scale:o?4:i,margin:s,color:{dark:e(r.color.dark||"#000000ff"),light:e(r.color.light||"#ffffffff")},type:r.type,rendererOpts:r.rendererOpts||{}}},n.getScale=function(r,s){return s.width&&s.width>=r+s.margin*2?s.width/(r+s.margin*2):s.scale},n.getImageWidth=function(r,s){const o=n.getScale(r,s);return Math.floor((r+s.margin*2)*o)},n.qrToImageData=function(r,s,o){const i=s.modules.size,a=s.modules.data,l=n.getScale(i,o),c=Math.floor((i+o.margin*2)*l),u=o.margin*l,d=[o.color.light,o.color.dark];for(let f=0;f<c;f++)for(let p=0;p<c;p++){let x=(f*c+p)*4,v=o.color.light;if(f>=u&&p>=u&&f<c-u&&p<c-u){const y=Math.floor((f-u)/l),b=Math.floor((p-u)/l);v=d[a[y*i+b]?1:0]}r[x++]=v.r,r[x++]=v.g,r[x++]=v.b,r[x]=v.a}}})(EC)),EC}var P9;function jJ(){return P9||(P9=1,(function(n){const e=A$();function t(s,o,i){s.clearRect(0,0,o.width,o.height),o.style||(o.style={}),o.height=i,o.width=i,o.style.height=i+"px",o.style.width=i+"px"}function r(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}n.render=function(o,i,a){let l=a,c=i;typeof l>"u"&&(!i||!i.getContext)&&(l=i,i=void 0),i||(c=r()),l=e.getOptions(l);const u=e.getImageWidth(o.modules.size,l),d=c.getContext("2d"),f=d.createImageData(u,u);return e.qrToImageData(f.data,o,l),t(d,c,u),d.putImageData(f,0,0),c},n.renderToDataURL=function(o,i,a){let l=a;typeof l>"u"&&(!i||!i.getContext)&&(l=i,i=void 0),l||(l={});const c=n.render(o,i,l),u=l.type||"image/png",d=l.rendererOpts||{};return c.toDataURL(u,d.quality)}})(NC)),NC}var IC={},O9;function BJ(){if(O9)return IC;O9=1;const n=A$();function e(s,o){const i=s.a/255,a=o+'="'+s.hex+'"';return i<1?a+" "+o+'-opacity="'+i.toFixed(2).slice(1)+'"':a}function t(s,o,i){let a=s+o;return typeof i<"u"&&(a+=" "+i),a}function r(s,o,i){let a="",l=0,c=!1,u=0;for(let d=0;d<s.length;d++){const f=Math.floor(d%o),p=Math.floor(d/o);!f&&!c&&(c=!0),s[d]?(u++,d>0&&f>0&&s[d-1]||(a+=c?t("M",f+i,.5+p+i):t("m",l,0),l=0,c=!1),f+1<o&&s[d+1]||(a+=t("h",u),u=0)):l++}return a}return IC.render=function(o,i,a){const l=n.getOptions(i),c=o.modules.size,u=o.modules.data,d=c+l.margin*2,f=l.color.light.a?"<path "+e(l.color.light,"fill")+' d="M0 0h'+d+"v"+d+'H0z"/>':"",p="<path "+e(l.color.dark,"stroke")+' d="'+r(u,c,l.margin)+'"/>',x='viewBox="0 0 '+d+" "+d+'"',y='<svg xmlns="http://www.w3.org/2000/svg" '+(l.width?'width="'+l.width+'" height="'+l.width+'" ':"")+x+' shape-rendering="crispEdges">'+f+p+`</svg>
`;return typeof a=="function"&&a(null,y),y},IC}var M9;function VJ(){if(M9)return Oh;M9=1;const n=wJ(),e=LJ(),t=jJ(),r=BJ();function s(o,i,a,l,c){const u=[].slice.call(arguments,1),d=u.length,f=typeof u[d-1]=="function";if(!f&&!n())throw new Error("Callback required as last argument");if(f){if(d<2)throw new Error("Too few arguments provided");d===2?(c=a,a=i,i=l=void 0):d===3&&(i.getContext&&typeof c>"u"?(c=l,l=void 0):(c=l,l=a,a=i,i=void 0))}else{if(d<1)throw new Error("Too few arguments provided");return d===1?(a=i,i=l=void 0):d===2&&!i.getContext&&(l=a,a=i,i=void 0),new Promise(function(p,x){try{const v=e.create(a,l);p(o(v,i,l))}catch(v){x(v)}})}try{const p=e.create(a,l);c(null,o(p,i,l))}catch(p){c(p)}}return Oh.create=e.create,Oh.toCanvas=s.bind(null,t.render),Oh.toDataURL=s.bind(null,t.renderToDataURL),Oh.toString=s.bind(null,function(o,i,a){return r.render(o,a)}),Oh}var zJ=VJ();const WJ=ay(zJ);async function UJ(n){try{const t=`https://idvuser-test.arconnet.com:1017/HandoffPage/${n.shortCode}`;return await WJ.toDataURL(t,{errorCorrectionLevel:"M",type:"image/png",margin:1,color:{dark:"#000000",light:"#FFFFFF"},width:256})}catch(e){throw console.error("Error generating QR code:",e),new Error("Failed to generate QR code")}}function HJ(){const n=new URLSearchParams(window.location.search);return{templateVersionId:n.get("templateVersionId")?parseInt(n.get("templateVersionId")):void 0,userId:n.get("userId")?parseInt(n.get("userId")):void 0,sessionId:n.get("sessionId")||void 0,currentStep:n.get("step")||void 0}}class hf extends Error{constructor(e,t){const r=new.target.prototype;super(`${e}: Status code '${t}'`),this.statusCode=t,this.__proto__=r}}class Hk extends Error{constructor(e="A timeout occurred."){const t=new.target.prototype;super(e),this.__proto__=t}}class nl extends Error{constructor(e="An abort occurred."){const t=new.target.prototype;super(e),this.__proto__=t}}class GJ extends Error{constructor(e,t){const r=new.target.prototype;super(e),this.transport=t,this.errorType="UnsupportedTransportError",this.__proto__=r}}class qJ extends Error{constructor(e,t){const r=new.target.prototype;super(e),this.transport=t,this.errorType="DisabledTransportError",this.__proto__=r}}class KJ extends Error{constructor(e,t){const r=new.target.prototype;super(e),this.transport=t,this.errorType="FailedToStartTransportError",this.__proto__=r}}class L9 extends Error{constructor(e){const t=new.target.prototype;super(e),this.errorType="FailedToNegotiateWithServerError",this.__proto__=t}}class XJ extends Error{constructor(e,t){const r=new.target.prototype;super(e),this.innerErrors=t,this.__proto__=r}}class $${constructor(e,t,r){this.statusCode=e,this.statusText=t,this.content=r}}class Iy{get(e,t){return this.send({...t,method:"GET",url:e})}post(e,t){return this.send({...t,method:"POST",url:e})}delete(e,t){return this.send({...t,method:"DELETE",url:e})}getCookieString(e){return""}}var Ue;(function(n){n[n.Trace=0]="Trace",n[n.Debug=1]="Debug",n[n.Information=2]="Information",n[n.Warning=3]="Warning",n[n.Error=4]="Error",n[n.Critical=5]="Critical",n[n.None=6]="None"})(Ue||(Ue={}));class Ng{constructor(){}log(e,t){}}Ng.instance=new Ng;const YJ="9.0.6";class vs{static isRequired(e,t){if(e==null)throw new Error(`The '${t}' argument is required.`)}static isNotEmpty(e,t){if(!e||e.match(/^\s*$/))throw new Error(`The '${t}' argument should not be empty.`)}static isIn(e,t,r){if(!(e in t))throw new Error(`Unknown ${r} value: ${e}.`)}}class qr{static get isBrowser(){return!qr.isNode&&typeof window=="object"&&typeof window.document=="object"}static get isWebWorker(){return!qr.isNode&&typeof self=="object"&&"importScripts"in self}static get isReactNative(){return!qr.isNode&&typeof window=="object"&&typeof window.document>"u"}static get isNode(){return typeof process<"u"&&process.release&&process.release.name==="node"}}function Eg(n,e){let t="";return Cf(n)?(t=`Binary data of length ${n.byteLength}`,e&&(t+=`. Content: '${ZJ(n)}'`)):typeof n=="string"&&(t=`String data of length ${n.length}`,e&&(t+=`. Content: '${n}'`)),t}function ZJ(n){const e=new Uint8Array(n);let t="";return e.forEach(r=>{const s=r<16?"0":"";t+=`0x${s}${r.toString(16)} `}),t.substr(0,t.length-1)}function Cf(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}async function F$(n,e,t,r,s,o){const i={},[a,l]=Sp();i[a]=l,n.log(Ue.Trace,`(${e} transport) sending data. ${Eg(s,o.logMessageContent)}.`);const c=Cf(s)?"arraybuffer":"text",u=await t.post(r,{content:s,headers:{...i,...o.headers},responseType:c,timeout:o.timeout,withCredentials:o.withCredentials});n.log(Ue.Trace,`(${e} transport) request complete. Response status: ${u.statusCode}.`)}function JJ(n){return n===void 0?new c2(Ue.Information):n===null?Ng.instance:n.log!==void 0?n:new c2(n)}class QJ{constructor(e,t){this._subject=e,this._observer=t}dispose(){const e=this._subject.observers.indexOf(this._observer);e>-1&&this._subject.observers.splice(e,1),this._subject.observers.length===0&&this._subject.cancelCallback&&this._subject.cancelCallback().catch(t=>{})}}class c2{constructor(e){this._minLevel=e,this.out=console}log(e,t){if(e>=this._minLevel){const r=`[${new Date().toISOString()}] ${Ue[e]}: ${t}`;switch(e){case Ue.Critical:case Ue.Error:this.out.error(r);break;case Ue.Warning:this.out.warn(r);break;case Ue.Information:this.out.info(r);break;default:this.out.log(r);break}}}}function Sp(){let n="X-SignalR-User-Agent";return qr.isNode&&(n="User-Agent"),[n,eQ(YJ,tQ(),rQ(),nQ())]}function eQ(n,e,t,r){let s="Microsoft SignalR/";const o=n.split(".");return s+=`${o[0]}.${o[1]}`,s+=` (${n}; `,e&&e!==""?s+=`${e}; `:s+="Unknown OS; ",s+=`${t}`,r?s+=`; ${r}`:s+="; Unknown Runtime Version",s+=")",s}function tQ(){if(qr.isNode)switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}else return""}function nQ(){if(qr.isNode)return process.versions.node}function rQ(){return qr.isNode?"NodeJS":"Browser"}function TC(n){return n.stack?n.stack:n.message?n.message:`${n}`}function sQ(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("could not find global")}class oQ extends Iy{constructor(e){if(super(),this._logger=e,typeof fetch>"u"||qr.isNode){const t=typeof __webpack_require__=="function"?__non_webpack_require__:require;this._jar=new(t("tough-cookie")).CookieJar,typeof fetch>"u"?this._fetchType=t("node-fetch"):this._fetchType=fetch,this._fetchType=t("fetch-cookie")(this._fetchType,this._jar)}else this._fetchType=fetch.bind(sQ());if(typeof AbortController>"u"){const t=typeof __webpack_require__=="function"?__non_webpack_require__:require;this._abortControllerType=t("abort-controller")}else this._abortControllerType=AbortController}async send(e){if(e.abortSignal&&e.abortSignal.aborted)throw new nl;if(!e.method)throw new Error("No method defined.");if(!e.url)throw new Error("No url defined.");const t=new this._abortControllerType;let r;e.abortSignal&&(e.abortSignal.onabort=()=>{t.abort(),r=new nl});let s=null;if(e.timeout){const l=e.timeout;s=setTimeout(()=>{t.abort(),this._logger.log(Ue.Warning,"Timeout from HTTP request."),r=new Hk},l)}e.content===""&&(e.content=void 0),e.content&&(e.headers=e.headers||{},Cf(e.content)?e.headers["Content-Type"]="application/octet-stream":e.headers["Content-Type"]="text/plain;charset=UTF-8");let o;try{o=await this._fetchType(e.url,{body:e.content,cache:"no-cache",credentials:e.withCredentials===!0?"include":"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",...e.headers},method:e.method,mode:"cors",redirect:"follow",signal:t.signal})}catch(l){throw r||(this._logger.log(Ue.Warning,`Error from HTTP request. ${l}.`),l)}finally{s&&clearTimeout(s),e.abortSignal&&(e.abortSignal.onabort=null)}if(!o.ok){const l=await j9(o,"text");throw new hf(l||o.statusText,o.status)}const a=await j9(o,e.responseType);return new $$(o.status,o.statusText,a)}getCookieString(e){let t="";return qr.isNode&&this._jar&&this._jar.getCookies(e,(r,s)=>t=s.join("; ")),t}}function j9(n,e){let t;switch(e){case"arraybuffer":t=n.arrayBuffer();break;case"text":t=n.text();break;case"blob":case"document":case"json":throw new Error(`${e} is not supported.`);default:t=n.text();break}return t}class iQ extends Iy{constructor(e){super(),this._logger=e}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new nl):e.method?e.url?new Promise((t,r)=>{const s=new XMLHttpRequest;s.open(e.method,e.url,!0),s.withCredentials=e.withCredentials===void 0?!0:e.withCredentials,s.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.content===""&&(e.content=void 0),e.content&&(Cf(e.content)?s.setRequestHeader("Content-Type","application/octet-stream"):s.setRequestHeader("Content-Type","text/plain;charset=UTF-8"));const o=e.headers;o&&Object.keys(o).forEach(i=>{s.setRequestHeader(i,o[i])}),e.responseType&&(s.responseType=e.responseType),e.abortSignal&&(e.abortSignal.onabort=()=>{s.abort(),r(new nl)}),e.timeout&&(s.timeout=e.timeout),s.onload=()=>{e.abortSignal&&(e.abortSignal.onabort=null),s.status>=200&&s.status<300?t(new $$(s.status,s.statusText,s.response||s.responseText)):r(new hf(s.response||s.responseText||s.statusText,s.status))},s.onerror=()=>{this._logger.log(Ue.Warning,`Error from HTTP request. ${s.status}: ${s.statusText}.`),r(new hf(s.statusText,s.status))},s.ontimeout=()=>{this._logger.log(Ue.Warning,"Timeout from HTTP request."),r(new Hk)},s.send(e.content)}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}}class aQ extends Iy{constructor(e){if(super(),typeof fetch<"u"||qr.isNode)this._httpClient=new oQ(e);else if(typeof XMLHttpRequest<"u")this._httpClient=new iQ(e);else throw new Error("No usable HttpClient found.")}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new nl):e.method?e.url?this._httpClient.send(e):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}getCookieString(e){return this._httpClient.getCookieString(e)}}class qi{static write(e){return`${e}${qi.RecordSeparator}`}static parse(e){if(e[e.length-1]!==qi.RecordSeparator)throw new Error("Message is incomplete.");const t=e.split(qi.RecordSeparator);return t.pop(),t}}qi.RecordSeparatorCode=30;qi.RecordSeparator=String.fromCharCode(qi.RecordSeparatorCode);class lQ{writeHandshakeRequest(e){return qi.write(JSON.stringify(e))}parseHandshakeResponse(e){let t,r;if(Cf(e)){const a=new Uint8Array(e),l=a.indexOf(qi.RecordSeparatorCode);if(l===-1)throw new Error("Message is incomplete.");const c=l+1;t=String.fromCharCode.apply(null,Array.prototype.slice.call(a.slice(0,c))),r=a.byteLength>c?a.slice(c).buffer:null}else{const a=e,l=a.indexOf(qi.RecordSeparator);if(l===-1)throw new Error("Message is incomplete.");const c=l+1;t=a.substring(0,c),r=a.length>c?a.substring(c):null}const s=qi.parse(t),o=JSON.parse(s[0]);if(o.type)throw new Error("Expected a handshake response from the server.");return[r,o]}}var En;(function(n){n[n.Invocation=1]="Invocation",n[n.StreamItem=2]="StreamItem",n[n.Completion=3]="Completion",n[n.StreamInvocation=4]="StreamInvocation",n[n.CancelInvocation=5]="CancelInvocation",n[n.Ping=6]="Ping",n[n.Close=7]="Close",n[n.Ack=8]="Ack",n[n.Sequence=9]="Sequence"})(En||(En={}));class cQ{constructor(){this.observers=[]}next(e){for(const t of this.observers)t.next(e)}error(e){for(const t of this.observers)t.error&&t.error(e)}complete(){for(const e of this.observers)e.complete&&e.complete()}subscribe(e){return this.observers.push(e),new QJ(this,e)}}class uQ{constructor(e,t,r){this._bufferSize=1e5,this._messages=[],this._totalMessageCount=0,this._waitForSequenceMessage=!1,this._nextReceivingSequenceId=1,this._latestReceivedSequenceId=0,this._bufferedByteCount=0,this._reconnectInProgress=!1,this._protocol=e,this._connection=t,this._bufferSize=r}async _send(e){const t=this._protocol.writeMessage(e);let r=Promise.resolve();if(this._isInvocationMessage(e)){this._totalMessageCount++;let s=()=>{},o=()=>{};Cf(t)?this._bufferedByteCount+=t.byteLength:this._bufferedByteCount+=t.length,this._bufferedByteCount>=this._bufferSize&&(r=new Promise((i,a)=>{s=i,o=a})),this._messages.push(new dQ(t,this._totalMessageCount,s,o))}try{this._reconnectInProgress||await this._connection.send(t)}catch{this._disconnected()}await r}_ack(e){let t=-1;for(let r=0;r<this._messages.length;r++){const s=this._messages[r];if(s._id<=e.sequenceId)t=r,Cf(s._message)?this._bufferedByteCount-=s._message.byteLength:this._bufferedByteCount-=s._message.length,s._resolver();else if(this._bufferedByteCount<this._bufferSize)s._resolver();else break}t!==-1&&(this._messages=this._messages.slice(t+1))}_shouldProcessMessage(e){if(this._waitForSequenceMessage)return e.type!==En.Sequence?!1:(this._waitForSequenceMessage=!1,!0);if(!this._isInvocationMessage(e))return!0;const t=this._nextReceivingSequenceId;return this._nextReceivingSequenceId++,t<=this._latestReceivedSequenceId?(t===this._latestReceivedSequenceId&&this._ackTimer(),!1):(this._latestReceivedSequenceId=t,this._ackTimer(),!0)}_resetSequence(e){if(e.sequenceId>this._nextReceivingSequenceId){this._connection.stop(new Error("Sequence ID greater than amount of messages we've received."));return}this._nextReceivingSequenceId=e.sequenceId}_disconnected(){this._reconnectInProgress=!0,this._waitForSequenceMessage=!0}async _resend(){const e=this._messages.length!==0?this._messages[0]._id:this._totalMessageCount+1;await this._connection.send(this._protocol.writeMessage({type:En.Sequence,sequenceId:e}));const t=this._messages;for(const r of t)await this._connection.send(r._message);this._reconnectInProgress=!1}_dispose(e){e??(e=new Error("Unable to reconnect to server."));for(const t of this._messages)t._rejector(e)}_isInvocationMessage(e){switch(e.type){case En.Invocation:case En.StreamItem:case En.Completion:case En.StreamInvocation:case En.CancelInvocation:return!0;case En.Close:case En.Sequence:case En.Ping:case En.Ack:return!1}}_ackTimer(){this._ackTimerHandle===void 0&&(this._ackTimerHandle=setTimeout(async()=>{try{this._reconnectInProgress||await this._connection.send(this._protocol.writeMessage({type:En.Ack,sequenceId:this._latestReceivedSequenceId}))}catch{}clearTimeout(this._ackTimerHandle),this._ackTimerHandle=void 0},1e3))}}class dQ{constructor(e,t,r,s){this._message=e,this._id=t,this._resolver=r,this._rejector=s}}const fQ=30*1e3,hQ=15*1e3,pQ=1e5;var Dr;(function(n){n.Disconnected="Disconnected",n.Connecting="Connecting",n.Connected="Connected",n.Disconnecting="Disconnecting",n.Reconnecting="Reconnecting"})(Dr||(Dr={}));class Gk{static create(e,t,r,s,o,i,a){return new Gk(e,t,r,s,o,i,a)}constructor(e,t,r,s,o,i,a){this._nextKeepAlive=0,this._freezeEventListener=()=>{this._logger.log(Ue.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://learn.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},vs.isRequired(e,"connection"),vs.isRequired(t,"logger"),vs.isRequired(r,"protocol"),this.serverTimeoutInMilliseconds=o??fQ,this.keepAliveIntervalInMilliseconds=i??hQ,this._statefulReconnectBufferSize=a??pQ,this._logger=t,this._protocol=r,this.connection=e,this._reconnectPolicy=s,this._handshakeProtocol=new lQ,this.connection.onreceive=l=>this._processIncomingData(l),this.connection.onclose=l=>this._connectionClosed(l),this._callbacks={},this._methods={},this._closedCallbacks=[],this._reconnectingCallbacks=[],this._reconnectedCallbacks=[],this._invocationId=0,this._receivedHandshakeResponse=!1,this._connectionState=Dr.Disconnected,this._connectionStarted=!1,this._cachedPingMessage=this._protocol.writeMessage({type:En.Ping})}get state(){return this._connectionState}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(e){if(this._connectionState!==Dr.Disconnected&&this._connectionState!==Dr.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!e)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=e}start(){return this._startPromise=this._startWithStateTransitions(),this._startPromise}async _startWithStateTransitions(){if(this._connectionState!==Dr.Disconnected)return Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));this._connectionState=Dr.Connecting,this._logger.log(Ue.Debug,"Starting HubConnection.");try{await this._startInternal(),qr.isBrowser&&window.document.addEventListener("freeze",this._freezeEventListener),this._connectionState=Dr.Connected,this._connectionStarted=!0,this._logger.log(Ue.Debug,"HubConnection connected successfully.")}catch(e){return this._connectionState=Dr.Disconnected,this._logger.log(Ue.Debug,`HubConnection failed to start successfully because of error '${e}'.`),Promise.reject(e)}}async _startInternal(){this._stopDuringStartError=void 0,this._receivedHandshakeResponse=!1;const e=new Promise((t,r)=>{this._handshakeResolver=t,this._handshakeRejecter=r});await this.connection.start(this._protocol.transferFormat);try{let t=this._protocol.version;this.connection.features.reconnect||(t=1);const r={protocol:this._protocol.name,version:t};if(this._logger.log(Ue.Debug,"Sending handshake request."),await this._sendMessage(this._handshakeProtocol.writeHandshakeRequest(r)),this._logger.log(Ue.Information,`Using HubProtocol '${this._protocol.name}'.`),this._cleanupTimeout(),this._resetTimeoutPeriod(),this._resetKeepAliveInterval(),await e,this._stopDuringStartError)throw this._stopDuringStartError;(this.connection.features.reconnect||!1)&&(this._messageBuffer=new uQ(this._protocol,this.connection,this._statefulReconnectBufferSize),this.connection.features.disconnected=this._messageBuffer._disconnected.bind(this._messageBuffer),this.connection.features.resend=()=>{if(this._messageBuffer)return this._messageBuffer._resend()}),this.connection.features.inherentKeepAlive||await this._sendMessage(this._cachedPingMessage)}catch(t){throw this._logger.log(Ue.Debug,`Hub handshake failed with error '${t}' during start(). Stopping HubConnection.`),this._cleanupTimeout(),this._cleanupPingTimer(),await this.connection.stop(t),t}}async stop(){const e=this._startPromise;this.connection.features.reconnect=!1,this._stopPromise=this._stopInternal(),await this._stopPromise;try{await e}catch{}}_stopInternal(e){if(this._connectionState===Dr.Disconnected)return this._logger.log(Ue.Debug,`Call to HubConnection.stop(${e}) ignored because it is already in the disconnected state.`),Promise.resolve();if(this._connectionState===Dr.Disconnecting)return this._logger.log(Ue.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;const t=this._connectionState;return this._connectionState=Dr.Disconnecting,this._logger.log(Ue.Debug,"Stopping HubConnection."),this._reconnectDelayHandle?(this._logger.log(Ue.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this._reconnectDelayHandle),this._reconnectDelayHandle=void 0,this._completeClose(),Promise.resolve()):(t===Dr.Connected&&this._sendCloseMessage(),this._cleanupTimeout(),this._cleanupPingTimer(),this._stopDuringStartError=e||new nl("The connection was stopped before the hub handshake could complete."),this.connection.stop(e))}async _sendCloseMessage(){try{await this._sendWithProtocol(this._createCloseMessage())}catch{}}stream(e,...t){const[r,s]=this._replaceStreamingParams(t),o=this._createStreamInvocation(e,t,s);let i;const a=new cQ;return a.cancelCallback=()=>{const l=this._createCancelInvocation(o.invocationId);return delete this._callbacks[o.invocationId],i.then(()=>this._sendWithProtocol(l))},this._callbacks[o.invocationId]=(l,c)=>{if(c){a.error(c);return}else l&&(l.type===En.Completion?l.error?a.error(new Error(l.error)):a.complete():a.next(l.item))},i=this._sendWithProtocol(o).catch(l=>{a.error(l),delete this._callbacks[o.invocationId]}),this._launchStreams(r,i),a}_sendMessage(e){return this._resetKeepAliveInterval(),this.connection.send(e)}_sendWithProtocol(e){return this._messageBuffer?this._messageBuffer._send(e):this._sendMessage(this._protocol.writeMessage(e))}send(e,...t){const[r,s]=this._replaceStreamingParams(t),o=this._sendWithProtocol(this._createInvocation(e,t,!0,s));return this._launchStreams(r,o),o}invoke(e,...t){const[r,s]=this._replaceStreamingParams(t),o=this._createInvocation(e,t,!1,s);return new Promise((a,l)=>{this._callbacks[o.invocationId]=(u,d)=>{if(d){l(d);return}else u&&(u.type===En.Completion?u.error?l(new Error(u.error)):a(u.result):l(new Error(`Unexpected message type: ${u.type}`)))};const c=this._sendWithProtocol(o).catch(u=>{l(u),delete this._callbacks[o.invocationId]});this._launchStreams(r,c)})}on(e,t){!e||!t||(e=e.toLowerCase(),this._methods[e]||(this._methods[e]=[]),this._methods[e].indexOf(t)===-1&&this._methods[e].push(t))}off(e,t){if(!e)return;e=e.toLowerCase();const r=this._methods[e];if(r)if(t){const s=r.indexOf(t);s!==-1&&(r.splice(s,1),r.length===0&&delete this._methods[e])}else delete this._methods[e]}onclose(e){e&&this._closedCallbacks.push(e)}onreconnecting(e){e&&this._reconnectingCallbacks.push(e)}onreconnected(e){e&&this._reconnectedCallbacks.push(e)}_processIncomingData(e){if(this._cleanupTimeout(),this._receivedHandshakeResponse||(e=this._processHandshakeResponse(e),this._receivedHandshakeResponse=!0),e){const t=this._protocol.parseMessages(e,this._logger);for(const r of t)if(!(this._messageBuffer&&!this._messageBuffer._shouldProcessMessage(r)))switch(r.type){case En.Invocation:this._invokeClientMethod(r).catch(s=>{this._logger.log(Ue.Error,`Invoke client method threw error: ${TC(s)}`)});break;case En.StreamItem:case En.Completion:{const s=this._callbacks[r.invocationId];if(s){r.type===En.Completion&&delete this._callbacks[r.invocationId];try{s(r)}catch(o){this._logger.log(Ue.Error,`Stream callback threw error: ${TC(o)}`)}}break}case En.Ping:break;case En.Close:{this._logger.log(Ue.Information,"Close message received from server.");const s=r.error?new Error("Server returned an error on close: "+r.error):void 0;r.allowReconnect===!0?this.connection.stop(s):this._stopPromise=this._stopInternal(s);break}case En.Ack:this._messageBuffer&&this._messageBuffer._ack(r);break;case En.Sequence:this._messageBuffer&&this._messageBuffer._resetSequence(r);break;default:this._logger.log(Ue.Warning,`Invalid message type: ${r.type}.`);break}}this._resetTimeoutPeriod()}_processHandshakeResponse(e){let t,r;try{[r,t]=this._handshakeProtocol.parseHandshakeResponse(e)}catch(s){const o="Error parsing handshake response: "+s;this._logger.log(Ue.Error,o);const i=new Error(o);throw this._handshakeRejecter(i),i}if(t.error){const s="Server returned handshake error: "+t.error;this._logger.log(Ue.Error,s);const o=new Error(s);throw this._handshakeRejecter(o),o}else this._logger.log(Ue.Debug,"Server handshake complete.");return this._handshakeResolver(),r}_resetKeepAliveInterval(){this.connection.features.inherentKeepAlive||(this._nextKeepAlive=new Date().getTime()+this.keepAliveIntervalInMilliseconds,this._cleanupPingTimer())}_resetTimeoutPeriod(){if((!this.connection.features||!this.connection.features.inherentKeepAlive)&&(this._timeoutHandle=setTimeout(()=>this.serverTimeout(),this.serverTimeoutInMilliseconds),this._pingServerHandle===void 0)){let e=this._nextKeepAlive-new Date().getTime();e<0&&(e=0),this._pingServerHandle=setTimeout(async()=>{if(this._connectionState===Dr.Connected)try{await this._sendMessage(this._cachedPingMessage)}catch{this._cleanupPingTimer()}},e)}}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}async _invokeClientMethod(e){const t=e.target.toLowerCase(),r=this._methods[t];if(!r){this._logger.log(Ue.Warning,`No client method with the name '${t}' found.`),e.invocationId&&(this._logger.log(Ue.Warning,`No result given for '${t}' method and invocation ID '${e.invocationId}'.`),await this._sendWithProtocol(this._createCompletionMessage(e.invocationId,"Client didn't provide a result.",null)));return}const s=r.slice(),o=!!e.invocationId;let i,a,l;for(const c of s)try{const u=i;i=await c.apply(this,e.arguments),o&&i&&u&&(this._logger.log(Ue.Error,`Multiple results provided for '${t}'. Sending error to server.`),l=this._createCompletionMessage(e.invocationId,"Client provided multiple results.",null)),a=void 0}catch(u){a=u,this._logger.log(Ue.Error,`A callback for the method '${t}' threw error '${u}'.`)}l?await this._sendWithProtocol(l):o?(a?l=this._createCompletionMessage(e.invocationId,`${a}`,null):i!==void 0?l=this._createCompletionMessage(e.invocationId,null,i):(this._logger.log(Ue.Warning,`No result given for '${t}' method and invocation ID '${e.invocationId}'.`),l=this._createCompletionMessage(e.invocationId,"Client didn't provide a result.",null)),await this._sendWithProtocol(l)):i&&this._logger.log(Ue.Error,`Result given for '${t}' method but server is not expecting a result.`)}_connectionClosed(e){this._logger.log(Ue.Debug,`HubConnection.connectionClosed(${e}) called while in state ${this._connectionState}.`),this._stopDuringStartError=this._stopDuringStartError||e||new nl("The underlying connection was closed before the hub handshake could complete."),this._handshakeResolver&&this._handshakeResolver(),this._cancelCallbacksWithError(e||new Error("Invocation canceled due to the underlying connection being closed.")),this._cleanupTimeout(),this._cleanupPingTimer(),this._connectionState===Dr.Disconnecting?this._completeClose(e):this._connectionState===Dr.Connected&&this._reconnectPolicy?this._reconnect(e):this._connectionState===Dr.Connected&&this._completeClose(e)}_completeClose(e){if(this._connectionStarted){this._connectionState=Dr.Disconnected,this._connectionStarted=!1,this._messageBuffer&&(this._messageBuffer._dispose(e??new Error("Connection closed.")),this._messageBuffer=void 0),qr.isBrowser&&window.document.removeEventListener("freeze",this._freezeEventListener);try{this._closedCallbacks.forEach(t=>t.apply(this,[e]))}catch(t){this._logger.log(Ue.Error,`An onclose callback called with error '${e}' threw error '${t}'.`)}}}async _reconnect(e){const t=Date.now();let r=0,s=e!==void 0?e:new Error("Attempting to reconnect due to a unknown error."),o=this._getNextRetryDelay(r++,0,s);if(o===null){this._logger.log(Ue.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),this._completeClose(e);return}if(this._connectionState=Dr.Reconnecting,e?this._logger.log(Ue.Information,`Connection reconnecting because of error '${e}'.`):this._logger.log(Ue.Information,"Connection reconnecting."),this._reconnectingCallbacks.length!==0){try{this._reconnectingCallbacks.forEach(i=>i.apply(this,[e]))}catch(i){this._logger.log(Ue.Error,`An onreconnecting callback called with error '${e}' threw error '${i}'.`)}if(this._connectionState!==Dr.Reconnecting){this._logger.log(Ue.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.");return}}for(;o!==null;){if(this._logger.log(Ue.Information,`Reconnect attempt number ${r} will start in ${o} ms.`),await new Promise(i=>{this._reconnectDelayHandle=setTimeout(i,o)}),this._reconnectDelayHandle=void 0,this._connectionState!==Dr.Reconnecting){this._logger.log(Ue.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");return}try{if(await this._startInternal(),this._connectionState=Dr.Connected,this._logger.log(Ue.Information,"HubConnection reconnected successfully."),this._reconnectedCallbacks.length!==0)try{this._reconnectedCallbacks.forEach(i=>i.apply(this,[this.connection.connectionId]))}catch(i){this._logger.log(Ue.Error,`An onreconnected callback called with connectionId '${this.connection.connectionId}; threw error '${i}'.`)}return}catch(i){if(this._logger.log(Ue.Information,`Reconnect attempt failed because of error '${i}'.`),this._connectionState!==Dr.Reconnecting){this._logger.log(Ue.Debug,`Connection moved to the '${this._connectionState}' from the reconnecting state during reconnect attempt. Done reconnecting.`),this._connectionState===Dr.Disconnecting&&this._completeClose();return}s=i instanceof Error?i:new Error(i.toString()),o=this._getNextRetryDelay(r++,Date.now()-t,s)}}this._logger.log(Ue.Information,`Reconnect retries have been exhausted after ${Date.now()-t} ms and ${r} failed attempts. Connection disconnecting.`),this._completeClose()}_getNextRetryDelay(e,t,r){try{return this._reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:t,previousRetryCount:e,retryReason:r})}catch(s){return this._logger.log(Ue.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${e}, ${t}) threw error '${s}'.`),null}}_cancelCallbacksWithError(e){const t=this._callbacks;this._callbacks={},Object.keys(t).forEach(r=>{const s=t[r];try{s(null,e)}catch(o){this._logger.log(Ue.Error,`Stream 'error' callback called with '${e}' threw error: ${TC(o)}`)}})}_cleanupPingTimer(){this._pingServerHandle&&(clearTimeout(this._pingServerHandle),this._pingServerHandle=void 0)}_cleanupTimeout(){this._timeoutHandle&&clearTimeout(this._timeoutHandle)}_createInvocation(e,t,r,s){if(r)return s.length!==0?{target:e,arguments:t,streamIds:s,type:En.Invocation}:{target:e,arguments:t,type:En.Invocation};{const o=this._invocationId;return this._invocationId++,s.length!==0?{target:e,arguments:t,invocationId:o.toString(),streamIds:s,type:En.Invocation}:{target:e,arguments:t,invocationId:o.toString(),type:En.Invocation}}}_launchStreams(e,t){if(e.length!==0){t||(t=Promise.resolve());for(const r in e)e[r].subscribe({complete:()=>{t=t.then(()=>this._sendWithProtocol(this._createCompletionMessage(r)))},error:s=>{let o;s instanceof Error?o=s.message:s&&s.toString?o=s.toString():o="Unknown error",t=t.then(()=>this._sendWithProtocol(this._createCompletionMessage(r,o)))},next:s=>{t=t.then(()=>this._sendWithProtocol(this._createStreamItemMessage(r,s)))}})}}_replaceStreamingParams(e){const t=[],r=[];for(let s=0;s<e.length;s++){const o=e[s];if(this._isObservable(o)){const i=this._invocationId;this._invocationId++,t[i]=o,r.push(i.toString()),e.splice(s,1)}}return[t,r]}_isObservable(e){return e&&e.subscribe&&typeof e.subscribe=="function"}_createStreamInvocation(e,t,r){const s=this._invocationId;return this._invocationId++,r.length!==0?{target:e,arguments:t,invocationId:s.toString(),streamIds:r,type:En.StreamInvocation}:{target:e,arguments:t,invocationId:s.toString(),type:En.StreamInvocation}}_createCancelInvocation(e){return{invocationId:e,type:En.CancelInvocation}}_createStreamItemMessage(e,t){return{invocationId:e,item:t,type:En.StreamItem}}_createCompletionMessage(e,t,r){return t?{error:t,invocationId:e,type:En.Completion}:{invocationId:e,result:r,type:En.Completion}}_createCloseMessage(){return{type:En.Close}}}const mQ=[0,2e3,1e4,3e4,null];class B9{constructor(e){this._retryDelays=e!==void 0?[...e,null]:mQ}nextRetryDelayInMilliseconds(e){return this._retryDelays[e.previousRetryCount]}}class pf{}pf.Authorization="Authorization";pf.Cookie="Cookie";class gQ extends Iy{constructor(e,t){super(),this._innerClient=e,this._accessTokenFactory=t}async send(e){let t=!0;this._accessTokenFactory&&(!this._accessToken||e.url&&e.url.indexOf("/negotiate?")>0)&&(t=!1,this._accessToken=await this._accessTokenFactory()),this._setAuthorizationHeader(e);const r=await this._innerClient.send(e);return t&&r.statusCode===401&&this._accessTokenFactory?(this._accessToken=await this._accessTokenFactory(),this._setAuthorizationHeader(e),await this._innerClient.send(e)):r}_setAuthorizationHeader(e){e.headers||(e.headers={}),this._accessToken?e.headers[pf.Authorization]=`Bearer ${this._accessToken}`:this._accessTokenFactory&&e.headers[pf.Authorization]&&delete e.headers[pf.Authorization]}getCookieString(e){return this._innerClient.getCookieString(e)}}var ds;(function(n){n[n.None=0]="None",n[n.WebSockets=1]="WebSockets",n[n.ServerSentEvents=2]="ServerSentEvents",n[n.LongPolling=4]="LongPolling"})(ds||(ds={}));var $o;(function(n){n[n.Text=1]="Text",n[n.Binary=2]="Binary"})($o||($o={}));let xQ=class{constructor(){this._isAborted=!1,this.onabort=null}abort(){this._isAborted||(this._isAborted=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this._isAborted}};class V9{get pollAborted(){return this._pollAbort.aborted}constructor(e,t,r){this._httpClient=e,this._logger=t,this._pollAbort=new xQ,this._options=r,this._running=!1,this.onreceive=null,this.onclose=null}async connect(e,t){if(vs.isRequired(e,"url"),vs.isRequired(t,"transferFormat"),vs.isIn(t,$o,"transferFormat"),this._url=e,this._logger.log(Ue.Trace,"(LongPolling transport) Connecting."),t===$o.Binary&&typeof XMLHttpRequest<"u"&&typeof new XMLHttpRequest().responseType!="string")throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");const[r,s]=Sp(),o={[r]:s,...this._options.headers},i={abortSignal:this._pollAbort.signal,headers:o,timeout:1e5,withCredentials:this._options.withCredentials};t===$o.Binary&&(i.responseType="arraybuffer");const a=`${e}&_=${Date.now()}`;this._logger.log(Ue.Trace,`(LongPolling transport) polling: ${a}.`);const l=await this._httpClient.get(a,i);l.statusCode!==200?(this._logger.log(Ue.Error,`(LongPolling transport) Unexpected response code: ${l.statusCode}.`),this._closeError=new hf(l.statusText||"",l.statusCode),this._running=!1):this._running=!0,this._receiving=this._poll(this._url,i)}async _poll(e,t){try{for(;this._running;)try{const r=`${e}&_=${Date.now()}`;this._logger.log(Ue.Trace,`(LongPolling transport) polling: ${r}.`);const s=await this._httpClient.get(r,t);s.statusCode===204?(this._logger.log(Ue.Information,"(LongPolling transport) Poll terminated by server."),this._running=!1):s.statusCode!==200?(this._logger.log(Ue.Error,`(LongPolling transport) Unexpected response code: ${s.statusCode}.`),this._closeError=new hf(s.statusText||"",s.statusCode),this._running=!1):s.content?(this._logger.log(Ue.Trace,`(LongPolling transport) data received. ${Eg(s.content,this._options.logMessageContent)}.`),this.onreceive&&this.onreceive(s.content)):this._logger.log(Ue.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(r){this._running?r instanceof Hk?this._logger.log(Ue.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this._closeError=r,this._running=!1):this._logger.log(Ue.Trace,`(LongPolling transport) Poll errored after shutdown: ${r.message}`)}}finally{this._logger.log(Ue.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this._raiseOnClose()}}async send(e){return this._running?F$(this._logger,"LongPolling",this._httpClient,this._url,e,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}async stop(){this._logger.log(Ue.Trace,"(LongPolling transport) Stopping polling."),this._running=!1,this._pollAbort.abort();try{await this._receiving,this._logger.log(Ue.Trace,`(LongPolling transport) sending DELETE request to ${this._url}.`);const e={},[t,r]=Sp();e[t]=r;const s={headers:{...e,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials};let o;try{await this._httpClient.delete(this._url,s)}catch(i){o=i}o?o instanceof hf&&(o.statusCode===404?this._logger.log(Ue.Trace,"(LongPolling transport) A 404 response was returned from sending a DELETE request."):this._logger.log(Ue.Trace,`(LongPolling transport) Error sending a DELETE request: ${o}`)):this._logger.log(Ue.Trace,"(LongPolling transport) DELETE request accepted.")}finally{this._logger.log(Ue.Trace,"(LongPolling transport) Stop finished."),this._raiseOnClose()}}_raiseOnClose(){if(this.onclose){let e="(LongPolling transport) Firing onclose event.";this._closeError&&(e+=" Error: "+this._closeError),this._logger.log(Ue.Trace,e),this.onclose(this._closeError)}}}class vQ{constructor(e,t,r,s){this._httpClient=e,this._accessToken=t,this._logger=r,this._options=s,this.onreceive=null,this.onclose=null}async connect(e,t){return vs.isRequired(e,"url"),vs.isRequired(t,"transferFormat"),vs.isIn(t,$o,"transferFormat"),this._logger.log(Ue.Trace,"(SSE transport) Connecting."),this._url=e,this._accessToken&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(this._accessToken)}`),new Promise((r,s)=>{let o=!1;if(t!==$o.Text){s(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"));return}let i;if(qr.isBrowser||qr.isWebWorker)i=new this._options.EventSource(e,{withCredentials:this._options.withCredentials});else{const a=this._httpClient.getCookieString(e),l={};l.Cookie=a;const[c,u]=Sp();l[c]=u,i=new this._options.EventSource(e,{withCredentials:this._options.withCredentials,headers:{...l,...this._options.headers}})}try{i.onmessage=a=>{if(this.onreceive)try{this._logger.log(Ue.Trace,`(SSE transport) data received. ${Eg(a.data,this._options.logMessageContent)}.`),this.onreceive(a.data)}catch(l){this._close(l);return}},i.onerror=a=>{o?this._close():s(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},i.onopen=()=>{this._logger.log(Ue.Information,`SSE connected to ${this._url}`),this._eventSource=i,o=!0,r()}}catch(a){s(a);return}})}async send(e){return this._eventSource?F$(this._logger,"SSE",this._httpClient,this._url,e,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}stop(){return this._close(),Promise.resolve()}_close(e){this._eventSource&&(this._eventSource.close(),this._eventSource=void 0,this.onclose&&this.onclose(e))}}class yQ{constructor(e,t,r,s,o,i){this._logger=r,this._accessTokenFactory=t,this._logMessageContent=s,this._webSocketConstructor=o,this._httpClient=e,this.onreceive=null,this.onclose=null,this._headers=i}async connect(e,t){vs.isRequired(e,"url"),vs.isRequired(t,"transferFormat"),vs.isIn(t,$o,"transferFormat"),this._logger.log(Ue.Trace,"(WebSockets transport) Connecting.");let r;return this._accessTokenFactory&&(r=await this._accessTokenFactory()),new Promise((s,o)=>{e=e.replace(/^http/,"ws");let i;const a=this._httpClient.getCookieString(e);let l=!1;if(qr.isNode||qr.isReactNative){const c={},[u,d]=Sp();c[u]=d,r&&(c[pf.Authorization]=`Bearer ${r}`),a&&(c[pf.Cookie]=a),i=new this._webSocketConstructor(e,void 0,{headers:{...c,...this._headers}})}else r&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(r)}`);i||(i=new this._webSocketConstructor(e)),t===$o.Binary&&(i.binaryType="arraybuffer"),i.onopen=c=>{this._logger.log(Ue.Information,`WebSocket connected to ${e}.`),this._webSocket=i,l=!0,s()},i.onerror=c=>{let u=null;typeof ErrorEvent<"u"&&c instanceof ErrorEvent?u=c.error:u="There was an error with the transport",this._logger.log(Ue.Information,`(WebSockets transport) ${u}.`)},i.onmessage=c=>{if(this._logger.log(Ue.Trace,`(WebSockets transport) data received. ${Eg(c.data,this._logMessageContent)}.`),this.onreceive)try{this.onreceive(c.data)}catch(u){this._close(u);return}},i.onclose=c=>{if(l)this._close(c);else{let u=null;typeof ErrorEvent<"u"&&c instanceof ErrorEvent?u=c.error:u="WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",o(new Error(u))}}})}send(e){return this._webSocket&&this._webSocket.readyState===this._webSocketConstructor.OPEN?(this._logger.log(Ue.Trace,`(WebSockets transport) sending data. ${Eg(e,this._logMessageContent)}.`),this._webSocket.send(e),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this._webSocket&&this._close(void 0),Promise.resolve()}_close(e){this._webSocket&&(this._webSocket.onclose=()=>{},this._webSocket.onmessage=()=>{},this._webSocket.onerror=()=>{},this._webSocket.close(),this._webSocket=void 0),this._logger.log(Ue.Trace,"(WebSockets transport) socket closed."),this.onclose&&(this._isCloseEvent(e)&&(e.wasClean===!1||e.code!==1e3)?this.onclose(new Error(`WebSocket closed with status code: ${e.code} (${e.reason||"no reason given"}).`)):e instanceof Error?this.onclose(e):this.onclose())}_isCloseEvent(e){return e&&typeof e.wasClean=="boolean"&&typeof e.code=="number"}}const z9=100;class bQ{constructor(e,t={}){if(this._stopPromiseResolver=()=>{},this.features={},this._negotiateVersion=1,vs.isRequired(e,"url"),this._logger=JJ(t.logger),this.baseUrl=this._resolveUrl(e),t=t||{},t.logMessageContent=t.logMessageContent===void 0?!1:t.logMessageContent,typeof t.withCredentials=="boolean"||t.withCredentials===void 0)t.withCredentials=t.withCredentials===void 0?!0:t.withCredentials;else throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");t.timeout=t.timeout===void 0?100*1e3:t.timeout;let r=null,s=null;if(qr.isNode&&typeof require<"u"){const o=typeof __webpack_require__=="function"?__non_webpack_require__:require;r=o("ws"),s=o("eventsource")}!qr.isNode&&typeof WebSocket<"u"&&!t.WebSocket?t.WebSocket=WebSocket:qr.isNode&&!t.WebSocket&&r&&(t.WebSocket=r),!qr.isNode&&typeof EventSource<"u"&&!t.EventSource?t.EventSource=EventSource:qr.isNode&&!t.EventSource&&typeof s<"u"&&(t.EventSource=s),this._httpClient=new gQ(t.httpClient||new aQ(this._logger),t.accessTokenFactory),this._connectionState="Disconnected",this._connectionStarted=!1,this._options=t,this.onreceive=null,this.onclose=null}async start(e){if(e=e||$o.Binary,vs.isIn(e,$o,"transferFormat"),this._logger.log(Ue.Debug,`Starting connection with transfer format '${$o[e]}'.`),this._connectionState!=="Disconnected")return Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."));if(this._connectionState="Connecting",this._startInternalPromise=this._startInternal(e),await this._startInternalPromise,this._connectionState==="Disconnecting"){const t="Failed to start the HttpConnection before stop() was called.";return this._logger.log(Ue.Error,t),await this._stopPromise,Promise.reject(new nl(t))}else if(this._connectionState!=="Connected"){const t="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";return this._logger.log(Ue.Error,t),Promise.reject(new nl(t))}this._connectionStarted=!0}send(e){return this._connectionState!=="Connected"?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this._sendQueue||(this._sendQueue=new qk(this.transport)),this._sendQueue.send(e))}async stop(e){if(this._connectionState==="Disconnected")return this._logger.log(Ue.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnected state.`),Promise.resolve();if(this._connectionState==="Disconnecting")return this._logger.log(Ue.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;this._connectionState="Disconnecting",this._stopPromise=new Promise(t=>{this._stopPromiseResolver=t}),await this._stopInternal(e),await this._stopPromise}async _stopInternal(e){this._stopError=e;try{await this._startInternalPromise}catch{}if(this.transport){try{await this.transport.stop()}catch(t){this._logger.log(Ue.Error,`HttpConnection.transport.stop() threw error '${t}'.`),this._stopConnection()}this.transport=void 0}else this._logger.log(Ue.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.")}async _startInternal(e){let t=this.baseUrl;this._accessTokenFactory=this._options.accessTokenFactory,this._httpClient._accessTokenFactory=this._accessTokenFactory;try{if(this._options.skipNegotiation)if(this._options.transport===ds.WebSockets)this.transport=this._constructTransport(ds.WebSockets),await this._startTransport(t,e);else throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");else{let r=null,s=0;do{if(r=await this._getNegotiationResponse(t),this._connectionState==="Disconnecting"||this._connectionState==="Disconnected")throw new nl("The connection was stopped during negotiation.");if(r.error)throw new Error(r.error);if(r.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");if(r.url&&(t=r.url),r.accessToken){const o=r.accessToken;this._accessTokenFactory=()=>o,this._httpClient._accessToken=o,this._httpClient._accessTokenFactory=void 0}s++}while(r.url&&s<z9);if(s===z9&&r.url)throw new Error("Negotiate redirection limit exceeded.");await this._createTransport(t,this._options.transport,r,e)}this.transport instanceof V9&&(this.features.inherentKeepAlive=!0),this._connectionState==="Connecting"&&(this._logger.log(Ue.Debug,"The HttpConnection connected successfully."),this._connectionState="Connected")}catch(r){return this._logger.log(Ue.Error,"Failed to start the connection: "+r),this._connectionState="Disconnected",this.transport=void 0,this._stopPromiseResolver(),Promise.reject(r)}}async _getNegotiationResponse(e){const t={},[r,s]=Sp();t[r]=s;const o=this._resolveNegotiateUrl(e);this._logger.log(Ue.Debug,`Sending negotiation request: ${o}.`);try{const i=await this._httpClient.post(o,{content:"",headers:{...t,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials});if(i.statusCode!==200)return Promise.reject(new Error(`Unexpected status code returned from negotiate '${i.statusCode}'`));const a=JSON.parse(i.content);return(!a.negotiateVersion||a.negotiateVersion<1)&&(a.connectionToken=a.connectionId),a.useStatefulReconnect&&this._options._useStatefulReconnect!==!0?Promise.reject(new L9("Client didn't negotiate Stateful Reconnect but the server did.")):a}catch(i){let a="Failed to complete negotiation with the server: "+i;return i instanceof hf&&i.statusCode===404&&(a=a+" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),this._logger.log(Ue.Error,a),Promise.reject(new L9(a))}}_createConnectUrl(e,t){return t?e+(e.indexOf("?")===-1?"?":"&")+`id=${t}`:e}async _createTransport(e,t,r,s){let o=this._createConnectUrl(e,r.connectionToken);if(this._isITransport(t)){this._logger.log(Ue.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=t,await this._startTransport(o,s),this.connectionId=r.connectionId;return}const i=[],a=r.availableTransports||[];let l=r;for(const c of a){const u=this._resolveTransportOrError(c,t,s,l?.useStatefulReconnect===!0);if(u instanceof Error)i.push(`${c.transport} failed:`),i.push(u);else if(this._isITransport(u)){if(this.transport=u,!l){try{l=await this._getNegotiationResponse(e)}catch(d){return Promise.reject(d)}o=this._createConnectUrl(e,l.connectionToken)}try{await this._startTransport(o,s),this.connectionId=l.connectionId;return}catch(d){if(this._logger.log(Ue.Error,`Failed to start the transport '${c.transport}': ${d}`),l=void 0,i.push(new KJ(`${c.transport} failed: ${d}`,ds[c.transport])),this._connectionState!=="Connecting"){const f="Failed to select transport before stop() was called.";return this._logger.log(Ue.Debug,f),Promise.reject(new nl(f))}}}}return i.length>0?Promise.reject(new XJ(`Unable to connect to the server with any of the available transports. ${i.join(" ")}`,i)):Promise.reject(new Error("None of the transports supported by the client are supported by the server."))}_constructTransport(e){switch(e){case ds.WebSockets:if(!this._options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new yQ(this._httpClient,this._accessTokenFactory,this._logger,this._options.logMessageContent,this._options.WebSocket,this._options.headers||{});case ds.ServerSentEvents:if(!this._options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new vQ(this._httpClient,this._httpClient._accessToken,this._logger,this._options);case ds.LongPolling:return new V9(this._httpClient,this._logger,this._options);default:throw new Error(`Unknown transport: ${e}.`)}}_startTransport(e,t){return this.transport.onreceive=this.onreceive,this.features.reconnect?this.transport.onclose=async r=>{let s=!1;if(this.features.reconnect)try{this.features.disconnected(),await this.transport.connect(e,t),await this.features.resend()}catch{s=!0}else{this._stopConnection(r);return}s&&this._stopConnection(r)}:this.transport.onclose=r=>this._stopConnection(r),this.transport.connect(e,t)}_resolveTransportOrError(e,t,r,s){const o=ds[e.transport];if(o==null)return this._logger.log(Ue.Debug,`Skipping transport '${e.transport}' because it is not supported by this client.`),new Error(`Skipping transport '${e.transport}' because it is not supported by this client.`);if(wQ(t,o))if(e.transferFormats.map(a=>$o[a]).indexOf(r)>=0){if(o===ds.WebSockets&&!this._options.WebSocket||o===ds.ServerSentEvents&&!this._options.EventSource)return this._logger.log(Ue.Debug,`Skipping transport '${ds[o]}' because it is not supported in your environment.'`),new GJ(`'${ds[o]}' is not supported in your environment.`,o);this._logger.log(Ue.Debug,`Selecting transport '${ds[o]}'.`);try{return this.features.reconnect=o===ds.WebSockets?s:void 0,this._constructTransport(o)}catch(a){return a}}else return this._logger.log(Ue.Debug,`Skipping transport '${ds[o]}' because it does not support the requested transfer format '${$o[r]}'.`),new Error(`'${ds[o]}' does not support ${$o[r]}.`);else return this._logger.log(Ue.Debug,`Skipping transport '${ds[o]}' because it was disabled by the client.`),new qJ(`'${ds[o]}' is disabled by the client.`,o)}_isITransport(e){return e&&typeof e=="object"&&"connect"in e}_stopConnection(e){if(this._logger.log(Ue.Debug,`HttpConnection.stopConnection(${e}) called while in state ${this._connectionState}.`),this.transport=void 0,e=this._stopError||e,this._stopError=void 0,this._connectionState==="Disconnected"){this._logger.log(Ue.Debug,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is already in the disconnected state.`);return}if(this._connectionState==="Connecting")throw this._logger.log(Ue.Warning,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is still in the connecting state.`),new Error(`HttpConnection.stopConnection(${e}) was called while the connection is still in the connecting state.`);if(this._connectionState==="Disconnecting"&&this._stopPromiseResolver(),e?this._logger.log(Ue.Error,`Connection disconnected with error '${e}'.`):this._logger.log(Ue.Information,"Connection disconnected."),this._sendQueue&&(this._sendQueue.stop().catch(t=>{this._logger.log(Ue.Error,`TransportSendQueue.stop() threw error '${t}'.`)}),this._sendQueue=void 0),this.connectionId=void 0,this._connectionState="Disconnected",this._connectionStarted){this._connectionStarted=!1;try{this.onclose&&this.onclose(e)}catch(t){this._logger.log(Ue.Error,`HttpConnection.onclose(${e}) threw error '${t}'.`)}}}_resolveUrl(e){if(e.lastIndexOf("https://",0)===0||e.lastIndexOf("http://",0)===0)return e;if(!qr.isBrowser)throw new Error(`Cannot resolve '${e}'.`);const t=window.document.createElement("a");return t.href=e,this._logger.log(Ue.Information,`Normalizing '${e}' to '${t.href}'.`),t.href}_resolveNegotiateUrl(e){const t=new URL(e);t.pathname.endsWith("/")?t.pathname+="negotiate":t.pathname+="/negotiate";const r=new URLSearchParams(t.searchParams);return r.has("negotiateVersion")||r.append("negotiateVersion",this._negotiateVersion.toString()),r.has("useStatefulReconnect")?r.get("useStatefulReconnect")==="true"&&(this._options._useStatefulReconnect=!0):this._options._useStatefulReconnect===!0&&r.append("useStatefulReconnect","true"),t.search=r.toString(),t.toString()}}function wQ(n,e){return!n||(e&n)!==0}class qk{constructor(e){this._transport=e,this._buffer=[],this._executing=!0,this._sendBufferedData=new Jx,this._transportResult=new Jx,this._sendLoopPromise=this._sendLoop()}send(e){return this._bufferData(e),this._transportResult||(this._transportResult=new Jx),this._transportResult.promise}stop(){return this._executing=!1,this._sendBufferedData.resolve(),this._sendLoopPromise}_bufferData(e){if(this._buffer.length&&typeof this._buffer[0]!=typeof e)throw new Error(`Expected data to be of type ${typeof this._buffer} but was of type ${typeof e}`);this._buffer.push(e),this._sendBufferedData.resolve()}async _sendLoop(){for(;;){if(await this._sendBufferedData.promise,!this._executing){this._transportResult&&this._transportResult.reject("Connection stopped.");break}this._sendBufferedData=new Jx;const e=this._transportResult;this._transportResult=void 0;const t=typeof this._buffer[0]=="string"?this._buffer.join(""):qk._concatBuffers(this._buffer);this._buffer.length=0;try{await this._transport.send(t),e.resolve()}catch(r){e.reject(r)}}}static _concatBuffers(e){const t=e.map(o=>o.byteLength).reduce((o,i)=>o+i),r=new Uint8Array(t);let s=0;for(const o of e)r.set(new Uint8Array(o),s),s+=o.byteLength;return r.buffer}}class Jx{constructor(){this.promise=new Promise((e,t)=>[this._resolver,this._rejecter]=[e,t])}resolve(){this._resolver()}reject(e){this._rejecter(e)}}const CQ="json";class kQ{constructor(){this.name=CQ,this.version=2,this.transferFormat=$o.Text}parseMessages(e,t){if(typeof e!="string")throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!e)return[];t===null&&(t=Ng.instance);const r=qi.parse(e),s=[];for(const o of r){const i=JSON.parse(o);if(typeof i.type!="number")throw new Error("Invalid payload.");switch(i.type){case En.Invocation:this._isInvocationMessage(i);break;case En.StreamItem:this._isStreamItemMessage(i);break;case En.Completion:this._isCompletionMessage(i);break;case En.Ping:break;case En.Close:break;case En.Ack:this._isAckMessage(i);break;case En.Sequence:this._isSequenceMessage(i);break;default:t.log(Ue.Information,"Unknown message type '"+i.type+"' ignored.");continue}s.push(i)}return s}writeMessage(e){return qi.write(JSON.stringify(e))}_isInvocationMessage(e){this._assertNotEmptyString(e.target,"Invalid payload for Invocation message."),e.invocationId!==void 0&&this._assertNotEmptyString(e.invocationId,"Invalid payload for Invocation message.")}_isStreamItemMessage(e){if(this._assertNotEmptyString(e.invocationId,"Invalid payload for StreamItem message."),e.item===void 0)throw new Error("Invalid payload for StreamItem message.")}_isCompletionMessage(e){if(e.result&&e.error)throw new Error("Invalid payload for Completion message.");!e.result&&e.error&&this._assertNotEmptyString(e.error,"Invalid payload for Completion message."),this._assertNotEmptyString(e.invocationId,"Invalid payload for Completion message.")}_isAckMessage(e){if(typeof e.sequenceId!="number")throw new Error("Invalid SequenceId for Ack message.")}_isSequenceMessage(e){if(typeof e.sequenceId!="number")throw new Error("Invalid SequenceId for Sequence message.")}_assertNotEmptyString(e,t){if(typeof e!="string"||e==="")throw new Error(t)}}const SQ={trace:Ue.Trace,debug:Ue.Debug,info:Ue.Information,information:Ue.Information,warn:Ue.Warning,warning:Ue.Warning,error:Ue.Error,critical:Ue.Critical,none:Ue.None};function NQ(n){const e=SQ[n.toLowerCase()];if(typeof e<"u")return e;throw new Error(`Unknown log level: ${n}`)}class P${configureLogging(e){if(vs.isRequired(e,"logging"),EQ(e))this.logger=e;else if(typeof e=="string"){const t=NQ(e);this.logger=new c2(t)}else this.logger=new c2(e);return this}withUrl(e,t){return vs.isRequired(e,"url"),vs.isNotEmpty(e,"url"),this.url=e,typeof t=="object"?this.httpConnectionOptions={...this.httpConnectionOptions,...t}:this.httpConnectionOptions={...this.httpConnectionOptions,transport:t},this}withHubProtocol(e){return vs.isRequired(e,"protocol"),this.protocol=e,this}withAutomaticReconnect(e){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return e?Array.isArray(e)?this.reconnectPolicy=new B9(e):this.reconnectPolicy=e:this.reconnectPolicy=new B9,this}withServerTimeout(e){return vs.isRequired(e,"milliseconds"),this._serverTimeoutInMilliseconds=e,this}withKeepAliveInterval(e){return vs.isRequired(e,"milliseconds"),this._keepAliveIntervalInMilliseconds=e,this}withStatefulReconnect(e){return this.httpConnectionOptions===void 0&&(this.httpConnectionOptions={}),this.httpConnectionOptions._useStatefulReconnect=!0,this._statefulReconnectBufferSize=e?.bufferSize,this}build(){const e=this.httpConnectionOptions||{};if(e.logger===void 0&&(e.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");const t=new bQ(this.url,e);return Gk.create(t,this.logger||Ng.instance,this.protocol||new kQ,this.reconnectPolicy,this._serverTimeoutInMilliseconds,this._keepAliveIntervalInMilliseconds,this._statefulReconnectBufferSize)}}function EQ(n){return n.log!==void 0}function IQ(n){const{shortCode:e,templateVersionId:t,userId:r,sessionId:s,currentStep:o="document-upload",submissionId:i,size:a="medium",showUrl:l=!0,className:c="",connectionRef:u,shouldMaintainConnection:d}=n,{toast:f}=pd(),[p,x]=_.useState(""),[v,y]=_.useState(""),[b,w]=_.useState(!1),[S,k]=_.useState(""),N=_.useRef(null),I=u||N,[T,F]=_.useState(0),R={small:"w-16 h-16 sm:w-20 sm:h-20",medium:"w-20 h-20 sm:w-24 sm:h-24",large:"w-24 h-24 sm:w-32 sm:h-32",enlarged:"w-40 h-40 sm:w-56 sm:h-56"};_.useEffect(()=>{if(T!==1)return;(async()=>{if(!e){k("No shortcode provided"),w(!1);return}if(!i){k("Submission ID not available yet"),w(!1);return}try{w(!0),k("");const W=localStorage.getItem("access")||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxIiwic3VibWlzc2lvbl9pZCI6IjIiLCJqdGkiOiJmNWM3M2Y1NzM5NDc0YTIyOTQ1MzgwOGUxMDkxNTY2NCIsImlhdCI6MTc2MjQzNjExMCwibmJmIjoxNzYyNDM2MTEwLCJleHAiOjE3NjI0NzIxMTAsImlzcyI6IkFyY29uLklEVi5BUEkiLCJhdWQiOiJBcmNvbi5JRFYuQ2xpZW50In0.ASHPD25bzLVLXdlfrm0Qh-C02QC5kyf3RUwQI72dDJ8";localStorage.setItem("submissionId",i.toString());const H=await fetch("https://idvapi-test.arconnet.com:1019/api/handoff/start",{method:"POST",headers:{accept:"text/plain",Authorization:`Bearer ${W}`,"Content-Type":"application/json"},body:JSON.stringify({submissionId:i,ttlSeconds:1e6})});if(!H.ok){const J=await H.text();throw new Error(`Failed to start handoff: ${J}`)}const G=await H.json(),M=G.joinCode;console.log("Handoff API Response:",G),console.log("Join Code:",M);const z=`https://idvuser-test.arconnet.com:1017 /HandoffPage/${M}`,K=await UJ({shortCode:M,templateVersionId:t,userId:r,sessionId:s,currentStep:o});x(K),y(z),await D(W,i)}catch(W){console.error("Failed to generate QR code:",W),k("Failed to generate QR code")}finally{w(!1)}})()},[T,e,t,r,s,o,i]);const D=async(L,W)=>{try{I.current&&await I.current.stop();const H=zk(),G=window.location.pathname.includes("/HandoffPage/")?"Mobile (Device 2)":"Desktop (Device 1)";console.log(` ${G} Device Fingerprint for SignalR:`,H);const j=new P$().withUrl(`wss://idvapi-test.arconnet.com:1019/hubs/handoff?access_token=${L}`,{skipNegotiation:!0,transport:ds.WebSockets,headers:{"X-Device-Fingerprint":H}}).configureLogging(Ue.Debug).build();try{j.serverTimeoutInMilliseconds=300*1e3,j.keepAliveIntervalInMilliseconds=15*1e3}catch(V){console.warn("Could not set client timeout/keep-alive properties",V)}j.onreconnecting(V=>{console.log(" SignalR reconnecting...",V),console.log(" Reconnection attempt due to:",V?.message||"Unknown reason"),f({title:"Reconnecting...",description:"Connection lost, attempting to reconnect.",duration:3e3})}),j.onreconnected(V=>{console.log(" SignalR reconnected with connectionId:",V),f({title:" Reconnected",description:"Connection restored successfully.",duration:3e3})}),j.onclose(V=>{console.log(""),console.error(" SignalR CONNECTION CLOSED"),console.error(" Close reason:",V?.message||"No error provided"),console.error(" Error details:",V),console.error(" Connection was in state:",j.state),console.log("");const K=j._heartbeatInterval;K&&(clearInterval(K),console.log(" Heartbeat interval cleared on connection close")),V?f({title:" Connection Lost",description:`Connection closed: ${V.message}`,variant:"destructive",duration:5e3}):console.log(" Connection closed gracefully (no error)")}),j.on("personal.updated",V=>{console.log(" personal.updated - RAW Data:",JSON.stringify(V,null,2)),f({title:" Personal Info Updated",description:"Personal information has been updated from another device",duration:4e3})}),j.on("file.upload.completed",V=>{console.log(" file.upload.completed - RAW Data:",JSON.stringify(V,null,2)),f({title:" File Uploaded",description:`Document uploaded: ${V.data?.fileName||"Unknown file"}`,duration:4e3})}),j.on("ReceiveNotification",V=>{console.log(""),console.log(" SignalR Updated: ReceiveNotification"),console.log(""),console.log(" RAW Message:",V),console.log(`
`),f({title:" Notification",description:V.length>100?V.substring(0,100)+"...":V,duration:3e3})}),console.log(" Registered handlers for: personal.updated, file.upload.completed, ReceiveNotification"),await j.start(),n.connectionRef&&(n.connectionRef.current=j),n.onConnected&&n.onConnected(),console.log(""),console.log(" SignalR CONNECTED to handoff hub"),console.log(" Connection State:",j.state),console.log(" Connection ID:",j.connectionId),console.log(" Transport:","WebSockets"),console.log(" Submission ID:",W),console.log(" Device Fingerprint:",H),console.log(" Access Token (first 50 chars):",L.substring(0,50)+"..."),console.log("");try{console.log(" Attempting to invoke JoinSubmission on hub with submissionId:",W),await j.invoke("JoinSubmission",W),console.log(" Successfully joined submission:",W)}catch(V){console.warn(" JoinSubmission method not available or failed:",V.message),console.log(" Backend might auto-register based on JWT token in URL")}f({title:" Connected",description:`Real-time updates enabled for submission:${W}`,duration:3e3});const z=setInterval(async()=>{if(j.state===Dr.Connected)try{await j.invoke("Ping"),console.log(" Heartbeat - Ping invoked")}catch(V){console.log(" Heartbeat - ping invoke failed or not supported",V?.message||V)}else console.warn(" Heartbeat - Connection not in Connected state:",j.state),clearInterval(z)},3e4);j._heartbeatInterval=z}catch(H){console.error(" SignalR connection failed:",H),f({title:"Connection Error",description:"Failed to connect to real-time updates.",variant:"destructive",duration:4e3})}};_.useEffect(()=>()=>{console.log(" QRCodeDisplay unmounting - keeping SignalR connection alive")},[]),_.useEffect(()=>{if(T!==2)return;const L=W=>{W.key==="Escape"&&F(1)};return window.addEventListener("keydown",L),()=>window.removeEventListener("keydown",L)},[T]);const A=()=>{T===0?F(1):T===1&&p&&F(2)};if(b)return m.jsx("div",{className:`flex justify-center items-center ${R[a]} ${c}`,children:m.jsx(Wk,{className:"rounded-full h-8 w-8 text-[#0073EA]"})});if(S)return m.jsxs("div",{className:`flex flex-col justify-center items-center ${R[a]} ${c} bg-gray-100 rounded-lg`,children:[m.jsx(bJ,{className:"w-6 h-6 text-gray-400 mb-1"}),m.jsx("span",{className:"text-xs text-gray-500 text-center",children:"QR Error"})]});if(T===0)return m.jsx("div",{className:`relative flex items-center justify-center cursor-pointer ${R[a]} ${c}`,onClick:A,style:{userSelect:"none"},title:"Click to generate QR",children:m.jsxs("div",{className:"absolute inset-0 flex items-center justify-center bg-white rounded-lg overflow-hidden",children:[m.jsx("div",{className:"w-full h-full flex items-center justify-center",children:m.jsxs("svg",{width:"100%",height:"100%",viewBox:"0 0 120 120",className:"block",children:[m.jsx("rect",{x:"0",y:"0",width:"120",height:"120",rx:"16",fill:"#e5e7eb"}),m.jsx("rect",{x:"20",y:"20",width:"80",height:"80",fill:"#d1d5db"}),m.jsx("rect",{x:"40",y:"40",width:"40",height:"40",fill:"#9ca3af"})]})}),m.jsx("div",{className:"absolute inset-0 backdrop-blur-sm bg-white/60 flex items-center justify-center rounded-lg",children:m.jsx("span",{className:"text-base font-semibold text-gray-700",children:"Click to Generate"})})]})});const P=m.jsxs("div",{className:`flex flex-col items-center gap-2 ${c}`,children:[p?m.jsx("img",{src:p,alt:"QR Code for verification",className:`${R[a]} object-contain rounded-lg border-2 border-white shadow-lg bg-white p-2 transition-all duration-200 cursor-zoom-in`,onClick:()=>F(2),onError:L=>{console.error("QR Code image failed to load:",L),k("Failed to display QR code")}}):m.jsx("div",{className:`${R[a]} bg-gray-100 rounded-lg flex items-center justify-center`,children:m.jsx("span",{className:"text-gray-500 text-xs",children:"No QR Code"})}),l&&v&&m.jsx("div",{className:"text-xs text-[#0073EA] text-center break-all max-w-[200px]",children:v.length>40?`${v.substring(0,40)}...`:v})]}),B=T===2&&p?m.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70",onClick:L=>{L.currentTarget===L.target&&F(1)},children:m.jsxs("div",{className:"relative p-4 bg-white rounded-lg shadow-2xl",children:[m.jsx("button",{className:"absolute -top-3 -right-3 w-8 h-8 rounded-full bg-black/80 text-white flex items-center justify-center",onClick:()=>F(1),"aria-label":"Close enlarged QR",children:""}),m.jsx("img",{src:p,alt:"Enlarged QR Code",className:`${R.enlarged} object-contain rounded-lg border border-gray-200`}),l&&v&&m.jsx("div",{className:"mt-3 text-xs text-[#0073EA] text-center break-all max-w-[320px] mx-auto",children:v})]})}):null;return m.jsxs(m.Fragment,{children:[P,B]})}const _C="idv_session_state",TQ=5e3;function _Q(n){const[e,t]=_.useState(()=>{const o=localStorage.getItem(_C);if(o)try{const i=JSON.parse(o);return{sessionId:RC(),currentStep:"document-upload",uploadedDocuments:[],formData:{},lastUpdated:Date.now(),...i,...n}}catch(i){console.error("Failed to parse saved session:",i)}return{sessionId:RC(),currentStep:"document-upload",uploadedDocuments:[],formData:{},lastUpdated:Date.now(),...n}});_.useEffect(()=>{localStorage.setItem(_C,JSON.stringify(e))},[e]);const r=_.useCallback(o=>{t(i=>({...i,...o,lastUpdated:Date.now()}))},[]),s=_.useCallback(()=>{localStorage.removeItem(_C),t({sessionId:RC(),currentStep:"document-upload",uploadedDocuments:[],formData:{},lastUpdated:Date.now(),...n})},[n]);return _.useEffect(()=>{const o=setInterval(()=>{console.log("Session sync check:",e.sessionId)},TQ);return()=>clearInterval(o)},[e.sessionId]),{sessionState:e,updateSession:r,clearSession:s}}function RC(){return`session_${Date.now()}_${Math.random().toString(36).substring(2,15)}`}const DC="https://idvapi-test.arconnet.com:1019";function O$({onComplete:n,documentConfig:e={},submissionId:t,shortCode:r="",templateVersionId:s,userId:o,documentFormState:i,setDocumentFormState:a,onDocumentUploaded:l,setIsIdentityDocumentCompleted:c,connectionRef:u,shouldMaintainConnection:d,onHandoffConnected:f}){const[p,x]=_.useState(""),[v,y]=_.useState(""),[b,w]=_.useState(!1),[S,k]=_.useState(!1),[N,I]=_.useState([]),[T,F]=_.useState([]),[R,D]=_.useState({}),[A,P]=_.useState(!1),[B,L]=_.useState(!1),[W,H]=_.useState(null),[G,M]=_.useState(!1),j=`${r||"unknown"}:${t||0}`,z=async()=>{try{P(!0);const Ee=`http://10.10.2.133:8086/api/IdentityVerification/generate-auth-url?getBackString=${encodeURIComponent(j)}`,Ge=await fetch(Ee,{method:"GET",headers:{accept:"*/*"}});if(!Ge.ok){const it=await Ge.text().catch(()=>"");throw new Error(`Failed to generate auth URL: ${Ge.status} ${it}`)}const{url:Q,codeVerifier:ht}=await Ge.json();sessionStorage.setItem("digilocker_code_verifier",ht||""),sessionStorage.setItem("digilocker_state",j),sessionStorage.setItem("digilocker_selected_document",J||""),sessionStorage.setItem("digilocker_country",K||""),window.location.href=Q}catch(Ee){console.error(Ee),alert("Could not start DigiLocker flow. Please try again.")}finally{P(!1)}},V=!!(i&&a),K=V?i.country:p,J=V?i.selectedDocument:v,oe=V?i.uploadedDocuments:N;V&&i.uploadedFiles;const Z=V?i.documentUploadIds:R,de=Ee=>{V?a(Ge=>({...Ge,country:Ee})):x(Ee)},pe=Ee=>{V?a(Ge=>({...Ge,selectedDocument:Ee})):y(Ee)},Ce=Ee=>{if(V){const Ge=typeof Ee=="function"?Ee(i.uploadedDocuments):Ee;a(Q=>({...Q,uploadedDocuments:Ge}))}else I(Ee)},Ae=Ee=>{if(V){const Ge=typeof Ee=="function"?Ee(i.uploadedFiles):Ee;a(Q=>({...Q,uploadedFiles:Ge}))}else F(Ee),console.log(" Setting local uploadedFiles")},ze=Ee=>{if(V){const Ge=typeof Ee=="function"?Ee(i.documentUploadIds):Ee;a(Q=>({...Q,documentUploadIds:Ge}))}else D(Ee)},et=(Ee,Ge,Q,ht,it,Yt)=>{V&&a(cn=>{const Lt=cn.documentsDetails.findIndex(Jn=>Jn.documentName===Ee),On={documentName:Ee,documentDefinitionId:Ge,frontFileId:Q,backFileId:ht,frontETag:it,backETag:Yt,status:"uploaded",uploadedAt:new Date().toISOString()};let An;return Lt>=0?(An=[...cn.documentsDetails],An[Lt]=On):An=[...cn.documentsDetails,On],console.log(" Updated documentsDetails:",An),{...cn,documentsDetails:An}})},[gt,dt]=_.useState(0);_.useEffect(()=>{if(!V||!i)return;const Ee=i.documentsDetails.length;Ee>gt&&Ee>0&&(dt(Ee),setTimeout(()=>{l?.(i.documentsDetails)},200))},[i?.documentsDetails,V,l]);const{sessionState:Ct,updateSession:lt}=_Q({shortCode:r,templateVersionId:s,userId:o,currentStep:"document-upload",uploadedDocuments:oe,formData:{country:K,selectedDocument:J}});_.useEffect(()=>{lt({uploadedDocuments:oe,formData:{country:K,selectedDocument:J},currentStep:"document-upload"})},[oe,K,J]);const{toast:bt}=pd();_.useEffect(()=>{const Ee=sessionStorage.getItem("digilocker_auth_code"),Ge=sessionStorage.getItem("digilocker_callback_state"),Q=sessionStorage.getItem("digilocker_callback_timestamp"),ht=Q&&Date.now()-parseInt(Q)<300*1e3;if(!Ee||!Ge||!ht)return;console.log(" Processing DigiLocker callback data");const it=async()=>{const cn=sessionStorage.getItem("digilocker_code_verifier")||"",Lt=sessionStorage.getItem("digilocker_state")||"";if(Lt&&Ge!==Lt){console.warn(" DigiLocker state mismatch");return}const[On,An]=Ge.split(":");console.log(" DigiLocker callback context:",{shortCode:On,submissionId:An});const Jn=bn=>({aadhaar_card:"Aadhar Card",passport:"Passport",pan_card:"Pan Card",driving_license:"Driving License",voter_id:"Voter ID"})[bn];sessionStorage.getItem("digilocker_selected_document");const nr=sessionStorage.getItem("digilocker_country")||K||"";nr&&!K&&de(nr);const gr="pan_card",xt=ct(nr||K||"").map(bn=>typeof bn=="string"?bn:bn.title).find(bn=>q(bn)===gr)||gr.replace(/_/g," ").replace(/\b\w/g,bn=>bn.toUpperCase()),In=Jn(gr);let _n=Nt(nr||K||"",xt)||"";_n||(_n=String(Pv(nr||K||"",xt)));const xr=3,cr="siddhi.tawde@arconnet.com",kr="Test Template",fr=new URL("http://10.10.2.133:8086/api/IdentityVerification/fetch-document");fr.searchParams.set("AuthCode",Ee),fr.searchParams.set("CodeVerifier",cn),fr.searchParams.set("RequestedDocType",In),fr.searchParams.set("EmailID",cr),fr.searchParams.set("DocumentID",String(xr)),fr.searchParams.set("TemplateName",kr);try{const bn=await fetch(fr.toString(),{method:"POST",headers:{accept:"*/*"},body:""});if(!bn.ok){const ls=await bn.text().catch(()=>"");throw console.error(" DigiLocker document fetch failed:",{status:bn.status,statusText:bn.statusText,text:ls}),new Error(`Failed to fetch document: ${bn.status} ${ls}`)}const Sr=await bn.json().catch(ls=>{throw console.error(" Failed to parse DigiLocker response:",ls),new Error("Invalid response from DigiLocker service")});if(console.log(" DigiLocker response:",Sr),!Sr||typeof Sr.success!="boolean")throw new Error("Invalid document data received from DigiLocker");if(Sr.success===!0){pe(gr);const ls=Number.isFinite(Sr.id)?Number(Sr.id):void 0;ke({docId:gr,displayName:xt,fileId:ls,source:"DigiLocker"}),bt({title:`${xt} Uploaded`,description:Sr.message||"Document saved successfully.",duration:5e3})}else bt({title:"Document Fetch Failed",description:Sr.message||"Failed to fetch document from DigiLocker",duration:5e3,variant:"destructive"})}catch(bn){console.error(" Error fetching DigiLocker document:",bn),bt({title:"Error",description:"Could not fetch DigiLocker document. Please try again.",duration:5e3,variant:"destructive"})}finally{sessionStorage.removeItem("digilocker_auth_code"),sessionStorage.removeItem("digilocker_callback_state"),sessionStorage.removeItem("digilocker_callback_timestamp"),sessionStorage.removeItem("digilocker_code_verifier"),sessionStorage.removeItem("digilocker_state"),sessionStorage.removeItem("digilocker_skip_consent"),sessionStorage.removeItem("digilocker_selected_document"),sessionStorage.removeItem("digilocker_country"),console.log(" DigiLocker session data cleaned up")}};(async()=>{if(Ee&&Ge)try{await it(),c?.(!0)}catch(cn){console.error("Failed to process DigiLocker callback:",cn)}})()},[]),_.useEffect(()=>{const Ee=HJ();Ee.sessionId&&console.log("Loading session from QR scan:",Ee)},[]);const rn=(Ee,Ge)=>{const Q=new FormData;Q.append("File",Ee,Ge);const ht=sn.find(cn=>cn.toLowerCase().replace(/\s+/g,"_")===J)||"";let it=Nt(K,ht);it||(console.warn(`Document definition ID not found in config for ${ht}, using fallback mapping`),it=Pv(K,ht)),Q.append("DocumentDefinitionId",it),Q.append("Bucket","string");const Yt=t?.toString()||"1";return Q.append("UserTemplateSubmissionId",Yt),Q},Ft=async(Ee,Ge,Q)=>{const ht=`${DC}/api/Files/upload`,it=rn(Ee,Ge),Yt=zk(),cn=await fetch(ht,{method:"POST",body:it,headers:{"X-Device-Fingerprint":Yt}});if(!cn.ok&&cn.status!==201)throw new Error(`POST failed: ${cn.statusText}`);const Lt=await cn.json().catch(()=>({})),On=Lt&&Lt.file&&typeof Lt.file.id=="number"&&Lt.file.id||typeof Lt.id=="number"&&Lt.id||Lt&&Lt.mapping&&typeof Lt.mapping.fileId=="number"&&Lt.mapping.fileId||null;if(!On)throw new Error("Upload did not return an id");const An=Lt?.file?.eTag||null;return{id:On,eTag:An}},vn=async(Ee,Ge)=>{try{console.log(" Starting download for fileId:",Ee,"fileName:",Ge);const Q=`${DC}/api/Files/${Ee}/content?inline=false`;console.log(" Download URL:",Q);const ht=await fetch(Q,{method:"GET",headers:{Accept:"*/*"}});if(console.log(" Download response status:",ht.status),!ht.ok)throw new Error(`Failed to download file: ${ht.statusText}`);const it=await ht.blob();console.log(" Downloaded blob size:",it.size,"bytes");const Yt=window.URL.createObjectURL(it),cn=document.createElement("a");cn.href=Yt,cn.download=Ge||`document-${Ee}`,document.body.appendChild(cn),cn.click(),console.log(" Download triggered for:",Ge),window.URL.revokeObjectURL(Yt),document.body.removeChild(cn)}catch(Q){console.error(" Error downloading file:",Q),alert(`Failed to download file: ${Q instanceof Error?Q.message:"Unknown error"}`)}},te=async Ee=>{console.log(" downloadDocumentFiles called for docId:",Ee),console.log(" Available documentUploadIds:",Z);const Ge=Z[Ee];if(!Ge){console.error(" No fileIds found for docId:",Ee),alert("No files found for this document");return}console.log(" Found fileIds:",Ge);const Q=sn.find(ht=>ht.toLowerCase().replace(/\s+/g,"_")===Ee)||Ee.replace(/_/g," ");console.log(" Document name:",Q),Ge.front&&(console.log(" Downloading front file, ID:",Ge.front),await vn(Ge.front,`${Q} - Front.jpg`)),Ge.back&&(console.log(" Downloading back file (after 500ms delay), ID:",Ge.back),setTimeout(()=>{vn(Ge.back,`${Q} - Back.jpg`)},500))},q=Ee=>Ee.trim().toLowerCase().replace(/\s+/g,"_"),ke=({docId:Ee,displayName:Ge,fileId:Q,source:ht="DigiLocker"})=>{if(Ce(it=>it.includes(Ee)?it:[...it,Ee]),Ae(it=>[...it.filter(cn=>!cn.id.startsWith(`${Ee}-`)),{id:`${Ee}-${Q??"remote"}`,name:`${Ge} (${ht})`,size:ht==="DigiLocker"?"Fetched remotely":"Uploaded",type:"application/pdf"}]),ze(it=>({...it,[Ee]:{...it[Ee]||{},...typeof Q=="number"?{front:Q}:{}}})),V){const it=Rt();if(it&&typeof Q=="number"){const Yt={documentName:Ge,documentDefinitionId:it,frontFileId:Q,backFileId:void 0,frontETag:void 0,backETag:void 0,status:"uploaded",uploadedAt:new Date().toISOString()},Lt=[...i?.documentsDetails||[],Yt];et(Ge,it,Q),queueMicrotask(()=>{setTimeout(()=>{l&&(console.log(" POST request triggered after DigiLocker upload:",Ge),console.log(" Documents to be sent:",Lt.map(On=>On.documentName)),l(Lt))},200)})}else l?.()}else l?.();c?.(!0),n?.(),pe("")},He=async(Ee,Ge)=>{try{console.log(" Deleting file ID:",Ee,"with eTag:",Ge);const Q=`${DC}/api/Files/${Ee}`;console.log(" Delete URL:",Q);const ht={Accept:"*/*"};if(Ge){const Yt=Ge.replace(/^W\/"|"$/g,"");ht["If-Match"]=Yt,console.log(" Using If-Match header:",Yt)}const it=await fetch(Q,{method:"DELETE",headers:ht});if(console.log(" Delete response status:",it.status),!it.ok)throw new Error(`Failed to delete file: ${it.statusText}`);return console.log(" File deleted successfully:",Ee),!0}catch(Q){throw console.error(" Error deleting file:",Q),Q}},Ke=async Ee=>{const Ge=Z[Ee];if(!Ge){console.error(" No fileIds found for docId:",Ee),alert("No files found for this document");return}const Q=sn.find(ht=>ht.toLowerCase().replace(/\s+/g,"_")===Ee)||Ee.replace(/_/g," ");try{M(!0);const ht=[];Ge.front&&(console.log(" Deleting front file, ID:",Ge.front,"eTag:",Ge.frontETag),ht.push(He(Ge.front,Ge.frontETag))),Ge.back&&(console.log(" Deleting back file, ID:",Ge.back,"eTag:",Ge.backETag),ht.push(He(Ge.back,Ge.backETag))),await Promise.all(ht),Ce(it=>it.filter(Yt=>Yt!==Ee)),Ae(it=>it.filter(Yt=>Yt.id.replace(/-\d+$/,"")!==Ee)),ze(it=>{const Yt={...it};return delete Yt[Ee],t&&localStorage.setItem(`documentUploadIds_${t}`,JSON.stringify(Yt)),Yt}),V&&a(it=>{const Yt=it.documentsDetails.filter(cn=>{const Lt=Ge.front?cn.frontFileId===Ge.front:!1,On=Ge.back?cn.backFileId===Ge.back:!1,An=cn.documentName===Q;return!(Lt||On||An)});return console.log(" Removed from documentsDetails (by fileId/name):",Q),console.log(" Updated documentsDetails after deletion:",Yt),console.log(" Remaining documents count:",Yt.length),queueMicrotask(()=>{setTimeout(()=>{l&&(console.log(" POST request triggered after deleting:",Q),console.log(" Remaining documents to be sent:",Yt.map(cn=>cn.documentName)),l(Yt))},200)}),{...it,documentsDetails:Yt}}),localStorage.removeItem(`document_${Ee}_image`),console.log(" Document deleted successfully:",Q),console.log(` ${Q} deleted and backend will be updated with remaining documents`)}catch(ht){console.error(" Error deleting document:",ht),alert(`Failed to delete ${Q}. Please try again.`)}finally{M(!1),L(!1),H(null)}},Be=e.supportedCountries||[],ct=Ee=>Be.find(Q=>Q.countryName===Ee)?.documents||[],Nt=(Ee,Ge)=>{const Q=Be.find(it=>it.countryName===Ee);if(!Q)return null;const ht=Q.documents.find(it=>typeof it=="string"?it===Ge:it.title===Ge);return ht&&typeof ht!="string"&&ht.documentDefinitionId?ht.documentDefinitionId:null},Rt=()=>{if(!K||!J)return null;const Ee=sn.find(ht=>ht.toLowerCase().replace(/\s+/g,"_")===J);if(!Ee)return null;let Ge=Nt(K,Ee);return Ge||(Ge=Pv(K,Ee)),Ge?typeof Ge=="string"&&Ge.includes("-")?Ge:parseInt(Ge,10):null},sn=K?ct(K).map(Ee=>typeof Ee=="string"?Ee:Ee.title):[],Kn=Ee=>({Passport:{color:"#5A43D6",icon:m.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M12 21.5C10.6975 21.5 9.46833 21.2503 8.3125 20.751C7.15667 20.2517 6.14867 19.5718 5.2885 18.7115C4.42817 17.8513 3.74833 16.8433 3.249 15.6875C2.74967 14.5317 2.5 13.3025 2.5 12C2.5 10.6872 2.74967 9.45542 3.249 8.30475C3.74833 7.15408 4.42817 6.14867 5.2885 5.2885C6.14867 4.42817 7.15667 3.74833 8.3125 3.249C9.46833 2.74967 10.6975 2.5 12 2.5C13.3128 2.5 14.5446 2.74967 15.6953 3.249C16.8459 3.74833 17.8513 4.42817 18.7115 5.2885C19.5718 6.14867 20.2517 7.15408 20.751 8.30475C21.2503 9.45542 21.5 10.6872 21.5 12C21.5 13.3025 21.2503 14.5317 20.751 15.6875C20.2517 16.8433 19.5718 17.8513 18.7115 18.7115C17.8513 19.5718 16.8459 20.2517 15.6953 20.751C14.5446 21.2503 13.3128 21.5 12 21.5ZM12 19.9788C12.5103 19.3019 12.9398 18.6192 13.2885 17.9307C13.6372 17.2422 13.9212 16.4897 14.1405 15.673H9.8595C10.0917 16.5153 10.3789 17.2808 10.7213 17.9693C11.0634 18.6578 11.4897 19.3276 12 19.9788ZM10.0635 19.7038C9.68017 19.1538 9.33592 18.5285 9.03075 17.828C8.72558 17.1273 8.48842 16.409 8.31925 15.673H4.927C5.45517 16.7115 6.1635 17.584 7.052 18.2905C7.9405 18.9968 8.94433 19.4679 10.0635 19.7038ZM13.9365 19.7038C15.0557 19.4679 16.0595 18.9968 16.948 18.2905C17.8365 17.584 18.5448 16.7115 19.073 15.673H15.6807C15.4794 16.4153 15.2262 17.1368 14.921 17.8375C14.616 18.5382 14.2878 19.1603 13.9365 19.7038ZM4.298 14.173H8.0155C7.95267 13.8013 7.90708 13.4369 7.87875 13.0798C7.85058 12.7228 7.8365 12.3628 7.8365 12C7.8365 11.6372 7.85058 11.2773 7.87875 10.9202C7.90708 10.5631 7.95267 10.1987 8.0155 9.827H4.298C4.20183 10.1667 4.12817 10.5198 4.077 10.8865C4.02567 11.2532 4 11.6243 4 12C4 12.3757 4.02567 12.7468 4.077 13.1135C4.12817 13.4802 4.20183 13.8333 4.298 14.173ZM9.51525 14.173H14.4848C14.5474 13.8013 14.5929 13.4402 14.6212 13.0895C14.6494 12.7388 14.6635 12.3757 14.6635 12C14.6635 11.6243 14.6494 11.2612 14.6212 10.9105C14.5929 10.5598 14.5474 10.1987 14.4848 9.827H9.51525C9.45258 10.1987 9.40708 10.5598 9.37875 10.9105C9.35058 11.2612 9.3365 11.6243 9.3365 12C9.3365 12.3757 9.35058 12.7388 9.37875 13.0895C9.40708 13.4402 9.45258 13.8013 9.51525 14.173ZM15.9845 14.173H19.702C19.7982 13.8333 19.8718 13.4802 19.923 13.1135C19.9743 12.7468 20 12.3757 20 12C20 11.6243 19.9743 11.2532 19.923 10.8865C19.8718 10.5198 19.7982 10.1667 19.702 9.827H15.9845C16.0473 10.1987 16.0929 10.5631 16.1212 10.9202C16.1494 11.2773 16.1635 11.6372 16.1635 12C16.1635 12.3628 16.1494 12.7228 16.1212 13.0798C16.0929 13.4369 16.0473 13.8013 15.9845 14.173ZM15.6807 8.327H19.073C18.5385 7.27567 17.835 6.40317 16.9625 5.7095C16.09 5.016 15.0813 4.54167 13.9365 4.2865C14.3198 4.8685 14.6608 5.50508 14.9595 6.19625C15.2583 6.88725 15.4987 7.5975 15.6807 8.327ZM9.8595 8.327H14.1405C13.9083 7.491 13.6163 6.72075 13.2645 6.01625C12.9125 5.31175 12.491 4.64675 12 4.02125C11.509 4.64675 11.0875 5.31175 10.7355 6.01625C10.3837 6.72075 10.0917 7.491 9.8595 8.327ZM4.927 8.327H8.31925C8.50125 7.5975 8.74167 6.88725 9.0405 6.19625C9.33917 5.50508 9.68017 4.8685 10.0635 4.2865C8.91217 4.54167 7.90192 5.01767 7.03275 5.7145C6.16342 6.41117 5.4615 7.282 4.927 8.327Z",fill:"white"})})},"Driver License":{color:"#ED5F00",icon:m.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M4.30775 20.5C3.80258 20.5 3.375 20.325 3.025 19.975C2.675 19.625 2.5 19.1974 2.5 18.6923V5.30775C2.5 4.80258 2.675 4.375 3.025 4.025C3.375 3.675 3.80258 3.5 4.30775 3.5H19.6923C20.1974 3.5 20.625 3.675 20.975 4.025C21.325 4.375 21.5 4.80258 21.5 5.30775V18.6923C21.5 19.1974 21.325 19.625 20.975 19.975C20.625 20.325 20.1974 20.5 19.6923 20.5H4.30775ZM4.30775 19H19.6923C19.7693 19 19.8398 18.9679 19.9038 18.9038C19.9679 18.8398 20 18.7692 20 18.6923V5.30775C20 5.23075 19.9679 5.16025 19.9038 5.09625C19.8398 5.03208 19.7693 5 19.6923 5H4.30775C4.23075 5 4.16025 5.03208 4.09625 5.09625C4.03208 5.16025 4 5.23075 4 5.30775V18.6923C4 18.7692 4.03208 18.8398 4.09625 18.9038C4.16025 18.9679 4.23075 19 4.30775 19ZM5.25 16.75H9.75V15.25H5.25V16.75ZM14.55 14.6442L19.1443 10.05L18.075 8.98075L14.55 12.5308L13.125 11.1057L12.0808 12.175L14.55 14.6442ZM5.25 12.75H9.75V11.25H5.25V12.75ZM5.25 8.75H9.75V7.25H5.25V8.75Z",fill:"white"})})},"State ID":{color:"#00B499",icon:m.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M12 17.6923C11.0153 17.6923 10.066 17.8509 9.152 18.1683C8.23783 18.4856 7.39225 18.9679 6.61525 19.6152C6.62808 19.7064 6.66342 19.7882 6.72125 19.8605C6.77892 19.933 6.843 19.9795 6.9135 20H17.077C17.1475 19.9795 17.2116 19.933 17.2693 19.8605C17.3269 19.7882 17.3622 19.7064 17.375 19.6152C16.6108 18.9679 15.7718 18.4856 14.8577 18.1683C13.9436 17.8509 12.991 17.6923 12 17.6923ZM12 16.1923C13.15 16.1923 14.225 16.3673 15.225 16.7172C16.225 17.0673 17.15 17.5589 18 18.1923V4.30775C18 4.23075 17.9679 4.16025 17.9038 4.09625C17.8398 4.03208 17.7692 4 17.6923 4H6.30775C6.23075 4 6.16025 4.03208 6.09625 4.09625C6.03208 4.16025 6 4.23075 6 4.30775V18.1923C6.85 17.5589 7.775 17.0673 8.775 16.7172C9.775 16.3673 10.85 16.1923 12 16.1923ZM12 12.5385C11.5192 12.5385 11.1073 12.367 10.7645 12.024C10.4215 11.6812 10.25 11.2693 10.25 10.7885C10.25 10.3077 10.4215 9.89583 10.7645 9.553C11.1073 9.21 11.5192 9.0385 12 9.0385C12.4808 9.0385 12.8927 9.21 13.2355 9.553C13.5785 9.89583 13.75 10.3077 13.75 10.7885C13.75 11.2693 13.5785 11.6812 13.2355 12.024C12.8927 12.367 12.4808 12.5385 12 12.5385ZM6.30775 21.5C5.80258 21.5 5.375 21.325 5.025 20.975C4.675 20.625 4.5 20.1974 4.5 19.6923V4.30775C4.5 3.80258 4.675 3.375 5.025 3.025C5.375 2.675 5.80258 2.5 6.30775 2.5H17.6923C18.1974 2.5 18.625 2.675 18.975 3.025C19.325 3.375 19.5 3.80258 19.5 4.30775V19.6923C19.5 20.1974 19.325 20.625 18.975 20.975C18.625 21.325 18.1974 21.5 17.6923 21.5H6.30775ZM12 14.0385C12.9025 14.0385 13.6698 13.7225 14.302 13.0905C14.934 12.4583 15.25 11.691 15.25 10.7885C15.25 9.886 14.934 9.11867 14.302 8.4865C13.6698 7.8545 12.9025 7.5385 12 7.5385C11.0975 7.5385 10.3302 7.8545 9.698 8.4865C9.066 9.11867 8.75 9.886 8.75 10.7885C8.75 11.691 9.066 12.4583 9.698 13.0905C10.3302 13.7225 11.0975 14.0385 12 14.0385Z",fill:"white"})})},"Social Security Card":{color:"#9C2BAD",icon:m.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M14.077 12.7308H18.6152V11.2308H14.077V12.7308ZM14.077 9.84625H18.6152V8.34625H14.077V9.84625ZM5.38475 15.6538H12.6923V15.2963C12.6923 14.6296 12.3624 14.1058 11.7028 13.725C11.0433 13.3442 10.1552 13.1538 9.0385 13.1538C7.92183 13.1538 7.03367 13.3442 6.374 13.725C5.7145 14.1058 5.38475 14.6296 5.38475 15.2963V15.6538ZM9.0385 11.8463C9.52433 11.8463 9.93742 11.676 10.2777 11.3355C10.6182 10.9952 10.7885 10.5821 10.7885 10.0962C10.7885 9.61025 10.6182 9.19708 10.2777 8.85675C9.93742 8.51642 9.52433 8.34625 9.0385 8.34625C8.55267 8.34625 8.1395 8.51642 7.799 8.85675C7.45867 9.19708 7.2885 9.61025 7.2885 10.0962C7.2885 10.5821 7.45867 10.9952 7.799 11.3355C8.1395 11.676 8.55267 11.8463 9.0385 11.8463ZM4.30775 19.5C3.80258 19.5 3.375 19.325 3.025 18.975C2.675 18.625 2.5 18.1974 2.5 17.6923V6.30775C2.5 5.80258 2.675 5.375 3.025 5.025C3.375 4.675 3.80258 4.5 4.30775 4.5H19.6923C20.1974 4.5 20.625 4.675 20.975 5.025C21.325 5.375 21.5 5.80258 21.5 6.30775V17.6923C21.5 18.1974 21.325 18.625 20.975 18.975C20.625 19.325 20.1974 19.5 19.6923 19.5H4.30775ZM4.30775 18H19.6923C19.7693 18 19.8398 17.9679 19.9038 17.9038C19.9679 17.8398 20 17.7692 20 17.6923V6.30775C20 6.23075 19.9679 6.16025 19.9038 6.09625C19.8398 6.03208 19.7693 6 19.6923 6H4.30775C4.23075 6 4.16025 6.03208 4.09625 6.09625C4.03208 6.16025 4 6.23075 4 6.30775V17.6923C4 17.7692 4.03208 17.8398 4.09625 17.9038C4.16025 17.9679 4.23075 18 4.30775 18Z",fill:"white"})})}})[Ee]||{color:"#5A43D6",icon:m.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M14.077 12.7308H18.6152V11.2308H14.077V12.7308ZM14.077 9.84625H18.6152V8.34625H14.077V9.84625ZM5.38475 15.6538H12.6923V15.2963C12.6923 14.6296 12.3624 14.1058 11.7028 13.725C11.0433 13.3442 10.1552 13.1538 9.0385 13.1538C7.92183 13.1538 7.03367 13.3442 6.374 13.725C5.7145 14.1058 5.38475 14.6296 5.38475 15.2963V15.6538ZM9.0385 11.8463C9.52433 11.8463 9.93742 11.676 10.2777 11.3355C10.6182 10.9952 10.7885 10.5821 10.7885 10.0962C10.7885 9.61025 10.6182 9.19708 10.2777 8.85675C9.93742 8.51642 9.52433 8.34625 9.0385 8.34625C8.55267 8.34625 8.1395 8.51642 7.799 8.85675C7.45867 9.19708 7.2885 9.61025 7.2885 10.0962C7.2885 10.5821 7.45867 10.9952 7.799 11.3355C8.1395 11.676 8.55267 11.8463 9.0385 11.8463ZM4.30775 19.5C3.80258 19.5 3.375 19.325 3.025 18.975C2.675 18.625 2.5 18.1974 2.5 17.6923V6.30775C2.5 5.80258 2.675 5.375 3.025 5.025C3.375 4.675 3.80258 4.5 4.30775 4.5H19.6923C20.1974 4.5 20.625 4.675 20.975 5.025C21.325 5.375 21.5 5.80258 21.5 6.30775V17.6923C21.5 18.1974 21.325 18.625 20.975 18.975C20.625 19.325 20.1974 19.5 19.6923 19.5H4.30775ZM4.30775 18H19.6923C19.7693 18 19.8398 17.9679 19.9038 17.9038C19.9679 17.8398 20 17.7692 20 17.6923V6.30775C20 6.23075 19.9679 6.16025 19.9038 6.09625C19.8398 6.03208 19.7693 6 19.6923 6H4.30775C4.23075 6 4.16025 6.03208 4.09625 6.09625C4.03208 6.16025 4 6.23075 4 6.30775V17.6923C4 17.7692 4.03208 17.8398 4.09625 17.9038C4.16025 17.9679 4.23075 18 4.30775 18Z",fill:"white"})})};return m.jsxs("div",{className:"flex flex-col items-start gap-4 self-stretch w-full",children:[m.jsxs("div",{className:"flex flex-col items-start self-stretch",children:[m.jsx("div",{className:"flex pb-2 items-start gap-2 self-stretch",children:m.jsx("div",{className:"flex h-2.5 flex-col justify-center flex-1 text-[#172B4D] font-roboto text-[13px] font-medium leading-[18px]",children:"Country"})}),m.jsx("div",{className:"flex w-full items-start gap-6",children:m.jsx("div",{className:"flex-1",children:m.jsxs("select",{value:K,onChange:Ee=>de(Ee.target.value),className:"w-full h-[38px] px-3 py-[8px] rounded border border-[#C3C6D4] bg-white text-[#172B4D] font-roboto text-[13px]",children:[m.jsx("option",{value:"",children:"Select"}),Be.map(Ee=>m.jsx("option",{value:Ee.countryName,children:Ee.countryName},Ee.countryName))]})})})]}),K&&sn.length>0&&m.jsxs("div",{className:"flex flex-col items-start gap-4 self-stretch",children:[m.jsxs("div",{className:"flex flex-col items-start gap-1 self-stretch",children:[m.jsx("div",{className:"flex items-center gap-2 self-stretch",children:m.jsx("div",{className:"text-[#172B4D] font-roboto text-base font-bold leading-[26px]",children:"Select the ID Type"})}),m.jsx("div",{className:"self-stretch text-[#676879] font-roboto text-[13px] font-normal leading-5",children:"Select the ID you'd like to use for verification."})]}),m.jsxs("div",{className:"flex flex-col items-start gap-4 self-stretch",children:[m.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3 w-full",children:sn.map(Ee=>{const Ge=Ee.toLowerCase().replace(/\s+/g,"_"),Q=J===Ge,ht=oe.includes(Ge),it=Kn(Ee);return m.jsx("div",{className:"flex flex-col",children:m.jsxs("button",{onClick:()=>{J===Ge?(pe(""),w(!1),k(!1)):pe(Ge)},className:`relative flex p-3 flex-col items-start gap-2 rounded border transition-all w-full ${ht?"border-[#00B499] bg-[#EBFFF5]":Q?"border-[#0073EA] bg-[#F0F8FF]":"border-[#C3C6D4] bg-white hover:border-[#0073EA]/50"}`,children:[m.jsx("div",{className:"flex w-6 h-6 p-1 justify-center items-center gap-1 aspect-square rounded",style:{backgroundColor:it.color},children:m.jsx("div",{className:"scale-75",children:it.icon})}),m.jsx("div",{className:"text-[#172B4D] font-roboto text-[12px] font-medium leading-[16px] text-left",children:Ee}),ht&&m.jsx("div",{className:"absolute top-1 right-1 flex items-center gap-1 bg-white rounded-full p-0.5 border border-[#E6F1FD]",children:m.jsx("svg",{className:"w-3 h-3",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M6.21967 9.86236L7.71968 11.3624C8.01255 11.6552 8.48745 11.6552 8.78032 11.3624L12.1553 7.98736C12.4482 7.69447 12.4482 7.2196 12.1553 6.9267C11.8624 6.63381 11.3876 6.63381 11.0947 6.9267L8.25 9.77138L7.28033 8.80171C6.98744 8.50883 6.51256 8.50883 6.21967 8.80171C5.92678 9.09458 5.92678 9.56948 6.21967 9.86236Z",fill:"#039855"})})}),ht&&m.jsx("span",{className:"absolute bottom-1 right-1 text-[10px] px-1.5 py-0.5 rounded bg-[#EEF2FF] text-[#4F46E5] border border-[#E0E7FF]",children:"Uploaded"})]})},Ge)})}),J&&m.jsxs("div",{className:"flex flex-col items-start gap-4 self-stretch mt-2 pl-4 border-l-2 border-[#0073EA]/20",children:[m.jsx("div",{className:"flex flex-col items-start gap-1 self-stretch",children:m.jsx("div",{className:"flex items-center gap-2 self-stretch",children:m.jsx("div",{className:"text-[#172B4D] font-roboto text-base font-bold leading-[26px]",children:"Choose a method to upload your document"})})}),m.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 w-full",children:[m.jsx("div",{className:"flex flex-col gap-4",children:e.allowCaptureWebcam||e.allowUploadFromDevice?m.jsxs("div",{className:`grid gap-4 w-full ${e.allowCaptureWebcam&&e.allowUploadFromDevice?"grid-cols-1 sm:grid-cols-2":"grid-cols-1"}`,children:[e.allowCaptureWebcam&&m.jsx("button",{onClick:()=>w(!0),className:"flex flex-col justify-center items-center border-2 border-dashed border-[#C3C6D4] rounded-lg h-[120px] bg-white hover:bg-gray-50 transition-colors",children:m.jsxs("div",{className:"flex flex-col justify-center items-center gap-2",children:[m.jsx("div",{className:"flex w-[40px] h-[40px] p-2 justify-center items-center rounded-full bg-[#F6F7FB]",children:m.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 25",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("path",{d:"M1.99805 8.87722C1.99805 8.5269 1.99805 8.35174 2.01267 8.20421C2.15365 6.78127 3.27932 5.6556 4.70226 5.51462C4.84979 5.5 5.03441 5.5 5.40363 5.5C5.5459 5.5 5.61704 5.5 5.67744 5.49634C6.44866 5.44963 7.124 4.96288 7.41219 4.246C7.43476 4.18986 7.45586 4.12657 7.49805 4C7.54024 3.87343 7.56134 3.81014 7.58391 3.754C7.8721 3.03712 8.54744 2.55037 9.31866 2.50366C9.37906 2.5 9.44577 2.5 9.57919 2.5H14.4169C14.5503 2.5 14.617 2.5 14.6774 2.50366C15.4486 2.55037 16.124 3.03712 16.4121 3.754C16.4347 3.81014 16.4558 3.87343 16.498 4C16.5402 4.12657 16.5613 4.18986 16.5839 4.246C16.872 4.96288 17.5474 5.44963 18.3186 5.49634C18.379 5.5 18.4501 5.5 18.5924 5.5C18.9616 5.5 19.1463 5.5 19.2938 5.51462C20.7167 5.6556 21.8424 6.78127 21.9834 8.20421C21.998 8.35174 21.998 8.5269 21.998 8.87722V16.7C21.998 18.3802 21.998 19.2202 21.671 19.862C21.3834 20.4265 20.9245 20.8854 20.36 21.173C19.7182 21.5 18.8782 21.5 17.198 21.5H6.79805C5.11789 21.5 4.27781 21.5 3.63608 21.173C3.07159 20.8854 2.61265 20.4265 2.32503 19.862C1.99805 19.2202 1.99805 18.3802 1.99805 16.7V8.87722Z",stroke:"#676879",strokeWidth:"1.35",strokeLinecap:"round",strokeLinejoin:"round"}),m.jsx("path",{d:"M11.998 17C14.2071 17 15.998 15.2091 15.998 13C15.998 10.7909 14.2071 9 11.998 9C9.78891 9 7.99805 10.7909 7.99805 13C7.99805 15.2091 9.78891 17 11.998 17Z",stroke:"#676879",strokeWidth:"1.35",strokeLinecap:"round",strokeLinejoin:"round"})]})}),m.jsx("div",{className:"text-[#323238] text-center font-figtree text-[12px] font-medium",children:"Camera"}),m.jsx("div",{className:"text-[#676879] text-center font-roboto text-[11px] font-normal leading-4",children:"Take a photo using camera"})]})}),e.allowUploadFromDevice&&m.jsx("button",{onClick:()=>k(!0),className:"flex flex-col justify-center items-center border-2 border-dashed border-[#C3C6D4] rounded-lg h-[120px] bg-white hover:bg-gray-50 transition-colors",children:m.jsxs("div",{className:"flex flex-col justify-center items-center gap-2",children:[m.jsx("div",{className:"flex w-[40px] h-[40px] p-2 justify-center items-center rounded-full bg-[#F6F7FB]",children:m.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 25",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M7.76471 12.0294C6.88944 12.0294 6.4518 12.0294 6.09274 12.1256C5.11837 12.3867 4.35729 13.1478 4.09621 14.1221C4 14.4812 4 14.9188 4 15.7941V16.9235C4 18.5049 4 19.2955 4.30775 19.8995C4.57845 20.4308 5.01039 20.8627 5.54168 21.1334C6.14566 21.4412 6.93632 21.4412 8.51765 21.4412H16.4235C18.0049 21.4412 18.7955 21.4412 19.3995 21.1334C19.9308 20.8627 20.3627 20.4308 20.6334 19.8995C20.9412 19.2955 20.9412 18.5049 20.9412 16.9235V15.7941C20.9412 14.9188 20.9412 14.4812 20.845 14.1221C20.5839 13.1478 19.8228 12.3867 18.8485 12.1256C18.4894 12.0294 18.0518 12.0294 17.1765 12.0294M16.2353 8.26471L12.4706 4.5M12.4706 4.5L8.70588 8.26471M12.4706 4.5V15.7941",stroke:"#676879",strokeWidth:"1.41176",strokeLinecap:"round",strokeLinejoin:"round"})})}),m.jsx("div",{className:"text-[#323238] text-center font-figtree text-[12px] font-medium",children:"Upload Files"}),m.jsx("div",{className:"text-[#676879] text-center font-roboto text-[11px] font-normal leading-4",children:"Upload from device"})]})})]}):m.jsx("div",{className:"flex flex-col items-center justify-center h-[120px] border-2 border-dashed border-[#C3C6D4] rounded-lg bg-gray-50",children:m.jsxs("div",{className:"text-[#676879] font-roboto text-[12px] font-normal text-center",children:["No upload methods available.",m.jsx("br",{}),"Please contact support."]})})}),m.jsx("div",{className:"flex flex-col gap-4",children:m.jsx("button",{onClick:z,disabled:A,className:"flex flex-col justify-center items-center border-2 border-dashed border-[#6366F1] rounded-lg h-[120px] bg-gradient-to-br from-[#6366F1]/5 to-[#8B5CF6]/5 hover:from-[#6366F1]/10 hover:to-[#8B5CF6]/10 transition-all cursor-pointer disabled:opacity-60",children:m.jsxs("div",{className:"flex flex-col justify-center items-center gap-3",children:[m.jsx("div",{className:"flex w-[48px] h-[48px] p-2 justify-center items-center rounded-xl bg-gradient-to-br from-[#6366F1] to-[#8B5CF6]",children:m.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("path",{d:"M6 10V8C6 6.93913 6.42143 5.92172 7.17157 5.17157C7.92172 4.42143 8.93913 4 10 4H14C15.0609 4 16.0783 4.42143 16.8284 5.17157C17.5786 5.92172 18 6.93913 18 8V10M5 10H19C19.5523 10 20 10.4477 20 11V19C20 19.5523 19.5523 20 19 20H5C4.44772 20 4 19.5523 4 19V11C4 10.4477 4.44772 10 5 10Z",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),m.jsx("circle",{cx:"12",cy:"15",r:"1.5",fill:"white"})]})}),m.jsxs("div",{className:"flex flex-col items-center gap-1",children:[m.jsx("div",{className:"text-[#6366F1] text-center font-figtree text-[14px] font-semibold",children:A?"Opening DigiLocker":"DigiLocker"}),m.jsx("div",{className:"text-[#676879] text-center font-roboto text-[11px] font-normal leading-4",children:"Your documents anytime, anywhere"})]})]})})})]}),r&&m.jsxs("div",{className:"flex flex-col items-center gap-4 self-stretch border-2 border-dashed border-[#C3C6D4] rounded-lg bg-white p-6",children:[m.jsx("div",{className:"flex flex-col items-center gap-3",children:m.jsxs("div",{className:"flex flex-col items-center gap-2",children:[m.jsx(IQ,{shortCode:r,templateVersionId:s,userId:o,sessionId:Ct?.sessionId||"default-session",currentStep:"document-upload",submissionId:t,size:"large",showUrl:!1,connectionRef:u,shouldMaintainConnection:d,onConnected:f}),m.jsx("div",{className:"text-[#676879] text-center font-roboto text-[12px] font-normal leading-4 max-w-[200px]",children:"Scan this QR code with your other device to continue verification."})]})}),m.jsx("div",{className:"w-full flex justify-end items-center",children:m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("svg",{width:"16",height:"16",viewBox:"0 0 20 21",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M10.0003 13.8332V10.4998M10.0003 7.1665H10.0087M18.3337 10.4998C18.3337 15.1022 14.6027 18.8332 10.0003 18.8332C5.39795 18.8332 1.66699 15.1022 1.66699 10.4998C1.66699 5.89746 5.39795 2.1665 10.0003 2.1665C14.6027 2.1665 18.3337 5.89746 18.3337 10.4998Z",stroke:"#0073EA",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),m.jsx("div",{className:"text-[#0073EA] font-roboto text-[10px] font-normal",children:"How does this work?"})]})})]})]})]})]}),oe&&oe.length>0&&m.jsxs("div",{className:"flex flex-col items-start gap-4 self-stretch",children:[m.jsxs("div",{className:"flex flex-col items-start gap-1 self-stretch",children:[m.jsx("div",{className:"flex items-center gap-2 self-stretch",children:m.jsx("div",{className:"text-text-primary font-roboto text-base font-bold leading-[26px]",children:"Documents Uploaded"})}),m.jsx("div",{className:"self-stretch text-text-secondary font-roboto text-[13px] font-normal leading-5",children:"Click on any document to download it."})]}),m.jsx("div",{className:"flex flex-wrap items-start gap-4 self-stretch",children:oe.map(Ee=>{const Ge=sn.find(it=>it.toLowerCase().replace(/\s+/g,"_")===Ee)||Ee.replace(/_/g," "),Q=Z[Ee],ht=Q&&(Q.front||Q.back);return m.jsxs("div",{className:"relative flex w-[180px] h-[180px] p-4 flex-col justify-between items-center gap-3 rounded-lg border-2 border-green-300 bg-green-50 cursor-pointer transition-all duration-200 hover:bg-green-100 hover:border-green-400 hover:shadow-md",onClick:()=>{console.log(" Download clicked for document:",Ee,"File IDs:",Q),ht?te(Ee):alert(`No files available for ${Ge}`)},children:[m.jsx("button",{onClick:it=>{it.stopPropagation(),H(Ee),L(!0)},className:"absolute top-2 right-2 flex w-7 h-7 justify-center items-center rounded-full bg-red-500 hover:bg-red-600 transition-colors shadow-md z-10","aria-label":"Delete document",children:m.jsx("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M10.5 3.5L3.5 10.5M3.5 3.5L10.5 10.5",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),m.jsx("div",{className:"flex w-16 h-16 justify-center items-center rounded-full bg-green-500",children:m.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("path",{d:"M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),m.jsx("path",{d:"M14 2V8H20",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),m.jsx("path",{d:"M12 18V12",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),m.jsx("path",{d:"M9 15L12 12L15 15",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}),m.jsxs("div",{className:"flex flex-col items-center gap-1 self-stretch",children:[m.jsx("div",{className:"text-center font-figtree text-sm font-semibold leading-tight text-green-800 line-clamp-2",children:Ge}),m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("svg",{width:"12",height:"12",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M13.5 4.5L6 12L2.5 8.5",stroke:"#22c55e",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),m.jsx("span",{className:"text-xs font-medium text-green-600",children:"Uploaded"})]})]})]},Ee)})})]}),m.jsx(mJ,{isOpen:b,onClose:()=>w(!1),previousFileIds:J?Z[J]:void 0,onUploaded:(Ee,Ge)=>{J&&ze(Q=>({...Q,[J]:{...Q[J]||{},[Ee]:Ge}}))},submissionId:t,country:K,selectedDocumentName:sn.find(Ee=>Ee.toLowerCase().replace(/\s+/g,"_")===J)||"",documentConfig:e,onSubmit:(Ee,Ge)=>{if(w(!1),J){const Q=J;Ee&&localStorage.setItem(`document_${Q}_image`,Ee),Ce(Lt=>{const On=Lt.includes(Q)?Lt:[...Lt,Q];return console.log(" Updated uploadedDocuments (Camera):",On),On});const ht={id:`${Q}-${Date.now()}`,name:`${Q.replace(/_/g," ")}.jpg`,size:"2.5MB",type:"image"};Ae(Lt=>{const An=[...Lt.filter(Jn=>Jn.id.replace(/-\d+$/,"")!==Q),ht];return console.log(" Updated uploadedFiles (Camera):",An),An});const it=Rt();if(console.log(" Camera Dialog - Checking addDocumentDetail conditions:",{documentDefinitionId:it,frontFileId:Ge?.front,backFileId:Ge?.back,isUsingLiftedState:V,shouldAdd:!!(it&&Ge?.front)}),it&&Ge?.front){const Lt=sn.find(nr=>nr.toLowerCase().replace(/\s+/g,"_")===Q)||Q.replace(/_/g," "),On={documentName:Lt,documentDefinitionId:it,frontFileId:Ge.front,backFileId:Ge.back,frontETag:void 0,backETag:void 0,status:"uploaded",uploadedAt:new Date().toISOString()},Jn=[...i?.documentsDetails||[],On];et(Lt,it,Ge.front,Ge.back),console.log(" Added document detail (Camera):",{documentName:Lt,documentDefinitionId:it,frontFileId:Ge.front,backFileId:Ge.back}),queueMicrotask(()=>{setTimeout(()=>{l&&(console.log(" POST request triggered after camera upload:",Lt),console.log(" Documents to be sent:",Jn.map(nr=>nr.documentName)),l(Jn))},200)})}else console.log(" Skipping addDocumentDetail (Camera) - conditions not met"),l?.();pe(""),sn.map(Lt=>Lt.toLowerCase().replace(/\s+/g,"_")).every(Lt=>Lt===Q||oe.includes(Lt))&&n?.()}}}),m.jsx(gJ,{isOpen:S,onClose:()=>k(!1),onSubmit:async(Ee,Ge)=>{if(!J)return;const Q=J;try{const ht=Rt(),it=Z[Q],[Yt,cn]=await Promise.all([Ft(Ee,`${Q}-front.${Ee.type.includes("pdf")?"pdf":"jpg"}`,it?.front),Ft(Ge,`${Q}-back.${Ge.type.includes("pdf")?"pdf":"jpg"}`,it?.back)]),Lt=Yt.id,On=cn.id,An=Yt.eTag,Jn=cn.eTag;if(t){const xt={...Z,[Q]:{front:Lt,back:On,frontETag:An||void 0,backETag:Jn||void 0}};localStorage.setItem(`documentUploadIds_${t}`,JSON.stringify(xt))}ze(xt=>({...xt,[Q]:{front:Lt,back:On,frontETag:An||void 0,backETag:Jn||void 0}})),Ce(xt=>xt.includes(Q)?xt:[...xt,Q]);const nr={id:`${Q}-${Date.now()}`,name:`${Q.replace(/_/g," ")}.pdf`,size:"3MB",type:"document"};if(Ae(xt=>[...xt.filter(xr=>xr.id.replace(/-\d+$/,"")!==Q),nr]),ht&&Lt){const xt=sn.find(cr=>cr.toLowerCase().replace(/\s+/g,"_")===Q)||Q.replace(/_/g," "),In={documentName:xt,documentDefinitionId:ht,frontFileId:Lt,backFileId:On,frontETag:An||void 0,backETag:Jn||void 0,status:"uploaded",uploadedAt:new Date().toISOString()},xr=[...i?.documentsDetails||[],In];et(xt,ht,Lt,On,An||void 0,Jn||void 0),queueMicrotask(()=>{setTimeout(()=>{l&&(console.log(" POST request triggered after file upload:",xt),console.log(" Documents to be sent:",xr.map(cr=>cr.documentName)),l(xr))},200)})}else l?.();pe(""),sn.map(xt=>xt.toLowerCase().replace(/\s+/g,"_")).every(xt=>xt===Q||oe.includes(xt))&&n?.()}finally{k(!1)}}}),B&&W&&m.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:m.jsxs("div",{className:"flex w-[440px] max-w-[90vw] flex-col items-start rounded-lg bg-white shadow-xl",children:[m.jsxs("div",{className:"flex h-[58px] justify-between items-center self-stretch border-b border-[#D0D4E4] px-6",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("div",{className:"flex w-10 h-10 justify-center items-center rounded-full bg-red-100",children:m.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M8.33333 5V4.33333C8.33333 3.39991 8.33333 2.9332 8.51499 2.57668C8.67384 2.26308 8.92977 2.00715 9.24337 1.8483C9.59989 1.66663 10.0666 1.66663 11 1.66663H12.3333C13.2668 1.66663 13.7335 1.66663 14.09 1.8483C14.4036 2.00715 14.6595 2.26308 14.8184 2.57668C15 2.9332 15 3.39991 15 4.33333V5M16.6667 5L16.1991 13.0654C16.1296 14.3267 16.0949 14.9574 15.8203 15.4369C15.5802 15.8566 15.2188 16.1935 14.7822 16.4008C14.2875 16.6333 13.6561 16.6333 12.3933 16.6333H10.9401C9.67725 16.6333 9.04583 16.6333 8.55111 16.4008C8.11457 16.1935 7.75315 15.8566 7.51301 15.4369C7.23842 14.9574 7.20375 14.3267 7.13441 13.0654L6.66667 5M2.5 5H17.5M10.8333 9.16663V12.5M12.5 9.16663V12.5",stroke:"#DC2626",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),m.jsx("div",{className:"text-[#172B4D] font-figtree text-xl font-bold leading-[30px]",children:"Delete Document"})]}),m.jsx("button",{onClick:()=>{L(!1),H(null)},disabled:G,className:"flex w-8 h-8 justify-center items-center gap-2.5 rounded-full bg-white hover:bg-gray-50 disabled:opacity-50",children:m.jsx(T$,{width:20,height:20})})]}),m.jsxs("div",{className:"flex p-6 flex-col items-start gap-4 self-stretch",children:[m.jsxs("div",{className:"text-[#172B4D] font-roboto text-base leading-6",children:["Are you sure you want to delete"," ",m.jsx("span",{className:"font-semibold",children:sn.find(Ee=>Ee.toLowerCase().replace(/\s+/g,"_")===W)||W.replace(/_/g," ")}),"?"]}),m.jsx("div",{className:"text-[#676879] font-roboto text-sm leading-5",children:"This will permanently delete both the front and back images of this document from the server. This action cannot be undone."})]}),m.jsxs("div",{className:"flex h-[68px] justify-end items-center gap-3 self-stretch border-t border-[#D0D4E4] bg-white px-6",children:[m.jsx("button",{onClick:()=>{L(!1),H(null)},disabled:G,className:"flex h-[38px] px-4 py-[11px] justify-center items-center gap-2 rounded border border-[#C3C6D4] bg-white hover:bg-gray-50 disabled:opacity-50",children:m.jsx("span",{className:"text-[#172B4D] font-roboto text-[13px] font-medium",children:"Cancel"})}),m.jsx("button",{onClick:()=>Ke(W),disabled:G,className:"flex h-[38px] px-4 py-[11px] justify-center items-center gap-2 rounded bg-red-600 hover:bg-red-700 disabled:bg-red-400",children:G?m.jsxs(m.Fragment,{children:[m.jsx(Wk,{className:"animate-spin h-4 w-4 text-white"}),m.jsx("span",{className:"text-white font-roboto text-[13px] font-medium",children:"Deleting..."})]}):m.jsxs(m.Fragment,{children:[m.jsx("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M7.5 4.5V3.9C7.5 3.05992 7.5 2.63988 7.66349 2.31901C7.80615 2.03677 8.03677 1.80615 8.31901 1.66349C8.63988 1.5 9.05992 1.5 9.9 1.5H11.1C11.9401 1.5 12.3601 1.5 12.681 1.66349C12.9632 1.80615 13.1938 2.03677 13.3365 2.31901C13.5 2.63988 13.5 3.05992 13.5 3.9V4.5M15 4.5L14.5792 11.7588C14.5189 12.8803 14.4887 13.441 14.2382 13.8732C14.0172 14.2509 13.6869 14.5542 13.2903 14.7407C12.8387 15 12.2772 15 11.1543 15H9.84573C8.72282 15 8.16136 15 7.70971 14.7407C7.31312 14.5542 6.98282 14.2509 6.76181 13.8732C6.51134 13.441 6.48113 12.8803 6.42071 11.7588L6 4.5M2.25 4.5H15.75M9.75 8.25V11.25M11.25 8.25V11.25",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),m.jsx("span",{className:"text-white font-roboto text-[13px] font-medium",children:"Delete Document"})]})})]})]})})]})}var M$=function(n,e){return(M$=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var s in r)r.hasOwnProperty(s)&&(t[s]=r[s])})(n,e)};function ml(n,e){function t(){this.constructor=n}M$(n,e),n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Vt(n,e,t,r){return new(t||(t=Promise))((function(s,o){function i(c){try{l(r.next(c))}catch(u){o(u)}}function a(c){try{l(r.throw(c))}catch(u){o(u)}}function l(c){c.done?s(c.value):new t((function(u){u(c.value)})).then(i,a)}l((r=r.apply(n,[])).next())}))}function zt(n,e){var t,r,s,o,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(c){return(function(u){if(t)throw new TypeError("Generator is already executing.");for(;i;)try{if(t=1,r&&(s=2&u[0]?r.return:u[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,u[1])).done)return s;switch(r=0,s&&(u=[2&u[0],s.value]),u[0]){case 0:case 1:s=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,r=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!(s=(s=i.trys).length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){i=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){i.label=u[1];break}if(u[0]===6&&i.label<s[1]){i.label=s[1],s=u;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(u);break}s[2]&&i.ops.pop(),i.trys.pop();continue}u=e.call(n,i)}catch(d){u=[6,d],r=0}finally{t=s=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}})([l,c])}}}var RQ=(function(){function n(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return n.prototype.setPlatform=function(e,t){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},n.prototype.registerFlag=function(e,t,r){if(this.flagRegistry[e]={evaluationFn:t,setHook:r},this.urlFlags[e]!=null){var s=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+s+"."),this.set(e,s)}},n.prototype.get=function(e){return e in this.flags?this.flags[e]:(this.flags[e]=this.evaluateFlag(e),this.flags[e])},n.prototype.getNumber=function(e){return this.get(e)},n.prototype.getBool=function(e){return this.get(e)},n.prototype.getFlags=function(){return this.flags},Object.defineProperty(n.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),n.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},n.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},n.prototype.setFlags=function(e){this.flags=Object.assign({},e)},n.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},n.prototype.populateURLFlags=function(){var e=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var t,r,s=(t=this.global.location.search,r={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(o){for(var i=[],a=1;a<arguments.length;a++)i[a-1]=arguments[a];return DQ(r,i[0],i[1]),i.join("=")})),r);"tfjsflags"in s&&s.tfjsflags.split(",").forEach((function(o){var i=o.split(":"),a=i[0],l=i[1];e.urlFlags[a]=(function(c,u){if((u=u.toLowerCase())==="true"||u==="false")return u==="true";if(""+ +u===u)return+u;throw new Error("Could not parse value flag value "+u+" for flag "+c+".")})(a,l)}))}},n})();function DQ(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function je(){return L$}var L$=null,u2=new Map,s5=new Map;function j$(n,e){var t=V$(n,e);return u2.get(t)}function AQ(n){return s5.get(n)}function W9(n){for(var e=u2.entries(),t=[];;){var r=e.next(),s=r.done,o=r.value;if(s)break;var i=o[0],a=o[1];i.split("_")[0]===n&&t.push(a)}return t}function B$(n){var e=n.kernelName,t=n.backendName,r=V$(e,t);if(u2.has(r))throw new Error("The kernel '"+e+"' for backend '"+t+"' is already registered");u2.set(r,n)}function $Q(n){var e=n.kernelName;s5.has(e)&&console.warn("Overriding the gradient for '"+e+"'"),s5.set(e,n)}function V$(n,e){return e+"_"+n}function o5(n,e,t){return Math.max(n,Math.min(e,t))}function z$(n){return n%2==0?n:n+1}function FQ(n){for(var e=0,t=0;t<n.length;t++)e+=n[t];return e}function ee(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function pr(n,e,t){t===void 0&&(t=""),ee(eo(n,e),(function(){return t+" Shapes "+n+" and "+e+" must match"}))}function qp(n){ee(n!=null,(function(){return"The input to the tensor constructor must be a non-null value."}))}function Np(n,e,t){if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),Array.isArray(n)||Yl(n)&&!t)for(var r=0;r<n.length;++r)Np(n[r],e,t);else e.push(n);return e}function Xt(n){if(n.length===0)return 1;for(var e=n[0],t=1;t<n.length;t++)e*=n[t];return e}function eo(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(var t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function hs(n){return n%1==0}function PQ(n){if(Math.tanh!=null)return Math.tanh(n);if(n===1/0)return 1;if(n===-1/0)return-1;var e=Math.exp(2*n);return(e-1)/(e+1)}function i5(n){var e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function op(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function U9(n,e,t){return e===void 0&&(e=function(r){return 0}),new Promise((function(r,s){var o=0,i=function(){if(n())r();else{o++;var a=e(o);t!=null&&o>=t?s():setTimeout(i,a)}};i()}))}function OQ(n,e){for(var t=1,r=-1,s=0;s<n.length;++s)if(n[s]>=0)t*=n[s];else if(n[s]===-1){if(r!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+s);r=s}else if(n[s]<0)throw Error("Shapes can not be < 0. Found "+n[s]+" at dim "+s);if(r===-1){if(e>0&&e!==t)throw Error("Size("+e+") must match the product of shape "+n);return n}if(t===0)throw Error("Cannot infer the missing size in ["+n+"] when there are 0 elements");if(e%t!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+t);var o=n.slice();return o[r]=e/t,o}function zs(n,e){var t=e.length;return ee((n=n==null?e.map((function(r,s){return s})):[].concat(n)).every((function(r){return r>=-t&&r<t})),(function(){return"All values in axis param must be in range [-"+t+", "+t+") but got axis "+n})),ee(n.every((function(r){return hs(r)})),(function(){return"All values in axis param must be integers but got axis "+n})),n.map((function(r){return r<0?t+r:r}))}function nf(n,e){for(var t=[],r=[],s=e!=null&&Array.isArray(e)&&e.length===0,o=e==null||s?null:zs(e,n).sort(),i=0,a=0;a<n.length;++a){if(o!=null){if(o[i]===a&&n[a]!==1)throw new Error("Can't squeeze axis "+a+" since its dim '"+n[a]+"' is not 1");(o[i]==null||o[i]>a)&&n[a]===1&&(t.push(n[a]),r.push(a)),o[i]<=a&&i++}n[a]!==1&&(t.push(n[a]),r.push(a))}return{newShape:t,keptDims:r}}function Ig(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else{if(n!=="bool")throw new Error("Unknown data type "+n);t=new Uint8Array(e)}return t}function d2(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else{if(n!=="string")throw new Error("Unknown data type "+n);t=new Array(e)}return t}function MQ(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+e+" being uploaded contains "+r+".")}}function LQ(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function jQ(n,e){return e!=="complex64"&&(e!=="float32"||n==="complex64")&&(e!=="int32"||n==="float32"||n==="complex64")&&(e!=="bool"||n!=="bool")}function Yl(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array}function W$(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error("Unknown dtype "+n)}function BQ(n){if(n==null)return 0;var e=0;return n.forEach((function(t){return e+=t.length})),e}function Kk(n){return typeof n=="string"||n instanceof String}function VQ(n){return typeof n=="boolean"}function zQ(n){return typeof n=="number"}function Qg(n){return Array.isArray(n)?Qg(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array?"int32":zQ(n)?"float32":Kk(n)?"string":VQ(n)?"bool":"float32"}function a5(n){return!!(n&&n.constructor&&n.call&&n.apply)}function l5(n,e){for(var t=e;t<n;++t)if(n%t==0)return t;return n}function Zl(n){var e=n.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=n[e-1];for(var r=e-3;r>=0;--r)t[r]=t[r+1]*n[r+1];return t}function U$(n,e,t){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Np(n)),t&&MQ(n,e),(function(o,i){return o instanceof Float32Array&&i==="float32"||o instanceof Int32Array&&i==="int32"||o instanceof Uint8Array&&i==="bool"})(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){for(var r=new Uint8Array(n.length),s=0;s<r.length;++s)Math.round(n[s])!==0&&(r[s]=1);return r}throw new Error("Unknown data type "+e)}function H9(n,e){if(n.length===0)return e[0];var t=n.reduce((function(r,s){return r*s}));if(t===0)return[];if(t!==e.length)throw new Error("["+n+"] does not match the input size.");return(function r(s,o,i){var a=new Array;if(o.length===1)for(var l=o[0],c=0;c<l;c++)a[c]=i[s+c];else{l=o[0];var u=o.slice(1),d=u.reduce((function(f,p){return f*p}));for(c=0;c<l;c++)a[c]=r(s+c*d,u,i)}return a})(0,n,e)}function H$(n,e){for(var t=e1(n,e),r=0;r<t.length;r++)t[r]=1;return t}function e1(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error("Unknown data type "+e)}function Ml(){return je().platform.now()}function G$(n){n.forEach((function(e){ee(Number.isInteger(e)&&e>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape ["+n+"]."}))}))}function WQ(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",je().platform.encode(n,e)}function f2(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",je().platform.decode(n,e)}function G9(n,e,t){if(e===0)return 0;if(e===1)return n[0];for(var r=n[n.length-1],s=0;s<n.length-1;++s)r+=t[s]*n[s];return r}function UQ(n,e,t){if(e===0)return[];if(e===1)return[n];for(var r=new Array(e),s=0;s<r.length-1;++s)r[s]=Math.floor(n/t[s]),n-=r[s]*t[s];return r[r.length-1]=n,r}var HQ=(function(){function n(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new GQ)}return n.prototype.profileKernel=function(e,t,r){var s,o=this,i=this.backendTimer.time((function(){s=r()}));return s.forEach((function(a){a.data().then((function(l){(function(c,u,d){if(u!=="float32")return!1;for(var f=0;f<c.length;f++){var p=c[f];if(isNaN(p)||!isFinite(p))return console.warn("Found "+p+" in the result of '"+d+"'"),!0}})(l,a.dtype,e),i.then((function(c){var u="";c.getExtraProfileInfo!=null&&(u=c.getExtraProfileInfo()),o.logger.logKernelProfile(e,a,l,c.kernelMs,t,u)}))}))})),s},n})(),GQ=(function(){function n(){}return n.prototype.logKernelProfile=function(e,t,r,s,o,i){var a=typeof s=="number"?op(s+"ms",9):s.error,l=op(e,25),c=t.rank,u=t.size,d=op(t.shape.toString(),14),f="";for(var p in o){var x=o[p].shape||t.shape,v=x.length;f+=p+": "+v+"D "+(v>0?x:"")+" "}console.log("%c"+l+"	%c"+a+"	%c"+c+"D "+d+"	%c"+u+"	%c"+f+"	%c"+i,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},n})(),q9=20,Hm=3,AC=7;function qQ(n,e,t,r){var s=Zl(e),o=(function(c,u,d,f){var p=Xt(u),x=f[f.length-1],v=new Array(x).fill(0),y=u.length,b=d==="complex64"?qm(c):c;if(y>1)for(var w=0;w<p/x;w++)for(var S=w*x,k=0;k<x;k++)v[k]=Math.max(v[k],Gm(b[S+k],0,d).length);return v})(n,e,t,s),i=e.length,a=(function c(u,d,f,p,x,v){v===void 0&&(v=!0);var y=f==="complex64"?2:1,b=d[0],w=d.length;if(w===0)return f==="complex64"?[Gm(qm(u)[0],0,f)]:f==="bool"?[q$(u[0])]:[u[0].toString()];if(w===1){if(b>q9){var S=Hm*y,k=Array.from(u.slice(0,S)),N=Array.from(u.slice((b-Hm)*y,b*y));return f==="complex64"&&(k=qm(k),N=qm(N)),["["+k.map((function(W,H){return Gm(W,x[H],f)})).join(", ")+", ..., "+N.map((function(W,H){return Gm(W,x[b-Hm+H],f)})).join(", ")+"]"]}return["["+(f==="complex64"?qm(u):Array.from(u)).map((function(W,H){return Gm(W,x[H],f)})).join(", ")+"]"]}var I=d.slice(1),T=p.slice(1),F=p[0]*y,R=[];if(b>q9){for(var D=0;D<Hm;D++){var A=(P=D*F)+F;R.push.apply(R,c(u.slice(P,A),I,f,T,x,!1))}for(R.push("..."),D=b-Hm;D<b;D++)A=(P=D*F)+F,R.push.apply(R,c(u.slice(P,A),I,f,T,x,D===b-1))}else for(D=0;D<b;D++){var P;A=(P=D*F)+F,R.push.apply(R,c(u.slice(P,A),I,f,T,x,D===b-1))}var B=w===2?",":"";for(R[0]="["+R[0]+B,D=1;D<R.length-1;D++)R[D]=" "+R[D]+B;var L=`,
`;for(D=2;D<w;D++)L+=`
`;return R[R.length-1]=" "+R[R.length-1]+"]"+(v?"":L),R})(n,e,t,s,o),l=["Tensor"];return r&&(l.push("  dtype: "+t),l.push("  rank: "+i),l.push("  shape: ["+e+"]"),l.push("  values:")),l.push(a.map((function(c){return"    "+c})).join(`
`)),l.join(`
`)}function Gm(n,e,t){return op(Array.isArray(n)?parseFloat(n[0].toFixed(AC))+" + "+parseFloat(n[1].toFixed(AC))+"j":Kk(n)?"'"+n+"'":t==="bool"?q$(n):parseFloat(n.toFixed(AC)).toString(),e)}function q$(n){return n===0?"false":"true"}function qm(n){for(var e=[],t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}var Tg=(function(){function n(e,t,r){var s=this;if(this.dtype=t,this.shape=e.slice(),this.size=Xt(e),r!=null){var o=r.length;ee(o===this.size,(function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+s.size+"'."}))}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||d2(t,this.size),this.strides=Zl(e)}return n.prototype.set=function(e){for(var t=this,r=[],s=1;s<arguments.length;s++)r[s-1]=arguments[s];r.length===0&&(r=[0]),ee(r.length===this.rank,(function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+t.rank+")"}));var o=this.locToIndex(r);this.values[o]=e},n.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.length===0&&(e=[0]);for(var r=0,s=0,o=e;s<o.length;s++){var i=o[s];if(i<0||i>=this.shape[r]){var a="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(a)}r++}for(var l=e[e.length-1],c=0;c<e.length-1;++c)l+=this.strides[c]*e[c];return this.values[l]},n.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],r=0;r<e.length-1;++r)t+=this.strides[r]*e[r];return t},n.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),r=0;r<t.length-1;++r)t[r]=Math.floor(e/this.strides[r]),e-=t[r]*this.strides[r];return t[t.length-1]=e,t},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.toTensor=function(){return Wl().makeTensor(this.values,this.shape,this.dtype)},n})(),Wl=null,Oe=null,K$=null,Kr=(function(){function n(e,t,r,s){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Xt(e),this.strides=Zl(e),this.dataId=r,this.id=s,this.rankType=this.rank<5?this.rank.toString():"higher"}return n.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},n.prototype.asScalar=function(){return this.throwIfDisposed(),ee(this.size===1,(function(){return"The array must have only 1 element."})),this.reshape([])},n.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},n.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},n.prototype.as3D=function(e,t,r){return this.throwIfDisposed(),this.reshape([e,t,r])},n.prototype.as4D=function(e,t,r,s){return this.throwIfDisposed(),this.reshape([e,t,r,s])},n.prototype.as5D=function(e,t,r,s,o){return this.throwIfDisposed(),this.reshape([e,t,r,s,o])},n.prototype.asType=function(e){return this.throwIfDisposed(),Oe.cast(this,e)},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.buffer=function(){return Vt(this,void 0,void 0,(function(){var e;return zt(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,Oe.buffer(this.shape,this.dtype,e)]}}))}))},n.prototype.bufferSync=function(){return Oe.buffer(this.shape,this.dtype,this.dataSync())},n.prototype.array=function(){return Vt(this,void 0,void 0,(function(){var e;return zt(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,H9(this.shape,e)]}}))}))},n.prototype.arraySync=function(){return H9(this.shape,this.dataSync())},n.prototype.data=function(){return Vt(this,void 0,void 0,(function(){var e,t;return zt(this,(function(r){switch(r.label){case 0:return this.throwIfDisposed(),e=Wl().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=r.sent();try{return[2,t.map((function(s){return f2(s)}))]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,e]}}))}))},n.prototype.dataSync=function(){this.throwIfDisposed();var e=Wl().readSync(this.dataId);if(this.dtype==="string")try{return e.map((function(t){return f2(t)}))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},n.prototype.bytes=function(){return Vt(this,void 0,void 0,(function(){var e;return zt(this,(function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,Wl().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}}))}))},n.prototype.dispose=function(){this.isDisposed||(Wl().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(n.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),n.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},n.prototype.toFloat=function(){return this.asType("float32")},n.prototype.toInt=function(){return this.asType("int32")},n.prototype.toBool=function(){return this.asType("bool")},n.prototype.print=function(e){return e===void 0&&(e=!1),Oe.print(this,e)},n.prototype.reshape=function(e){return this.throwIfDisposed(),Oe.reshape(this,e)},n.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},n.prototype.expandDims=function(e){return e===void 0&&(e=0),Oe.expandDims(this,e)},n.prototype.cumsum=function(e,t,r){return e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1),Oe.cumsum(this,e,t,r)},n.prototype.squeeze=function(e){return this.throwIfDisposed(),Oe.squeeze(this,e)},n.prototype.clone=function(){return this.throwIfDisposed(),Oe.clone(this)},n.prototype.oneHot=function(e,t,r){return this.throwIfDisposed(),Oe.oneHot(this,e,t,r)},n.prototype.toString=function(e){return e===void 0&&(e=!1),qQ(this.dataSync(),this.shape,this.dtype,e)},n.prototype.tile=function(e){return this.throwIfDisposed(),Oe.tile(this,e)},n.prototype.gather=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),Oe.gather(this,e,t)},n.prototype.matMul=function(e,t,r){return t===void 0&&(t=!1),r===void 0&&(r=!1),this.throwIfDisposed(),Oe.matMul(this,e,t,r)},n.prototype.dot=function(e){return this.throwIfDisposed(),Oe.dot(this,e)},n.prototype.norm=function(e,t,r){return e===void 0&&(e="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1),this.throwIfDisposed(),Oe.norm(this,e,t,r)},n.prototype.slice=function(e,t){return this.throwIfDisposed(),Oe.slice(this,e,t)},n.prototype.reverse=function(e){return this.throwIfDisposed(),Oe.reverse(this,e)},n.prototype.concat=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),e instanceof n&&(e=[e]),Oe.concat([this].concat(e),t)},n.prototype.split=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),Oe.split(this,e,t)},n.prototype.stack=function(e,t){return t===void 0&&(t=0),Oe.stack([this,e],t)},n.prototype.unstack=function(e){return e===void 0&&(e=0),Oe.unstack(this,e)},n.prototype.pad=function(e,t){return t===void 0&&(t=0),Oe.pad(this,e,t)},n.prototype.batchNormalization=function(e,t,r,s,o){return r===void 0&&(r=.001),K$("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,o,s,r)},n.prototype.batchNorm=function(e,t,r,s,o){return o===void 0&&(o=.001),this.throwIfDisposed(),Oe.batchNorm(this,e,t,r,s,o)},n.prototype.all=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Oe.all(this,e,t)},n.prototype.any=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Oe.any(this,e,t)},n.prototype.logSumExp=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Oe.logSumExp(this,e,t)},n.prototype.sum=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Oe.sum(this,e,t)},n.prototype.prod=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Oe.prod(this,e,t)},n.prototype.mean=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Oe.mean(this,e,t)},n.prototype.min=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Oe.min(this,e,t)},n.prototype.max=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Oe.max(this,e,t)},n.prototype.argMin=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),Oe.argMin(this,e)},n.prototype.argMax=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),Oe.argMax(this,e)},n.prototype.cast=function(e){return this.throwIfDisposed(),Oe.cast(this,e)},n.prototype.add=function(e){return this.throwIfDisposed(),Oe.add(this,e)},n.prototype.addStrict=function(e){return this.throwIfDisposed(),Oe.addStrict(this,e)},n.prototype.atan2=function(e){return this.throwIfDisposed(),Oe.atan2(this,e)},n.prototype.sub=function(e){return this.throwIfDisposed(),Oe.sub(this,e)},n.prototype.subStrict=function(e){return this.throwIfDisposed(),Oe.subStrict(this,e)},n.prototype.pow=function(e){return this.throwIfDisposed(),Oe.pow(this,e)},n.prototype.powStrict=function(e){return this.throwIfDisposed(),Oe.powStrict(this,e)},n.prototype.mul=function(e){return this.throwIfDisposed(),Oe.mul(this,e)},n.prototype.mulStrict=function(e){return this.throwIfDisposed(),Oe.mulStrict(this,e)},n.prototype.div=function(e){return this.throwIfDisposed(),Oe.div(this,e)},n.prototype.divNoNan=function(e){return this.throwIfDisposed(),Oe.divNoNan(this,e)},n.prototype.floorDiv=function(e){return this.throwIfDisposed(),Oe.floorDiv(this,e)},n.prototype.divStrict=function(e){return this.throwIfDisposed(),Oe.divStrict(this,e)},n.prototype.minimum=function(e){return this.throwIfDisposed(),Oe.minimum(this,e)},n.prototype.minimumStrict=function(e){return this.throwIfDisposed(),Oe.minimumStrict(this,e)},n.prototype.maximum=function(e){return this.throwIfDisposed(),Oe.maximum(this,e)},n.prototype.maximumStrict=function(e){return this.throwIfDisposed(),Oe.maximumStrict(this,e)},n.prototype.mod=function(e){return this.throwIfDisposed(),Oe.mod(this,e)},n.prototype.modStrict=function(e){return this.throwIfDisposed(),Oe.modStrict(this,e)},n.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),Oe.squaredDifferenceStrict(this,e)},n.prototype.transpose=function(e){return this.throwIfDisposed(),Oe.transpose(this,e)},n.prototype.notEqual=function(e){return this.throwIfDisposed(),Oe.notEqual(this,e)},n.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),Oe.notEqualStrict(this,e)},n.prototype.less=function(e){return this.throwIfDisposed(),Oe.less(this,e)},n.prototype.lessStrict=function(e){return this.throwIfDisposed(),Oe.lessStrict(this,e)},n.prototype.equal=function(e){return this.throwIfDisposed(),Oe.equal(this,e)},n.prototype.equalStrict=function(e){return this.throwIfDisposed(),Oe.equalStrict(this,e)},n.prototype.lessEqual=function(e){return this.throwIfDisposed(),Oe.lessEqual(this,e)},n.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),Oe.lessEqualStrict(this,e)},n.prototype.greater=function(e){return this.throwIfDisposed(),Oe.greater(this,e)},n.prototype.greaterStrict=function(e){return this.throwIfDisposed(),Oe.greaterStrict(this,e)},n.prototype.greaterEqual=function(e){return this.throwIfDisposed(),Oe.greaterEqual(this,e)},n.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),Oe.greaterEqualStrict(this,e)},n.prototype.logicalAnd=function(e){return this.throwIfDisposed(),Oe.logicalAnd(this,e)},n.prototype.logicalOr=function(e){return this.throwIfDisposed(),Oe.logicalOr(this,e)},n.prototype.logicalNot=function(){return this.throwIfDisposed(),Oe.logicalNot(this)},n.prototype.logicalXor=function(e){return this.throwIfDisposed(),Oe.logicalXor(this,e)},n.prototype.where=function(e,t){return this.throwIfDisposed(),Oe.where(e,this,t)},n.prototype.neg=function(){return this.throwIfDisposed(),Oe.neg(this)},n.prototype.ceil=function(){return this.throwIfDisposed(),Oe.ceil(this)},n.prototype.floor=function(){return this.throwIfDisposed(),Oe.floor(this)},n.prototype.sign=function(){return this.throwIfDisposed(),Oe.sign(this)},n.prototype.isNaN=function(){return this.throwIfDisposed(),Oe.isNaN(this)},n.prototype.isInf=function(){return this.throwIfDisposed(),Oe.isInf(this)},n.prototype.isFinite=function(){return this.throwIfDisposed(),Oe.isFinite(this)},n.prototype.exp=function(){return this.throwIfDisposed(),Oe.exp(this)},n.prototype.expm1=function(){return this.throwIfDisposed(),Oe.expm1(this)},n.prototype.log=function(){return this.throwIfDisposed(),Oe.log(this)},n.prototype.log1p=function(){return this.throwIfDisposed(),Oe.log1p(this)},n.prototype.sqrt=function(){return this.throwIfDisposed(),Oe.sqrt(this)},n.prototype.rsqrt=function(){return this.throwIfDisposed(),Oe.rsqrt(this)},n.prototype.square=function(){return this.throwIfDisposed(),Oe.square(this)},n.prototype.reciprocal=function(){return this.throwIfDisposed(),Oe.reciprocal(this)},n.prototype.abs=function(){return this.throwIfDisposed(),Oe.abs(this)},n.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),Oe.clipByValue(this,e,t)},n.prototype.relu=function(){return this.throwIfDisposed(),Oe.relu(this)},n.prototype.relu6=function(){return this.throwIfDisposed(),Oe.relu6(this)},n.prototype.elu=function(){return this.throwIfDisposed(),Oe.elu(this)},n.prototype.selu=function(){return this.throwIfDisposed(),Oe.selu(this)},n.prototype.leakyRelu=function(e){return e===void 0&&(e=.2),this.throwIfDisposed(),Oe.leakyRelu(this,e)},n.prototype.prelu=function(e){return this.throwIfDisposed(),Oe.prelu(this,e)},n.prototype.sigmoid=function(){return this.throwIfDisposed(),Oe.sigmoid(this)},n.prototype.logSigmoid=function(){return this.throwIfDisposed(),Oe.logSigmoid(this)},n.prototype.softplus=function(){return this.throwIfDisposed(),Oe.softplus(this)},n.prototype.zerosLike=function(){return this.throwIfDisposed(),Oe.zerosLike(this)},n.prototype.onesLike=function(){return this.throwIfDisposed(),Oe.onesLike(this)},n.prototype.sin=function(){return this.throwIfDisposed(),Oe.sin(this)},n.prototype.cos=function(){return this.throwIfDisposed(),Oe.cos(this)},n.prototype.tan=function(){return this.throwIfDisposed(),Oe.tan(this)},n.prototype.asin=function(){return this.throwIfDisposed(),Oe.asin(this)},n.prototype.acos=function(){return this.throwIfDisposed(),Oe.acos(this)},n.prototype.atan=function(){return this.throwIfDisposed(),Oe.atan(this)},n.prototype.sinh=function(){return this.throwIfDisposed(),Oe.sinh(this)},n.prototype.cosh=function(){return this.throwIfDisposed(),Oe.cosh(this)},n.prototype.tanh=function(){return this.throwIfDisposed(),Oe.tanh(this)},n.prototype.asinh=function(){return this.throwIfDisposed(),Oe.asinh(this)},n.prototype.acosh=function(){return this.throwIfDisposed(),Oe.acosh(this)},n.prototype.atanh=function(){return this.throwIfDisposed(),Oe.atanh(this)},n.prototype.erf=function(){return this.throwIfDisposed(),Oe.erf(this)},n.prototype.round=function(){return this.throwIfDisposed(),Oe.round(this)},n.prototype.step=function(e){return e===void 0&&(e=0),this.throwIfDisposed(),Oe.step(this,e)},n.prototype.softmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),Oe.softmax(this,e)},n.prototype.logSoftmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),Oe.logSoftmax(this,e)},n.prototype.resizeBilinear=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),Oe.image.resizeBilinear(this,e,t)},n.prototype.resizeNearestNeighbor=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),Oe.image.resizeNearestNeighbor(this,e,t)},n.prototype.conv1d=function(e,t,r,s,o,i){return s===void 0&&(s="NWC"),o===void 0&&(o=1),this.throwIfDisposed(),Oe.conv1d(this,e,t,r,s,o,i)},n.prototype.conv2d=function(e,t,r,s,o,i){return s===void 0&&(s="NHWC"),o===void 0&&(o=[1,1]),this.throwIfDisposed(),Oe.conv2d(this,e,t,r,s,o,i)},n.prototype.conv2dTranspose=function(e,t,r,s,o){return this.throwIfDisposed(),Oe.conv2dTranspose(this,e,t,r,s,o)},n.prototype.depthwiseConv2D=function(e,t,r,s,o,i){return s===void 0&&(s="NHWC"),o===void 0&&(o=[1,1]),this.throwIfDisposed(),Oe.depthwiseConv2d(this,e,t,r,s,o,i)},n.prototype.separableConv2d=function(e,t,r,s,o,i){return o===void 0&&(o=[1,1]),i===void 0&&(i="NHWC"),this.throwIfDisposed(),Oe.separableConv2d(this,e,t,r,s,o,i)},n.prototype.avgPool=function(e,t,r,s){return this.throwIfDisposed(),Oe.avgPool(this,e,t,r,s)},n.prototype.maxPool=function(e,t,r,s){return this.throwIfDisposed(),Oe.maxPool(this,e,t,r,s)},n.prototype.localResponseNormalization=function(e,t,r,s){return e===void 0&&(e=5),t===void 0&&(t=1),r===void 0&&(r=1),s===void 0&&(s=.5),Oe.localResponseNormalization(this,e,t,r,s)},n.prototype.pool=function(e,t,r,s,o){return this.throwIfDisposed(),Oe.pool(this,e,t,r,s,o)},n.prototype.variable=function(e,t,r){return e===void 0&&(e=!0),this.throwIfDisposed(),Wl().makeVariable(this,e,t,r)},n.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),Oe.unsortedSegmentSum(this,e,t)},n.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),Oe.batchToSpaceND(this,e,t)},n.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),Oe.spaceToBatchND(this,e,t)},n.prototype.topk=function(e,t){return e===void 0&&(e=1),t===void 0&&(t=!0),this.throwIfDisposed(),Oe.topk(this,e,t)},n.prototype.stridedSlice=function(e,t,r,s,o,i,a,l){return s===void 0&&(s=0),o===void 0&&(o=0),i===void 0&&(i=0),a===void 0&&(a=0),l===void 0&&(l=0),this.throwIfDisposed(),Oe.stridedSlice(this,e,t,r,s,o,i,a,l)},n.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),Oe.depthToSpace(this,e,t)},n.prototype.fft=function(){return this.throwIfDisposed(),Oe.spectral.fft(this)},n.prototype.ifft=function(){return this.throwIfDisposed(),Oe.spectral.ifft(this)},n.prototype.rfft=function(){return this.throwIfDisposed(),Oe.spectral.rfft(this)},n.prototype.irfft=function(){return this.throwIfDisposed(),Oe.spectral.irfft(this)},n})();Object.defineProperty(Kr,Symbol.hasInstance,{value:function(n){return!!n&&n.dataId!=null&&n.shape!=null&&n.dtype!=null}});var K9,c5,u5,d5,f5,Ep=(function(n){function e(t,r,s,o){var i=n.call(this,t.shape,t.dtype,t.dataId,o)||this;return i.trainable=r,i.name=s,i}return ml(e,n),e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!eo(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");Wl().disposeTensor(this),this.dataId=t.dataId,Wl().incRef(this,null)},e.prototype.dispose=function(){Wl().disposeVariable(this),this.isDisposedInternal=!0},e})(Kr);Object.defineProperty(Ep,Symbol.hasInstance,{value:function(n){return n instanceof Kr&&n.assign!=null&&n.assign instanceof Function}}),(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(K9||(K9={})),(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(c5||(c5={})),(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(u5||(u5={})),(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(d5||(d5={})),(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(f5||(f5={}));var KQ={float32:d5,int32:c5,bool:u5,complex64:f5};function fo(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error("Can not upcast "+n+" with "+e)}return KQ[n][e]}function $C(n){return fo(n,"int32")}function Yr(n,e){if(n.dtype===e.dtype)return[n,e];var t=fo(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function XQ(n,e){ee(n.dtype===e.dtype,(function(){return"The dtypes of the first("+n.dtype+") and second("+e.dtype+") input must match"}))}function X$(n){var e=[];return(function t(r,s,o){if(r!=null){if(r instanceof Kr)return void s.push(r);if(i=r,!(!Array.isArray(i)&&typeof i!="object")){var i,a=r;for(var l in a){var c=a[l];o.has(c)||(o.add(c),t(c,s,o))}}}})(n,e,new Set),e}var FC,X9=(function(){function n(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return n.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},n})(),YQ=(function(){function n(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new X9}return n.prototype.ready=function(){return Vt(this,void 0,void 0,(function(){var e,t,r;return zt(this,(function(s){switch(s.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then((function(){}))];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,s.label=1;case 1:return t<e.length?(r=e[t],[4,this.initializeBackend(r).success]):[3,5];case 2:return s.sent()?[4,this.setBackend(r)]:[3,4];case 3:return s.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}}))}))},Object.defineProperty(n.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),n.prototype.backendNames=function(){return Object.keys(this.registryFactory)},n.prototype.findBackend=function(e){return!(e in this.registry)&&(!(e in this.registryFactory)||this.initializeBackend(e).asyncInit)?null:this.registry[e]},n.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},n.prototype.registerBackend=function(e,t,r){return r===void 0&&(r=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:r},!0)},n.prototype.setBackend=function(e){return Vt(this,void 0,void 0,(function(){var t,r,s;return zt(this,(function(o){switch(o.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),r=t.success,t.asyncInit?[4,r]:[3,2]);case 1:return s=o.sent(),[3,3];case 2:s=r,o.label=3;case 3:if(!s)return[2,!1];o.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new HQ(this.backendInstance),[2,!0]}}))}))},n.prototype.setupRegisteredKernels=function(){var e=this;W9(this.backendName).forEach((function(t){t.setupFunc!=null&&t.setupFunc(e.backendInstance)}))},n.prototype.disposeRegisteredKernels=function(e){var t=this;W9(e).forEach((function(r){r.disposeFunc!=null&&r.disposeFunc(t.registry[e])}))},n.prototype.initializeBackend=function(e){var t=this,r=this.registryFactory[e];if(r==null)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var s=r.factory();if(Promise.resolve(s)===s){var o=++this.pendingBackendInitId,i=s.then((function(a){return!(o<t.pendingBackendInitId)&&(t.registry[e]=a,t.pendingBackendInit=null,!0)})).catch((function(a){return!(o<t.pendingBackendInitId)&&(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(a.stack||a.message),!1)}));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}return this.registry[e]=s,{success:!0,asyncInit:!1}}catch(a){return console.warn("Initialization of backend "+e+" failed"),console.warn(a.stack||a.message),{success:!1,asyncInit:!1}}},n.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},n.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,r){return e.registryFactory[r].priority-e.registryFactory[t].priority}))},n.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var r=e[t],s=this.initializeBackend(r),o=s.success,i=s.asyncInit;if(i||o)return{name:r,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")},n.prototype.moveData=function(e,t){var r=this.state.tensorInfo.get(t),s=r.backend,o=this.readSync(t);s.disposeData(t),r.backend=e,e.move(t,o,r.shape,r.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},n.prototype.tidy=function(e,t){var r,s=this,o=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=e}return this.scopedRun((function(){return s.startScope(o)}),(function(){return s.endScope(r)}),(function(){return(r=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r}))},n.prototype.scopedRun=function(e,t,r){e();try{var s=r();return t(),s}catch(o){throw t(),o}},n.prototype.nextTensorId=function(){return n.nextTensorId++},n.prototype.nextVariableId=function(){return n.nextVariableId++},n.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),r={x:e};return this.addTapeNode(this.state.activeScope.name,r,[t],(function(s){return{x:function(){return s.toFloat()}}}),[]),t},n.prototype.runKernel=function(e,t,r,s,o){return this.runKernelFunc(null,t,null,e,r,s,o)},n.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},n.prototype.checkKernelForMemLeak=function(e,t,r){var s=this.backend.numDataIds(),o=0;r.forEach((function(l){o+=l.dtype==="complex64"?3:1}));var i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=s-t-o-i;if(a>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+a+" data ids) after running '"+e+"'")},n.prototype.runKernelFunc=function(e,t,r,s,o,i,a){var l,c=this;i===void 0&&(i=[]),a===void 0&&(a=[]);var u=[],d=this.isTapeOn();s==null&&(s=this.state.activeScope!=null?this.state.activeScope.name:"");var f,p=function(w){d&&(u=w.map((function(S){return c.keep(c.clone(S))})))},x=this.state.numBytes,v=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var y,b=j$(s,this.backendName);return f=b!=null?function(){var w=c.backend.numDataIds();y=b.kernelFunc({inputs:t,attrs:o,backend:c.backend});var S=Array.isArray(y)?y:[y];c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(s,w,S);var k=S.map((function(I){var T=I.dataId,F=I.shape,R=I.dtype;return c.makeTensorFromDataId(T,F,R)})),N=k.filter((function(I,T){return a[T]}));return p((i||[]).slice().concat(N)),k}:function(){var w=c.backend.numDataIds();y=c.tidy((function(){return e(c.backend,p)}));var S=Array.isArray(y)?y:[y];return c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(s,w,S),S},this.scopedRun((function(){return c.state.kernelDepth++}),(function(){return c.state.kernelDepth--}),(function(){l=c.ENV.getBool("DEBUG")?c.profiler.profileKernel(s,t,(function(){return f()})):f()})),d&&this.addTapeNode(s,t,l,r,u),this.state.profiling&&this.state.activeProfile.kernels.push({name:s,bytesAdded:this.state.numBytes-x,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-v,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map((function(w){return t[w].shape})),outputShapes:l.map((function(w){return w.shape}))}),Array.isArray(y)?l:l[0]},n.prototype.makeTensor=function(e,t,r,s){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",s=s||this.backend;var o=e;r==="string"&&Kk(e[0])&&(o=e.map((function(u){return WQ(u)})));var i=s.write(o,t,r),a=new Kr(t,r,i,this.nextTensorId());if(this.incRef(a,s),r==="string"){var l=this.state.tensorInfo.get(i),c=BQ(o);this.state.numBytes+=c-l.bytes,l.bytes=c}return a},n.prototype.makeTensorFromDataId=function(e,t,r,s){var o=new Kr(t,r=r||"float32",e,this.nextTensorId());return this.incRef(o,s),o},n.prototype.makeVariable=function(e,t,r,s){t===void 0&&(t=!0),r=r||this.nextVariableId().toString(),s!=null&&s!==e.dtype&&(e=e.asType(s));var o=new Ep(e,t,r,this.nextTensorId());if(this.state.registeredVariables[o.name]!=null)throw new Error("Variable with name "+o.name+" was already registered");return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o},n.prototype.incRef=function(e,t){var r=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++,r===0){this.state.numDataBuffers++;var s=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(s=e.size*W$(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:s,refCount:0}),this.state.numBytes+=s}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof Ep||this.track(e)},n.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,e.dtype==="string"&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?(e.dtype!=="complex64"&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},n.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},n.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},n.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},n.prototype.profile=function(e){return Vt(this,void 0,void 0,(function(){var t,r;return zt(this,(function(s){return this.state.profiling=!0,t=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map((function(o){return o.totalBytesSnapshot}))),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]}))}))},n.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},n.prototype.addTapeNode=function(e,t,r,s,o){var i=this,a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:r,saved:o},l=AQ(e);l!=null&&(s=l.gradFunc),s!=null&&(a.gradient=function(c){return c=c.map((function(u,d){if(u==null){var f=r[d],p=e1(f.size,f.dtype);return i.makeTensor(p,f.shape,f.dtype)}return u})),s(c.length>1?c:c[0],o)}),this.state.activeTape.push(a)},n.prototype.keep=function(e){return e.kept=!0,e},n.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},n.prototype.endTape=function(){this.state.gradientDepth--},n.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},n.prototype.endScope=function(e){for(var t=this,r=X$(e),s=new Set(r.map((function(l){return l.id}))),o=0;o<this.state.activeScope.track.length;o++){var i=this.state.activeScope.track[o];i.kept||s.has(i.id)||i.dispose()}var a=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach((function(l){l.kept||l.scopeId!==a.id||t.track(l)}))},n.prototype.gradients=function(e,t,r,s){var o=this;if(s===void 0&&(s=!1),ee(t.length>0,(function(){return"gradients() received an empty list of xs."})),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var i=this.scopedRun((function(){return o.startTape()}),(function(){return o.endTape()}),(function(){return o.tidy("forward",e)}));ee(i instanceof Kr,(function(){return"The result y returned by f() must be a tensor."}));var a=(function(l,c,u){for(var d={},f={},p=0;p<c.length;p++)d[c[p].id]=!0;for(p=0;p<l.length;p++){var x=(I=l[p]).inputs;for(var v in x){for(var y=x[v],b=!1,w=0;w<c.length;w++)if(d[y.id]){I.outputs.forEach((function(D){return d[D.id]=!0})),b=!0,f[I.id]=!0;break}if(b)break}}var S={};S[u.id]=!0;var k={};for(p=l.length-1;p>=0;p--)for(x=(I=l[p]).inputs,w=0;w<I.outputs.length;w++)if(S[I.outputs[w].id]){for(var v in x)S[x[v].id]=!0,k[I.id]=!0;break}var N=[];for(p=0;p<l.length;p++){var I;if(f[(I=l[p]).id]&&k[I.id]){var T={};for(var v in I.inputs){var F=I.inputs[v];d[F.id]&&(T[v]=F)}var R=Object.assign({},I);R.inputs=T,R.outputs=I.outputs,N.push(R)}}return N})(this.state.activeTape,t,i);if(!s&&a.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var l,c,u={};u[i.id]=r??(l=i.shape,c=H$(Xt(l),"float32"),ge.makeTensor(c,l,"float32")),(function(f,p,x){for(var v=function(b){var w=p[b],S=[];if(w.outputs.forEach((function(T){var F=f[T.id];F!=null?S.push(F):S.push(null)})),w.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+w.kernelName+".");var k=w.gradient(S),N=function(T){if(!(T in k))throw new Error("Cannot backprop through input "+T+". Available gradients found: "+Object.keys(k)+".");var F=x((function(){return k[T]()}));if(F.dtype!=="float32")throw new Error("Error in gradient for op "+w.kernelName+". The gradient of input "+T+" must have 'float32' dtype, but has '"+F.dtype+"'");var R=w.inputs[T];if(!eo(F.shape,R.shape))throw new Error("Error in gradient for op "+w.kernelName+". The gradient of input '"+T+"' has shape '"+F.shape+"', which does not match the shape of the input '"+R.shape+"'");if(f[R.id]==null)f[R.id]=F;else{var D=f[R.id];f[R.id]=D.add(F),D.dispose()}};for(var I in w.inputs)N(I)},y=p.length-1;y>=0;y--)v(y)})(u,a,(function(f){return o.tidy(f)}));var d=t.map((function(f){return u[f.id]}));return o.state.gradientDepth===0&&(o.state.activeTape.forEach((function(f){for(var p=0,x=f.saved;p<x.length;p++)x[p].dispose()})),o.state.activeTape=null),{value:i,grads:d}}))},n.prototype.customGrad=function(e){var t=this;return ee(a5(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var r,s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];ee(s.every((function(a){return a instanceof Kr})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var i={};return s.forEach((function(a,l){i[l]=a})),t.runKernelFunc((function(a,l){return ee((r=e.apply(void 0,s.concat([l]))).value instanceof Kr,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),ee(a5(r.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),r.value}),i,(function(a,l){var c=r.gradFunc(a,l),u=Array.isArray(c)?c:[c];ee(u.length===s.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),ee(u.every((function(f){return f instanceof Kr})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var d={};return u.forEach((function(f,p){d[p]=function(){return f}})),d}))}},n.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},n.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},n.prototype.time=function(e){return Vt(this,void 0,void 0,(function(){var t,r;return zt(this,(function(s){switch(s.label){case 0:return t=Ml(),[4,this.backend.time(e)];case 1:return(r=s.sent()).wallMs=Ml()-t,[2,r]}}))}))},n.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(n.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),n.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new X9,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},n.nextTensorId=0,n.nextVariableId=0,n})(),ge=(function(){var n=(function(){if(FC==null){var t=void 0;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else{if(typeof self>"u")throw new Error("Could not find a global object");t=self}FC=t}return FC})();if(n._tfengine==null){var e=new RQ(n);n._tfengine=new YQ(e)}return(function(t){L$=t})(n._tfengine.ENV),Wl=function(){return n._tfengine},n._tfengine})();function Y$(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Ac=je();Ac.registerFlag("DEBUG",(function(){return!1}),(function(n){n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),Ac.registerFlag("IS_BROWSER",(function(){return Y$()})),Ac.registerFlag("IS_NODE",(function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0})),Ac.registerFlag("IS_CHROME",(function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),Ac.registerFlag("PROD",(function(){return!1})),Ac.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return Ac.getBool("DEBUG")})),Ac.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),Ac.registerFlag("IS_TEST",(function(){return!1}));var _g,Ki,Ui,Qd={},PC={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function ZQ(n,e){Qd[n]=e}function pc(n){n in Qd||(Qd[n]=(function(t){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var r=(function(s){if(typeof OffscreenCanvas<"u"&&s===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")})(t);return r.addEventListener("webglcontextlost",(function(s){s.preventDefault(),delete Qd[t]}),!1),t===1?r.getContext("webgl",PC)||r.getContext("experimental-webgl",PC):r.getContext("webgl2",PC)})(n));var e=Qd[n];return e.isContextLost()?(delete Qd[n],pc(n)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),Qd[n])}function Ty(n,e){return[e,n]}function dg(n){var e=Xt(n);return i5(Math.ceil(e/4))}function t1(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function Xk(n,e){var t,r,s,o,i,a,l,c,u,d=n;return je().getNumber("WEBGL_VERSION")===2?(t=d.R32F,r=d.R16F,s=d.RGBA16F,o=d.RGBA32F,i=d.RED,a=4,l=1,c=d.HALF_FLOAT,u=d.FLOAT):(t=n.RGBA,r=n.RGBA,s=n.RGBA,o=d.RGBA,i=n.RGBA,a=4,l=4,c=e!=null?e.HALF_FLOAT_OES:null,u=n.FLOAT),{internalFormatFloat:t,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:s,internalFormatPackedFloat:o,textureFormatFloat:i,downloadTextureFormat:n.RGBA,downloadUnpackNumChannels:a,defaultNumChannels:l,textureTypeHalfFloat:c,textureTypeFloat:u}}function Qt(n,e,t){var r=t();return e&&(function(s){var o=s.getError();if(o!==s.NO_ERROR)throw new Error("WebGL Error: "+tee(s,o))})(n),r}(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(_g||(_g={})),(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(Ki||(Ki={})),(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(Ui||(Ui={}));var JQ=596e-10,QQ=65504;function eee(n){return!!(je().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||JQ<Math.abs(n)&&Math.abs(n)<QQ)}function tee(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function Qx(n,e,t){return qc(n,e,(function(){return n.getExtension(t)}),'Extension "'+t+'" not supported on this browser.')}function nee(n,e,t){var r=qc(n,e,(function(){return n.createShader(n.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(Qt(n,e,(function(){return n.shaderSource(r,t)})),Qt(n,e,(function(){return n.compileShader(r)})),n.getShaderParameter(r,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function ree(n,e,t){var r=qc(n,e,(function(){return n.createShader(n.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(Qt(n,e,(function(){return n.shaderSource(r,t)})),Qt(n,e,(function(){return n.compileShader(r)})),n.getShaderParameter(r,n.COMPILE_STATUS)===!1)throw(function(s,o){var i=see.exec(o);if(i==null)return console.log("Couldn't parse line number in error: "+o),void console.log(s);for(var a=+i[1],l=s.split(`
`),c=l.length.toString().length+2,u=l.map((function(y,b){return op((b+1).toString(),c)+y})),d=0,f=0;f<u.length;f++)d=Math.max(u[f].length,d);var p=u.slice(0,a-1),x=u.slice(a-1,a),v=u.slice(a);console.log(p.join(`
`)),console.log(o.split(`
`)[0]),console.log("%c "+op(x[0],d),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(v.join(`
`))})(t,n.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var OC,MC,see=/ERROR: [0-9]+:([0-9]+):/g;function oee(n,e){return qc(n,e,(function(){return n.createProgram()}),"Unable to create WebGLProgram.")}function iee(n,e,t){if(Qt(n,e,(function(){return n.linkProgram(t)})),n.getProgramParameter(t,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function LC(n,e,t){if(Qt(n,e,(function(){return n.validateProgram(t)})),n.getProgramParameter(t,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function aee(n,e,t){var r=qc(n,e,(function(){return n.createBuffer()}),"Unable to create WebGLBuffer");return Qt(n,e,(function(){return n.bindBuffer(n.ARRAY_BUFFER,r)})),Qt(n,e,(function(){return n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW)})),r}function lee(n,e,t){var r=qc(n,e,(function(){return n.createBuffer()}),"Unable to create WebGLBuffer");return Qt(n,e,(function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,r)})),Qt(n,e,(function(){return n.bufferData(n.ELEMENT_ARRAY_BUFFER,t,n.STATIC_DRAW)})),r}function cee(n,e){return qc(n,e,(function(){return n.createTexture()}),"Unable to create WebGLTexture.")}function uee(n,e){var t=je().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){var r="["+n+"x"+e+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(n>t||e>t)throw r="["+n+"x"+e+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+("["+t+"x"+t+"]")+".")}function dee(n,e){return qc(n,e,(function(){return n.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}function Y9(n,e,t,r,s,o,i,a){var l=n.getAttribLocation(t,r);return l!==-1&&(Qt(n,e,(function(){return n.bindBuffer(n.ARRAY_BUFFER,s)})),Qt(n,e,(function(){return n.vertexAttribPointer(l,o,n.FLOAT,!1,i,a)})),Qt(n,e,(function(){return n.enableVertexAttribArray(l)})),!0)}function fee(n,e,t,r){xee(n,r),Qt(n,e,(function(){return n.activeTexture(n.TEXTURE0+r)})),Qt(n,e,(function(){return n.bindTexture(n.TEXTURE_2D,t)}))}function hee(n,e,t,r){return qc(n,e,(function(){return n.getUniformLocation(t,r)}),'uniform "'+r+'" not present in program.')}function pee(n,e,t){return n.getUniformLocation(e,t)}function mee(n,e,t,r,s,o){Qt(n,e,(function(){return fee(n,e,r,o)})),Qt(n,e,(function(){return n.uniform1i(s,o)}))}function jC(n,e,t,r){Qt(n,e,(function(){return n.bindFramebuffer(n.FRAMEBUFFER,r)})),Qt(n,e,(function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0)}))}function Z9(n,e,t){Qt(n,e,(function(){return n.bindFramebuffer(n.FRAMEBUFFER,t)})),Qt(n,e,(function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0)}))}function ev(n){var e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+gee(n,e))}function gee(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function qc(n,e,t,r){var s=Qt(n,e,(function(){return t()}));if(s==null)throw new Error(r);return s}function xee(n,e){var t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+n.TEXTURE0;if(r<n.TEXTURE0||r>t)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+t+"]")+".")}function h2(n,e){return e===void 0&&(e=2),Xt(n.slice(0,n.length-e))}function p2(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function BC(n){var e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[h2(n)].concat(p2(n))),e}function vee(n,e){var t;e===void 0&&(e=!1);var r=je().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(r*=2,(n=n.map((function(c,u){return u>=n.length-2?z$(n[u]):n[u]}))).length===1&&(n=[2,n[0]])),n.length!==2){var s=nf(n);n=s.newShape}var o=Xt(n);if(n.length<=1&&o<=r)return[1,o];if(n.length===2&&n[0]<=r&&n[1]<=r)return n;if(n.length===3&&n[0]*n[1]<=r&&n[2]<=r)return[n[0]*n[1],n[2]];if(n.length===3&&n[0]<=r&&n[1]*n[2]<=r)return[n[0],n[1]*n[2]];if(n.length===4&&n[0]*n[1]*n[2]<=r&&n[3]<=r)return[n[0]*n[1]*n[2],n[3]];if(n.length===4&&n[0]<=r&&n[1]*n[2]*n[3]<=r)return[n[0],n[1]*n[2]*n[3]];if(e){var i=h2(n),a=2,l=2;return n.length&&(a=(t=p2(n))[0],l=t[1]),i5(o=i*(a/2)*(l/2)).map((function(c){return 2*c}))}return i5(o)}function tv(n){return n%2==0}function nv(n,e){if(eo(n=n.slice(-2),e=e.slice(-2))||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){var t=n.slice(-1)[0],r=e.slice(-1)[0];if(t===r||tv(t)&&tv(r)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&tv(n[0])&&tv(e[0])}function yee(n){if(OC==null){var e=pc(n);OC=e.getParameter(e.MAX_TEXTURE_SIZE)}return OC}function bee(n){if(MC==null){var e=pc(n);MC=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,MC)}function wee(n){if(n===0)return 0;var e=pc(n);return Ea(e,"EXT_disjoint_timer_query_webgl2")&&n===2?2:Ea(e,"EXT_disjoint_timer_query")?1:0}function Ea(n,e){return n.getExtension(e)!=null}function J9(n){try{if(pc(n)!=null)return!0}catch{return!1}return!1}function Cee(n){if(n===0)return!1;var e=pc(n);if(n===1){if(!Ea(e,"OES_texture_float"))return!1}else if(!Ea(e,"EXT_color_buffer_float"))return!1;return h5(e)}function kee(n){if(n===0)return!1;var e=pc(n);if(n!==1){if(Ea(e,"EXT_color_buffer_float"))return h5(e);if(Ea(e,"EXT_color_buffer_half_float")){var t=e.getExtension("EXT_color_buffer_half_float");return(function(r,s){var o=Xk(r,s),i=r.createTexture();r.bindTexture(r.TEXTURE_2D,i),r.texImage2D(r.TEXTURE_2D,0,o.internalFormatHalfFloat,1,1,0,o.textureFormatFloat,o.textureTypeHalfFloat,null);var a=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,a),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,i,0);var l=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(i),r.deleteFramebuffer(a),l})(e,t)}return!1}return!!Ea(e,"OES_texture_float")&&!!Ea(e,"WEBGL_color_buffer_float")&&h5(e)}function h5(n){var e=Xk(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);var r=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,r),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);var s=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(r),s}function See(n){return n===2&&pc(n).fenceSync!=null}var xn=je();function Z$(n){je().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function $t(n,e){return ge.tidy(n,e)}function ki(n){X$(n).forEach((function(e){return e.dispose()}))}function Nee(n){return ge.keep(n)}function m2(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];je().getBool("IS_TEST")||console.warn.apply(console,n)}function md(n,e){var t=n;if(Yl(n))return e==="string"?[]:[n.length];if(!Array.isArray(n))return[];for(var r=[];Array.isArray(t)||Yl(t)&&e!=="string";)r.push(t.length),t=t[0];return Array.isArray(n)&&je().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&(function s(o,i,a){if(a=a||[],!Array.isArray(o)&&!Yl(o))return void ee(i.length===0,(function(){return"Element arr["+a.join("][")+"] is a primitive, but should be an array/TypedArray of "+i[0]+" elements"}));ee(i.length>0,(function(){return"Element arr["+a.join("][")+"] should be a primitive, but is an array of "+o.length+" elements"})),ee(o.length===i[0],(function(){return"Element arr["+a.join("][")+"] should have "+i[0]+" elements, but has "+o.length+" elements"}));for(var l=i.slice(1),c=0;c<o.length;++c)s(o[c],l,a.concat(c))})(n,r,[]),r}function Q9(n,e,t,r){if(n!=null&&(n!=="numeric"&&n!==e||n==="numeric"&&e==="string"))throw new Error("Argument '"+t+"' passed to '"+r+"' must be "+n+" tensor, but got "+e+" tensor")}function Y(n,e,t,r){if(r===void 0&&(r="numeric"),n instanceof Kr)return Q9(r,n.dtype,e,t),n;var s=Qg(n);if(s!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(s=r),Q9(r,s,e,t),n==null||!Yl(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){var o=n==null?"null":n.constructor.name;throw new Error("Argument '"+e+"' passed to '"+t+"' must be a Tensor or TensorLike, but got '"+o+"'")}var i=md(n,s);Yl(n)||Array.isArray(n)||(n=[n]);var a=s!=="string"?U$(n,s,je().getBool("DEBUG")):Np(n,[],!0);return ge.makeTensor(a,i,s)}function g2(n,e,t,r){if(r===void 0&&(r="numeric"),!Array.isArray(n))throw new Error("Argument "+e+" passed to "+t+" must be a `Tensor[]` or `TensorLike[]`");return n.map((function(s,o){return Y(s,e+"["+o+"]",t)}),r)}function J$(n,e){for(var t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function Eee(n,e,t){for(var r=n.length+e.length,s=[],o=0,i=0,a=0;a<r;a++)t.indexOf(a)===-1?s.push(n[o++]):s.push(e[i++]);return s}function Do(n,e){for(var t=[],r=n.length,s=0;s<r;s++)e.indexOf(s)===-1&&t.push(n[s]);return[t,e.map((function(o){return n[o]}))]}function Si(n,e){return Eee(n,e.map((function(t){return 1})),e)}function zi(n,e,t){ee(J$(e,t),(function(){return n+" supports only inner-most axes for now. Got axes "+e+" and rank-"+t+" input."}))}function mc(n,e){if(J$(n,e))return null;for(var t=[],r=0;r<e;++r)n.indexOf(r)===-1&&t.push(r);return n.forEach((function(s){return t.push(s)})),t}function Yk(n){return n.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function gc(n,e){for(var t=[],r=e-n;r<e;++r)t.push(r);return t}function Iee(n,e){var t=n[0].length;n.forEach((function(s,o){ee(s.length===t,(function(){return"Error in concat"+t+"D: rank of tensors["+o+"] must be the same as the rank of the rest ("+t+")"}))})),ee(e>=0&&e<t,(function(){return"Error in concat"+t+"D: axis must be between 0 and "+(t-1)+"."}));var r=n[0];n.forEach((function(s,o){for(var i=0;i<t;i++)ee(i===e||s[i]===r[i],(function(){return"Error in concat"+t+"D: Shape of tensors["+o+"] ("+s+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+o+"."}))}))}function Ip(n,e){for(var t=n[0].slice(),r=1;r<n.length;r++)t[e]+=n[r][e];return t}function ie(n){var e=Object.keys(n);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var t=e[0],r=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1));var s=function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];ge.startScope(t);try{var a=r.apply(void 0,o);return a instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),ge.endScope(a),a}catch(l){throw ge.endScope(null),l}};return Object.defineProperty(s,"name",{value:t,configurable:!0}),s}xn.registerFlag("HAS_WEBGL",(function(){return xn.getNumber("WEBGL_VERSION")>0})),xn.registerFlag("WEBGL_VERSION",(function(){return J9(2)?2:J9(1)?1:0})),xn.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return xn.get("WEBGL_VERSION")===2})),xn.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),xn.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),xn.registerFlag("WEBGL_PACK",(function(){return xn.getBool("HAS_WEBGL")})),xn.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return xn.getBool("WEBGL_PACK")})),xn.registerFlag("WEBGL_PACK_CLIP",(function(){return xn.getBool("WEBGL_PACK")})),xn.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return!1})),xn.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return xn.getBool("WEBGL_PACK")})),xn.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return xn.getBool("WEBGL_PACK")})),xn.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return xn.getBool("WEBGL_PACK")})),xn.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return xn.getBool("WEBGL_PACK")})),xn.registerFlag("WEBGL_PACK_REDUCE",(function(){return xn.getBool("WEBGL_PACK")})),xn.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return xn.getBool("WEBGL_PACK")})),xn.registerFlag("WEBGL_CONV_IM2COL",(function(){return xn.getBool("WEBGL_PACK")})),xn.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return yee(xn.getNumber("WEBGL_VERSION"))})),xn.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return bee(xn.getNumber("WEBGL_VERSION"))})),xn.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var n=xn.getNumber("WEBGL_VERSION");return n===0?0:wee(n)})),xn.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return xn.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(n=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(n)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4))));var n})),xn.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return Cee(xn.getNumber("WEBGL_VERSION"))})),xn.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!xn.getBool("WEBGL_FORCE_F16_TEXTURES")&&xn.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),xn.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return kee(xn.getNumber("WEBGL_VERSION"))})),xn.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return See(xn.getNumber("WEBGL_VERSION"))})),xn.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return xn.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),K$=Z$;var uo=ie({complex_:function(n,e){var t=Y(n,"real","complex"),r=Y(e,"imag","complex");return pr(t.shape,r.shape,"real and imag shapes, "+t.shape+" and "+r.shape+", must match in call to tf.complex()."),ge.runKernelFunc((function(s){return s.complex(t,r)}),{$real:t,$imag:r})}}),Sa=ie({real_:function(n){var e=Y(n,"input","real");return ge.runKernelFunc((function(t){return t.real(e)}),{$input:e})}}),Ul=ie({imag_:function(n){var e=Y(n,"input","imag");return ge.runKernelFunc((function(t){return t.imag(e)}),{$input:e})}});function ho(n,e,t){return gd(n,e,md(n,t),t)}function gd(n,e,t,r){if(r==null&&(r=Qg(n)),r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Yl(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){G$(e);var s=Xt(e),o=Xt(t);ee(s===o,(function(){return"Based on the provided shape, ["+e+"], the tensor should have "+s+" values but has "+o}));for(var i=0;i<t.length;++i){var a=t[i],l=i!==t.length-1||a!==Xt(e.slice(i));ee(t[i]===e[i]||!l,(function(){return"Error creating a new Tensor. Inferred shape ("+t+") does not match the provided shape ("+e+"). "}))}}return Yl(n)||Array.isArray(n)||(n=[n]),e=e||t,n=r!=="string"?U$(n,r,je().getBool("DEBUG")):Np(n,[],!0),ge.makeTensor(n,e,r)}function St(n,e){if((Yl(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Yl(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return gd(n,[],[],e)}function bs(n,e){qp(n);var t=md(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return gd(n,null,t,e)}function Xu(n,e,t){if(qp(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var r=md(n,t);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return gd(n,e,r,t)}function Zk(n,e,t){if(qp(n),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var r=md(n,t);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return gd(n,e,r,t)}function yi(n,e,t){if(qp(n),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var r=md(n,t);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return gd(n,e,r,t)}function Tee(n,e,t){if(qp(n),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var r=md(n,t);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return gd(n,e,r,t)}function _ee(n,e,t){if(qp(n),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var r=md(n,t);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return gd(n,e=e||r,r,t)}function Ree(n,e,t,r){return e===void 0&&(e=!0),ge.makeVariable(n,e,t,r)}function Kp(n,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=Kp(n,"float32"),r=Mr(n,"float32");return uo(t,r)}var s=H$(Xt(n),e);return ge.makeTensor(s,n,e)}function Mr(n,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=Mr(n,"float32"),r=Mr(n,"float32");return uo(t,r)}var s=e1(Xt(n),e);return ge.makeTensor(s,n,e)}function Jl(n,e,t){return ge.runKernelFunc((function(r){return r.fill(n,e,t)}),{})}function Dee(n,e,t){if(t<=0)throw new Error("The number of values should be positive.");return ge.runKernelFunc((function(r){return r.linspace(n,e,t)}),{})}function x2(n,e,t,r){if(t===void 0&&(t=1),r===void 0&&(r="float32"),t===0)throw new Error("Cannot have a step of zero");if(n===e||n<e&&t<0||e<n&&t>1)return Mr([0],r);var s=e1(Math.abs(Math.ceil((e-n)/t)),r);e<n&&t===1&&(t=-1),s[0]=n;for(var o=1;o<s.length;o++)s[o]=s[o-1]+t;return bs(s,r)}var Q$=ie({onesLike_:function(n){var e=Y(n,"x","onesLike");if(e.dtype==="complex64"){var t=Q$(Sa(e)),r=Yn(Ul(e));return uo(t,r)}return ge.runKernelFunc((function(s){return s.onesLike(e)}),{$x:e},(function(s,o){return{$x:function(){return Yn(s)}}}))}}),Yn=ie({zerosLike_:function(n){var e=Y(n,"x","zerosLike");return ge.runKernelFunc((function(t){return t.zerosLike(e)}),{$x:e},(function(t,r){return{$x:function(){return Yn(t)}}}))}}),Ls=ie({concat_:function(n,e){e===void 0&&(e=0),ee(n.length>=1,(function(){return"Pass at least one tensor to concat"}));var t=g2(n,"tensors","concat");t[0].dtype==="complex64"&&t.forEach((function(a){if(a.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+a.dtype+". ")})),e=zs(e,t[0].shape)[0];var r=Ip(t.map((function(a){return a.shape})),e);if(Xt(r)===0)return ho([],r);if((t=t.filter((function(a){return a.size>0}))).length===1)return t[0];var s=t.map((function(a){return a.shape}));Iee(s,e);var o=t,i={axis:e};return ge.runKernelFunc((function(a){return a.concat(t,e)}),o,(function(a){var l=s.map((function(c){return c[e]}));return Jk(a,l,e).map((function(c){return function(){return c}}))}),"Concat",i)}}),Aee=ie({concat1d_:function(n){return Ls(n,0)}}),$ee=ie({concat2d_:function(n,e){return Ls(n,e)}}),Fee=ie({concat3d_:function(n,e){return Ls(n,e)}}),Pee=ie({concat4d_:function(n,e){return Ls(n,e)}}),Jk=ie({split_:function(n,e,t){t===void 0&&(t=0);var r,s=Y(n,"x","split");return t=zs(t,s.shape)[0],typeof e=="number"?(ee(s.shape[t]%e==0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(e).fill(s.shape[t]/e)):(ee(s.shape[t]===e.reduce((function(o,i){return o+i})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=e),ge.runKernelFunc((function(o){return o.split(s,r,t)}),{$x:s},(function(o){return{$x:function(){return Ls(o,t)}}}))}});function zf(n,e){return n(e={exports:{}},e.exports),e.exports}var Oee=zf((function(n){(function(e,t,r){function s(a){var l,c=this,u=(l=4022871197,function(d){d=d.toString();for(var f=0;f<d.length;f++){var p=.02519603282416938*(l+=d.charCodeAt(f));p-=l=p>>>0,l=(p*=l)>>>0,l+=4294967296*(p-=l)}return 23283064365386963e-26*(l>>>0)});c.next=function(){var d=2091639*c.s0+23283064365386963e-26*c.c;return c.s0=c.s1,c.s1=c.s2,c.s2=d-(c.c=0|d)},c.c=1,c.s0=u(" "),c.s1=u(" "),c.s2=u(" "),c.s0-=u(a),c.s0<0&&(c.s0+=1),c.s1-=u(a),c.s1<0&&(c.s1+=1),c.s2-=u(a),c.s2<0&&(c.s2+=1),u=null}function o(a,l){return l.c=a.c,l.s0=a.s0,l.s1=a.s1,l.s2=a.s2,l}function i(a,l){var c=new s(a),u=l&&l.state,d=c.next;return d.int32=function(){return 4294967296*c.next()|0},d.double=function(){return d()+11102230246251565e-32*(2097152*d()|0)},d.quick=d,u&&(typeof u=="object"&&o(u,c),d.state=function(){return o(c,{})}),d}t&&t.exports?t.exports=i:this.alea=i})(0,n)})),Mee=zf((function(n){(function(e,t,r){function s(a){var l=this,c="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var d=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^d^d>>>8},a===(0|a)?l.x=a:c+=a;for(var u=0;u<c.length+64;u++)l.x^=0|c.charCodeAt(u),l.next()}function o(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function i(a,l){var c=new s(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(f===0);return f},d.int32=c.next,d.quick=d,u&&(typeof u=="object"&&o(u,c),d.state=function(){return o(c,{})}),d}t&&t.exports?t.exports=i:this.xor128=i})(0,n)})),Lee=zf((function(n){(function(e,t,r){function s(a){var l=this,c="";l.next=function(){var d=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^d^d<<1)|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(0|a)?l.x=a:c+=a;for(var u=0;u<c.length+64;u++)l.x^=0|c.charCodeAt(u),u==c.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function o(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function i(a,l){var c=new s(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(f===0);return f},d.int32=c.next,d.quick=d,u&&(typeof u=="object"&&o(u,c),d.state=function(){return o(c,{})}),d}t&&t.exports?t.exports=i:this.xorwow=i})(0,n)})),jee=zf((function(n){(function(e,t,r){function s(a){var l=this;l.next=function(){var c,u,d=l.x,f=l.i;return c=d[f],u=(c^=c>>>7)^c<<24,u^=(c=d[f+1&7])^c>>>10,u^=(c=d[f+3&7])^c>>>3,u^=(c=d[f+4&7])^c<<7,c=d[f+7&7],u^=(c^=c<<13)^c<<9,d[f]=u,l.i=f+1&7,u},(function(c,u){var d,f=[];if(u===(0|u))f[0]=u;else for(u=""+u,d=0;d<u.length;++d)f[7&d]=f[7&d]<<15^u.charCodeAt(d)+f[d+1&7]<<13;for(;f.length<8;)f.push(0);for(d=0;d<8&&f[d]===0;++d);for(d==8?f[7]=-1:f[d],c.x=f,c.i=0,d=256;d>0;--d)c.next()})(l,a)}function o(a,l){return l.x=a.x.slice(),l.i=a.i,l}function i(a,l){a==null&&(a=+new Date);var c=new s(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(f===0);return f},d.int32=c.next,d.quick=d,u&&(u.x&&o(u,c),d.state=function(){return o(c,{})}),d}t&&t.exports?t.exports=i:this.xorshift7=i})(0,n)})),Bee=zf((function(n){(function(e,t,r){function s(a){var l=this;l.next=function(){var c,u,d=l.w,f=l.X,p=l.i;return l.w=d=d+1640531527|0,u=f[p+34&127],c=f[p=p+1&127],u^=u<<13,c^=c<<17,u^=u>>>15,c^=c>>>12,u=f[p]=u^c,l.i=p,u+(d^d>>>16)|0},(function(c,u){var d,f,p,x,v,y=[],b=128;for(u===(0|u)?(f=u,u=null):(u+="\0",f=0,b=Math.max(b,u.length)),p=0,x=-32;x<b;++x)u&&(f^=u.charCodeAt((x+32)%u.length)),x===0&&(v=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,x>=0&&(v=v+1640531527|0,p=(d=y[127&x]^=f+v)==0?p+1:0);for(p>=128&&(y[127&(u&&u.length||0)]=-1),p=127,x=512;x>0;--x)f=y[p+34&127],d=y[p=p+1&127],f^=f<<13,d^=d<<17,f^=f>>>15,d^=d>>>12,y[p]=f^d;c.w=v,c.X=y,c.i=p})(l,a)}function o(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function i(a,l){a==null&&(a=+new Date);var c=new s(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(f===0);return f},d.int32=c.next,d.quick=d,u&&(u.X&&o(u,c),d.state=function(){return o(c,{})}),d}t&&t.exports?t.exports=i:this.xor4096=i})(0,n)})),Vee=zf((function(n){(function(e,t,r){function s(a){var l=this,c="";l.next=function(){var d=l.b,f=l.c,p=l.d,x=l.a;return d=d<<25^d>>>7^f,f=f-p|0,p=p<<24^p>>>8^x,x=x-d|0,l.b=d=d<<20^d>>>12^f,l.c=f=f-p|0,l.d=p<<16^f>>>16^x,l.a=x-d|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=0|a):c+=a;for(var u=0;u<c.length+20;u++)l.b^=0|c.charCodeAt(u),l.next()}function o(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function i(a,l){var c=new s(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(f===0);return f},d.int32=c.next,d.quick=d,u&&(typeof u=="object"&&o(u,c),d.state=function(){return o(c,{})}),d}t&&t.exports?t.exports=i:this.tychei=i})(0,n)})),ef=zf((function(n){(function(e,t){var r,s=this,o=256,i=6,a="random",l=t.pow(o,i),c=t.pow(2,52),u=2*c,d=o-1;function f(b,w,S){var k=[],N=v((function F(R,D){var A,P=[],B=typeof R;if(D&&B=="object")for(A in R)try{P.push(F(R[A],D-1))}catch{}return P.length?P:B=="string"?R:R+"\0"})((w=w==1?{entropy:!0}:w||{}).entropy?[b,y(e)]:b??(function(){try{var F;return r&&(F=r.randomBytes)?F=F(o):(F=new Uint8Array(o),(s.crypto||s.msCrypto).getRandomValues(F)),y(F)}catch{var R=s.navigator,D=R&&R.plugins;return[+new Date,s,D,s.screen,y(e)]}})(),3),k),I=new p(k),T=function(){for(var F=I.g(i),R=l,D=0;F<c;)F=(F+D)*o,R*=o,D=I.g(1);for(;F>=u;)F/=2,R/=2,D>>>=1;return(F+D)/R};return T.int32=function(){return 0|I.g(4)},T.quick=function(){return I.g(4)/4294967296},T.double=T,v(y(I.S),e),(w.pass||S||function(F,R,D,A){return A&&(A.S&&x(A,I),F.state=function(){return x(I,{})}),D?(t[a]=F,R):F})(T,N,"global"in w?w.global:this==t,w.state)}function p(b){var w,S=b.length,k=this,N=0,I=k.i=k.j=0,T=k.S=[];for(S||(b=[S++]);N<o;)T[N]=N++;for(N=0;N<o;N++)T[N]=T[I=d&I+b[N%S]+(w=T[N])],T[I]=w;(k.g=function(F){for(var R,D=0,A=k.i,P=k.j,B=k.S;F--;)R=B[A=d&A+1],D=D*o+B[d&(B[A]=B[P=d&P+R])+(B[P]=R)];return k.i=A,k.j=P,D})(o)}function x(b,w){return w.i=b.i,w.j=b.j,w.S=b.S.slice(),w}function v(b,w){for(var S,k=b+"",N=0;N<k.length;)w[d&N]=d&(S^=19*w[d&N])+k.charCodeAt(N++);return y(w)}function y(b){return String.fromCharCode.apply(0,b)}if(t["seed"+a]=f,v(t.random(),e),n.exports){n.exports=f;try{r=require("crypto")}catch{}}})([],Math)}));ef.alea=Oee,ef.xor128=Mee,ef.xorwow=Lee,ef.xorshift7=jee,ef.xor4096=Bee,ef.tychei=Vee;var _y=ef.alea,Qk=(function(){function n(e,t,r,s,o){this.mean=e,this.stdDev=t,this.dtype=r,this.nextVal=NaN,this.truncated=s,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var i=o||Math.random();this.random=_y(i.toString())}return n.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,r,s=!1;!s;){var o=void 0,i=void 0,a=void 0;do a=(o=2*this.random()-1)*o+(i=2*this.random()-1)*i;while(a>=1||a===0);var l=Math.sqrt(-2*Math.log(a)/a);t=this.mean+this.stdDev*o*l,r=this.mean+this.stdDev*i*l,this.truncated&&!this.isValidTruncated(t)||(s=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(t)},n.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},n.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},n})(),zee=(function(){function n(e,t,r,s){this.alpha=e,this.beta=1/t,this.dtype=r;var o=s||Math.random();this.randu=_y(o.toString()),this.randn=new Qk(0,1,r,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return n.prototype.nextValue=function(){for(var e,t,r,s,o,i;;){do s=this.randn.nextValue(),i=1+this.c*s;while(i<=0);if(i*=i*i,t=1-.331*(e=s*s)*e,r=.5*e+this.d*(1-i+Math.log(i)),(o=this.randu())<t||Math.log(o)<r)break}return i=1/this.beta*this.d*i,this.alpha<1&&(i*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(i)},n.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},n})(),Wee=(function(){function n(e,t,r,s){var o=this;if(e===void 0&&(e=0),t===void 0&&(t=1),this.canReturnFloat=function(){return o.dtype==null||o.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=r,s==null&&(s=Math.random()),typeof s=="number"&&(s=s.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=_y(s)}return n.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},n.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},n})();function wn(n,e,t){return e===void 0&&(e="float32"),e=e||"float32",G$(n),new Tg(n,e,t)}function Uee(n,e){e===void 0&&(e=!1),console.log(n.toString(e))}var eF=ie({batchToSpaceND_:function(n,e,t){var r=Y(n,"x","batchToSpaceND"),s=e.reduce((function(o,i){return o*i}));return ee(r.rank>=1+e.length,(function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+e.length})),ee(t.length===e.length,(function(){return"crops.length is "+t.length+" but should be equal to blockShape.length  "+e.length})),ee(r.shape[0]%s==0,(function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+s})),ge.runKernelFunc((function(o){return o.batchToSpaceND(r,e,t)}),{$x:r},(function(o){return{$x:function(){return o.spaceToBatchND(e,t)}}}))}}),Hee=ie({broadcastTo_:function(n,e){var t=Y(n,"broadcastTo","x"),r=t.shape;if(e.some((function(l){return!(l>0)||l%1!=0})))throw new Error("broadcastTo(): Invalid broadcast shape ["+e+"].");if(e.length<t.rank)throw new Error("broadcastTo(): shape.length="+e.length+" < input.rank="+t.rank+".");if(e.length>t.rank){for(var s=t.shape.slice();s.length<e.length;)s.unshift(1);t=t.reshape(s)}for(var o=Array.from(e),i=e.length-1;i>=0;i--)if(t.shape[i]===e[i])o[i]=1;else if(t.shape[i]!==1)throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+e+"].");var a=o.map((function(l,c){return l>1?c:-1})).filter((function(l){return l>=0}));return a.length===0?t.clone():ge.runKernelFunc((function(l){return l.tile(t,o)}),{input:t},(function(l){return{input:function(){return l.sum(a,!0)}}}))}}),Gee=ie({cast_:function(n,e){var t=Y(n,"x","cast");if(!LQ(e))throw new Error("Failed to cast to unknown dtype "+e);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var r={dtype:e};return ge.runKernelFunc((function(s){return s.cast(t,e)}),{x:t},(function(s){return{x:function(){return s.clone()}}}),"Cast",r)}}),qee=ie({clone_:function(n){var e=Y(n,"x","clone",null);return ge.runKernelFunc((function(){return ge.makeTensorFromDataId(e.dataId,e.shape,e.dtype)}),{$x:e},(function(t){return{$x:function(){return t.toFloat()}}}))}}),Kee=ie({cumsum_:function(n,e,t,r){e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1);var s=Y(n,"x","cumsum"),o=mc([e|=0],s.rank),i=s;o!=null&&(i=s.transpose(o));var a=gc(1,s.rank)[0],l=ge.runKernelFunc((function(c){return c.cumsum(i,a,t,r)}),{permutedX:i},(function(c){return{permutedX:function(){return c.cumsum(e,t,!r)}}}));return o!=null&&(l=l.transpose(o)),l}}),Xee=ie({depthToSpace_:function(n,e,t){t===void 0&&(t="NHWC");var r=Y(n,"x","depthToSpace"),s=t==="NHWC"?r.shape[1]:r.shape[2],o=t==="NHWC"?r.shape[2]:r.shape[3],i=t==="NHWC"?r.shape[3]:r.shape[1];return ee(s*e>=0,(function(){return`Negative dimension size caused by overflow when multiplying
      `+s+" and "+e+`  for depthToSpace with input shape
      `+r.shape})),ee(o*e>=0,(function(){return`Negative dimension size caused by overflow when multiplying
      `+o+" and "+e+` for depthToSpace with input shape
          `+r.shape})),ee(i%(e*e)==0,(function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+i+" for depthToSpace with input shape "+r.shape})),ge.runKernelFunc((function(a){return a.depthToSpace(r,e,t)}),{$x:r})}}),ka=ie({expandDims_:function(n,e){e===void 0&&(e=0);var t=Y(n,"x","expandDims",null);ee(e<=t.rank,(function(){return"Axis must be <= rank of the tensor"}));var r=t.shape.slice();return e<0&&(ee(-(t.rank+1)<=e,(function(){return"Axis must be in the interval ["+-(t.rank+1)+", "+t.rank+"]"})),e=t.rank+e+1),r.splice(e,0,1),rl(t,r)}}),tF=ie({eye_:function(n,e,t,r){r===void 0&&(r="float32"),e==null&&(e=n);for(var s=wn([n,e],r),o=n<=e?n:e,i=0;i<o;++i)s.set(1,i,i);var a=s.toTensor().as2D(n,e);if(t==null)return a;if(t.length===1)return ip(ka(a,0),[t[0],1,1]);if(t.length===2)return ip(ka(ka(a,0),0),[t[0],t[1],1,1]);if(t.length===3)return ip(ka(ka(ka(a,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+t.length+"D.")}}),Yee=ie({multinomial_:function(n,e,t,r){r===void 0&&(r=!1);var s=Y(n,"logits","multinomial"),o=s.size,i=s.rank;if(o<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+o+".");if(i>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+i);t=t||Math.random();var a=i===1?s.as2D(1,-1):s,l=ge.runKernelFunc((function(c){return c.multinomial(a,r,e,t)}),{logits2D:a});return i===1?l.as1D():l}}),p5=ie({oneHot_:function(n,e,t,r){if(t===void 0&&(t=1),r===void 0&&(r=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var s=Y(n,"indices","oneHot","int32"),o=s.shape.concat([e]);return s=s.flatten(),ge.runKernelFunc((function(i){return i.oneHot(s,e,t,r)}),{$indices:s},(function(i){return{$indices:function(){return Mr(s.shape,"float32")}}})).reshape(o)}}),Wf=ie({pad_:function(n,e,t){t===void 0&&(t=0);var r=Y(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var s={paddings:e,constantValue:t};return ge.runKernelFunc((function(o){return o.pad(r,e,t)}),{x:r},(function(o){var i=e.map((function(a){return a[0]}));return{x:function(){return o.slice(i,r.shape)}}}),"PadV2",s)}}),Zee=ie({pad1d_:function(n,e,t){return t===void 0&&(t=0),ee(e.length===2,(function(){return"Invalid number of paddings. Must be length of 2."})),Wf(n,[e],t)}}),Jee=ie({pad2d_:function(n,e,t){return t===void 0&&(t=0),ee(e.length===2&&e[0].length===2&&e[1].length===2,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Wf(n,e,t)}}),Qee=ie({pad3d_:function(n,e,t){return t===void 0&&(t=0),ee(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Wf(n,e,t)}}),ete=ie({pad4d_:function(n,e,t){return t===void 0&&(t=0),ee(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Wf(n,e,t)}}),tte=ie({rand_:function(n,e,t){var r=Xt(n),s=null;if(t==null||t==="float32")s=new Float32Array(r);else if(t==="int32")s=new Int32Array(r);else{if(t!=="bool")throw new Error("Unknown data type "+t);s=new Uint8Array(r)}for(var o=0;o<r;o++)s[o]=e();return ge.makeTensor(s,n,t)}}),nte=ie({randomNormal_:function(n,e,t,r,s){if(e===void 0&&(e=0),t===void 0&&(t=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var o=new Qk(e,t,r,!1,s),i=wn(n,r),a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}}),rte=ie({randomGamma_:function(n,e,t,r,s){if(t===void 0&&(t=1),r===void 0&&(r="float32"),t==null&&(t=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error("Unsupported data type "+r);for(var o=new zee(e,t,r,s),i=wn(n,r),a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}}),nF=ie({randomUniform_:function(n,e,t,r,s){e===void 0&&(e=0),t===void 0&&(t=1),r===void 0&&(r="float32");for(var o=wn(n,r),i=new Wee(e,t,null,s),a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}}),rl=ie({reshape_:function(n,e){var t=Y(n,"x","reshape",null);e=OQ(e,t.size),ee(t.size===Xt(e),(function(){return"new shape and old shape must have the same number of elements."}));var r={shape:e};return ge.runKernelFunc((function(s){return s.reshape(t,e)}),{x:t},(function(s){return{x:function(){return s.reshape(t.shape)}}}),"Reshape",r)}}),rF=ie({spaceToBatchND_:function(n,e,t){var r=Y(n,"x","spaceToBatchND");return ee(r.rank>=1+e.length,(function(){return"input rank "+r.rank+" should be > than [blockShape] "+e.length})),ee(t.length===e.length,(function(){return"paddings.shape[0] "+t.length+" must be equal to [blockShape] "+e.length})),ee(r.shape.reduce((function(s,o,i){return i>0&&i<=e.length?s&&(o+t[i-1][0]+t[i-1][1])%e[i-1]==0:s}),!0),(function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+t.toString()+" must be divisible by blockShapes "+e.toString()})),ge.runKernelFunc((function(s){return s.spaceToBatchND(r,e,t)}),{$x:r},(function(s){return{$x:function(){return s.batchToSpaceND(e,t)}}}))}}),sF=ie({squeeze_:function(n,e){var t=Y(n,"x","squeeze");return rl(t,nf(t.shape,e).newShape)}}),Qi=ie({stack_:function(n,e){e===void 0&&(e=0);var t=g2(n,"tensors","stack");if(ee(t.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),t.length===1)return t[0].expandDims(e);var r=t[0].rank,s=t[0].shape,o=t[0].dtype;ee(e<=r,(function(){return"Axis must be <= rank of the tensor"})),t.forEach((function(a){pr(s,a.shape,"All tensors passed to stack must have matching shapes")})),t.forEach((function(a){ee(o===a.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var i=t.map((function(a){return a.expandDims(e)}));return Ls(i,e)}}),ip=ie({tile_:function(n,e){var t=Y(n,"x","tile",null);ee(t.rank===e.length,(function(){return"Error in transpose: rank of input "+t.rank+" must match length of reps "+e+"."}));var r=[t],s={reps:e};return ge.runKernelFunc((function(o,i){var a=o.tile(t,e);return i([t]),a}),{x:t},(function(o,i){var a=i[0];return{x:function(){var l=Yn(a);if(a.rank===1)for(var c=0;c<e[0];++c)l=l.add(o.slice([c*a.shape[0]],[a.shape[0]]));else if(a.rank===2)for(c=0;c<e[0];++c)for(var u=0;u<e[1];++u)l=l.add(o.slice([c*a.shape[0],u*a.shape[1]],[a.shape[0],a.shape[1]]));else if(a.rank===3)for(c=0;c<e[0];++c)for(u=0;u<e[1];++u)for(var d=0;d<e[2];++d)l=l.add(o.slice([c*a.shape[0],u*a.shape[1],d*a.shape[2]],[a.shape[0],a.shape[1],a.shape[2]]));else{if(a.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+a.rank+" tensors yet.");for(c=0;c<e[0];++c)for(u=0;u<e[1];++u)for(d=0;d<e[2];++d)for(var f=0;f<e[3];++f)l=l.add(o.slice([c*a.shape[0],u*a.shape[1],d*a.shape[2],f*a.shape[3]],[a.shape[0],a.shape[1],a.shape[2],a.shape[3]]))}return l}}}),"Tile",s,r)}}),ste=ie({truncatedNormal_:function(n,e,t,r,s){if(e===void 0&&(e=0),t===void 0&&(t=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var o=new Qk(e,t,r,!0,s),i=wn(n,r),a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}}),js=ie({unstack_:function(n,e){e===void 0&&(e=0),e=e||0;var t=Y(n,"x","unstack");ee(e>=-t.shape.length&&e<t.shape.length,(function(){return"Axis = "+e+" is not in [-"+t.shape.length+", "+t.shape.length+")"})),e<0&&(e+=t.shape.length);var r={axis:e};return ge.runKernelFunc((function(s){return s.unstack(t,e)}),{x:t},(function(s){return{x:function(){return Qi(s,e)}}}),"Unpack",r)}}),ote=function(n,e){return Vt(this,void 0,void 0,(function(){var t,r,s,o,i,a,l,c,u,d;return zt(this,(function(f){switch(f.label){case 0:return t=Y(n,"x","setdiff1d"),r=Y(e,"y","setdiff1d"),ee(t.dtype===r.dtype,(function(){return"x and y should have the same dtype, but got x ("+t.dtype+") and y ("+r.dtype+")."})),ee(t.rank===1,(function(){return"x should be 1D tensor, but got x ("+t.shape+")."})),ee(r.rank===1,(function(){return"y should be 1D tensor, but got y ("+r.shape+")."})),[4,t.data()];case 1:return s=f.sent(),[4,r.data()];case 2:for(o=f.sent(),i=new Set(o),a=0,u=0;u<s.length;u++)i.has(s[u])||a++;for(l=new Tg([a],t.dtype),c=new Tg([a],"int32"),u=0,d=0;u<s.length;u++)i.has(s[u])||(l.values[d]=s[u],c.values[d]=u,d++);return[2,[l.toTensor(),c.toTensor()]]}}))}))};function v2(n,e,t,r){r===void 0&&(r=!0);var s=[];if(r)(s=s.concat(e.slice(0))).push(n[0]/t),s=s.concat(n.slice(1));else{s=s.concat(n[0]);for(var o=e.length,i=0;i<o;++i)s=s.concat([n[i+1]/e[i],e[i]]);s=s.concat(n.slice(o+1))}return s}function y2(n,e,t){t===void 0&&(t=!0);var r=[];if(t){r.push(e);for(var s=e+1;s<n;++s)s<=2*e?(r.push(s),r.push(s-(e+1))):r.push(s)}else{var o=[],i=[];for(s=1;s<n;++s)s>=2*e+1||s%2==1?i.push(s):o.push(s);r.push.apply(r,o),r.push(0),r.push.apply(r,i)}return r}function b2(n,e,t,r){r===void 0&&(r=!0);var s=[];r?s.push(n[0]/t):s.push(n[0]*t);for(var o=1;o<n.length;++o)o<=e.length?r?s.push(e[o-1]*n[o]):s.push(n[o]/e[o-1]):s.push(n[o]);return s}function oF(n,e){for(var t=[0],r=0;r<e;++r)t.push(n[r][0]);return t}function iF(n,e,t){for(var r=n.slice(0,1),s=0;s<t;++s)r.push(n[s+1]-e[s][0]-e[s][1]);return r}function aF(n,e){if(n.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+n.rank+".");if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(e.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>n.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+n.rank);if(n.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+n.shape+".");for(var t=e.shape,r=t[t.length-1],s=1,o=0;o<t.length-1;++o)s*=t[o];var i=n.shape,a=t.slice();a.pop();var l=1;for(o=r;o<n.rank;++o)l*=i[o],a.push(i[o]);var c=Zl(n.shape).map((function(u){return u/l})).concat([1]).slice(0,r);return[a,s,l,c]}var lF=30;function VC(n){return n<=lF?n:l5(n,Math.floor(Math.sqrt(n)))}function ite(n,e,t){var r=e.rank>1?e.shape[e.rank-1]:1,s=e.rank>1?e.rank-1:1,o="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+t.shape+", indices.shape: "+e.shape+", shape: "+n+", sliceDim: "+r+", and batchDim: "+s+".";if(t.rank<s)throw new Error(o+" update.rank < "+s+". ");if(n.length<r+(t.rank-s))throw new Error(o+" Output shape length < "+(r+(t.rank-s)));if(t.rank!==s+n.length-r)throw new Error(o+" update.rank != "+(s+n.length-r));for(var i=0;i<s;++i)if(t.shape[i]!==e.shape[i])throw new Error(o+" updates.shape["+i+"] ("+t.shape[i]+") != indices.shape["+i+"] ("+e.shape[i]+").");for(i=0;i<t.rank-s;++i)if(t.shape[i+s]!==n[i+r])throw new Error(o+" updates.shape["+(i+s)+"] ("+t.shape[i+s]+") != shape["+(i+s)+"] ("+n[i+s]+")")}function ate(n,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(n.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+n.rank+".");if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+t);if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(n.size===0)throw new Error("Updates specified for empty output. updates shape: "+n.shape)}ite(t,e,n)}function w2(n,e,t){for(var r=e.shape.length,s=r>1?e.shape[r-1]:1,o=t.length,i=1,a=s;a<o;++a)i*=t[a];var l=s<1?1:s;return{sliceRank:s,numUpdates:Xt(e.shape)/l,sliceSize:i,strides:Zl(t.slice(0,s)).concat([1]),outputSize:Xt(t)}}function lte(n,e,t){ee(n.rank===e.length,(function(){return"Error in slice"+n.rank+"D: Length of begin "+e+" must match the rank of the array ("+n.rank+")."})),ee(n.rank===t.length,(function(){return"Error in slice"+n.rank+"D: Length of size "+t+" must match the rank of the array ("+n.rank+")."}));for(var r=function(o){ee(e[o]+t[o]<=n.shape[o],(function(){return"Error in slice"+n.rank+"D: begin["+o+"] + size["+o+"] ("+(e[o]+t[o])+") would overflow input.shape["+o+"] ("+n.shape[o]+")"}))},s=0;s<n.rank;++s)r(s)}function eT(n){for(var e=[],t=0;n>0;)1&n&&e.push(t),n/=2,t++;return e}function e6(n,e,t){for(var r=[],s=0;s<n.length;s++)r[s]=Math.ceil((e[s]-n[s])/t[s]);return r}function cte(n,e,t,r,s){var o=e[s],i=t[s]||1;(n&1<<s||o==null)&&(o=i>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var a=r[s];return o<0&&(o+=a),o=o5(0,o,a-1)}function ute(n,e,t,r,s){var o=e[s],i=t[s]||1;(n&1<<s||o==null)&&(o=i>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var a=r[s];return o<0&&(o+=a),o=i>0?o5(0,o,a):o5(-1,o,a-1)}function cF(n,e,t){for(var r=t.length,s=0;s<t.length;s++)if(t[s]>1){r=s;break}for(s=r+1;s<t.length;s++)if(e[s]>0||t[s]!==n[s])return!1;return!0}function uF(n,e){for(var t=n.length>0?n[n.length-1]:1,r=0;r<n.length-1;r++)t+=n[r]*e[r];return t}function dte(n,e){ee(a5(n),(function(){return"The f passed in variableGrads(f) must be a function"})),ee(e==null||Array.isArray(e)&&e.every((function(u){return u instanceof Ep})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var t=e!=null;if(!t)for(var r in e=[],ge.registeredVariables)e.push(ge.registeredVariables[r]);var s=t?e.filter((function(u){return!u.trainable})):null,o=e.length;ee((e=e.filter((function(u){return u.trainable}))).length>0,(function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+o+" variables is trainable."}));var i=ge.gradients(n,e,null,!0),a=i.value,l=i.grads;ee(l.some((function(u){return u!=null})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),ee(a.rank===0,(function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+a.rank+" tensor"}));var c={};return e.forEach((function(u,d){l[d]!=null&&(c[u.name]=l[d])})),s?.forEach((function(u){return c[u.name]=null})),{value:a,grads:c}}function Ry(n){return ge.customGrad(n)}var Kc=ie({softmax_:function(n,e){e===void 0&&(e=-1);var t=Y(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and dim was "+e);return ge.runKernelFunc((function(r,s){var o=r.softmax(t,e);return s([o]),o}),{logits:t},(function(r,s){var o=s[0],i=r.mul(o);return{logits:function(){return i.sub(i.sum([e],!0).mul(o))}}}),"Softmax",{dim:e},[],[!0])}}),fte=ie({logSoftmax_:function(n,e){e===void 0&&(e=-1);var t=Y(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and axis was "+e);return Ry((function(r,s){var o=r.max(e,!0),i=r.sub(o),a=i.toFloat().sub(i.exp().sum(e,!0).log());return s([a]),{value:a,gradFunc:function(l,c){var u=c[0].exp();return l.sub(l.sum(e,!0).mul(u))}}}))(t)}}),dF=(function(){function n(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return n.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},n.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},n.prototype.has=function(e){return this.data.has(e)},n.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},n.prototype.numDataIds=function(){return this.dataIdsCount},n})(),fF=(function(){function n(){}return n.prototype.time=function(e){return $e("time")},n.prototype.read=function(e){return $e("read")},n.prototype.readSync=function(e){return $e("readSync")},n.prototype.numDataIds=function(){return $e("numDataIds")},n.prototype.disposeData=function(e){return $e("disposeData")},n.prototype.write=function(e,t,r){return $e("write")},n.prototype.move=function(e,t,r,s){return $e("move")},n.prototype.memory=function(){return $e("memory")},n.prototype.floatPrecision=function(){return $e("floatPrecision")},n.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},n.prototype.batchMatMul=function(e,t,r,s){return $e("batchMatMul")},n.prototype.fusedBatchMatMul=function(e){return e.a,e.b,e.transposeA,e.transposeB,e.bias,e.activation,e.preluActivationWeights,$e("fusedBatchMatMul")},n.prototype.slice=function(e,t,r){return $e("slice")},n.prototype.stridedSlice=function(e,t,r,s){return $e("stridedSlice")},n.prototype.unstack=function(e,t){return $e("unstack")},n.prototype.reverse=function(e,t){return $e("reverse")},n.prototype.concat=function(e,t){return $e("concat")},n.prototype.neg=function(e){return $e("neg")},n.prototype.add=function(e,t){return $e("add")},n.prototype.addN=function(e){return $e("addN")},n.prototype.subtract=function(e,t){return $e("subtract")},n.prototype.multiply=function(e,t){return $e("multiply")},n.prototype.realDivide=function(e,t){return $e("realDivide")},n.prototype.floorDiv=function(e,t){return $e("floorDiv")},n.prototype.sum=function(e,t){return $e("sum")},n.prototype.prod=function(e,t){return $e("prod")},n.prototype.unsortedSegmentSum=function(e,t,r){return $e("unsortedSegmentSum")},n.prototype.argMin=function(e,t){return $e("argMin")},n.prototype.argMax=function(e,t){return $e("argMax")},n.prototype.equal=function(e,t){return $e("equal")},n.prototype.notEqual=function(e,t){return $e("notEqual")},n.prototype.less=function(e,t){return $e("less")},n.prototype.lessEqual=function(e,t){return $e("lessEqual")},n.prototype.greater=function(e,t){return $e("greater")},n.prototype.greaterEqual=function(e,t){return $e("greaterEqual")},n.prototype.logicalNot=function(e){return $e("logicalNot")},n.prototype.logicalAnd=function(e,t){return $e("logicalAnd")},n.prototype.logicalOr=function(e,t){return $e("logicalOr")},n.prototype.where=function(e){return $e("where")},n.prototype.select=function(e,t,r){return $e("select")},n.prototype.topk=function(e,t,r){return $e("topk")},n.prototype.min=function(e,t){return $e("min")},n.prototype.minimum=function(e,t){return $e("minimum")},n.prototype.mod=function(e,t){return $e("mod")},n.prototype.max=function(e,t){return $e("max")},n.prototype.maximum=function(e,t){return $e("maximum")},n.prototype.all=function(e,t){return $e("all")},n.prototype.any=function(e,t){return $e("any")},n.prototype.squaredDifference=function(e,t){return $e("squaredDifference")},n.prototype.ceil=function(e){return $e("ceil")},n.prototype.floor=function(e){return $e("floor")},n.prototype.round=function(e){return $e("round")},n.prototype.sign=function(e){return $e("sign")},n.prototype.isNaN=function(e){return $e("isNaN")},n.prototype.isInf=function(e){return $e("isInf")},n.prototype.isFinite=function(e){return $e("isFinite")},n.prototype.pow=function(e,t){return $e("pow")},n.prototype.exp=function(e){return $e("exp")},n.prototype.expm1=function(e){return $e("expm1")},n.prototype.softmax=function(e,t){return $e("softmax")},n.prototype.log=function(e){return $e("log")},n.prototype.log1p=function(e){return $e("log1p")},n.prototype.sqrt=function(e){return $e("sqrt")},n.prototype.rsqrt=function(e){return $e("rsqrt")},n.prototype.square=function(e){return $e("square")},n.prototype.reciprocal=function(e){return $e("reciprocal")},n.prototype.relu=function(e){return $e("relu")},n.prototype.relu6=function(e){return $e("relu6")},n.prototype.prelu=function(e,t){return $e("prelu")},n.prototype.elu=function(e){return $e("elu")},n.prototype.eluDer=function(e,t){return $e("eluDer")},n.prototype.selu=function(e){return $e("selu")},n.prototype.int=function(e){return $e("int")},n.prototype.clip=function(e,t,r){return $e("clip")},n.prototype.abs=function(e){return $e("abs")},n.prototype.complexAbs=function(e){return $e("complexAbs")},n.prototype.sigmoid=function(e){return $e("sigmoid")},n.prototype.softplus=function(e){return $e("softplus")},n.prototype.sin=function(e){return $e("sin")},n.prototype.cos=function(e){return $e("cos")},n.prototype.tan=function(e){return $e("tan")},n.prototype.asin=function(e){return $e("asin")},n.prototype.acos=function(e){return $e("acos")},n.prototype.atan=function(e){return $e("atan")},n.prototype.atan2=function(e,t){return $e("atan2")},n.prototype.sinh=function(e){return $e("sinh")},n.prototype.cosh=function(e){return $e("cosh")},n.prototype.tanh=function(e){return $e("tanh")},n.prototype.asinh=function(e){return $e("asinh")},n.prototype.acosh=function(e){return $e("acosh")},n.prototype.atanh=function(e){return $e("atanh")},n.prototype.erf=function(e){return $e("erf")},n.prototype.step=function(e,t){return $e("step")},n.prototype.fusedConv2d=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,$e("fusedConv2d")},n.prototype.conv2d=function(e,t,r){return $e("conv2d")},n.prototype.conv2dDerInput=function(e,t,r){return $e("conv2dDerInput")},n.prototype.conv2dDerFilter=function(e,t,r){return $e("conv2dDerFilter")},n.prototype.fusedDepthwiseConv2D=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,$e("fusedDepthwiseConv2D")},n.prototype.depthwiseConv2D=function(e,t,r){return $e("depthwiseConv2D")},n.prototype.depthwiseConv2DDerInput=function(e,t,r){return $e("depthwiseConv2DDerInput")},n.prototype.depthwiseConv2DDerFilter=function(e,t,r){return $e("depthwiseConv2DDerFilter")},n.prototype.conv3d=function(e,t,r){return $e("conv3d")},n.prototype.conv3dDerInput=function(e,t,r){return $e("conv3dDerInput")},n.prototype.conv3dDerFilter=function(e,t,r){return $e("conv3dDerFilter")},n.prototype.maxPool=function(e,t){return $e("maxPool")},n.prototype.maxPoolBackprop=function(e,t,r,s){return $e("maxPoolBackprop")},n.prototype.avgPool=function(e,t){return $e("avgPool")},n.prototype.avgPoolBackprop=function(e,t,r){return $e("avgPoolBackprop")},n.prototype.avgPool3d=function(e,t){return $e("avgPool3d")},n.prototype.avgPool3dBackprop=function(e,t,r){return $e("avgPool3dBackprop")},n.prototype.maxPool3d=function(e,t){return $e("maxPool3d")},n.prototype.maxPool3dBackprop=function(e,t,r,s){return $e("maxPool3dBackprop")},n.prototype.reshape=function(e,t){return $e("reshape")},n.prototype.cast=function(e,t){return $e("cast")},n.prototype.tile=function(e,t){return $e("tile")},n.prototype.pad=function(e,t,r){return $e("pad")},n.prototype.transpose=function(e,t){return $e("transpose")},n.prototype.gather=function(e,t,r){return $e("gather")},n.prototype.gatherND=function(e,t){return $e("gatherND")},n.prototype.scatterND=function(e,t,r){return $e("scatterND")},n.prototype.batchToSpaceND=function(e,t,r){return $e("batchToSpaceND")},n.prototype.spaceToBatchND=function(e,t,r){return $e("spaceToBatchND")},n.prototype.resizeBilinear=function(e,t,r,s){return $e("resizeBilinear")},n.prototype.resizeBilinearBackprop=function(e,t,r){return $e("resizeBilinearBackprop")},n.prototype.resizeNearestNeighbor=function(e,t,r,s){return $e("resizeNearestNeighbor")},n.prototype.resizeNearestNeighborBackprop=function(e,t,r){return $e("resizeNearestNeighborBackprop")},n.prototype.batchNormalization=function(e,t,r,s,o,i){return $e("batchNormalization")},n.prototype.localResponseNormalization4D=function(e,t,r,s,o){return $e("localResponseNormalization4D")},n.prototype.LRNGrad=function(e,t,r,s,o,i,a){return $e("LRNGrad")},n.prototype.multinomial=function(e,t,r,s){return $e("multinomial")},n.prototype.oneHot=function(e,t,r,s){return $e("oneHot")},n.prototype.cumsum=function(e,t,r,s){return $e("cumsum")},n.prototype.nonMaxSuppression=function(e,t,r,s,o){return $e("nonMaxSuppression")},n.prototype.fft=function(e){return $e("fft")},n.prototype.ifft=function(e){return $e("ifft")},n.prototype.complex=function(e,t){return $e("complex")},n.prototype.real=function(e){return $e("real")},n.prototype.imag=function(e){return $e("imag")},n.prototype.cropAndResize=function(e,t,r,s,o,i){return $e("cropAndResize")},n.prototype.depthToSpace=function(e,t,r){return $e("depthToSpace")},n.prototype.split=function(e,t,r){return $e("split")},n.prototype.sparseToDense=function(e,t,r,s){return $e("sparseToDense")},n.prototype.diag=function(e){return $e("diag")},n.prototype.fill=function(e,t,r){return $e("fill")},n.prototype.onesLike=function(e){return $e("onesLike")},n.prototype.zerosLike=function(e){return $e("zerosLike")},n.prototype.linspace=function(e,t,r){return $e("linspace")},n.prototype.dispose=function(){return $e("dispose")},n})();function $e(n){throw new Error("'"+n+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Wu(n,e){for(var t=n.length,r=[],s=0;s<t;s++){var o=t-1-s,i=n[o]||1;(e[e.length-1-s]||1)>1&&i===1&&r.unshift(o)}return r}function Bs(n,e){for(var t=[],r=0;r<e.length;r++){var s=n[n.length-r-1],o=e.length-r-1,i=e[o];(s==null||s===1&&i>1)&&t.unshift(o)}return t}function zn(n,e){for(var t=[],r=Math.max(n.length,e.length),s=0;s<r;s++){var o=n[n.length-s-1];o==null&&(o=1);var i=e[e.length-s-1];if(i==null&&(i=1),o===1)t.unshift(i);else if(i===1)t.unshift(o);else{if(o!==i)throw Error("Operands could not be broadcast together with shapes "+n+" and "+e+".");t.unshift(o)}}return t}function Rg(n,e,t,r,s,o,i){i===void 0&&(i="channelsLast");var a,l=S2(e),c=l[0],u=l[1];if(i==="channelsLast")a=[c,u,n[3],n[3]];else{if(i!=="channelsFirst")throw new Error("Unknown dataFormat "+i);a=[c,u,n[1],n[1]]}return Uf(n,a,t,r,s,o,!1,i)}function C2(n,e,t,r,s,o,i){i===void 0&&(i="NDHWC");var a,l,c=m5(e),u=c[0],d=c[1],f=c[2];if(i==="NDHWC")l="channelsLast",a=[u,d,f,n[4],n[4]];else{if(i!=="NCDHW")throw new Error("Unknown dataFormat "+i);l="channelsFirst",a=[u,d,f,n[1],n[1]]}return k2(n,a,t,r,s,!1,l,o)}function Uf(n,e,t,r,s,o,i,a){i===void 0&&(i=!1),a===void 0&&(a="channelsLast");var l=[-1,-1,-1,-1],c=l[0],u=l[1],d=l[2],f=l[3];if(a==="channelsLast")c=n[0],u=n[1],d=n[2],f=n[3];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);c=n[0],f=n[1],u=n[2],d=n[3]}var p,x=e[0],v=e[1],y=e[3],b=S2(t),w=b[0],S=b[1],k=S2(r),N=k[0],I=k[1],T=ap(x,N),F=ap(v,I),R=(function(L,W,H,G,M,j,z,V){var K,J,oe;if(typeof L=="number"){K={top:L,bottom:L,left:L,right:L,type:L===0?"VALID":"NUMBER"};var Z=(function(et,gt,dt,Ct,lt){Ct==null&&(Ct=hF(et,gt,dt));var bt=et[0],rn=et[1],Ft=fg((bt-gt+2*Ct)/dt+1,lt);ee(hs(Ft),(function(){return"The output # of rows ("+Ft+") must be an integer. Change the stride and/or zero pad parameters"}));var vn=fg((rn-gt+2*Ct)/dt+1,lt);return ee(hs(vn),(function(){return"The output # of columns ("+vn+") must be an integer. Change the stride and/or zero pad parameters"})),[Ft,vn]})([W,H],j,G,L,V);J=Z[0],oe=Z[1]}else if(L==="same"){J=Math.ceil(W/G),oe=Math.ceil(H/M);var de=Math.max(0,(J-1)*G+j-W),pe=Math.max(0,(oe-1)*M+z-H),Ce=Math.floor(de/2),Ae=de-Ce,ze=Math.floor(pe/2);K={top:Ce,bottom:Ae,left:ze,right:pe-ze,type:"SAME"}}else{if(L!=="valid")throw Error("Unknown padding parameter: "+L);K={top:0,bottom:0,left:0,right:0,type:"VALID"},J=Math.ceil((W-j+1)/G),oe=Math.ceil((H-z+1)/M)}return{padInfo:K,outHeight:J,outWidth:oe}})(s,u,d,w,S,T,F,o),D=R.padInfo,A=R.outHeight,P=R.outWidth,B=i?y*f:y;return a==="channelsFirst"?p=[c,B,A,P]:a==="channelsLast"&&(p=[c,A,P,B]),{batchSize:c,dataFormat:a,inHeight:u,inWidth:d,inChannels:f,outHeight:A,outWidth:P,outChannels:B,padInfo:D,strideHeight:w,strideWidth:S,filterHeight:x,filterWidth:v,effectiveFilterHeight:T,effectiveFilterWidth:F,dilationHeight:N,dilationWidth:I,inShape:n,outShape:p,filterShape:e}}function k2(n,e,t,r,s,o,i,a){o===void 0&&(o=!1),i===void 0&&(i="channelsLast");var l=[-1,-1,-1,-1,-1],c=l[0],u=l[1],d=l[2],f=l[3],p=l[4];if(i==="channelsLast")c=n[0],u=n[1],d=n[2],f=n[3],p=n[4];else{if(i!=="channelsFirst")throw new Error("Unknown dataFormat "+i);c=n[0],p=n[1],u=n[2],d=n[3],f=n[4]}var x,v=e[0],y=e[1],b=e[2],w=e[4],S=m5(t),k=S[0],N=S[1],I=S[2],T=m5(r),F=T[0],R=T[1],D=T[2],A=ap(v,F),P=ap(y,R),B=ap(b,D),L=(function(z,V,K,J,oe,Z,de,pe,Ce,Ae,ze){var et,gt,dt,Ct;if(typeof z=="number"){et={top:z,bottom:z,left:z,right:z,front:z,back:z,type:z===0?"VALID":"NUMBER"};var lt=(function(Ke,Be,ct,Nt,Rt,sn){Rt==null&&(Rt=hF(Ke,Be,Nt));var Kn=Ke[0],Ee=Ke[1],Ge=Ke[2],Q=fg((Kn-Be+2*Rt)/Nt+1,sn);ee(hs(Q),(function(){return"The output # of depths ("+Q+") must be an integer. Change the stride and/or zero pad parameters"}));var ht=fg((Ee-Be+2*Rt)/Nt+1,sn);ee(hs(ht),(function(){return"The output # of rows ("+ht+") must be an integer. Change the stride and/or zero pad parameters"}));var it=fg((Ge-Be+2*Rt)/Nt+1,sn);return ee(hs(it),(function(){return"The output # of columns ("+it+") must be an integer. Change the stride and/or zero pad parameters"})),[Q,ht,it,ct]})([V,K,J,1],pe,1,oe,z,ze);gt=lt[0],dt=lt[1],Ct=lt[2]}else if(z==="same"){gt=Math.ceil(V/oe),dt=Math.ceil(K/Z),Ct=Math.ceil(J/de);var bt=(gt-1)*oe+pe-V,rn=(dt-1)*Z+Ce-K,Ft=(Ct-1)*de+Ae-J,vn=Math.floor(bt/2),te=bt-vn,q=Math.floor(rn/2),ke=rn-q,He=Math.floor(Ft/2);et={top:q,bottom:ke,left:He,right:Ft-He,front:vn,back:te,type:"SAME"}}else{if(z!=="valid")throw Error("Unknown padding parameter: "+z);et={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},gt=Math.ceil((V-pe+1)/oe),dt=Math.ceil((K-Ce+1)/Z),Ct=Math.ceil((J-Ae+1)/de)}return{padInfo:et,outDepth:gt,outHeight:dt,outWidth:Ct}})(s,u,d,f,k,N,I,A,P,B,a),W=L.padInfo,H=L.outDepth,G=L.outHeight,M=L.outWidth,j=o?w*p:w;return i==="channelsFirst"?x=[c,j,H,G,M]:i==="channelsLast"&&(x=[c,H,G,M,j]),{batchSize:c,dataFormat:i,inDepth:u,inHeight:d,inWidth:f,inChannels:p,outDepth:H,outHeight:G,outWidth:M,outChannels:j,padInfo:W,strideDepth:k,strideHeight:N,strideWidth:I,filterDepth:v,filterHeight:y,filterWidth:b,effectiveFilterDepth:A,effectiveFilterHeight:P,effectiveFilterWidth:B,dilationDepth:F,dilationHeight:R,dilationWidth:D,inShape:n,outShape:x,filterShape:e}}function hF(n,e,t,r){r===void 0&&(r=1);var s=ap(e,r);return Math.floor((n[0]*(t-1)-t+s)/2)}function S2(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function m5(n){return typeof n=="number"?[n,n,n]:n}function ap(n,e){return e<=1?n:n+(n-1)*(e-1)}function fg(n,e){if(!e)return n;switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error("Unknown roundingMode "+e)}}function Tp(n){var e=S2(n),t=e[0],r=e[1],s=e[2];return t===1&&r===1&&s===1}function Ni(n,e){return Tp(n)||Tp(e)}function t6(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+n)}function pF(n,e,t){if(e==="complex64"){if(n.dtype==="complex64")return n.clone();var r=Mr(n.shape),s=n.toFloat(),o=t.complex(s,r);return r.dispose(),s.dispose(),o}if(!jQ(n.dtype,e))return ge.makeTensorFromDataId(n.dataId,n.shape,e);if(n.dtype==="complex64"){var i=t.real(n);return o=i.cast(e),i.dispose(),o}if(e==="int32")return t.int(n);if(e==="bool"){var a=St(0,n.dtype);return o=t.notEqual(n,a),a.dispose(),o}throw new Error("Error in Cast: failed to cast "+n.dtype+" to "+e)}function g5(n,e){return ge.makeTensorFromDataId(n.dataId,e,n.dtype)}function mF(n,e,t){var r=(e-n)/(t-1),s=e1(t,"float32");s[0]=n;for(var o=1;o<s.length;o++)s[o]=s[o-1]+r;return bs(s,"float32")}function x5(n,e){if(n.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+n.length+", imag: "+e.length+".");for(var t=new Float32Array(2*n.length),r=0;r<t.length;r+=2)t[r]=n[r/2],t[r+1]=e[r/2];return t}function tT(n,e){return{real:n[2*e],imag:n[2*e+1]}}function hte(n,e,t,r){n[2*r]=e,n[2*r+1]=t}function pte(n,e,t){var r=(t?2:-2)*Math.PI*(n/e);return{real:Math.cos(r),imag:Math.sin(r)}}function mte(n,e,t){var r=(function(o,i,a){return(function(l,c,u){for(var d=0,f=l.length,p=0,x=!1;d<f;){var v=u(c,l[p=d+(f-d>>>1)]);v>0?d=p+1:(f=p,x=!v)}return x?d:-d-1})(o,i,a||gte)})(n,e,t),s=r<0?-(r+1):r;n.splice(s,0,e)}function gte(n,e){return n>e?1:n<e?-1:0}function n6(n,e,t,r,s){return gF(n,e,t,r,s,0).selectedIndices}function r6(n,e,t,r,s,o){var i=gF(n,e,t,r,s,o);return i.numValidOutputs.dispose(),{selectedIndices:i.selectedIndices,selectedScores:i.selectedScores}}function gF(n,e,t,r,s,o,i,a){a===void 0&&(a=!1);for(var l=Array.from(e).map((function(k,N){return{score:k,boxIndex:N,suppressBeginIndex:0}})).filter((function(k){return k.score>s})).sort(nT),c=o>0?-.5/o:0,u=[],d=[];u.length<t&&l.length>0;){var f=l.pop(),p=f.score,x=f.boxIndex,v=f.suppressBeginIndex;if(p<s)break;for(var y=!1,b=u.length-1;b>=v;--b){var w=xte(n,x,u[b]);if(w>=r){y=!0;break}if(f.score=f.score*vte(r,c,w),f.score<=s)break}f.suppressBeginIndex=u.length,y||(f.score===p?(u.push(x),d.push(f.score)):f.score>s&&mte(l,f,nT))}var S=u.length;return a&&(u.fill(0,S),d.fill(0,S)),{selectedIndices:bs(u,"int32"),selectedScores:bs(d,"float32"),numValidOutputs:St(S,"int32")}}function xte(n,e,t){var r=n.subarray(4*e,4*e+4),s=n.subarray(4*t,4*t+4),o=Math.min(r[0],r[2]),i=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),l=Math.max(r[1],r[3]),c=Math.min(s[0],s[2]),u=Math.min(s[1],s[3]),d=Math.max(s[0],s[2]),f=Math.max(s[1],s[3]),p=(a-o)*(l-i),x=(d-c)*(f-u);if(p<=0||x<=0)return 0;var v=Math.max(o,c),y=Math.max(i,u),b=Math.min(a,d),w=Math.min(l,f),S=Math.max(b-v,0)*Math.max(w-y,0);return S/(p+x-S)}function vte(n,e,t){var r=Math.exp(e*t*t);return t<=n?r:0}function nT(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}function xF(n,e,t){var r=new Array(n.rank).fill(0),s=n.shape.slice();return e.map((function(o){s[t]=o;var i=n.slice(r,s);return r[t]+=o,i}))}function vF(n,e){for(var t=new Array(n.rank),r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];var s=wn(t,n.dtype);for(r=0;r<s.values.length;++r){for(var o=s.indexToLoc(r),i=new Array(n.rank),a=0;a<i.length;a++)i[a]=o[a]%n.shape[a];var l=n.locToIndex(i);s.values[r]=n.values[l]}return s.toTensor()}function yF(n,e,t,r,s){for(var o=e[e.length-1],i=[n.length/o,o],a=i[0],l=i[1],c=Ig(t,a*r),u=Ig("int32",a*r),d=0;d<a;d++){for(var f=d*l,p=n.subarray(f,f+l),x=[],v=0;v<p.length;v++)x.push({value:p[v],index:v});x.sort((function(k,N){return N.value-k.value}));var y=d*r,b=c.subarray(y,y+r),w=u.subarray(y,y+r);for(v=0;v<r;v++)b[v]=x[v].value,w[v]=x[v].index}var S=e.slice();return S[S.length-1]=r,[ho(c,S,t),ho(u,S,"int32")]}function s6(n,e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(r);var s=wn(n,"int32"),o=wn([t.length,n.length],"int32");for(r=0;r<t.length;r++){var i=s.indexToLoc(t[r]),a=r*n.length;o.values.set(i,a)}return o.toTensor()}var yte=function(n,e){this.outputShape=[],this.outputShape=n,this.variableNames=e.map((function(s,o){return"T"+o}));var t=[];this.variableNames.forEach((function(s){t.push("float v"+s+" = get"+s+"AtOutCoords();")}));var r=this.variableNames.map((function(s){return"v"+s})).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        float result = `+r+`;
        setOutput(result);
      }
    `},bte=function(n,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.variableNames=e.map((function(s,o){return"T"+o}));var t=[];this.variableNames.forEach((function(s){t.push("vec4 v"+s+" = get"+s+"AtOutCoords();")}));var r=this.variableNames.map((function(s){return"v"+s})).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        vec4 result = `+r+`;
        setOutput(result);
      }
    `},wte=function(n,e,t){this.variableNames=["A"];var r=n.windowSize,s=n.batchSize,o=n.inSize,i=Math.ceil(o/r);t||this.variableNames.push("bestIndicesA"),this.outputShape=[s,i];var a=e==="max"?">":"<",l=t?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+r+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+r+`; i++) {
          int inIdx = `+l+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+a+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `};function bF(n,e){return["x","y","z","w","u","v"].slice(0,e).map((function(t){return n+"."+t}))}function bi(n,e){return e===1?[n]:bF(n,e)}function Oo(){var n,e,t,r,s,o,i,a,l,c;return je().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",r="in",s="texture",o="outputColor",i="out vec4 outputColor;",a=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,l="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",r="varying",s="texture2D",o="gl_FragColor",i="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:r,texture2D:s,output:o,defineOutput:i,defineSpecialNaN:a,defineSpecialInf:l,defineRound:c}}function lf(n,e,t){t===void 0&&(t="index");var r=Zl(e);return r.map((function(s,o){return"int "+n[o]+" = "+t+" / "+s+"; "+(o===r.length-1?"int "+n[o+1]+" = "+t+" - "+n[o]+" * "+s:"index -= "+n[o]+" * "+s)+";"})).join("")}function o6(n){var e=Zl(n).map((function(t){return t.toString()}));return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+e[0]+" + coords.y * "+e[1]+` + coords.z;
  }
`}var wF=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function Cte(n,e,t,r){var s=[];n.forEach((function(p){var x=Xt(p.shapeInfo.logicalShape);p.shapeInfo.isUniform?s.push("uniform float "+p.name+(x>1?"["+x+"]":"")+";"):(s.push("uniform sampler2D "+p.name+";"),s.push("uniform int offset"+p.name+";"))}));var o,i,a=s.join(`
`),l=n.map((function(p){return(function(x,v,y){y===void 0&&(y=!1);var b="";b+=y?CF(x):Xh(x);var w=x.shapeInfo.logicalShape,S=v.logicalShape;return w.length<=S.length&&(b+=y?(function(k,N){var I,T=k.name,F=T.charAt(0).toUpperCase()+T.slice(1),R="get"+F+"AtOutCoords",D=k.shapeInfo.logicalShape.length,A=N.logicalShape.length,P=Wu(k.shapeInfo.logicalShape,N.logicalShape),B=$r(A),L=A-D,W=["x","y","z","w","u","v"];I=D===0?"":A<2&&P.length>=1?"coords = 0;":P.map((function(K){return"coords."+W[K+L]+" = 0;"})).join(`
`);var H="";H=A<2&&D>0?"coords":k.shapeInfo.logicalShape.map((function(K,J){return"coords."+W[J+L]})).join(", ");var G="return outputValue;",M=Xt(k.shapeInfo.logicalShape)===1,j=Xt(N.logicalShape)===1;if(D!==1||M||j){if(M&&!j)G=A===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(P.length){var z=D-2,V=D-1;P.indexOf(z)>-1&&P.indexOf(V)>-1?G="return vec4(outputValue.x);":P.indexOf(z)>-1?G="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":P.indexOf(V)>-1&&(G="return vec4(outputValue.xx, outputValue.zz);")}}else G=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+R+`() {
      `+B+` coords = getOutputCoords();
      `+I+`
      vec4 outputValue = get`+F+"("+H+`);
      `+G+`
    }
  `})(x,v):(function(k,N){var I=k.name,T=I.charAt(0).toUpperCase()+I.slice(1),F="get"+T+"AtOutCoords",R=N.texShape,D=k.shapeInfo.texShape,A=k.shapeInfo.logicalShape.length,P=N.logicalShape.length;if(!k.shapeInfo.isUniform&&A===P&&k.shapeInfo.flatOffset==null&&eo(D,R))return`
      float `+F+`() {
        return sampleTexture(`+I+`, resultUV);
      }
    `;var B,L=$r(P),W=Wu(k.shapeInfo.logicalShape,N.logicalShape),H=P-A,G=["x","y","z","w","u","v"];B=A===0?"":P<2&&W.length>=1?"coords = 0;":W.map((function(j){return"coords."+G[j+H]+" = 0;"})).join(`
`);var M="";return M=P<2&&A>0?"coords":k.shapeInfo.logicalShape.map((function(j,z){return"coords."+G[z+H]})).join(", "),`
    float `+F+`() {
      `+L+` coords = getOutputCoords();
      `+B+`
      return get`+T+"("+M+`);
    }
  `})(x,v)),b})(p,e,r)})).join(`
`),c=e.texShape,u=Oo(),d=(function(p){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+p.texture2D+`(textureSampler, uv).r;
    }
  `})(u),f=(function(p){return p.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+p.varyingFs+` vec2 resultUV;
    `+p.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+p.defineSpecialNaN+`
    `+p.defineSpecialInf+`
    `+p.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+kte+`
    `+Ste+`
    `+Nte+`
  `})(u);return e.isPacked?(o=(function(p,x){switch(p.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return(function(k,N){var I=[Math.ceil(N[0]/2),Math.ceil(N[1]/2)];return I[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+I[1]+`.0);
      }
    `:I[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+I[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+I[0]+", "+I[1]+`));
      return 2 * (resTexRC.x * `+I[1]+` + resTexRC.y);
    }
  `})(0,x);case 2:return(function(k,N){var I=[Math.ceil(N[0]/2),Math.ceil(N[1]/2)];if(eo(k,N))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+I[0]+", "+I[1]+`));
      }
    `;var T=Math.ceil(k[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+I[0]+", "+I[1]+`));

      int index = resTexRC.x * `+I[1]+` + resTexRC.y;
      int r = 2 * (index / `+T+`);
      int c = imod(index, `+T+`) * 2;

      return ivec2(r, c);
    }
  `})(p,x);case 3:return v=p,y=x,b=[Math.ceil(y[0]/2),Math.ceil(y[1]/2)],w=Math.ceil(v[2]/2),S=w*Math.ceil(v[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+b[0]+", "+b[1]+`));
      int index = resTexRC.x * `+b[1]+` + resTexRC.y;

      int b = index / `+S+`;
      index -= b * `+S+`;

      int r = 2 * (index / `+w+`);
      int c = imod(index, `+w+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return(function(k,N){for(var I=[Math.ceil(N[0]/2),Math.ceil(N[1]/2)],T=Math.ceil(k[k.length-1]/2),F=T*Math.ceil(k[k.length-2]/2),R=F,D="",A="b, r, c",P=2;P<k.length-1;P++)R*=k[k.length-P-1],D=`
      int b`+P+" = index / "+R+`;
      index -= b`+P+" * "+R+`;
    `+D,A="b"+P+", "+A;return`
    ivec`+k.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+I[0]+", "+I[1]+`));
      int index = resTexRC.x * `+I[1]+` + resTexRC.y;

      `+D+`

      int b = index / `+F+`;
      index -= b * `+F+`;

      int r = 2 * (index / `+T+`);
      int c = imod(index, `+T+`) * 2;

      return ivec`+k.length+"("+A+`);
    }
  `})(p,x)}var v,y,b,w,S})(e.logicalShape,c),i=(function(p){return`
    void setOutput(vec4 val) {
      `+p.output+` = val;
    }
  `})(u)):(o=(function(p,x){switch(p.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return(function(b,w){return w[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+w[1]+`.0);
      }
    `:w[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+w[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+w[0]+", "+w[1]+`));
      return resTexRC.x * `+w[1]+` + resTexRC.y;
    }
  `})(0,x);case 2:return(function(b,w){return eo(b,w)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+w[0]+", "+w[1]+`));
      }
    `:b[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+w[0]+", "+w[1]+`));
        int index = resTexRC.x * `+w[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:b[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+w[0]+", "+w[1]+`));
        int index = resTexRC.x * `+w[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+w[0]+", "+w[1]+`));
      int index = resTexRC.x * `+w[1]+` + resTexRC.y;
      int r = index / `+b[1]+`;
      int c = index - r * `+b[1]+`;
      return ivec2(r, c);
    }
  `})(p,x);case 3:return v=x,y=lf(["r","c","d"],p),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+v[0]+", "+v[1]+`));
      int index = resTexRC.x * `+v[1]+` + resTexRC.y;
      `+y+`
      return ivec3(r, c, d);
    }
  `;case 4:return(function(b,w){var S=lf(["r","c","d","d2"],b);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+w[0]+", "+w[1]+`));
      int index = resTexRC.x * `+w[1]+` + resTexRC.y;
      `+S+`
      return ivec4(r, c, d, d2);
    }
  `})(p,x);case 5:return(function(b,w){var S=lf(["r","c","d","d2","d3"],b);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+w[0]+`,
                             `+w[1]+`));

      int index = resTexRC.x * `+w[1]+` + resTexRC.y;

      `+S+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `})(p,x);case 6:return(function(b,w){var S=lf(["r","c","d","d2","d3","d4"],b);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+w[0]+", "+w[1]+`));
      int index = resTexRC.x * `+w[1]+` + resTexRC.y;

      `+S+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `})(p,x);default:throw new Error(p.length+"-D output sampling is not yet supported")}var v,y})(e.logicalShape,c),i=(function(p){return`
    void setOutput(float val) {
      `+p.output+` = vec4(val, 0, 0, 0);
    }
  `})(u)),r&&(f+=Ete),[f,d,i,a,o,l,t].join(`
`)}function Xh(n){var e=n.shapeInfo.logicalShape;switch(e.length){case 0:return(function(t){var r=t.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return"float "+s+"() {return "+r+";}";var o=t.shapeInfo.texShape,i=o[0],a=o[1];if(i===1&&a===1)return`
      float `+s+`() {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var l=t.shapeInfo.texShape,c=l[0],u=l[1],d=Yd(r);return`
    float `+s+`() {
      vec2 uv = uvFromFlat(`+c+", "+u+", "+d+`);
      return sampleTexture(`+r+`, uv);
    }
  `})(n);case 1:return(function(t){var r=t.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return`
      float `+s+`(int index) {
        `+Mh(t)+`
      }
    `;var o=t.shapeInfo.texShape,i=o[0],a=o[1];if(a===1&&i===1)return`
      float `+s+`(int index) {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var l=Yd(r);return a===1?`
      float `+s+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+l+") + 0.5) / "+i+`.0);
        return sampleTexture(`+r+`, uv);
      }
    `:i===1?`
      float `+s+`(int index) {
        vec2 uv = vec2((float(index + `+l+") + 0.5) / "+a+`.0, 0.5);
        return sampleTexture(`+r+`, uv);
      }
    `:`
    float `+s+`(int index) {
      vec2 uv = uvFromFlat(`+i+", "+a+", index + "+l+`);
      return sampleTexture(`+r+`, uv);
    }
  `})(n);case 2:return(function(t){var r=t.shapeInfo.logicalShape,s=t.name,o="get"+s.charAt(0).toUpperCase()+s.slice(1),i=t.shapeInfo.texShape;if(i!=null&&eo(r,i)){var a=i[0],l=i[1];return`
    float `+o+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+l+".0, "+a+`.0);
      return sampleTexture(`+s+`, uv);
    }
  `}var c=nf(r),u=c.newShape,d=c.keptDims,f=u;if(f.length<r.length){var p=Yh(t,f);return`
      `+Xh(p)+`
      float `+o+`(int row, int col) {
        return `+o+"("+Zh(["row","col"],d)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+r[1]+`, 1)));
        `+Mh(t)+`
      }
    `;var x=i[0],v=i[1],y=Yd(s);return v===1?`
    float `+o+`(int row, int col) {
      float index = dot(vec3(row, col, `+y+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+x+`.0);
      return sampleTexture(`+s+`, uv);
    }
  `:x===1?`
    float `+o+`(int row, int col) {
      float index = dot(vec3(row, col, `+y+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+v+`.0, 0.5);
      return sampleTexture(`+s+`, uv);
    }
  `:`
  float `+o+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+r[1]+" + col + "+y+`;
    vec2 uv = uvFromFlat(`+x+", "+v+`, index);
    return sampleTexture(`+s+`, uv);
  }
`})(n);case 3:return(function(t){var r=t.shapeInfo.logicalShape,s=t.name,o="get"+s.charAt(0).toUpperCase()+s.slice(1),i=r[1]*r[2],a=r[2],l=nf(r),c=l.newShape,u=l.keptDims,d=c;if(d.length<r.length){var f=Yh(t,d);return`
        `+Xh(f)+`
        float `+o+`(int row, int col, int depth) {
          return `+o+"("+Zh(["row","col","depth"],u)+`);
        }
      `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+i+", "+a+`, 1)));
        `+Mh(t)+`
      }
    `;var p=t.shapeInfo.texShape,x=p[0],v=p[1],y=t.shapeInfo.flatOffset;if(v===i&&y==null)return`
        float `+o+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+a+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+v+".0, "+x+`.0);
          return sampleTexture(`+s+`, uv);
        }
      `;if(v===a&&y==null)return`
    float `+o+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+r[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+v+".0, "+x+`.0);
      return sampleTexture(`+s+`, uv);
    }
  `;var b=Yd(s);return`
      float `+o+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+i+" + col * "+a+" + depth + "+b+`;
        vec2 uv = uvFromFlat(`+x+", "+v+`, index);
        return sampleTexture(`+s+`, uv);
      }
  `})(n);case 4:return(function(t){var r=t.shapeInfo.logicalShape,s=t.name,o="get"+s.charAt(0).toUpperCase()+s.slice(1),i=r[3],a=r[2]*i,l=r[1]*a,c=nf(r),u=c.newShape,d=c.keptDims;if(u.length<r.length){var f=Yh(t,u);return`
      `+Xh(f)+`
      float `+o+`(int row, int col, int depth, int depth2) {
        return `+o+"("+Zh(["row","col","depth","depth2"],d)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+l+", "+a+", "+i+`, 1)));
        `+Mh(t)+`
      }
    `;var p=t.shapeInfo.flatOffset,x=t.shapeInfo.texShape,v=x[0],y=x[1];if(y===l&&p==null)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+a+", "+i+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+y+".0, "+v+`.0);
        return sampleTexture(`+s+`, uv);
      }
    `;if(y===i&&p==null)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+r[1]*r[2]+", "+r[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+y+".0, "+v+`.0);
        return sampleTexture(`+s+`, uv);
      }
    `;var b=Yd(s);return`
    float `+o+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+l+" + col * "+a+` +
          depth * `+i+` + depth2;
      vec2 uv = uvFromFlat(`+v+", "+y+", index + "+b+`);
      return sampleTexture(`+s+`, uv);
    }
  `})(n);case 5:return(function(t){var r=t.shapeInfo.logicalShape,s=t.name,o="get"+s.charAt(0).toUpperCase()+s.slice(1),i=r[4],a=r[3]*i,l=r[2]*a,c=r[1]*l,u=nf(r),d=u.newShape,f=u.keptDims;if(d.length<r.length){var p=Yh(t,d);return`
      `+Xh(p)+`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        return `+o+"("+Zh(["row","col","depth","depth2","depth3"],f)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+c+", "+l+", "+a+", "+i+`)) +
          depth3;
        `+Mh(t)+`
      }
    `;var x=t.shapeInfo.flatOffset,v=t.shapeInfo.texShape,y=v[0],b=v[1];if(b===c&&x==null)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+l+", "+a+", "+i+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+b+".0, "+y+`.0);
        return sampleTexture(`+s+`, uv);
      }
    `;if(b===i&&x==null)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]+`,
               `+r[2]*r[3]+", "+r[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+b+".0, "+y+`.0);
        return sampleTexture(`+s+`, uv);
      }
    `;var w=Yd(s);return`
    float `+o+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+c+" + col * "+l+" + depth * "+a+` +
          depth2 * `+i+" + depth3 + "+w+`;
      vec2 uv = uvFromFlat(`+y+", "+b+`, index);
      return sampleTexture(`+s+`, uv);
    }
  `})(n);case 6:return(function(t){var r=t.shapeInfo.logicalShape,s=t.name,o="get"+s.charAt(0).toUpperCase()+s.slice(1),i=nf(r),a=i.newShape,l=i.keptDims;if(a.length<r.length){var c=Yh(t,a);return`
      `+Xh(c)+`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+o+"("+Zh(["row","col","depth","depth2","depth3","depth4"],l)+`);
      }
    `}var u=r[5],d=r[4]*u,f=r[3]*d,p=r[2]*f,x=r[1]*p;if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+x+", "+p+", "+f+", "+d+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+u+`, 1)));
        `+Mh(t)+`
      }
    `;var v=t.shapeInfo.flatOffset,y=t.shapeInfo.texShape,b=y[0],w=y[1];if(w===x&&v==null)return`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+p+", "+f+", "+d+", "+u+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+w+".0, "+b+`.0);
        return sampleTexture(`+s+`, uv);
      }
    `;if(w===u&&v==null)return`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]*r[4]+`,
               `+r[2]*r[3]*r[4]+`,
               `+r[3]*r[4]+`,
               `+r[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+w+".0, "+b+`.0);
        return sampleTexture(`+s+`, uv);
      }
    `;var S=Yd(s);return`
    float `+o+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+x+" + col * "+p+" + depth * "+f+` +
          depth2 * `+d+" + depth3 * "+u+" + depth4 + "+S+`;
      vec2 uv = uvFromFlat(`+b+", "+w+`, index);
      return sampleTexture(`+s+`, uv);
    }
  `})(n);default:throw new Error(e.length+"-D input sampling is not yet supported")}}function CF(n){var e,t,r;switch(n.shapeInfo.logicalShape.length){case 0:return e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),r=Oo(),`
    vec4 `+t+`() {
      return `+r.texture2D+"("+e+`, halfCR);
    }
  `;case 1:return(function(s){var o=s.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=s.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],c=Oo();return`
    vec4 `+i+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+l[0]+", "+l[1]+`, index);
      return `+c.texture2D+"("+o+`, uv);
    }
  `})(n);case 2:return(function(s){var o=s.shapeInfo.logicalShape,i=s.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),l=s.shapeInfo.texShape,c=l[0],u=l[1],d=Oo();if(l!=null&&eo(o,l))return`
      vec4 `+a+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+u+".0, "+c+`.0);

        return `+d.texture2D+"("+i+`, uv);
      }
    `;var f=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)],p=Math.ceil(o[1]/2);return`
    vec4 `+a+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+p+", "+f[0]+", "+f[1]+`, row, col);
      return `+d.texture2D+"("+i+`, uv);
    }
  `})(n);case 3:return(function(s){var o=s.shapeInfo.logicalShape,i=s.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),l=s.shapeInfo.texShape,c=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];if(o[0]===1){var u=o.slice(1),d=Yh(s,u);return`
        `+CF(d)+`
        vec4 `+a+`(int b, int row, int col) {
          return `+a+"("+Zh(["b","row","col"],[1,2])+`);
        }
      `}var f=c[0],p=c[1],x=Math.ceil(o[2]/2),v=x*Math.ceil(o[1]/2),y=Oo();return`
    vec4 `+a+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+f+", "+p+", "+v+", "+x+`, b, row, col);
      return `+y.texture2D+"("+i+`, uv);
    }
  `})(n);default:return(function(s){for(var o=s.shapeInfo.logicalShape,i=o.length,a=s.name,l="get"+a.charAt(0).toUpperCase()+a.slice(1),c=s.shapeInfo.texShape,u=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)],d=u[0],f=u[1],p=Math.ceil(o[i-1]/2),x=p*Math.ceil(o[i-2]/2),v="int b, int row, int col",y="b * "+x+" + (row / 2) * "+p+" + (col / 2)",b=2;b<i-1;b++)v="int b"+b+", "+v,x*=o[i-b-1],y="b"+b+" * "+x+" + "+y;var w=Oo();return`
    vec4 `+l+"("+v+`) {
      int index = `+y+`;
      int texR = index / `+f+`;
      int texC = index - texR * `+f+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+f+", "+d+`);
      return `+w.texture2D+"("+a+`, uv);
    }
  `})(n)}}var kte=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Ste=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Nte=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Ete=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Yd(n){return"offset"+n}function Mh(n){var e=n.name,t=Xt(n.shapeInfo.logicalShape);return t<2?"return "+e+";":`
    for (int i = 0; i < `+t+`; i++) {
      if (i == index) {
        return `+e+`[i];
      }
    }
  `}function $r(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error("GPU for rank "+n+" is not yet supported")}function Yh(n,e){var t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function Zh(n,e){return e.map((function(t){return n[t]})).join(", ")}var Ite=function(n,e,t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,ee(n.length>2,(function(){return"Packed arg"+(t.charAt(0).toUpperCase()+t.slice(1))+" supports only inputs with rank above 2."}));var s=n[n.length-1],o=Math.ceil(s/e);this.outputShape=n.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");var i,a,l=this.outputShape,c=l.length,u=$r(c),d=bi("coords",c);if(o===1){var f=$r(a=c+1);i=`
        `+f+" sourceLocR = "+f+"("+d.join()+`, 0);
        ++`+d[c-1]+`;
        `+f+" sourceLocG = "+f+"("+d.join()+`, 0);
        ++`+d[c-2]+`;
        `+f+" sourceLocA = "+f+"("+d.join()+`, 0);
        --`+d[c-1]+`;
        `+f+" sourceLocB = "+f+"("+d.join()+`, 0);
        --`+d[c-2]+";"}else a=c,i=`
        `+u+` sourceLocR = coords;
        ++`+d[c-1]+`;
        `+u+` sourceLocG = coords;
        ++`+d[c-2]+`;
        `+u+` sourceLocA = coords;
        --`+d[c-1]+`;
        `+u+` sourceLocB = coords;
        --`+d[c-2]+";";var p=["x","y","z","w","u","v"].slice(0,a),x="."+p[a-1],v=p.map((function(F){return"int "+F})),y=bi("sourceLocR",a-1).concat("inIdx.r"),b=bi("sourceLocG",a-1).concat("inIdx.g"),w=bi("sourceLocB",a-1).concat("inIdx.b"),S=bi("sourceLocA",a-1).concat("inIdx.a"),k=t==="max"?"greaterThan":"lessThan",N=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+y.join()+`),
                             getBestIndicesAChannel(`+b.join()+`),
                             getBestIndicesAChannel(`+w.join()+`),
                             getBestIndicesAChannel(`+S.join()+")));",I=`vec4(
            getAChannel(`+y.join()+`),
            hasNextCol ? getAChannel(`+b.join()+`) : 0.,
            hasNextRow ? getAChannel(`+w.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+S.join()+") : 0.)",T=r?"":`
      float getBestIndicesAChannel(`+v.join()+`) {
        return getChannel(getBestIndicesA(`+p.join()+`),
                                          vec2(`+p.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+v.join()+`) {
        return getChannel(getA(`+p.join()+`),
                               vec2(`+p.slice(-2).join()+`));
      }
      `+T+`
      void main() {
        `+u+` coords = getOutputCoords();
        bool hasNextCol = `+d[c-1]+" < "+(l[c-1]-1)+`;
        bool hasNextRow = `+d[c-2]+" < "+(l[c-2]-1)+`;
        `+i+`
        ivec4 srcIdx = ivec4(sourceLocR`+x+", sourceLocG"+x+`,
          sourceLocB`+x+", sourceLocA"+x+") * "+e+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+I+`;

        for (int i = 0; i < `+e+`; i++) {
          inIdx = srcIdx;
          `+N+`
          vec4 candidate = `+I+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+k+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `},Tte=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,s=n.strideWidth,o=n.dilationHeight,i=n.dilationWidth,a=n.effectiveFilterHeight,l=n.effectiveFilterWidth,c=a-1-n.padInfo.top,u=l-1-n.padInfo.left,d=1/(e*t);this.userCode=`
      const ivec2 pads = ivec2(`+c+", "+u+`);
      const float avgMultiplier = float(`+d+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+a+`;
            wR += `+o+`) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+l+`;
            wC+= `+i+`) {
            float dyC = float(dyCCorner + wC) / `+s+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `},_te=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var e=n.filterDepth,t=n.filterHeight,r=n.filterWidth,s=n.strideDepth,o=n.strideHeight,i=n.strideWidth,a=n.dilationDepth,l=n.dilationHeight,c=n.dilationWidth,u=n.effectiveFilterDepth,d=n.effectiveFilterHeight,f=n.effectiveFilterWidth,p=u-1-n.padInfo.front,x=d-1-n.padInfo.top,v=f-1-n.padInfo.left,y=1/(e*t*r);this.userCode=`
      const ivec3 pads = ivec3(`+p+", "+x+", "+v+`);
      const float avgMultiplier = float(`+y+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+u+`;
            wD += `+a+`) {
          float dyD = float(dyDCorner + wD) / `+s+`.0;

          if (dyD < 0.0 || dyD >= `+n.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+d+`;
              wR += `+l+`) {
            float dyR = float(dyRCorner + wR) / `+o+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+f+`;
                wC += `+c+`) {
              float dyC = float(dyCCorner + wC) / `+i+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `},Rte=function(n,e,t,r,s,o){this.outputShape=[],this.variableNames=["x","mean","variance"],zn(n,e),zn(n,t);var i="0.0";r!=null&&(zn(n,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");var a="1.0";s!=null&&(zn(n,s),this.variableNames.push("scale"),a="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+i+`;
        float scale = `+a+`;
        float inv = scale * inversesqrt(variance + float(`+o+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `},Dte=function(n,e,t,r,s,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],zn(n,e),zn(n,t);var i="vec4(0.0)";r!=null&&(zn(n,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");var a="vec4(1.0)";s!=null&&(zn(n,s),this.variableNames.push("scale"),a="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        vec4 offset = `+i+`;
        vec4 scale = `+a+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+o+`));

        setOutput((x - mean) * inv + offset);
      }
    `},Ate="return areal * breal - aimag * bimag;",$te="return areal * bimag + aimag * breal;",rT=function(n,e,t){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=zn(e,t),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+n+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},zC="return a + b;",WC="return a - b;",sT="return a * b;",kF="return (a < 0.) ? b * a : a;",es=function(n,e,t){this.variableNames=["A","B"],this.outputShape=zn(e,t),this.userCode=`
      float binaryOperation(float a, float b) {
        `+n+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},SF=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,$c=function(n,e,t,r){r===void 0&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=zn(e,t);var s=this.outputShape.length,o="";if(r)if(s===0||Xt(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          `+$r(s)+` coords = getOutputCoords();
        `,s===1)o+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var i=bi("coords",s);o+=`
            bool nextRowOutOfBounds =
              (`+i[s-2]+" + 1) >= "+this.outputShape[s-2]+`;
            bool nextColOutOfBounds =
              (`+i[s-1]+" + 1) >= "+this.outputShape[s-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+n+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+o+`

        setOutput(result);
      }
    `},Fte=(function(){function n(e){this.variableNames=["A"],this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return n.prototype.getCustomSetupFunc=function(e,t){var r=this;return function(s,o){r.minLoc==null&&(r.minLoc=s.getUniformLocationNoThrow(o,"minVal"),r.maxLoc=s.getUniformLocationNoThrow(o,"maxVal")),s.gl.uniform1f(r.minLoc,e),s.gl.uniform1f(r.maxLoc,t)}},n})(),Pte=(function(){function n(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return n.prototype.getCustomSetupFunc=function(e,t){var r=this;return function(s,o){r.minLoc==null&&(r.minLoc=s.getUniformLocationNoThrow(o,"minVal"),r.maxLoc=s.getUniformLocationNoThrow(o,"maxVal")),s.gl.uniform1f(r.minLoc,e),s.gl.uniform1f(r.maxLoc,t)}},n})(),Ote=function(n){this.variableNames=["real","imag"],this.outputShape=n,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `},Mte=function(n){this.outputShape=[],this.outputShape=Ip(n,1),this.variableNames=n.map((function(a,l){return"T"+l}));var e=new Array(n.length-1);e[0]=n[0][1];for(var t=1;t<e.length;t++)e[t]=e[t-1]+n[t][1];var r=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(t=1;t<e.length;t++){var s=e[t-1];r.push("else if (yC < "+e[t]+") setOutput(getT"+t+"(yR, yC-"+s+"));")}var o=e.length,i=e[e.length-1];r.push("else setOutput(getT"+o+"(yR, yC-"+i+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+r.join(`
        `)+`
      }
    `},Lte=function(n,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Ip(n,e);var t=this.outputShape,r=t.length,s=$r(r),o=bi("coords",r),i=["x","y","z","w","u","v"].slice(0,r);this.variableNames=n.map((function(y,b){return"T"+b}));var a=new Array(n.length-1);a[0]=n[0][e];for(var l=1;l<a.length;l++)a[l]=a[l-1]+n[l][e];var c=i[e],u=i.slice(-2),d=i.join(),f="if ("+c+" < "+a[0]+`) {
        return getChannel(
            getT0(`+d+"), vec2("+u.join()+`));
        }`;for(l=1;l<a.length;l++){var p=a[l-1];f+=`
        if (`+c+" < "+a[l]+"  && "+c+" >= "+a[l-1]+`) {
          return getChannel(
            getT`+l+"("+rv(i,c,p)+`),
            vec2(`+rv(u,c,p)+`));
        }`}var x=a.length,v=a[a.length-1];f+=`
        return getChannel(
          getT`+x+"("+rv(i,c,v)+`),
          vec2(`+rv(u,c,v)+"));",this.userCode=`
      float getValue(`+i.map((function(y){return"int "+y}))+`) {
        `+f+`
      }

      void main() {
        `+s+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+o+`), 0., 0., 0.);

        `+o[r-1]+" = "+o[r-1]+` + 1;
        if (`+o[r-1]+" < "+t[r-1]+`) {
          result.g = getValue(`+o+`);
        }

        `+o[r-2]+" = "+o[r-2]+` + 1;
        if (`+o[r-2]+" < "+t[r-2]+`) {
          result.a = getValue(`+o+`);
        }

        `+o[r-1]+" = "+o[r-1]+` - 1;
        if (`+o[r-2]+" < "+t[r-2]+` &&
            `+o[r-1]+" < "+t[r-1]+`) {
          result.b = getValue(`+o+`);
        }
        setOutput(result);
      }
    `};function rv(n,e,t){var r=n.indexOf(e);return n.map((function(s,o){return o===r?s+" - "+t:s})).join()}var jte=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideHeight,t=n.strideWidth,r=n.padInfo.top,s=n.padInfo.left,o=n.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yR = 0; yR < `+n.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+r+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+n.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+s+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              if (`+o+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},Bte=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,s=n.strideWidth,o=n.dataFormat==="channelsLast",i=e-1-n.padInfo.top,a=t-1-n.padInfo.left,l=o?1:2,c=o?2:3,u=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+i+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+u+`];

        ivec2 dyCorner = ivec2(coords[`+l+"], coords["+c+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+s+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            for (int d2 = 0; d2 < `+n.outChannels+`; d2++) {

              if (`+o+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},Vte=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideDepth,t=n.strideHeight,r=n.strideWidth,s=n.padInfo.front,o=n.padInfo.top,i=n.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yF = 0; yF < `+n.outDepth+`; yF++) {
            int xF = wF + yF * `+e+" - "+s+`;

            if (xF < 0 || xF >= `+n.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+n.outHeight+`; yR++) {
              int xR = wR + yR * `+t+" - "+o+`;

              if (xR < 0 || xR >= `+n.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+n.outWidth+`; yC++) {
                int xC = wC + yC * `+r+" - "+i+`;

                if (xC < 0 || xC >= `+n.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},zte=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterDepth,t=n.filterHeight,r=n.filterWidth,s=n.strideDepth,o=n.strideHeight,i=n.strideWidth,a=e-1-n.padInfo.front,l=t-1-n.padInfo.top,c=r-1-n.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+a+", "+l+", "+c+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+e+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+s+`.0;

          if (dyF < 0.0 || dyF >= `+n.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+e+` - 1 - wF;

          for (int wR = 0; wR < `+t+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+o+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+t+` - 1 - wR;

            for (int wC = 0; wC < `+r+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+i+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+r+` - 1 - wC;

              for (int d2 = 0; d2 < `+n.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},Wte=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideHeight,t=n.strideWidth,r=n.padInfo.top,s=n.padInfo.left,o=n.outChannels/n.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+o+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yR = 0; yR < `+n.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+r+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+n.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+s+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `},Ute=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,s=n.strideWidth,o=e-1-n.padInfo.top,i=t-1-n.padInfo.left,a=n.outChannels/n.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+i+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+s+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+a+`; dm++) {
              int d2 = d1 * `+a+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `},oT=function(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var s=n.padInfo.top,o=n.padInfo.left,i=n.strideHeight,a=n.strideWidth,l=n.dilationHeight,c=n.dilationWidth,u=n.filterHeight,d=n.filterWidth,f=4*Math.floor(n.inChannels/4),p=n.inChannels%4,x=n.dataFormat==="channelsLast",v=x?1:2,y=x?2:3,b=x?3:1,w="",S="";t&&(w=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,S="result = activation(result);");var k=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+w+`

      const ivec2 strides = ivec2(`+i+", "+a+`);
      const ivec2 pads = ivec2(`+s+", "+o+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+b+`];

        ivec2 xRCCorner =
            ivec2(coords[`+v+"], coords["+y+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+u+`; wR++) {
          int xR = xRCorner + wR * `+l+`;

          if (xR < 0 || xR >= `+n.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+d+`; wC++) {
            int xC = xCCorner + wC * `+c+`;

            if (xC < 0 || xC >= `+n.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+f+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+x+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(p===1)+`) {

              if (`+x+`) {
                dotProd +=
                    getX(batch, xR, xC, `+f+`) *
                    getW(wR, wC, `+f+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+f+`, xR, xC) *
                    getW(wR, wC, `+f+`, d2);
              }

            } else if (`+(p===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+f+`, d2),
                getW(wR, wC, `+f+` + 1, d2)
              );

              if (`+x+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+f+`),
                  getX(batch, xR, xC, `+f+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+f+`, xR, xC),
                  getX(batch, `+f+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(p===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+f+`, d2),
                getW(wR, wC, `+f+` + 1, d2),
                getW(wR, wC, `+f+` + 2, d2)
              );

              if (`+x+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+f+`),
                  getX(batch, xR, xC, `+f+` + 1),
                  getX(batch, xR, xC, `+f+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+f+`, xR, xC),
                  getX(batch, `+f+` + 1, xR, xC),
                  getX(batch, `+f+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+k+`
        `+S+`
        setOutput(result);
      }
    `},Hte=function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var e=n.padInfo.front,t=n.padInfo.top,r=n.padInfo.left,s=n.strideDepth,o=n.strideHeight,i=n.strideWidth,a=n.dilationDepth,l=n.dilationHeight,c=n.dilationWidth,u=n.filterDepth,d=n.filterHeight,f=n.filterWidth,p=4*Math.floor(n.inChannels/4),x=n.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+s+", "+o+", "+i+`);
      const ivec3 pads = ivec3(`+e+", "+t+", "+r+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+u+`; wF++) {
          int xF = xFCorner + wF * `+a+`;

          if (xF < 0 || xF >= `+n.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+d+`; wR++) {
            int xR = xRCorner + wR * `+l+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+f+`; wC++) {
              int xC = xCCorner + wC * `+c+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+p+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(x===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+p+`) *
                  getW(wF, wR, wC, `+p+`, d2);
              } else if (`+(x===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+p+`),
                  getX(batch, xF, xR, xC, `+p+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+p+`, d2),
                  getW(wF, wR, wC, `+p+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(x===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+p+`),
                  getX(batch, xF, xR, xC, `+p+` + 1),
                  getX(batch, xF, xR, xC, `+p+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+p+`, d2),
                  getW(wF, wR, wC, `+p+` + 1, d2),
                  getW(wF, wR, wC, `+p+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},iT=function(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var s=n.inHeight,o=n.inWidth,i=n.padInfo.top,a=n.padInfo.left,l=n.strideHeight,c=n.strideWidth,u=n.dilationHeight,d=n.dilationWidth,f=n.filterHeight,p=n.filterWidth,x=n.outChannels/n.inChannels,v="",y="";t&&(v=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,y="result = activation(result);");var b=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+v+`

      const ivec2 strides = ivec2(`+l+", "+c+`);
      const ivec2 pads = ivec2(`+i+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+x+`;
        int q = d2 - d1 * `+x+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+f+`; wR++) {
          int xR = xRCorner + wR * `+u+`;

          if (xR < 0 || xR >= `+s+`) {
            continue;
          }

          for (int wC = 0; wC < `+p+`; wC++) {
            int xC = xCCorner + wC * `+d+`;

            if (xC < 0 || xC >= `+o+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+b+`
        `+y+`
        setOutput(result);
      }
    `},aT=function(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.outShape;for(var s=n.inHeight,o=n.inWidth,i=n.padInfo.top,a=n.padInfo.left,l=n.strideHeight,c=n.strideWidth,u=n.dilationHeight,d=n.dilationWidth,f=n.filterHeight,p=n.filterWidth,x=p,v="int xR; int xC; int xCOffset;",y=0;y<f;y++)for(var b=0;b<p;b++)v+=`
          vec4 xTexelR`+y+"C"+2*b+` = vec4(0.);
          vec4 wR`+y+"C"+b+` = vec4(0.);
          vec4 xR`+y+"C"+b+" = vec4(0.);";for(y=0;y<f;y++)for(var w=0;w<x;w++){if(v+=`
          xR = xRCorner + `+y*u+`;
          xC = xCCorner + `+(b=2*w)*d+`;
        `,c===1){if(b<p&&(v+=a%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+s+" && xCOffset >= 0 && xCOffset < "+o+`) {
                  xTexelR`+y+"C"+b+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+o+`) {
                    xTexelR`+y+"C"+b+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+y+"C"+b+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+s+" && xCOffset >= 0 && xCOffset < "+o+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+o+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+y+"C"+b+" = vec4(previous.zw, xTexelR"+y+"C"+b+`.xy);
                } else {
                  xR`+y+"C"+b+" = vec4(0, 0, xTexelR"+y+"C"+b+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+s+" && xC >= 0 && xC < "+o+`) {
                  xTexelR`+y+"C"+b+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+y+"C"+b+` = vec4(0.);
                }

                xR`+y+"C"+b+" = xTexelR"+y+"C"+b+`;
              `,b+1<p)){var S=a%2==0?z$(d):d;d%2==0&&a%2==1||d%2!=0&&a%2!=1?(v+=`
                  xCOffset = xC + `+a%2+" + "+S+`;

                  if(xR >= 0 && xR < `+s+` &&
                    xCOffset >= 0 && xCOffset < `+o+`) {
                    xTexelR`+y+"C"+(b+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,d>1&&(v+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+s+` &&
                      xCOffset >= 0 && xCOffset < `+o+`) {
                      xTexelR`+y+"C"+b+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+y+"C"+b+` = vec4(0.);
                    }
                  `),v+=`
                  xR`+y+"C"+(b+1)+` = vec4(
                    xTexelR`+y+"C"+b+".zw, xTexelR"+y+"C"+(b+2)+`.xy);
                `):v+=`
                  xCOffset = xC + `+S+`;

                  if(xR >= 0 && xR < `+s+` &&
                    xCOffset >= 0 && xCOffset < `+o+`) {
                    xTexelR`+y+"C"+(b+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+y+"C"+(b+1)+" = xTexelR"+y+"C"+(b+2)+`;
                `}}else b<p&&(v+=`
              if(xR >= 0 && xR < `+s+`) {
            `,a%2==1?(v+=`
                xCOffset = xC + 1 - `+c+`;
                if(xCOffset >= 0 && xCOffset < `+o+`) {
                  xTexelR`+y+"C"+b+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+y+"C"+b+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+o+`) {
                  xTexelR`+y+"C"+(b+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+y+"C"+(b+2)+` = vec4(0.);
                }

                xR`+y+"C"+b+` = vec4(
                  xTexelR`+y+"C"+b+".zw, xTexelR"+y+"C"+(b+2)+`.zw);
              `,b+1<p&&(v+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+c+`;
                  if(xCOffset >= 0 && xCOffset < `+o+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+y+"C"+(b+1)+" = vec4(xTexelR"+y+"C"+(b+2)+`.xy, final.xy);
                `)):(v+=`
                if(xC >= 0 && xC < `+o+`) {
                  xTexelR`+y+"C"+b+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+y+"C"+b+` = vec4(0.);
                }

                xCOffset = xC + `+c+`;
                if(xCOffset >= 0 && xCOffset < `+o+`) {
                  xTexelR`+y+"C"+(b+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+y+"C"+(b+2)+` = vec4(0.);
                }

                xR`+y+"C"+b+` = vec4(
                  xTexelR`+y+"C"+b+".xy, xTexelR"+y+"C"+(b+2)+`.xy);
              `,b+1<p&&(v+=`
                  xR`+y+"C"+(b+1)+` = vec4(
                    xTexelR`+y+"C"+b+".zw, xTexelR"+y+"C"+(b+2)+`.zw);
                `)),v+="}");b<p&&(v+=`
            vec4 wTexelR`+y+"C"+b+" = getW("+y+", "+b+`, d1, q);
            wR`+y+"C"+b+" = vec4(wTexelR"+y+"C"+b+".xz, wTexelR"+y+"C"+b+`.xz);
          `,b+1<p&&(v+=`
              vec4 wTexelR`+y+"C"+(b+1)+" = getW("+y+", "+(b+1)+`, d1, q);
              wR`+y+"C"+(b+1)+` =
                vec4(wTexelR`+y+"C"+(b+1)+".xz, wTexelR"+y+"C"+(b+1)+".xz);"))}for(y=0;y<f;y++)for(b=0;b<p;b++)v+="dotProd += xR"+y+"C"+b+" * wR"+y+"C"+b+";";var k="",N="";t&&(k=r?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`vec4 activation(vec4 x) {
          `+t+`
        }`,N="result = activation(result);");var I=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+k+`

      const ivec2 strides = ivec2(`+l+", "+c+`);
      const ivec2 pads = ivec2(`+i+", "+a+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+v+`

        vec4 result = dotProd;
        `+I+`
        `+N+`
        setOutput(result);
      }
    `},Gte=function(n,e,t,r,s){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=n[0],i=n[1],a=n[2],l=n[3],c=e[0],u=t[0],d=t[1];this.outputShape=[c,u,d,l];var f=r==="bilinear"?1:0,p=[i-1+".0",a-1+".0"],x=p[0],v=p[1],y=u>1?[""+(i-1)/(u-1),"(y2-y1) * height_ratio","y1*"+x+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+x],b=y[0],w=y[1],S=y[2],k=d>1?[""+(a-1)/(d-1),"(x2-x1) * width_ratio","x1*"+v+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+v],N=k[0],I=k[1],T=k[2];this.userCode=`
      const float height_ratio = float(`+b+`);
      const float width_ratio = float(`+N+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+o+`) {
          return;
        }

        float height_scale = `+w+`;
        float width_scale = `+I+`;

        float in_y = `+S+`;
        if( in_y < 0.0 || in_y > `+x+` ) {
          setOutput(float(`+s+`));
          return;
        }
        float in_x = `+T+`;
        if( in_x < 0.0 || in_x > `+v+` ) {
          setOutput(float(`+s+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+f+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `},qte=function(n,e,t){this.variableNames=["x"],this.outputShape=n;var r=n.length,s=n[n.length-1],o=t?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(t?"return "+s+" -i - 1;":"return i;")+`
      }

      void main() {
        `+$r(r)+` coords = getOutputCoords();
        int end = `+lT(r,"coords")+`;
        float val = 0.0;
        for (int i = `+s+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+o+` end) {
            continue;
          }
          if (idx == end && `+e+`) {
            continue;
          }
          `+lT(r,"coords")+` = idx;
          val += getX(`+(function(i,a){if(i===1)return""+a;if(i===2)return a+".x, "+a+".y";if(i===3)return a+".x, "+a+".y, "+a+".z";if(i===4)return a+".x, "+a+".y, "+a+".z, "+a+".w";throw Error("Cumulative sum for rank "+i+" is not yet supported")})(r,"coords")+`);
        }
        setOutput(val);
      }
    `};function lT(n,e){if(n===1)return""+e;if(n===2)return e+".y";if(n===3)return e+".z";if(n===4)return e+".w";throw Error("Cumulative sum for rank "+n+" is not yet supported")}var Kte=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=_g.DENSE;var e=dg(n),t=Oo();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+lf(["r","c","d"],n)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+t.output+` = result;
      }
    `},Xte=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=_g.DENSE;var e=dg(n),t=Oo();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+lf(["r","c","d"],n)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+t.output+` = result;
      }
    `},Yte=(function(){function n(e,t,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+t+`;
      int offset_h = imod(h, `+t+`);
      int in_w = w / `+t+`;
      int offset_w = imod(w, `+t+`);
      int offset_d = (offset_h * `+t+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return n.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},n.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},n.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},n.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},n.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},n})(),Zte=function(n){this.variableNames=["X"],this.outputShape=[n,n],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `},Jte=function(n){this.variableNames=["A"],this.outTexUsage=Ki.DOWNLOAD;var e=Oo();this.outputShape=n,this.userCode=`
      `+wF+`

      void main() {
        float x = getAAtOutCoords();
        `+e.output+` = encode_float(x);
      }
    `},Qte=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Ki.DOWNLOAD;var e=Oo();this.outputShape=n,this.userCode=`
      `+wF+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+e.output+` = encode_float(x);
      }
    `},ene=function(n,e,t){t===void 0&&(t=!1),this.variableNames=["A"];var r=Oo(),s=e[0],o=e[1];this.outputShape=n;var i="result";t&&(i="floor(result * 255. + 0.5)"),this.userCode=`
      `+o6(n)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+o+`;
        int c = imod(flatIndex, `+o+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+o+".0, "+s+`.0);
        vec4 values = `+r.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+r.output+" = vec4("+i+`, 0., 0., 0.);
      }
    `},tne=function(n,e,t){t===void 0&&(t=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=Oo(),s=e[0],o=e[1];this.outputShape=n;var i="",a="result";t&&(a="floor(result * 255. + 0.5)");for(var l=0;l<=1;l++)for(var c=0;c<=1;c++){var u=2*l+c;i+=`
          localCoords = coords;
          if(localCoords[2] + `+c+" < "+n[2]+`) {
            localCoords[2] += `+c+`;
            if(localCoords[1] + `+l+" < "+n[1]+`) {
              localCoords[1] += `+l+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+o+`;
              c = imod(flatIndex, `+o+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+o+".0, "+s+`.0);
              values = `+r.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+u+`] = values[0];
              } else if(offset == 1) {
                result[`+u+`] = values[1];
              } else if(offset == 2) {
                result[`+u+`] = values[2];
              } else {
                result[`+u+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+o6(n)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+i+`

        `+r.output+" = "+a+`;
      }
    `},nne="return real * expR - imag * expI;",rne="return real * expI + imag * expR;",cT=function(n,e,t){this.variableNames=["real","imag"];var r=e[1];this.outputShape=e;var s=t?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,o=t?r+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+s+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+n+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+r+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+r+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+o+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},sne=(function(){function n(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;return function(r,s){t.valueLoc==null&&(t.valueLoc=r.getUniformLocationNoThrow(s,"value")),r.gl.uniform1f(t.valueLoc,e)}},n})(),one=function(n,e,t){this.variableNames=["A","indices"];var r=n.slice();r[t]=e,this.outputShape=r,this.rank=r.length;var s=$r(this.rank),o=(function(i,a){var l=i.length;if(l>4)throw Error("Gather for rank "+l+" is not yet supported");if(l===1)return"int(getIndices(resRC))";for(var c=["resRC.x","resRC.y","resRC.z","resRC.w"],u=[],d=0;d<i.length;d++)d===a?u.push("int(getIndices("+c[d]+"))"):u.push(""+c[d]);return u.join()})(n,t);this.userCode=`
      void main() {
        `+s+` resRC = getOutputCoords();
        setOutput(getA(`+o+`));
      }
    `},ine=function(n,e,t){this.sliceDim=n,this.strides=e,this.variableNames=["x","indices"],this.outputShape=t;var r=$r(e.length),s=$r(t.length),o=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+r+" strides = "+r+"("+this.strides+`);
         void main() {
          `+s+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+o+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `};function ane(n,e){var t=Oo();return nee(n,e,t.version+`
    precision highp float;
    `+t.attribute+` vec3 clipSpacePos;
    `+t.attribute+` vec2 uv;
    `+t.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function lne(n,e){return aee(n,e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function cne(n,e){return lee(n,e,new Uint16Array([0,1,2,2,1,3]))}function n1(n,e,t,r,s,o,i){uee(t,r);var a=cee(n,e),l=n.TEXTURE_2D;return Qt(n,e,(function(){return n.bindTexture(l,a)})),Qt(n,e,(function(){return n.texParameteri(l,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)})),Qt(n,e,(function(){return n.texParameteri(l,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)})),Qt(n,e,(function(){return n.texParameteri(l,n.TEXTURE_MIN_FILTER,n.NEAREST)})),Qt(n,e,(function(){return n.texParameteri(l,n.TEXTURE_MAG_FILTER,n.NEAREST)})),Qt(n,e,(function(){return n.texImage2D(l,0,s,t,r,0,o,i,null)})),Qt(n,e,(function(){return n.bindTexture(n.TEXTURE_2D,null)})),a}function une(n,e,t,r,s){var o=Ty(t,r);return n1(n,e,o[0],o[1],s.internalFormatFloat,s.textureFormatFloat,n.FLOAT)}function dne(n,e,t,r,s){var o=Ty(t,r);return n1(n,e,o[0],o[1],s.internalFormatHalfFloat,s.textureFormatFloat,s.textureTypeHalfFloat)}function fne(n,e,t,r,s){var o=Ty(t,r);return n1(n,e,o[0],o[1],n.RGBA,n.RGBA,n.UNSIGNED_BYTE)}function hne(n,e,t,r,s){var o=t1(t,r);return n1(n,e,o[0],o[1],s.internalFormatPackedFloat,n.RGBA,n.FLOAT)}function pne(n,e,t,r,s){var o=t1(t,r);return n1(n,e,o[0],o[1],s.internalFormatPackedHalfFloat,n.RGBA,s.textureTypeHalfFloat)}function mne(n,e,t,r){return Qt(n,e,(function(){return n.bindBuffer(n.ARRAY_BUFFER,r)})),Y9(n,e,t,"clipSpacePos",r,3,20,0)&&Y9(n,e,t,"uv",r,2,20,12)}function gne(n,e,t,r,s,o,i){var a,l,c;Qt(n,e,(function(){return n.bindTexture(n.TEXTURE_2D,t)})),o instanceof Uint8Array?(a=new Uint8Array(r*s*4),l=n.UNSIGNED_BYTE,c=n.RGBA):(a=new Float32Array(r*s*4),l=n.FLOAT,c=i.internalFormatPackedFloat),a.set(o),Qt(n,e,(function(){return n.texImage2D(n.TEXTURE_2D,0,c,r,s,0,n.RGBA,l,a)})),Qt(n,e,(function(){return n.bindTexture(n.TEXTURE_2D,null)}))}function xne(n,e,t,r){Qt(n,e,(function(){return n.bindTexture(n.TEXTURE_2D,t)})),r.data instanceof Uint8Array?Qt(n,e,(function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,r.width,r.height,0,n.RGBA,n.UNSIGNED_BYTE,r.data)})):Qt(n,e,(function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,r)})),Qt(n,e,(function(){return n.bindTexture(n.TEXTURE_2D,null)}))}function vne(n,e,t,r,s){var o=n.createBuffer();Qt(n,e,(function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,o)}));var i=16*t*r;return Qt(n,e,(function(){return n.bufferData(n.PIXEL_PACK_BUFFER,i,n.STREAM_READ)})),Qt(n,e,(function(){return n.readPixels(0,0,r,t,n.RGBA,n.FLOAT,0)})),Qt(n,e,(function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,null)})),o}function yne(n,e,t){var r=n,s=new Float32Array(t);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,s),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),s}function bne(n,e,t,r,s){var o=Ty(t,r),i=o[0],a=o[1],l=new Uint8Array(t*r*4);return Qt(n,e,(function(){return n.readPixels(0,0,i,a,s.downloadTextureFormat,n.UNSIGNED_BYTE,l)})),new Float32Array(l.buffer)}function wne(n,e,t,r,s,o,i,a){var l=n,c=new Float32Array((function(u,d){var f=t1(u,d);return f[0]*f[1]*4})(o,i));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,c),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),c}function Cne(n,e,t,r){var s=new Float32Array(t*r*4);return Qt(n,e,(function(){return n.readPixels(0,0,r,t,n.RGBA,n.FLOAT,s)})),s}var kne=(function(){function n(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=je().getNumber("WEBGL_VERSION");e!=null?(this.gl=e,ZQ(t,e)):this.gl=pc(t);var r="WEBGL_color_buffer_float";if(je().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=Qx(this.gl,this.debug,"OES_texture_float"),Ea(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=Qx(this.gl,this.debug,"OES_texture_half_float");else if(je().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),Ea(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=Qx(this.gl,this.debug,"EXT_color_buffer_half_float");else if(je().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",Ea(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!Ea(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=lne(this.gl,this.debug),this.indexBuffer=cne(this.gl,this.debug),this.framebuffer=dee(this.gl,this.debug),this.textureConfig=Xk(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(n.prototype,"debug",{get:function(){return je().getBool("DEBUG")},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){var e=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;Qt(t,this.debug,(function(){return t.finish()})),Qt(t,this.debug,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),Qt(t,this.debug,(function(){return t.deleteFramebuffer(e.framebuffer)})),Qt(t,this.debug,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),Qt(t,this.debug,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),Qt(t,this.debug,(function(){return t.deleteBuffer(e.indexBuffer)})),this.disposed=!0}},n.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),une(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),dne(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),fne(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),xne(this.gl,this.debug,e,t)},n.prototype.uploadDenseMatrixToTexture=function(e,t,r,s){this.throwIfDisposed(),gne(this.gl,this.debug,e,t,r,s,this.textureConfig)},n.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),pne(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),hne(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(Z9(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Qt(this.gl,this.debug,(function(){return t.gl.deleteTexture(e)}))},n.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,r){var s=this;return this.downloadMatrixDriver(e,(function(){return bne(s.gl,s.debug,t,r,s.textureConfig)}))},n.prototype.downloadPackedMatrixFromBuffer=function(e,t,r,s,o,i){return wne(this.gl,e,0,0,0,o,i,this.textureConfig)},n.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return yne(this.gl,e,t)},n.prototype.createBufferFromTexture=function(e,t,r){this.bindTextureToFrameBuffer(e);var s=vne(this.gl,this.debug,t,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),s},n.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},n.prototype.createFence=function(e){var t,r,s=this;if(je().getBool("WEBGL_FENCE_API_ENABLED")){var o=e,i=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),r=function(){var a=o.clientWaitSync(i,0,0);return a===o.ALREADY_SIGNALED||a===o.CONDITION_SATISFIED},t=i}else je().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),r=function(){return s.isQueryAvailable(t,je().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:t,isFencePassed:r}},n.prototype.downloadMatrixFromPackedTexture=function(e,t,r){var s=this;return this.downloadMatrixDriver(e,(function(){return Cne(s.gl,s.debug,t,r)}))},n.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,r=ree(t,this.debug,e),s=ane(t,this.debug),o=oee(t,this.debug);return Qt(t,this.debug,(function(){return t.attachShader(o,s)})),Qt(t,this.debug,(function(){return t.attachShader(o,r)})),iee(t,this.debug,o),this.debug&&LC(t,this.debug,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=mne(t,this.debug,this.program,this.vertexBuffer)),o},n.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&Qt(this.gl,this.debug,(function(){return t.gl.deleteProgram(e)}))},n.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&LC(this.gl,this.debug,this.program),Qt(this.gl,this.debug,(function(){return t.gl.useProgram(e)}))},n.prototype.getUniformLocation=function(e,t,r){return r===void 0&&(r=!0),this.throwIfDisposed(),r?hee(this.gl,this.debug,e,t):pee(this.gl,e,t)},n.prototype.getAttributeLocation=function(e,t){var r=this;return this.throwIfDisposed(),Qt(this.gl,this.debug,(function(){return r.gl.getAttribLocation(e,t)}))},n.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},n.prototype.setInputMatrixTexture=function(e,t,r){this.throwIfDisposed(),this.throwIfNoProgram(),mee(this.gl,this.debug,this.program,e,t,r)},n.prototype.setOutputMatrixTexture=function(e,t,r){this.setOutputMatrixTextureDriver(e,r,t)},n.prototype.setOutputPackedMatrixTexture=function(e,t,r){this.throwIfDisposed();var s=t1(t,r),o=s[0],i=s[1];this.setOutputMatrixTextureDriver(e,o,i)},n.prototype.setOutputMatrixWriteRegion=function(e,t,r,s){this.setOutputMatrixWriteRegionDriver(r,e,s,t)},n.prototype.setOutputPackedMatrixWriteRegion=function(e,t,r,s){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},n.prototype.debugValidate=function(){this.program!=null&&LC(this.gl,this.debug,this.program),ev(this.gl)},n.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),Qt(e,this.debug,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))},n.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),Qt(this.gl,this.debug,(function(){return e.gl.finish()}))},n.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Qx(this.gl,this.debug,je().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},n.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},n.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},n.prototype.beginQuery=function(){if(je().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),r=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,r),r}var s=this.getQueryTimerExtensionWebGL1(),o=s.createQueryEXT();return s.beginQueryEXT(s.TIME_ELAPSED_EXT,o),o},n.prototype.endQuery=function(){if(je().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,r=this.getQueryTimerExtensionWebGL2();t.endQuery(r.TIME_ELAPSED_EXT)}},n.prototype.waitForQueryAndGetTime=function(e){return Vt(this,void 0,void 0,(function(){var t=this;return zt(this,(function(r){switch(r.label){case 0:return[4,U9((function(){return t.disposed||t.isQueryAvailable(e,je().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}))];case 1:return r.sent(),[2,this.getQueryTime(e,je().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}}))}))},n.prototype.getQueryTime=function(e,t){if(t===0)return null;if(t===2){var r=this.gl;return r.getQueryParameter(e,r.QUERY_RESULT)/1e6}var s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(e,s.QUERY_RESULT_EXT)/1e6},n.prototype.isQueryAvailable=function(e,t){if(t===0)return!0;if(t===2){var r=this.gl,s=this.getQueryTimerExtensionWebGL2(),o=r.getQueryParameter(e,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(s=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,s.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),o&&!this.disjoint},n.prototype.pollFence=function(e){var t=this;return new Promise((function(r){t.addItemToPoll((function(){return e.isFencePassed()}),(function(){return r()}))}))},n.prototype.pollItems=function(){for(var e=(function(r){for(var s=0;s<r.length&&r[s]();++s);return s-1})(this.itemsToPoll.map((function(r){return r.isDoneFn}))),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},n.prototype.addItemToPoll=function(e,t){var r=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||U9((function(){return r.pollItems(),r.itemsToPoll.length===0}))},n.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),jC(this.gl,this.debug,e,this.framebuffer),this.debug&&ev(this.gl)},n.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(jC(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&ev(this.gl)):Z9(this.gl,this.debug,this.framebuffer)},n.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var r=t();return this.unbindTextureToFrameBuffer(),r},n.prototype.setOutputMatrixTextureDriver=function(e,t,r){this.throwIfDisposed();var s=this.gl;jC(s,this.debug,e,this.framebuffer),this.debug&&ev(s),this.outputTexture=e,Qt(s,this.debug,(function(){return s.viewport(0,0,t,r)})),Qt(s,this.debug,(function(){return s.scissor(0,0,t,r)}))},n.prototype.setOutputMatrixWriteRegionDriver=function(e,t,r,s){var o=this;this.throwIfDisposed(),Qt(this.gl,this.debug,(function(){return o.gl.scissor(e,t,r,s)}))},n.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},n.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},n})();function uT(n,e){if(n.length!==e.length)throw Error("Binary was compiled with "+n.length+" inputs, but was executed with "+e.length+" inputs");n.forEach((function(t,r){var s=t.logicalShape,o=e[r],i=o.shape;if(!eo(s,i))throw Error("Binary was compiled with different shapes than the current args. Shapes "+s+" and "+i+" must match");if(!t.isUniform||!o.isUniform){var a=t.texShape,l=o.isUniform?null:o.texData.texShape;if(!eo(a,l))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+a+" and "+l+" must match")}}))}var Sne=function(n,e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var r=t.filterWidth,s=t.inChannels,o=t.strideWidth,i=t.strideHeight,a=t.padInfo,l=t.outWidth,c=t.dilationWidth,u=t.dilationHeight,d=t.dataFormat,f=a.left,p=a.top,x=s*r,v=Oo(),y=d==="channelsLast",b=y?0:1,w=y?1:2,S="",k=0;k<=1;k++)for(var N=0;N<=1;N++)S+=`
          blockIndex = rc.y + `+N+`;
          pos = rc.x + `+k+`;

          if(blockIndex < `+n[1]+" && pos < "+n[0]+`) {
            offsetY = int(blockIndex / (`+l+")) * "+i+" - "+p+`;
            d0 = offsetY + `+u+" * (pos / "+x+`);

            if(d0 < `+e[b]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+l+".) * "+o+". - "+f+`.);
              d1 = offsetX + `+c+" * (int(mod(float(pos), "+x+".) / "+s+`.));

              if(d1 < `+e[w]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+s+`.));

                if (`+y+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*k+N)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*k+N)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+S+`

        `+v.output+` = result;
      }
    `},Nne=function(n,e,t,r,s){this.variableNames=["x"],this.outputShape=[];var o,i=e,a=n[3]-1;this.outputShape=n;var l="float("+t+") + float("+r+") * sum";o=s===.5?"inversesqrt("+l+")":s===1?"1.0/("+l+")":"exp(log("+l+") * float(-"+s+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+i+"; j <= "+i+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+a+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+o+`;
        setOutput(val);
      }
    `},Ene=function(n,e,t,r,s){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=n,this.depth=n[3],this.depthRadius=e,this.bias=t,this.alpha=r,this.beta=s,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+e+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+e+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+r+") * norm + float("+t+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+r+`)
                * float(`+s+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+s+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `},Ine=function(n,e,t,r,s){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o,i=e,a=n[3]-1;this.outputShape=n;var l="float("+t+") + float("+r+") * sum";o=s===.5?"inversesqrt("+l+")":s===1?"1.0/("+l+")":"exp(log("+l+") * float(-"+s+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+i+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+i+"; j <= "+i+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+a+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+o+`;
        setOutput(result);
      }
    `},Tne=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var e=n.strideHeight,t=n.strideWidth,r=n.dilationHeight,s=n.effectiveFilterHeight,o=n.effectiveFilterWidth,i=s-1-n.padInfo.top,a=o-1-n.padInfo.left,l=s*o-1;this.userCode=`
      const ivec2 pads = ivec2(`+i+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+s+`;
          wR += `+r+`) {
          float dyR = float(dyRCorner + wR) / `+e+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+o+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+t+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+l+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+o+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `},_ne=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var e=n.strideDepth,t=n.strideHeight,r=n.strideWidth,s=n.dilationDepth,o=n.dilationHeight,i=n.dilationWidth,a=n.effectiveFilterDepth,l=n.effectiveFilterHeight,c=n.effectiveFilterWidth,u=a-1-n.padInfo.front,d=l-1-n.padInfo.top,f=c-1-n.padInfo.left,p=a*l*c-1;this.userCode=`
      const ivec3 pads = ivec3(`+u+", "+d+", "+f+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+a+`;
           wD += `+s+`) {
          float dyD = float(dyDCorner + wD) / `+e+`.0;

          if (dyD < 0.0 || dyD >= `+n.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+l+`;
              wR += `+o+`) {
            float dyR = float(dyRCorner + wR) / `+t+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+c+`;
                wC += `+i+`) {
              float dyC = float(dyCCorner + wC) / `+r+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+p+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+l+" * "+c+` +
                  wR * `+c+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `},UC=function(n,e,t,r,s,o,i){t===void 0&&(t=!1),r===void 0&&(r=!1),s===void 0&&(s=!1),o===void 0&&(o=null),i===void 0&&(i=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;var a=t?n[1]:n[2],l=Math.ceil(a/2),c=t?"i * 2, rc.y":"rc.y, i * 2",u=r?"rc.z, i * 2":"i * 2, rc.z",d=t?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],p="",x="";o&&(p=i?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+o+`
        }`:`vec4 activation(vec4 x) {
          `+o+`
        }`,x="result = activation(result);");var v=s?"result += getBiasAtOutCoords();":"";s&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+p+`

      const float sharedDimension = `+l+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+l+`; i++) {
          vec4 a = getMatrixA(rc.x, `+c+`);
          vec4 b = getMatrixB(rc.x, `+u+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+d[0]+" * "+f[0]+`);
          result += (`+d[1]+" * "+f[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+v+`

        `+x+`

        setOutput(result);
      }
    `},Rne=(function(){function n(e,t,r){this.variableNames=["probs"],this.outputShape=[e,r],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(t-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(t-1)+`));
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;return function(r,s){t.seedLoc==null&&(t.seedLoc=r.getUniformLocation(s,"seed")),r.gl.uniform1f(t.seedLoc,e)}},n})(),Dne=function(n,e,t,r){this.variableNames=["indices"],this.outputShape=[n,e],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+r+"), float("+t+`),
                      float(index == coords.y)));
      }
    `},Ane=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=n;var e=n.length;if(e===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var t=bi("rc",e),r=$r(e),s=(function(a,l,c){if(a===1)return"rc > "+l[0];for(var u="",d=a-2;d<a;d++)u+=c[d]+" >= "+l[d],d<a-1&&(u+="||");return u})(e,n,t),o=(function(a,l,c,u){if(a===1)return"";var d=u.slice(-2);return`
    int r = `+d[0]+`;
    int c = `+d[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+l+`;
    bool rEdge = rp1 >= `+c+`;
  `})(e,n[n.length-1],n[n.length-2],t),i=(function(a,l){var c=a.length,u=(function(d,f){for(var p=[],x=0;x<=1;x++)for(var v=0;v<=1;v++){for(var y=(x===0?"r":"rp1")+", "+(v===0?"c":"cp1"),b=2;b<d;b++)y=f[f.length-1-b]+","+y;p.push(y)}return p})(c,l);return c===1?`getA(rc),
            rc + 1 >= `+a[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+u[0]+`),
          cEdge ? 0. : getA(`+u[1]+`),
          rEdge ? 0. : getA(`+u[2]+`),
          rEdge || cEdge ? 0. : getA(`+u[3]+")"})(n,t);this.userCode=`
        void main() {
          `+r+` rc = getOutputCoords();

          if(`+s+`) {
            setOutput(vec4(0));
          } else {
            `+o+`

            setOutput(vec4(`+i+`));
          }
        }
      `}},$ne=function(n,e,t){this.variableNames=["x"],this.outputShape=e.map((function(l,c){return l[0]+n[c]+l[1]}));var r=n.length,s=$r(r),o=e.map((function(l){return l[0]})).join(","),i=e.map((function(l,c){return l[0]+n[c]})).join(","),a=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=r!==1?`
      `+s+" start = "+s+"("+o+`);
      `+s+" end = "+s+"("+i+`);

      void main() {
        `+s+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+t+`));
        } else {
          `+s+` coords = outC - start;
          setOutput(getX(`+a+`));
        }
      }
    `:`
        int start = `+o+`;
        int end = `+i+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+t+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `},Fne=function(n,e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map((function(y,b){return y[0]+n[b]+y[1]}));for(var r=n.length,s=$r(r),o=e.map((function(y){return y[0]})).join(","),i=e.map((function(y,b){return y[0]+n[b]})).join(","),a=bi("rc",r),l=bi("source",r),c=a[r-1]+" < "+this.outputShape[r-1],u=r===1?"source":"vec2("+l.slice(-2).join()+")",d=[s+" rc = outputLoc;",a[r-1]+` += 1;
       if(`+c+`) {
      `,r===1?"":`}
       rc = outputLoc;
       `+a[r-2]+` += 1;
       if(`+a[r-2]+" < "+this.outputShape[r-2]+") {",r===1?"":"  "+a[r-1]+` += 1;
         if(`+c+") {"],f=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",p="",x=0,v=r===1?2:4;x<v;x++)p+=`
        `+d[x]+`
        if (`+f+`) {
          result[`+x+"] = float("+t+`);
        } else {
          `+s+` source = rc - start;
          result[`+x+"] = getChannel(getX("+l.join()+"), "+u+`);
        }
      `;p+=r===1?"} ":"}}",this.userCode=`
      const `+s+" start = "+s+"("+o+`);
      const `+s+" end = "+s+"("+i+`);

      void main() {
        `+s+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+p+`
        setOutput(result);
      }
    `},HC=function(n,e,t){if(this.variableNames=["x"],e==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var r=n.filterWidth,s=n.strideHeight,o=n.strideWidth,i=n.dilationHeight,a=n.dilationWidth,l=n.effectiveFilterHeight,c=n.effectiveFilterWidth,u=n.padInfo.top,d=n.padInfo.left;this.outputShape=n.outShape;var f=e==="avg",p="0.0";if(f||(p="-1.0 / 1e-20"),t)this.userCode=`
        const ivec2 strides = ivec2(`+s+", "+o+`);
        const ivec2 pads = ivec2(`+u+", "+d+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+l+`;
              wR += `+i+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+c+`;
                wC += `+a+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+c+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var x=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(x="avgValue / count");var v=4*Math.floor(r/4),y=r%4,b=`
      if (`+f+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+s+", "+o+`);
      const ivec2 pads = ivec2(`+u+", "+d+`);
      const float initializationValue = `+p+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+n.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+p+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+l+`;
            wR += `+i+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+n.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+v+`; wC += 4) {
            int xC = xCCorner + wC * `+a+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+a+`, d),
              getValue(batch, xR, xC + 2 * `+a+`, d),
              getValue(batch, xR, xC + 3 * `+a+`, d)
            );

            `+b+`
          }

          int xC = xCCorner + `+v+`;
          if (`+(y===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+b+`
          } else if (`+(y===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+a+`, d),
              initializationValue,
              initializationValue
            );

            `+b+`
          } else if (`+(y===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+a+`, d),
              getValue(batch, xR, xC + 2 * `+a+`, d),
              initializationValue
            );

            `+b+`
          }
        }
        setOutput(`+x+`);
      }
    `}},GC=function(n,e,t){if(this.variableNames=["x"],e==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var r=n.filterWidth,s=n.strideDepth,o=n.strideHeight,i=n.strideWidth,a=n.dilationDepth,l=n.dilationHeight,c=n.dilationWidth,u=n.effectiveFilterDepth,d=n.effectiveFilterHeight,f=n.effectiveFilterWidth,p=n.padInfo.front,x=n.padInfo.top,v=n.padInfo.left;this.outputShape=n.outShape;var y=e==="avg",b="0.0";if(y||(b="-1.0 / 1e-20"),t)this.userCode=`
        const ivec3 strides =
            ivec3(`+s+", "+o+", "+i+`);
        const ivec3 pads = ivec3(`+p+", "+x+", "+v+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+u+`;
              wD += `+a+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+n.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+d+`;
                wR += `+l+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+n.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+f+`;
                  wC += `+c+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+n.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition =
                      wD * `+d+" * "+f+` +
                      wR * `+f+` + wC;;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var w=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(w="avgValue / count");var S=4*Math.floor(r/4),k=r%4,N=`
      if (`+y+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+s+", "+o+", "+i+`);
      const ivec3 pads = ivec3(`+p+", "+x+", "+v+`);
      const float initializationValue = `+b+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+n.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+b+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+u+`;
            wD += `+a+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+n.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+d+`;
            wR += `+l+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+S+`; wC += 4) {
              int xC = xCCorner + wC * `+c+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+c+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+c+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+c+`, ch)
              );

              `+N+`
            }

            int xC = xCCorner + `+S+`;
            if (`+(k===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+N+`
            } else if (`+(k===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+c+`, ch),
                initializationValue,
                initializationValue
              );

              `+N+`
            } else if (`+(k===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+c+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+c+`, ch),
                initializationValue
              );

              `+N+`
            }
          }
          setOutput(`+w+`);
        }
      }
    `}},Pne=function(n,e){this.variableNames=["x"];var t=n.windowSize,r=n.batchSize,s=n.inSize,o=Math.ceil(s/t);this.outputShape=[r,o];var i="0.0",a="";e==="prod"?i="1.0":e==="min"?(i="1.0 / 1e-20",a="min"):e==="max"&&(i="-1.0 / 1e-20",a="max");var l=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="sum"?l="sumValue":e==="prod"?l="prodValue":e==="all"?l="allValue":e==="any"&&(l="anyValue");var c=4*Math.floor(t/4),u=t%4,d=`
      if (`+(e==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(e==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+a+`(values, minMaxValue);
      }
    `,f="vec4";e==="all"?(i="1.0",d=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,f="bvec4"):e==="any"&&(i="0.0",d=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,f="bvec4");var p="";s%t>0&&(p=`
        if (inIdx < 0 || inIdx >= `+s+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+i+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+p+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+t+`;

        vec4 minMaxValue = vec4(`+i+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+c+`; i += 4) {
          int inIdx = inOffset + i;
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+d+`
        }

        int inIdx = inOffset + `+c+`;
        if (`+(u===1)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+d+`
        } else if (`+(u===2)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+d+`
        } else if (`+(u===3)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+d+`
        }
        setOutput(`+l+`);
      }
    `},One=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var t="",r=0;r<4;r++){var s="thisRC = rc;";r%2==1&&(s+="thisRC.z += 1;"),r>1&&(s+="thisRC.y += 1;"),t+=`
        `+s+`
        `+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+r+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(r>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+lf(["r","c","d"],e)+`
      return ivec3(r, c, d);
    }
  
      `+o6(n)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+n[1]+`;
        int cols = `+n[2]+`;

        `+t+`

        setOutput(result);
      }
    `},Mne=function(n,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,s=r[1],o=r[2],i=n.shape,a=i[1],l=i[2],c=[t&&a>1?s-1:s,t&&l>1?o-1:o],u=[t&&a>1?a-1:a,t&&l>1?l-1:l],d=c[0]/u[0],f=c[1]/u[1],p=1/d,x=1/f,v=2*Math.ceil(p)+2,y=2*Math.ceil(x)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+d+`);
        const float widthScale = float(`+f+`);

        const float invHeightScale = float(`+p+`);
        const float invWidthScale = float(`+x+`);

        const int winHeight = int(`+v+`);
        const int winWidth = int(`+y+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+a+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+l+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(s-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(o-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},Lne=function(n,e,t,r){this.variableNames=["A"],this.outputShape=[];var s=n[0],o=n[1],i=n[2],a=n[3];this.outputShape=[s,e,t,a];var l=[r&&e>1?o-1:o,r&&t>1?i-1:i],c=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+l[0]/c[0]+`,
          `+l[1]/c[1]+`);
      const vec2 inputShapeRC = vec2(`+o+".0, "+i+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `},jne=function(n,e,t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var s=n[0],o=n[1],i=n[2],a=n[3];this.outputShape=[s,e,t,a];var l=[r&&e>1?o-1:o,r&&t>1?i-1:i],c=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+l[0]/c[0]+`,
          `+l[1]/c[1]+`,
          `+l[1]/c[1]+`);
      const vec3 inputShapeRC = vec3(`+o+".0, "+i+`.0,
                                     `+i+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(a-1)+`;
        bool hasNextRow = coords.z < `+(t-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `},Bne=function(n,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,s=r[1],o=r[2],i=n.shape,a=i[1],l=i[2],c=[t&&a>1?s-1:s,t&&l>1?o-1:o],u=[t&&a>1?a-1:a,t&&l>1?l-1:l],d=c[0]/u[0],f=c[1]/u[1],p=1/d,x=1/f,v=2*Math.ceil(p)+2,y=2*Math.ceil(x)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+d+`);
        const float widthScale = float(`+f+`);

        const float invHeightScale = float(`+p+`);
        const float invWidthScale = float(`+x+`);

        const int winHeight = int(`+v+`);
        const int winWidth = int(`+y+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+a+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+l+`) {
              continue;
            }

            float sourceFracRow =
              float(`+c[0]+`) *
                (float(dyR) / float(`+u[0]+`));

            float sourceFracCol =
                float(`+c[1]+`) *
                  (float(dyC) / float(`+u[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+s+`) - 1),
                `+t+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+o+`) - 1),
                `+t+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},Vne=function(n,e,t,r){this.variableNames=["A"],this.outputShape=[];var s=n[0],o=n[1],i=n[2],a=n[3];this.outputShape=[s,e,t,a];var l=[r&&e>1?o-1:o,r&&t>1?i-1:i],c=[r&&e>1?e-1:e,r&&t>1?t-1:t],u=r?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+l[0]/c[0]+`,
          `+l[1]/c[1]+`);
      const vec2 inputShapeRC = vec2(`+o+".0, "+i+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+u+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `},zne=function(n,e){this.variableNames=["x"];var t=n.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");if(this.outputShape=n,t!==1){var r=n.map((function(o,i){return(function(a){return e.indexOf(a)!==-1&&n[a]!==1?n[a]+" - coords["+a+"] - 1":"coords["+a+"]"})(i)})).join(","),s=$r(t);this.userCode=`
      void main() {
        `+s+` coords = getOutputCoords();
        setOutput(getX(`+r+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+n[0]+` - coord - 1));
        }
      `},Wne=function(n,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var t=n.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");this.outputShape=n;var r=bi("rc",t),s=r[t-1]+" + 1 < "+this.outputShape[t-1],o=r[t-2]+" + 1 < "+this.outputShape[t-2],i=$r(t);function a(l){var c=n.map((function(u,d){return(function(f,p){return e.indexOf(f)!==-1&&n[f]!==1?n[f]+" - "+p[f]+" - 1":""+p[f]})(d,l)}));return"getChannel(getX("+c.join(",")+"), vec2("+c.slice(-2).join(",")+"))"}this.userCode=t===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+n[0]+` - rc - 1),
            `+n[0]+` - rc - 1);
          if(`+s+`){
              result.g = getChannel(getX(`+n[0]+` - (rc  + 1) - 1),
                `+n[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+i+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+(function(l){return a(l)})(r.slice())+`;
          if(`+s+`){
            result.g = `+(function(l){return l[t-1]="("+l[t-1]+" + 1)",a(l)})(r.slice())+`;
          }
          if(`+o+`) {
            result.b = `+(function(l){return l[t-2]="("+l[t-2]+" + 1)",a(l)})(r.slice())+`;
            if(`+s+`) {
              result.a = `+(function(l){return l[t-1]="("+l[t-1]+" + 1)",l[t-2]="("+l[t-2]+" + 1)",a(l)})(r.slice())+`;
            }
          }
          setOutput(result);
        }
    `},dT=function(n,e,t,r,s,o,i){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var a=$r(s.length),l=$r(o.length),c="";t===1?c="i":t===2&&(c="i, j");var u="getIndices("+c+")",d="";r===1?d="i":r===2&&(d="i, coords[1]");var f="getUpdates("+d+")",p=e>1?"strides[j]":"strides";this.userCode=`
        `+a+" strides = "+a+"("+s+`);

        void main() {
          `+l+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+n+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+e+`; j++) {
              int index = round(`+u+`);
              flattenedIndex += index * `+p+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+f+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},Une=function(n,e){this.variableNames=["x","segmentIds"];var t=n.windowSize,r=n.batchSize,s=n.inSize,o=n.numSegments,i=o*Math.ceil(s/t);this.outputShape=[r,i];var a=4*Math.floor(t/4),l=t%4,c=`
        sumValue += dot(values, segFilter);
    `,u="";s%t>0&&(u=`
        if (inIdx < 0 || inIdx >= `+s+`) {
          return initializationValue;
        }
      `);var d="";s%t>0&&(d=`
        if (inIdx < 0 || inIdx >= `+s+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+u+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+d+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+o+")) * float("+t+`));
        int currentSeg = int(mod(float(outIdx), float(`+o+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+a+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+c+`
        }

        int inIdx = inOffset + `+a+`;
        if (`+(l===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+c+`
        } else if (`+(l===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+c+`
        } else if (`+(l===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+c+`
        }
        setOutput(sumValue);
      }
    `},Hne=function(n,e,t){var r,s;if(this.variableNames=["c","a","b"],this.outputShape=e,t>4)throw Error("Where for rank "+t+" is not yet supported");if(t===1)s="resRC",r="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],a=[],l=0;l<e.length;l++)a.push(""+o[l]),l<n&&i.push(""+o[l]);r=i.join(),s=a.join()}var c=$r(t);this.userCode=`
      void main() {
        `+c+` resRC = getOutputCoords();
        float cVal = getC(`+r+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+s+`));
        } else {
          setOutput(getB(`+s+`));
        }
      }
    `},Gne=(function(){function n(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,r=$r(this.rank),s="uniform int start["+this.rank+"];",o=(function(i){if(i===1)return"sourceLoc";if(i<=6)return qC.slice(0,i).map((function(a){return"sourceLoc."+a})).join(",");throw Error("Slicing for rank "+i+" is not yet supported")})(this.rank);t=`
        `+r+` sourceLoc;
        `+r+` coords = getOutputCoords();
        `+e.map((function(i,a){return"sourceLoc."+qC[a]+" = start["+a+"] + coords."+qC[a]+";"})).join(`
`)+`
      `,this.userCode=`
      `+s+`
      void main() {
        `+t+`
        setOutput(getSource(`+o+`));
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,s){t.startLoc==null&&(t.startLoc=r.getUniformLocationNoThrow(s,"start"),t.startLoc==null)||r.gl.uniform1iv(t.startLoc,e)}},n})(),qC=["x","y","z","w","u","v"],qne=(function(){function n(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var t=$r(this.rank),r=bi("coords",this.rank),s=bi("sourceLoc",this.rank),o=this.rank===1?"sourceLoc":"vec2("+s.slice(-2).join()+")",i="getChannel(getSource("+s.join()+"), "+o+")",a=`
      result.x = `+i+`;
      if (++`+r[this.rank-1]+" < "+e[this.rank-1]+`) {
        ++`+s[this.rank-1]+`;
        result.y = `+i+`;
        --`+s[this.rank-1]+`;
      }
    `,l=this.rank===1?"":`
      --`+r[this.rank-1]+`;
      if (++`+r[this.rank-2]+" < "+e[this.rank-2]+`) {
        ++`+s[this.rank-2]+`;
        result.z = `+i+`;
        if (++`+r[this.rank-1]+" < "+e[this.rank-1]+`) {
          ++`+s[this.rank-1]+`;
          result.w = `+i+`;
        }
      }
    `,c=this.rank<=4?`sourceLoc = coords +
            `+t+"("+e.map((function(u,d){return"start["+d+"]"})).join()+");":e.map((function(u,d){return s[d]+" = "+r[d]+" + start["+d+"];"})).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+t+` coords = getOutputCoords();
        `+t+` sourceLoc;
        `+c+`
        vec4 result = vec4(0.);
        `+a+`
        `+l+`
        setOutput(result);
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,s){t.startLoc==null&&(t.startLoc=r.getUniformLocationNoThrow(s,"start"),t.startLoc==null)||r.gl.uniform1iv(t.startLoc,e)}},n})(),Kne=function(n,e,t){this.variableNames=["x"],this.outputShape=t;var r=t.length,s=$r(t.length),o=$r(t.length),i="";if(r===1)i="coords * strides + begin";else{var a=0;i=t.map((function(l,c){return a++,t.length===1?"coords * strides["+c+"] + begin["+c+"]":"coords["+(a-1)+"] * strides["+c+"] + begin["+c+"]"})).join(",")}this.userCode=`
      `+s+" begin = "+s+"("+n+`);
      `+s+" strides = "+s+"("+e+`);

      void main() {
        `+o+` coords = getOutputCoords();
        setOutput(getX(`+i+`));
      }
    `},Xne=(function(){function n(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return n.prototype.acquireTexture=function(e,t,r){var s,o=fT(t,r),i=hT(e,o,r);if(i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]),this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var a=this.freeTextures[i].shift();return this.usedTextures[i].push(a),a}return this.numUsedTextures++,this.log(),o===Ui.PACKED_2X2_FLOAT32?s=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):o===Ui.PACKED_2X2_FLOAT16?s=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):o===Ui.UNPACKED_FLOAT32?s=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):o===Ui.UNPACKED_FLOAT16?s=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):o===Ui.PACKED_4X1_UNSIGNED_BYTE&&(s=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(s),s},n.prototype.releaseTexture=function(e,t,r,s){if(this.freeTextures!=null){var o=hT(t,fT(r,s),s);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(e),this.numFreeTextures++,this.numUsedTextures--;var i=this.usedTextures[o],a=i.indexOf(e);if(a<0)throw new Error("Cannot release a texture that was never provided by this texture manager");i.splice(a,1),this.log()}},n.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},n.prototype.getNumUsedTextures=function(){return this.numUsedTextures},n.prototype.getNumFreeTextures=function(){return this.numFreeTextures},n.prototype.dispose=function(){var e=this;if(this.freeTextures!=null){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(r){e.gpgpu.deleteMatrixTexture(r)}));for(var t in this.usedTextures)this.usedTextures[t].forEach((function(s){e.gpgpu.deleteMatrixTexture(s)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},n})();function fT(n,e){if(n===Ki.UPLOAD)return Ui.PACKED_2X2_FLOAT32;if(n===Ki.RENDER||n==null)return(function(t){return je().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?Ui.PACKED_2X2_FLOAT32:Ui.UNPACKED_FLOAT32:t?Ui.PACKED_2X2_FLOAT16:Ui.UNPACKED_FLOAT16})(e);if(n===Ki.DOWNLOAD||n===Ki.PIXELS)return Ui.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+n)}function hT(n,e,t){return n[0]+"_"+n[1]+"_"+e+"_"+t}var Yne=function(n,e){this.variableNames=["A"];for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[r]*e[r];this.outputShape=t,this.rank=t.length;var s=$r(this.rank),o=(function(i){var a=i.length;if(a>5)throw Error("Tile for rank "+a+" is not yet supported");if(a===1)return"imod(resRC, "+i[0]+")";for(var l=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],c=[],u=0;u<i.length;u++)c.push("imod("+l[u]+", "+i[u]+")");return c.join()})(n);this.userCode=`
      void main() {
        `+s+` resRC = getOutputCoords();
        setOutput(getA(`+o+`));
      }
    `},Zne=function(n,e){this.variableNames=["A"];for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[e[r]];this.outputShape=t,this.rank=t.length;var s=$r(this.rank),o=(function(i){var a=i.length;if(a>6)throw Error("Transpose for rank "+a+" is not yet supported");for(var l=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],c=new Array(a),u=0;u<i.length;u++)c[i[u]]=l[u];return c.join()})(e);this.userCode=`
    void main() {
      `+s+` resRC = getOutputCoords();
      setOutput(getA(`+o+`));
    }
    `},Jne=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[e[r]];if(this.outputShape=t,this.rank=t.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var s=$r(this.rank),o=bF("rc",this.rank),i=new Array(this.rank);for(r=0;r<e.length;r++)i[e[r]]=o[r];var a="vec2("+i.slice(-2).join()+")",l="++"+o[this.rank-1]+" < "+t[this.rank-1],c="getChannel(getA("+i.join()+"), "+a+")";this.userCode=`
    void main() {
      `+s+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+c+`;
      if(`+l+`) {
        result[1] = `+c+`;
      }
      --`+o[this.rank-1]+`;
      if(++`+o[this.rank-2]+" < "+t[this.rank-2]+`) {
        result[2] = `+c+`;
        if(`+l+`) {
          result[3] = `+c+`;
        }
      }
      setOutput(result);
    }
    `},i6=1.7580993408473768,a6=1.0507009873554805,Dn=function(n,e){this.variableNames=["A"],this.outputShape=n,this.userCode=`
      float unaryOperation(float x) {
        `+e+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},gl="if (isnan(x)) return x;",Qne="return x;",pT="return abs(x);",NF=gl+`
  return (x < 0.0) ? 0.0 : x;
`,EF=gl+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,IF="return (x >= 0.0) ? x : (exp(x) - 1.0);",ere=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+i6+`;
  float scale = `+a6+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,mT="return -x;",gT="return ceil(x);",xT="return floor(x);",vT="return exp(x);",yT="return exp(x) - 1.0;",tre=gl+`
  return sin(x);
`,nre=gl+`
  return cos(x);
`,rre=gl+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,sre=gl+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,ore=gl+`
  return atan(x);
`,ire=gl+"return log(x + sqrt(x * x + 1.0));",are=gl+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,lre=gl+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,sv="return x;",cre="return x;",TF=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,_F=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,RF=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Km=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+e+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},ure=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=n;var e=n.length,t=bi("rc",e),r=$r(e),s=(function(a,l){if(a===1)return"rc";for(var c="",u=0;u<a;u++)c+=l[u],u<a-1&&(c+=",");return c})(e,t),o=t.slice(-2),i=e<=1?"rc":"vec2("+o.join(",")+")";this.userCode=`
      void main() {
        `+r+` rc = getOutputCoords();
        vec4 packedInput = getA(`+s+`);

        setOutput(getChannel(packedInput, `+i+`));
      }
    `},ov={};function iv(n,e){if(e===void 0&&(e=!1),n==="linear")return e?cre:Qne;if(n==="relu")return e?TF:NF;if(n==="elu")return e?RF:IF;if(n==="relu6")return e?_F:EF;if(n==="prelu")return e?SF:kF;throw new Error("Activation "+n+" has not been implemented for the WebGL backend.")}var dre=600,fre=(function(n){function e(t){var r,s=n.call(this)||this;if(s.pendingRead=new WeakMap,s.pendingDisposal=new WeakSet,s.dataRefCount=new WeakMap,s.numBytesInGPU=0,s.uploadWaitMs=0,s.downloadWaitMs=0,s.warnedAboutMemory=!1,s.pendingDeletes=0,s.disposed=!1,!je().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(t==null){var o=pc(je().getNumber("WEBGL_VERSION"));s.binaryCache=((r=je().getNumber("WEBGL_VERSION"))in ov||(ov[r]={}),ov[r]),s.gpgpu=new kne(o),s.canvas=o.canvas,s.gpgpuCreatedLocally=!0}else s.gpgpu=t,s.binaryCache={},s.gpgpuCreatedLocally=!1,s.canvas=t.gl.canvas;return s.textureManager=new Xne(s.gpgpu),s.numMBBeforeWarning=je().global.screen==null?1024:je().global.screen.height*je().global.screen.width*window.devicePixelRatio*dre/1024/1024,s.texData=new dF(s,ge),s}return ml(e,n),e.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},e.prototype.write=function(t,r,s){if(je().getBool("DEBUG")&&this.checkNumericalProblems(t),s==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var o={};return this.texData.set(o,{shape:r,dtype:s,values:t,usage:Ki.UPLOAD}),o},e.prototype.move=function(t,r,s,o){if(je().getBool("DEBUG")&&this.checkNumericalProblems(r),o==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:s,dtype:o,values:r,usage:Ki.UPLOAD})},e.prototype.readSync=function(t){var r=this.texData.get(t),s=r.values,o=r.dtype,i=r.complexTensors,a=r.slice,l=r.shape,c=r.isPacked;if(a!=null){var u=void 0;u=c?new Km(l,sv):new Dn(l,sv);var d=this.runWebGLProgram(u,[{dataId:t,shape:l,dtype:o}],o),f=this.readSync(d.dataId);return this.disposeData(d.dataId),f}if(s!=null)return this.convertAndCacheOnCPU(t);if(o==="string")return s;var p,x,v=this.activeTimers!=null;return v&&(p=Ml()),o==="complex64"?x=x5(i.real.dataSync(),i.imag.dataSync()):x=this.getValuesFromTexture(t),v&&(this.downloadWaitMs+=Ml()-p),this.convertAndCacheOnCPU(t,x)},e.prototype.read=function(t){return Vt(this,void 0,void 0,(function(){var r,s,o,i,a,l,c,u,d,f,p,x,v,y,b,w,S,k,N,I,T,F;return zt(this,(function(R){switch(R.label){case 0:if(this.pendingRead.has(t))return r=this.pendingRead.get(t),[2,new Promise((function(D){return r.push(D)}))];if(s=this.texData.get(t),o=s.values,i=s.shape,a=s.slice,l=s.dtype,c=s.complexTensors,u=s.isPacked,a!=null)return d=void 0,d=u?new Km(i,sv):new Dn(i,sv),f=this.runWebGLProgram(d,[{dataId:t,shape:i,dtype:l}],l),p=this.read(f.dataId),this.disposeData(f.dataId),[2,p];if(o!=null)return[2,this.convertAndCacheOnCPU(t)];if(!je().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&je().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return x=null,l!=="complex64"&&je().get("WEBGL_BUFFER_SUPPORTED")&&(v=this.decode(t),y=this.texData.get(v.dataId),x=(F=this.gpgpu).createBufferFromTexture.apply(F,[y.texture].concat(dg(i)))),this.pendingRead.set(t,[]),l==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:R.sent(),R.label=2;case 2:return l!=="complex64"?[3,4]:[4,Promise.all([c.real.data(),c.imag.data()])];case 3:return w=R.sent(),S=w[0],k=w[1],b=x5(S,k),[3,5];case 4:x==null?b=this.getValuesFromTexture(t):(N=Xt(i),b=this.gpgpu.downloadFloat32MatrixFromBuffer(x,N)),R.label=5;case 5:return v!=null&&this.disposeData(v.dataId),I=this.convertAndCacheOnCPU(t,b),T=this.pendingRead.get(t),this.pendingRead.delete(t),T.forEach((function(D){return D(I)})),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),[2,I]}}))}))},e.prototype.checkNumericalProblems=function(t){if(t!=null)for(var r=0;r<t.length;r++){var s=t[r];if(!eee(s))throw je().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+s+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+s+" cannot be represented on this device.")}},e.prototype.getValuesFromTexture=function(t){var r,s=this.texData.get(t),o=s.shape,i=s.dtype,a=s.isPacked,l=Xt(o);if(je().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var c=this.decode(t),u=this.texData.get(c.dataId),d=(r=this.gpgpu).downloadMatrixFromPackedTexture.apply(r,[u.texture].concat(dg(o))).subarray(0,l);return this.disposeData(c.dataId),d}var f=je().getBool("WEBGL_PACK")&&a===!0,p=f?BC(o):o,x=f?new Qte(p):new Jte(p),v=this.runWebGLProgram(x,[{shape:p,dtype:i,dataId:t}],"float32"),y=this.texData.get(v.dataId),b=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(y.texture,y.texShape[0],y.texShape[1]).subarray(0,l);return this.disposeData(v.dataId),b},e.prototype.time=function(t){return Vt(this,void 0,void 0,(function(){var r,s,o,i,a,l,c;return zt(this,(function(u){switch(u.label){case 0:return r=this.activeTimers,s=[],o=!1,this.programTimersStack==null?(this.programTimersStack=s,o=!0):this.activeTimers.push(s),this.activeTimers=s,t(),i=Np(this.activeTimers.map((function(d){return d.query}))).filter((function(d){return d!=null})),a=Np(this.activeTimers.map((function(d){return d.name}))).filter((function(d){return d!=null})),this.activeTimers=r,o&&(this.programTimersStack=null),l={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},je().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(i)]:[3,2];case 1:return c=u.sent(),l.kernelMs=FQ(c),l.getExtraProfileInfo=function(){return c.map((function(d,f){return{name:a[f],ms:d}})).map((function(d){return d.name+": "+d.ms})).join(", ")},[3,3];case 2:l.kernelMs={error:"WebGL query timers are not supported in this environment."},u.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,l]}}))}))},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},e.prototype.startTimer=function(){return je().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Ml(),endMs:null}},e.prototype.endTimer=function(t){return je().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=Ml(),t)},e.prototype.getQueryTime=function(t){return Vt(this,void 0,void 0,(function(){var r;return zt(this,(function(s){return je().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(r=t).endMs-r.startMs]}))}))},e.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t)){if(this.pendingRead.has(t))return this.pendingDisposal.add(t),void this.pendingDeletes++;if(this.texData.has(t)){this.releaseGPUData(t);var r=this.texData.get(t).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.texData.delete(t)}}},e.prototype.releaseGPUData=function(t){var r=this.texData.get(t),s=r.texture,o=r.dtype,i=r.texShape,a=r.usage,l=r.isPacked,c=r.slice,u=c&&c.origDataId||t,d=this.dataRefCount.get(u);d>1?this.dataRefCount.set(u,d-1):(this.dataRefCount.delete(u),s!=null&&(this.numBytesInGPU-=this.computeBytes(i,o),this.textureManager.releaseTexture(s,i,a,l)));var f=this.texData.get(t);f.texture=null,f.texShape=null,f.isPacked=!1,f.slice=null},e.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},e.prototype.getDataInfo=function(t){return this.texData.get(t)},e.prototype.getCPUBackend=function(){return je().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=ge.findBackend("cpu")),this.cpuBackend):null},e.prototype.shouldExecuteOnCPU=function(t,r){var s=this;return r===void 0&&(r=128),this.getCPUBackend()!=null&&t.every((function(o){return s.texData.get(o.dataId).texture==null&&o.size<r}))},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.complex=function(t,r){var s=this.makeOutput(t.shape,"complex64");return this.texData.get(s.dataId).complexTensors={real:ge.keep(t.clone()),imag:ge.keep(r.clone())},s},e.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,r,s){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,r,s);if(Xt(s)===0)return ho([],s,t.dtype);var o=this.texData.get(t.dataId).isPacked,i=cF(t.shape,r,s);if(o||!i){var a=je().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new qne(s):new Gne(s),l=a.getCustomSetupFunc(r);return this.compileAndRun(a,[t],null,l)}return this.uploadToGPU(t.dataId),this.shallowSlice(t,r,s)},e.prototype.shallowSlice=function(t,r,s){var o=this.texData.get(t.dataId),i=this.makeOutput(s,t.dtype),a=this.texData.get(i.dataId);Object.assign(a,o),a.shape=s,a.dtype=t.dtype;var l=uF(r,t.strides);o.slice&&(l+=o.slice.flatOffset),a.slice={flatOffset:l,origDataId:o.slice&&o.slice.origDataId||t.dataId};var c=this.dataRefCount.get(a.slice.origDataId)||1;return this.dataRefCount.set(a.slice.origDataId,c+1),i},e.prototype.stridedSlice=function(t,r,s,o){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,r,s,o);var i=e6(r,s,o);if(i.some((function(l){return l===0})))return ho([],i);var a=new Kne(r,o,i);return this.compileAndRun(a,[t])},e.prototype.reverse=function(t,r){var s=je().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Wne(t.shape,r):new zne(t.shape,r);return this.compileAndRun(s,[t])},e.prototype.concat=function(t,r){if(t[0].dtype==="complex64"){var s=t.map((function(p){return Sa(p)})),o=t.map((function(p){return Ul(p)}));return uo(this.concat(s,r),this.concat(o,r))}if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,r);if(t.length===1)return t[0];if(t.length>je().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var i=Math.floor(t.length/2),a=this.concat(t.slice(0,i),r),l=this.concat(t.slice(i),r);return this.concat([a,l],r)}if(je().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].rank>1){var c=new Lte(t.map((function(p){return p.shape})),r);return this.compileAndRun(c,t)}var u=Ip(t.map((function(p){return p.shape})),r),d=t.map((function(p){return p.as2D(-1,Xt(p.shape.slice(r)))})),f=new Mte(d.map((function(p){return p.shape})));return this.compileAndRun(f,d).reshape(u)},e.prototype.neg=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.neg(t);if(je().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,mT,t.dtype);var r=new Dn(t.shape,mT);return this.compileAndRun(r,[t])},e.prototype.batchMatMul=function(t,r,s,o){var i=s?t.shape[2]:t.shape[1],a=o?r.shape[1]:r.shape[2],l=s?t.shape[1]:t.shape[2],c=t.shape[0];if((i===1||a===1)&&l>1e3){s&&(t=t.transpose([0,2,1])),o&&(r=r.transpose([0,2,1]));var u=a===1?t:t.as3D(c,l,1),d=a===1?2:1,f=a===1?r.as3D(c,1,l):r;return this.multiply(u,f).sum(d,!0)}var p=fo(t.dtype,r.dtype),x=new UC(t.shape,[c,i,a],s,o);return this.compileAndRun(x,[t,r],p)},e.prototype.fusedBatchMatMul=function(t){var r=t.a,s=t.b,o=t.transposeA,i=t.transposeB,a=t.bias,l=t.activation,c=t.preluActivationWeights,u=o?r.shape[2]:r.shape[1],d=i?s.shape[1]:s.shape[2],f=r.shape[0],p=fo(r.dtype,s.dtype),x=a!=null,v=c!=null,y=l?iv(l,!0):null,b=new UC(r.shape,[f,u,d],o,i,x,y,v),w=[r,s];return a&&w.push(a),c&&w.push(c),this.compileAndRun(b,w,p)},e.prototype.multiply=function(t,r){if(t.dtype==="complex64"){var s=this.texData.get(t.dataId),o=this.texData.get(r.dataId),i=new rT(Ate,t.shape,r.shape),a=new rT($te,t.shape,r.shape),l=[this.makeComplexComponentTensorInfo(t,s.complexTensors.real),this.makeComplexComponentTensorInfo(t,s.complexTensors.imag),this.makeComplexComponentTensorInfo(r,o.complexTensors.real),this.makeComplexComponentTensorInfo(r,o.complexTensors.imag)],c=this.compileAndRun(i,l),u=this.compileAndRun(a,l),d=this.complex(c,u);return c.dispose(),u.dispose(),d}if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.multiply(t,r);if(je().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,sT,t.dtype);var f=new es(sT,t.shape,r.shape);return this.compileAndRun(f,[t,r],t.dtype)},e.prototype.batchNormalization=function(t,r,s,o,i,a){var l=[t,r,s],c=null;a!=null&&(c=a.shape,l.push(a));var u=null;if(i!=null&&(u=i.shape,l.push(i)),je().getBool("WEBGL_PACK_NORMALIZATION")){var d=new Dte(t.shape,r.shape,s.shape,c,u,o);return this.compileAndRun(d,l)}var f=new Rte(t.shape,r.shape,s.shape,c,u,o);return this.compileAndRun(f,l)},e.prototype.localResponseNormalization4D=function(t,r,s,o,i){var a=je().getBool("WEBGL_PACK_NORMALIZATION")?new Ine(t.shape,r,s,o,i):new Nne(t.shape,r,s,o,i);return this.compileAndRun(a,[t])},e.prototype.LRNGrad=function(t,r,s,o,i,a,l){var c=new Ene(r.shape,o,i,a,l);return this.compileAndRun(c,[r,s,t])},e.prototype.tile=function(t,r){if(t.dtype==="string"){var s=this.readSync(t.dataId).map((function(i){return f2(i)}));return vF(wn(t.shape,t.dtype,s),r)}var o=new Yne(t.shape,r);return this.compileAndRun(o,[t])},e.prototype.pad=function(t,r,s){var o=je().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Fne(t.shape,r,s):new $ne(t.shape,r,s);return this.compileAndRun(o,[t])},e.prototype.transpose=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.transpose(t,r);var s=je().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Jne(t.shape,r):new Zne(t.shape,r);return this.compileAndRun(s,[t])},e.prototype.gather=function(t,r,s){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.gather(t,r,s);var o=new one(t.shape,r.size,s);return this.compileAndRun(o,[t,r])},e.prototype.batchToSpaceND=function(t,r,s){ee(t.rank<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var o=r.reduce((function(d,f){return d*f})),i=v2(t.shape,r,o),a=y2(i.length,r.length),l=b2(t.shape,r,o),c=oF(s,r.length),u=iF(l,s,r.length);return t.reshape(i).transpose(a).reshape(l).slice(c,u)},e.prototype.spaceToBatchND=function(t,r,s){ee(t.rank<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var o=r.reduce((function(f,p){return f*p})),i=[[0,0]];i.push.apply(i,s);for(var a=1+r.length;a<t.shape.length;++a)i.push([0,0]);var l=t.pad(i),c=v2(l.shape,r,o,!1),u=y2(c.length,r.length,!1),d=b2(l.shape,r,o,!1);return l.reshape(c).transpose(u).reshape(d)},e.prototype.reduce=function(t,r,s){var o=t.shape[0],i=t.shape[1],a=VC(i),l=new Pne({windowSize:a,inSize:i,batchSize:o},r),c=this.compileAndRun(l,[t],s);return c.shape[1]===1?c:this.reduce(c,r,s)},e.prototype.argReduce=function(t,r,s){s===void 0&&(s=null);var o=t.shape[0],i=t.shape[1];s!=null&&(o=s.shape[0],i=s.shape[1]);var a=VC(i),l=new wte({windowSize:a,inSize:i,batchSize:o},r,s==null),c=[t];s!=null&&c.push(s);var u=this.compileAndRun(l,c,"int32");return u.shape[1]===1?u:this.argReduce(t,r,u)},e.prototype.argReducePacked=function(t,r,s){s===void 0&&(s=null);var o=s!=null?s.shape:t.shape,i=VC(o[o.length-1]),a=new Ite(o,i,r,s==null),l=s==null?[t]:[t,s],c=this.compileAndRun(a,l,"int32");return c.rank===t.rank?this.argReducePacked(t,r,c):c},e.prototype.sum=function(t,r){zi("sum",r,t.rank);var s=Do(t.shape,r),o=s[0],i=Xt(s[1]),a=t.as2D(-1,i),l=$C(t.dtype);return this.reduce(a,"sum",l).reshape(o)},e.prototype.prod=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.prod(t,r);var s=Do(t.shape,r),o=s[0],i=Xt(s[1]),a=t.as2D(-1,i),l=$C(t.dtype);return this.reduce(a,"prod",l).reshape(o)},e.prototype.unsortedSegmentSum=function(t,r,s){var o=0,i=mc([o],t.rank),a=t;i!=null&&(a=t.transpose(i),o=gc(1,t.rank)[0]);var l=(function(p,x,v){for(var y=[],b=p.length,w=0;w<b;w++)w!==x?y.push(p[w]):y.push(v);return y})(a.shape,o,s),c=Xt([a.shape[o]]),u=a.as2D(-1,c),d=$C(t.dtype),f=this.segOpCompute(u,"unsortedSegmentSum",r,d,s).reshape(l);return i!=null&&(f=f.transpose(Yk(i))),f},e.prototype.segOpCompute=function(t,r,s,o,i){var a=t.shape[0],l=t.shape[1],c=(function(f,p){var x,v=!1;for(f<=lF?(x=f,v=!0):x=l5(f,Math.floor(Math.sqrt(f)));!v;)x>p||x===f?v=!0:x=l5(f,x+1);return x})(l,i),u=new Une({windowSize:c,inSize:l,batchSize:a,numSegments:i}),d=this.compileAndRun(u,[t,s],o);return d.shape[1]===i?d:(s=x2(0,i).tile([l/c]),this.segOpCompute(d,r,s,o,i))},e.prototype.argMinMaxReduce=function(t,r,s){var o=[r];if(zi("arg"+s.charAt(0).toUpperCase()+s.slice(1),o,t.rank),!je().getBool("WEBGL_PACK_REDUCE")||t.rank<=2){var i=Do(t.shape,o),a=i[0],l=Xt(i[1]),c=t.as2D(-1,l);return this.argReduce(c,s).reshape(a)}return this.argReducePacked(t,s)},e.prototype.argMin=function(t,r){return this.argMinMaxReduce(t,r,"min")},e.prototype.argMax=function(t,r){return this.argMinMaxReduce(t,r,"max")},e.prototype.cumsum=function(t,r,s,o){if(r!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+r);var i=new qte(t.shape,s,o);return this.compileAndRun(i,[t])},e.prototype.equal=function(t,r){if(je().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(equal(a, b));
`,"bool");var s=new es("return float(a == b);",t.shape,r.shape);return this.compileAndRun(s,[t,r],"bool")},e.prototype.notEqual=function(t,r){if(je().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(notEqual(a, b));
`,"bool");var s=new es("return float(a != b);",t.shape,r.shape);return this.compileAndRun(s,[t,r],"bool")},e.prototype.less=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.less(t,r);if(je().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(lessThan(a, b));
`,"bool");var s=new es("return float(a < b);",t.shape,r.shape);return this.compileAndRun(s,[t,r],"bool")},e.prototype.lessEqual=function(t,r){if(je().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(lessThanEqual(a, b));
`,"bool");var s=new es("return float(a <= b);",t.shape,r.shape);return this.compileAndRun(s,[t,r],"bool")},e.prototype.greater=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.greater(t,r);if(je().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(greaterThan(a, b));
`,"bool");var s=new es("return float(a > b);",t.shape,r.shape);return this.compileAndRun(s,[t,r],"bool")},e.prototype.greaterEqual=function(t,r){if(je().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var s=new es("return float(a >= b);",t.shape,r.shape);return this.compileAndRun(s,[t,r],"bool")},e.prototype.logicalNot=function(t){var r=new Dn(t.shape,"return float(!(x >= 1.0));");return this.compileAndRun(r,[t])},e.prototype.logicalAnd=function(t,r){if(je().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var s=new es("return float(a >= 1.0 && b >= 1.0);",t.shape,r.shape);return this.compileAndRun(s,[t,r],"bool")},e.prototype.logicalOr=function(t,r){if(je().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var s=new es("return float(a >= 1.0 || b >= 1.0);",t.shape,r.shape);return this.compileAndRun(s,[t,r],"bool")},e.prototype.select=function(t,r,s){var o=new Hne(t.rank,r.shape,r.rank);return this.compileAndRun(o,[t,r,s],fo(r.dtype,s.dtype))},e.prototype.where=function(t){m2("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var r=t.dataSync();return s6(t.shape,r)},e.prototype.topk=function(t,r,s){return yF(t.dataSync(),t.shape,t.dtype,r)},e.prototype.min=function(t,r){zi("min",r,t.rank);var s=Do(t.shape,r),o=s[0],i=Xt(s[1]),a=t.as2D(-1,i);return this.reduce(a,"min",a.dtype).reshape(o)},e.prototype.minimum=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.minimum(t,r);var s=je().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $c(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new es(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,t.shape,r.shape);return this.compileAndRun(s,[t,r])},e.prototype.mod=function(t,r){var s=je().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $c(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new es(`if (b == 0.0) return NAN;
  return mod(a, b);`,t.shape,r.shape);return this.compileAndRun(s,[t,r])},e.prototype.max=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.max(t,r);zi("max",r,t.rank);var s=Do(t.shape,r),o=s[0],i=Xt(s[1]),a=t.as2D(-1,i);return this.reduce(a,"max",a.dtype).reshape(o)},e.prototype.maximum=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.maximum(t,r);var s=je().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $c(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new es(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,t.shape,r.shape);return this.compileAndRun(s,[t,r])},e.prototype.all=function(t,r){zi("all",r,t.rank);var s=Do(t.shape,r),o=s[0],i=Xt(s[1]),a=t.as2D(-1,i);return this.reduce(a,"all",a.dtype).reshape(o)},e.prototype.any=function(t,r){zi("any",r,t.rank);var s=Do(t.shape,r),o=s[0],i=Xt(s[1]),a=t.as2D(-1,i);return this.reduce(a,"any",a.dtype).reshape(o)},e.prototype.realDivide=function(t,r){if(je().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,"float32",!0);var s=new es(`
if (a == b) {
  return 1.0;
};
return a / b;`,t.shape,r.shape);return this.compileAndRun(s,[t,r],"float32")},e.prototype.floorDiv=function(t,r){if(je().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var s=new es(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,t.shape,r.shape);return this.compileAndRun(s,[t,r],"int32")},e.prototype.add=function(t,r){if(t.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(t,r,zC);if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.add(t,r);var s=fo(t.dtype,r.dtype);if(je().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,zC,s);var o=new es(zC,t.shape,r.shape);return this.compileAndRun(o,[t,r],s)},e.prototype.packedUnaryOp=function(t,r,s){var o=new Km(t.shape,r);return this.compileAndRun(o,[t],s)},e.prototype.packedBinaryOp=function(t,r,s,o,i){i===void 0&&(i=!1);var a=new $c(s,t.shape,r.shape,i);return this.compileAndRun(a,[t,r],o)},e.prototype.complexSeparableBinaryOp=function(t,r,s){var o=this,i=this.texData.get(t.dataId),a=this.texData.get(r.dataId),l=[[i.complexTensors.real,a.complexTensors.real],[i.complexTensors.imag,a.complexTensors.imag]].map((function(f){var p=f[0],x=f[1],v=o.makeComplexComponentTensorInfo(t,p),y=o.makeComplexComponentTensorInfo(r,x),b=new es(s,t.shape,r.shape);return o.compileAndRun(b,[v,y],fo(p.dtype,x.dtype))})),c=l[0],u=l[1],d=this.complex(c,u);return c.dispose(),u.dispose(),d},e.prototype.makeComplexComponentTensorInfo=function(t,r){return{dataId:r.dataId,dtype:r.dtype,shape:t.shape}},e.prototype.addN=function(t){if(t.length===1)return t[0];if(t.length>je().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(t.length/2),s=this.addN(t.slice(0,r)),o=this.addN(t.slice(r));return this.addN([s,o])}var i=t.map((function(c){return c.dtype})).reduce((function(c,u){return fo(c,u)})),a=t.map((function(c){return c.shape})),l=je().getBool("WEBGL_PACK")?new bte(t[0].shape,a):new yte(t[0].shape,a);return this.compileAndRun(l,t,i)},e.prototype.subtract=function(t,r){if(t.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(t,r,WC);if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.subtract(t,r);var s=fo(t.dtype,r.dtype);if(je().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,WC,t.dtype);var o=new es(WC,t.shape,r.shape);return this.compileAndRun(o,[t,r],s)},e.prototype.pow=function(t,r){var s=je().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $c(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new es(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,t.shape,r.shape),o=fo(t.dtype,r.dtype);return this.compileAndRun(s,[t,r],o)},e.prototype.ceil=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.ceil(t);if(je().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,gT,t.dtype);var r=new Dn(t.shape,gT);return this.compileAndRun(r,[t])},e.prototype.floor=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.floor(t);if(je().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,xT,t.dtype);var r=new Dn(t.shape,xT);return this.compileAndRun(r,[t])},e.prototype.sign=function(t){var r=new Dn(t.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(r,[t])},e.prototype.isNaN=function(t){var r=new Dn(t.shape,"return float(isnan(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.isInf=function(t){var r=new Dn(t.shape,"return float(isinf(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.isFinite=function(t){var r=new Dn(t.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.round=function(t){var r=new Dn(t.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(r,[t])},e.prototype.exp=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.exp(t);if(je().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,vT,t.dtype);var r=new Dn(t.shape,vT);return this.compileAndRun(r,[t])},e.prototype.expm1=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.expm1(t);if(je().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,yT,t.dtype);var r=new Dn(t.shape,yT);return this.compileAndRun(r,[t])},e.prototype.softmax=function(t,r){var s=zs([r],t.shape),o=this.max(t,s),i=Si(o.shape,s),a=this.subtract(t,o.reshape(i)),l=this.exp(a),c=this.sum(l,s).reshape(i);return this.realDivide(l,c)},e.prototype.log=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.log(t);if(je().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,t.dtype);var r=new Dn(t.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(r,[t])},e.prototype.log1p=function(t){var r=new Dn(t.shape,"return log(1.0 + x);");return this.compileAndRun(r,[t])},e.prototype.sqrt=function(t){var r=new Dn(t.shape,"return sqrt(x);");return this.compileAndRun(r,[t])},e.prototype.rsqrt=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.rsqrt(t);var r=new Dn(t.shape,"return inversesqrt(x);");return this.compileAndRun(r,[t])},e.prototype.reciprocal=function(t){var r=new Dn(t.shape,"return 1.0 / x;");return this.compileAndRun(r,[t])},e.prototype.relu=function(t){var r;return r=je().getBool("WEBGL_PACK")?new Km(t.shape,TF):new Dn(t.shape,NF),this.compileAndRun(r,[t])},e.prototype.relu6=function(t){var r;return r=je().getBool("WEBGL_PACK")?new Km(t.shape,_F):new Dn(t.shape,EF),this.compileAndRun(r,[t])},e.prototype.prelu=function(t,r){var s=je().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $c(SF,t.shape,r.shape):new es(kF,t.shape,r.shape);return this.compileAndRun(s,[t,r])},e.prototype.elu=function(t){if(je().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,RF,t.dtype);var r=new Dn(t.shape,IF);return this.compileAndRun(r,[t])},e.prototype.eluDer=function(t,r){var s=je().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $c(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,t.shape,r.shape):new es("return (b >= 1.0) ? a : a * (b + 1.0);",t.shape,r.shape);return this.compileAndRun(s,[t,r])},e.prototype.selu=function(t){var r=new Dn(t.shape,ere);return this.compileAndRun(r,[t])},e.prototype.int=function(t){var r=new Dn(t.shape,"return float(int(x));");return this.compileAndRun(r,[t],"int32")},e.prototype.clip=function(t,r,s){var o,i=(o=je().getBool("WEBGL_PACK_CLIP")?new Pte(t.shape):new Fte(t.shape)).getCustomSetupFunc(r,s);return this.compileAndRun(o,[t],null,i)},e.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.abs(t);if(je().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,pT,t.dtype);var r=new Dn(t.shape,pT);return this.compileAndRun(r,[t])},e.prototype.complexAbs=function(t){var r=this.texData.get(t.dataId),s=new Ote(t.shape),o=[this.makeComplexComponentTensorInfo(t,r.complexTensors.real),this.makeComplexComponentTensorInfo(t,r.complexTensors.imag)];return this.compileAndRun(s,o)},e.prototype.sigmoid=function(t){var r=new Dn(t.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(r,[t])},e.prototype.softplus=function(t){var r=new Dn(t.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(r,[t])},e.prototype.sin=function(t){var r=new Dn(t.shape,tre);return this.compileAndRun(r,[t])},e.prototype.cos=function(t){var r=new Dn(t.shape,nre);return this.compileAndRun(r,[t])},e.prototype.tan=function(t){var r=new Dn(t.shape,"return tan(x);");return this.compileAndRun(r,[t])},e.prototype.asin=function(t){var r=new Dn(t.shape,rre);return this.compileAndRun(r,[t])},e.prototype.acos=function(t){var r=new Dn(t.shape,sre);return this.compileAndRun(r,[t])},e.prototype.atan=function(t){var r=new Dn(t.shape,ore);return this.compileAndRun(r,[t])},e.prototype.atan2=function(t,r){var s=je().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $c(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new es(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,t.shape,r.shape);return this.compileAndRun(s,[t,r])},e.prototype.sinh=function(t){var r=new Dn(t.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[t])},e.prototype.cosh=function(t){var r=new Dn(t.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[t])},e.prototype.tanh=function(t){var r=new Dn(t.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(r,[t])},e.prototype.asinh=function(t){var r=new Dn(t.shape,ire);return this.compileAndRun(r,[t])},e.prototype.acosh=function(t){var r=new Dn(t.shape,are);return this.compileAndRun(r,[t])},e.prototype.atanh=function(t){var r=new Dn(t.shape,lre);return this.compileAndRun(r,[t])},e.prototype.erf=function(t){var r=new Dn(t.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(r,[t])},e.prototype.step=function(t,r){var s=new Dn(t.shape,(function(o){return o===void 0&&(o=0),gl+`
    return x > 0.0 ? 1.0 : float(`+o+`);
  `})(r));return this.compileAndRun(s,[t])},e.prototype.conv2dByMatMul=function(t,r,s,o,i,a){var l=t.shape,c=this.texData.get(t.dataId),u=s.inChannels,d=l[0]*l[1]*l[2],f=s.outChannels,p=s.dataFormat==="channelsLast",x=(d===1||f===1)&&u>1e3,v=l[2]%2!=0&&!!c.isPacked;if(x||!je().getBool("WEBGL_LAZILY_UNPACK")||!je().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!v){var y=p?l[0]*l[1]*l[2]:l[0]*l[2]*l[3],b=this.reshape(t,[1,y,s.inChannels]),w=this.reshape(r,[1,s.inChannels,s.outChannels]);return this.reshape(this.fusedBatchMatMul({a:b,b:w,transposeA:!1,transposeB:!1,bias:o,activation:i,preluActivationWeights:a}),s.outShape)}var S=p?l[0]*l[1]*(l[2]+1):l[0]*l[2]*(l[3]+1),k={dataId:t.dataId,shape:[1,S,s.inChannels],dtype:t.dtype},N=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,ee(nv(c.shape,k.shape),(function(){return"packed reshape "+c.shape+" to "+k.shape+" isn't free"}));var I=this.reshape(r,[1,s.inChannels,s.outChannels]),T=this.fusedBatchMatMul({a:k,b:I,transposeA:!1,transposeB:!1,bias:o,activation:i,preluActivationWeights:a}),F=this.texData.get(T.dataId);return ee(F.isPacked,(function(){return"batchMatMul result is expected to be packed"})),c.shape=N,F.shape=s.outShape,ge.makeTensorFromDataId(T.dataId,s.outShape,T.dtype)},e.prototype.conv2dWithIm2Row=function(t,r,s,o,i,a){var l=s.filterWidth,c=s.filterHeight,u=s.inChannels,d=s.outWidth,f=s.outHeight,p=s.dataFormat==="channelsLast",x=l*c*u,v=f*d,y=[x,v],b=t.squeeze([0]),w=r.reshape([1,x,-1]),S=new Sne(y,b.shape,s),k=this.compileAndRun(S,[b]).reshape([1,y[0],y[1]]),N=o!=null,I=a!=null,T=i?iv(i,!0):null,F=new UC(k.shape,[1,v,s.outChannels],!0,!1,N,T,I),R=[k,w];o&&R.push(o),I&&R.push(a);var D=this.compileAndRun(F,R);return p?D.reshape([1,f,d,s.outChannels]):D.reshape([1,s.outChannels,f,d])},e.prototype.fusedConv2d=function(t){var r=t.input,s=t.filter,o=t.convInfo,i=t.bias,a=t.activation,l=t.preluActivationWeights;if(o.filterHeight===1&&o.filterWidth===1&&o.dilationHeight===1&&o.dilationWidth===1&&o.strideHeight===1&&o.strideWidth===1&&(o.padInfo.type==="SAME"||o.padInfo.type==="VALID"))return this.conv2dByMatMul(r,s,o,i,a,l);if(je().getBool("WEBGL_CONV_IM2COL")&&r.shape[0]===1)return this.conv2dWithIm2Row(r,s,o,i,a,l);var c=i!=null,u=l!=null,d=a?iv(a,!1):null,f=new oT(o,c,d,u),p=[r,s];return i&&p.push(i),l&&p.push(l),this.compileAndRun(f,p)},e.prototype.conv2d=function(t,r,s){if(s.filterHeight===1&&s.filterWidth===1&&s.dilationHeight===1&&s.dilationWidth===1&&s.strideHeight===1&&s.strideWidth===1&&(s.padInfo.type==="SAME"||s.padInfo.type==="VALID"))return this.conv2dByMatMul(t,r,s);if(je().getBool("WEBGL_CONV_IM2COL")&&t.shape[0]===1)return this.conv2dWithIm2Row(t,r,s);var o=new oT(s);return this.compileAndRun(o,[t,r])},e.prototype.conv2dDerInput=function(t,r,s){var o=new Bte(s);return this.compileAndRun(o,[t,r])},e.prototype.conv2dDerFilter=function(t,r,s){var o=new jte(s);return this.compileAndRun(o,[t,r])},e.prototype.fusedDepthwiseConv2D=function(t){var r,s=t.input,o=t.filter,i=t.convInfo,a=t.bias,l=t.activation,c=t.preluActivationWeights,u=je().getBool("WEBGL_PACK_DEPTHWISECONV")&&i.strideWidth<=2&&i.outChannels/i.inChannels==1,d=l?iv(l,u):null,f=[s,o],p=a!=null,x=c!=null;return p&&f.push(a),x&&f.push(c),u?(r=new aT(i,p,d,x),this.compileAndRun(r,f)):(r=new iT(i,p,d,x),this.compileAndRun(r,f))},e.prototype.depthwiseConv2D=function(t,r,s){var o;return je().getBool("WEBGL_PACK_DEPTHWISECONV")&&s.strideWidth<=2&&s.outChannels/s.inChannels==1?(o=new aT(s),this.compileAndRun(o,[t,r])):(o=new iT(s),this.compileAndRun(o,[t,r]))},e.prototype.depthwiseConv2DDerInput=function(t,r,s){var o=new Ute(s);return this.compileAndRun(o,[t,r])},e.prototype.depthwiseConv2DDerFilter=function(t,r,s){var o=new Wte(s);return this.compileAndRun(o,[t,r])},e.prototype.conv3d=function(t,r,s){var o=new Hte(s);return this.compileAndRun(o,[t,r])},e.prototype.conv3dDerInput=function(t,r,s){var o=new zte(s);return this.compileAndRun(o,[t,r])},e.prototype.conv3dDerFilter=function(t,r,s){var o=new Vte(s);return this.compileAndRun(o,[t,r])},e.prototype.maxPool=function(t,r){var s=new HC(r,"max",!1);return this.compileAndRun(s,[t])},e.prototype.avgPool=function(t,r){var s=new HC(r,"avg",!1);return this.compileAndRun(s,[t],"float32")},e.prototype.maxPoolBackprop=function(t,r,s,o){var i=new HC(o,"max",!0),a=this.compileAndRun(i,[r]),l=new Tne(o),c=this.compileAndRun(l,[t,a],r.dtype);return a.dispose(),c},e.prototype.avgPoolBackprop=function(t,r,s){var o=new Tte(s);return this.compileAndRun(o,[t],r.dtype)},e.prototype.cast=function(t,r){return pF(t,r,this)},e.prototype.unstack=function(t,r){for(var s=t.shape[r],o=new Array(t.rank-1),i=0,a=0;a<t.rank;a++)a!==r&&(o[i++]=t.shape[a]);var l=new Array(t.rank).fill(0),c=t.shape.slice();c[r]=1;var u=new Array(s);for(a=0;a<u.length;a++)l[r]=a,u[a]=this.slice(t,l,c).reshape(o);return u},e.prototype.avgPool3d=function(t,r){var s=new GC(r,"avg",!1);return this.compileAndRun(s,[t],"float32")},e.prototype.avgPool3dBackprop=function(t,r,s){var o=new _te(s);return this.compileAndRun(o,[t],r.dtype)},e.prototype.maxPool3d=function(t,r){var s=new GC(r,"max",!1);return this.compileAndRun(s,[t],"float32")},e.prototype.maxPool3dBackprop=function(t,r,s,o){var i=new GC(o,"max",!0),a=this.compileAndRun(i,[r]),l=new _ne(o),c=this.compileAndRun(l,[t,a],r.dtype);return a.dispose(),c},e.prototype.reshape=function(t,r){var s=this.texData.get(t.dataId);if(s.isPacked&&!nv(t.shape,r)&&(s.texture===null||!nv(s.shape,r))){var o=this.packedReshape(t,r);return ge.makeTensorFromDataId(o.dataId,o.shape,o.dtype)}return g5(t,r)},e.prototype.resizeBilinear=function(t,r,s,o){var i=je().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new jne(t.shape,r,s,o):new Lne(t.shape,r,s,o);return this.compileAndRun(i,[t],"float32")},e.prototype.resizeBilinearBackprop=function(t,r,s){var o=new Mne(t,r,s);return this.compileAndRun(o,[t])},e.prototype.resizeNearestNeighbor=function(t,r,s,o){var i=new Vne(t.shape,r,s,o);return this.compileAndRun(i,[t])},e.prototype.resizeNearestNeighborBackprop=function(t,r,s){var o=new Bne(t,r,s);return this.compileAndRun(o,[t])},e.prototype.multinomial=function(t,r,s,o){var i=r?t:Kc(t),a=i.shape[0],l=i.shape[1],c=new Rne(a,l,s),u=c.getCustomSetupFunc(o);return this.compileAndRun(c,[i],"int32",u)},e.prototype.oneHot=function(t,r,s,o){var i=new Dne(t.size,r,s,o);return this.compileAndRun(i,[t])},e.prototype.diag=function(t){var r=new Zte(t.size);return this.compileAndRun(r,[t])},e.prototype.nonMaxSuppression=function(t,r,s,o,i){return m2("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),n6(t.dataSync(),r.dataSync(),s,o,i)},e.prototype.cropAndResize=function(t,r,s,o,i,a){var l=new Gte(t.shape,r.shape,o,i,a);return this.compileAndRun(l,[t,r,s],"float32")},e.prototype.depthToSpace=function(t,r,s){ee(r>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+r}));var o=t.shape[0],i=s==="NHWC"?t.shape[1]:t.shape[2],a=s==="NHWC"?t.shape[2]:t.shape[3],l=s==="NHWC"?t.shape[3]:t.shape[1],c=i*r,u=a*r,d=l/(r*r),f=new Yte(s==="NHWC"?[o,c,u,d]:[o,d,c,u],r,s);return this.compileAndRun(f,[t])},e.prototype.split=function(t,r,s){return xF(t,r,s)},e.prototype.scatterND=function(t,r,s){var o=w2(0,t,s),i=o.sliceRank,a=o.numUpdates,l=o.sliceSize,c=o.strides,u=o.outputSize,d=[u/l,l],f=t.reshape([a,i]),p=r.reshape([a,l]);if(u===0)return g5(ho([]),s);var x=St(0),v=new dT(a,i,f.rank,p.rank,c,d);return this.compileAndRun(v,[p,f,x]).reshape(s)},e.prototype.sparseToDense=function(t,r,s,o){var i=w2(0,t,s),a=i.sliceRank,l=i.numUpdates,c=i.strides,u=i.outputSize,d=new dT(l,a,t.rank,r.rank,c,[u,1]);return this.compileAndRun(d,[r,t,o]).reshape(s)},e.prototype.fft=function(t){return this.fftImpl(t,!1)},e.prototype.ifft=function(t){return this.fftImpl(t,!0)},e.prototype.fftImpl=function(t,r){var s=this.texData.get(t.dataId),o=new cT(nne,t.shape,r),i=new cT(rne,t.shape,r),a=[this.makeComplexComponentTensorInfo(t,s.complexTensors.real),this.makeComplexComponentTensorInfo(t,s.complexTensors.imag)],l=this.compileAndRun(o,a),c=this.compileAndRun(i,a),u=this.complex(l,c).as2D(t.shape[0],t.shape[1]);return l.dispose(),c.dispose(),u},e.prototype.gatherND=function(t,r){var s=r.shape,o=s[s.length-1],i=aF(t,r),a=i[0],l=i[1],c=i[2],u=i[3],d=r.reshape([l,o]),f=t.reshape([t.size/c,c]),p=new ine(o,u,[l,c]);return this.compileAndRun(p,[f,d]).reshape(a)},e.prototype.fill=function(t,r,s){if((s=s||Qg(r))==="string"){var o=d2(s,Xt(t));return o.fill(r),ge.makeTensor(o,t,s,this)}var i=new sne(t,r),a=i.getCustomSetupFunc(r);return this.compileAndRun(i,[],s,a)},e.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){return this.fill(t.shape,t.dtype==="string"?"":0,t.dtype)},e.prototype.linspace=function(t,r,s){return mF(t,r,s)},e.prototype.makeTensorInfo=function(t,r){var s=this.write(null,t,r);return this.texData.get(s).usage=null,{dataId:s,shape:t,dtype:r}},e.prototype.makeOutput=function(t,r){var s=this.makeTensorInfo(t,r).dataId;return ge.makeTensorFromDataId(s,t,r,this)},e.prototype.unpackTensor=function(t){var r=new ure(t.shape);return this.runWebGLProgram(r,[t],t.dtype)},e.prototype.packTensor=function(t){var r=new Ane(t.shape);return this.runWebGLProgram(r,[t],t.dtype,null,!0)},e.prototype.packedReshape=function(t,r){var s=[h2(t.shape)].concat(p2(t.shape)),o={dtype:t.dtype,shape:s,dataId:t.dataId},i=[h2(r)].concat(p2(r)),a=new One(i,s),l=this.runWebGLProgram(a,[o],t.dtype,null,!0);return{dataId:l.dataId,shape:r,dtype:l.dtype}},e.prototype.decode=function(t){var r,s=this.texData.get(t),o=s.isPacked,i=s.shape,a=s.dtype,l=BC(i);return r=o?new Xte(l):new Kte(l),{dtype:a,shape:i,dataId:this.runWebGLProgram(r,[{shape:l,dtype:a,dataId:t}],a,null,!0).dataId}},e.prototype.runWebGLProgram=function(t,r,s,o,i){var a=this;i===void 0&&(i=!1);var l=this.makeTensorInfo(t.outputShape,s),c=this.texData.get(l.dataId);if(t.packedOutput&&(c.isPacked=!0),t.outPackingScheme===_g.DENSE){var u=dg(t.outputShape);c.texShape=u.map((function(S){return 2*S}))}if(t.outTexUsage!=null&&(c.usage=t.outTexUsage),Xt(l.shape)===0)return c.values=Ig(l.dtype,0),l;var d=[],f=r.map((function(S){if(S.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var k=a.texData.get(S.dataId);if(k.texture==null){if(!t.packedInputs&&Xt(S.shape)<=je().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:S.shape,texData:null,isUniform:!0,uniformValues:k.values};t.packedInputs&&(k.isPacked=!0,k.shape=S.shape)}else if(!!k.isPacked!=!!t.packedInputs)S=k.isPacked?a.unpackTensor(S):a.packTensor(S),d.push(S),k=a.texData.get(S.dataId);else if(k.isPacked&&!nv(k.shape,S.shape)){var N=S,I=S.shape;S.shape=k.shape,S=a.packedReshape(S,I),d.push(S),k=a.texData.get(S.dataId),N.shape=I}return a.uploadToGPU(S.dataId),{shape:S.shape,texData:k,isUniform:!1}}));this.uploadToGPU(l.dataId);var p,x={shape:l.shape,texData:c,isUniform:!1},v=(function(S,k,N){var I="";k.concat(N).forEach((function(R){var D=R.texData!=null&&R.texData.slice!=null&&R.texData.slice.flatOffset>0,A=R.isUniform?"uniform":R.texData.texShape;I+=R.shape+"_"+A+"_"+D}));var T=S.userCode,F=S.constructor.name;return F+="_"+I+"_"+T})(t,f,x),y=this.getAndSaveBinary(v,(function(){return(function(S,k,N,I){var T=k.userCode,F=N.map((function(M,j){var z={logicalShape:M.shape,texShape:M.isUniform?null:M.texData.texShape,isUniform:M.isUniform,isPacked:!M.isUniform&&M.texData.isPacked,flatOffset:null};return M.texData!=null&&M.texData.slice!=null&&M.texData.slice.flatOffset>0&&(z.flatOffset=M.texData.slice.flatOffset),{name:k.variableNames[j],shapeInfo:z}})),R=F.map((function(M){return M.shapeInfo})),D={logicalShape:I.shape,texShape:I.texData.texShape,isUniform:!1,isPacked:I.texData.isPacked,flatOffset:null},A=Cte(F,D,T,k.packedInputs),P=S.createProgram(A),B=null,L=S.getUniformLocation(P,"NAN",!1);je().getNumber("WEBGL_VERSION")===1&&(B=S.getUniformLocation(P,"INFINITY",!1));for(var W={},H=0;H<k.variableNames.length;H++){var G=k.variableNames[H];W[G]=S.getUniformLocation(P,G,!1),W["offset"+G]=S.getUniformLocation(P,"offset"+G,!1)}return{program:k,source:A,webGLProgram:P,uniformLocations:W,inShapeInfos:R,outShapeInfo:D,infLoc:B,nanLoc:L}})(a.gpgpu,t,f,x)})),b=this.activeTimers!=null;if(b&&(p=this.startTimer()),(function(S,k,N,I,T){uT(k.inShapeInfos,N),uT([k.outShapeInfo],[I]);var F=I.texData.texture,R=I.texData.texShape;I.texData.isPacked?S.setOutputPackedMatrixTexture(F,R[0],R[1]):S.setOutputMatrixTexture(F,R[0],R[1]),S.setProgram(k.webGLProgram),je().getNumber("WEBGL_VERSION")===1&&k.infLoc!==null&&S.gl.uniform1f(k.infLoc,1/0),k.nanLoc!==null&&S.gl.uniform1f(k.nanLoc,NaN),N.forEach((function(D,A){var P=k.program.variableNames[A],B=k.uniformLocations[P],L=k.uniformLocations["offset"+P];if(B!=null)if(D.isUniform)if(Xt(D.shape)<2)S.gl.uniform1f(B,D.uniformValues[0]);else{var W=D.uniformValues;W instanceof Float32Array||(W=new Float32Array(W)),S.gl.uniform1fv(B,W)}else D.texData.slice!=null&&L!=null&&S.gl.uniform1i(L,D.texData.slice.flatOffset),S.setInputMatrixTexture(D.texData.texture,B,A)})),T?.(S,k.webGLProgram),S.executeProgram()})(this.gpgpu,y,f,x,o),d.forEach((function(S){return a.disposeData(S.dataId)})),b&&(p=this.endTimer(p),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(p)})),!je().getBool("WEBGL_LAZILY_UNPACK")&&c.isPacked&&i===!1){var w=this.unpackTensor(l);return this.disposeData(l.dataId),w}return l},e.prototype.compileAndRun=function(t,r,s,o,i){i===void 0&&(i=!1),s=s||r[0].dtype;var a=this.runWebGLProgram(t,r,s,o,i);return ge.makeTensorFromDataId(a.dataId,a.shape,a.dtype)},e.prototype.getAndSaveBinary=function(t,r){return t in this.binaryCache||(this.binaryCache[t]=r()),this.binaryCache[t]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){var t=this;this.disposed||(je().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((function(r){t.gpgpu.deleteProgram(t.binaryCache[r].webGLProgram),delete t.binaryCache[r]})),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},e.prototype.floatPrecision=function(){var t=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=$t((function(){if(!je().get("WEBGL_RENDER_FLOAT32_ENABLED")){var r=je().getBool("DEBUG");je().set("DEBUG",!1);var s=t.abs(St(1e-8)).dataSync()[0];if(je().set("DEBUG",r),s>0)return 32}return 16}))),this.floatPrecisionValue},e.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},e.prototype.uploadToGPU=function(t){var r,s=this.texData.get(t),o=s.shape,i=s.dtype,a=s.values,l=s.texture,c=s.usage,u=s.isPacked;if(l==null){var d,f=this.activeTimers!=null;f&&(d=Ml());var p=s.texShape;if(p==null&&(p=vee(o,u),s.texShape=p),a!=null){var x=BC(o),v=void 0,y=p[1],b=p[0],w=a instanceof Uint8Array;u?(y=(r=t1(p[0],p[1]))[0],b=r[1],v=new tne(x,[b,y],w)):v=new ene(x,[b,y],w);var S=this.makeTensorInfo([b,y],i);this.texData.get(S.dataId).usage=w?Ki.PIXELS:Ki.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(S.dataId),y,b,a);var k=this.runWebGLProgram(v,[S],i,null,!0),N=this.texData.get(k.dataId);s.texture=N.texture,s.texShape=N.texShape,s.isPacked=N.isPacked,s.usage=N.usage,this.disposeData(S.dataId),this.texData.delete(k.dataId),s.values=null,f&&(this.uploadWaitMs+=Ml()-d)}else{var I=this.acquireTexture(p,c,i,u);s.texture=I}}},e.prototype.convertAndCacheOnCPU=function(t,r){var s=this.texData.get(t),o=s.dtype;return this.releaseGPUData(t),r!=null&&(s.values=(function(i,a){if(a==="float32"||a==="complex64")return i;if(a==="int32"||a==="bool"){for(var l=a==="int32"?new Int32Array(i.length):new Uint8Array(i.length),c=0;c<l.length;++c)l[c]=Math.round(i[c]);return l}throw new Error("Unknown dtype "+a)})(r,o)),s.values},e.prototype.acquireTexture=function(t,r,s,o){if(this.numBytesInGPU+=this.computeBytes(t,s),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+i+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(t,r,o)},e.prototype.computeBytes=function(t,r){return t[0]*t[1]*W$(r)},e})(fF);Y$()&&ge.registerBackend("webgl",(function(){return new fre}),2);var hre=ie({square_:function(n){var e=Y(n,"x","square"),t=[e];return ge.runKernelFunc((function(r,s){return s([e]),r.square(e)}),{x:e},null,"Square",{},t,[])}}),Dg="SquaredDifference",DF=ie({squaredDifference_:function(n,e){var t,r=Y(n,"a","squaredDifference"),s=Y(e,"b","squaredDifference");t=Yr(r,s),r=t[0],s=t[1],zn(r.shape,s.shape);var o={a:r,b:s},i=[r,s];return ge.runKernelFunc((function(a,l){var c=a.squaredDifference(r,s);return l([r,s]),c}),o,(function(a,l){var c=l[0],u=l[1],d=St(2);return{a:function(){return a.mul(c.sub(u).mul(d))},b:function(){return a.mul(u.sub(c).mul(d))}}}),Dg,{},i,[])}}),pre=ie({abs_:function(n){var e=Y(n,"x","abs");return e.dtype==="complex64"?ge.runKernelFunc((function(t){return t.complexAbs(e)}),{$x:e}):ge.runKernelFunc((function(t,r){var s=t.abs(e);return r([e]),s}),{x:e},(function(t,r){var s=r[0];return{x:function(){return t.mul(s.toFloat().step(-1))}}}),"Abs")}}),mre=ie({acos_:function(n){var e=Y(n,"x","acos");return ge.runKernelFunc((function(t,r){var s=t.acos(e);return r([e]),s}),{$x:e},(function(t,r){var s=r[0];return{$x:function(){return t.divStrict(St(1).sub(s.toFloat().square()).sqrt()).neg()}}}))}}),gre=ie({acosh_:function(n){var e=Y(n,"x","acosh");return ge.runKernelFunc((function(t,r){var s=t.acosh(e);return r([e]),s}),{$x:e},(function(t,r){var s=r[0];return{$x:function(){return t.divStrict(s.toFloat().square().sub(1).sqrt())}}}))}}),xre=ie({asin_:function(n){var e=Y(n,"x","asin");return ge.runKernelFunc((function(t,r){var s=t.asin(e);return r([e]),s}),{$x:e},(function(t,r){var s=r[0];return{$x:function(){return t.divStrict(St(1).sub(s.toFloat().square()).sqrt())}}}))}}),vre=ie({asinh_:function(n){var e=Y(n,"x","asinh");return ge.runKernelFunc((function(t,r){var s=t.asinh(e);return r([e]),s}),{$x:e},(function(t,r){var s=r[0];return{$x:function(){return t.divStrict(St(1).add(s.toFloat().square()).sqrt())}}}))}}),yre=ie({atan_:function(n){var e=Y(n,"x","atan");return ge.runKernelFunc((function(t,r){var s=t.atan(e);return r([e]),s}),{$x:e},(function(t,r){var s=r[0];return{$x:function(){return t.div(s.toFloat().square().add(1))}}}))}}),bre=ie({atanh_:function(n){var e=Y(n,"x","atanh");return ge.runKernelFunc((function(t,r){var s=t.atanh(e);return r([e]),s}),{$x:e},(function(t,r){var s=r[0];return{$x:function(){return t.div(St(1).sub(s.toFloat().square()))}}}))}}),wre=ie({ceil_:function(n){var e=Y(n,"x","ceil");return ge.runKernelFunc((function(t){return t.ceil(e)}),{$x:e},(function(t){return{$x:function(){return Yn(t)}}}))}}),l6=ie({clipByValue_:function(n,e,t){var r=Y(n,"x","clipByValue");ee(e<=t,(function(){return"Error in clip: min ("+e+") must be less than or equal to max ("+t+")."}));var s=[r],o={min:e,max:t};return ge.runKernelFunc((function(i,a){var l=i.clip(r,e,t);return a([r]),l}),{x:r},(function(i,a){var l=a[0];return{x:function(){return i.where(l.greaterEqual(e).logicalAnd(l.lessEqual(t)),Yn(i))}}}),"ClipByValue",o,s)}}),Cre=ie({cos_:function(n){var e=Y(n,"x","cos"),t=[e];return ge.runKernelFunc((function(r,s){var o=r.cos(e);return s([e]),o}),{x:e},(function(r,s){var o=s[0];return{x:function(){return o.toFloat().sin().neg().mul(r)}}}),"Cos",{},t)}}),kre=ie({cosh_:function(n){var e=Y(n,"x","cosh");return ge.runKernelFunc((function(t,r){var s=t.cosh(e);return r([e]),s}),{$x:e},(function(t,r){var s=r[0];return{$x:function(){return s.toFloat().sinh().mulStrict(t)}}}))}}),Sre=ie({erf_:function(n){var e=Y(n,"x","erf");return ee(e.dtype==="int32"||e.dtype==="float32",(function(){return"Input dtype must be `int32` or `float32`."})),e.dtype==="int32"&&(e=e.toFloat()),ge.runKernelFunc((function(t,r){var s=t.erf(e);return r([e]),s}),{$x:e},(function(t,r){var s=r[0];return{$x:function(){return t.mul(s.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}}))}}),v5=ie({exp_:function(n){var e=Y(n,"x","exp");return ge.runKernelFunc((function(t,r){var s=t.exp(e);return r([s]),s}),{x:e},(function(t,r){return{x:function(){return t.mulStrict(r[0])}}}),"Exp",{},[],[!0])}}),Nre=ie({expm1_:function(n){var e=Y(n,"x","expm1");return ge.runKernelFunc((function(t,r){var s=t.expm1(e);return r([e]),s}),{$x:e},(function(t,r){var s=r[0];return{$x:function(){return t.mul(s.exp())}}}))}}),Ere=ie({floor_:function(n){var e=Y(n,"x","floor");return ge.runKernelFunc((function(t){return t.floor(e)}),{$x:e},(function(t){return{$x:function(){return Yn(t)}}}))}}),Ire=ie({log_:function(n){var e=Y(n,"x","log"),t=[e];return ge.runKernelFunc((function(r,s){var o=r.log(e);return s([e]),o}),{x:e},(function(r,s){var o=s[0];return{x:function(){return r.div(o.toFloat())}}}),"Log",{},t)}}),Tre=ie({log1p_:function(n){var e=Y(n,"x","log1p");return ge.runKernelFunc((function(t,r){var s=t.log1p(e);return r([e]),s}),{$x:e},(function(t,r){var s=r[0];return{$x:function(){return t.div(s.add(1))}}}))}}),_re=ie({logSigmoid_:function(n){var e=Y(n,"x","logSigmoid");return ge.runKernelFunc((function(t,r){var s=t.softplus(e.neg()).neg();return r([e]),s}),{$x:e},(function(t,r){var s=r[0];return{$x:function(){return t.mul(s.neg().sigmoid())}}}))}}),N2=ie({neg_:function(n){var e=Y(n,"x","neg"),t=[e];return ge.runKernelFunc((function(r){return r.neg(e)}),{x:e},(function(r){return{x:function(){return r.neg()}}}),"Neg",{},t)}}),Rre=ie({reciprocal_:function(n){var e=Y(n,"x","reciprocal");return ge.runKernelFunc((function(t,r){var s=t.reciprocal(e);return r([e]),s}),{$x:e},(function(t,r){var s=r[0];return{$x:function(){return t.div(s.square().neg())}}}))}}),Dre=ie({round_:function(n){var e=Y(n,"x","round");return ge.runKernelFunc((function(t){return t.round(e)}),{$x:e},(function(t){return{$x:function(){return Yn(t)}}}))}}),AF=ie({rsqrt_:function(n){var e=Y(n,"x","rsqrt"),t=[e];return ge.runKernelFunc((function(r,s){var o=r.rsqrt(e);return s([e]),o}),{x:e},(function(r,s){var o=s[0];return{x:function(){return r.div(o.pow(1.5).mul(2)).neg()}}}),"Rsqrt",{},t)}}),$F=ie({sigmoid_:function(n){var e=Y(n,"x","sigmoid");return ge.runKernelFunc((function(t,r){var s=t.sigmoid(e);return r([s]),s}),{x:e},(function(t,r){var s=r[0];return{x:function(){return t.mul(s.mul(St(1).sub(s)))}}}),"Sigmoid")}}),Are=ie({sign_:function(n){var e=Y(n,"x","sign");return ge.runKernelFunc((function(t){return t.sign(e)}),{$x:e},(function(t){return{$x:function(){return Yn(t)}}}))}}),$re=ie({isNaN_:function(n){var e=Y(n,"x","isNaN");return ge.runKernelFunc((function(t){return t.isNaN(e)}),{$x:e},(function(t){return{$x:function(){return Yn(t)}}}))}}),Fre=ie({isInf_:function(n){var e=Y(n,"x","isInf");return ge.runKernelFunc((function(t){return t.isInf(e)}),{$x:e},(function(t){return{$x:function(){return Yn(t)}}}))}}),Pre=ie({isFinite_:function(n){var e=Y(n,"x","isFinite");return ge.runKernelFunc((function(t){return t.isFinite(e)}),{$x:e},(function(t){return{$x:function(){return Yn(t)}}}))}}),Ore=ie({sin_:function(n){var e=Y(n,"x","sin"),t=[e];return ge.runKernelFunc((function(r,s){var o=r.sin(e);return s([e]),o}),{x:e},(function(r,s){var o=s[0];return{x:function(){return o.toFloat().cos().mul(r)}}}),"Sin",{},t)}}),Mre=ie({sinh_:function(n){var e=Y(n,"x","sinh");return ge.runKernelFunc((function(t,r){var s=t.sinh(e);return r([e]),s}),{$x:e},(function(t,r){var s=r[0];return{$x:function(){return s.toFloat().cosh().mulStrict(t)}}}))}}),Lre=ie({softplus_:function(n){var e=Y(n,"x","softplus");return ge.runKernelFunc((function(t,r){var s=t.softplus(e);return r([e]),s}),{$x:e},(function(t,r){var s=r[0];return{$x:function(){return t.mul(s.sigmoid())}}}))}}),jre=ie({sqrt_:function(n){var e=Y(n,"x","sqrt");return ge.runKernelFunc((function(t,r){var s=t.sqrt(e);return r([e]),s}),{$x:e},(function(t,r){var s=r[0];return{$x:function(){return t.div(s.toFloat().sqrt().mul(2))}}}))}}),Bre=ie({step_:function(n,e){e===void 0&&(e=0);var t=Y(n,"x","step");return ge.runKernelFunc((function(r){return r.step(t,e)}),{$x:t},(function(r){return{$x:function(){return Yn(r)}}}))}}),Vre=ie({tan_:function(n){var e=Y(n,"x","tan");return ge.runKernelFunc((function(t,r){var s=t.tan(e);return r([e]),s}),{$x:e},(function(t,r){var s=r[0];return{$x:function(){return t.div(s.cos().square())}}}))}}),zre=ie({tanh_:function(n){var e=Y(n,"x","tanh");return ge.runKernelFunc((function(t,r){var s=t.tanh(e);return r([s]),s}),{x:e},(function(t,r){var s=r[0];return{x:function(){return St(1).sub(s.square()).mulStrict(t)}}}),"Tanh",{},null,[!0])}});function FF(n,e,t,r,s,o){var i,a,l=Y(n,"x","batchNorm"),c=Y(e,"mean","batchNorm"),u=Y(t,"variance","batchNorm");return s!=null&&(i=Y(s,"scale","batchNorm")),r!=null&&(a=Y(r,"offset","batchNorm")),ee(l.rank===2,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+l.rank+"."})),ee(c.rank===2||c.rank===1,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+c.rank+"."})),ee(u.rank===2||u.rank===1,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+u.rank+"."})),i!=null&&ee(i.rank===2||i.rank===1,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+i.rank+"."})),a!=null&&ee(a.rank===2||a.rank===1,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+a.rank+"."})),r1(l,c,u,a,i,o)}function PF(n,e,t,r,s,o){var i,a,l=Y(n,"x","batchNorm"),c=Y(e,"mean","batchNorm"),u=Y(t,"variance","batchNorm");return s!=null&&(i=Y(s,"scale","batchNorm")),r!=null&&(a=Y(r,"offset","batchNorm")),ee(l.rank===3,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+l.rank+"."})),ee(c.rank===3||c.rank===1,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+c.rank+"."})),ee(u.rank===3||u.rank===1,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+u.rank+"."})),i!=null&&ee(i.rank===3||i.rank===1,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+i.rank+"."})),a!=null&&ee(a.rank===3||a.rank===1,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+a.rank+"."})),r1(l,c,u,a,i,o)}function OF(n,e,t,r,s,o){var i,a,l=Y(n,"x","batchNorm"),c=Y(e,"mean","batchNorm"),u=Y(t,"variance","batchNorm");return s!=null&&(i=Y(s,"scale","batchNorm")),r!=null&&(a=Y(r,"offset","batchNorm")),ee(l.rank===4,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+l.rank+"."})),ee(c.rank===4||c.rank===1,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+c.rank+"."})),ee(u.rank===4||u.rank===1,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+u.rank+"."})),i!=null&&ee(i.rank===4||i.rank===1,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+i.rank+"."})),a!=null&&ee(a.rank===4||a.rank===1,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+a.rank+"."})),r1(l,c,u,a,i,o)}function r1(n,e,t,r,s,o){o==null&&(o=.001);var i,a,l,c=Y(n,"x","batchNorm"),u=Y(e,"mean","batchNorm"),d=Y(t,"variance","batchNorm");s!=null&&(i=Y(s,"scale","batchNorm")),r!=null&&(a=Y(r,"offset","batchNorm")),ee(u.rank===d.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),ee(a==null||u.rank===a.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),ee(i==null||u.rank===i.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."})),l=c.rank===0||c.rank===1?c.as4D(1,1,1,c.size):c.rank===2?c.as4D(1,1,c.shape[0],c.shape[1]):c.rank===3?c.as4D(1,c.shape[0],c.shape[1],c.shape[2]):c;var f=[c,u,d,i];return ge.runKernelFunc((function(p,x){var v=p.batchNormalization(l,av(u),av(d),o,av(i),av(a));return x([c,u,d,i]),v}),{x:c,mean:u,variance:d,scale:i,offset:a},(function(p,x){var v=x,y=v[0],b=v[1],w=v[2],S=v[3],k=S??St(1),N=Bs(b.shape,l.shape),I=[];if(b.rank===1){for(var T=0;T<l.shape.length-1;++T)I.push(l.shape[T]);I.push(1)}var F=y.sub(b),R=p.mul(k),D=AF(w.add(St(o))),A=D.mul(D).mul(D).mul(St(-.5));return{x:function(){return b.rank===1?p.mul(ip(D.as4D(1,1,1,b.shape[0]),I)).mul(k).reshape(y.shape):p.mul(D).mul(k).reshape(y.shape)},mean:function(){var P=D.mul(St(-1)).mul(R);return b.rank===1&&(P=P.sum(N)),P.reshape(b.shape)},variance:function(){var P=A.mul(F).mul(R);return b.rank===1&&(P=P.sum(N)),P.reshape(b.shape)},scale:function(){var P=F.mul(D),B=p.mul(P);return b.rank===1&&(B=B.sum(N)),B.reshape(b.shape)},offset:function(){var P=p;return b.rank===1&&(P=P.sum(N)),P.reshape(b.shape)}}}),"BatchNormalization",{varianceEpsilon:o},f).reshape(c.shape)}function av(n){return n==null?null:n.rank===0?n.as1D():n.rank===1?n:n.rank===2?n.as4D(1,1,n.shape[0],n.shape[1]):n.rank===3?n.as4D(1,n.shape[0],n.shape[1],n.shape[2]):n}function Dy(){Z$("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var Wre=ie({batchNormalization2d_:function(n,e,t,r,s,o){return r===void 0&&(r=.001),Dy(),FF(n,e,t,o,s,r)}}),Ure=ie({batchNormalization3d_:function(n,e,t,r,s,o){return r===void 0&&(r=.001),Dy(),PF(n,e,t,o,s,r)}}),Hre=ie({batchNormalization4d_:function(n,e,t,r,s,o){return r===void 0&&(r=.001),Dy(),OF(n,e,t,o,s,r)}}),Gre=ie({batchNormalization_:function(n,e,t,r,s,o){return r===void 0&&(r=.001),Dy(),r1(n,e,t,o,s,r)}}),MF=ie({batchNorm_:r1}),qre=ie({batchNorm2d_:FF}),Kre=ie({batchNorm3d_:PF}),Xre=ie({batchNorm4d_:OF}),Ay=ie({logicalAnd_:function(n,e){var t=Y(n,"a","logicalAnd","bool"),r=Y(e,"b","logicalAnd","bool");return zn(t.shape,r.shape),ge.runKernelFunc((function(s){return s.logicalAnd(t,r)}),{a:t,b:r},null,"LogicalAnd")}}),Yre=ie({logicalNot_:function(n){var e=Y(n,"x","logicalNot","bool");return ge.runKernelFunc((function(t){return t.logicalNot(e)}),{$x:e})}}),LF=ie({logicalOr_:function(n,e){var t=Y(n,"a","logicalOr","bool"),r=Y(e,"b","logicalOr","bool");return zn(t.shape,r.shape),ge.runKernelFunc((function(s){return s.logicalOr(t,r)}),{$a:t,$b:r})}}),Zre=ie({logicalXor_:function(n,e){var t=Y(n,"a","logicalXor","bool"),r=Y(e,"b","logicalXor","bool");return zn(t.shape,r.shape),LF(n,e).logicalAnd(Ay(n,e).logicalNot())}}),kf=ie({where_:function(n,e,t){var r=Y(e,"a","where"),s=Y(t,"b","where"),o=Y(n,"condition","where","bool");return pr(r.shape,s.shape,"Error in where: "),o.rank===1?ee(o.shape[0]===r.shape[0],(function(){return"The first dimension of `a` must match the size of `condition`."})):pr(o.shape,s.shape,"Error in where: "),ge.runKernelFunc((function(i,a){var l=i.select(o,r,s);return a([o]),l}),{$condition:o,$a:r,$b:s},(function(i,a){var l=a[0];return{$condition:function(){return Yn(l).toFloat()},$a:function(){return i.mul(l.cast(i.dtype))},$b:function(){return i.mul(l.logicalNot().cast(i.dtype))}}}))}}),jF=function(n){return Vt(this,void 0,void 0,(function(){var e,t,r;return zt(this,(function(s){switch(s.label){case 0:return[4,(e=Y(n,"condition","whereAsync","bool")).data()];case 1:return t=s.sent(),r=s6(e.shape,t),n!==e&&e.dispose(),[2,r]}}))}))},jn=ie({add_:function(n,e){var t,r=Y(n,"a","add"),s=Y(e,"b","add");t=Yr(r,s),r=t[0],s=t[1];var o=zn(r.shape,s.shape);return ge.runKernelFunc((function(i){return i.add(r,s)}),{a:r,b:s},(function(i){return{a:function(){var a=i,l=Bs(r.shape,o);return l.length>0&&(a=a.sum(l)),a.reshape(r.shape)},b:function(){var a=i,l=Bs(s.shape,o);return l.length>0&&(a=a.sum(l)),a.reshape(s.shape)}}}),"Add")}}),Jre=ie({addN_:function(n){ee(Array.isArray(n),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),ee(n.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got "+n.length}));var e=n.map((function(s,o){return Y(s,"tensors"+o,"addN")})),t=e[0];e.forEach((function(s){if(s.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),e.forEach((function(s){if(!eo(s.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));var r=e;return ge.runKernelFunc((function(s){return s.addN(e)}),r,(function(s){var o={};return e.forEach((function(i,a){o[a]=function(){return s.clone()}})),o}),"AddN")}}),Qre=ie({addStrict_:function(n,e){var t=Y(n,"a","addStrict"),r=Y(e,"b","addStrict");return pr(t.shape,r.shape,"Error in addStrict: "),t.add(r)}}),ese=ie({atan2_:function(n,e){var t,r=Y(n,"a","atan2"),s=Y(e,"b","atan2");t=Yr(r,s),r=t[0],s=t[1];var o=zn(r.shape,s.shape);return ge.runKernelFunc((function(i,a){var l=i.atan2(r,s);return a([r,s]),l}),{$a:r,$b:s},(function(i,a){var l=a[0],c=a[1];return{$a:function(){var u=jn(l.square(),c.square()),d=i.mul(c.div(u)),f=Bs(l.shape,o);return f.length>0&&(d=d.sum(f)),d.reshape(l.shape)},$b:function(){var u=jn(l.square(),c.square()),d=N2(i.mul(l.div(u))),f=Bs(c.shape,o);return f.length>0&&(d=d.sum(f)),d.reshape(c.shape)}}}))}}),Ya=ie({div_:function(n,e){var t,r=Y(n,"a","div"),s=Y(e,"b","div");if(t=Yr(r,s),r=t[0],s=t[1],r.dtype==="int32"&&s.dtype==="int32")return BF(r,s);var o=zn(r.shape,s.shape);return ge.runKernelFunc((function(i,a){var l=i.realDivide(r,s);return a([r,s]),l}),{a:r,b:s},(function(i,a){var l=a[0],c=a[1];return{a:function(){var u=i.div(c.toFloat()),d=Bs(l.shape,o);return d.length>0?u.sum(d).reshape(l.shape):u},b:function(){var u=i.mul(l.toFloat()),d=Bs(c.shape,o);d.length>0&&(u=u.sum(d).reshape(c.shape));var f=c.square();return u.div(f.toFloat()).neg()}}}),"Div")}}),tse=ie({divNoNan_:function(n,e){var t,r=Y(n,"a","div"),s=Y(e,"b","div");r=(t=Yr(r,s))[0],s=t[1];var o=Ya(r,s),i=Yn(o),a=s.equal(i);return kf(a,i,o)}}),nse=ie({divStrict_:function(n,e){var t=Y(n,"a","div"),r=Y(e,"b","div");return pr(t.shape,r.shape,"Error in divideStrict: "),t.div(r)}}),BF=ie({floorDiv_:function(n,e){var t,r=Y(n,"a","floorDiv"),s=Y(e,"b","floorDiv");t=Yr(r,s),r=t[0],s=t[1];var o=zn(r.shape,s.shape);return ge.runKernelFunc((function(i,a){var l=i.floorDiv(r,s);return a([r,s]),l}),{a:r,b:s},(function(i,a){var l=a[0],c=a[1];return{a:function(){var u=i.div(c.toFloat()),d=Bs(l.shape,o);return d.length>0?u.sum(d).reshape(l.shape):u},b:function(){var u=i.mul(l.toFloat()),d=Bs(c.shape,o);d.length>0&&(u=u.sum(d).reshape(c.shape));var f=c.square();return u.div(f.toFloat()).neg()}}}),"FloorDiv")}}),c6=ie({maximum_:function(n,e){var t,r=Y(n,"a","maximum"),s=Y(e,"b","maximum");return t=Yr(r,s),r=t[0],s=t[1],r.dtype==="bool"&&(r=r.toInt(),s=s.toInt()),zn(r.shape,s.shape),ge.runKernelFunc((function(o,i){var a=o.maximum(r,s);return i([r,s]),a}),{a:r,b:s},(function(o,i){var a=i[0],l=i[1];return{a:function(){return o.mul(a.greaterEqual(l).toFloat())},b:function(){return o.mul(a.less(l).toFloat())}}}),"Maximum")}}),rse=ie({maximumStrict_:function(n,e){var t=Y(n,"a","maximumStrict"),r=Y(e,"b","maximumStrict");return pr(t.shape,r.shape,"Error in maximumStrict: "),t.maximum(r)}}),VF=ie({minimum_:function(n,e){var t,r=Y(n,"a","minimum"),s=Y(e,"b","minimum");return t=Yr(r,s),r=t[0],s=t[1],r.dtype==="bool"&&(r=r.toInt(),s=s.toInt()),zn(r.shape,s.shape),ge.runKernelFunc((function(o,i){var a=o.minimum(r,s);return i([r,s]),a}),{a:r,b:s},(function(o,i){var a=i[0],l=i[1];return{a:function(){return o.mul(a.lessEqual(l).toFloat())},b:function(){return o.mul(a.greater(l).toFloat())}}}),"Minimum")}}),sse=ie({minimumStrict_:function(n,e){var t=Y(n,"a","minimumStrict"),r=Y(e,"b","minimumStrict");return pr(t.shape,r.shape,"Error in minimumStrict: "),t.minimum(r)}}),ose=ie({mod_:function(n,e){var t,r=Y(n,"a","mod"),s=Y(e,"b","mod");t=Yr(r,s),r=t[0],s=t[1];var o=zn(r.shape,s.shape);return ge.runKernelFunc((function(i,a){var l=i.mod(r,s);return a([r,s]),l}),{$a:r,$b:s},(function(i,a){var l=a[0],c=a[1];return{$a:function(){var u=Bs(l.shape,o);return u.length>0?i.sum(u).reshape(l.shape):i},$b:function(){var u=i.mul(l.div(c).floor().neg()),d=Bs(c.shape,o);return d.length>0?u.sum(d).reshape(c.shape):u}}}))}}),ise=ie({modStrict_:function(n,e){var t=Y(n,"a","modStrict"),r=Y(e,"b","modStrict");return pr(t.shape,r.shape,"Error in modStrict: "),t.mod(r)}}),jo=ie({mul_:function(n,e){var t,r=Y(n,"a","mul"),s=Y(e,"b","mul");t=Yr(r,s),r=t[0],s=t[1];var o=zn(r.shape,s.shape);return ge.runKernelFunc((function(i,a){var l=i.multiply(r,s);return a([r,s]),l}),{a:r,b:s},(function(i,a){var l=a[0],c=a[1];return{a:function(){var u=i.mul(c.toFloat()),d=Bs(l.shape,o);return d.length>0?u.sum(d).reshape(l.shape):u},b:function(){var u=i.mul(l.toFloat()),d=Bs(c.shape,o);return d.length>0?u.sum(d).reshape(c.shape):u}}}),"Mul")}}),ase=ie({mulStrict_:function(n,e){var t=Y(n,"a","mul"),r=Y(e,"b","mul");return pr(t.shape,r.shape,"Error in multiplyStrict: "),t.mul(r)}}),E2=ie({pow_:function(n,e){var t,r=Y(n,"base","pow"),s=Y(e,"exp","pow");t=Yr(r,s),r=t[0],s=t[1];var o=zn(r.shape,s.shape),i=[r,s];return ge.runKernelFunc((function(a,l){var c=a.pow(r,s);return l([r,s,c]),c}),{a:r,b:s},(function(a,l){var c=l[0],u=l[1],d=l[2];return{a:function(){var f=u.toFloat(),p=a.mul(f.mul(c.pow(f.sub(St(1))))),x=Bs(c.shape,o);return x.length>0&&(p=p.sum(x)),p.reshape(c.shape)},b:function(){var f=c.greater(0),p=c.log().where(f,Yn(c)),x=a.mul(d.mul(p)),v=Bs(u.shape,o);return v.length>0&&(x=x.sum(v)),x.reshape(u.shape)}}}),"Pow",{},i,[!0])}}),lse=ie({powStrict_:function(n,e){return pr(n.shape,e.shape,"Error in powStrict: "),n.pow(e)}}),cse=ie({squaredDifferenceStrict_:function(n,e){var t=Y(n,"a","squaredDifferenceStrict"),r=Y(e,"b","squaredDifferenceStrict");return pr(t.shape,r.shape,"Error in squaredDifferenceStrict: "),t.squaredDifference(r)}}),Vs=ie({sub_:function(n,e){var t,r=Y(n,"a","sub"),s=Y(e,"b","sub");t=Yr(r,s),r=t[0],s=t[1];var o=zn(r.shape,s.shape);return ge.runKernelFunc((function(i){return i.subtract(r,s)}),{a:r,b:s},(function(i){return{a:function(){var a=i,l=Bs(r.shape,o);return l.length>0&&(a=a.sum(l)),a.reshape(r.shape)},b:function(){var a=i,l=Bs(s.shape,o);return l.length>0&&(a=a.sum(l)),a.neg().reshape(s.shape)}}}),"Sub")}}),use=ie({subStrict_:function(n,e){var t=Y(n,"a","subStrict"),r=Y(e,"b","subStrict");return pr(t.shape,r.shape,"Error in subStrict: "),t.sub(r)}}),zF=ie({equal_:function(n,e){var t,r=Y(n,"a","equal"),s=Y(e,"b","equal");return t=Yr(r,s),r=t[0],s=t[1],zn(r.shape,s.shape),ge.runKernelFunc((function(o){return o.equal(r,s)}),{$a:r,$b:s})}}),dse=ie({equalStrict_:function(n,e){var t=Y(n,"a","equalStrict"),r=Y(e,"b","equalStrict");return pr(t.shape,r.shape,"Error in equalStrict: "),t.equal(r)}}),fse=ie({greater_:function(n,e){var t,r=Y(n,"a","greater"),s=Y(e,"b","greater");return t=Yr(r,s),r=t[0],s=t[1],zn(r.shape,s.shape),ge.runKernelFunc((function(o){return o.greater(r,s)}),{a:r,b:s},null,"Greater")}}),WF=ie({greaterEqual_:function(n,e){var t,r=Y(n,"a","greaterEqual"),s=Y(e,"b","greaterEqual");return t=Yr(r,s),r=t[0],s=t[1],zn(r.shape,s.shape),ge.runKernelFunc((function(o,i){var a=o.greaterEqual(r,s);return i([r,s]),a}),{a:r,b:s},(function(o,i){var a=i[0],l=i[1];return{a:function(){return Yn(a)},b:function(){return Yn(l)}}}),"GreaterEqual")}}),hse=ie({greaterEqualStrict_:function(n,e){var t=Y(n,"a","greaterEqualStrict"),r=Y(e,"b","greaterEqualStrict");return pr(t.shape,r.shape,"Error in greaterEqualStrict: "),t.greaterEqual(r)}}),pse=ie({greaterStrict_:function(n,e){var t=Y(n,"a","greaterStrict"),r=Y(e,"b","greaterStrict");return pr(t.shape,r.shape,"Error in greaterStrict: "),t.greater(r)}}),mse=ie({less_:function(n,e){var t,r=Y(n,"a","less"),s=Y(e,"b","less");return t=Yr(r,s),r=t[0],s=t[1],zn(r.shape,s.shape),ge.runKernelFunc((function(o){return o.less(r,s)}),{a:r,b:s},null,"Less")}}),gse=ie({lessEqual_:function(n,e){var t,r=Y(n,"a","lessEqual"),s=Y(e,"b","lessEqual");return t=Yr(r,s),r=t[0],s=t[1],zn(r.shape,s.shape),ge.runKernelFunc((function(o,i){var a=o.lessEqual(r,s);return i([r,s]),a}),{a:r,b:s},null,"LessEqual")}}),xse=ie({lessEqualStrict_:function(n,e){var t=Y(n,"a","lessEqualStrict"),r=Y(e,"b","lessEqualStrict");return pr(t.shape,r.shape,"Error in lessEqualStrict: "),t.lessEqual(r)}}),vse=ie({lessStrict_:function(n,e){var t=Y(n,"a","lessStrict"),r=Y(e,"b","lessStrict");return pr(t.shape,r.shape,"Error in lessStrict: "),t.less(r)}}),yse=ie({notEqual_:function(n,e){var t,r=Y(n,"a","notEqual"),s=Y(e,"b","notEqual");return t=Yr(r,s),r=t[0],s=t[1],zn(r.shape,s.shape),ge.runKernelFunc((function(o){return o.notEqual(r,s)}),{a:r,b:s},null,"NotEqual")}}),bse=ie({notEqualStrict_:function(n,e){var t=Y(n,"a","notEqualStrict"),r=Y(e,"b","notEqualStrict");return pr(t.shape,r.shape,"Error in notEqualStrict: "),t.notEqual(r)}});function bT(n,e){for(var t=[],r=n;r<e;++r)t.push(r);return t}function wT(n){for(var e=[],t=0;t<n.length;++t)for(var r=0;r<n[t].length;++r)e.push(n[t][r]);return e}var u6=ie({gather_:function(n,e,t){t===void 0&&(t=0);var r=Y(n,"x","gather"),s=Y(e,"indices","gather","int32");t=zs(t,r.shape)[0];var o=(function(i,a,l){for(var c=i.shape[l],u=[],d=1,f=1,p=0;p<l;p++)u.push(i.shape[p]),d*=i.shape[p];for(p=0;p<a.rank;p++)u.push(a.shape[p]);for(p=l+1;p<i.rank;p++)u.push(i.shape[p]),f*=i.shape[p];return{batchSize:d,sliceSize:f,dimSize:c,outputShape:u}})(r,s,t);return ge.runKernelFunc((function(i,a){var l=i.gather(r,s.flatten(),t);return a([s]),l}),{x:r,indices:s},(function(i,a){var l=a[0];return{x:function(){var c=r.shape,u=l.size,d=c.slice(0,t),f=d.length,p=c.slice(t,c.length).slice(1),x=p.length,v=bT(0,f),y=bT(f+1,f+1+x),b=wT([d,[u],p]),w=i.reshape(b),S=l.reshape([u]),k=wT([[f],v,y]),N=w.transpose(k),I=UF(N,S,r.shape[t]),T=Yk(k);return I=I.transpose(T)},indices:function(){return l}}}),"Gather",{axis:t}).reshape(o.outputShape)}}),UF=ie({unsortedSegmentSum_:function(n,e,t){var r=Y(n,"x","unsortedSegmentSum"),s=Y(e,"segmentIds","unsortedSegmentSum","int32");return ee(hs(t),(function(){return"numSegments must be of dtype int"})),ge.runKernelFunc((function(o,i){var a=o.unsortedSegmentSum(r,s,t);return i([s]),a}),{$x:r},(function(o,i){var a=i[0];return{$x:function(){return(function(l,c){for(var u=c6(c,Yn(c)),d=u6(l,u),f=WF(c,St(0,"int32")),p=d.rank-f.rank,x=0;x<p;++x)f=ka(f,x+1);f=Ay(f,Kp(d.shape,"bool"));var v=Yn(d);return kf(f,d,v)})(o,a)}}}))}}),wse=function(n,e,t){return Vt(this,void 0,void 0,(function(){var r,s,o,i,a,l,c,u,d,f,p,x,v;return zt(this,(function(y){switch(y.label){case 0:for(r=Y(n,"tensor","boolMask"),s=Y(e,"mask","boolMask","bool"),o=t??0,i=s.rank,a=r.shape,ee(i>0,(function(){return"mask cannot be scalar"})),pr(a.slice(o,o+i),s.shape,"mask's shape must match the first K dimensions of tensor's shape,"),l=1,c=o;c<o+i;c++)l*=a[c];return u=a.slice(0,o).concat([l],a.slice(o+i)),d=r.reshape(u),f=s.reshape([-1]),[4,jF(f)];case 1:return p=y.sent(),x=p.squeeze([1]),v=u6(d,x,o),n!==r&&r.dispose(),e!==s&&s.dispose(),x.dispose(),d.dispose(),f.dispose(),p.dispose(),[2,v]}}))}))};function HF(n,e,t,r,s,o,i){o===void 0&&(o="NHWC"),ee(n.length===e.rank,(function(){return"Length of inShape ("+n.length+") and rank of dy ("+e.rank+") must match"}));var a=n,l=e,c=!1;e.rank===3&&(c=!0,l=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),a=[1,n[0],n[1],n[2]]),ee(a.length===4,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+a.length+"."})),ee(l.rank===4,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+l.rank})),ee(t.rank===4,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+t.rank}));var u=o==="NHWC"?a[3]:a[1],d=o==="NHWC"?l.shape[3]:l.shape[1];ee(u===t.shape[2],(function(){return"Error in conv2dDerInput: depth of input ("+u+") must match input depth for filter "+t.shape[2]+"."})),ee(d===t.shape[3],(function(){return"Error in conv2dDerInput: depth of output ("+d+") must match output depth for filter "+t.shape[3]+"."})),i!=null&&ee(hs(s),(function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+s+"."}));var f=t6(o),p=Uf(a,t.shape,r,1,s,i,!1,f),x=ge.runKernelFunc((function(v,y){var b=v.conv2dDerInput(l,t,p);return y([t,l]),b}),{dy4D:l,filter:t},(function(v,y){var b=y[0],w=y[1];return{dy4D:function(){return Aa(v,b,r,s,o,1,i)},filter:function(){return d6(v,w,b.shape,r,s,o,i)}}}));return c?x.as3D(x.shape[1],x.shape[2],x.shape[3]):x}function KC(n){var e=(function(o){return typeof o=="number"?[o,o,o]:o.length===2?[o[0],o[1],1]:o})(n),t=e[0],r=e[1],s=e[2];return t===1&&r===1&&s===1}function GF(n,e,t,r,s){ee(n.length===e.rank,(function(){return"Length of inShape ("+n.length+") and rank of dy ("+e.rank+") must match"}));var o=n,i=e,a=!1;e.rank===4&&(a=!0,i=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]),o=[1,n[0],n[1],n[2],n[3]]);var l=o[4],c=i.shape[4];ee(o.length===5,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+o.length+"."})),ee(i.rank===5,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+i.rank})),ee(t.rank===5,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+t.rank})),ee(l===t.shape[3],(function(){return"Error in conv3dDerInput: depth of input ("+l+") must match input depth for filter "+t.shape[3]+"."})),ee(c===t.shape[4],(function(){return"Error in conv3dDerInput: depth of output ("+c+") must match output depth for filter "+t.shape[4]+"."}));var u=k2(o,t.shape,r,1,s),d=ge.runKernelFunc((function(f){return f.conv3dDerInput(i,t,u)}),{dy5D:i});return a?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}var Cse=ie({conv1d_:function(n,e,t,r,s,o,i){s===void 0&&(s="NWC"),o===void 0&&(o=1);var a=Y(n,"x","conv1d"),l=Y(e,"filter","conv1d"),c=a,u=!1;a.rank===2&&(u=!0,c=a.as3D(1,a.shape[0],a.shape[1])),ee(c.rank===3,(function(){return"Error in conv1d: input must be rank 3, but got rank "+c.rank+"."})),ee(l.rank===3,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+l.rank+"."})),i!=null&&ee(hs(r),(function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."})),ee(c.shape[2]===l.shape[1],(function(){return"Error in conv1d: depth of input ("+c.shape[2]+") must match input depth for filter "+l.shape[1]+"."})),ee(Ni(t,o),(function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+t+" and dilation '"+o+"'"})),ee(s==="NWC",(function(){return"Error in conv1d: got dataFormat of "+s+" but only NWC is currently supported."}));var d=l.as4D(1,l.shape[0],l.shape[1],l.shape[2]),f=c.as4D(c.shape[0],1,c.shape[1],c.shape[2]),p=Aa(f,d,[1,t],r,"NHWC",[1,o],i);return u?p.as2D(p.shape[2],p.shape[3]):p.as3D(p.shape[0],p.shape[2],p.shape[3])}}),Aa=ie({conv2d_:function(n,e,t,r,s,o,i){s===void 0&&(s="NHWC"),o===void 0&&(o=[1,1]);var a=Y(n,"x","conv2d"),l=Y(e,"filter","conv2d"),c=a,u=!1;a.rank===3&&(u=!0,c=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),ee(c.rank===4,(function(){return"Error in conv2d: input must be rank 4, but got rank "+c.rank+"."})),ee(l.rank===4,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+l.rank+"."})),i!=null&&ee(hs(r),(function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}));var d=s==="NHWC"?c.shape[3]:c.shape[1];ee(d===l.shape[2],(function(){return"Error in conv2d: depth of input ("+d+") must match input depth for filter "+l.shape[2]+"."})),ee(Ni(t,o),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}));var f=t6(s),p=Uf(c.shape,l.shape,t,o,r,i,!1,f),x=[l,c],v=ge.runKernelFunc((function(y,b){var w=y.conv2d(c,l,p);return b([l,c]),w}),{x:c,filter:l},(function(y,b){var w=b,S=w[0],k=w[1];return ee(Tp(o),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"})),{x:function(){return qF(k.shape,y,S,t,r,s)},filter:function(){return d6(k,y,S.shape,t,r,s)}}}),"Conv2D",p,x);return u?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),kse=ie({conv3d_:function(n,e,t,r,s,o){s===void 0&&(s="NDHWC"),o===void 0&&(o=[1,1,1]);var i=Y(n,"x","conv3d"),a=Y(e,"filter","conv3d"),l=i,c=!1;i.rank===4&&(c=!0,l=i.as5D(1,i.shape[0],i.shape[1],i.shape[2],i.shape[3])),ee(l.rank===5,(function(){return"Error in conv3d: input must be rank 5, but got rank "+l.rank+"."})),ee(a.rank===5,(function(){return"Error in conv3d: filter must be rank 5, but got rank "+a.rank+"."})),ee(l.shape[4]===a.shape[3],(function(){return"Error in conv3d: depth of input ("+l.shape[4]+") must match input depth for filter "+a.shape[3]+"."})),ee((function(f,p){return KC(f)||KC(p)})(t,o),(function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"})),ee(s==="NDHWC",(function(){return"Error in conv3d: got dataFormat of "+s+" but only NDHWC is currently supported."}));var u=k2(l.shape,a.shape,t,o,r),d=ge.runKernelFunc((function(f,p){var x=f.conv3d(l,a,u);return p([l,a]),x}),{x:l,$filter:a},(function(f,p){ee(KC(o),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"}));var x=p[0],v=p[1];return{x:function(){return GF(x.shape,f,v,t,r)},$filter:function(){return(function(y,b,w,S,k){var N=y;y.rank===4&&(N=y.as5D(1,y.shape[0],y.shape[1],y.shape[2],y.shape[3]));var I=b;I.rank===4&&(I=b.as5D(1,b.shape[0],b.shape[1],b.shape[2],b.shape[3])),ee(N.rank===5,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+N.shape+"."})),ee(I.rank===5,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+I.shape+"."})),ee(w.length===5,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+w+"."})),ee(N.shape[4]===w[3],(function(){return"Error in conv3dDerFilter: depth of input "+N.shape[4]+") must match input depth in filter ("+w[3]+"."})),ee(I.shape[4]===w[4],(function(){return"Error in conv3dDerFilter: depth of dy ("+I.shape[4]+") must match output depth for filter ("+w[4]+")."}));var T=k2(N.shape,w,S,1,k);return ge.runKernelFunc((function(F){return F.conv3dDerFilter(N,I,T)}),{x5D:N,dy5D:I})})(x,f,v.shape,t,r)}}}));return c?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),d6=ie({conv2dDerFilter_:function(n,e,t,r,s,o,i){o===void 0&&(o="NHWC");var a=n;n.rank===3&&(a=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var l=e;l.rank===3&&(l=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),ee(a.rank===4,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+a.shape+"."})),ee(l.rank===4,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+l.shape+"."})),ee(t.length===4,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+t+"."}));var c=o==="NHWC"?a.shape[3]:a.shape[1],u=o==="NHWC"?l.shape[3]:l.shape[1];ee(c===t[2],(function(){return"Error in conv2dDerFilter: depth of input "+c+") must match input depth in filter ("+t[2]+"."})),ee(u===t[3],(function(){return"Error in conv2dDerFilter: depth of dy ("+u+") must match output depth for filter ("+t[3]+")."})),i!=null&&ee(hs(s),(function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+s+"."}));var d=t6(o),f=Uf(a.shape,t,r,1,s,i,!1,d);return ge.runKernelFunc((function(p){return p.conv2dDerFilter(a,l,f)}),{x4D:a,dy4D:l})}}),qF=ie({conv2dDerInput_:HF}),$y=ie({depthwiseConv2d_:function(n,e,t,r,s,o,i){o===void 0&&(o=[1,1]);var a=Y(n,"x","depthwiseConv2d"),l=Y(e,"filter","depthwiseConv2d"),c=a,u=!1;a.rank===3&&(u=!0,c=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),ee(c.rank===4,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+c.rank+"."})),ee(l.rank===4,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+l.rank+"."})),ee(c.shape[3]===l.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels ("+c.shape[3]+") must match the inChannels dimension in filter "+l.shape[2]+"."})),o==null&&(o=[1,1]),ee(Ni(t,o),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"})),i!=null&&ee(hs(r),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}));var d=Uf(c.shape,l.shape,t,o,r,i,!0),f=[c,l],p=ge.runKernelFunc((function(x,v){var y=x.depthwiseConv2D(c,l,d);return v([c,l]),y}),{x:c,filter:l},(function(x,v){ee(Tp(o),(function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+o+"'"}));var y=v[0],b=v[1];return{x:function(){return KF(y.shape,x,b,d)},filter:function(){return XF(y,x,b.shape,d)}}}),"DepthwiseConv2dNative",d,f);return u?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}}),KF=ie({depthwiseConv2dDerInput_:function(n,e,t,r){var s=e,o=!1;e.rank===3&&(o=!0,s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var i=ge.runKernelFunc((function(a){return a.depthwiseConv2DDerInput(s,t,r)}),{dy4D:s});return o?i.as3D(i.shape[1],i.shape[2],i.shape[3]):i}}),XF=ie({depthwiseConv2dDerFilter_:function(n,e,t,r){var s=n;n.rank===3&&(s=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var o=e;return o.rank===3&&(o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),ge.runKernelFunc((function(i){return i.depthwiseConv2DDerFilter(s,o,r)}),{x4D:s,dy4D:o})}}),f6=ie({separableConv2d_:function(n,e,t,r,s,o,i){o===void 0&&(o=[1,1]),i===void 0&&(i="NHWC");var a=Y(n,"x","separableConv2d"),l=Y(e,"depthwiseFilter","separableConv2d"),c=Y(t,"pointwiseFilter","separableConv2d"),u=a,d=!1;if(a.rank===3&&(d=!0,u=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),i==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");ee(u.rank===4,(function(){return"Error in separableConv2d: input must be rank 4, but got rank "+u.rank+"."})),ee(l.rank===4,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+l.rank+"."})),ee(c.rank===4,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+l.rank+"."})),ee(c.shape[0]===1,(function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+c.shape[0]+"."})),ee(c.shape[1]===1,(function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+c.shape[1]+"."}));var f=l.shape[2],p=l.shape[3];ee(c.shape[2]===f*p,(function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+f*p+", but got "+c.shape[2]+"."}));var x=$y(u,l,r,s,i,o),v=Aa(x,c,1,"valid",i);return d?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),Sse=ie({conv2dTranspose_:function(n,e,t,r,s,o){return HF(t,Y(n,"x","conv2dTranspose"),Y(e,"filter","conv2dTranspose"),r,s,"NHWC",o)}}),Nse=ie({conv3dTranspose_:function(n,e,t,r,s){return GF(t,Y(n,"x","conv3dTranspose"),Y(e,"filter","conv3dTranspose"),r,s)}}),Fy=ie({matMul_:function(n,e,t,r){var s;t===void 0&&(t=!1),r===void 0&&(r=!1);var o=Y(n,"a","matMul"),i=Y(e,"b","matMul");s=Yr(o,i),o=s[0],i=s[1];var a=t?o.shape[o.rank-2]:o.shape[o.rank-1],l=r?i.shape[i.rank-1]:i.shape[i.rank-2],c=t?o.shape[o.rank-1]:o.shape[o.rank-2],u=r?i.shape[i.rank-2]:i.shape[i.rank-1],d=o.shape.slice(0,-2),f=i.shape.slice(0,-2),p=Xt(d),x=Xt(f);ee(o.rank>=2&&i.rank>=2&&o.rank===i.rank,(function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+o.rank+" and "+i.rank+"."})),ee(eo(d,f),(function(){return"Error in matMul: outer dimensions ("+d+") and ("+f+") of Tensors with shapes "+o.shape+" and "+i.shape+" must match."})),ee(a===l,(function(){return"Error in matMul: inner shapes ("+a+") and ("+l+") of Tensors with shapes "+o.shape+" and "+i.shape+" and transposeA="+t+" and transposeB="+r+" must match."}));var v=o.shape.slice(0,-2).concat([c,u]),y=t?o.as3D(p,a,c):o.as3D(p,c,a),b=r?i.as3D(x,u,l):i.as3D(x,l,u),w={transposeA:t,transposeB:r};return ge.runKernelFunc((function(S,k){var N=S.batchMatMul(y,b,t,r);return k([y,b]),N}),{a:y,b},(function(S,k){var N=k,I=N[0],T=N[1];return t||r?!t&&r?{a:function(){return S.matMul(T,!1,!1)},b:function(){return S.matMul(I,!0,!1)}}:t&&!r?{a:function(){return T.matMul(S,!1,!0)},b:function(){return I.matMul(S,!1,!1)}}:{a:function(){return T.matMul(S,!0,!0)},b:function(){return S.matMul(I,!0,!0)}}:{a:function(){return S.matMul(T,!1,!0)},b:function(){return I.matMul(S,!0,!1)}}}),"BatchMatMul",w).reshape(v)}}),Ese=ie({dot_:function(n,e){var t=Y(n,"t1","dot"),r=Y(e,"t2","dot");ee(!(t.rank!==1&&t.rank!==2||r.rank!==1&&r.rank!==2),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+t.rank+" and "+r.rank+"."}));var s=t.rank===1?t.size:t.shape[1],o=r.rank===1?r.size:r.shape[0];return ee(s===o,(function(){return"Error in dot: inner dimensions of inputs must match, but got "+s+" and "+o+"."})),t.rank===1&&r.rank===1?t.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():t.rank===1&&r.rank===2?t.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():t.rank===2&&r.rank===1?t.matMul(r.as2D(-1,1)).as1D():t.matMul(r.as2D(r.shape[0],r.shape[1]))}}),Ise=ie({outerProduct_:function(n,e){var t=Y(n,"v1","outerProduct"),r=Y(e,"v2","outerProduct");return ee(t.rank===1&&r.rank===1,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+t.rank+" and "+r.rank+"."})),t.as2D(-1,1).matMul(r.as2D(1,-1))}}),s1=ie({reverse_:function(n,e){var t=Y(n,"x","reverse");if(t.rank===0)return t.clone();var r=zs(e,t.shape);return ge.runKernelFunc((function(s){return s.reverse(t,r)}),{$x:t},(function(s){return{$x:function(){return s.reverse(r)}}})).reshapeAs(t)}}),Tse=ie({reverse1d_:function(n){var e=Y(n,"x","reverse");return ee(e.rank===1,(function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."})),s1(e,0)}}),_se=ie({reverse2d_:function(n,e){var t=Y(n,"x","reverse");return ee(t.rank===2,(function(){return"Error in reverse2D: x must be rank 2 but got rank "+t.rank+"."})),s1(t,e)}}),Rse=ie({reverse3d_:function(n,e){var t=Y(n,"x","reverse");return ee(t.rank===3,(function(){return"Error in reverse3D: x must be rank 3 but got rank "+t.rank+"."})),s1(t,e)}}),Dse=ie({reverse4d_:function(n,e){var t=Y(n,"x","reverse");return ee(t.rank===4,(function(){return"Error in reverse4D: x must be rank 4 but got rank "+t.rank+"."})),s1(t,e)}});function YF(n,e,t,r,s,o){var i=Y(n,"x","maxPool"),a=i,l=!1;i.rank===3&&(l=!0,a=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),ee(a.rank===4,(function(){return"Error in maxPool: input must be rank 4 but got rank "+a.rank+"."})),ee(Ni(t,r),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"})),o!=null&&ee(hs(s),(function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+s+"."}));var c=Rg(a.shape,e,t,r,s,o);if(c.filterWidth===1&&c.filterHeight===1&&eo(c.inShape,c.outShape))return i.clone();var u=[a],d=ge.runKernelFunc((function(f,p){var x=f.maxPool(a,c);return p([a,x]),x}),{x:a},(function(f,p){var x=p[0],v=p[1];return{x:function(){return(function(y,b,w,S,k,N,I,T){var F=Y(y,"dy","maxPoolBackprop"),R=Y(b,"input","maxPoolBackprop"),D=Y(w,"output","maxPoolBackprop");ee(R.rank===F.rank,(function(){return"Rank of input ("+R.rank+") does not match rank of dy ("+F.rank+")"})),ee(Ni(k,N),(function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+k+" and dilations '"+N+"'"})),ee(F.rank===4,(function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+F.rank+"."})),ee(R.rank===4,(function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+R.rank+"."}));var A=Rg(R.shape,S,k,N,I,T);return ge.runKernelFunc((function(P){return P.maxPoolBackprop(F,R,D,A)}),{$dy:F,$input:R})})(f,x,v,e,t,r,s)}}}),"MaxPool",c,u);return l?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function ZF(n,e,t,r,s,o){var i=Y(n,"x","avgPool","float32");ee(Ni(t,r),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"}));var a=i,l=!1;i.rank===3&&(l=!0,a=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),ee(a.rank===4,(function(){return"Error in avgPool: x must be rank 4 but got rank "+a.rank+"."})),o!=null&&ee(hs(s),(function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+s+"."}));var c=Rg(a.shape,e,t,r,s,o);if(c.filterWidth===1&&c.filterHeight===1&&eo(c.inShape,c.outShape))return i.clone();var u=ge.runKernelFunc((function(d){return d.avgPool(a,c)}),{x:a},(function(d){return{x:function(){return(function(f,p,x,v,y,b){var w=Y(f,"dy","avgPoolBackprop"),S=Y(p,"input","avgPoolBackprop");ee(S.rank===w.rank,(function(){return"Rank of input ("+S.rank+") does not match rank of dy ("+w.rank+")"})),ee(Ni(v,y),(function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+v+" and dilations '"+y+"'"}));var k=S,N=w,I=!1;S.rank===3&&(I=!0,k=S.as4D(1,S.shape[0],S.shape[1],S.shape[2]),N=w.as4D(1,w.shape[0],w.shape[1],w.shape[2])),ee(N.rank===4,(function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+N.rank+"."})),ee(k.rank===4,(function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+k.rank+"."}));var T=Rg(k.shape,x,v,y,b),F=ge.runKernelFunc((function(R){return R.avgPoolBackprop(N,k,T)}),{dy4D:N,input4D:k});return I?F.as3D(F.shape[1],F.shape[2],F.shape[3]):F})(d,a,e,t,r,s)}}}),"AvgPool",c);return u=u.cast(i.dtype),l?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}var Js=ie({maxPool_:function(n,e,t,r,s){return YF(n,e,t,1,r,s)}}),o1=ie({avgPool_:function(n,e,t,r,s){return ZF(n,e,t,1,r,s)}}),Ase=ie({pool_:function(n,e,t,r,s,o){s==null&&(s=[1,1]),o==null&&(o=1),r===0&&(r="valid");var i=Y(n,"x","maxPool"),a=i,l=!1;i.rank===3&&(l=!0,a=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),ee(Ni(o,s),(function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+s+"'"}));var c,u=Rg(a.shape,e,o,s,r),d=[u.dilationHeight,u.dilationWidth];c=r==="same"?(function(k,N){var I=k.map((function(R,D){return R+(R-1)*(N[D]-1)})).map((function(R){return R-1})),T=I.map((function(R){return Math.floor(R/2)})),F=I.map((function(R,D){return R-T[D]}));return I.map((function(R,D){return[T[D],F[D]]}))})([u.filterHeight,u.filterWidth],d):[[0,0],[0,0]];var f=d[0]===1&&d[1]===1,p=(function(k,N,I){var T=I.map((function(L){return L[0]})),F=I.map((function(L){return L[1]})),R=k.concat(T,F),D=N.map((function(L,W){return(L-R[W]%L)%L})),A=F.map((function(L,W){return L+D[W]})),P=N.map((function(L,W){return[T[W],A[W]]})),B=N.map((function(L,W){return[0,D[W]]}));return[P,B]})([u.inHeight,u.inWidth],d,c),x=p[0],v=p[1],y=f?r:"valid",b=f?a:rF(a,d,x),w=(t==="avg"?function(){return ZF(b,e,o,1,y)}:function(){return YF(b,e,o,1,y)})(),S=f?w:eF(w,d,v);return l?S.as3D(S.shape[1],S.shape[2],S.shape[3]):S}}),$se=ie({maxPool3d_:function(n,e,t,r,s,o,i){o===void 0&&(o="NDHWC");var a=Y(n,"x","maxPool3d"),l=a,c=!1;a.rank===4&&(c=!0,l=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),i==null&&(i=[1,1,1]),ee(l.rank===5,(function(){return"Error in maxPool3d: x must be rank 5 but got rank "+l.rank+"."})),ee(o==="NDHWC",(function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+o})),ee(Ni(t,i),(function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+i+"'"})),s!=null&&ee(hs(r),(function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."}));var u=C2(l.shape,e,t,i,r,s,o),d=ge.runKernelFunc((function(f,p){var x=f.maxPool3d(l,u);return p([l,x]),x}),{x:l},(function(f,p){var x=p[0],v=p[1];return{x:function(){return(function(y,b,w,S,k,N,I,T){var F=Y(y,"dy","maxPool3dBackprop"),R=Y(b,"input","maxPool3dBackprop"),D=Y(w,"output","maxPool3dBackprop"),A=F,P=R,B=D,L=!1;R.rank===4&&(L=!0,A=F.as5D(1,F.shape[0],F.shape[1],F.shape[2],F.shape[3]),P=R.as5D(1,R.shape[0],R.shape[1],R.shape[2],R.shape[3]),B=D.as5D(1,D.shape[0],D.shape[1],D.shape[2],D.shape[3])),ee(A.rank===5,(function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+A.rank+"."})),ee(P.rank===5,(function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+P.rank+"."})),ee(B.rank===5,(function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+B.rank+"."})),N==null&&(N=[1,1,1]),ee(Ni(k,N),(function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+k+" and dilations '"+N+"'"})),T!=null&&ee(hs(I),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+T+" but got pad "+I+"."}));var W=C2(P.shape,S,k,N,I,T),H=ge.runKernelFunc((function(G){return G.maxPool3dBackprop(A,P,B,W)}),{dy5D:A,input5D:P});return L?H.as4D(H.shape[1],H.shape[2],H.shape[3],H.shape[4]):H})(f,x,v,e,t,i,r,s)}}}));return c?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),Fse=ie({avgPool3d_:function(n,e,t,r,s,o,i){o===void 0&&(o="NDHWC");var a=Y(n,"x","avgPool3d","float32"),l=a,c=!1;a.rank===4&&(c=!0,l=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),i==null&&(i=[1,1,1]),ee(l.rank===5,(function(){return"Error in avgPool3d: x must be rank 5 but got rank "+l.rank+"."})),ee(o==="NDHWC",(function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+o})),ee(Ni(t,i),(function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+i+"'"})),s!=null&&ee(hs(r),(function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."}));var u=C2(l.shape,e,t,i,r,s,o),d=ge.runKernelFunc((function(f){return f.avgPool3d(l,u)}),{x:l},(function(f){return{x:function(){return(function(p,x,v,y,b,w,S){var k=Y(p,"dy","avgPool3dBackprop"),N=Y(x,"input","avgPool3dBackprop"),I=k,T=N,F=!1;N.rank===4&&(F=!0,I=k.as5D(1,k.shape[0],k.shape[1],k.shape[2],k.shape[3]),T=N.as5D(1,N.shape[0],N.shape[1],N.shape[2],N.shape[3])),ee(I.rank===5,(function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+I.rank+"."})),ee(T.rank===5,(function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+T.rank+"."})),b==null&&(b=[1,1,1]),ee(Ni(y,b),(function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+y+" and dilations '"+b+"'"})),S!=null&&ee(hs(w),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+S+" but got pad "+w+"."}));var R=C2(T.shape,v,y,b,w,S),D=ge.runKernelFunc((function(A){return A.avgPool3dBackprop(I,T,R)}),{dy5D:I,input5D:T});return F?D.as4D(D.shape[1],D.shape[2],D.shape[3],D.shape[4]):D})(f,l,e,t,i,r,s)}}}));return d=d.cast(l.dtype),c?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),ic=ie({slice_:function(n,e,t){var r,s,o=Y(n,"x","slice");if(o.rank===0)throw new Error("Slicing scalar is not possible");(r=typeof e=="number"?[e].concat(new Array(o.rank-1).fill(0)):e.length<o.rank?e.concat(new Array(o.rank-e.length).fill(0)):e.slice()).forEach((function(l){ee(l!==-1,(function(){return"slice() does not support negative begin indexing."}))})),s=(s=t==null?new Array(o.rank).fill(-1):typeof t=="number"?[t].concat(new Array(o.rank-1).fill(-1)):t.length<o.rank?t.concat(new Array(o.rank-t.length).fill(-1)):t).map((function(l,c){return l>=0?l:(ee(l===-1,(function(){return"Negative size values should be exactly -1 but got "+l+" for the slice() size at index "+c+"."})),o.shape[c]-r[c])})),lte(o,r,s);var i=o.shape,a={begin:r,size:s};return ge.runKernelFunc((function(l){return l.slice(o,r,s)}),{x:o},(function(l){for(var c=[],u=0;u<l.rank;u++)c.push([r[u],i[u]-r[u]-s[u]]);return{x:function(){return l.pad(c)}}}),"Slice",a)}}),Pse=ie({slice1d_:function(n,e,t){var r=Y(n,"x","slice1d");return ee(r.rank===1,(function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"})),ic(r,[e],[t])}}),Ose=ie({slice2d_:function(n,e,t){var r=Y(n,"x","slice2d");return ee(r.rank===2,(function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"})),ic(r,e,t)}}),JF=ie({slice3d_:function(n,e,t){var r=Y(n,"x","slice3d");return ee(r.rank===3,(function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"})),ic(r,e,t)}}),Mse=ie({slice4d_:function(n,e,t){var r=Y(n,"x","slice4d");return ee(r.rank===4,(function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"})),ic(r,e,t)}});function QF(n,e,t,r,s){return e.rank<t.rank&&(e=e.reshape(Si(e.shape,r))),n.rank<t.rank&&(n=n.reshape(Si(n.shape,r))),{x:function(){var o=n.mul(t.equal(e).cast(n.dtype));return s==null?o:o.transpose(s)}}}var Lse=ie({all_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=Y(n,"x","all","bool"),s=zs(e,r.shape),o=s,i=mc(o,r.rank);i!=null&&(r=r.transpose(i),o=gc(o.length,r.rank));var a=ge.runKernelFunc((function(c){return c.all(r,o)}),{$x:r});if(t){var l=Si(a.shape,s);return a.reshape(l)}return a}}),jse=ie({any_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=Y(n,"x","any","bool"),s=zs(e,r.shape),o=s,i=mc(o,r.rank);i!=null&&(r=r.transpose(i),o=gc(o.length,r.rank));var a=ge.runKernelFunc((function(c){return c.any(r,o)}),{$x:r});if(t){var l=Si(a.shape,s);return a.reshape(l)}return a}}),Bse=ie({argMax_:function(n,e){e===void 0&&(e=0);var t=Y(n,"x","argMax");e==null&&(e=0);var r=zs(e,t.shape),s=mc(r,t.rank);s!=null&&(t=t.transpose(s),r=gc(r.length,t.rank));var o={axis:r[0]},i=[t];return ge.runKernelFunc((function(a,l){var c=a.argMax(t,r[0]);return l([t]),c}),{x:t},(function(a,l){var c=l[0];return{x:function(){return Yn(c)}}}),"ArgMax",o,i)}}),Vse=ie({argMin_:function(n,e){e===void 0&&(e=0);var t=Y(n,"x","argMin");e==null&&(e=0);var r=zs(e,t.shape),s=mc(r,t.rank);return s!=null&&(t=t.transpose(s),r=gc(r.length,t.rank)),ge.runKernelFunc((function(o,i){var a=o.argMin(t,r[0]);return i([t]),a}),{$x:t},(function(o,i){var a=i[0];return{$x:function(){return Yn(a)}}}))}}),zse=ie({logSumExp_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=Y(n,"x","logSumExp"),s=zs(e,r.shape),o=r.max(s,!0),i=r.sub(o).exp().sum(s).log(),a=o.reshape(i.shape).add(i);if(t){var l=Si(a.shape,s);return a.reshape(l)}return a}}),Py=ie({max_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=Y(n,"x","max"),s=r,o=zs(e,r.shape),i=o,a=mc(i,r.rank);a!=null&&(r=r.transpose(a),i=gc(i.length,r.rank));var l=[r],c=ge.runKernelFunc((function(d,f){var p=d.max(r,i);return f([s,p]),p}),{x:r},(function(d,f){return QF(d,f[1],f[0],o,a)}),"Max",{axes:i},l,[!0]);if(t){var u=Si(c.shape,o);c=c.reshape(u)}return c}}),Wse=ie({mean_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=Y(n,"x","mean"),s=zs(e,r.shape),o=Xt(Do(r.shape,s)[1]);return Ry((function(i){var a=St(o);return{value:(a.dtype===i.dtype?i:i.cast(a.dtype)).div(a).sum(e,t),gradFunc:function(l){var c=i.shape.slice();return s.forEach((function(u){c[u]=1})),l.reshape(c).mul(Kp(i.shape,"float32")).div(o)}}}))(r)}}),Use=ie({min_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=Y(n,"x","min"),s=r,o=zs(e,r.shape),i=o,a=mc(i,r.rank);a!=null&&(r=r.transpose(a),i=gc(i.length,r.rank));var l=[r],c=ge.runKernelFunc((function(d,f){var p=d.min(r,i);return f([s,p]),p}),{x:r},(function(d,f){return QF(d,f[1],f[0],o,a)}),"Min",{axes:i},l,[!0]);if(t){var u=Si(c.shape,o);c=c.reshape(u)}return c}}),Hse=ie({moments_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=zs(e,(n=Y(n,"x","moments")).shape),s=n.mean(r,t),o=s.shape;t||(o=Si(s.shape,r));var i=n.toFloat().sub(s.reshape(o)).square();return{mean:s,variance:i.mean(r,t)}}}),eP=ie({sum_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=Y(n,"x","sum");r.dtype==="bool"&&(r=r.toInt());var s=zs(e,r.shape);return Ry((function(o){var i=mc(s,o.rank),a=s,l=o;i!=null&&(l=o.transpose(i),a=gc(a.length,o.rank));var c=function(p){var x=o.shape.slice();return s.forEach((function(v){x[v]=1})),p.reshape(x).mul(Kp(o.shape,"float32"))},u={axes:a},d=ge.runKernelFunc((function(p){return p.sum(l,a)}),{x:l},(function(p){return{x:function(){return c(p)}}}),"Sum",u);if(t){var f=Si(d.shape,s);d=d.reshape(f)}return{value:d,gradFunc:c}}))(r)}}),Gse=ie({prod_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=Y(n,"x","prod");r.dtype==="bool"&&(r=r.toInt());var s=zs(e,r.shape),o=mc(s,r.rank),i=s,a=r;o!=null&&(a=r.transpose(o),i=gc(i.length,r.rank));var l=ge.runKernelFunc((function(u){return u.prod(a,i)}),{permutedX:a});if(t){var c=Si(l.shape,s);l=l.reshape(c)}return l}}),tP=ie({elu_:function(n){var e=Y(n,"x","elu");return ge.runKernelFunc((function(t,r){var s=t.elu(e);return r([s]),s}),{$x:e},(function(t,r){var s=r[0];return{$x:function(){return ge.runKernelFunc((function(o){return o.eluDer(t,s)}),{dy:t,y:s})}}}))}}),qse=ie({leakyRelu_:function(n,e){e===void 0&&(e=.2);var t=Y(n,"x","leakyRelu");return c6(St(e).mul(t),t)}}),nP=ie({prelu_:function(n,e){var t=Y(n,"x","prelu"),r=Y(e,"alpha","prelu");return ge.runKernelFunc((function(s,o){var i=s.prelu(t,r);return o([t,r]),i}),{x:t,alpha:r},(function(s,o){var i=o[0],a=o[1],l=i.greater(0);return{x:function(){return kf(l,s,s.mul(a))},alpha:function(){var c=kf(l,Yn(s),s.mul(i)),u=Bs(a.shape,s.shape);return u.length>0&&(c=c.sum(u)),c.reshape(a.shape)}}}),"Prelu")}}),Xr=ie({relu_:function(n){var e=Y(n,"x","relu");return e.dtype==="bool"?e.toInt():ge.runKernelFunc((function(t,r){var s=t.relu(e);return r([e]),s}),{x:e},(function(t,r){var s=r[0];return{x:function(){return t.mulStrict(s.step().toFloat())}}}),"Relu")}}),rP=ie({relu6_:function(n){var e=Y(n,"x","relu6");return e.dtype==="bool"?e.toInt():ge.runKernelFunc((function(t,r){var s=t.relu6(e);return r([e]),s}),{x:e},(function(t,r){var s=r[0],o=s.lessEqual(6).mul(s.step());return{x:function(){return t.mulStrict(o.toFloat())}}}),"Relu6")}}),Kse=ie({selu_:function(n){var e=Y(n,"x","selu");return ge.runKernelFunc((function(t,r){var s=t.selu(e);return r([e]),s}),{$x:e},(function(t,r){var s=r[0];return{$x:function(){var o=s.greater(St(0)),i=St(i6),a=St(a6),l=t.mul(a),c=t.mul(i).mul(s.toFloat().exp());return kf(o,l,c)}}}))}}),id=ie({transpose_:function(n,e){var t=Y(n,"x","transpose");if(e==null&&(e=t.shape.map((function(s,o){return o})).reverse()),ee(t.rank===e.length,(function(){return"Error in transpose: rank of input "+t.rank+" must match length of perm "+e+"."})),e.forEach((function(s){ee(s>=0&&s<t.rank,(function(){return"All entries in 'perm' must be between 0 and "+(t.rank-1)+" but got "+e}))})),t.rank<=1)return t.clone();var r={perm:e};return ge.runKernelFunc((function(s){return s.transpose(t,e)}),{x:t},(function(s){var o=Yk(e);return{x:function(){return s.transpose(o)}}}),"Transpose",r)}}),Xse=ie({localResponseNormalization_:function(n,e,t,r,s){e===void 0&&(e=5),t===void 0&&(t=1),r===void 0&&(r=1),s===void 0&&(s=.5);var o=Y(n,"x","localResponseNormalization");ee(o.rank===4||o.rank===3,(function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+o.rank+"."})),ee(hs(e),(function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+e+"."}));var i=o,a=!1;o.rank===3&&(a=!0,i=o.as4D(1,o.shape[0],o.shape[1],o.shape[2]));var l=ge.runKernelFunc((function(c,u){var d=c.localResponseNormalization4D(i,e,t,r,s);return u([i,d]),d}),{x4D:i},(function(c,u){var d=u[0],f=u[1];return{x4D:function(){return ge.runKernelFunc((function(p){return p.LRNGrad(c,d,f,e,t,r,s)}),{})}}}));return a?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}}),sP=ie({norm_:function(n,e,t,r){e===void 0&&(e="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1);var s=(function a(l,c,u){if(u===void 0&&(u=null),l.rank===0)return l.abs();if(l.rank!==1&&u===null)return a(l.reshape([-1]),c,u);if(l.rank===1||typeof u=="number"||Array.isArray(u)&&u.length===1){if(c===1)return l.abs().sum(u);if(c===1/0)return l.abs().max(u);if(c===-1/0)return l.abs().min(u);if(c==="euclidean"||c===2)return l.abs().pow(St(2,"int32")).sum(u).sqrt();throw new Error("Error in norm: invalid ord value: "+c)}if(Array.isArray(u)&&u.length===2){if(c===1)return l.abs().sum(u[0]).max(u[1]-1);if(c===1/0)return l.abs().sum(u[1]).max(u[0]);if(c===-1/0)return l.abs().sum(u[1]).min(u[0]);if(c==="fro"||c==="euclidean")return l.square().sum(u).sqrt();throw new Error("Error in norm: invalid ord value: "+c)}throw new Error("Error in norm: invalid axis: "+u)})(n=Y(n,"x","norm"),e,t),o=s.shape;if(r){var i=zs(t,n.shape);o=Si(s.shape,i)}return s.reshape(o)}}),Yse=ie({basicLSTMCell_:function(n,e,t,r,s,o){var i=Y(n,"forgetBias","basicLSTMCell"),a=Y(e,"lstmKernel","basicLSTMCell"),l=Y(t,"lstmBias","basicLSTMCell"),c=Y(r,"data","basicLSTMCell"),u=Y(s,"c","basicLSTMCell"),d=Y(o,"h","basicLSTMCell"),f=c.concat(d,1).matMul(a).add(l),p=f.shape[0],x=f.shape[1]/4,v=[p,x],y=f.slice([0,0],v),b=f.slice([0,x],v),w=f.slice([0,2*x],v),S=f.slice([0,3*x],v),k=y.sigmoid().mulStrict(b.tanh()).addStrict(u.mulStrict(i.add(w).sigmoid())),N=k.tanh().mulStrict(S.sigmoid());return[k,N]}}),Zse=ie({multiRNNCell_:function(n,e,t,r){for(var s=Y(e,"data","multiRNNCell"),o=g2(t,"c","multiRNNCell"),i=g2(r,"h","multiRNNCell"),a=s,l=[],c=0;c<n.length;c++){var u=n[c](a,o[c],i[c]);l.push(u[0]),l.push(u[1]),a=u[1]}var d=[],f=[];for(c=0;c<l.length;c+=2)d.push(l[c]),f.push(l[c+1]);return[d,f]}}),Jse=ie({movingAverage_:function(n,e,t,r,s){s===void 0&&(s=!0);var o=Y(n,"v","movingAverage"),i=Y(e,"x","movingAverage"),a=Y(t,"decay","movingAverage");XQ(o,i),ee(eo(o.shape,i.shape),(function(){return"Shape mismatch in v and x"}));var l=St(1),c=l.sub(a),u=i.sub(o).mul(c);if(s){ee(r!=null,(function(){return"When using zeroDebias: true, step is required."}));var d=Y(r,"step","movingAverage");u=u.div(l.sub(E2(a,d)))}return o.add(u)}}),Qse=ie({stridedSlice_:function(n,e,t,r,s,o,i,a,l){if(s===void 0&&(s=0),o===void 0&&(o=0),i===void 0&&(i=0),a===void 0&&(a=0),l===void 0&&(l=0),r==null&&(r=new Array(e.length)),i!==0)throw new Error("ellipsis mask is not yet supported");var c=Y(n,"x","stridedSlice"),u=eT(a),d=c.shape.slice();u.forEach((function(y){e[y]=0,t[y]=1,d.splice(y,0,1)})),c=c.reshape(d);for(var f=0;f<c.rank;f++)e[f]=cte(s,e,r,c.shape,f),t[f]=ute(o,t,r,c.shape,f),r[f]=r[f]||1;var p=eT(l);p.forEach((function(y){t[y]=e[y]+1,r[y]=1}));var x=e6(e,t,r),v=x.filter((function(y,b){return p.indexOf(b)===-1}));return r.every((function(y){return y===1}))?ic(c,e,x).reshape(v):ge.runKernelFunc((function(y){return y.stridedSlice(c,e,t,r)}),{$x:c}).reshape(v)}}),eoe=ie({topk_:function(n,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var r=Y(n,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var s=r.shape[r.shape.length-1];if(e>s)throw new Error("'k' passed to topk() must be <= the last dimension ("+s+") but got "+e);var o=ge.runKernelFunc((function(i){return i.topk(r,e,t)}),{$x:r});return{values:o[0],indices:o[1]}}}),toe=ie({scatterND_:function(n,e,t){var r=Y(n,"indices","scatterND","int32"),s=Y(e,"updates","scatterND");return ate(s,r,t),ge.runKernelFunc((function(o){return o.scatterND(r,s,t)}),{indices:r,updates:s},null,"ScatterNd",{shape:t})}}),h6=ie({fft_:function(n){ee(n.dtype==="complex64",(function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+n.dtype+"."}));var e=n.shape[n.shape.length-1],t=n.size/e,r=n.as2D(t,e);return ge.runKernelFunc((function(s){return s.fft(r)}),{input:n}).reshape(n.shape)}}),I2=ie({ifft_:function(n){ee(n.dtype==="complex64",(function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+n.dtype+"."}));var e=n.shape[n.shape.length-1],t=n.size/e,r=n.as2D(t,e);return ge.runKernelFunc((function(s){return s.ifft(r)}),{input:n}).reshape(n.shape)}}),p6=ie({rfft_:function(n,e){ee(n.dtype==="float32",(function(){return"The dtype for rfft() must be real value but got "+n.dtype}));var t,r=n.shape[n.shape.length-1],s=n.size/r;if(e!=null&&e<r){var o=n.shape.map((function(b){return 0})),i=n.shape.map((function(b){return b}));i[n.shape.length-1]=e,t=n.slice(o,i),r=e}else if(e!=null&&e>r){var a=n.shape.map((function(b){return b}));a[n.shape.length-1]=e-r,t=n.concat(Mr(a),n.shape.length-1),r=e}else t=n;var l=t.zerosLike(),c=uo(t,l).as2D(s,r),u=h6(c),d=Math.floor(r/2)+1,f=Sa(u),p=Ul(u),x=f.split([d,r-d],f.shape.length-1),v=p.split([d,r-d],p.shape.length-1),y=t.shape.slice();return y[t.shape.length-1]=d,uo(x[0],v[0]).reshape(y)}}),oP=ie({irfft_:function(n){var e=n.shape[n.shape.length-1],t=n.size/e;if(e<=2){var r=n.as2D(t,e),s=I2(r);return Sa(s)}var o=[t,2*(e-1)],i=Sa(n).as2D(t,e),a=Ul(n).as2D(t,e),l=i.slice([0,1],[t,e-2]).reverse(1),c=a.slice([0,1],[t,e-2]).reverse(1).mul(St(-1)),u=i.concat(l,1),d=a.concat(c,1);return r=uo(u,d).as2D(o[0],o[1]),s=I2(r),Sa(s)}}),noe=Object.freeze({fft:h6,ifft:I2,rfft:p6,irfft:oP}),roe=ie({sparseToDense_:function(n,e,t,r){r===void 0&&(r=0);var s=Y(n,"sparseIndices","sparseToDense","int32"),o=Y(e,"sparseValues","sparseToDense"),i=Y(r,"defaultValue","sparseToDense",o.dtype);return(function(a,l,c,u){if(a.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+a.dtype+".");if(a.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+a.shape+".");var d=a.rank>0?a.shape[0]:1,f=a.rank>1?a.shape[1]:1;if(c.length!==f)throw new Error("outputShape has incorrect number of elements:, "+c.length+", should be: "+f+".");var p=l.size;if(l.rank!==0&&(l.rank!==1||p!==d))throw new Error("sparseValues has incorrect shape "+l.shape+", should be [] or ["+d+"]");if(l.dtype!==u.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")})(s,o,t,i),ge.runKernelFunc((function(a){return a.sparseToDense(s,o,t,i)}),{$sparseIndices:s,$sparseValues:o,$defaultValue:i})}}),soe=ie({gatherND_:function(n,e){var t=Y(e,"indices","gatherND","int32"),r=Y(n,"x","gatherND");return ge.runKernelFunc((function(s){return s.gatherND(r,t)}),{x:r,indices:t},null,"GatherNd")}}),ooe=ie({diag_:function(n){var e=Y(n,"x","diag").flatten(),t=n.shape.concat(n.shape);return ge.runKernelFunc((function(r){return r.diag(e)}),{$x:e}).reshape(t)}}),ioe=ie({dropout_:function(n,e,t,r){var s=Y(n,"x","dropout");if(ee(s.dtype==="float32",(function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+s.dtype+" tensor instead."})),ee(e>=0&&e<1,(function(){return"rate must be a float in the range [0, 1), but got "+e+"."})),e===0)return n instanceof Kr?s.clone():s;var o=(function(l,c){if(c==null)return l.shape.slice();if(eo(l.shape,c))return c;if(l.shape.length===c.length){for(var u=[],d=0;d<l.shape.length;d++)c[d]==null&&l.shape[d]!=null?u.push(l.shape[d]):u.push(c[d]);return u}return c})(s,t),i=1-e,a=nF(o,0,1,"float32",r).add(i).floor().div(i);return s.mul(a)}});function iP(n,e,t){for(var r=1-n%2,s=new Float32Array(n),o=0;o<n;++o){var i=2*Math.PI*o/(n+r-1);s[o]=e-t*Math.cos(i)}return bs(s,"float32")}var m6=ie({hannWindow_:function(n){return iP(n,.5,.5)}}),aP=ie({hammingWindow_:function(n){return iP(n,.54,.46)}}),g6=ie({frame_:function(n,e,t,r,s){r===void 0&&(r=!1),s===void 0&&(s=0);for(var o=0,i=[];o+e<=n.size;)i.push(ic(n,o,e)),o+=t;if(r)for(;o<n.size;){var a=o+e-n.size,l=Ls([ic(n,o,e-a),Jl([a],s)]);i.push(l),o+=t}return i.length===0?Xu([],[0,e]):Ls(i).as2D(i.length,e)}}),lP=ie({stft_:function(n,e,t,r,s){var o;s===void 0&&(s=m6),r==null&&(o=e,r=Math.floor(Math.pow(2,Math.ceil(Math.log(o)/Math.log(2)))));for(var i=g6(n,e,t),a=jo(i,s(e)),l=[],c=0;c<i.shape[0];c++)l.push(p6(a.slice([c,0],[1,e]),r));return Ls(l)}}),aoe=Object.freeze({hannWindow:m6,hammingWindow:aP,frame:g6,stft:lP}),Mo,loe=function(n,e,t){return t===void 0&&(t=1),Vt(this,void 0,void 0,(function(){var r,s,o,i,a,l,c,u,d,f,p,x,v,y;return zt(this,(function(b){switch(b.label){case 0:return r=Y(n,"predictions","inTopK"),s=Y(e,"targets","inTopK"),ee(r.rank>1,(function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank})),ee(r.rank-1===s.rank,(function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+s.rank})),pr(r.shape.slice(0,r.shape.length-1),s.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),o=r.shape[r.shape.length-1],ee(t>0&&t<=o,(function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+o+"), but got "+t})),[4,r.data()];case 1:return i=b.sent(),[4,s.data()];case 2:for(a=b.sent(),l=[i.length/o,o],u=l[1],d=Ig("bool",c=l[0]),f=0;f<c;f++){for(p=f*u,x=i.subarray(p,p+u),v=[],y=0;y<x.length;y++)v.push({value:x[y],index:y});for(v.sort((function(w,S){return S.value-w.value})),d[f]=0,y=0;y<t;y++)if(v[y].index===a[f]){d[f]=1;break}}return n!==r&&r.dispose(),e!==s&&s.dispose(),[2,ho(d,s.shape,"bool")]}}))}))};(function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Mo||(Mo={}));var coe=ie({absoluteDifference_:function(n,e,t,r){r===void 0&&(r=Mo.SUM_BY_NONZERO_WEIGHTS);var s=Y(n,"labels","absoluteDifference"),o=Y(e,"predictions","absoluteDifference"),i=null;t!=null&&(i=Y(t,"weights","absoluteDifference")),pr(s.shape,o.shape,"Error in absoluteDifference: ");var a=s.sub(o).abs();return Xc(a,i,r)}}),Xc=ie({computeWeightedLoss_:function(n,e,t){t===void 0&&(t=Mo.SUM_BY_NONZERO_WEIGHTS);var r=Y(n,"losses","computeWeightedLoss"),s=null;e!=null&&(s=Y(e,"weights","computeWeightedLoss"));var o=s==null?r:r.mul(s);if(t===Mo.NONE)return o;if(t===Mo.SUM)return o.sum();if(t===Mo.MEAN){if(s==null)return o.mean();var i=r.size/s.size,a=o.sum().div(s.sum());return i>1?a.div(St(i)):a}if(t===Mo.SUM_BY_NONZERO_WEIGHTS){if(s==null)return o.sum().div(St(r.size));var l=s.mul(Kp(r.shape)).notEqual(St(0)).sum().toFloat();return o.sum().div(l)}throw Error("Unknown reduction: "+t)}}),uoe=ie({cosineDistance_:function(n,e,t,r,s){s===void 0&&(s=Mo.SUM_BY_NONZERO_WEIGHTS);var o=Y(n,"labels","cosineDistance"),i=Y(e,"predictions","cosineDistance"),a=null;r!=null&&(a=Y(r,"weights","cosineDistance")),pr(o.shape,i.shape,"Error in cosineDistance: ");var l=St(1).sub(o.mul(i).sum(t,!0));return Xc(l,a,s)}}),doe=ie({hingeLoss_:function(n,e,t,r){r===void 0&&(r=Mo.SUM_BY_NONZERO_WEIGHTS);var s=Y(n,"labels","hingeLoss"),o=Y(e,"predictions","hingeLoss"),i=null;t!=null&&(i=Y(t,"weights","hingeLoss")),pr(s.shape,o.shape,"Error in hingeLoss: ");var a=St(1);s=St(2).mul(s).sub(a);var l=a.sub(s.mul(o)).relu();return Xc(l,i,r)}}),foe=ie({huberLoss_:function(n,e,t,r,s){r===void 0&&(r=1),s===void 0&&(s=Mo.SUM_BY_NONZERO_WEIGHTS);var o=Y(n,"labels","huberLoss"),i=Y(e,"predictions","huberLoss"),a=null;t!=null&&(a=Y(t,"weights","huberLoss")),pr(o.shape,i.shape,"Error in huberLoss: ");var l=St(r),c=i.sub(o).abs(),u=VF(c,l),d=c.sub(u),f=St(.5).mul(u.square()).add(l.mul(d));return Xc(f,a,s)}}),hoe=ie({logLoss_:function(n,e,t,r,s){r===void 0&&(r=1e-7),s===void 0&&(s=Mo.SUM_BY_NONZERO_WEIGHTS);var o=Y(n,"labels","logLoss"),i=Y(e,"predictions","logLoss"),a=null;t!=null&&(a=Y(t,"weights","logLoss")),pr(o.shape,i.shape,"Error in logLoss: ");var l=St(1),c=St(r),u=o.mul(i.add(c).log()).neg().sub(l.sub(o).mul(l.sub(i).add(c).log()));return Xc(u,a,s)}}),poe=ie({meanSquaredError_:function(n,e,t,r){r===void 0&&(r=Mo.SUM_BY_NONZERO_WEIGHTS);var s=Y(n,"labels","meanSquaredError"),o=Y(e,"predictions","meanSquaredError"),i=null;t!=null&&(i=Y(t,"weights","meanSquaredError")),pr(s.shape,o.shape,"Error in meanSquaredError: ");var a=s.squaredDifference(o);return Xc(a,i,r)}}),moe=ie({sigmoidCrossEntropy_:function(n,e,t,r,s){r===void 0&&(r=0),s===void 0&&(s=Mo.SUM_BY_NONZERO_WEIGHTS);var o=Y(n,"multiClassLabels","sigmoidCrossEntropy"),i=Y(e,"logits","sigmoidCrossEntropy"),a=null;if(t!=null&&(a=Y(t,"weights","sigmoidCrossEntropy")),pr(o.shape,i.shape,"Error in sigmoidCrossEntropy: "),r>0){var l=St(r),c=St(1),u=St(.5);o=o.mul(c.sub(l)).add(u.mul(l))}var d=(function(f,p){var x=Y(f,"labels","sigmoidCrossEntropyWithLogits"),v=Y(p,"logits","sigmoidCrossEntropyWithLogits");pr(x.shape,v.shape,"Error in sigmoidCrossEntropyWithLogits: ");var y=v.relu(),b=v.mul(x),w=v.abs().neg().exp().log1p();return y.sub(b).add(w)})(o,i);return Xc(d,a,s)}}),goe=ie({softmaxCrossEntropy_:function(n,e,t,r,s){r===void 0&&(r=0),s===void 0&&(s=Mo.SUM_BY_NONZERO_WEIGHTS);var o=Y(n,"onehotLabels","softmaxCrossEntropy"),i=Y(e,"logits","softmaxCrossEntropy"),a=null;if(t!=null&&(a=Y(t,"weights","softmaxCrossEntropy")),pr(o.shape,i.shape,"Error in softmaxCrossEntropy: "),r>0){var l=St(r),c=St(1),u=St(o.shape[1]);o=o.mul(c.sub(l)).add(l.div(u))}var d=(function(f,p,x){if(x===void 0&&(x=-1),x===-1&&(x=p.rank-1),x!==p.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+p.rank+" and dim was "+x);return Ry((function(v,y,b){var w=y.logSumExp([x],!0),S=y.toFloat().sub(w);return b([v,S]),{value:S.mul(v).neg().sum([x]),gradFunc:function(k,N){var I=N[0],T=N[1],F=Si(k.shape,[x]);return[k.reshape(F).mul(I.toFloat().sub(T.exp())),k.reshape(F).mul(T.exp().sub(I.toFloat()))]}}}))(f,p)})(o,i);return Xc(d,a,s)}}),xoe=Object.freeze({get Reduction(){return Mo},absoluteDifference:coe,computeWeightedLoss:Xc,cosineDistance:uoe,hingeLoss:doe,huberLoss:foe,logLoss:hoe,meanSquaredError:poe,sigmoidCrossEntropy:moe,softmaxCrossEntropy:goe});function CT(n,e){return e===void 0&&(e=!1),ge.tidy((function(){if(n.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+n.shape.length+"D Tensor.");for(var t=n.shape[0],r=n.shape[1],s=tF(t),o=n.clone(),i=Xu([[1]],[1,1]),a=i.clone(),l=t>=r?r:t,c=function(d){var f,p=o,x=a,v=s;f=ge.tidy((function(){var y=o.slice([d,d],[t-d,1]),b=y.norm(),w=o.slice([d,d],[1,1]),S=Xu([[-1]]).where(w.greater(0),Xu([[1]])),k=w.sub(S.mul(b)),N=y.div(k);a=N.shape[0]===1?i.clone():i.concat(N.slice([1,0],[N.shape[0]-1,N.shape[1]]),0);var I=S.matMul(k).div(b).neg(),T=o.slice([d,0],[t-d,r]),F=I.mul(a);if(d===0)o=T.sub(F.matMul(a.transpose().matMul(T)));else{var R=T.sub(F.matMul(a.transpose().matMul(T)));o=o.slice([0,0],[d,r]).concat(R,0)}var D=s.slice([0,d],[t,s.shape[1]-d]);if(d===0)s=D.sub(D.matMul(a).matMul(F.transpose()));else{var A=D.sub(D.matMul(a).matMul(F.transpose()));s=s.slice([0,0],[t,d]).concat(A,1)}return[a,o,s]})),a=f[0],o=f[1],s=f[2],ki([p,x,v])},u=0;u<l;++u)c(u);return!e&&t>r&&(s=s.slice([0,0],[t,r]),o=o.slice([0,0],[r,r])),[s,o]}))}var voe=ie({bandPart_:function(n,e,t){if(e%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+e+".");if(t%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+t+".");var r=Y(n,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var s=r.shape,o=r.shape.slice(-2),i=o[0],a=o[1];if(!(e<=i))throw new Error("bandPart(): numLower ("+e+") must not be greater than the number of rows ("+i+").");if(!(t<=a))throw new Error("bandPart(): numUpper ("+t+") must not be greater than the number of columns ("+a+").");e<0&&(e=i),t<0&&(t=a);var l=x2(0,i,1,"int32").reshape([-1,1]),c=x2(0,a,1,"int32"),u=Vs(l,c),d=Ay(u.lessEqual(St(+e,"int32")),u.greaterEqual(St(-t,"int32"))),f=Mr([i,a],r.dtype);return Qi(js(r.reshape([-1,i,a])).map((function(p){return kf(d,p,f)}))).reshape(s)}}),yoe=ie({gramSchmidt_:function(n){var e;if(Array.isArray(n)){e=!1,ee(n!=null&&n.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var t=n[0].shape[0],r=function(l){ee(n[l].shape[0]===t,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+n[l].shape[0]+" vs. "+t+")"}))},s=1;s<n.length;++s)r(s)}else e=!0,n=Jk(n,n.shape[0],0).map((function(l){return sF(l,[0])}));ee(n.length<=n[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors ("+n.length+") exceeds number of dimensions ("+n[0].shape[0]+")."}));var o=[],i=n,a=function(l){o.push(ge.tidy((function(){var c=i[l];if(l>0)for(var u=0;u<l;++u){var d=eP(o[u].mulStrict(c)).mul(o[u]);c=c.sub(d)}return c.div(sP(c,"euclidean"))})))};for(s=0;s<n.length;++s)a(s);return e?Qi(o,0):o}}),boe=ie({qr_:function(n,e){if(e===void 0&&(e=!1),n.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+n.rank);if(n.rank===2)return CT(n,e);var t=n.shape.slice(0,n.shape.length-2).reduce((function(i,a){return i*a})),r=js(n.reshape([t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),s=[],o=[];return r.forEach((function(i){var a=CT(i,e),l=a[0],c=a[1];s.push(l),o.push(c)})),[Qi(s,0).reshape(n.shape),Qi(o,0).reshape(n.shape)]}}),woe=Object.freeze({bandPart:voe,gramSchmidt:yoe,qr:boe});function Oy(n,e,t,r,s,o){r==null&&(r=.5),s==null&&(s=Number.NEGATIVE_INFINITY),o==null&&(o=0);var i=n.shape[0];return t=Math.min(t,i),ee(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"})),ee(n.rank===2,(function(){return"boxes must be a 2D tensor, but was of rank '"+n.rank+"'"})),ee(n.shape[1]===4,(function(){return"boxes must have 4 columns, but 2nd dimension was "+n.shape[1]})),ee(e.rank===1,(function(){return"scores must be a 1D tensor"})),ee(e.shape[0]===i,(function(){return"scores has incompatible shape with boxes. Expected "+i+", but was "+e.shape[0]})),ee(0<=o&&o<=1,(function(){return"softNmsSigma must be in [0, 1], but was '"+o+"'"})),{maxOutputSize:t,iouThreshold:r,scoreThreshold:s,softNmsSigma:o}}var Coe=ie({resizeBilinear_:function(n,e,t){t===void 0&&(t=!1);var r=Y(n,"images","resizeBilinear");ee(r.rank===3||r.rank===4,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."})),ee(e.length===2,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."}));var s=r,o=!1;r.rank===3&&(o=!0,s=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var i=e[0],a=e[1],l=ge.runKernelFunc((function(c,u){return u([s]),c.resizeBilinear(s,i,a,t)}),{x:s},(function(c,u){return{x:function(){return ge.runKernelFunc((function(d){return d.resizeBilinearBackprop(c,u[0],t)}),{})}}}),"ResizeBilinear",{alignCorners:t,newHeight:i,newWidth:a});return o?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}}),koe=ie({resizeNearestNeighbor_:function(n,e,t){t===void 0&&(t=!1);var r=Y(n,"images","resizeNearestNeighbor");ee(r.rank===3||r.rank===4,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."})),ee(e.length===2,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."})),ee(r.dtype==="float32"||r.dtype==="int32",(function(){return"`images` must have `int32` or `float32` as dtype"}));var s=r,o=!1;r.rank===3&&(o=!0,s=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var i=e[0],a=e[1],l=ge.runKernelFunc((function(c,u){return u([s]),c.resizeNearestNeighbor(s,i,a,t)}),{batchImages:s},(function(c,u){return{batchImages:function(){return ge.runKernelFunc((function(d){return d.resizeNearestNeighborBackprop(c,u[0],t)}),{})}}}));return o?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}}),Soe=ie({nonMaxSuppression_:function(n,e,t,r,s){r===void 0&&(r=.5),s===void 0&&(s=Number.NEGATIVE_INFINITY);var o=Y(n,"boxes","nonMaxSuppression"),i=Y(e,"scores","nonMaxSuppression"),a=Oy(o,i,t,r,s);t=a.maxOutputSize,r=a.iouThreshold,s=a.scoreThreshold;var l={maxOutputSize:t,iouThreshold:r,scoreThreshold:s};return ge.runKernelFunc((function(c){return c.nonMaxSuppression(o,i,t,r,s)}),{boxes:o,scores:i},null,"NonMaxSuppressionV3",l)}}),Noe=function(n,e,t,r,s){return r===void 0&&(r=.5),s===void 0&&(s=Number.NEGATIVE_INFINITY),Vt(this,void 0,void 0,(function(){var o,i,a,l,c,u,d;return zt(this,(function(f){switch(f.label){case 0:return o=Y(n,"boxes","nonMaxSuppressionAsync"),i=Y(e,"scores","nonMaxSuppressionAsync"),a=Oy(o,i,t,r,s),t=a.maxOutputSize,r=a.iouThreshold,s=a.scoreThreshold,[4,Promise.all([o.data(),i.data()])];case 1:return l=f.sent(),c=l[0],u=l[1],d=n6(c,u,t,r,s),o!==n&&o.dispose(),i!==e&&i.dispose(),[2,d]}}))}))},Eoe=ie({nonMaxSuppressionWithScore_:function(n,e,t,r,s,o){r===void 0&&(r=.5),s===void 0&&(s=Number.NEGATIVE_INFINITY),o===void 0&&(o=0);var i=Y(n,"boxes","nonMaxSuppression"),a=Y(e,"scores","nonMaxSuppression"),l=Oy(i,a,t,r,s,o),c={maxOutputSize:t=l.maxOutputSize,iouThreshold:r=l.iouThreshold,scoreThreshold:s=l.scoreThreshold,softNmsSigma:o=l.softNmsSigma},u=ge.runKernel("NonMaxSuppressionV5",{boxes:i,scores:a},c);return{selectedIndices:u[0],selectedScores:u[1]}}}),Ioe=function(n,e,t,r,s,o){return r===void 0&&(r=.5),s===void 0&&(s=Number.NEGATIVE_INFINITY),o===void 0&&(o=0),Vt(this,void 0,void 0,(function(){var i,a,l,c,u,d,f;return zt(this,(function(p){switch(p.label){case 0:return i=Y(n,"boxes","nonMaxSuppressionAsync"),a=Y(e,"scores","nonMaxSuppressionAsync"),l=Oy(i,a,t,r,s,o),t=l.maxOutputSize,r=l.iouThreshold,s=l.scoreThreshold,o=l.softNmsSigma,[4,Promise.all([i.data(),a.data()])];case 1:return c=p.sent(),u=c[0],d=c[1],f=r6(u,d,t,r,s,o),i!==n&&i.dispose(),a!==e&&a.dispose(),[2,f]}}))}))},Toe=ie({cropAndResize_:function(n,e,t,r,s,o){var i=Y(n,"image","cropAndResize"),a=Y(e,"boxes","cropAndResize","float32"),l=Y(t,"boxInd","cropAndResize","int32");s=s||"bilinear",o=o||0;var c=a.shape[0];return ee(i.rank===4,(function(){return"Error in cropAndResize: image must be rank 4,but got rank "+i.rank+"."})),ee(a.rank===2&&a.shape[1]===4,(function(){return"Error in cropAndResize: boxes must be have size ["+c+",4] but had shape "+a.shape+"."})),ee(l.rank===1&&l.shape[0]===c,(function(){return"Error in cropAndResize: boxInd must be have size ["+c+"] but had shape "+a.shape+"."})),ee(r.length===2,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."})),ee(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was "+r})),ee(s==="bilinear"||s==="nearest",(function(){return"method must be bilinear or nearest, but was "+s})),ge.runKernelFunc((function(u,d){return u.cropAndResize(i,a,l,r,s,o)}),{images:i,boxes:a,boxInd:l},null,"CropAndResize",{method:s,extrapolationValue:o,cropSize:r})}}),x6=Object.freeze({resizeBilinear:Coe,resizeNearestNeighbor:koe,nonMaxSuppression:Soe,nonMaxSuppressionAsync:Noe,nonMaxSuppressionWithScore:Eoe,nonMaxSuppressionWithScoreAsync:Ioe,cropAndResize:Toe}),v6=function(n,e){return!(n>0)||e==="linear"},y6=function(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return n.mul(e.step());throw new Error("Gradient for activation "+t+" has not been implemented yet.")},b6=function(n,e){var t=e,r=Bs(n.shape,e.shape);return r.length>0&&(t=t.sum(r)),t.reshape(n.shape)},w6=function(n,e,t){if(e==="linear")return n;if(e==="relu")return Xr(n);if(e==="elu")return tP(n);if(e==="relu6")return rP(n);if(e==="prelu")return nP(n,t);throw new Error("Unknown fused activation "+e+".")},_oe=ie({fusedMatMul_:function(n){var e,t=n.a,r=n.b,s=n.transposeA,o=s!==void 0&&s,i=n.transposeB,a=i!==void 0&&i,l=n.bias,c=n.activation,u=c===void 0?"linear":c,d=n.preluActivationWeights;if(v6(ge.state.gradientDepth,u)===!1){var f=Fy(t,r,o,a);return l!=null&&(f=jn(f,l)),w6(f,u,d)}var p=Y(t,"a","fused matMul"),x=Y(r,"b","fused matMul");e=Yr(p,x),p=e[0],x=e[1];var v=o?p.shape[p.rank-2]:p.shape[p.rank-1],y=a?x.shape[x.rank-1]:x.shape[x.rank-2],b=o?p.shape[p.rank-1]:p.shape[p.rank-2],w=a?x.shape[x.rank-2]:x.shape[x.rank-1],S=p.shape.slice(0,-2),k=x.shape.slice(0,-2),N=Xt(S),I=Xt(k);ee(p.rank>=2&&x.rank>=2&&p.rank===x.rank,(function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+p.rank+" and "+x.rank+"."})),ee(eo(S,k),(function(){return"Error in fused matMul: outer dimensions ("+S+") and ("+k+") of Tensors with shapes "+p.shape+" and "+x.shape+" must match."})),ee(v===y,(function(){return"Error in fused matMul: inner shapes ("+v+") and ("+y+") of Tensors with shapes "+p.shape+" and "+x.shape+" and transposeA="+o+" and transposeB="+a+" must match."}));var T,F,R=p.shape.slice(0,-2).concat([b,w]),D=o?p.as3D(N,v,b):p.as3D(N,b,v),A=a?x.as3D(I,w,y):x.as3D(I,y,w);l!=null&&zn(R,(T=Yr(T=Y(l,"bias","fused matMul"),p)[0]).shape),d!=null&&(F=Y(d,"prelu weights","fused matMul"));var P={a:D,b:A};l!=null&&(P.bias=T),d!=null&&(P.preluActivationWeights=F);var B=[D,A];return ge.runKernelFunc((function(L,W){var H=L.fusedBatchMatMul({a:D,b:A,transposeA:o,transposeB:a,bias:T,activation:u,preluActivationWeights:F});return W([D,A,H]),H}),P,(function(L,W){var H=W[0],G=W[1],M=W[2],j=y6(L,M,u),z={};return l!=null&&(z={bias:function(){return b6(T,j)}}),Object.assign(o||a?!o&&a?{a:function(){return j.matMul(G,!1,!1)},b:function(){return j.matMul(H,!0,!1)}}:o&&!a?{a:function(){return G.matMul(j,!1,!0)},b:function(){return H.matMul(j,!1,!1)}}:{a:function(){return G.matMul(j,!0,!0)},b:function(){return j.matMul(H,!0,!0)}}:{a:function(){return j.matMul(G,!1,!0)},b:function(){return H.matMul(j,!0,!1)}},z)}),"_FusedMatMul",{transposeA:o,transposeB:a,activation:u},B,[!0]).reshape(R)}}),Roe=ie({fusedConv2d_:function(n){var e=n.x,t=n.filter,r=n.strides,s=n.pad,o=n.dataFormat,i=o===void 0?"NHWC":o,a=n.dilations,l=a===void 0?[1,1]:a,c=n.dimRoundingMode,u=n.bias,d=n.activation,f=d===void 0?"linear":d,p=n.preluActivationWeights;if(f=f||"linear",v6(ge.state.gradientDepth,f)===!1){var x=Aa(e,t,r,s,i,l,c);return u!=null&&(x=jn(x,u)),w6(x,f,p)}var v=Y(e,"x","conv2d"),y=Y(t,"filter","conv2d"),b=v,w=!1;v.rank===3&&(w=!0,b=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),ee(b.rank===4,(function(){return"Error in fused conv2d: input must be rank 4, but got rank "+b.rank+"."})),ee(y.rank===4,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+y.rank+"."})),c!=null&&ee(hs(s),(function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+c+" but got pad "+s+"."})),ee(b.shape[3]===y.shape[2],(function(){return"Error in conv2d: depth of input ("+b.shape[3]+") must match input depth for filter "+y.shape[2]+"."})),ee(Ni(r,l),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+l+"'"})),ee(i==="NHWC",(function(){return"Error in conv2d: got dataFormat of "+i+" but only NHWC is currently supported."}));var S,k,N=Uf(b.shape,y.shape,r,l,s,c);u!=null&&(S=Yr(S=Y(u,"bias","fused conv2d"),v)[0],zn(N.outShape,S.shape)),p!=null&&(k=Y(p,"prelu weights","fused conv2d"));var I={x:b,filter:y};u!=null&&(I.bias=S),p!=null&&(I.preluActivationWeights=k);var T=[y,b],F=ge.runKernelFunc((function(R,D){var A=R.fusedConv2d({input:b,filter:y,convInfo:N,bias:S,activation:f,preluActivationWeights:k});return D([y,b,A]),A}),I,(function(R,D){var A=D,P=A[0],B=A[1],L=A[2],W=y6(R,L,f);ee(Tp(l),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+l+"'"}));var H={};return u!=null&&(H={bias:function(){return b6(S,W)}}),Object.assign({x:function(){return qF(B.shape,W,P,r,s)},filter:function(){return d6(B,W,P.shape,r,s)}},H)}),"FusedConv2D",{convInfo:N,activation:f},T,[!0]);return w?F.as3D(F.shape[1],F.shape[2],F.shape[3]):F}}),Doe=ie({fusedDepthwiseConv2d_:function(n){var e=n.x,t=n.filter,r=n.strides,s=n.pad,o=n.dataFormat,i=o===void 0?"NHWC":o,a=n.dilations,l=a===void 0?[1,1]:a,c=n.dimRoundingMode,u=n.bias,d=n.activation,f=d===void 0?"linear":d,p=n.preluActivationWeights;if(v6(ge.state.gradientDepth,f)===!1){var x=$y(e,t,r,s,i,l,c);return u!=null&&(x=jn(x,u)),w6(x,f,p)}var v=Y(e,"x","depthwiseConv2d"),y=Y(t,"filter","depthwiseConv2d"),b=v,w=!1;v.rank===3&&(w=!0,b=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),ee(b.rank===4,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+b.rank+"."})),ee(y.rank===4,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+y.rank+"."})),ee(b.shape[3]===y.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels ("+b.shape[3]+") must match the inChannels dimension in filter "+y.shape[2]+"."})),l==null&&(l=[1,1]),ee(Ni(r,l),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+l+"'"})),c!=null&&ee(hs(s),(function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+c+" but got pad "+s+"."}));var S,k,N=Uf(b.shape,y.shape,r,l,s,c,!0);u!=null&&(S=Yr(S=Y(u,"bias","fused conv2d"),v)[0],zn(N.outShape,S.shape)),p!=null&&(k=Y(p,"prelu weights","fused depthwiseConv2d"));var I={x:b,filter:y};u!=null&&(I.bias=S),p!=null&&(I.preluActivationWeights=k);var T=[y,b],F=ge.runKernelFunc((function(R,D){var A=R.fusedDepthwiseConv2D({input:b,filter:y,convInfo:N,bias:S,activation:f,preluActivationWeights:k});return D([y,b,A]),A}),I,(function(R,D){ee(Tp(l),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+l+"'"}));var A=D[0],P=D[1],B=D[2],L=y6(R,B,f),W={};return u!=null&&(W={bias:function(){return b6(S,L)}}),Object.assign({x:function(){return KF(P.shape,L,A,N)},filter:function(){return XF(P,L,A.shape,N)}},W)}),"FusedDepthwiseConv2D",{convInfo:N,activation:f},T,[!0]);return w?F.as3D(F.shape[1],F.shape[2],F.shape[3]):F}}),Aoe=Object.freeze({matMul:_oe,conv2d:Roe,depthwiseConv2d:Doe}),$oe=Object.freeze({image:x6,linalg:woe,losses:xoe,spectral:noe,fused:Aoe,signal:aoe,square:hre,squaredDifference:DF,conv1d:Cse,conv2d:Aa,conv3d:kse,depthwiseConv2d:$y,separableConv2d:f6,conv2dTranspose:Sse,conv3dTranspose:Nse,op:ie,batchNormalization2d:Wre,batchNormalization3d:Ure,batchNormalization4d:Hre,batchNormalization:Gre,batchNorm:MF,batchNorm2d:qre,batchNorm3d:Kre,batchNorm4d:Xre,booleanMaskAsync:wse,complex:uo,real:Sa,imag:Ul,concat:Ls,concat1d:Aee,concat2d:$ee,concat3d:Fee,concat4d:Pee,split:Jk,matMul:Fy,dot:Ese,outerProduct:Ise,reverse:s1,reverse1d:Tse,reverse2d:_se,reverse3d:Rse,reverse4d:Dse,maxPool:Js,avgPool:o1,pool:Ase,maxPool3d:$se,avgPool3d:Fse,slice:ic,slice1d:Pse,slice2d:Ose,slice3d:JF,slice4d:Mse,abs:pre,acos:mre,acosh:gre,asin:xre,asinh:vre,atan:yre,atanh:bre,ceil:wre,clipByValue:l6,cos:Cre,cosh:kre,erf:Sre,exp:v5,expm1:Nre,floor:Ere,log:Ire,log1p:Tre,logSigmoid:_re,neg:N2,reciprocal:Rre,round:Dre,rsqrt:AF,sigmoid:$F,sign:Are,isNaN:$re,isInf:Fre,isFinite:Pre,sin:Ore,sinh:Mre,softplus:Lre,sqrt:jre,step:Bre,tan:Vre,tanh:zre,all:Lse,any:jse,argMax:Bse,argMin:Vse,logSumExp:zse,max:Py,mean:Wse,min:Use,moments:Hse,sum:eP,prod:Gse,equal:zF,equalStrict:dse,greater:fse,greaterEqual:WF,greaterEqualStrict:hse,greaterStrict:pse,less:mse,lessEqual:gse,lessEqualStrict:xse,lessStrict:vse,notEqual:yse,notEqualStrict:bse,add:jn,addN:Jre,addStrict:Qre,atan2:ese,div:Ya,divNoNan:tse,divStrict:nse,floorDiv:BF,maximum:c6,maximumStrict:rse,minimum:VF,minimumStrict:sse,mod:ose,modStrict:ise,mul:jo,mulStrict:ase,pow:E2,powStrict:lse,squaredDifferenceStrict:cse,sub:Vs,subStrict:use,elu:tP,leakyRelu:qse,prelu:nP,relu:Xr,relu6:rP,selu:Kse,logicalAnd:Ay,logicalNot:Yre,logicalOr:LF,logicalXor:Zre,where:kf,whereAsync:jF,buffer:wn,print:Uee,batchToSpaceND:eF,broadcastTo:Hee,cast:Gee,clone:qee,cumsum:Kee,depthToSpace:Xee,expandDims:ka,eye:tF,multinomial:Yee,oneHot:p5,pad:Wf,pad1d:Zee,pad2d:Jee,pad3d:Qee,pad4d:ete,rand:tte,randomNormal:nte,randomGamma:rte,randomUniform:nF,reshape:rl,spaceToBatchND:rF,squeeze:sF,stack:Qi,tile:ip,truncatedNormal:ste,unstack:js,setdiff1dAsync:ote,fill:Jl,linspace:Dee,ones:Kp,range:x2,scalar:St,tensor:ho,tensor1d:bs,tensor2d:Xu,tensor3d:Zk,tensor4d:yi,tensor5d:Tee,tensor6d:_ee,variable:Ree,zeros:Mr,onesLike:Q$,zerosLike:Yn,transpose:id,softmax:Kc,logSoftmax:fte,localResponseNormalization:Xse,norm:sP,gather:u6,unsortedSegmentSum:UF,basicLSTMCell:Yse,multiRNNCell:Zse,movingAverage:Jse,stridedSlice:Qse,topk:eoe,scatterND:toe,fft:h6,ifft:I2,rfft:p6,irfft:oP,sparseToDense:roe,gatherND:soe,diag:ooe,dropout:ioe,hannWindow:m6,hammingWindow:aP,frame:g6,stft:lP,inTopKAsync:loe});function Ze(n,e){Array.isArray(n)||(n=[n]),n.forEach((function(t){t!=null&&ee(t.dtype!=="complex64",(function(){return e+" does not support complex64 tensors."}))}))}function XC(n,e,t,r){if(t==="linear")return n.linear(e);if(t==="relu")return n.relu(e);if(t==="elu")return n.elu(e);if(t==="relu6")return n.relu6(e);if(t==="prelu")return n.prelu(e,r);throw new Error("Activation "+t+" has not been implemented for the CPU backend.")}var Foe=(function(n){function e(){var t=n.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new dF(t,ge),t}return ml(e,n),e.prototype.write=function(t,r,s){this.firstUse&&(this.firstUse=!1,je().get("IS_NODE")&&m2(`
============================
Hi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var o={};return this.data.set(o,{values:t,dtype:s}),o},e.prototype.move=function(t,r,s,o){this.data.set(t,{values:r,dtype:o})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.read=function(t){return Vt(this,void 0,void 0,(function(){return zt(this,(function(r){return[2,this.readSync(t)]}))}))},e.prototype.readSync=function(t){var r=this.data.get(t),s=r.dtype,o=r.complexTensors;return s==="complex64"?x5(this.readSync(o.real.dataId),this.readSync(o.imag.dataId)):this.data.get(t).values},e.prototype.bufferSync=function(t){var r=this.readSync(t.dataId),s=r;if(t.dtype==="string")try{s=r.map((function(o){return f2(o)}))}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return wn(t.shape,t.dtype,s)},e.prototype.makeOutput=function(t,r,s){var o=this.write(t,r,s);return ge.makeTensorFromDataId(o,r,s,this)},e.prototype.disposeData=function(t){if(this.data.has(t)){var r=this.data.get(t).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.data.delete(t)}},e.prototype.time=function(t){return Vt(this,void 0,void 0,(function(){var r;return zt(this,(function(s){return r=Ml(),t(),[2,{kernelMs:Ml()-r}]}))}))},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.complex=function(t,r){var s=this.makeOutput(null,t.shape,"complex64");return this.data.get(s.dataId).complexTensors={real:ge.keep(t.clone()),imag:ge.keep(r.clone())},s},e.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,r,s){if(Ze(t,"slice"),cF(t.shape,r,s)){var o=uF(r,t.strides),i=Xt(s);return ho(this.readSync(t.dataId).subarray(o,o+i),s,t.dtype)}for(var a=wn(s,t.dtype),l=this.bufferSync(t),c=0;c<a.size;++c){var u=a.indexToLoc(c).map((function(d,f){return d+r[f]}));a.values[c]=l.get.apply(l,u)}return a.toTensor()},e.prototype.stridedSlice=function(t,r,s,o){Ze(t,"stridedSlice");var i=e6(r,s,o);if(i.some((function(p){return p===0})))return ho([],i);for(var a=wn(i,t.dtype),l=this.bufferSync(t),c=0;c<a.size;c++){for(var u=a.indexToLoc(c),d=new Array(u.length),f=0;f<d.length;f++)d[f]=u[f]*o[f]+r[f];a.set.apply(a,[l.get.apply(l,d)].concat(u))}return a.toTensor()},e.prototype.diag=function(t){for(var r=this.readSync(t.dataId),s=wn([t.size,t.size],t.dtype),o=s.values,i=0;i<r.length;i++)o[i*t.size+i]=r[i];return s.toTensor()},e.prototype.unstack=function(t,r){for(var s=t.shape[r],o=new Array(t.rank-1),i=0,a=0;a<t.rank;a++)a!==r&&(o[i++]=t.shape[a]);var l=new Array(t.rank).fill(0),c=t.shape.slice();c[r]=1;var u=new Array(s);for(a=0;a<u.length;a++)l[r]=a,u[a]=this.slice(t,l,c).reshape(o);return u},e.prototype.reverse=function(t,r){Ze(t,"reverse");for(var s=wn(t.shape,t.dtype),o=this.bufferSync(t),i=function(l){var c=s.indexToLoc(l),u=c.slice();r.forEach((function(d){return u[d]=t.shape[d]-1-u[d]})),s.set.apply(s,[o.get.apply(o,u)].concat(c))},a=0;a<s.size;a++)i(a);return s.toTensor()},e.prototype.concat=function(t,r){var s=this;if(t[0].dtype==="complex64"){var o=t.map((function(p){return Sa(p)})),i=t.map((function(p){return Ul(p)}));return uo(this.concat(o,r),this.concat(i,r))}var a=t.map((function(p){var x=Xt(p.shape.slice(r));return p.as2D(-1,x)})),l=Ip(a.map((function(p){return p.shape})),1),c=wn(l,t[0].dtype).values;if(a[0].shape[0]===1){var u=0;a.forEach((function(p){c.set(s.readSync(p.dataId),u),u+=p.size}))}else{var d=0;a.forEach((function(p){for(var x=s.readSync(p.dataId),v=0,y=0;y<p.shape[0];++y)for(var b=y*l[1]+d,w=0;w<p.shape[1];++w)c[b+w]=x[v++];d+=p.shape[1]}))}var f=Ip(t.map((function(p){return p.shape})),r);return ho(c,f,t[0].dtype)},e.prototype.neg=function(t){return Ze(t,"neg"),this.multiply(St(-1),t)},e.prototype.add=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),(function(s,o,i,a){return{real:s+i,imag:o+a}})):this.broadcastedBinaryOp(t,r,fo(t.dtype,r.dtype),(function(s,o){return s+o}))},e.prototype.addN=function(t){var r=this;Ze(t,"addN");for(var s=t.map((function(u){return r.readSync(u.dataId)})),o=wn(t[0].shape,t[0].dtype),i=o.values,a=0;a<t.length;a++)for(var l=s[a],c=0;c<i.length;c++)i[c]+=l[c];return o.toTensor()},e.prototype.softmax=function(t,r){var s=zs([r],t.shape),o=this.max(t,s),i=Si(o.shape,s),a=this.subtract(t,o.reshape(i)),l=this.exp(a),c=this.sum(l,s).reshape(i);return this.realDivide(l,c)},e.prototype.subtract=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),(function(s,o,i,a){return{real:s-i,imag:o-a}})):this.broadcastedBinaryOp(t,r,fo(t.dtype,r.dtype),(function(s,o){return s-o}))},e.prototype.pow=function(t,r){return Ze([t,r],"pow"),this.broadcastedBinaryOp(t,r,t.dtype,(function(s,o){return Math.pow(s,o)}))},e.prototype.batchMatMul=function(t,r,s,o){Ze([t,r],"matMul");for(var i=s?t.shape[1]:t.shape[2],a=s?t.shape[2]:t.shape[1],l=o?r.shape[1]:r.shape[2],c=t.shape[0],u=this.readSync(t.dataId),d=this.readSync(r.dataId),f=s?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],p=f[0],x=f[1],v=f[2],y=o?[1,r.strides[1],r.strides[0]]:[r.strides[1],1,r.strides[0]],b=y[0],w=y[1],S=y[2],k=a*l,N=wn([c,a,l],t.dtype),I=N.values,T=this.blockSize,F=0;F<c;F++)for(var R=0;R<a;R+=T)for(var D=0;D<l;D+=T)for(var A=0;A<i;A+=T)for(var P=Math.min(R+T,a),B=Math.min(D+T,l),L=Math.min(A+T,i),W=R;W<P;W++)for(var H=D;H<B;H++){for(var G=0,M=A;M<L;M++)G+=u[F*p+W*x+M*v]*d[M*b+H*w+F*S];I[F*k+(W*l+H)]+=G}return N.toTensor()},e.prototype.fusedBatchMatMul=function(t){var r=t.a,s=t.b,o=t.transposeA,i=t.transposeB,a=t.bias,l=t.activation,c=t.preluActivationWeights,u=this.batchMatMul(r,s,o,i);return a&&(u=this.add(u,a)),l&&(u=XC(this,u,l,c)),u},e.prototype.multiply=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),(function(s,o,i,a){return{real:s*i-o*a,imag:s*a+o*i}})):this.broadcastedBinaryOp(t,r,fo(t.dtype,r.dtype),(function(s,o){return s*o}))},e.prototype.realDivide=function(t,r){return Ze([t,r],"realDivide"),this.broadcastedBinaryOp(t,r,"float32",(function(s,o){return s/o}))},e.prototype.floorDiv=function(t,r){return Ze([t,r],"floorDiv"),this.broadcastedBinaryOp(t,r,"int32",(function(s,o){return Math.floor(s/o)}))},e.prototype.sum=function(t,r){Ze(t,"sum"),zi("sum",r,t.rank);for(var s=Do(t.shape,r),o=s[0],i=s[1],a=Mr(o,fo(t.dtype,"int32")),l=Xt(i),c=this.readSync(a.dataId),u=this.readSync(t.dataId),d=0;d<c.length;++d){for(var f=d*l,p=0,x=0;x<l;++x)p+=u[f+x];c[d]=p}return a},e.prototype.prod=function(t,r){Ze(t,"sum");for(var s=Do(t.shape,r),o=s[0],i=s[1],a=Mr(o,fo(t.dtype,"int32")),l=Xt(i),c=this.readSync(a.dataId),u=this.readSync(t.dataId),d=0;d<c.length;++d){for(var f=d*l,p=1,x=0;x<l;++x)p*=u[f+x];c[d]=p}return a},e.prototype.unsortedSegmentSum=function(t,r,s){Ze(t,"unsortedSegmentSum");for(var o=[],i=t.rank-r.rank,a=0;a<i;++a)r=r.expandDims(a+1);for(a=0;a<s;++a){var l=St(a,"int32"),c=zF(l,r).asType("float32").mul(t).sum(0);o.push(c)}return Qi(o)},e.prototype.argMin=function(t,r){Ze(t,"argMin");var s=[r];zi("argMin",s,t.rank);for(var o=Do(t.shape,s),i=o[0],a=o[1],l=Mr(i,"int32"),c=Xt(a),u=this.readSync(l.dataId),d=this.readSync(t.dataId),f=0;f<u.length;++f){for(var p=f*c,x=d[p],v=0,y=0;y<c;++y){var b=d[p+y];b<x&&(x=b,v=y)}u[f]=v}return l},e.prototype.argMax=function(t,r){Ze(t,"argMax");var s=[r];zi("argMax",s,t.rank);for(var o=Do(t.shape,s),i=o[0],a=o[1],l=Mr(i,"int32"),c=Xt(a),u=this.readSync(l.dataId),d=this.readSync(t.dataId),f=0;f<u.length;++f){for(var p=f*c,x=d[p],v=0,y=0;y<c;++y){var b=d[p+y];b>x&&(x=b,v=y)}u[f]=v}return l},e.prototype.cumsum=function(t,r,s,o){if(Ze(t,"cumsum"),r!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+r);for(var i=fo(t.dtype,"int32"),a=Mr(t.shape,i),l=this.readSync(a.dataId),c=this.readSync(t.dataId),u=t.shape[t.rank-1],d=o?function(y,b){return y+u-b-1}:function(y,b){return y+b},f=0;f<c.length;f+=u)for(var p=0;p<u;p++){var x=d(f,p);if(p===0)l[x]=s?0:c[x];else{var v=d(f,p-1);l[x]=s?c[v]+l[v]:c[x]+l[v]}}return a},e.prototype.equal=function(t,r){return Ze([t,r],"equal"),this.broadcastedBinaryOp(t,r,"bool",(function(s,o){return s===o?1:0}))},e.prototype.notEqual=function(t,r){return Ze([t,r],"notEqual"),this.broadcastedBinaryOp(t,r,"bool",(function(s,o){return s!==o?1:0}))},e.prototype.less=function(t,r){return Ze([t,r],"less"),this.broadcastedBinaryOp(t,r,"bool",(function(s,o){return s<o?1:0}))},e.prototype.lessEqual=function(t,r){return Ze([t,r],"lessEqual"),this.broadcastedBinaryOp(t,r,"bool",(function(s,o){return s<=o?1:0}))},e.prototype.greater=function(t,r){return Ze([t,r],"greater"),this.broadcastedBinaryOp(t,r,"bool",(function(s,o){return s>o?1:0}))},e.prototype.greaterEqual=function(t,r){return Ze([t,r],"greaterEqual"),this.broadcastedBinaryOp(t,r,"bool",(function(s,o){return s>=o?1:0}))},e.prototype.logicalNot=function(t){Ze(t,"logicalNot");for(var r=this.readSync(t.dataId),s=new Uint8Array(r.length),o=0;o<r.length;++o)s[o]=r[o]?0:1;return this.makeOutput(s,t.shape,"bool")},e.prototype.logicalAnd=function(t,r){return Ze([t,r],"logicalAnd"),this.broadcastedBinaryOp(t,r,"bool",(function(s,o){return s&&o}))},e.prototype.logicalOr=function(t,r){return Ze([t,r],"logicalOr"),this.broadcastedBinaryOp(t,r,"bool",(function(s,o){return s||o}))},e.prototype.select=function(t,r,s){Ze([t,r,s],"select");for(var o=this.readSync(t.dataId),i=this.readSync(r.dataId),a=this.readSync(s.dataId),l=Mr(r.shape,fo(r.dtype,s.dtype)),c=this.readSync(l.dataId),u=0,d=t.rank===0||t.rank>1||r.rank===1?1:Xt(r.shape.slice(1)),f=0;f<o.length;f++)for(var p=0;p<d;p++)o[f]===1?c[u++]=i[f]:c[u++]=a[f];return l},e.prototype.where=function(t){Ze([t],"where");var r=this.readSync(t.dataId);return s6(t.shape,r)},e.prototype.topk=function(t,r,s){return Ze(t,"topk"),yF(this.readSync(t.dataId),t.shape,t.dtype,r)},e.prototype.min=function(t,r){Ze(t,"min"),zi("min",r,t.rank);for(var s=Do(t.shape,r),o=s[0],i=s[1],a=Mr(o,t.dtype),l=Xt(i),c=this.readSync(a.dataId),u=this.readSync(t.dataId),d=0;d<c.length;++d){for(var f=d*l,p=u[f],x=0;x<l;++x){var v=u[f+x];v<p&&(p=v)}c[d]=p}return a},e.prototype.minimum=function(t,r){return Ze([t,r],"minimum"),this.broadcastedBinaryOp(t,r,t.dtype,(function(s,o){return Math.min(s,o)}))},e.prototype.mod=function(t,r){return Ze([t,r],"mod"),this.broadcastedBinaryOp(t,r,t.dtype,(function(s,o){var i=s%o;return s<0&&o<0||s>=0&&o>=0?i:(i+o)%o}))},e.prototype.max=function(t,r){Ze(t,"max"),zi("max",r,t.rank);for(var s=Do(t.shape,r),o=s[0],i=s[1],a=Mr(o,t.dtype),l=Xt(i),c=this.readSync(a.dataId),u=this.readSync(t.dataId),d=0;d<c.length;++d){for(var f=d*l,p=u[f],x=0;x<l;++x){var v=u[f+x];v>p&&(p=v)}c[d]=p}return a},e.prototype.maximum=function(t,r){return Ze([t,r],"maximum"),this.broadcastedBinaryOp(t,r,t.dtype,(function(s,o){return Math.max(s,o)}))},e.prototype.all=function(t,r){Ze(t,"all"),zi("all",r,t.rank);for(var s=Do(t.shape,r),o=s[0],i=s[1],a=Mr(o,t.dtype),l=Xt(i),c=this.readSync(a.dataId),u=this.readSync(t.dataId),d=0;d<c.length;++d){for(var f=d*l,p=u[f],x=0;x<l;++x){var v=u[f+x];p=p&&v}c[d]=p}return a},e.prototype.any=function(t,r){Ze(t,"any"),zi("any",r,t.rank);for(var s=Do(t.shape,r),o=s[0],i=s[1],a=Mr(o,t.dtype),l=Xt(i),c=this.readSync(a.dataId),u=this.readSync(t.dataId),d=0;d<c.length;++d){for(var f=d*l,p=u[f],x=0;x<l;++x){var v=u[f+x];p=p||v}c[d]=p}return a},e.prototype.squaredDifference=function(t,r){return Ze([t,r],"squaredDifference"),this.broadcastedBinaryOp(t,r,t.dtype,(function(s,o){var i=s-o;return i*i}))},e.prototype.ceil=function(t){Ze(t,"ceil");for(var r=this.readSync(t.dataId),s=new Float32Array(r.length),o=0;o<r.length;++o)s[o]=Math.ceil(r[o]);return this.makeOutput(s,t.shape,"float32")},e.prototype.floor=function(t){Ze(t,"floor");for(var r=this.readSync(t.dataId),s=new Float32Array(r.length),o=0;o<r.length;++o)s[o]=Math.floor(r[o]);return this.makeOutput(s,t.shape,"float32")},e.prototype.sign=function(t){Ze(t,"x");for(var r=this.readSync(t.dataId),s=new Float32Array(r.length),o=0;o<r.length;++o)r[o]<0?s[o]=-1:r[o]>0?s[o]=1:s[o]=0;return this.makeOutput(s,t.shape,"float32")},e.prototype.isNaN=function(t){Ze(t,"x");for(var r=this.readSync(t.dataId),s=new Uint8Array(r.length),o=0;o<r.length;++o)Number.isNaN(r[o])&&(s[o]=1);return this.makeOutput(s,t.shape,"bool")},e.prototype.isInf=function(t){Ze(t,"x");for(var r=this.readSync(t.dataId),s=new Uint8Array(r.length),o=0;o<r.length;++o)Math.abs(r[o])===1/0&&(s[o]=1);return this.makeOutput(s,t.shape,"bool")},e.prototype.isFinite=function(t){Ze(t,"x");for(var r=this.readSync(t.dataId),s=new Uint8Array(r.length),o=0;o<r.length;++o)Number.isFinite(r[o])&&(s[o]=1);return this.makeOutput(s,t.shape,"bool")},e.prototype.round=function(t){Ze(t,"round");for(var r=this.readSync(t.dataId),s=new Float32Array(r.length),o=0;o<r.length;++o){var i=Math.floor(r[o]);r[o]-i<.5?s[o]=Math.floor(r[o]):r[o]-i>.5?s[o]=Math.ceil(r[o]):s[o]=i%2==0?i:i+1}return this.makeOutput(s,t.shape,"float32")},e.prototype.exp=function(t){Ze(t,"exp");for(var r=this.readSync(t.dataId),s=new Float32Array(r.length),o=0;o<r.length;++o)s[o]=Math.exp(r[o]);return this.makeOutput(s,t.shape,"float32")},e.prototype.expm1=function(t){Ze(t,"expm1");for(var r=this.readSync(t.dataId),s=new Float32Array(r.length),o=0;o<r.length;++o)s[o]=Math.expm1(r[o]);return this.makeOutput(s,t.shape,"float32")},e.prototype.log=function(t){Ze(t,"log");for(var r=this.readSync(t.dataId),s=new Float32Array(r.length),o=0;o<r.length;++o){var i=r[o];s[o]=Math.log(i)}return this.makeOutput(s,t.shape,"float32")},e.prototype.log1p=function(t){Ze(t,"log1p");for(var r=this.readSync(t.dataId),s=new Float32Array(r.length),o=0;o<r.length;++o){var i=r[o];s[o]=Math.log1p(i)}return this.makeOutput(s,t.shape,"float32")},e.prototype.sqrt=function(t){Ze(t,"sqrt");for(var r=this.readSync(t.dataId),s=new Float32Array(r.length),o=0;o<r.length;++o){var i=r[o];s[o]=Math.sqrt(i)}return this.makeOutput(s,t.shape,"float32")},e.prototype.rsqrt=function(t){Ze(t,"rsqrt");for(var r=this.readSync(t.dataId),s=new Float32Array(r.length),o=0;o<r.length;++o){var i=r[o];s[o]=1/Math.sqrt(i)}return this.makeOutput(s,t.shape,"float32")},e.prototype.reciprocal=function(t){Ze(t,"reciprocal");for(var r=this.readSync(t.dataId),s=new Float32Array(r.length),o=0;o<r.length;++o)s[o]=1/r[o];return this.makeOutput(s,t.shape,"float32")},e.prototype.linear=function(t){return t},e.prototype.relu=function(t){Ze(t,"relu");for(var r=Mr(t.shape,t.dtype),s=this.readSync(r.dataId),o=this.readSync(t.dataId),i=0;i<o.length;++i)s[i]=Math.max(0,o[i]);return r},e.prototype.relu6=function(t){Ze(t,"relu");for(var r=Mr(t.shape,t.dtype),s=this.readSync(r.dataId),o=this.readSync(t.dataId),i=0;i<o.length;++i)s[i]=Math.min(Math.max(0,o[i]),6);return r},e.prototype.prelu=function(t,r){return Ze([t,r],"prelu"),this.broadcastedBinaryOp(t,r,t.dtype,(function(s,o){return s<0?o*s:s}))},e.prototype.elu=function(t){Ze(t,"elu");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),o=0;o<s.length;++o){var i=s[o];r[o]=i>=0?i:Math.exp(i)-1}return this.makeOutput(r,t.shape,"float32")},e.prototype.eluDer=function(t,r){Ze([t,r],"eluDer");for(var s=new Float32Array(r.size),o=this.readSync(r.dataId),i=this.readSync(t.dataId),a=0;a<o.length;++a){var l=o[a];s[a]=l>=1?i[a]:i[a]*(l+1)}return this.makeOutput(s,r.shape,"float32")},e.prototype.selu=function(t){Ze(t,"selu");for(var r=i6,s=a6,o=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a){var l=i[a];o[a]=l>=0?s*l:r*(Math.exp(l)-1)}return this.makeOutput(o,t.shape,"float32")},e.prototype.clip=function(t,r,s){Ze(t,"clip");for(var o=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a){var l=i[a];o[a]=l>s?s:l<r?r:l}return this.makeOutput(o,t.shape,"float32")},e.prototype.abs=function(t){for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),o=0;o<s.length;++o)r[o]=Math.abs(s[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.complexAbs=function(t){for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),o=0;o<t.size;++o){var i=s[2*o],a=s[2*o+1];r[o]=Math.hypot(i,a)}return this.makeOutput(r,t.shape,"float32")},e.prototype.int=function(t){Ze(t,"int");for(var r=new Int32Array(t.size),s=this.readSync(t.dataId),o=0;o<s.length;++o)r[o]=s[o];return this.makeOutput(r,t.shape,"int32")},e.prototype.sigmoid=function(t){Ze(t,"sigmoid");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),o=0;o<s.length;++o)r[o]=1/(1+Math.exp(-s[o]));return this.makeOutput(r,t.shape,"float32")},e.prototype.softplus=function(t){Ze(t,"softplus");for(var r=Math.log(11920928955078125e-23)+2,s=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i){var a=o[i]>-r,l=o[i]<r,c=Math.exp(o[i]),u=void 0;u=l?c:a?o[i]:Math.log(1+c),s[i]=u}return this.makeOutput(s,t.shape,"float32")},e.prototype.sin=function(t){Ze(t,"sin");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),o=0;o<s.length;++o)r[o]=Math.sin(s[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.cos=function(t){Ze(t,"cos");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),o=0;o<s.length;++o)r[o]=Math.cos(s[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.tan=function(t){Ze(t,"tan");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),o=0;o<s.length;++o)r[o]=Math.tan(s[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.asin=function(t){Ze(t,"asin");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),o=0;o<s.length;++o)r[o]=Math.asin(s[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.acos=function(t){Ze(t,"acos");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),o=0;o<s.length;++o)r[o]=Math.acos(s[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atan=function(t){Ze(t,"atan");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),o=0;o<s.length;++o)r[o]=Math.atan(s[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atan2=function(t,r){return Ze([t,r],"atan2"),this.broadcastedBinaryOp(t,r,t.dtype,(function(s,o){return Math.atan2(s,o)}))},e.prototype.sinh=function(t){Ze(t,"sinh");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),o=0;o<s.length;++o)r[o]=Math.sinh(s[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.cosh=function(t){Ze(t,"cosh");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),o=0;o<s.length;++o)r[o]=Math.cosh(s[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.tanh=function(t){Ze(t,"tanh");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),o=0;o<s.length;++o)r[o]=PQ(s[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.asinh=function(t){Ze(t,"asinh");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),o=0;o<s.length;++o)r[o]=Math.asinh(s[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.acosh=function(t){Ze(t,"acosh");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),o=0;o<s.length;++o)r[o]=Math.acosh(s[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atanh=function(t){Ze(t,"atanh");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),o=0;o<s.length;++o)r[o]=Math.atanh(s[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.erf=function(t){Ze(t,"erf");for(var r=new Float32Array(t.size),s=this.readSync(t.dataId),o=0;o<s.length;++o){var i=Math.sign(s[o]),a=Math.abs(s[o]),l=1/(1+.3275911*a);r[o]=i*(1-((((1.061405429*l-1.453152027)*l+1.421413741)*l-.284496736)*l+.254829592)*l*Math.exp(-a*a))}return this.makeOutput(r,t.shape,"float32")},e.prototype.step=function(t,r){r===void 0&&(r=0),Ze(t,"step");for(var s=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i){var a=o[i];isNaN(a)?s[i]=NaN:s[i]=a>0?1:r}return this.makeOutput(s,t.shape,"float32")},e.prototype.fusedConv2d=function(t){var r=t.input,s=t.filter,o=t.convInfo,i=t.bias,a=t.activation,l=t.preluActivationWeights,c=this.conv2d(r,s,o);return i&&(c=this.add(c,i)),a&&(c=XC(this,c,a,l)),c},e.prototype.conv2d=function(t,r,s){Ze([t,r],"conv2d");for(var o=s.filterHeight,i=s.filterWidth,a=s.dilationHeight,l=s.dilationWidth,c=s.padInfo.left,u=s.padInfo.top,d=s.dataFormat==="channelsLast",f=wn(s.outShape,t.dtype),p=t.strides[0],x=d?t.strides[1]:t.strides[2],v=d?t.strides[2]:1,y=d?1:t.strides[1],b=f.strides[0],w=d?f.strides[1]:f.strides[2],S=d?f.strides[2]:1,k=d?1:f.strides[1],N=this.readSync(t.dataId),I=this.readSync(r.dataId),T=f.values,F=0;F<s.batchSize;++F)for(var R=F*p,D=F*b,A=0;A<s.outHeight;++A)for(var P=D+A*w,B=A*s.strideHeight-u,L=0;L<o;L++){var W=B+L*a;if(!(W<0||W>=s.inHeight))for(var H=L*r.strides[0],G=R+W*x,M=0;M<s.outWidth;++M)for(var j=P+M*S,z=M*s.strideWidth-c,V=0;V<i;V++){var K=z+V*l;if(!(K<0||K>=s.inWidth))for(var J=G+K*v,oe=H+V*r.strides[1],Z=0;Z<s.inChannels;++Z){for(var de=N[J+Z*y],pe=0;pe<s.outChannels;++pe)T[j+pe*k]+=de*I[oe+pe];oe+=s.outChannels}}}return f.toTensor()},e.prototype.conv3d=function(t,r,s){for(var o=s.filterDepth,i=s.filterHeight,a=s.filterWidth,l=s.dilationDepth,c=s.dilationHeight,u=s.dilationWidth,d=s.padInfo.front,f=s.padInfo.left,p=s.padInfo.top,x=wn(s.outShape,t.dtype),v=this.readSync(t.dataId),y=this.readSync(r.dataId),b=x.values,w=0;w<s.batchSize;++w)for(var S=w*t.strides[0],k=w*x.strides[0],N=0;N<s.outDepth;++N)for(var I=k+N*x.strides[1],T=N*s.strideDepth-d,F=0;F<o;F++){var R=T+F*l;if(!(R<0||R>=s.inDepth))for(var D=F*r.strides[0],A=S+R*t.strides[1],P=0;P<s.outHeight;++P)for(var B=I+P*x.strides[2],L=P*s.strideHeight-p,W=0;W<i;W++){var H=L+W*c;if(!(H<0||H>=s.inHeight))for(var G=D+W*r.strides[1],M=A+H*t.strides[2],j=0;j<s.outWidth;++j)for(var z=B+j*s.outChannels,V=j*s.strideWidth-f,K=0;K<a;K++){var J=V+K*u;if(!(J<0||J>=s.inWidth))for(var oe=G+K*r.strides[2],Z=M+J*s.inChannels,de=oe,pe=0;pe<s.inChannels;++pe){for(var Ce=v[Z+pe],Ae=0;Ae<s.outChannels;++Ae)b[z+Ae]+=Ce*y[de+Ae];de+=s.outChannels}}}}return x.toTensor()},e.prototype.conv2dDerInput=function(t,r,s){Ze([t,r],"conv2dDerInput");for(var o=wn(s.inShape,"float32"),i=o.values,a=this.readSync(t.dataId),l=this.readSync(r.dataId),c=r.strides,u=c[0],d=c[1],f=c[2],p=s.batchSize,x=s.filterHeight,v=s.filterWidth,y=s.inChannels,b=s.inHeight,w=s.inWidth,S=s.outChannels,k=s.outHeight,N=s.outWidth,I=s.strideHeight,T=s.strideWidth,F=s.dataFormat,R=x-1-s.padInfo.top,D=v-1-s.padInfo.left,A=F==="channelsLast",P=o.strides[0],B=A?o.strides[1]:o.strides[2],L=A?o.strides[2]:1,W=A?1:o.strides[1],H=t.strides[0],G=A?t.strides[1]:t.strides[2],M=A?t.strides[2]:1,j=A?1:t.strides[1],z=0;z<p;++z)for(var V=0;V<y;++V)for(var K=0;K<b;++K)for(var J=K-R,oe=Math.max(0,Math.ceil(J/I)),Z=Math.min(k,(x+J)/I),de=0;de<w;++de){for(var pe=de-D,Ce=Math.max(0,Math.ceil(pe/T)),Ae=Math.min(N,(v+pe)/T),ze=0,et=oe;et<Z;++et)for(var gt=et*I-J,dt=Ce;dt<Ae;++dt)for(var Ct=H*z+G*et+M*dt,lt=u*(x-1-gt)+d*(v-1-(dt*T-pe))+f*V,bt=0;bt<S;++bt)ze+=a[Ct+j*bt]*l[lt+bt];i[P*z+B*K+L*de+W*V]=ze}return o.toTensor()},e.prototype.conv3dDerInput=function(t,r,s){for(var o=wn(s.inShape,"float32"),i=o.values,a=o.strides,l=a[0],c=a[1],u=a[2],d=a[3],f=this.readSync(t.dataId),p=t.strides,x=p[0],v=p[1],y=p[2],b=p[3],w=this.readSync(r.dataId),S=r.strides,k=S[0],N=S[1],I=S[2],T=S[3],F=s.batchSize,R=s.filterDepth,D=s.filterHeight,A=s.filterWidth,P=s.inChannels,B=s.inDepth,L=s.inHeight,W=s.inWidth,H=s.outChannels,G=s.outDepth,M=s.outHeight,j=s.outWidth,z=s.strideDepth,V=s.strideHeight,K=s.strideWidth,J=R-1-s.padInfo.front,oe=D-1-s.padInfo.top,Z=A-1-s.padInfo.left,de=0;de<F;++de)for(var pe=0;pe<P;++pe)for(var Ce=0;Ce<B;++Ce)for(var Ae=Ce-J,ze=Math.max(0,Math.ceil(Ae/z)),et=Math.min(G,(R+Ae)/z),gt=0;gt<L;++gt)for(var dt=gt-oe,Ct=Math.max(0,Math.ceil(dt/V)),lt=Math.min(M,(D+dt)/V),bt=0;bt<W;++bt){for(var rn=bt-Z,Ft=Math.max(0,Math.ceil(rn/K)),vn=Math.min(j,(A+rn)/K),te=0,q=ze;q<et;++q)for(var ke=q*z-Ae,He=Ct;He<lt;++He)for(var Ke=He*V-dt,Be=Ft;Be<vn;++Be)for(var ct=x*de+v*q+y*He+b*Be,Nt=k*(R-1-ke)+N*(D-1-Ke)+I*(A-1-(Be*K-rn))+T*pe,Rt=0;Rt<H;++Rt)te+=f[ct+Rt]*w[Nt+Rt];i[l*de+c*Ce+u*gt+d*bt+pe]=te}return o.toTensor()},e.prototype.conv2dDerFilter=function(t,r,s){Ze([t,r],"conv2dDerFilter");for(var o=s.strideHeight,i=s.strideWidth,a=s.filterHeight,l=s.filterWidth,c=s.dataFormat==="channelsLast",u=wn(s.filterShape,"float32"),d=s.padInfo.left,f=s.padInfo.top,p=this.bufferSync(t),x=this.bufferSync(r),v=0;v<a;++v)for(var y=Math.max(0,Math.ceil((f-v)/o)),b=Math.min(s.outHeight,(s.inHeight+f-v)/o),w=0;w<l;++w)for(var S=Math.max(0,Math.ceil((d-w)/i)),k=Math.min(s.outWidth,(s.inWidth+d-w)/i),N=0;N<s.inChannels;++N)for(var I=0;I<s.outChannels;++I){for(var T=0,F=0;F<s.batchSize;++F)for(var R=y;R<b;++R)for(var D=v+R*o-f,A=S;A<k;++A){var P=w+A*i-d;T+=c?p.get(F,D,P,N)*x.get(F,R,A,I):p.get(F,N,D,P)*x.get(F,I,R,A)}u.set(T,v,w,N,I)}return u.toTensor()},e.prototype.conv3dDerFilter=function(t,r,s){for(var o=s.strideDepth,i=s.strideHeight,a=s.strideWidth,l=s.filterDepth,c=s.filterHeight,u=s.filterWidth,d=wn(s.filterShape,"float32"),f=d.values,p=d.strides,x=p[0],v=p[1],y=p[2],b=p[3],w=this.readSync(r.dataId),S=r.strides,k=S[0],N=S[1],I=S[2],T=S[3],F=this.readSync(t.dataId),R=t.strides,D=R[0],A=R[1],P=R[2],B=R[3],L=s.padInfo.front,W=s.padInfo.left,H=s.padInfo.top,G=0;G<l;++G)for(var M=Math.max(0,Math.ceil((L-G)/o)),j=Math.min(s.outDepth,(s.inDepth+L-G)/o),z=G*x,V=0;V<c;++V)for(var K=Math.max(0,Math.ceil((H-V)/i)),J=Math.min(s.outHeight,(s.inHeight+H-V)/i),oe=V*v+z,Z=0;Z<u;++Z)for(var de=Math.max(0,Math.ceil((W-Z)/a)),pe=Math.min(s.outWidth,(s.inWidth+W-Z)/a),Ce=Z*y+oe,Ae=0;Ae<s.inChannels;++Ae)for(var ze=Ae*b+Ce,et=0;et<s.outChannels;++et){for(var gt=0,dt=0;dt<s.batchSize;++dt)for(var Ct=dt*D,lt=dt*k,bt=M;bt<j;++bt)for(var rn=(G+bt*o-L)*A+Ct,Ft=bt*N+lt,vn=K;vn<J;++vn)for(var te=(V+vn*i-H)*P+rn,q=vn*I+Ft,ke=de;ke<pe;++ke){var He=ke*T+q;gt+=F[(Z+ke*a-W)*B+te+Ae]*w[He+et]}f[ze+et]=gt}return d.toTensor()},e.prototype.fusedDepthwiseConv2D=function(t){var r=t.input,s=t.filter,o=t.convInfo,i=t.bias,a=t.activation,l=t.preluActivationWeights,c=this.depthwiseConv2D(r,s,o);return i&&(c=this.add(c,i)),a&&(c=XC(this,c,a,l)),c},e.prototype.depthwiseConv2D=function(t,r,s){Ze([t,r],"depthwiseConv2D");for(var o=s.filterHeight,i=s.filterWidth,a=s.dilationHeight,l=s.dilationWidth,c=s.padInfo.left,u=s.padInfo.top,d=s.outChannels/s.inChannels,f=wn(s.outShape,t.dtype),p=this.readSync(t.dataId),x=this.readSync(r.dataId),v=f.values,y=0;y<s.batchSize;++y)for(var b=y*t.strides[0],w=y*f.strides[0],S=0;S<s.outHeight;++S)for(var k=w+S*f.strides[1],N=S*s.strideHeight-c,I=0;I<o;++I){var T=N+I*a;if(!(T<0||T>=s.inHeight))for(var F=I*r.strides[0],R=b+T*t.strides[1],D=0;D<s.outWidth;++D)for(var A=k+D*f.strides[2],P=D*s.strideWidth-u,B=0;B<i;++B){var L=P+B*l;if(!(L<0||L>=s.inWidth))for(var W=F+B*r.strides[1],H=R+L*s.inChannels,G=A,M=W,j=0;j<s.inChannels;++j){for(var z=p[H+j],V=0;V<d;++V)v[G+V]+=z*x[M+V];G+=d,M+=d}}}return f.toTensor()},e.prototype.depthwiseConv2DDerInput=function(t,r,s){Ze([t,r],"depthwiseConv2DDerInput");for(var o=wn(s.inShape,"float32"),i=o.values,a=o.strides,l=a[0],c=a[1],u=a[2],d=this.readSync(t.dataId),f=t.strides,p=f[0],x=f[1],v=f[2],y=this.readSync(r.dataId),b=r.strides,w=b[0],S=b[1],k=b[2],N=s.batchSize,I=s.filterHeight,T=s.filterWidth,F=s.inChannels,R=s.inHeight,D=s.inWidth,A=s.outChannels,P=s.outHeight,B=s.outWidth,L=s.strideHeight,W=s.strideWidth,H=I-1-s.padInfo.top,G=T-1-s.padInfo.left,M=A/F,j=0;j<N;++j)for(var z=0;z<F;++z)for(var V=0;V<R;++V)for(var K=V-H,J=Math.max(0,Math.ceil(K/L)),oe=Math.min(P,(I+K)/L),Z=0;Z<D;++Z){for(var de=Z-G,pe=Math.max(0,Math.ceil(de/W)),Ce=Math.min(B,(T+de)/W),Ae=0,ze=J;ze<oe;++ze)for(var et=ze*L-K,gt=pe;gt<Ce;++gt)for(var dt=p*j+x*ze+v*gt,Ct=w*(I-1-et)+S*(T-1-(gt*W-de))+k*z,lt=0;lt<M;++lt)Ae+=d[dt+(z*M+lt)]*y[Ct+lt];i[l*j+c*V+u*Z+z]=Ae}return o.toTensor()},e.prototype.depthwiseConv2DDerFilter=function(t,r,s){Ze([t,r],"depthwiseConv2DDerFilter");for(var o=s.strideHeight,i=s.strideWidth,a=s.filterHeight,l=s.filterWidth,c=wn(s.filterShape,"float32"),u=s.padInfo.left,d=s.padInfo.top,f=s.outChannels/s.inChannels,p=this.bufferSync(t),x=this.bufferSync(r),v=0;v<a;++v)for(var y=Math.max(0,Math.ceil((d-v)/o)),b=Math.min(s.outHeight,(s.inHeight+d-v)/o),w=0;w<l;++w)for(var S=Math.max(0,Math.ceil((u-w)/i)),k=Math.min(s.outWidth,(s.inWidth+u-w)/i),N=0;N<s.outChannels;++N){for(var I=Math.trunc(N/f),T=N%f,F=0,R=0;R<s.batchSize;++R)for(var D=y;D<b;++D)for(var A=v+D*o-d,P=S;P<k;++P){var B=w+P*i-u;F+=p.get(R,A,B,I)*x.get(R,D,P,N)}c.set(F,v,w,I,T)}return c.toTensor()},e.prototype.tile=function(t,r){return Ze(t,"tile"),vF(this.bufferSync(t),r)},e.prototype.pad=function(t,r,s){Ze(t,"pad");var o=r.map((function(f,p){return f[0]+t.shape[p]+f[1]})),i=r.map((function(f){return f[0]})),a=this.bufferSync(t),l=wn(o,t.dtype);s!==0&&l.values.fill(s);for(var c=0;c<t.size;c++){var u=a.indexToLoc(c),d=u.map((function(f,p){return f+i[p]}));l.set.apply(l,[a.get.apply(a,u)].concat(d))}return l.toTensor()},e.prototype.transpose=function(t,r){Ze(t,"transpose");for(var s=new Array(t.rank),o=0;o<s.length;o++)s[o]=t.shape[r[o]];var i=this.readSync(t.dataId),a=wn(s,t.dtype),l=this.bufferSync(t);for(o=0;o<t.size;++o){for(var c=l.indexToLoc(o),u=new Array(c.length),d=0;d<u.length;d++)u[d]=c[r[d]];var f=a.locToIndex(u);a.values[f]=i[o]}return a.toTensor()},e.prototype.gather=function(t,r,s){Ze([t,r],"gather");var o=t.shape.slice(),i=this.readSync(r.dataId);o[s]=i.length;for(var a=wn(o,t.dtype),l=this.bufferSync(t),c=0;c<a.size;++c){var u=a.indexToLoc(c),d=u.slice();d[s]=i[u[s]];var f=l.locToIndex(d);a.values[c]=l.values[f]}return a.toTensor()},e.prototype.batchToSpaceND=function(t,r,s){Ze([t],"batchToSpaceND");var o=r.reduce((function(d,f){return d*f})),i=v2(t.shape,r,o),a=y2(i.length,r.length),l=b2(t.shape,r,o),c=oF(s,r.length),u=iF(l,s,r.length);return t.reshape(i).transpose(a).reshape(l).slice(c,u)},e.prototype.spaceToBatchND=function(t,r,s){Ze([t],"spaceToBatchND");var o=r.reduce((function(f,p){return f*p})),i=[[0,0]];i.push.apply(i,s);for(var a=1+r.length;a<t.shape.length;++a)i.push([0,0]);var l=t.pad(i),c=v2(l.shape,r,o,!1),u=y2(c.length,r.length,!1),d=b2(l.shape,r,o,!1);return l.reshape(c).transpose(u).reshape(d)},e.prototype.pool=function(t,r,s){Ze(t,"pool");for(var o=r.strideHeight,i=r.strideWidth,a=r.dilationHeight,l=r.dilationWidth,c=r.effectiveFilterHeight,u=r.effectiveFilterWidth,d=r.padInfo.top,f=r.padInfo.left,p=s==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,x=this.readSync(t.dataId),v=wn(r.outShape,t.dtype),y=v.values,b=r.outShape[1]*r.outShape[2]*r.outShape[3],w=r.outShape[2]*r.outShape[3],S=r.outShape[3],k=0;k<r.batchSize;++k)for(var N=k*b,I=k*t.strides[0],T=0;T<r.inChannels;++T)for(var F=0;F<r.outHeight;++F)for(var R=F*o-d,D=Math.max(0,R),A=Math.min(r.inHeight,c+R),P=N+F*w,B=0;B<r.outWidth;++B){for(var L=B*i-f,W=Math.max(0,L),H=Math.min(r.inWidth,u+L),G=p,M=0,j=0,z=D;z<A;z+=a){for(var V=I+z*t.strides[1],K=W;K<H;K+=l){var J=x[V+K*t.strides[2]+T];s==="max"&&J>G?G=J:s==="avg"&&(M+=J,j++)}if(isNaN(G))break}y[P+B*S+T]=s==="avg"?M/j:G}return v.toTensor()},e.prototype.maxPool=function(t,r){return this.pool(t,r,"max")},e.prototype.maxPoolPositions=function(t,r){for(var s=wn(r.outShape,"int32"),o=r.strideHeight,i=r.strideWidth,a=r.dilationHeight,l=r.dilationWidth,c=r.effectiveFilterHeight,u=r.effectiveFilterWidth,d=r.padInfo.top,f=r.padInfo.left,p=this.bufferSync(t),x=0;x<r.batchSize;++x)for(var v=0;v<r.inChannels;++v)for(var y=0;y<r.outHeight;++y){for(var b=y*o-d,w=b;w<0;)w+=a;for(var S=Math.min(r.inHeight,c+b),k=0;k<r.outWidth;++k){for(var N=k*i-f,I=N;I<0;)I+=l;for(var T=Math.min(r.inWidth,u+N),F=Number.NEGATIVE_INFINITY,R=-1,D=w;D<S;D+=a)for(var A=D-b,P=I;P<T;P+=l){var B=P-N,L=p.get(x,D,P,v);L>F&&(F=L,R=A*u+B)}s.set(R,x,y,k,v)}}return s.toTensor()},e.prototype.maxPoolBackprop=function(t,r,s,o){Ze([r,s],"maxPoolBackprop");for(var i=this.maxPoolPositions(r,o),a=o.strideHeight,l=o.strideWidth,c=o.dilationHeight,u=o.dilationWidth,d=o.effectiveFilterHeight,f=o.effectiveFilterWidth,p=f-1-o.padInfo.left,x=d-1-o.padInfo.top,v=wn(r.shape,"float32"),y=this.bufferSync(i),b=this.bufferSync(t),w=0;w<o.batchSize;++w)for(var S=0;S<o.inChannels;++S)for(var k=0;k<o.inHeight;++k)for(var N=0;N<o.inWidth;++N){for(var I=k-x,T=N-p,F=0,R=0;R<d;R+=c){var D=(I+R)/a;if(!(D<0||D>=o.outHeight||Math.floor(D)!==D))for(var A=0;A<f;A+=u){var P=(T+A)/l;if(!(P<0||P>=o.outWidth||Math.floor(P)!==P)){var B=d*f-1-y.get(w,D,P,S)===R*f+A?1:0;B!==0&&(F+=b.get(w,D,P,S)*B)}}}v.set(F,w,k,N,S)}return v.toTensor()},e.prototype.avgPoolBackprop=function(t,r,s){Ze([t,r],"avgPoolBackprop");for(var o=s.strideHeight,i=s.strideWidth,a=s.filterHeight,l=s.filterWidth,c=s.dilationHeight,u=s.dilationWidth,d=s.effectiveFilterHeight,f=s.effectiveFilterWidth,p=f-1-s.padInfo.left,x=d-1-s.padInfo.top,v=wn(r.shape,"float32"),y=1/(a*l),b=this.bufferSync(t),w=0;w<s.batchSize;++w)for(var S=0;S<s.inChannels;++S)for(var k=0;k<s.inHeight;++k)for(var N=0;N<s.inWidth;++N){for(var I=k-x,T=N-p,F=0,R=0;R<d;R+=c){var D=(I+R)/o;if(!(D<0||D>=s.outHeight||Math.floor(D)!==D))for(var A=0;A<f;A+=u){var P=(T+A)/i;P<0||P>=s.outWidth||Math.floor(P)!==P||(F+=b.get(w,D,P,S))}}v.set(F*y,w,k,N,S)}return v.toTensor()},e.prototype.pool3d=function(t,r,s){Ze(t,"pool3d");for(var o=r.strideDepth,i=r.strideHeight,a=r.strideWidth,l=r.dilationDepth,c=r.dilationHeight,u=r.dilationWidth,d=r.effectiveFilterDepth,f=r.effectiveFilterHeight,p=r.effectiveFilterWidth,x=r.padInfo.front,v=r.padInfo.top,y=r.padInfo.left,b=s==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,w=this.readSync(t.dataId),S=wn(r.outShape,t.dtype),k=S.values,N=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],I=r.outShape[2]*r.outShape[3]*r.outShape[4],T=r.outShape[3]*r.outShape[4],F=r.outShape[4],R=0;R<r.batchSize;++R)for(var D=R*N,A=R*t.strides[0],P=0;P<r.inChannels;++P)for(var B=0;B<r.outDepth;++B){for(var L=B*o-x,W=L;W<0;)W+=l;for(var H=Math.min(r.inDepth,d+L),G=D+B*I,M=0;M<r.outHeight;++M){for(var j=M*i-v,z=j;z<0;)z+=c;for(var V=Math.min(r.inHeight,f+j),K=G+M*T,J=0;J<r.outWidth;++J){for(var oe=J*a-y,Z=oe;Z<0;)Z+=u;for(var de=Math.min(r.inWidth,p+oe),pe=K+J*F,Ce=b,Ae=0,ze=0,et=W;et<H;et+=l){for(var gt=A+et*t.strides[1],dt=z;dt<V;dt+=c){for(var Ct=gt+dt*t.strides[2],lt=Z;lt<de;lt+=u){var bt=w[Ct+lt*t.strides[3]+P];if(s==="max"&&bt>Ce?Ce=bt:s==="avg"&&(Ae+=bt,ze++),isNaN(Ce))break}if(isNaN(Ce))break}if(isNaN(Ce))break}k[pe+P]=s==="avg"?Ae/ze:Ce}}}return S.toTensor()},e.prototype.avgPool3d=function(t,r){return Ze(t,"avgPool3d"),this.pool3d(t,r,"avg").toFloat()},e.prototype.avgPool3dBackprop=function(t,r,s){Ze([t,r],"avgPool3dBackprop");for(var o=s.strideDepth,i=s.strideHeight,a=s.strideWidth,l=s.filterDepth,c=s.filterHeight,u=s.filterWidth,d=s.dilationDepth,f=s.dilationHeight,p=s.dilationWidth,x=s.effectiveFilterDepth,v=s.effectiveFilterHeight,y=s.effectiveFilterWidth,b=x-1-s.padInfo.front,w=y-1-s.padInfo.left,S=v-1-s.padInfo.top,k=wn(r.shape,"float32"),N=1/(l*c*u),I=this.bufferSync(t),T=0;T<s.batchSize;++T)for(var F=0;F<s.inChannels;++F)for(var R=0;R<s.inDepth;++R)for(var D=0;D<s.inHeight;++D)for(var A=0;A<s.inWidth;++A){for(var P=R-b,B=D-S,L=A-w,W=0,H=0;H<x;H+=d){var G=(P+H)/o;if(!(G<0||G>=s.outDepth||Math.floor(G)!==G))for(var M=0;M<v;M+=f){var j=(B+M)/i;if(!(j<0||j>=s.outHeight||Math.floor(j)!==j))for(var z=0;z<y;z+=p){var V=(L+z)/a;V<0||V>=s.outWidth||Math.floor(V)!==V||(W+=I.get(T,G,j,V,F))}}}k.set(W*N,T,R,D,A,F)}return k.toTensor()},e.prototype.maxPool3d=function(t,r){return Ze(t,"maxPool3d"),this.pool3d(t,r,"max").toFloat()},e.prototype.maxPool3dPositions=function(t,r){for(var s=wn(r.outShape,"int32"),o=r.strideDepth,i=r.strideHeight,a=r.strideWidth,l=r.dilationDepth,c=r.dilationHeight,u=r.dilationWidth,d=r.effectiveFilterDepth,f=r.effectiveFilterHeight,p=r.effectiveFilterWidth,x=r.padInfo.front,v=r.padInfo.top,y=r.padInfo.left,b=this.bufferSync(t),w=0;w<r.batchSize;++w)for(var S=0;S<r.inChannels;++S)for(var k=0;k<r.outDepth;++k){for(var N=k*o-x,I=N;I<0;)I+=l;for(var T=Math.min(r.inDepth,d+N),F=0;F<r.outHeight;++F){for(var R=F*i-v,D=R;D<0;)D+=c;for(var A=Math.min(r.inHeight,f+R),P=0;P<r.outWidth;++P){for(var B=P*a-y,L=B;L<0;)L+=u;for(var W=Math.min(r.inWidth,p+B),H=Number.NEGATIVE_INFINITY,G=-1,M=I;M<T;M+=l)for(var j=M-N,z=D;z<A;z+=c)for(var V=z-R,K=L;K<W;K+=u){var J=K-B,oe=b.get(w,M,z,K,S);oe>=H&&(H=oe,G=j*f*p+V*f+J)}s.set(G,w,k,F,P,S)}}}return s.toTensor()},e.prototype.maxPool3dBackprop=function(t,r,s,o){Ze([r,s],"maxPool3dBackprop");for(var i=this.maxPool3dPositions(r,o),a=o.strideDepth,l=o.strideHeight,c=o.strideWidth,u=o.dilationDepth,d=o.dilationHeight,f=o.dilationWidth,p=o.effectiveFilterDepth,x=o.effectiveFilterHeight,v=o.effectiveFilterWidth,y=p-1-o.padInfo.front,b=v-1-o.padInfo.left,w=x-1-o.padInfo.top,S=wn(r.shape,"float32"),k=this.bufferSync(i),N=this.bufferSync(t),I=0;I<o.batchSize;++I)for(var T=0;T<o.inChannels;++T)for(var F=0;F<o.inDepth;++F)for(var R=0;R<o.inHeight;++R)for(var D=0;D<o.inWidth;++D){for(var A=F-y,P=R-w,B=D-b,L=0,W=0;W<p;W+=u){var H=(A+W)/a;if(!(H<0||H>=o.outDepth||Math.floor(H)!==H))for(var G=0;G<x;G+=d){var M=(P+G)/l;if(!(M<0||M>=o.outHeight||Math.floor(M)!==M))for(var j=0;j<v;j+=f){var z=(B+j)/c;if(!(z<0||z>=o.outWidth||Math.floor(z)!==z)){var V=p*x*v-1-k.get(I,H,M,z,T)===W*x*v+G*v+j?1:0;V!==0&&(L+=N.get(I,H,M,z,T)*V)}}}}S.set(L,I,F,R,D,T)}return S.toTensor()},e.prototype.cast=function(t,r){return pF(t,r,this)},e.prototype.reshape=function(t,r){return g5(t,r)},e.prototype.avgPool=function(t,r){return Ze(t,"avgPool"),this.pool(t,r,"avg").toFloat()},e.prototype.resizeBilinear=function(t,r,s,o){Ze(t,"resizeBilinear");for(var i=t.shape,a=i[0],l=i[1],c=i[2],u=i[3],d=this.readSync(t.dataId),f=new Float32Array(Xt([a,r,s,u])),p=[o&&r>1?l-1:l,o&&s>1?c-1:c],x=[o&&r>1?r-1:r,o&&s>1?s-1:s],v=0,y=p[0]/x[0],b=p[1]/x[1],w=0;w<a;w++)for(var S=0;S<r;S++)for(var k=y*S,N=Math.floor(k),I=k-N,T=Math.min(l-1,Math.ceil(k)),F=w*t.strides[0]+N*t.strides[1],R=w*t.strides[0]+T*t.strides[1],D=0;D<s;D++)for(var A=b*D,P=Math.floor(A),B=A-P,L=Math.min(c-1,Math.ceil(A)),W=F+P*t.strides[2],H=R+P*t.strides[2],G=F+L*t.strides[2],M=R+L*t.strides[2],j=0;j<u;j++){var z=d[W+j],V=d[H+j],K=z+(d[G+j]-z)*B,J=K+(V+(d[M+j]-V)*B-K)*I;f[v++]=J}return ho(f,[a,r,s,u])},e.prototype.resizeBilinearBackprop=function(t,r,s){Ze([t,r],"resizeBilinearBackprop");for(var o=r.shape,i=o[0],a=o[1],l=o[2],c=o[3],u=t.shape,d=u[1],f=u[2],p=new Float32Array(i*a*l*c),x=[s&&d>1?a-1:a,s&&f>1?l-1:l],v=[s&&d>1?d-1:d,s&&f>1?f-1:f],y=x[0]/v[0],b=x[1]/v[1],w=this.readSync(t.dataId),S=0,k=0;k<i;k++)for(var N=k*r.strides[0],I=0;I<d;I++)for(var T=I*y,F=Math.floor(T),R=Math.min(Math.ceil(T),a-1),D=N+F*r.strides[1],A=N+R*r.strides[1],P=T-F,B=1-P,L=0;L<f;L++)for(var W=L*b,H=Math.floor(W),G=Math.min(Math.ceil(W),l-1),M=W-H,j=1-M,z=D+H*r.strides[2],V=D+G*r.strides[2],K=A+H*r.strides[2],J=A+G*r.strides[2],oe=B*j,Z=B*M,de=P*j,pe=P*M,Ce=0;Ce<c;Ce++){var Ae=w[S++];p[z+Ce]+=Ae*oe,p[V+Ce]+=Ae*Z,p[K+Ce]+=Ae*de,p[J+Ce]+=Ae*pe}return yi(p,[i,l,a,c],r.dtype)},e.prototype.resizeNearestNeighbor=function(t,r,s,o){Ze(t,"resizeNearestNeighbor");for(var i=t.shape,a=i[0],l=i[1],c=i[2],u=i[3],d=this.readSync(t.dataId),f=new Float32Array(a*r*s*u),p=[o&&r>1?l-1:l,o&&s>1?c-1:c],x=[o&&r>1?r-1:r,o&&s>1?s-1:s],v=p[0]/x[0],y=p[1]/x[1],b=0,w=0;w<a;w++)for(var S=w*t.strides[0],k=0;k<r;k++)for(var N=v*k,I=S+Math.min(l-1,o?Math.round(N):Math.floor(N))*t.strides[1],T=0;T<s;T++)for(var F=y*T,R=I+Math.min(c-1,o?Math.round(F):Math.floor(F))*t.strides[2],D=0;D<u;D++){var A=d[R+D];f[b++]=A}return ho(f,[a,r,s,u],t.dtype)},e.prototype.resizeNearestNeighborBackprop=function(t,r,s){Ze([t,r],"resizeNearestNeighborBackprop");for(var o=r.shape,i=o[0],a=o[1],l=o[2],c=o[3],u=t.shape,d=u[1],f=u[2],p=new Float32Array(i*a*l*c),x=this.readSync(t.dataId),v=[s&&d>1?a-1:a,s&&f>1?l-1:l],y=[s&&d>1?d-1:d,s&&f>1?f-1:f],b=v[0]/y[0],w=v[1]/y[1],S=1/b,k=1/w,N=2*Math.ceil(S)+2,I=2*Math.ceil(k)+2,T=0;T<i;T++)for(var F=T*r.strides[0],R=0;R<a;R++)for(var D=F+R*r.strides[1],A=Math.floor(R*S),P=Math.floor(A-N/2),B=0;B<l;B++)for(var L=D+B*r.strides[2],W=Math.floor(B*k),H=Math.floor(W-I/2),G=0;G<c;G++){for(var M=0,j=0;j<N;j++){var z=j+P;if(!(z<0||z>=d)){var V=F+z*t.strides[1],K=z*b;if(R===Math.min(a-1,s?Math.round(K):Math.floor(K)))for(var J=0;J<I;J++){var oe=J+H;if(!(oe<0||oe>=f)){var Z=V+oe*t.strides[2],de=oe*w;B===Math.min(l-1,s?Math.round(de):Math.floor(de))&&(M+=x[Z+G])}}}}p[L+G]=M}return yi(p,r.shape,r.dtype)},e.prototype.batchNormalization=function(t,r,s,o,i,a){Ze([t,r,s,i,a],"batchNorm");for(var l=this.readSync(t.dataId),c=this.readSync(r.dataId),u=this.readSync(s.dataId),d=i?this.readSync(i.dataId):new Float32Array([1]),f=a?this.readSync(a.dataId):new Float32Array([0]),p=new Float32Array(l.length),x=f.length,v=d.length,y=u.length,b=c.length,w=0,S=0,k=0,N=0,I=0;I<l.length;++I)p[I]=f[w++]+(l[I]-c[S++])*d[k++]/Math.sqrt(u[N++]+o),w>=x&&(w=0),S>=b&&(S=0),k>=v&&(k=0),N>=y&&(N=0);return yi(p,t.shape)},e.prototype.localResponseNormalization4D=function(t,r,s,o,i){Ze(t,"localResponseNormalization4D");var a=t.shape[3],l=a-1,c=this.readSync(t.dataId),u=t.size,d=new Float32Array(u);function f(y){for(var b=y%a,w=y-b+Math.max(0,b-r),S=y-b+Math.min(b+r,l),k=0;w<=S;w++){var N=c[w];k+=N*N}return k}for(var p=0;p<u;p++){var x=f(p),v=c[p]*Math.pow(s+o*x,-i);d[p]=v}return yi(d,t.shape)},e.prototype.LRNGrad=function(t,r,s,o,i,a,l){Ze(t,"LRNGrad");for(var c=t.shape[3],u=this.readSync(t.dataId),d=this.readSync(r.dataId),f=this.readSync(s.dataId),p=new Float32Array(t.size),x=t.size,v=0;v<x;v++){for(var y=v%c,b=v-y+Math.max(0,y-o),w=v-y+Math.min(c,y+o+1),S=0,k=b;k<w;k++)S+=Math.pow(d[k],2);for(S=a*S+i,k=b;k<w;k++){var N=-2*a*l*d[k]*f[v]/S;v===k&&(N+=Math.pow(S,-l)),N*=u[v],p[k]+=N}}return yi(p,t.shape)},e.prototype.multinomial=function(t,r,s,o){Ze(t,"multinomial");for(var i=r?t:Kc(t),a=i.shape[0],l=i.shape[1],c=Mr([a,s],"int32"),u=this.readSync(c.dataId),d=this.readSync(i.dataId),f=0;f<a;++f){var p=f*l,x=new Float32Array(l-1);x[0]=d[p];for(var v=1;v<x.length;++v)x[v]=x[v-1]+d[p+v];for(var y=_y(o.toString()),b=f*s,w=0;w<s;++w){var S=y();u[b+w]=x.length;for(var k=0;k<x.length;k++)if(S<x[k]){u[b+w]=k;break}}}return c},e.prototype.oneHot=function(t,r,s,o){Ze(t,"oneHot");var i=new Float32Array(t.size*r);i.fill(o);for(var a=this.readSync(t.dataId),l=0;l<t.size;++l)a[l]>=0&&a[l]<r&&(i[l*r+a[l]]=s);return Xu(i,[t.size,r],"int32")},e.prototype.nonMaxSuppression=function(t,r,s,o,i){return Ze(t,"nonMaxSuppression"),n6(this.readSync(t.dataId),this.readSync(r.dataId),s,o,i)},e.prototype.fft=function(t){return this.fftBatch(t,!1)},e.prototype.ifft=function(t){return this.fftBatch(t,!0)},e.prototype.fftBatch=function(t,r){for(var s=t.shape[0],o=t.shape[1],i=wn(t.shape,"float32"),a=wn(t.shape,"float32"),l=Sa(t).as2D(s,o),c=Ul(t).as2D(s,o),u=0;u<s;u++)for(var d=l.slice([u,0],[1,o]),f=c.slice([u,0],[1,o]),p=uo(d,f),x=this.readSync(this.fftImpl(p,r).dataId),v=0;v<o;v++){var y=tT(x,v);i.values[u*o+v]=y.real,a.values[u*o+v]=y.imag}return uo(i.toTensor(),a.toTensor()).as2D(s,o)},e.prototype.fftImpl=function(t,r){var s=t.as1D(),o=s.size;if(this.isExponentOf2(o)){var i=this.fftRadix2(s,o,r).as2D(t.shape[0],t.shape[1]);return r&&(i=uo(Sa(i).div(St(o)),Ul(i).div(St(o)))),i}var a=this.readSync(t.dataId),l=(function(c){for(var u=new Float32Array(c.length/2),d=new Float32Array(c.length/2),f=0;f<c.length;f+=2)u[f/2]=c[f],d[f/2]=c[f+1];return{real:u,imag:d}})(this.fourierTransformByMatmul(a,o,r));return uo(l.real,l.imag).as2D(t.shape[0],t.shape[1])},e.prototype.isExponentOf2=function(t){return(t&t-1)==0},e.prototype.fftRadix2=function(t,r,s){if(r===1)return t;var o=this.readSync(t.dataId),i=r/2,a=(function(b){for(var w=Math.ceil(b.length/4),S=new Float32Array(w),k=new Float32Array(w),N=0;N<b.length;N+=4)S[Math.floor(N/4)]=b[N],k[Math.floor(N/4)]=b[N+1];return{real:S,imag:k}})(o),l=uo(a.real,a.imag).as1D(),c=(function(b){for(var w=Math.floor(b.length/4),S=new Float32Array(w),k=new Float32Array(w),N=2;N<b.length;N+=4)S[Math.floor(N/4)]=b[N],k[Math.floor(N/4)]=b[N+1];return{real:S,imag:k}})(o),u=uo(c.real,c.imag).as1D();l=this.fftRadix2(l,i,s),u=this.fftRadix2(u,i,s);var d=(function(b,w){for(var S=new Float32Array(b/2),k=new Float32Array(b/2),N=0;N<Math.ceil(b/2);N++){var I=(w?2:-2)*Math.PI*(N/b);S[N]=Math.cos(I),k[N]=Math.sin(I)}return{real:S,imag:k}})(r,s),f=uo(d.real,d.imag).mul(u),p=l.add(f),x=l.sub(f),v=Sa(p).concat(Sa(x)),y=Ul(p).concat(Ul(x));return uo(v,y).as1D()},e.prototype.fourierTransformByMatmul=function(t,r,s){for(var o=new Float32Array(2*r),i=0;i<r;i++){for(var a=0,l=0,c=0;c<r;c++){var u=pte(i*c,r,s),d=tT(t,c);a+=d.real*u.real-d.imag*u.imag,l+=d.real*u.imag+d.imag*u.real}s&&(a/=r,l/=r),hte(o,a,l,i)}return o},e.prototype.depthToSpace=function(t,r,s){ee(s==="NHWC",(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+s})),ee(r>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+r}));for(var o=t.shape[0],i=t.shape[1],a=t.shape[2],l=t.shape[3],c=i*r,u=a*r,d=l/(r*r),f=this.readSync(t.dataId),p=new Float32Array(o*c*u*d),x=0,v=0;v<o;++v)for(var y=0;y<c;++y)for(var b=Math.floor(y/r),w=y%r,S=0;S<u;++S)for(var k=Math.floor(S/r),N=(w*r+S%r)*d,I=0;I<d;++I){var T=I+N+l*(k+a*(b+i*v));p[x++]=f[T]}return yi(p,[o,c,u,d])},e.prototype.broadcastedBinaryOp=function(t,r,s,o){var i=zn(t.shape,r.shape),a=wn(i,s),l=this.readSync(t.dataId),c=this.readSync(r.dataId),u=Wu(t.shape,i),d=Wu(r.shape,i),f=a.values;if(u.length+d.length===0)for(var p=0;p<f.length;++p)f[p]=o(l[p%l.length],c[p%c.length]);else{var x=this.bufferSync(t),v=this.bufferSync(r),y=function(b){var w=a.indexToLoc(b),S=w.slice(-t.rank);u.forEach((function(T){return S[T]=0}));var k=x.locToIndex(S),N=w.slice(-r.rank);d.forEach((function(T){return N[T]=0}));var I=v.locToIndex(N);f[b]=o(l[k],c[I])};for(p=0;p<f.length;++p)y(p)}return a.toTensor()},e.prototype.broadcastedBinaryComplexOp=function(t,r,s){var o=zn(t.shape,r.shape),i=wn(o,"float32"),a=wn(o,"float32"),l=this.readSync(t.dataId),c=this.readSync(r.dataId),u=Wu(t.shape,o),d=Wu(r.shape,o),f=i.values,p=a.values;if(u.length+d.length===0)for(var x=0;x<f.length;x++){var v=x%l.length,y=x%c.length,b=s(l[2*v],l[2*v+1],c[2*y],c[2*y+1]);f[x]=b.real,p[x]=b.imag}else{var w=this.bufferSync(this.data.get(t.dataId).complexTensors.real),S=this.bufferSync(this.data.get(r.dataId).complexTensors.real),k=function(N){var I=i.indexToLoc(N),T=I.slice(-t.rank);u.forEach((function(P){return T[P]=0}));var F=w.locToIndex(T),R=I.slice(-r.rank);d.forEach((function(P){return R[P]=0}));var D=S.locToIndex(R),A=s(l[2*F],l[2*F+1],c[2*D],c[2*D+1]);f[N]=A.real,p[N]=A.imag};for(x=0;x<f.length;x++)k(x)}return this.complex(i.toTensor(),a.toTensor())},e.prototype.split=function(t,r,s){return xF(t,r,s)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return 1e-7},e.prototype.cropAndResize=function(t,r,s,o,i,a){for(var l=t.shape,c=l[0],u=l[1],d=l[2],f=l[3],p=r.shape[0],x=o[0],v=o[1],y=wn([p,x,v,f],"float32"),b=this.readSync(r.dataId),w=this.readSync(s.dataId),S=this.readSync(t.dataId),k=t.strides,N=y.strides,I=0;I<p;I++){var T=4*I,F=b[T],R=b[T+1],D=b[T+2],A=b[T+3],P=w[I];if(!(P>=c))for(var B=x>1?(D-F)*(u-1)/(x-1):0,L=v>1?(A-R)*(d-1)/(v-1):0,W=0;W<x;W++){var H=x>1?F*(u-1)+W*B:.5*(F+D)*(u-1);if(H<0||H>u-1)for(var G=0;G<v;G++)for(var M=0;M<f;M++){var j=M+G*N[2]+W*N[1]+I*N[0];y.values[j]=a}else if(i==="bilinear"){var z=Math.floor(H),V=Math.ceil(H),K=H-z;for(G=0;G<v;G++)if((et=v>1?R*(d-1)+G*L:.5*(R+A)*(d-1))<0||et>d-1)for(M=0;M<f;M++)j=M+G*N[2]+W*N[1]+I*N[0],y.values[j]=a;else{var J=Math.floor(et),oe=Math.ceil(et),Z=et-J;for(M=0;M<f;M++){var de=S[j=M+J*k[2]+z*k[1]+P*k[0]],pe=S[j=M+oe*k[2]+z*k[1]+P*k[0]],Ce=S[j=M+J*k[2]+V*k[1]+P*k[0]],Ae=de+(pe-de)*Z,ze=Ce+(S[j=M+oe*k[2]+V*k[1]+P*k[0]]-Ce)*Z;j=M+G*N[2]+W*N[1]+I*N[0],y.values[j]=Ae+(ze-Ae)*K}}}else for(G=0;G<v;++G){var et;if((et=v>1?R*(d-1)+G*L:.5*(R+A)*(d-1))<0||et>d-1)for(M=0;M<f;M++)j=M+G*N[2]+W*N[1]+I*N[0],y.values[j]=a;else{var gt=Math.round(et),dt=Math.round(H);for(M=0;M<f;M++){var Ct=M+gt*k[2]+dt*k[1]+P*k[0],lt=M+G*N[2]+W*N[1]+I*N[0];y.values[lt]=S[Ct]}}}}}return y.toTensor()},e.prototype.sparseToDense=function(t,r,s,o){var i=w2(0,t,s),a=i.sliceRank,l=i.numUpdates,c=i.sliceSize,u=i.strides,d=i.outputSize;return this.scatter(t,r,s,d,c,l,a,u,o,!1)},e.prototype.gatherND=function(t,r){var s=r.shape,o=s[s.length-1],i=aF(t,r),a=i[0],l=i[1],c=i[2],u=i[3];if(l===0)return ho([],a,t.dtype);for(var d=new Tg([l,c],t.dtype),f=this.readSync(r.dataId),p=this.readSync(t.dataId),x=0;x<l;x++){for(var v=[],y=0,b=0;b<o;b++){var w=f[x*o+b];y+=w*u[b],v.push(w)}if(y<0||y>=t.size/c)throw new Error("Invalid indices: "+v+" does not index into "+t.shape);for(var S=0;S<c;S++)d.values[x*c+S]=p[y*c+S]}return d.toTensor().reshape(a)},e.prototype.scatterND=function(t,r,s){var o=w2(0,t,s),i=o.sliceRank,a=o.numUpdates,l=o.sliceSize,c=o.strides,u=o.outputSize,d=St(0);return this.scatter(t,r,s,u,l,a,i,c,d,!0)},e.prototype.fill=function(t,r,s){var o=d2(s=s||Qg(r),Xt(t));return o.fill(r),ge.makeTensor(o,t,s,this)},e.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){var r=d2(t.dtype,Xt(t.shape));return this.makeOutput(r,t.shape,t.dtype)},e.prototype.linspace=function(t,r,s){return mF(t,r,s)},e.prototype.scatter=function(t,r,s,o,i,a,l,c,u,d){var f=[o/i,i],p=this.readSync(t.dataId),x=this.readSync(r.dataId);if(o===0)return ho([],s,r.dtype);var v=new Tg(f,r.dtype);v.values.fill(this.readSync(u.dataId)[0]);for(var y=0;y<a;y++){for(var b=[],w=0,S=0;S<l;S++){var k=p[y*l+S];b.push(k),w+=k*c[S]}if(w<0||w>=o/i)throw new Error("Invalid indices: "+b+" does not index into "+s);for(var N=0;N<i;N++)d?v.values[w*i+N]+=x[y*i+N]:v.values[w*i+N]=r.rank===0?x[0]:x[y*i+N]}return v.toTensor().reshape(s)},e})(fF);ge.registerBackend("cpu",(function(){return new Foe}),1);for(var YC=0,kT=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs,s=e,o=s.boxes,i=s.scores,a=r,l=a.maxOutputSize,c=a.iouThreshold,u=a.scoreThreshold,d=a.softNmsSigma,f=t;Ze(o,"NonMaxSuppressionWithScore");var p=r6(f.data.get(o.dataId).values,f.data.get(i.dataId).values,l,c,u,d);return[p.selectedIndices,p.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e.x,s=t;Ze(r,"square");for(var o=s.data.get(r.dataId).values,i=new Float32Array(o.length),a=0;a<o.length;++a){var l=o[a];i[a]=l*l}return{dataId:s.write(i,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:Dg,backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e,s=r.a,o=r.b,i=t;Ze([s,o],Dg);var a=i.data.get(s.dataId).values,l=i.data.get(o.dataId).values,c=(function(f,p,x,v,y,b){var w=zn(f,p),S=w.length,k=Zl(w),N=Ig(y,Xt(w)),I=f.length,T=p.length,F=Zl(f),R=Zl(p),D=Wu(f,w),A=Wu(p,w);if(D.length+A.length===0)for(var P=0;P<N.length;++P)N[P]=b(x[P%x.length],v[P%v.length]);else{var B=function(L){var W=UQ(L,S,k),H=W.slice(-I);D.forEach((function(z){return H[z]=0}));var G=G9(H,I,F),M=W.slice(-T);A.forEach((function(z){return M[z]=0}));var j=G9(M,T,R);N[L]=b(x[G],v[j])};for(P=0;P<N.length;++P)B(P)}return[N,w]})(s.shape,o.shape,a,l,s.dtype,(function(f,p){var x=f-p;return x*x})),u=c[0],d=c[1];return{dataId:i.write(u,d,s.dtype),shape:d,dtype:s.dtype}}}];YC<kT.length;YC++)B$(kT[YC]);var Lh,Poe=function(n){this.variableNames=["A"];var e=Oo(),t=n[0],r=n[1];this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+r+".0, "+t+`.0);

        vec4 values = `+e.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `},Ooe=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var e=Oo(),t=n[0],r=n[1];this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+r+".0, "+t+`.0);
            vec4 values = `+e.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+e.output+` = result;
      }
    `};for(var ZC=0,ST=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs,s=e.pixels,o=r.numChannels,i=typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement,l=i?[s.videoWidth,s.videoHeight]:[s.width,s.height],c=l[0],u=l[1],d=[u,c],f=[u,c,o];(a||i)&&(Lh==null&&(Lh=document.createElement("canvas").getContext("2d")),Lh.canvas.width=c,Lh.canvas.height=u,Lh.drawImage(s,0,0,c,u),s=Lh.canvas);var p=t.makeTensorInfo(d,"int32");t.texData.get(p.dataId).usage=Ki.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(p.dataId),s);var x=je().getBool("WEBGL_PACK")?new Ooe(f):new Poe(f),v=t.runWebGLProgram(x,[p],"int32");return t.disposeData(p.dataId),v}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs;m2("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var s=e,o=s.boxes,i=s.scores,a=r,l=a.maxOutputSize,c=a.iouThreshold,u=a.scoreThreshold,d=a.softNmsSigma,f=t,p=r6(f.readSync(o.dataId),f.readSync(i.dataId),l,c,u,d);return[p.selectedIndices,p.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e.x,s=t,o=new Dn(r.shape,"return x * x;");return s.runWebGLProgram(o,[r],r.dtype)}},{kernelName:Dg,backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e,s=r.a,o=r.b,i=t,a=je().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $c("return (a - b) * (a - b);",s.shape,o.shape):new es("return (a - b) * (a - b);",s.shape,o.shape);return i.compileAndRun(a,[s,o])}}];ZC<ST.length;ZC++)B$(ST[ZC]);for(var JC=0,NT=[{kernelName:"Square",gradFunc:function(n,e){var t=e[0];return{x:function(){return n.mul(t.toFloat().mul(2))}}}},{kernelName:Dg,gradFunc:function(n,e){var t=e[0],r=e[1],s=St(2);return{a:function(){return jo(n,jo(s,Vs(t,r)))},b:function(){return jo(n,jo(s,Vs(r,t)))}}}}];JC<NT.length;JC++)$Q(NT[JC]);var Moe=(function(){function n(){}return n.prototype.fetch=function(e,t){return fetch(e,t)},n.prototype.now=function(){return performance.now()},n.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+t);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},n.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},n})();je().get("IS_BROWSER")&&je().setPlatform("browser",new Moe);var QC,Loe=function(){return require("node-fetch")},joe=(function(){function n(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return n.prototype.fetch=function(e,t){return je().global.fetch!=null?je().global.fetch(e,t):(QC==null&&(QC=Loe()),QC(e,t))},n.prototype.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6},n.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},n.prototype.decode=function(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)},n})();je().get("IS_NODE")&&je().setPlatform("node",new joe);var y5={float32:4,int32:4,uint16:2,uint8:1,bool:1},T2=4;function cP(n,e){for(var t={},r=0,s=function(a){var l=a.name,c=a.dtype,u=a.shape,d=Xt(u),f=void 0;if("quantization"in a){var p=a.quantization;if(p.dtype!=="uint8"&&p.dtype!=="uint16")throw new Error("Weight "+a.name+" has unknown quantization dtype "+p.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var x=y5[p.dtype],v=n.slice(r,r+d*x),y=p.dtype==="uint8"?new Uint8Array(v):new Uint16Array(v);if(c==="float32")f=Float32Array.from(y,(function(I){return I*p.scale+p.min}));else{if(c!=="int32")throw new Error("Unsupported dtype in weight '"+l+"': "+c);f=Int32Array.from(y,(function(I){return Math.round(I*p.scale+p.min)}))}r+=d*x}else if(c==="string"){var b=Xt(a.shape);f=[];for(var w=0;w<b;w++){var S=new Uint32Array(n.slice(r,r+T2))[0];r+=T2;var k=new Uint8Array(n.slice(r,r+S));f.push(k),r+=S}}else{var N=y5[c];if(v=n.slice(r,r+d*N),c==="float32")f=new Float32Array(v);else if(c==="int32")f=new Int32Array(v);else{if(c!=="bool")throw new Error("Unsupported dtype in weight '"+l+"': "+c);f=new Uint8Array(v)}r+=d*N}t[l]=ho(f,u,c)},o=0,i=e;o<i.length;o++)s(i[o]);return t}function Boe(n){if(n===null)throw new Error("Invalid input value: "+JSON.stringify(n));var e=0,t=[];n.forEach((function(o){if(e+=o.byteLength,t.push(o.byteLength===o.buffer.byteLength?o:new o.constructor(o)),!(o instanceof Float32Array||o instanceof Int32Array||o instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+o.constructor.name)}));var r=new Uint8Array(e),s=0;return t.forEach((function(o){r.set(new Uint8Array(o.buffer),s),s+=o.byteLength})),r.buffer}var b5=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function ET(n){return b5?Buffer.byteLength(n):new Blob([n]).size}function C6(n){var e=0;n.forEach((function(s){e+=s.byteLength}));var t=new Uint8Array(e),r=0;return n.forEach((function(s){t.set(new Uint8Array(s),r),r+=s.byteLength})),t.buffer}function IT(n){for(n=n.trim();n.endsWith("/");)n=n.slice(0,n.length-1);var e=n.split("/");return e[e.length-1]}function i1(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:ET(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:ET(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:n.weightData.byteLength}}var Xi=(function(){function n(){this.saveRouters=[],this.loadRouters=[]}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerSaveRouter=function(e){n.getInstance().saveRouters.push(e)},n.registerLoadRouter=function(e){n.getInstance().loadRouters.push(e)},n.getSaveHandlers=function(e){return n.getHandlers(e,"save")},n.getLoadHandlers=function(e,t){return n.getHandlers(e,"load",t)},n.getHandlers=function(e,t,r){var s=[];return(t==="load"?n.getInstance().loadRouters:n.getInstance().saveRouters).forEach((function(o){var i=o(e,r);i!==null&&s.push(i)})),s},n})(),lp="://",Yu=(function(){function n(){this.managers={}}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerManager=function(e,t){ee(e!=null,(function(){return"scheme must not be undefined or null."})),e.endsWith(lp)&&(e=e.slice(0,e.indexOf(lp))),ee(e.length>0,(function(){return"scheme must not be an empty string."}));var r=n.getInstance();ee(r.managers[e]==null,(function(){return"A model store manager is already registered for scheme '"+e+"'."})),r.managers[e]=t},n.getManager=function(e){var t=this.getInstance().managers[e];if(t==null)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},n.getSchemes=function(){return Object.keys(this.getInstance().managers)},n})();function Mv(n){if(n.indexOf(lp)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Yu.getSchemes().join(","));return{scheme:n.split(lp)[0],path:n.split(lp)[1]}}function TT(n,e,t){return t===void 0&&(t=!1),Vt(this,void 0,void 0,(function(){var r,s,o,i,a,l,c,u,d;return zt(this,(function(f){switch(f.label){case 0:return ee(n!==e,(function(){return"Old path and new path are the same: '"+n+"'"})),ee((r=Xi.getLoadHandlers(n)).length>0,(function(){return"Copying failed because no load handler is found for source URL "+n+"."})),ee(r.length<2,(function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+n+"."})),s=r[0],ee((o=Xi.getSaveHandlers(e)).length>0,(function(){return"Copying failed because no save handler is found for destination URL "+e+"."})),ee(o.length<2,(function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+e+"."})),i=o[0],a=Mv(n).scheme,l=Mv(n).path,c=a===Mv(n).scheme,[4,s.load()];case 1:return u=f.sent(),t&&c?[4,Yu.getManager(a).removeModel(l)]:[3,3];case 2:f.sent(),f.label=3;case 3:return[4,i.save(u)];case 4:return d=f.sent(),!t||c?[3,6]:[4,Yu.getManager(a).removeModel(l)];case 5:f.sent(),f.label=6;case 6:return[2,d.modelArtifactsInfo]}}))}))}var cf="models_store",Uu="model_info_store";function uP(){if(!je().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var n=window||self,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function w5(n){var e=n.result;e.createObjectStore(cf,{keyPath:"modelPath"}),e.createObjectStore(Uu,{keyPath:"modelPath"})}var cp=(function(){function n(e){if(this.indexedDB=uP(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return n.prototype.save=function(e){return Vt(this,void 0,void 0,(function(){return zt(this,(function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]}))}))},n.prototype.load=function(){return Vt(this,void 0,void 0,(function(){return zt(this,(function(e){return[2,this.databaseAction(this.modelPath)]}))}))},n.prototype.databaseAction=function(e,t){var r=this;return new Promise((function(s,o){var i=r.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return w5(i)},i.onsuccess=function(){var a=i.result;if(t==null){var l=a.transaction(cf,"readonly"),c=l.objectStore(cf).get(r.modelPath);c.onsuccess=function(){if(c.result==null)return a.close(),o(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));s(c.result.modelArtifacts)},c.onerror=function(v){return a.close(),o(c.error)},l.oncomplete=function(){return a.close()}}else{var u,d=i1(t),f=a.transaction(Uu,"readwrite"),p=f.objectStore(Uu),x=p.put({modelPath:r.modelPath,modelArtifactsInfo:d});x.onsuccess=function(){var v=(u=a.transaction(cf,"readwrite")).objectStore(cf).put({modelPath:r.modelPath,modelArtifacts:t,modelArtifactsInfo:d});v.onsuccess=function(){return s({modelArtifactsInfo:d})},v.onerror=function(y){var b=(p=f.objectStore(Uu)).delete(r.modelPath);b.onsuccess=function(){return a.close(),o(v.error)},b.onerror=function(w){return a.close(),o(v.error)}}},x.onerror=function(v){return a.close(),o(x.error)},f.oncomplete=function(){u==null?a.close():u.oncomplete=function(){return a.close()}}}},i.onerror=function(a){return o(i.error)}}))},n.URL_SCHEME="indexeddb://",n})(),_T=function(n){return je().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(cp.URL_SCHEME)?(e=n.slice(cp.URL_SCHEME.length),new cp(e)):null;var e};Xi.registerSaveRouter(_T),Xi.registerLoadRouter(_T);var Voe=(function(){function n(){this.indexedDB=uP()}return n.prototype.listModels=function(){return Vt(this,void 0,void 0,(function(){var e=this;return zt(this,(function(t){return[2,new Promise((function(r,s){var o=e.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return w5(o)},o.onsuccess=function(){var i=o.result,a=i.transaction(Uu,"readonly"),l=a.objectStore(Uu).getAll();l.onsuccess=function(){for(var c={},u=0,d=l.result;u<d.length;u++){var f=d[u];c[f.modelPath]=f.modelArtifactsInfo}r(c)},l.onerror=function(c){return i.close(),s(l.error)},a.oncomplete=function(){return i.close()}},o.onerror=function(i){return s(o.error)}}))]}))}))},n.prototype.removeModel=function(e){return Vt(this,void 0,void 0,(function(){var t=this;return zt(this,(function(r){var s;return e=(s=e).startsWith(cp.URL_SCHEME)?s.slice(cp.URL_SCHEME.length):s,[2,new Promise((function(o,i){var a=t.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return w5(a)},a.onsuccess=function(){var l,c=a.result,u=c.transaction(Uu,"readwrite"),d=u.objectStore(Uu),f=d.get(e);f.onsuccess=function(){if(f.result==null)return c.close(),i(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var p=d.delete(e),x=function(){var v=(l=c.transaction(cf,"readwrite")).objectStore(cf).delete(e);v.onsuccess=function(){return o(f.result.modelArtifactsInfo)},v.onerror=function(y){return i(f.error)}};p.onsuccess=x,p.onerror=function(v){return x(),c.close(),i(f.error)}},f.onerror=function(p){return c.close(),i(f.error)},u.oncomplete=function(){l==null?c.close():l.oncomplete=function(){return c.close()}}},a.onerror=function(l){return i(a.error)}}))]}))}))},n})();if(je().getBool("IS_BROWSER"))try{Yu.registerManager(cp.URL_SCHEME,new Voe)}catch{}var Pc="/",Jh="tensorflowjs_models",dP="info",zoe="model_topology",Woe="weight_specs",Uoe="weight_data",Hoe="model_metadata";function fP(n){return{info:[Jh,n,dP].join(Pc),topology:[Jh,n,zoe].join(Pc),weightSpecs:[Jh,n,Woe].join(Pc),weightData:[Jh,n,Uoe].join(Pc),modelMetadata:[Jh,n,Hoe].join(Pc)}}function Goe(n){var e=n.split(Pc);if(e.length<3)throw new Error("Invalid key format: "+n);return e.slice(1,e.length-1).join(Pc)}var up=(function(){function n(e){if(!je().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=fP(this.modelPath)}return n.prototype.save=function(e){return Vt(this,void 0,void 0,(function(){var t,r,s;return zt(this,(function(o){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),s=i1(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(s)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,(function(i){if(b5)return Buffer.from(i).toString("base64");for(var a=new Uint8Array(i),l="",c=0,u=a.length;c<u;c++)l+=String.fromCharCode(a[c]);return btoa(l)})(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:s}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+s.modelTopologyBytes+", weightSpecsBytes="+s.weightSpecsBytes+", weightDataBytes="+s.weightDataBytes+".")}return[2]}))}))},n.prototype.load=function(){return Vt(this,void 0,void 0,(function(){var e,t,r,s,o,i,a;return zt(this,(function(l){if((e=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},(r=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=r,(s=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=s,(o=this.LS.getItem(this.keys.modelMetadata))!=null&&(i=JSON.parse(o),t.format=i.format,t.generatedBy=i.generatedBy,t.convertedBy=i.convertedBy,t.userDefinedMetadata=i.userDefinedMetadata),(a=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=(function(c){if(b5){var u=Buffer.from(c,"base64");return u.buffer.slice(u.byteOffset,u.byteOffset+u.byteLength)}for(var d=atob(c),f=new Uint8Array(d.length),p=0;p<d.length;++p)f.set([d.charCodeAt(p)],p);return f.buffer})(a),[2,t]}))}))},n.URL_SCHEME="localstorage://",n})(),RT=function(n){return je().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(up.URL_SCHEME)?(e=n.slice(up.URL_SCHEME.length),new up(e)):null;var e};Xi.registerSaveRouter(RT),Xi.registerLoadRouter(RT);var qoe=(function(){function n(){ee(je().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),ee(typeof window>"u"||window.localStorage!==void 0,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return n.prototype.listModels=function(){return Vt(this,void 0,void 0,(function(){var e,t,r,s,o,i;return zt(this,(function(a){for(e={},t=Jh+Pc,r=Pc+dP,s=0;s<this.LS.length;++s)(o=this.LS.key(s)).startsWith(t)&&o.endsWith(r)&&(i=Goe(o),e[i]=JSON.parse(this.LS.getItem(o)));return[2,e]}))}))},n.prototype.removeModel=function(e){return Vt(this,void 0,void 0,(function(){var t,r;return zt(this,(function(s){var o;if(e=(o=e).startsWith(up.URL_SCHEME)?o.slice(up.URL_SCHEME.length):o,t=fP(e),this.LS.getItem(t.info)==null)throw new Error("Cannot find model at path '"+e+"'");return r=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,r]}))}))},n})();if(je().getBool("IS_BROWSER"))try{Yu.registerManager(up.URL_SCHEME,new qoe)}catch{}var Koe="model",Xoe=".json",Yoe=".weights.bin";function DT(n){return new Promise((function(e){return setTimeout(e)})).then(n)}var e4=(function(){function n(e){if(!je().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(n.URL_SCHEME)&&(e=e.slice(n.URL_SCHEME.length)),e!=null&&e.length!==0||(e=Koe),this.modelTopologyFileName=e+Xoe,this.weightDataFileName=e+Yoe}return n.prototype.save=function(e){return Vt(this,void 0,void 0,(function(){var t,r,s,o,i,a;return zt(this,(function(l){switch(l.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],s={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:r},o=window.URL.createObjectURL(new Blob([JSON.stringify(s)],{type:"application/json"})),(i=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,i.href=o,[4,DT((function(){return i.dispatchEvent(new MouseEvent("click"))}))];case 2:return l.sent(),e.weightData==null?[3,4]:((a=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,a.href=t,[4,DT((function(){return a.dispatchEvent(new MouseEvent("click"))}))]);case 3:l.sent(),l.label=4;case 4:return[2,{modelArtifactsInfo:i1(e)}]}}))}))},n.URL_SCHEME="downloads://",n})(),Zoe=(function(){function n(e){if(e==null||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return n.prototype.load=function(){return Vt(this,void 0,void 0,(function(){var e,t,r=this;return zt(this,(function(s){return e=this.files[0],t=this.files.slice(1),[2,new Promise((function(o,i){var a=new FileReader;a.onload=function(l){var c=JSON.parse(l.target.result),u=c.modelTopology;if(u!=null){t.length===0&&o({modelTopology:u});var d=c.weightsManifest;if(d!=null){var f;try{f=r.checkManifestAndWeightFiles(d,t)}catch(y){return void i(y)}var p=[],x=[],v=[];d.forEach((function(y){y.paths.forEach((function(b){x.push(b),v.push(null)})),p.push.apply(p,y.weights)})),d.forEach((function(y){y.paths.forEach((function(b){var w=new FileReader;w.onload=function(S){var k=S.target.result,N=x.indexOf(b);v[N]=k,v.indexOf(null)===-1&&o({modelTopology:u,weightSpecs:p,weightData:C6(v),format:c.format,generatedBy:c.generatedBy,convertedBy:c.convertedBy,userDefinedMetadata:c.userDefinedMetadata})},w.onerror=function(S){return i("Failed to weights data from file of path '"+b+"'.")},w.readAsArrayBuffer(f[b])}))}))}else i(new Error("weightManifest field is missing from file "+e.name))}else i(new Error("modelTopology field is missing from file "+e.name))},a.onerror=function(l){return i("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},a.readAsText(e)}))]}))}))},n.prototype.checkManifestAndWeightFiles=function(e,t){for(var r=[],s=t.map((function(l){return IT(l.name)})),o={},i=0,a=e;i<a.length;i++)a[i].paths.forEach((function(l){var c=IT(l);if(r.indexOf(c)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+c+"'");if(r.push(c),s.indexOf(c)===-1)throw new Error("Weight file with basename '"+c+"' is not provided.");o[l]=t[s.indexOf(c)]}));if(r.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+t.length+").");return o},n})();function AT(n,e,t,r){(function(o){ee(o!=null&&Array.isArray(o)&&o.length>0,(function(){return"promises must be a none empty array"}))})(n),(function(o,i){ee(o>=0&&o<=1,(function(){return"Progress fraction must be in range [0, 1], but got startFraction "+o})),ee(i>=0&&i<=1,(function(){return"Progress fraction must be in range [0, 1], but got endFraction "+i})),ee(i>=o,(function(){return"startFraction must be no more than endFraction, but got startFraction "+o+" and endFraction "+i}))})(t=t??0,r=r??1);var s=0;return Promise.all(n.map((function(o){return o.then((function(i){var a=t+ ++s/n.length*(r-t);return e(a),i})),o})))}function hP(n,e){return Vt(this,void 0,void 0,(function(){var t,r,s,o,i,a,l,c,u;return zt(this,(function(d){switch(d.label){case 0:return e==null&&(e={}),t=e.fetchFunc==null?je().platform.fetch:e.fetchFunc,r=n.map((function(f){return t(f,e.requestInit,{isBinary:!0})})),s=0,o=.5,e.onProgress!=null?[3,2]:[4,Promise.all(r)];case 1:return i=d.sent(),[3,4];case 2:return[4,AT(r,e.onProgress,s,o)];case 3:i=d.sent(),d.label=4;case 4:return a=i.map((function(f){return f.arrayBuffer()})),l=.5,c=1,e.onProgress!=null?[3,6]:[4,Promise.all(a)];case 5:return u=d.sent(),[3,8];case 6:return[4,AT(a,e.onProgress,l,c)];case 7:u=d.sent(),d.label=8;case 8:return[2,u]}}))}))}function $T(n){var e=this;return function(t,r,s){return r===void 0&&(r=""),Vt(e,void 0,void 0,(function(){var o,i,a,l,c,u,d,f,p,x;return zt(this,(function(v){switch(v.label){case 0:if(o=t.map((function(){return!1})),i={},a=s!=null?s.map((function(){return!1})):[],l=[],t.forEach((function(y,b){var w=0;y.weights.forEach((function(S){var k="quantization"in S?S.quantization.dtype:S.dtype,N=y5[k]*Xt(S.shape),I=function(){o[b]=!0,i[b]==null&&(i[b]=[]),i[b].push({manifestEntry:S,groupOffset:w,sizeBytes:N})};s!=null?s.forEach((function(T,F){T===S.name&&(I(),a[F]=!0)})):I(),l.push(S.name),w+=N}))})),!a.every((function(y){return y})))throw c=s.filter((function(y,b){return!a[b]})),new Error("Could not find weights in manifest with names: "+c.join(", ")+`. 
Manifest JSON has weights with names: `+l.join(", ")+".");return u=o.reduce((function(y,b,w){return b&&y.push(w),y}),[]),d=[],u.forEach((function(y){t[y].paths.forEach((function(b){var w=r+(r.endsWith("/")?"":"/")+b;d.push(w)}))})),[4,n(d)];case 1:return f=v.sent(),p={},x=0,u.forEach((function(y){for(var b=t[y].paths.length,w=0,S=0;S<b;S++)w+=f[x+S].byteLength;for(var k=new ArrayBuffer(w),N=new Uint8Array(k),I=0,T=0;T<b;T++){var F=new Uint8Array(f[x+T]);N.set(F,I),I+=F.byteLength}i[y].forEach((function(R){var D=cP(k.slice(R.groupOffset,R.groupOffset+R.sizeBytes),[R.manifestEntry]);for(var A in D)p[A]=D[A]})),x+=b})),[2,p]}}))}))}}Xi.registerSaveRouter((function(n){return je().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(e4.URL_SCHEME)?(function(e){return e===void 0&&(e="model"),new e4(e)})(n.slice(e4.URL_SCHEME.length)):null}));var pP=(function(){function n(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,t.fetchFunc!=null?(ee(typeof t.fetchFunc=="function",(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=t.fetchFunc):this.fetch=je().platform.fetch,ee(e!=null&&e.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(e)&&ee(e.length===2,(function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."})),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return n.prototype.save=function(e){return Vt(this,void 0,void 0,(function(){var t,r,s,o;return zt(this,(function(i){switch(i.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],s={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:r},t.body.append("model.json",new Blob([JSON.stringify(s)],{type:"application/json"}),"model.json"),e.weightData!=null&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((o=i.sent()).ok)return[2,{modelArtifactsInfo:i1(e),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+o.status+".")}}))}))},n.prototype.load=function(){return Vt(this,void 0,void 0,(function(){var e,t,r,s,o,i,a,l,c,u,d,f;return zt(this,(function(p){switch(p.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=p.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");p.label=2;case 2:return p.trys.push([2,4,,5]),[4,e.json()];case 3:return t=p.sent(),[3,5];case 4:throw p.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(s=t.modelTopology,o=t.weightsManifest,i=t.generatedBy,a=t.convertedBy,l=t.format,c=t.userDefinedMetadata,s==null&&o==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return o==null?[3,7]:[4,this.loadWeights(o)];case 6:f=p.sent(),u=f[0],d=f[1],p.label=7;case 7:return[2,{modelTopology:s,weightSpecs:u,weightData:d,userDefinedMetadata:c,generatedBy:i,convertedBy:a,format:l}]}}))}))},n.prototype.loadWeights=function(e){return Vt(this,void 0,void 0,(function(){var t,r,s,o,i,a,l,c,u,d,f;return zt(this,(function(p){switch(p.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,r=(function(x){var v=x.lastIndexOf("/"),y=x.lastIndexOf("?"),b=x.substring(0,v),w=y>v?x.substring(y):"";return[b+"/",w]})(t),s=r[0],o=r[1],i=this.weightPathPrefix||s,a=[],l=0,c=e;l<c.length;l++)u=c[l],a.push.apply(a,u.weights);return d=[],e.forEach((function(x){x.paths.forEach((function(v){d.push(i+v+o)}))})),[4,hP(d,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return f=p.sent(),[2,[a,C6(f)]]}}))}))},n.URL_SCHEME_REGEX=/^https?:\/\//,n})();function C5(n){return n.match(pP.URL_SCHEME_REGEX)!=null}var FT=function(n,e){return typeof fetch>"u"?null:(Array.isArray(n)?n.every((function(t){return C5(t)})):C5(n))?k5(n,{onProgress:e}):null};function k5(n,e){return new pP(n,e)}Xi.registerSaveRouter(FT),Xi.registerLoadRouter(FT);var t4=(function(){function n(e){this.modelArtifacts=e}return n.prototype.load=function(){return Vt(this,void 0,void 0,(function(){return zt(this,(function(e){return[2,this.modelArtifacts]}))}))},n})(),Joe=(function(){function n(e){this.saveHandler=e}return n.prototype.save=function(e){return Vt(this,void 0,void 0,(function(){return zt(this,(function(t){return[2,this.saveHandler(e)]}))}))},n})(),mP=Object.freeze({browserFiles:function(n){return new Zoe(n)},browserHTTPRequest:function(n,e){return k5(n,e)},concatenateArrayBuffers:C6,decodeWeights:cP,encodeWeights:function(n,e){return Vt(this,void 0,void 0,(function(){var t,r,s,o,i,a=this;return zt(this,(function(l){switch(l.label){case 0:for(t=[],r=[],s=Array.isArray(n)?n.map((function(c){return c.name})):Object.keys(n),o=function(c){var u=s[c],d=Array.isArray(n)?n[c].tensor:n[u];if(d.dtype!=="float32"&&d.dtype!=="int32"&&d.dtype!=="bool"&&d.dtype!=="string")throw new Error("Unsupported dtype in weight '"+u+"': "+d.dtype);var f={name:u,shape:d.shape,dtype:d.dtype};if(d.dtype==="string"){var p=new Promise((function(x){return Vt(a,void 0,void 0,(function(){var v,y,b,w,S,k,N;return zt(this,(function(I){switch(I.label){case 0:return[4,d.bytes()];case 1:for(v=I.sent(),y=v.reduce((function(T,F){return T+F.length}),0)+T2*v.length,b=new Uint8Array(y),w=0,S=0;S<v.length;S++)k=v[S],N=new Uint8Array(new Uint32Array([k.length]).buffer),b.set(N,w),w+=T2,b.set(k,w),w+=k.length;return x(b),[2]}}))}))}));r.push(p)}else r.push(d.data());e!=null&&(f.group=e),t.push(f)},i=0;i<s.length;++i)o(i);return[4,Promise.all(r)];case 1:return[2,{data:Boe(l.sent()),specs:t}]}}))}))},fromMemory:function(n,e,t,r){return arguments.length===1?n.modelTopology!=null||n.weightSpecs!=null?new t4(n):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new t4({modelTopology:n})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new t4({modelTopology:n,weightSpecs:e,weightData:t,trainingConfig:r}))},getLoadHandlers:function(n,e){return Xi.getLoadHandlers(n,e)},getModelArtifactsInfoForJSON:i1,getSaveHandlers:function(n){return Xi.getSaveHandlers(n)},http:k5,isHTTPScheme:C5,loadWeights:function(n,e,t,r){return e===void 0&&(e=""),Vt(this,void 0,void 0,(function(){return zt(this,(function(s){return[2,$T((function(o){return hP(o,{requestInit:r})}))(n,e,t)]}))}))},registerLoadRouter:function(n){return Xi.registerLoadRouter(n)},registerSaveRouter:function(n){return Xi.registerSaveRouter(n)},weightsLoaderFactory:$T,withSaveHandler:function(n){return new Joe(n)},copyModel:function(n,e){return Vt(this,void 0,void 0,(function(){return zt(this,(function(t){return[2,TT(n,e,!1)]}))}))},listModels:function(){return Vt(this,void 0,void 0,(function(){var n,e,t,r,s,o,i;return zt(this,(function(a){switch(a.label){case 0:n=Yu.getSchemes(),e={},t=0,r=n,a.label=1;case 1:return t<r.length?(s=r[t],[4,Yu.getManager(s).listModels()]):[3,4];case 2:for(i in o=a.sent())e[s+lp+i]=o[i];a.label=3;case 3:return t++,[3,1];case 4:return[2,e]}}))}))},moveModel:function(n,e){return Vt(this,void 0,void 0,(function(){return zt(this,(function(t){return[2,TT(n,e,!0)]}))}))},removeModel:function(n){return Vt(this,void 0,void 0,(function(){var e;return zt(this,(function(t){return e=Mv(n),[2,Yu.getManager(e.scheme).removeModel(e.path)]}))}))}}),jh;ie({confusionMatrix_:function(n,e,t){var r=Y(n,"labels","confusionMatrix"),s=Y(e,"predictions","confusionMatrix");ee(t==null||t>0&&Number.isInteger(t),(function(){return"If provided, numClasses must be a positive integer, but got "+t})),ee(r.rank===1,(function(){return"Expected the rank of labels to be 1, but got "+r.rank})),ee(s.rank===1,(function(){return"Expected the rank of predictions to be 1, but got "+s.rank})),ee(r.shape[0]===s.shape[0],(function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+s.shape[0]+". Labels and predictions should have the same number of elements."})),ee(t>0&&Number.isInteger(t),(function(){return"numClasses is required to be a positive integer, but got "+t}));var o=p5(r.asType("int32"),t),i=p5(s.asType("int32"),t);return o.transpose().matMul(i).asType("int32")}});var Qoe=ie({fromPixels_:function(n,e){if(e===void 0&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(n==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var t=!1,r=!1,s=!1,o=!1,i=!1;if(n.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&n instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)s=!0;else if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)o=!0;else{if(n.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+n.constructor.name);i=!0}if(s&&s&&n.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(j$("FromPixels",ge.backendName)!=null)return ge.runKernel("FromPixels",{pixels:n},{numChannels:e});var a,l,c=s?[n.videoWidth,n.videoHeight]:[n.width,n.height],u=c[0],d=c[1];if(i?a=n.getContext("2d").getImageData(0,0,u,d).data:r||t?a=n.data:(o||s)&&(jh==null&&(jh=document.createElement("canvas").getContext("2d")),jh.canvas.width=u,jh.canvas.height=d,jh.drawImage(n,0,0,u,d),a=jh.getImageData(0,0,u,d).data),e===4)l=new Int32Array(a);else{var f=u*d;l=new Int32Array(f*e);for(var p=0;p<f;p++)for(var x=0;x<e;++x)l[p*e+x]=a[4*p+x]}return Zk(l,[d,u,e],"int32")}}),k6=Object.freeze({toPixels:function(n,e){return Vt(this,void 0,void 0,(function(){var t,r,s,o,i,a,l,c,u,d,f,p,x,v,y,b,w,S,k,N,I,T,F;return zt(this,(function(R){switch(R.label){case 0:if(t=Y(n,"img","toPixels"),n instanceof Kr||(t=t.toInt()),t.rank!==2&&t.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+t.rank+".");if(r=t.shape.slice(0,2),s=r[0],o=r[1],(i=t.rank===2?1:t.shape[2])>4||i===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+i);return[4,t.data()];case 1:return a=R.sent(),l=t.min(),c=t.max(),[4,Promise.all([l.data(),c.data()])];case 2:if(u=R.sent(),d=u[0],f=u[1],p=d[0],x=f[0],l.dispose(),c.dispose(),t.dtype==="float32"){if(p<0||x>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+p+" - "+x+"].")}else{if(t.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+t.dtype+". Please use float32 or int32 tensors.");if(p<0||x>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+p+" - "+x+"].")}for(v=t.dtype==="float32"?255:1,y=new Uint8ClampedArray(o*s*4),b=0;b<s*o;++b)w=void 0,S=void 0,k=void 0,N=void 0,i===1?(w=a[b]*v,S=a[b]*v,k=a[b]*v,N=255):i===3?(w=a[3*b]*v,S=a[3*b+1]*v,k=a[3*b+2]*v,N=255):i===4&&(w=a[4*b]*v,S=a[4*b+1]*v,k=a[4*b+2]*v,N=a[4*b+3]*v),y[(I=4*b)+0]=Math.round(w),y[I+1]=Math.round(S),y[I+2]=Math.round(k),y[I+3]=Math.round(N);return e!=null&&(e.width=o,e.height=s,T=e.getContext("2d"),F=new ImageData(y,o,s),T.putImageData(F,0,0)),t!==n&&t.dispose(),[2,y]}}))}))},fromPixels:Qoe}),eie=(function(){function n(){}return n.prototype.getClassName=function(){return this.constructor.className},n.fromConfig=function(e,t){return new e(t)},n})(),tie=(function(){function n(){this.classNameMap={}}return n.getMap=function(){return n.instance==null&&(n.instance=new n),n.instance},n.register=function(e){n.getMap().classNameMap[e.className]=[e,e.fromConfig]},n})();function Hf(n){ee(n.className!=null,(function(){return"Class being registered does not have the static className property defined."})),ee(typeof n.className=="string",(function(){return"className is required to be a string, but got type "+typeof n.className})),ee(n.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),tie.register(n)}var Gf=(function(n){function e(){return n!==null&&n.apply(this,arguments)||this}return ml(e,n),e.prototype.minimize=function(t,r,s){r===void 0&&(r=!1);var o=this.computeGradients(t,s),i=o.value,a=o.grads;if(s!=null){var l=s.map((function(c){return{name:c.name,tensor:a[c.name]}}));this.applyGradients(l)}else this.applyGradients(a);return ki(a),r?i:(i.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,r){return dte(t,r)},e.prototype.dispose=function(){this.iterations_!=null&&ki(this.iterations_)},e.prototype.saveIterations=function(){return Vt(this,void 0,void 0,(function(){return zt(this,(function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:St(this.iterations_,"int32")}]}))}))},e.prototype.getWeights=function(){return Vt(this,void 0,void 0,(function(){return zt(this,(function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")}))}))},e.prototype.setWeights=function(t){return Vt(this,void 0,void 0,(function(){return zt(this,(function(r){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())}))}))},e.prototype.extractIterations=function(t){return Vt(this,void 0,void 0,(function(){var r;return zt(this,(function(s){switch(s.label){case 0:return r=this,[4,t[0].tensor.data()];case 1:return r.iterations_=s.sent()[0],[2,t.slice(1)]}}))}))},e})(eie);Object.defineProperty(Gf,Symbol.hasInstance,{value:function(n){return n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null}});var nie=(function(n){function e(t,r,s){s===void 0&&(s=null);var o=n.call(this)||this;return o.learningRate=t,o.rho=r,o.epsilon=s,o.accumulatedGrads=[],o.accumulatedUpdates=[],s==null&&(o.epsilon=ge.backend.epsilon()),o}return ml(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map((function(s){return s.name})):Object.keys(t)).forEach((function(s,o){var i=ge.registeredVariables[s];r.accumulatedGrads[o]==null&&(r.accumulatedGrads[o]={originalName:s+"/accum_grad",variable:$t((function(){return Yn(i).variable(!1)}))}),r.accumulatedUpdates[o]==null&&(r.accumulatedUpdates[o]={originalName:s+"/accum_var",variable:$t((function(){return Yn(i).variable(!1)}))});var a=Array.isArray(t)?t[o].tensor:t[s];if(a!=null){var l=r.accumulatedGrads[o].variable,c=r.accumulatedUpdates[o].variable;$t((function(){var u=l.mul(r.rho).add(a.square().mul(1-r.rho)),d=c.add(r.epsilon).sqrt().div(l.add(r.epsilon).sqrt()).mul(a),f=c.mul(r.rho).add(d.square().mul(1-r.rho));l.assign(u),c.assign(f);var p=d.mul(-r.learningRate).add(i);i.assign(p)}))}})),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(ki(this.accumulatedGrads.map((function(t){return t.variable}))),ki(this.accumulatedUpdates.map((function(t){return t.variable}))))},e.prototype.getWeights=function(){return Vt(this,void 0,void 0,(function(){var t;return zt(this,(function(r){switch(r.label){case 0:return t=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map((function(s){return{name:s.originalName,tensor:s.variable}})))]}}))}))},e.prototype.setWeights=function(t){return Vt(this,void 0,void 0,(function(){var r;return zt(this,(function(s){switch(s.label){case 0:return[4,this.extractIterations(t)];case 1:return t=s.sent(),r=t.length/2,this.accumulatedGrads=t.slice(0,r).map((function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),this.accumulatedUpdates=t.slice(r,2*r).map((function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.rho,r.epsilon)},e.className="Adadelta",e})(Gf);Hf(nie);var rie=(function(n){function e(t,r){r===void 0&&(r=.1);var s=n.call(this)||this;return s.learningRate=t,s.initialAccumulatorValue=r,s.accumulatedGrads=[],s}return ml(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map((function(s){return s.name})):Object.keys(t)).forEach((function(s,o){var i=ge.registeredVariables[s];r.accumulatedGrads[o]==null&&(r.accumulatedGrads[o]={originalName:s+"/accumulator",variable:$t((function(){return Jl(i.shape,r.initialAccumulatorValue).variable(!1)}))});var a=Array.isArray(t)?t[o].tensor:t[s];if(a!=null){var l=r.accumulatedGrads[o].variable;$t((function(){var c=l.add(a.square());l.assign(c);var u=a.div(c.add(ge.backend.epsilon()).sqrt()).mul(-r.learningRate).add(i);i.assign(u)}))}})),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&ki(this.accumulatedGrads.map((function(t){return t.variable})))},e.prototype.getWeights=function(){return Vt(this,void 0,void 0,(function(){return zt(this,(function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map((function(r){return{name:r.originalName,tensor:r.variable}})))]}}))}))},e.prototype.setWeights=function(t){return Vt(this,void 0,void 0,(function(){return zt(this,(function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),this.accumulatedGrads=t.map((function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}})),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,r){return new t(r.learningRate,r.initialAccumulatorValue)},e.className="Adagrad",e})(Gf);Hf(rie);var sie=(function(n){function e(t,r,s,o){o===void 0&&(o=null);var i=n.call(this)||this;return i.learningRate=t,i.beta1=r,i.beta2=s,i.epsilon=o,i.accumulatedFirstMoment=[],i.accumulatedSecondMoment=[],$t((function(){i.accBeta1=St(r).variable(),i.accBeta2=St(s).variable()})),o==null&&(i.epsilon=ge.backend.epsilon()),i}return ml(e,n),e.prototype.applyGradients=function(t){var r=this,s=Array.isArray(t)?t.map((function(o){return o.name})):Object.keys(t);$t((function(){var o=Vs(1,r.accBeta1),i=Vs(1,r.accBeta2);s.forEach((function(a,l){var c=ge.registeredVariables[a];r.accumulatedFirstMoment[l]==null&&(r.accumulatedFirstMoment[l]={originalName:a+"/m",variable:$t((function(){return Yn(c).variable(!1)}))}),r.accumulatedSecondMoment[l]==null&&(r.accumulatedSecondMoment[l]={originalName:a+"/v",variable:$t((function(){return Yn(c).variable(!1)}))});var u=Array.isArray(t)?t[l].tensor:t[a];if(u!=null){var d=r.accumulatedFirstMoment[l].variable,f=r.accumulatedSecondMoment[l].variable,p=d.mul(r.beta1).add(u.mul(1-r.beta1)),x=f.mul(r.beta2).add(u.square().mul(1-r.beta2)),v=p.div(o),y=x.div(i);d.assign(p),f.assign(x);var b=v.div(y.sqrt().add(r.epsilon)).mul(-r.learningRate).add(c);c.assign(b)}})),r.accBeta1.assign(r.accBeta1.mul(r.beta1)),r.accBeta2.assign(r.accBeta2.mul(r.beta2))})),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&ki(this.accumulatedFirstMoment.map((function(t){return t.variable}))),this.accumulatedSecondMoment!=null&&ki(this.accumulatedSecondMoment.map((function(t){return t.variable})))},e.prototype.getWeights=function(){return Vt(this,void 0,void 0,(function(){var t;return zt(this,(function(r){switch(r.label){case 0:return t=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map((function(s){return{name:s.originalName,tensor:s.variable}})))]}}))}))},e.prototype.setWeights=function(t){return Vt(this,void 0,void 0,(function(){var r,s=this;return zt(this,(function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),$t((function(){s.accBeta1.assign(E2(s.beta1,s.iterations_+1)),s.accBeta2.assign(E2(s.beta2,s.iterations_+1))})),r=t.length/2,this.accumulatedFirstMoment=t.slice(0,r).map((function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}})),this.accumulatedSecondMoment=t.slice(r,2*r).map((function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}})),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon)},e.className="Adam",e})(Gf);Hf(sie);var oie=(function(n){function e(t,r,s,o,i){o===void 0&&(o=null),i===void 0&&(i=0);var a=n.call(this)||this;return a.learningRate=t,a.beta1=r,a.beta2=s,a.epsilon=o,a.decay=i,a.accumulatedFirstMoment=[],a.accumulatedWeightedInfNorm=[],$t((function(){a.iteration=St(0).variable(),a.accBeta1=St(r).variable()})),o==null&&(a.epsilon=ge.backend.epsilon()),a}return ml(e,n),e.prototype.applyGradients=function(t){var r=this,s=Array.isArray(t)?t.map((function(o){return o.name})):Object.keys(t);$t((function(){var o=Vs(1,r.accBeta1),i=Ya(-r.learningRate,r.iteration.mul(r.decay).add(1));s.forEach((function(a,l){var c=ge.registeredVariables[a];r.accumulatedFirstMoment[l]==null&&(r.accumulatedFirstMoment[l]={originalName:a+"/m",variable:Yn(c).variable(!1)}),r.accumulatedWeightedInfNorm[l]==null&&(r.accumulatedWeightedInfNorm[l]={originalName:a+"/v",variable:Yn(c).variable(!1)});var u=Array.isArray(t)?t[l].tensor:t[a];if(u!=null){var d=r.accumulatedFirstMoment[l].variable,f=r.accumulatedWeightedInfNorm[l].variable,p=d.mul(r.beta1).add(u.mul(1-r.beta1)),x=f.mul(r.beta2),v=u.abs(),y=x.maximum(v);d.assign(p),f.assign(y);var b=i.div(o).mul(p.div(y.add(r.epsilon))).add(c);c.assign(b)}})),r.iteration.assign(r.iteration.add(1)),r.accBeta1.assign(r.accBeta1.mul(r.beta1))})),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&ki(this.accumulatedFirstMoment.map((function(t){return t.variable}))),this.accumulatedWeightedInfNorm!=null&&ki(this.accumulatedWeightedInfNorm.map((function(t){return t.variable})))},e.prototype.getWeights=function(){return Vt(this,void 0,void 0,(function(){return zt(this,(function(t){throw new Error("getWeights() is not implemented for Adamax yet.")}))}))},e.prototype.setWeights=function(t){return Vt(this,void 0,void 0,(function(){return zt(this,(function(r){throw new Error("setWeights() is not implemented for Adamax yet.")}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},e.className="Adamax",e})(Gf);Hf(oie);var gP=(function(n){function e(t){var r=n.call(this)||this;return r.learningRate=t,r.setLearningRate(t),r}return ml(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map((function(s){return s.name})):Object.keys(t)).forEach((function(s,o){var i=Array.isArray(t)?t[o].tensor:t[s];if(i!=null){var a=ge.registeredVariables[s];$t((function(){var l=r.c.mul(i).add(a);a.assign(l)}))}})),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=Nee(St(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return Vt(this,void 0,void 0,(function(){return zt(this,(function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}}))}))},e.prototype.setWeights=function(t){return Vt(this,void 0,void 0,(function(){return zt(this,(function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:if((t=r.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,r){return new t(r.learningRate)},e.className="SGD",e})(Gf);Hf(gP);var iie=(function(n){function e(t,r,s){s===void 0&&(s=!1);var o=n.call(this,t)||this;return o.learningRate=t,o.momentum=r,o.useNesterov=s,o.accumulations=[],o.m=St(o.momentum),o}return ml(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map((function(s){return s.name})):Object.keys(t)).forEach((function(s,o){var i=ge.registeredVariables[s];r.accumulations[o]==null&&(r.accumulations[o]={originalName:s+"/momentum",variable:$t((function(){return Yn(i).variable(!1)}))});var a=r.accumulations[o].variable,l=Array.isArray(t)?t[o].tensor:t[s];l!=null&&$t((function(){var c,u=r.m.mul(a).add(l);c=r.useNesterov?r.c.mul(l.add(u.mul(r.m))).add(i):r.c.mul(u).add(i),a.assign(u),i.assign(c)}))})),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&ki(this.accumulations.map((function(t){return t.variable})))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return Vt(this,void 0,void 0,(function(){return zt(this,(function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map((function(r){return{name:r.originalName,tensor:r.variable}})))]}}))}))},e.prototype.setWeights=function(t){return Vt(this,void 0,void 0,(function(){return zt(this,(function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),this.accumulations=t.map((function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}})),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,r){return new t(r.learningRate,r.momentum,r.useNesterov)},e.className="Momentum",e})(gP);Hf(iie);var aie=(function(n){function e(t,r,s,o,i){r===void 0&&(r=.9),s===void 0&&(s=0),o===void 0&&(o=null),i===void 0&&(i=!1);var a=n.call(this)||this;if(a.learningRate=t,a.decay=r,a.momentum=s,a.epsilon=o,a.accumulatedMeanSquares=[],a.accumulatedMoments=[],a.accumulatedMeanGrads=[],a.centered=i,o==null&&(a.epsilon=ge.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return a}return ml(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map((function(s){return s.name})):Object.keys(t)).forEach((function(s,o){var i=ge.registeredVariables[s];r.accumulatedMeanSquares[o]==null&&(r.accumulatedMeanSquares[o]={originalName:s+"/rms",variable:$t((function(){return Yn(i).variable(!1)}))}),r.accumulatedMoments[o]==null&&(r.accumulatedMoments[o]={originalName:s+"/momentum",variable:$t((function(){return Yn(i).variable(!1)}))}),r.accumulatedMeanGrads[o]==null&&r.centered&&(r.accumulatedMeanGrads[o]={originalName:s+"/mg",variable:$t((function(){return Yn(i).variable(!1)}))});var a=Array.isArray(t)?t[o].tensor:t[s];if(a!=null){var l=r.accumulatedMeanSquares[o].variable,c=r.accumulatedMoments[o].variable;$t((function(){var u=l.mul(r.decay).add(a.square().mul(1-r.decay));if(r.centered){var d=r.accumulatedMeanGrads[o].variable,f=d.mul(r.decay).add(a.mul(1-r.decay)),p=c.mul(r.momentum).add(a.mul(r.learningRate).div(u.sub(f.square().add(r.epsilon)).sqrt()));l.assign(u),d.assign(f),c.assign(p);var x=i.sub(p);i.assign(x)}else{var v=l.mul(r.decay).add(a.square().mul(1-r.decay));p=c.mul(r.momentum).add(a.mul(r.learningRate).div(v.add(r.epsilon).sqrt())),l.assign(v),c.assign(p),x=i.sub(p),i.assign(x)}}))}})),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&ki(this.accumulatedMeanSquares.map((function(t){return t.variable}))),this.accumulatedMeanGrads!=null&&this.centered&&ki(this.accumulatedMeanGrads.map((function(t){return t.variable}))),this.accumulatedMoments!=null&&ki(this.accumulatedMoments.map((function(t){return t.variable})))},e.prototype.getWeights=function(){return Vt(this,void 0,void 0,(function(){var t;return zt(this,(function(r){switch(r.label){case 0:return t=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&t.push.apply(t,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map((function(s){return{name:s.originalName,tensor:s.variable}})))]}}))}))},e.prototype.setWeights=function(t){return Vt(this,void 0,void 0,(function(){var r;return zt(this,(function(s){switch(s.label){case 0:return[4,this.extractIterations(t)];case 1:return t=s.sent(),r=this.centered?t.length/3:t.length/2,this.accumulatedMeanSquares=t.slice(0,r).map((function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),this.accumulatedMoments=t.slice(r,2*r).map((function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),this.centered&&(this.accumulatedMeanGrads=t.slice(2*r,3*r).map((function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}))),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,r){return new t(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},e.className="RMSProp",e})(Gf);Hf(aie);Kr.prototype.squaredDifference=function(n){return DF(this,n)},Oe=$oe;var S5=function(n,e){return S5=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var s in r)r.hasOwnProperty(s)&&(t[s]=r[s])},S5(n,e)};function yn(n,e){S5(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Fo=function(){return Fo=Object.assign||function(e){for(var t,r=1,s=arguments.length;r<s;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},Fo.apply(this,arguments)};function en(n,e,t,r){function s(o){return o instanceof t?o:new t(function(i){i(o)})}return new(t||(t=Promise))(function(o,i){function a(u){try{c(r.next(u))}catch(d){i(d)}}function l(u){try{c(r.throw(u))}catch(d){i(d)}}function c(u){u.done?o(u.value):s(u.value).then(a,l)}c((r=r.apply(n,[])).next())})}function tn(n,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,s,o,i;return i={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function a(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,s&&(o=c[0]&2?s.return:c[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,c[1])).done)return o;switch(s=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,s=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){t.label=c[1];break}if(c[0]===6&&t.label<o[1]){t.label=o[1],o=c;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(c);break}o[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(u){c=[6,u],s=0}finally{r=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function hg(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;for(var r=Array(n),s=0,e=0;e<t;e++)for(var o=arguments[e],i=0,a=o.length;i<a;i++,s++)r[s]=o[i];return r}var dp=(function(){function n(e,t){if(!mf(e)||!mf(t))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:e,height:t}));this._width=e,this._height=t}return Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),n.prototype.reverse=function(){return new n(1/this.width,1/this.height)},n})();function My(n,e){return n instanceof Kr&&n.shape.length===e}function lie(n){return My(n,2)}function Ly(n){return My(n,3)}function Zu(n){return My(n,4)}function cie(n){return n%1!==0}function PT(n){return n%2===0}function uie(n,e){e===void 0&&(e=2);var t=Math.pow(10,e);return Math.floor(n*t)/t}function OT(n){return n&&n.width&&n.height}function die(n,e){var t=n.width,r=n.height,s=e/Math.max(r,t);return new dp(Math.round(t*s),Math.round(r*s))}function S6(n){return n.reduce(function(e,t){return e.add(t)},new dr(0,0)).div(new dr(n.length,n.length))}function Ag(n,e,t){return Array(n).fill(0).map(function(r,s){return e+s*t})}function mf(n){return!!n&&n!==1/0&&n!==-1/0&&!isNaN(n)||n===0}function MT(n){return mf(n)&&0<=n&&n<=1}var dr=(function(){function n(e,t){this._x=e,this._y=t}return Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),n.prototype.add=function(e){return new n(this.x+e.x,this.y+e.y)},n.prototype.sub=function(e){return new n(this.x-e.x,this.y-e.y)},n.prototype.mul=function(e){return new n(this.x*e.x,this.y*e.y)},n.prototype.div=function(e){return new n(this.x/e.x,this.y/e.y)},n.prototype.abs=function(){return new n(Math.abs(this.x),Math.abs(this.y))},n.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},n.prototype.floor=function(){return new n(Math.floor(this.x),Math.floor(this.y))},n})(),ad=(function(){function n(e,t){t===void 0&&(t=!0);var r=e||{},s=[r.left,r.top,r.right,r.bottom].every(mf),o=[r.x,r.y,r.width,r.height].every(mf);if(!o&&!s)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var i=o?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],a=i[0],l=i[1],c=i[2],u=i[3];n.assertIsValidBox({x:a,y:l,width:c,height:u},"Box.constructor",t),this._x=a,this._y=l,this._width=c,this._height=u}return n.isRect=function(e){return!!e&&[e.x,e.y,e.width,e.height].every(mf)},n.assertIsValidBox=function(e,t,r){if(r===void 0&&(r=!1),!n.isRect(e))throw new Error(t+" - invalid box: "+JSON.stringify(e)+", expected object with properties x, y, width, height");if(!r&&(e.width<0||e.height<0))throw new Error(t+" - width ("+e.width+") and height ("+e.height+") must be positive numbers")},Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topLeft",{get:function(){return new dr(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topRight",{get:function(){return new dr(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomLeft",{get:function(){return new dr(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomRight",{get:function(){return new dr(this.right,this.bottom)},enumerable:!0,configurable:!0}),n.prototype.round=function(){var e=[this.x,this.y,this.width,this.height].map(function(i){return Math.round(i)}),t=e[0],r=e[1],s=e[2],o=e[3];return new n({x:t,y:r,width:s,height:o})},n.prototype.floor=function(){var e=[this.x,this.y,this.width,this.height].map(function(i){return Math.floor(i)}),t=e[0],r=e[1],s=e[2],o=e[3];return new n({x:t,y:r,width:s,height:o})},n.prototype.toSquare=function(){var e=this,t=e.x,r=e.y,s=e.width,o=e.height,i=Math.abs(s-o);return s<o&&(t-=i/2,s+=i),o<s&&(r-=i/2,o+=i),new n({x:t,y:r,width:s,height:o})},n.prototype.rescale=function(e){var t=OT(e)?e.width:e,r=OT(e)?e.height:e;return new n({x:this.x*t,y:this.y*r,width:this.width*t,height:this.height*r})},n.prototype.pad=function(e,t){var r=[this.x-e/2,this.y-t/2,this.width+e,this.height+t],s=r[0],o=r[1],i=r[2],a=r[3];return new n({x:s,y:o,width:i,height:a})},n.prototype.clipAtImageBorders=function(e,t){var r=this,s=r.x,o=r.y,i=r.right,a=r.bottom,l=Math.max(s,0),c=Math.max(o,0),u=i-l,d=a-c,f=Math.min(u,e-l),p=Math.min(d,t-c);return new n({x:l,y:c,width:f,height:p}).floor()},n.prototype.shift=function(e,t){var r=this,s=r.width,o=r.height,i=this.x+e,a=this.y+t;return new n({x:i,y:a,width:s,height:o})},n.prototype.padAtBorders=function(e,t){var r=this.width+1,s=this.height+1,o=1,i=1,a=r,l=s,c=this.left,u=this.top,d=this.right,f=this.bottom;return d>t&&(a=-d+t+r,d=t),f>e&&(l=-f+e+s,f=e),c<1&&(l=2-c,c=1),u<1&&(l=2-u,u=1),{dy:i,edy:l,dx:o,edx:a,y:u,ey:f,x:c,ex:d,w:r,h:s}},n.prototype.calibrate=function(e){return new n({left:this.left+e.left*this.width,top:this.top+e.top*this.height,right:this.right+e.right*this.width,bottom:this.bottom+e.bottom*this.height}).toSquare().round()},n})(),jy=(function(n){yn(e,n);function e(t,r,s,o,i){return i===void 0&&(i=!1),n.call(this,{left:t,top:r,right:s,bottom:o},i)||this}return e})(ad),xP=(function(){function n(e,t,r,s,o){this._imageDims=new dp(o.width,o.height),this._score=e,this._classScore=t,this._className=r,this._box=new ad(s).rescale(this._imageDims)}return Object.defineProperty(n.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relativeBox",{get:function(){return new ad(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),n.prototype.forSize=function(e,t){return new n(this.score,this.classScore,this.className,this.relativeBox,{width:e,height:t})},n})(),xc=(function(n){yn(e,n);function e(t,r,s){return n.call(this,t,t,"",r,s)||this}return e.prototype.forSize=function(t,r){var s=n.prototype.forSize.call(this,t,r),o=s.score,i=s.relativeBox,a=s.imageDims;return new e(o,i,a)},e})(xP);function fie(n,e,t){t===void 0&&(t=!0);var r=Math.max(0,Math.min(n.right,e.right)-Math.max(n.left,e.left)),s=Math.max(0,Math.min(n.bottom,e.bottom)-Math.max(n.top,e.top)),o=r*s;return t?o/(n.area+e.area-o):o/Math.min(n.area,e.area)}function hie(n){var e=n.map(function(a){return a.x}),t=n.map(function(a){return a.y}),r=e.reduce(function(a,l){return l<a?l:a},1/0),s=t.reduce(function(a,l){return l<a?l:a},1/0),o=e.reduce(function(a,l){return a<l?l:a},0),i=t.reduce(function(a,l){return a<l?l:a},0);return new jy(r,s,o,i)}function $g(n,e,t,r){r===void 0&&(r=!0);for(var s=e.map(function(a,l){return{score:a,boxIndex:l}}).sort(function(a,l){return a.score-l.score}).map(function(a){return a.boxIndex}),o=[],i=function(){var a=s.pop();o.push(a);for(var l=s,c=[],u=0;u<l.length;u++){var d=l[u],f=n[a],p=n[d];c.push(fie(f,p,r))}s=s.filter(function(x,v){return c[v]<=t})};s.length>0;)i();return o}function a1(n,e){return $t(function(){var t=e[0],r=e[1],s=e[2],o=Jl(hg(n.shape.slice(0,3),[1]),t),i=Jl(hg(n.shape.slice(0,3),[1]),r),a=Jl(hg(n.shape.slice(0,3),[1]),s),l=Ls([o,i,a],3);return Vs(n,l)})}function pie(n,e){return e===void 0&&(e=!1),$t(function(){var t=n.shape.slice(1),r=t[0],s=t[1];if(r===s)return n;var o=Math.abs(r-s),i=Math.round(o*(e?.5:1)),a=r>s?2:1,l=function(p){var x=n.shape.slice();return x[a]=p,Jl(x,0)},c=l(i),u=o-c.shape[a],d=e&&u?l(u):null,f=[d,n,c].filter(function(p){return!!p}).map(function(p){return p.toFloat()});return Ls(f,a)})}function n4(n){return 1/(1+Math.exp(-n))}var N6=(function(n){yn(e,n);function e(t,r,s,o,i){return i===void 0&&(i=!1),n.call(this,{x:t,y:r,width:s,height:o},i)||this}return e})(ad),mie=.5,gie=.43,xie=.45,_2=(function(){function n(e,t,r){r===void 0&&(r=new dr(0,0));var s=t.width,o=t.height;this._imgDims=new dp(s,o),this._shift=r,this._positions=e.map(function(i){return i.mul(new dr(s,o)).add(r)})}return Object.defineProperty(n.prototype,"shift",{get:function(){return new dr(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relativePositions",{get:function(){var e=this;return this._positions.map(function(t){return t.sub(e._shift).div(new dr(e.imageWidth,e.imageHeight))})},enumerable:!0,configurable:!0}),n.prototype.forSize=function(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})},n.prototype.shiftBy=function(e,t){return new this.constructor(this.relativePositions,this._imgDims,new dr(e,t))},n.prototype.shiftByPoint=function(e){return this.shiftBy(e.x,e.y)},n.prototype.align=function(e,t){if(t===void 0&&(t={}),e){var r=e instanceof xc?e.box.floor():new ad(e);return this.shiftBy(r.x,r.y).align(null,t)}var s=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},t),o=s.useDlibAlignment,i=s.minBoxPadding;return o?this.alignDlib():this.alignMinBbox(i)},n.prototype.alignDlib=function(){var e=this.getRefPointsForAlignment(),t=e[0],r=e[1],s=e[2],o=function(d){return s.sub(d).magnitude()},i=(o(t)+o(r))/2,a=Math.floor(i/xie),l=S6(e),c=Math.floor(Math.max(0,l.x-mie*a)),u=Math.floor(Math.max(0,l.y-gie*a));return new N6(c,u,Math.min(a,this.imageWidth+c),Math.min(a,this.imageHeight+u))},n.prototype.alignMinBbox=function(e){var t=hie(this.positions);return t.pad(t.width*e,t.height*e)},n.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},n})(),vie=(function(n){yn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getRefPointsForAlignment=function(){var t=this.positions;return[t[0],t[1],S6([t[3],t[4]])]},e})(_2),yie=(function(n){yn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getJawOutline=function(){return this.positions.slice(0,17)},e.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},e.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},e.prototype.getNose=function(){return this.positions.slice(27,36)},e.prototype.getLeftEye=function(){return this.positions.slice(36,42)},e.prototype.getRightEye=function(){return this.positions.slice(42,48)},e.prototype.getMouth=function(){return this.positions.slice(48,68)},e.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(S6)},e})(_2),LT=(function(){function n(e,t){this._label=e,this._distance=t}return Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),n.prototype.toString=function(e){return e===void 0&&(e=!0),""+this.label+(e?" ("+uie(this.distance)+")":"")},n})(),jT=(function(n){yn(e,n);function e(t,r){var s=n.call(this,t)||this;return s._label=r,s}return e.assertIsValidLabeledBox=function(t,r){if(ad.assertIsValidBox(t,r),!mf(t.label))throw new Error(r+" - expected property label ("+t.label+") to be a number")},Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),e})(ad),lv=(function(){function n(e,t){if(typeof e!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(t)||t.some(function(r){return!(r instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=e,this._descriptors=t}return Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),n.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(e){return Array.from(e)})}},n.fromJSON=function(e){var t=e.descriptors.map(function(r){return new Float32Array(r)});return new n(e.label,t)},n})();(function(n){yn(e,n);function e(t,r,s,o){var i=n.call(this,t,r)||this;return i._score=s,i._classScore=o,i}return e.assertIsValidPredictedBox=function(t,r){if(jT.assertIsValidLabeledBox(t,r),!MT(t.score)||!MT(t.classScore))throw new Error(r+" - expected properties score ("+t.score+") and ("+t.classScore+") to be a number between [0, 1]")},Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),e})(jT);function bie(n){return n.detection instanceof xc}function E6(n,e){var t={detection:e};return Object.assign({},n,t)}function vP(){var n=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},e=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:n,readFile:e}}function yP(n){var e="";if(!n)try{n=require("fs")}catch(r){e=r.toString()}var t=n?function(r){return new Promise(function(s,o){n.readFile(r,function(i,a){return i?o(i):s(a)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+e)};return{readFile:t}}function bP(){var n=global.Canvas||global.HTMLCanvasElement,e=global.Image||global.HTMLImageElement,t=function(){if(n)return new n;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},r=function(){if(e)return new e;throw new Error("createImageElement - missing Image implementation for nodejs environment")},s=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},o=yP();return Fo({Canvas:n||(function(){function i(){}return i})(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||(function(){function i(){}return i})(),Image:e||(function(){function i(){}return i})(),ImageData:global.ImageData||(function(){function i(){}return i})(),Video:global.HTMLVideoElement||(function(){function i(){}return i})(),createCanvasElement:t,createImageElement:r,fetch:s},o)}function wP(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function CP(){return typeof global=="object"&&typeof require=="function"&&typeof Gz<"u"&&typeof process<"u"&&!!process.version}var $s;function wie(){if(!$s)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return $s}function N5(n){$s=n}function I6(){wP()&&N5(vP()),CP()&&N5(bP())}function Cie(n){if($s||I6(),!$s)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var e=n.Canvas,t=e===void 0?$s.Canvas:e,r=n.Image,s=r===void 0?$s.Image:r;$s.Canvas=t,$s.Image=s,$s.createCanvasElement=n.createCanvasElement||(function(){return new t}),$s.createImageElement=n.createImageElement||(function(){return new s}),$s.ImageData=n.ImageData||$s.ImageData,$s.Video=n.Video||$s.Video,$s.fetch=n.fetch||$s.fetch,$s.readFile=n.readFile||$s.readFile}var zo={getEnv:wie,setEnv:N5,initialize:I6,createBrowserEnv:vP,createFileSystem:yP,createNodejsEnv:bP,monkeyPatch:Cie,isBrowser:wP,isNodejs:CP};I6();function kP(n){return!zo.isNodejs()&&typeof n=="string"?document.getElementById(n):n}function Sf(n){var e=zo.getEnv(),t=e.Canvas,r=e.CanvasRenderingContext2D;if(n instanceof r)return n;var s=kP(n);if(!(s instanceof t))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var o=s.getContext("2d");if(!o)throw new Error("resolveContext2d - canvas 2d context is null");return o}var BT;(function(n){n.TOP_LEFT="TOP_LEFT",n.TOP_RIGHT="TOP_RIGHT",n.BOTTOM_LEFT="BOTTOM_LEFT",n.BOTTOM_RIGHT="BOTTOM_RIGHT"})(BT||(BT={}));function SP(n){var e=zo.getEnv(),t=e.Image,r=e.Video;return n instanceof t&&n.complete||n instanceof r&&n.readyState>=3}function kie(n){return new Promise(function(e,t){if(n instanceof zo.getEnv().Canvas||SP(n))return e();function r(o){o.currentTarget&&(o.currentTarget.removeEventListener("load",r),o.currentTarget.removeEventListener("error",s),e(o))}function s(o){o.currentTarget&&(o.currentTarget.removeEventListener("load",r),o.currentTarget.removeEventListener("error",s),t(o))}n.addEventListener("load",r),n.addEventListener("error",s)})}function NP(n){var e=zo.getEnv(),t=e.Image,r=e.Video;return n instanceof t?new dp(n.naturalWidth,n.naturalHeight):n instanceof r?new dp(n.videoWidth,n.videoHeight):new dp(n.width,n.height)}function By(n){var e=n.width,t=n.height,r=zo.getEnv().createCanvasElement,s=r();return s.width=e,s.height=t,s}function T6(n,e){var t=zo.getEnv().ImageData;if(!(n instanceof t)&&!SP(n))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=NP(n),s=r.width,o=r.height,i=By({width:s,height:o});return n instanceof t?Sf(i).putImageData(n,0,0):Sf(i).drawImage(n,0,0,s,o),i}function Sie(n,e){return en(this,void 0,void 0,function(){var t,r,s,o,i,a;return tn(this,function(l){switch(l.label){case 0:return t=zo.getEnv().createCanvasElement(),r=n.shape.slice(Zu(n)?1:0),s=r[0],o=r[1],i=r[2],a=$t(function(){return n.as3D(s,o,i).toInt()}),[4,k6.toPixels(a,t)];case 1:return l.sent(),a.dispose(),[2,t]}})})}function VT(n){var e=zo.getEnv(),t=e.Image,r=e.Canvas,s=e.Video;return n instanceof t||n instanceof r||n instanceof s}function Nie(n,e,t){t===void 0&&(t=!1);var r=zo.getEnv(),s=r.Image,o=r.Canvas;if(!(n instanceof s||n instanceof o))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var i=NP(n),a=e/Math.max(i.height,i.width),l=a*i.width,c=a*i.height,u=By({width:e,height:e}),d=n instanceof o?n:T6(n),f=Math.abs(l-c)/2,p=t&&l<c?f:0,x=t&&c<l?f:0;return Sf(u).drawImage(d,p,x,l,c),u}var R2=(function(){function n(e,t){var r=this;if(t===void 0&&(t=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(e))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+e);this._treatAsBatchInput=t,this._batchSize=e.length,e.forEach(function(s,o){if(Ly(s)){r._imageTensors[o]=s,r._inputDimensions[o]=s.shape;return}if(Zu(s)){var i=s.shape[0];if(i!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+i+" passed, but not supported in input array");r._imageTensors[o]=s,r._inputDimensions[o]=s.shape.slice(1);return}var a=s instanceof zo.getEnv().Canvas?s:T6(s);r._canvases[o]=a,r._inputDimensions[o]=[a.height,a.width,3]})}return Object.defineProperty(n.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"reshapedInputDimensions",{get:function(){var e=this;return Ag(this.batchSize,0,1).map(function(t,r){return e.getReshapedInputDimensions(r)})},enumerable:!0,configurable:!0}),n.prototype.getInput=function(e){return this.canvases[e]||this.imageTensors[e]},n.prototype.getInputDimensions=function(e){return this._inputDimensions[e]},n.prototype.getInputHeight=function(e){return this._inputDimensions[e][0]},n.prototype.getInputWidth=function(e){return this._inputDimensions[e][1]},n.prototype.getReshapedInputDimensions=function(e){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var t=this.getInputWidth(e),r=this.getInputHeight(e);return die({width:t,height:r},this.inputSize)},n.prototype.toBatchTensor=function(e,t){var r=this;return t===void 0&&(t=!0),this._inputSize=e,$t(function(){var s=Ag(r.batchSize,0,1).map(function(i){var a=r.getInput(i);if(a instanceof Kr){var l=Zu(a)?a:a.expandDims();return l=pie(l,t),(l.shape[1]!==e||l.shape[2]!==e)&&(l=x6.resizeBilinear(l,[e,e])),l.as3D(e,e,3)}if(a instanceof zo.getEnv().Canvas)return k6.fromPixels(Nie(a,e,t));throw new Error("toBatchTensor - at batchIdx "+i+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+a)}),o=Qi(s.map(function(i){return i.toFloat()})).as4D(r.batchSize,e,e,3);return o})},n})();function no(n){return en(this,void 0,void 0,function(){var e,t,r;return tn(this,function(s){switch(s.label){case 0:if(n instanceof R2)return[2,n];if(e=Array.isArray(n)?n:[n],!e.length)throw new Error("toNetInput - empty array passed as input");return t=function(o){return Array.isArray(n)?" at input index "+o+":":""},r=e.map(kP),r.forEach(function(o,i){if(!VT(o)&&!Ly(o)&&!Zu(o))throw typeof e[i]=="string"?new Error("toNetInput -"+t(i)+" string passed, but could not resolve HTMLElement for element id "+e[i]):new Error("toNetInput -"+t(i)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(Zu(o)){var a=o.shape[0];if(a!==1)throw new Error("toNetInput -"+t(i)+" tf.Tensor4D with batchSize "+a+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(o){return VT(o)&&kie(o)}))];case 1:return s.sent(),[2,new R2(r,Array.isArray(n))]}})})}function _6(n,e){return en(this,void 0,void 0,function(){var t,r,s,o,i,a,l;return tn(this,function(c){switch(c.label){case 0:return t=zo.getEnv().Canvas,r=n,n instanceof t?[3,5]:[4,no(n)];case 1:if(s=c.sent(),s.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return o=s.getInput(0),o instanceof t?(i=o,[3,4]):[3,2];case 2:return[4,Sie(o)];case 3:i=c.sent(),c.label=4;case 4:r=i,c.label=5;case 5:return a=Sf(r),l=e.map(function(u){return u instanceof xc?u.forSize(r.width,r.height).box.floor():u}).map(function(u){return u.clipAtImageBorders(r.width,r.height)}),[2,l.map(function(u){var d=u.x,f=u.y,p=u.width,x=u.height,v=By({width:p,height:x});return Sf(v).putImageData(a.getImageData(d,f,p,x),0,0),v})]}})})}function R6(n,e){return en(this,void 0,void 0,function(){return tn(this,function(t){if(!Ly(n)&&!Zu(n))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(Zu(n)&&n.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,$t(function(){var r=n.shape.slice(Zu(n)?1:0),s=r[0],o=r[1],i=r[2],a=e.map(function(c){return c instanceof xc?c.forSize(o,s).box:c}).map(function(c){return c.clipAtImageBorders(o,s)}),l=a.map(function(c){var u=c.x,d=c.y,f=c.width,p=c.height;return JF(n.as3D(s,o,i),[d,u,0],[p,f,i])});return l})]})})}function Eie(n,e){return en(this,void 0,void 0,function(){var t,r;return tn(this,function(s){switch(s.label){case 0:return t=zo.getEnv().fetch,[4,t(n,e)];case 1:if(r=s.sent(),!(r.status<400))throw new Error("failed to fetch: ("+r.status+") "+r.statusText+", from url: "+r.url);return[2,r]}})})}function Iie(n){return en(this,void 0,void 0,function(){return tn(this,function(e){switch(e.label){case 0:return[4,Eie(n)];case 1:return[2,e.sent().json()]}})})}function EP(n,e){var t=e+"-weights_manifest.json";if(!n)return{modelBaseUri:"",manifestUri:t};if(n==="/")return{modelBaseUri:"/",manifestUri:"/"+t};var r=n.startsWith("http://")?"http://":n.startsWith("https://")?"https://":"";n=n.replace(r,"");var s=n.split("/").filter(function(a){return a}),o=n.endsWith(".json")?s[s.length-1]:t,i=r+(n.endsWith(".json")?s.slice(0,s.length-1):s).join("/");return i=n.startsWith("/")?"/"+i:i,{modelBaseUri:i,manifestUri:i==="/"?"/"+o:i+"/"+o}}function Tie(n,e){return en(this,void 0,void 0,function(){var t,r,s,o;return tn(this,function(i){switch(i.label){case 0:return t=EP(n,e),r=t.manifestUri,s=t.modelBaseUri,[4,Iie(r)];case 1:return o=i.sent(),[2,mP.loadWeights(o,s)]}})})}var Yc=(function(){function n(e){this._name=e,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(n.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),n.prototype.getParamFromPath=function(e){var t=this.traversePropertyPath(e),r=t.obj,s=t.objProp;return r[s]},n.prototype.reassignParamFromPath=function(e,t){var r=this.traversePropertyPath(e),s=r.obj,o=r.objProp;s[o].dispose(),s[o]=t},n.prototype.getParamList=function(){var e=this;return this._paramMappings.map(function(t){var r=t.paramPath;return{path:r,tensor:e.getParamFromPath(r)}})},n.prototype.getTrainableParams=function(){return this.getParamList().filter(function(e){return e.tensor instanceof Ep})},n.prototype.getFrozenParams=function(){return this.getParamList().filter(function(e){return!(e.tensor instanceof Ep)})},n.prototype.variable=function(){var e=this;this.getFrozenParams().forEach(function(t){var r=t.path,s=t.tensor;e.reassignParamFromPath(r,s.variable())})},n.prototype.freeze=function(){var e=this;this.getTrainableParams().forEach(function(t){var r=t.path,s=t.tensor,o=ho(s.dataSync());s.dispose(),e.reassignParamFromPath(r,o)})},n.prototype.dispose=function(e){e===void 0&&(e=!0),this.getParamList().forEach(function(t){if(e&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+t.path);t.tensor.dispose()}),this._params=void 0},n.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(e){var t=e.tensor;return Array.from(t.dataSync())}).reduce(function(e,t){return e.concat(t)}))},n.prototype.load=function(e){return en(this,void 0,void 0,function(){return tn(this,function(t){switch(t.label){case 0:return e instanceof Float32Array?(this.extractWeights(e),[2]):[4,this.loadFromUri(e)];case 1:return t.sent(),[2]}})})},n.prototype.loadFromUri=function(e){return en(this,void 0,void 0,function(){var t;return tn(this,function(r){switch(r.label){case 0:if(e&&typeof e!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,Tie(e,this.getDefaultModelName())];case 1:return t=r.sent(),this.loadFromWeightMap(t),[2]}})})},n.prototype.loadFromDisk=function(e){return en(this,void 0,void 0,function(){var t,r,s,o,i,a,l,c,u,d;return tn(this,function(f){switch(f.label){case 0:if(e&&typeof e!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return t=zo.getEnv().readFile,r=EP(e,this.getDefaultModelName()),s=r.manifestUri,o=r.modelBaseUri,i=function(p){return Promise.all(p.map(function(x){return t(x).then(function(v){return v.buffer})}))},a=mP.weightsLoaderFactory(i),u=(c=JSON).parse,[4,t(s)];case 1:return l=u.apply(c,[f.sent().toString()]),[4,a(l,o)];case 2:return d=f.sent(),this.loadFromWeightMap(d),[2]}})})},n.prototype.loadFromWeightMap=function(e){var t=this.extractParamsFromWeigthMap(e),r=t.paramMappings,s=t.params;this._paramMappings=r,this._params=s},n.prototype.extractWeights=function(e){var t=this.extractParams(e),r=t.paramMappings,s=t.params;this._paramMappings=r,this._params=s},n.prototype.traversePropertyPath=function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=e.split("/").reduce(function(o,i){if(!o.nextObj.hasOwnProperty(i))throw new Error("traversePropertyPath - object does not have property "+i+", for path "+e);return{obj:o.nextObj,objProp:i,nextObj:o.nextObj[i]}},{nextObj:this.params}),r=t.obj,s=t.objProp;if(!r||!s||!(r[s]instanceof Kr))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+e);return{obj:r,objProp:s}},n})();function Yi(n,e,t){return $t(function(){var r=f6(n,e.depthwise_filter,e.pointwise_filter,t,"same");return r=jn(r,e.bias),r})}function r4(n,e,t){return t===void 0&&(t=!1),$t(function(){var r=Xr(t?jn(Aa(n,e.conv0.filters,[2,2],"same"),e.conv0.bias):Yi(n,e.conv0,[2,2])),s=Yi(r,e.conv1,[1,1]),o=Xr(jn(r,s)),i=Yi(o,e.conv2,[1,1]);return Xr(jn(r,jn(s,i)))})}function uv(n,e,t,r){return t===void 0&&(t=!1),r===void 0&&(r=!0),$t(function(){var s=Xr(t?jn(Aa(n,e.conv0.filters,r?[2,2]:[1,1],"same"),e.conv0.bias):Yi(n,e.conv0,r?[2,2]:[1,1])),o=Yi(s,e.conv1,[1,1]),i=Xr(jn(s,o)),a=Yi(i,e.conv2,[1,1]),l=Xr(jn(s,jn(o,a))),c=Yi(l,e.conv3,[1,1]);return Xr(jn(s,jn(o,jn(a,c))))})}function ol(n,e,t,r){return t===void 0&&(t="same"),r===void 0&&(r=!1),$t(function(){var s=jn(Aa(n,e.filters,[1,1],t),e.bias);return r?Xr(s):s})}function Zc(n,e){Object.keys(n).forEach(function(t){e.some(function(r){return r.originalPath===t})||n[t].dispose()})}function Vy(n,e){return function(t,r,s,o){var i=yi(n(t*r*s*s),[s,s,t,r]),a=bs(n(r));return e.push({paramPath:o+"/filters"},{paramPath:o+"/bias"}),{filters:i,bias:a}}}function D6(n,e){return function(t,r,s){var o=Xu(n(t*r),[t,r]),i=bs(n(r));return e.push({paramPath:s+"/weights"},{paramPath:s+"/bias"}),{weights:o,bias:i}}}var IP=(function(){function n(e,t,r){this.depthwise_filter=e,this.pointwise_filter=t,this.bias=r}return n})();function A6(n,e){return function(t,r,s){var o=yi(n(9*t),[3,3,t,1]),i=yi(n(t*r),[1,1,t,r]),a=bs(n(r));return e.push({paramPath:s+"/depthwise_filter"},{paramPath:s+"/pointwise_filter"},{paramPath:s+"/bias"}),new IP(o,i,a)}}function $6(n){return function(e){var t=n(e+"/depthwise_filter",4),r=n(e+"/pointwise_filter",4),s=n(e+"/bias",1);return new IP(t,r,s)}}function xd(n,e){return function(t,r,s){var o=n[t];if(!My(o,r))throw new Error("expected weightMap["+t+"] to be a Tensor"+r+"D, instead have "+o);return e.push({originalPath:t,paramPath:s||t}),o}}function Jc(n){var e=n;function t(s){var o=e.slice(0,s);return e=e.slice(s),o}function r(){return e}return{extractWeights:t,getRemainingWeights:r}}function TP(n,e){var t=Vy(n,e),r=A6(n,e);function s(i,a,l,c){c===void 0&&(c=!1);var u=c?t(i,a,3,l+"/conv0"):r(i,a,l+"/conv0"),d=r(a,a,l+"/conv1"),f=r(a,a,l+"/conv2");return{conv0:u,conv1:d,conv2:f}}function o(i,a,l,c){c===void 0&&(c=!1);var u=s(i,a,l,c),d=u.conv0,f=u.conv1,p=u.conv2,x=r(a,a,l+"/conv3");return{conv0:d,conv1:f,conv2:p,conv3:x}}return{extractDenseBlock3Params:s,extractDenseBlock4Params:o}}function _ie(n){var e=[],t=Jc(n),r=t.extractWeights,s=t.getRemainingWeights,o=TP(r,e).extractDenseBlock4Params,i=o(3,32,"dense0",!0),a=o(32,64,"dense1"),l=o(64,128,"dense2"),c=o(128,256,"dense3");if(s().length!==0)throw new Error("weights remaing after extract: "+s().length);return{paramMappings:e,params:{dense0:i,dense1:a,dense2:l,dense3:c}}}function _P(n){return function(e){var t=n(e+"/filters",4),r=n(e+"/bias",1);return{filters:t,bias:r}}}function RP(n,e){var t=xd(n,e),r=_P(t),s=$6(t);function o(a,l){l===void 0&&(l=!1);var c=l?r(a+"/conv0"):s(a+"/conv0"),u=s(a+"/conv1"),d=s(a+"/conv2");return{conv0:c,conv1:u,conv2:d}}function i(a,l){l===void 0&&(l=!1);var c=l?r(a+"/conv0"):s(a+"/conv0"),u=s(a+"/conv1"),d=s(a+"/conv2"),f=s(a+"/conv3");return{conv0:c,conv1:u,conv2:d,conv3:f}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:i}}function Rie(n){var e=[],t=RP(n,e).extractDenseBlock4Params,r={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2"),dense3:t("dense3")};return Zc(n,e),{params:r,paramMappings:e}}var DP=(function(n){yn(e,n);function e(){return n.call(this,"FaceFeatureExtractor")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("FaceFeatureExtractor - load model before inference");return $t(function(){var s=t.toBatchTensor(112,!0),o=[122.782,117.001,104.298],i=a1(s,o).div(St(255)),a=uv(i,r.dense0,!0);return a=uv(a,r.dense1),a=uv(a,r.dense2),a=uv(a,r.dense3),a=o1(a,[7,7],[2,2],"valid"),a})},e.prototype.forward=function(t){return en(this,void 0,void 0,function(){var r;return tn(this,function(s){switch(s.label){case 0:return r=this.forwardInput,[4,no(t)];case 1:return[2,r.apply(this,[s.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},e.prototype.extractParamsFromWeigthMap=function(t){return Rie(t)},e.prototype.extractParams=function(t){return _ie(t)},e})(Yc);function Gl(n,e){return $t(function(){return jn(Fy(n,e.weights),e.bias)})}function Die(n,e,t){var r=[],s=Jc(n),o=s.extractWeights,i=s.getRemainingWeights,a=D6(o,r),l=a(e,t,"fc");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:r,params:{fc:l}}}function Aie(n){var e=[],t=xd(n,e);function r(o){var i=t(o+"/weights",2),a=t(o+"/bias",1);return{weights:i,bias:a}}var s={fc:r("fc")};return Zc(n,e),{params:s,paramMappings:e}}function AP(n){var e={},t={};return Object.keys(n).forEach(function(r){var s=r.startsWith("fc")?t:e;s[r]=n[r]}),{featureExtractorMap:e,classifierMap:t}}var $P=(function(n){yn(e,n);function e(t,r){var s=n.call(this,t)||this;return s._faceFeatureExtractor=r,s}return Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var r=this,s=this.params;if(!s)throw new Error(this._name+" - load model before inference");return $t(function(){var o=t instanceof R2?r.faceFeatureExtractor.forwardInput(t):t;return Gl(o.as2D(o.shape[0],-1),s.fc)})},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),n.prototype.dispose.call(this,t)},e.prototype.loadClassifierParams=function(t){var r=this.extractClassifierParams(t),s=r.params,o=r.paramMappings;this._params=s,this._paramMappings=o},e.prototype.extractClassifierParams=function(t){return Die(t,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},e.prototype.extractParamsFromWeigthMap=function(t){var r=AP(t),s=r.featureExtractorMap,o=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(s),Aie(o)},e.prototype.extractParams=function(t){var r=this.getClassifierChannelsIn(),s=this.getClassifierChannelsOut(),o=s*r+s,i=t.slice(0,t.length-o),a=t.slice(t.length-o);return this.faceFeatureExtractor.extractWeights(i),this.extractClassifierParams(a)},e})(Yc),zT=["neutral","happy","sad","angry","fearful","disgusted","surprised"],$ie=(function(){function n(e){var t=this;if(e.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+e.length);zT.forEach(function(r,s){t[r]=e[s]})}return n.prototype.asSortedArray=function(){var e=this;return zT.map(function(t){return{expression:t,probability:e[t]}}).sort(function(t,r){return r.probability-t.probability})},n})(),Fie=(function(n){yn(e,n);function e(t){return t===void 0&&(t=new DP),n.call(this,"FaceExpressionNet",t)||this}return e.prototype.forwardInput=function(t){var r=this;return $t(function(){return Kc(r.runNet(t))})},e.prototype.forward=function(t){return en(this,void 0,void 0,function(){var r;return tn(this,function(s){switch(s.label){case 0:return r=this.forwardInput,[4,no(t)];case 1:return[2,r.apply(this,[s.sent()])]}})})},e.prototype.predictExpressions=function(t){return en(this,void 0,void 0,function(){var r,s,o,i,a=this;return tn(this,function(l){switch(l.label){case 0:return[4,no(t)];case 1:return r=l.sent(),[4,this.forwardInput(r)];case 2:return s=l.sent(),[4,Promise.all(js(s).map(function(c){return en(a,void 0,void 0,function(){var u;return tn(this,function(d){switch(d.label){case 0:return[4,c.data()];case 1:return u=d.sent(),c.dispose(),[2,u]}})})}))];case 3:return o=l.sent(),s.dispose(),i=o.map(function(c){return new $ie(c)}),[2,r.isBatchInput?i:i[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_expression_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e.prototype.getClassifierChannelsOut=function(){return 7},e})($P);function FP(n,e){var t={expressions:e};return Object.assign({},n,t)}function Pie(n){return bie(n)&&n.landmarks instanceof _2&&n.unshiftedLandmarks instanceof _2&&n.alignedRect instanceof xc}function F6(n,e){var t=n.detection.box,r=e.shiftBy(t.x,t.y),s=r.align(),o=n.detection.imageDims,i=new xc(n.detection.score,s.rescale(o.reverse()),o),a={landmarks:r,unshiftedLandmarks:e,alignedRect:i};return Object.assign({},n,a)}function Oie(n,e){var t=Vy(n,e),r=A6(n,e);function s(i,a,l){var c=r(i,a,l+"/separable_conv0"),u=r(a,a,l+"/separable_conv1"),d=t(i,a,1,l+"/expansion_conv");return{separable_conv0:c,separable_conv1:u,expansion_conv:d}}function o(i,a){var l=r(i,i,a+"/separable_conv0"),c=r(i,i,a+"/separable_conv1"),u=r(i,i,a+"/separable_conv2");return{separable_conv0:l,separable_conv1:c,separable_conv2:u}}return{extractConvParams:t,extractSeparableConvParams:r,extractReductionBlockParams:s,extractMainBlockParams:o}}function Mie(n,e){var t=[],r=Jc(n),s=r.extractWeights,o=r.getRemainingWeights,i=Oie(s,t),a=i.extractConvParams,l=i.extractSeparableConvParams,c=i.extractReductionBlockParams,u=i.extractMainBlockParams,d=a(3,32,3,"entry_flow/conv_in"),f=c(32,64,"entry_flow/reduction_block_0"),p=c(64,128,"entry_flow/reduction_block_1"),x={conv_in:d,reduction_block_0:f,reduction_block_1:p},v={};Ag(e,0,1).forEach(function(S){v["main_block_"+S]=u(128,"middle_flow/main_block_"+S)});var y=c(128,256,"exit_flow/reduction_block"),b=l(256,512,"exit_flow/separable_conv"),w={reduction_block:y,separable_conv:b};if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{entry_flow:x,middle_flow:v,exit_flow:w}}}function Lie(n,e){var t=xd(n,e),r=_P(t),s=$6(t);function o(a){var l=s(a+"/separable_conv0"),c=s(a+"/separable_conv1"),u=r(a+"/expansion_conv");return{separable_conv0:l,separable_conv1:c,expansion_conv:u}}function i(a){var l=s(a+"/separable_conv0"),c=s(a+"/separable_conv1"),u=s(a+"/separable_conv2");return{separable_conv0:l,separable_conv1:c,separable_conv2:u}}return{extractConvParams:r,extractSeparableConvParams:s,extractReductionBlockParams:o,extractMainBlockParams:i}}function jie(n,e){var t=[],r=Lie(n,t),s=r.extractConvParams,o=r.extractSeparableConvParams,i=r.extractReductionBlockParams,a=r.extractMainBlockParams,l=s("entry_flow/conv_in"),c=i("entry_flow/reduction_block_0"),u=i("entry_flow/reduction_block_1"),d={conv_in:l,reduction_block_0:c,reduction_block_1:u},f={};Ag(e,0,1).forEach(function(y){f["main_block_"+y]=a("middle_flow/main_block_"+y)});var p=i("exit_flow/reduction_block"),x=o("exit_flow/separable_conv"),v={reduction_block:p,separable_conv:x};return Zc(n,t),{params:{entry_flow:d,middle_flow:f,exit_flow:v},paramMappings:t}}function PP(n,e,t){return jn(Aa(n,e.filters,t,"same"),e.bias)}function s4(n,e,t){t===void 0&&(t=!0);var r=t?Xr(n):n;return r=Yi(r,e.separable_conv0,[1,1]),r=Yi(Xr(r),e.separable_conv1,[1,1]),r=Js(r,[3,3],[2,2],"same"),r=jn(r,PP(n,e.expansion_conv,[2,2])),r}function Bie(n,e){var t=Yi(Xr(n),e.separable_conv0,[1,1]);return t=Yi(Xr(t),e.separable_conv1,[1,1]),t=Yi(Xr(t),e.separable_conv2,[1,1]),t=jn(t,n),t}var Vie=(function(n){yn(e,n);function e(t){var r=n.call(this,"TinyXception")||this;return r._numMainBlocks=t,r}return e.prototype.forwardInput=function(t){var r=this,s=this.params;if(!s)throw new Error("TinyXception - load model before inference");return $t(function(){var o=t.toBatchTensor(112,!0),i=[122.782,117.001,104.298],a=a1(o,i).div(St(256)),l=Xr(PP(a,s.entry_flow.conv_in,[2,2]));return l=s4(l,s.entry_flow.reduction_block_0,!1),l=s4(l,s.entry_flow.reduction_block_1),Ag(r._numMainBlocks,0,1).forEach(function(c){l=Bie(l,s.middle_flow["main_block_"+c])}),l=s4(l,s.exit_flow.reduction_block),l=Xr(Yi(l,s.exit_flow.separable_conv,[1,1])),l})},e.prototype.forward=function(t){return en(this,void 0,void 0,function(){var r;return tn(this,function(s){switch(s.label){case 0:return r=this.forwardInput,[4,no(t)];case 1:return[2,r.apply(this,[s.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"tiny_xception_model"},e.prototype.extractParamsFromWeigthMap=function(t){return jie(t,this._numMainBlocks)},e.prototype.extractParams=function(t){return Mie(t,this._numMainBlocks)},e})(Yc);function zie(n){var e=[],t=Jc(n),r=t.extractWeights,s=t.getRemainingWeights,o=D6(r,e),i=o(512,1,"fc/age"),a=o(512,2,"fc/gender");if(s().length!==0)throw new Error("weights remaing after extract: "+s().length);return{paramMappings:e,params:{fc:{age:i,gender:a}}}}function Wie(n){var e=[],t=xd(n,e);function r(o){var i=t(o+"/weights",2),a=t(o+"/bias",1);return{weights:i,bias:a}}var s={fc:{age:r("fc/age"),gender:r("fc/gender")}};return Zc(n,e),{params:s,paramMappings:e}}var D2;(function(n){n.FEMALE="female",n.MALE="male"})(D2||(D2={}));var Uie=(function(n){yn(e,n);function e(t){t===void 0&&(t=new Vie(2));var r=n.call(this,"AgeGenderNet")||this;return r._faceFeatureExtractor=t,r}return Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var r=this,s=this.params;if(!s)throw new Error(this._name+" - load model before inference");return $t(function(){var o=t instanceof R2?r.faceFeatureExtractor.forwardInput(t):t,i=o1(o,[7,7],[2,2],"valid").as2D(o.shape[0],-1),a=Gl(i,s.fc.age).as1D(),l=Gl(i,s.fc.gender);return{age:a,gender:l}})},e.prototype.forwardInput=function(t){var r=this;return $t(function(){var s=r.runNet(t),o=s.age,i=s.gender;return{age:o,gender:Kc(i)}})},e.prototype.forward=function(t){return en(this,void 0,void 0,function(){var r;return tn(this,function(s){switch(s.label){case 0:return r=this.forwardInput,[4,no(t)];case 1:return[2,r.apply(this,[s.sent()])]}})})},e.prototype.predictAgeAndGender=function(t){return en(this,void 0,void 0,function(){var r,s,o,i,a,l,c=this;return tn(this,function(u){switch(u.label){case 0:return[4,no(t)];case 1:return r=u.sent(),[4,this.forwardInput(r)];case 2:return s=u.sent(),o=js(s.age),i=js(s.gender),a=o.map(function(d,f){return{ageTensor:d,genderTensor:i[f]}}),[4,Promise.all(a.map(function(d){var f=d.ageTensor,p=d.genderTensor;return en(c,void 0,void 0,function(){var x,v,y,b,w;return tn(this,function(S){switch(S.label){case 0:return[4,f.data()];case 1:return x=S.sent()[0],[4,p.data()];case 2:return v=S.sent()[0],y=v>.5,b=y?D2.MALE:D2.FEMALE,w=y?v:1-v,f.dispose(),p.dispose(),[2,{age:x,gender:b,genderProbability:w}]}})})}))];case 3:return l=u.sent(),s.age.dispose(),s.gender.dispose(),[2,r.isBatchInput?l:l[0]]}})})},e.prototype.getDefaultModelName=function(){return"age_gender_model"},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),n.prototype.dispose.call(this,t)},e.prototype.loadClassifierParams=function(t){var r=this.extractClassifierParams(t),s=r.params,o=r.paramMappings;this._params=s,this._paramMappings=o},e.prototype.extractClassifierParams=function(t){return zie(t)},e.prototype.extractParamsFromWeigthMap=function(t){var r=AP(t),s=r.featureExtractorMap,o=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(s),Wie(o)},e.prototype.extractParams=function(t){var r=1539,s=t.slice(0,t.length-r),o=t.slice(t.length-r);return this.faceFeatureExtractor.extractWeights(s),this.extractClassifierParams(o)},e})(Yc),OP=(function(n){yn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.postProcess=function(t,r,s){var o=s.map(function(a){var l=a.width,c=a.height,u=r/Math.max(c,l);return{width:l*u,height:c*u}}),i=o.length;return $t(function(){var a=function(f,p){return Qi([Jl([68],f),Jl([68],p)],1).as2D(1,136).as1D()},l=function(f,p){var x=o[f],v=x.width,y=x.height;return p(v,y)?Math.abs(v-y)/2:0},c=function(f){return l(f,function(p,x){return p<x})},u=function(f){return l(f,function(p,x){return x<p})},d=t.mul(Jl([i,136],r)).sub(Qi(Array.from(Array(i),function(f,p){return a(c(p),u(p))}))).div(Qi(Array.from(Array(i),function(f,p){return a(o[p].width,o[p].height)})));return d})},e.prototype.forwardInput=function(t){var r=this;return $t(function(){var s=r.runNet(t);return r.postProcess(s,t.inputSize,t.inputDimensions.map(function(o){var i=o[0],a=o[1];return{height:i,width:a}}))})},e.prototype.forward=function(t){return en(this,void 0,void 0,function(){var r;return tn(this,function(s){switch(s.label){case 0:return r=this.forwardInput,[4,no(t)];case 1:return[2,r.apply(this,[s.sent()])]}})})},e.prototype.detectLandmarks=function(t){return en(this,void 0,void 0,function(){var r,s,o,i=this;return tn(this,function(a){switch(a.label){case 0:return[4,no(t)];case 1:return r=a.sent(),s=$t(function(){return js(i.forwardInput(r))}),[4,Promise.all(s.map(function(l,c){return en(i,void 0,void 0,function(){var u,d,f,p,x;return tn(this,function(v){switch(v.label){case 0:return f=(d=Array).from,[4,l.data()];case 1:return u=f.apply(d,[v.sent()]),p=u.filter(function(y,b){return PT(b)}),x=u.filter(function(y,b){return!PT(b)}),[2,new yie(Array(68).fill(0).map(function(y,b){return new dr(p[b],x[b])}),{height:r.getInputHeight(c),width:r.getInputWidth(c)})]}})})}))];case 2:return o=a.sent(),s.forEach(function(l){return l.dispose()}),[2,r.isBatchInput?o:o[0]]}})})},e.prototype.getClassifierChannelsOut=function(){return 136},e})($P),MP=(function(n){yn(e,n);function e(t){return t===void 0&&(t=new DP),n.call(this,"FaceLandmark68Net",t)||this}return e.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e})(OP);function Hie(n){var e=[],t=RP(n,e).extractDenseBlock3Params,r={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2")};return Zc(n,e),{params:r,paramMappings:e}}function Gie(n){var e=[],t=Jc(n),r=t.extractWeights,s=t.getRemainingWeights,o=TP(r,e).extractDenseBlock3Params,i=o(3,32,"dense0",!0),a=o(32,64,"dense1"),l=o(64,128,"dense2");if(s().length!==0)throw new Error("weights remaing after extract: "+s().length);return{paramMappings:e,params:{dense0:i,dense1:a,dense2:l}}}var qie=(function(n){yn(e,n);function e(){return n.call(this,"TinyFaceFeatureExtractor")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("TinyFaceFeatureExtractor - load model before inference");return $t(function(){var s=t.toBatchTensor(112,!0),o=[122.782,117.001,104.298],i=a1(s,o).div(St(255)),a=r4(i,r.dense0,!0);return a=r4(a,r.dense1),a=r4(a,r.dense2),a=o1(a,[14,14],[2,2],"valid"),a})},e.prototype.forward=function(t){return en(this,void 0,void 0,function(){var r;return tn(this,function(s){switch(s.label){case 0:return r=this.forwardInput,[4,no(t)];case 1:return[2,r.apply(this,[s.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},e.prototype.extractParamsFromWeigthMap=function(t){return Hie(t)},e.prototype.extractParams=function(t){return Gie(t)},e})(Yc),Kie=(function(n){yn(e,n);function e(t){return t===void 0&&(t=new qie),n.call(this,"FaceLandmark68TinyNet",t)||this}return e.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},e.prototype.getClassifierChannelsIn=function(){return 128},e})(OP);(function(n){yn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e})(MP);function Xie(n,e){return jn(jo(n,e.weights),e.biases)}function P6(n,e,t,r,s){s===void 0&&(s="same");var o=e.conv,i=o.filters,a=o.bias,l=Aa(n,i,t,s);return l=jn(l,a),l=Xie(l,e.scale),r?Xr(l):l}function Yie(n,e){return P6(n,e,[1,1],!0)}function LP(n,e){return P6(n,e,[1,1],!1)}function jP(n,e){return P6(n,e,[2,2],!0,"valid")}function Zie(n,e){function t(a,l,c){var u=n(a),d=u.length/(l*c*c);if(cie(d))throw new Error("depth has to be an integer: "+d+", weights.length: "+u.length+", numFilters: "+l+", filterSize: "+c);return $t(function(){return id(yi(u,[l,d,c,c]),[2,3,1,0])})}function r(a,l,c,u){var d=t(a,l,c),f=bs(n(l));return e.push({paramPath:u+"/filters"},{paramPath:u+"/bias"}),{filters:d,bias:f}}function s(a,l){var c=bs(n(a)),u=bs(n(a));return e.push({paramPath:l+"/weights"},{paramPath:l+"/biases"}),{weights:c,biases:u}}function o(a,l,c,u){var d=r(a,l,c,u+"/conv"),f=s(l,u+"/scale");return{conv:d,scale:f}}function i(a,l,c,u,d){d===void 0&&(d=!1);var f=o((d?.5:1)*a,l,c,u+"/conv1"),p=o(a,l,c,u+"/conv2");return{conv1:f,conv2:p}}return{extractConvLayerParams:o,extractResidualLayerParams:i}}function Jie(n){var e=Jc(n),t=e.extractWeights,r=e.getRemainingWeights,s=[],o=Zie(t,s),i=o.extractConvLayerParams,a=o.extractResidualLayerParams,l=i(4704,32,7,"conv32_down"),c=a(9216,32,3,"conv32_1"),u=a(9216,32,3,"conv32_2"),d=a(9216,32,3,"conv32_3"),f=a(36864,64,3,"conv64_down",!0),p=a(36864,64,3,"conv64_1"),x=a(36864,64,3,"conv64_2"),v=a(36864,64,3,"conv64_3"),y=a(147456,128,3,"conv128_down",!0),b=a(147456,128,3,"conv128_1"),w=a(147456,128,3,"conv128_2"),S=a(589824,256,3,"conv256_down",!0),k=a(589824,256,3,"conv256_1"),N=a(589824,256,3,"conv256_2"),I=a(589824,256,3,"conv256_down_out"),T=$t(function(){return id(Xu(t(256*128),[128,256]),[1,0])});if(s.push({paramPath:"fc"}),r().length!==0)throw new Error("weights remaing after extract: "+r().length);var F={conv32_down:l,conv32_1:c,conv32_2:u,conv32_3:d,conv64_down:f,conv64_1:p,conv64_2:x,conv64_3:v,conv128_down:y,conv128_1:b,conv128_2:w,conv256_down:S,conv256_1:k,conv256_2:N,conv256_down_out:I,fc:T};return{params:F,paramMappings:s}}function Qie(n,e){var t=xd(n,e);function r(i){var a=t(i+"/scale/weights",1),l=t(i+"/scale/biases",1);return{weights:a,biases:l}}function s(i){var a=t(i+"/conv/filters",4),l=t(i+"/conv/bias",1),c=r(i);return{conv:{filters:a,bias:l},scale:c}}function o(i){return{conv1:s(i+"/conv1"),conv2:s(i+"/conv2")}}return{extractConvLayerParams:s,extractResidualLayerParams:o}}function eae(n){var e=[],t=Qie(n,e),r=t.extractConvLayerParams,s=t.extractResidualLayerParams,o=r("conv32_down"),i=s("conv32_1"),a=s("conv32_2"),l=s("conv32_3"),c=s("conv64_down"),u=s("conv64_1"),d=s("conv64_2"),f=s("conv64_3"),p=s("conv128_down"),x=s("conv128_1"),v=s("conv128_2"),y=s("conv256_down"),b=s("conv256_1"),w=s("conv256_2"),S=s("conv256_down_out"),k=n.fc;if(e.push({originalPath:"fc",paramPath:"fc"}),!lie(k))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+k);var N={conv32_down:o,conv32_1:i,conv32_2:a,conv32_3:l,conv64_down:c,conv64_1:u,conv64_2:d,conv64_3:f,conv128_down:p,conv128_1:x,conv128_2:v,conv256_down:y,conv256_1:b,conv256_2:w,conv256_down_out:S,fc:k};return Zc(n,e),{params:N,paramMappings:e}}function $l(n,e){var t=Yie(n,e.conv1);return t=LP(t,e.conv2),t=jn(t,n),t=Xr(t),t}function dv(n,e){var t=jP(n,e.conv1);t=LP(t,e.conv2);var r=o1(n,2,2,"valid"),s=Mr(r.shape),o=r.shape[3]!==t.shape[3],i=r.shape[1]!==t.shape[1]||r.shape[2]!==t.shape[2];if(i){var a=hg(t.shape);a[1]=1;var l=Mr(a);t=Ls([t,l],1);var c=hg(t.shape);c[2]=1;var u=Mr(c);t=Ls([t,u],2)}return r=o?Ls([r,s],3):r,t=jn(r,t),t=Xr(t),t}var tae=(function(n){yn(e,n);function e(){return n.call(this,"FaceRecognitionNet")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("FaceRecognitionNet - load model before inference");return $t(function(){var s=t.toBatchTensor(150,!0).toFloat(),o=[122.782,117.001,104.298],i=a1(s,o).div(St(256)),a=jP(i,r.conv32_down);a=Js(a,3,2,"valid"),a=$l(a,r.conv32_1),a=$l(a,r.conv32_2),a=$l(a,r.conv32_3),a=dv(a,r.conv64_down),a=$l(a,r.conv64_1),a=$l(a,r.conv64_2),a=$l(a,r.conv64_3),a=dv(a,r.conv128_down),a=$l(a,r.conv128_1),a=$l(a,r.conv128_2),a=dv(a,r.conv256_down),a=$l(a,r.conv256_1),a=$l(a,r.conv256_2),a=dv(a,r.conv256_down_out);var l=a.mean([1,2]),c=Fy(l,r.fc);return c})},e.prototype.forward=function(t){return en(this,void 0,void 0,function(){var r;return tn(this,function(s){switch(s.label){case 0:return r=this.forwardInput,[4,no(t)];case 1:return[2,r.apply(this,[s.sent()])]}})})},e.prototype.computeFaceDescriptor=function(t){return en(this,void 0,void 0,function(){var r,s,o,i=this;return tn(this,function(a){switch(a.label){case 0:return[4,no(t)];case 1:return r=a.sent(),s=$t(function(){return js(i.forwardInput(r))}),[4,Promise.all(s.map(function(l){return l.data()}))];case 2:return o=a.sent(),s.forEach(function(l){return l.dispose()}),[2,r.isBatchInput?o:o[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_recognition_model"},e.prototype.extractParamsFromWeigthMap=function(t){return eae(t)},e.prototype.extractParams=function(t){return Jie(t)},e})(Yc);function BP(n,e){var t={descriptor:e};return Object.assign({},n,t)}function VP(n,e){var t={age:e};return Object.assign({},n,t)}function zP(n,e,t){var r={gender:e,genderProbability:t};return Object.assign({},n,r)}var WP=(function(){function n(e){var t=e===void 0?{}:e,r=t.minFaceSize,s=t.scaleFactor,o=t.maxNumScales,i=t.scoreThresholds,a=t.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=r||20,this._scaleFactor=s||.709,this._maxNumScales=o||10,this._scoreThresholds=i||[.6,.7,.7],this._scaleSteps=a,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(l){return typeof l!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(l){return typeof l!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(n.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),n})();function nae(n,e){function t(l,c){var u=yi(n(9*l),[3,3,l,1]),d=bs(n(l)),f=bs(n(l)),p=bs(n(l)),x=bs(n(l));return e.push({paramPath:c+"/filters"},{paramPath:c+"/batch_norm_scale"},{paramPath:c+"/batch_norm_offset"},{paramPath:c+"/batch_norm_mean"},{paramPath:c+"/batch_norm_variance"}),{filters:u,batch_norm_scale:d,batch_norm_offset:f,batch_norm_mean:p,batch_norm_variance:x}}function r(l,c,u,d,f){var p=yi(n(l*c*u*u),[u,u,l,c]),x=bs(n(c));return e.push({paramPath:d+"/filters"},{paramPath:d+"/"+(f?"batch_norm_offset":"bias")}),{filters:p,bias:x}}function s(l,c,u,d){var f=r(l,c,u,d,!0),p=f.filters,x=f.bias;return{filters:p,batch_norm_offset:x}}function o(l,c,u){var d=t(l,u+"/depthwise_conv"),f=s(l,c,1,u+"/pointwise_conv");return{depthwise_conv:d,pointwise_conv:f}}function i(){var l=s(3,32,3,"mobilenetv1/conv_0"),c=o(32,64,"mobilenetv1/conv_1"),u=o(64,128,"mobilenetv1/conv_2"),d=o(128,128,"mobilenetv1/conv_3"),f=o(128,256,"mobilenetv1/conv_4"),p=o(256,256,"mobilenetv1/conv_5"),x=o(256,512,"mobilenetv1/conv_6"),v=o(512,512,"mobilenetv1/conv_7"),y=o(512,512,"mobilenetv1/conv_8"),b=o(512,512,"mobilenetv1/conv_9"),w=o(512,512,"mobilenetv1/conv_10"),S=o(512,512,"mobilenetv1/conv_11"),k=o(512,1024,"mobilenetv1/conv_12"),N=o(1024,1024,"mobilenetv1/conv_13");return{conv_0:l,conv_1:c,conv_2:u,conv_3:d,conv_4:f,conv_5:p,conv_6:x,conv_7:v,conv_8:y,conv_9:b,conv_10:w,conv_11:S,conv_12:k,conv_13:N}}function a(){var l=s(1024,256,1,"prediction_layer/conv_0"),c=s(256,512,3,"prediction_layer/conv_1"),u=s(512,128,1,"prediction_layer/conv_2"),d=s(128,256,3,"prediction_layer/conv_3"),f=s(256,128,1,"prediction_layer/conv_4"),p=s(128,256,3,"prediction_layer/conv_5"),x=s(256,64,1,"prediction_layer/conv_6"),v=s(64,128,3,"prediction_layer/conv_7"),y=r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),b=r(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),w=r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),S=r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),k=r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),N=r(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),I=r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),T=r(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),F=r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),R=r(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),D=r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),A=r(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),P={box_encoding_predictor:y,class_predictor:b},B={box_encoding_predictor:w,class_predictor:S},L={box_encoding_predictor:k,class_predictor:N},W={box_encoding_predictor:I,class_predictor:T},H={box_encoding_predictor:F,class_predictor:R},G={box_encoding_predictor:D,class_predictor:A};return{conv_0:l,conv_1:c,conv_2:u,conv_3:d,conv_4:f,conv_5:p,conv_6:x,conv_7:v,box_predictor_0:P,box_predictor_1:B,box_predictor_2:L,box_predictor_3:W,box_predictor_4:H,box_predictor_5:G}}return{extractMobilenetV1Params:i,extractPredictionLayerParams:a}}function rae(n){var e=[],t=Jc(n),r=t.extractWeights,s=t.getRemainingWeights,o=nae(r,e),i=o.extractMobilenetV1Params,a=o.extractPredictionLayerParams,l=i(),c=a(),u=Zk(r(5118*4),[1,5118,4]),d={extra_dim:u};if(e.push({paramPath:"output_layer/extra_dim"}),s().length!==0)throw new Error("weights remaing after extract: "+s().length);return{params:{mobilenetv1:l,prediction_layer:c,output_layer:d},paramMappings:e}}function sae(n,e){var t=xd(n,e);function r(c,u,d){var f=t(c+"/Conv2d_"+u+"_pointwise/weights",4,d+"/filters"),p=t(c+"/Conv2d_"+u+"_pointwise/convolution_bn_offset",1,d+"/batch_norm_offset");return{filters:f,batch_norm_offset:p}}function s(c){var u="mobilenetv1/conv_"+c,d="MobilenetV1/Conv2d_"+c+"_depthwise",f=u+"/depthwise_conv",p=u+"/pointwise_conv",x=t(d+"/depthwise_weights",4,f+"/filters"),v=t(d+"/BatchNorm/gamma",1,f+"/batch_norm_scale"),y=t(d+"/BatchNorm/beta",1,f+"/batch_norm_offset"),b=t(d+"/BatchNorm/moving_mean",1,f+"/batch_norm_mean"),w=t(d+"/BatchNorm/moving_variance",1,f+"/batch_norm_variance");return{depthwise_conv:{filters:x,batch_norm_scale:v,batch_norm_offset:y,batch_norm_mean:b,batch_norm_variance:w},pointwise_conv:r("MobilenetV1",c,p)}}function o(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:s(1),conv_2:s(2),conv_3:s(3),conv_4:s(4),conv_5:s(5),conv_6:s(6),conv_7:s(7),conv_8:s(8),conv_9:s(9),conv_10:s(10),conv_11:s(11),conv_12:s(12),conv_13:s(13)}}function i(c,u){var d=t(c+"/weights",4,u+"/filters"),f=t(c+"/biases",1,u+"/bias");return{filters:d,bias:f}}function a(c){var u=i("Prediction/BoxPredictor_"+c+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+c+"/box_encoding_predictor"),d=i("Prediction/BoxPredictor_"+c+"/ClassPredictor","prediction_layer/box_predictor_"+c+"/class_predictor");return{box_encoding_predictor:u,class_predictor:d}}function l(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:a(0),box_predictor_1:a(1),box_predictor_2:a(2),box_predictor_3:a(3),box_predictor_4:a(4),box_predictor_5:a(5)}}return{extractMobilenetV1Params:o,extractPredictionLayerParams:l}}function oae(n){var e=[],t=sae(n,e),r=t.extractMobilenetV1Params,s=t.extractPredictionLayerParams,o=n["Output/extra_dim"];if(e.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!Ly(o))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+o);var i={mobilenetv1:r(),prediction_layer:s(),output_layer:{extra_dim:o}};return Zc(n,e),{params:i,paramMappings:e}}function Fl(n,e,t){return $t(function(){var r=Aa(n,e.filters,t,"same");return r=jn(r,e.batch_norm_offset),l6(r,0,6)})}var iae=.0010000000474974513;function aae(n,e,t){return $t(function(){var r=$y(n,e.filters,t,"same");return r=MF(r,e.batch_norm_mean,e.batch_norm_variance,e.batch_norm_offset,e.batch_norm_scale,iae),l6(r,0,6)})}function lae(n){return[2,4,6,12].some(function(e){return e===n})?[2,2]:[1,1]}function cae(n,e){return $t(function(){var t=null,r=Fl(n,e.conv_0,[2,2]),s=[e.conv_1,e.conv_2,e.conv_3,e.conv_4,e.conv_5,e.conv_6,e.conv_7,e.conv_8,e.conv_9,e.conv_10,e.conv_11,e.conv_12,e.conv_13];if(s.forEach(function(o,i){var a=i+1,l=lae(a);r=aae(r,o.depthwise_conv,l),r=Fl(r,o.pointwise_conv,[1,1]),a===11&&(t=r)}),t===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:t}})}function uae(n,e,t,r,s){var o=n.shape[0],i=Math.min(t,o),a=e.map(function(u,d){return{score:u,boxIndex:d}}).filter(function(u){return u.score>s}).sort(function(u,d){return d.score-u.score}),l=function(u){return u<=r?1:0},c=[];return a.forEach(function(u){if(!(c.length>=i)){for(var d=u.score,f=c.length-1;f>=0;--f){var p=dae(n,u.boxIndex,c[f]);if(p!==0&&(u.score*=l(p),u.score<=s))break}d===u.score&&c.push(u.boxIndex)}}),c}function dae(n,e,t){var r=n.arraySync(),s=Math.min(r[e][0],r[e][2]),o=Math.min(r[e][1],r[e][3]),i=Math.max(r[e][0],r[e][2]),a=Math.max(r[e][1],r[e][3]),l=Math.min(r[t][0],r[t][2]),c=Math.min(r[t][1],r[t][3]),u=Math.max(r[t][0],r[t][2]),d=Math.max(r[t][1],r[t][3]),f=(i-s)*(a-o),p=(u-l)*(d-c);if(f<=0||p<=0)return 0;var x=Math.max(s,l),v=Math.max(o,c),y=Math.min(i,u),b=Math.min(a,d),w=Math.max(y-x,0)*Math.max(b-v,0);return w/(f+p-w)}function fae(n){var e=js(id(n,[1,0])),t=[Vs(e[2],e[0]),Vs(e[3],e[1])],r=[jn(e[0],Ya(t[0],St(2))),jn(e[1],Ya(t[1],St(2)))];return{sizes:t,centers:r}}function hae(n,e){var t=fae(n),r=t.sizes,s=t.centers,o=js(id(e,[1,0])),i=Ya(jo(v5(Ya(o[2],St(5))),r[0]),St(2)),a=jn(jo(Ya(o[0],St(10)),r[0]),s[0]),l=Ya(jo(v5(Ya(o[3],St(5))),r[1]),St(2)),c=jn(jo(Ya(o[1],St(10)),r[1]),s[1]);return id(Qi([Vs(a,i),Vs(c,l),jn(a,i),jn(c,l)]),[1,0])}function pae(n,e,t){return $t(function(){var r=n.shape[0],s=hae(rl(ip(t.extra_dim,[r,1,1]),[-1,4]),rl(n,[-1,4]));s=rl(s,[r,s.shape[0]/r,4]);var o=$F(ic(e,[0,0,1],[-1,-1,-1])),i=ic(o,[0,0,0],[-1,-1,1]);i=rl(i,[r,i.shape[1]]);var a=js(s),l=js(i);return{boxes:a,scores:l}})}function Bh(n,e){return $t(function(){var t=n.shape[0],r=rl(ol(n,e.box_encoding_predictor),[t,-1,1,4]),s=rl(ol(n,e.class_predictor),[t,-1,3]);return{boxPredictionEncoding:r,classPrediction:s}})}function mae(n,e,t){return $t(function(){var r=Fl(n,t.conv_0,[1,1]),s=Fl(r,t.conv_1,[2,2]),o=Fl(s,t.conv_2,[1,1]),i=Fl(o,t.conv_3,[2,2]),a=Fl(i,t.conv_4,[1,1]),l=Fl(a,t.conv_5,[2,2]),c=Fl(l,t.conv_6,[1,1]),u=Fl(c,t.conv_7,[2,2]),d=Bh(e,t.box_predictor_0),f=Bh(n,t.box_predictor_1),p=Bh(s,t.box_predictor_2),x=Bh(i,t.box_predictor_3),v=Bh(l,t.box_predictor_4),y=Bh(u,t.box_predictor_5),b=Ls([d.boxPredictionEncoding,f.boxPredictionEncoding,p.boxPredictionEncoding,x.boxPredictionEncoding,v.boxPredictionEncoding,y.boxPredictionEncoding],1),w=Ls([d.classPrediction,f.classPrediction,p.classPrediction,x.classPrediction,v.classPrediction,y.classPrediction],1);return{boxPredictions:b,classPredictions:w}})}var l1=(function(){function n(e){var t=e===void 0?{}:e,r=t.minConfidence,s=t.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=r||.5,this._maxResults=s||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(n.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),n})(),UP=(function(n){yn(e,n);function e(){return n.call(this,"SsdMobilenetv1")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("SsdMobilenetv1 - load model before inference");return $t(function(){var s=t.toBatchTensor(512,!1).toFloat(),o=Vs(jo(s,St(.007843137718737125)),St(1)),i=cae(o,r.mobilenetv1),a=mae(i.out,i.conv11,r.prediction_layer),l=a.boxPredictions,c=a.classPredictions;return pae(l,c,r.output_layer)})},e.prototype.forward=function(t){return en(this,void 0,void 0,function(){var r;return tn(this,function(s){switch(s.label){case 0:return r=this.forwardInput,[4,no(t)];case 1:return[2,r.apply(this,[s.sent()])]}})})},e.prototype.locateFaces=function(t,r){return r===void 0&&(r={}),en(this,void 0,void 0,function(){var s,o,i,a,l,c,u,d,f,p,x,v,y,b,w,S,k,N,I,T,F;return tn(this,function(R){switch(R.label){case 0:return s=new l1(r),o=s.maxResults,i=s.minConfidence,[4,no(t)];case 1:for(a=R.sent(),l=this.forwardInput(a),c=l.boxes,u=l.scores,d=c[0],f=u[0],p=1;p<c.length;p++)c[p].dispose(),u[p].dispose();return y=(v=Array).from,[4,f.data()];case 2:return x=y.apply(v,[R.sent()]),b=.5,w=uae(d,x,o,b,i),S=a.getReshapedInputDimensions(0),k=a.inputSize,N=k/S.width,I=k/S.height,T=d.arraySync(),F=w.map(function(D){var A=[Math.max(0,T[D][0]),Math.min(1,T[D][2])].map(function(G){return G*I}),P=A[0],B=A[1],L=[Math.max(0,T[D][1]),Math.min(1,T[D][3])].map(function(G){return G*N}),W=L[0],H=L[1];return new xc(x[D],new N6(W,P,H-W,B-P),{height:a.getInputHeight(0),width:a.getInputWidth(0)})}),d.dispose(),f.dispose(),[2,F]}})})},e.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},e.prototype.extractParamsFromWeigthMap=function(t){return oae(t)},e.prototype.extractParams=function(t){return rae(t)},e})(Yc);(function(n){yn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e})(UP);var gae=.4,xae=[new dr(.738768,.874946),new dr(2.42204,2.65704),new dr(4.30971,7.04493),new dr(10.246,4.59428),new dr(12.6868,11.8741)],vae=[new dr(1.603231,2.094468),new dr(6.041143,7.080126),new dr(2.882459,3.518061),new dr(4.266906,5.178857),new dr(9.041765,10.66308)],yae=[117.001,114.697,97.404],bae="tiny_yolov2_model",wae="tiny_yolov2_separable_conv_model",fv=function(n){return typeof n=="number"};function Cae(n){if(!n)throw new Error("invalid config: "+n);if(typeof n.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+n.withSeparableConvs);if(!fv(n.iouThreshold)||n.iouThreshold<0||n.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+n.iouThreshold);if(!Array.isArray(n.classes)||!n.classes.length||!n.classes.every(function(e){return typeof e=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(n.classes));if(!Array.isArray(n.anchors)||!n.anchors.length||!n.anchors.map(function(e){return e||{}}).every(function(e){return fv(e.x)&&fv(e.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(n.anchors));if(n.meanRgb&&(!Array.isArray(n.meanRgb)||n.meanRgb.length!==3||!n.meanRgb.every(fv)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(n.meanRgb))}function O6(n){return $t(function(){var e=jo(n,St(.10000000149011612));return jn(Xr(Vs(n,e)),e)})}function Fu(n,e){return $t(function(){var t=Wf(n,[[0,0],[1,1],[1,1],[0,0]]);return t=Aa(t,e.conv.filters,[1,1],"valid"),t=Vs(t,e.bn.sub),t=jo(t,e.bn.truediv),t=jn(t,e.conv.bias),O6(t)})}function Pu(n,e){return $t(function(){var t=Wf(n,[[0,0],[1,1],[1,1],[0,0]]);return t=f6(t,e.depthwise_filter,e.pointwise_filter,[1,1],"valid"),t=jn(t,e.bias),O6(t)})}function kae(n,e){var t=Vy(n,e);function r(i,a){var l=bs(n(i)),c=bs(n(i));return e.push({paramPath:a+"/sub"},{paramPath:a+"/truediv"}),{sub:l,truediv:c}}function s(i,a,l){var c=t(i,a,3,l+"/conv"),u=r(a,l+"/bn");return{conv:c,bn:u}}var o=A6(n,e);return{extractConvParams:t,extractConvWithBatchNormParams:s,extractSeparableConvParams:o}}function Sae(n,e,t,r){var s=Jc(n),o=s.extractWeights,i=s.getRemainingWeights,a=[],l=kae(o,a),c=l.extractConvParams,u=l.extractConvWithBatchNormParams,d=l.extractSeparableConvParams,f;if(e.withSeparableConvs){var p=r[0],x=r[1],v=r[2],y=r[3],b=r[4],w=r[5],S=r[6],k=r[7],N=r[8],I=e.isFirstLayerConv2d?c(p,x,3,"conv0"):d(p,x,"conv0"),T=d(x,v,"conv1"),F=d(v,y,"conv2"),R=d(y,b,"conv3"),D=d(b,w,"conv4"),A=d(w,S,"conv5"),P=k?d(S,k,"conv6"):void 0,B=N?d(k,N,"conv7"):void 0,L=c(N||k||S,5*t,1,"conv8");f={conv0:I,conv1:T,conv2:F,conv3:R,conv4:D,conv5:A,conv6:P,conv7:B,conv8:L}}else{var p=r[0],x=r[1],v=r[2],y=r[3],b=r[4],w=r[5],S=r[6],k=r[7],N=r[8],I=u(p,x,"conv0"),T=u(x,v,"conv1"),F=u(v,y,"conv2"),R=u(y,b,"conv3"),D=u(b,w,"conv4"),A=u(w,S,"conv5"),P=u(S,k,"conv6"),B=u(k,N,"conv7"),L=c(N,5*t,1,"conv8");f={conv0:I,conv1:T,conv2:F,conv3:R,conv4:D,conv5:A,conv6:P,conv7:B,conv8:L}}if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{params:f,paramMappings:a}}function Nae(n,e){var t=xd(n,e);function r(a){var l=t(a+"/sub",1),c=t(a+"/truediv",1);return{sub:l,truediv:c}}function s(a){var l=t(a+"/filters",4),c=t(a+"/bias",1);return{filters:l,bias:c}}function o(a){var l=s(a+"/conv"),c=r(a+"/bn");return{conv:l,bn:c}}var i=$6(t);return{extractConvParams:s,extractConvWithBatchNormParams:o,extractSeparableConvParams:i}}function Eae(n,e){var t=[],r=Nae(n,t),s=r.extractConvParams,o=r.extractConvWithBatchNormParams,i=r.extractSeparableConvParams,a;if(e.withSeparableConvs){var l=e.filterSizes&&e.filterSizes.length||9;a={conv0:e.isFirstLayerConv2d?s("conv0"):i("conv0"),conv1:i("conv1"),conv2:i("conv2"),conv3:i("conv3"),conv4:i("conv4"),conv5:i("conv5"),conv6:l>7?i("conv6"):void 0,conv7:l>8?i("conv7"):void 0,conv8:s("conv8")}}else a={conv0:o("conv0"),conv1:o("conv1"),conv2:o("conv2"),conv3:o("conv3"),conv4:o("conv4"),conv5:o("conv5"),conv6:o("conv6"),conv7:o("conv7"),conv8:s("conv8")};return Zc(n,t),{params:a,paramMappings:t}}var WT;(function(n){n[n.XS=224]="XS",n[n.SM=320]="SM",n[n.MD=416]="MD",n[n.LG=608]="LG"})(WT||(WT={}));var M6=(function(){function n(e){var t=e===void 0?{}:e,r=t.inputSize,s=t.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=r||416,this._scoreThreshold=s||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(n.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),n})(),HP=(function(n){yn(e,n);function e(t){var r=n.call(this,"TinyYolov2")||this;return Cae(t),r._config=t,r}return Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),e.prototype.runTinyYolov2=function(t,r){var s=Fu(t,r.conv0);return s=Js(s,[2,2],[2,2],"same"),s=Fu(s,r.conv1),s=Js(s,[2,2],[2,2],"same"),s=Fu(s,r.conv2),s=Js(s,[2,2],[2,2],"same"),s=Fu(s,r.conv3),s=Js(s,[2,2],[2,2],"same"),s=Fu(s,r.conv4),s=Js(s,[2,2],[2,2],"same"),s=Fu(s,r.conv5),s=Js(s,[2,2],[1,1],"same"),s=Fu(s,r.conv6),s=Fu(s,r.conv7),ol(s,r.conv8,"valid",!1)},e.prototype.runMobilenet=function(t,r){var s=this.config.isFirstLayerConv2d?O6(ol(t,r.conv0,"valid",!1)):Pu(t,r.conv0);return s=Js(s,[2,2],[2,2],"same"),s=Pu(s,r.conv1),s=Js(s,[2,2],[2,2],"same"),s=Pu(s,r.conv2),s=Js(s,[2,2],[2,2],"same"),s=Pu(s,r.conv3),s=Js(s,[2,2],[2,2],"same"),s=Pu(s,r.conv4),s=Js(s,[2,2],[2,2],"same"),s=Pu(s,r.conv5),s=Js(s,[2,2],[1,1],"same"),s=r.conv6?Pu(s,r.conv6):s,s=r.conv7?Pu(s,r.conv7):s,ol(s,r.conv8,"valid",!1)},e.prototype.forwardInput=function(t,r){var s=this,o=this.params;if(!o)throw new Error("TinyYolov2 - load model before inference");return $t(function(){var i=t.toBatchTensor(r,!1).toFloat();return i=s.config.meanRgb?a1(i,s.config.meanRgb):i,i=i.div(St(256)),s.config.withSeparableConvs?s.runMobilenet(i,o):s.runTinyYolov2(i,o)})},e.prototype.forward=function(t,r){return en(this,void 0,void 0,function(){var s;return tn(this,function(o){switch(o.label){case 0:return s=this.forwardInput,[4,no(t)];case 1:return[4,s.apply(this,[o.sent(),r])];case 2:return[2,o.sent()]}})})},e.prototype.detect=function(t,r){return r===void 0&&(r={}),en(this,void 0,void 0,function(){var s,o,i,a,l,c,u,d,f,p,x,v,y,b,w=this;return tn(this,function(S){switch(S.label){case 0:return s=new M6(r),o=s.inputSize,i=s.scoreThreshold,[4,no(t)];case 1:return a=S.sent(),[4,this.forwardInput(a,o)];case 2:return l=S.sent(),c=$t(function(){return js(l)[0].expandDims()}),u={width:a.getInputWidth(0),height:a.getInputHeight(0)},[4,this.extractBoxes(c,a.getReshapedInputDimensions(0),i)];case 3:return d=S.sent(),l.dispose(),c.dispose(),f=d.map(function(k){return k.box}),p=d.map(function(k){return k.score}),x=d.map(function(k){return k.classScore}),v=d.map(function(k){return w.config.classes[k.label]}),y=$g(f.map(function(k){return k.rescale(o)}),p,this.config.iouThreshold,!0),b=y.map(function(k){return new xP(p[k],x[k],v[k],f[k],u)}),[2,b]}})})},e.prototype.getDefaultModelName=function(){return""},e.prototype.extractParamsFromWeigthMap=function(t){return Eae(t,this.config)},e.prototype.extractParams=function(t){var r=this.config.filterSizes||e.DEFAULT_FILTER_SIZES,s=r?r.length:void 0;if(s!==7&&s!==8&&s!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+s+" filterSizes in config");return Sae(t,this.config,this.boxEncodingSize,r)},e.prototype.extractBoxes=function(t,r,s){return en(this,void 0,void 0,function(){var o,i,a,l,c,u,d,f,p,x,v,y,b,w,S,k,N,I,T,F,R,D,A,P,B,L,W,H,G,M=this;return tn(this,function(j){switch(j.label){case 0:return o=r.width,i=r.height,a=Math.max(o,i),l=a/o,c=a/i,u=t.shape[1],d=this.config.anchors.length,f=$t(function(){var z=t.reshape([u,u,d,M.boxEncodingSize]),V=z.slice([0,0,0,0],[u,u,d,4]),K=z.slice([0,0,0,4],[u,u,d,1]),J=M.withClassScores?Kc(z.slice([0,0,0,5],[u,u,d,M.config.classes.length]),3):St(0);return[V,K,J]}),p=f[0],x=f[1],v=f[2],y=[],[4,x.array()];case 1:return b=j.sent(),[4,p.array()];case 2:w=j.sent(),S=0,j.label=3;case 3:if(!(S<u))return[3,12];k=0,j.label=4;case 4:if(!(k<u))return[3,11];N=0,j.label=5;case 5:return N<d?(I=n4(b[S][k][N][0]),!s||I>s?(T=(k+n4(w[S][k][N][0]))/u*l,F=(S+n4(w[S][k][N][1]))/u*c,R=Math.exp(w[S][k][N][2])*this.config.anchors[N].x/u*l,D=Math.exp(w[S][k][N][3])*this.config.anchors[N].y/u*c,A=T-R/2,P=F-D/2,B={row:S,col:k,anchor:N},this.withClassScores?[4,this.extractPredictedClass(v,B)]:[3,7]):[3,9]):[3,10];case 6:return G=j.sent(),[3,8];case 7:G={classScore:1,label:0},j.label=8;case 8:L=G,W=L.classScore,H=L.label,y.push(Fo({box:new jy(A,P,A+R,P+D),score:I,classScore:I*W,label:H},B)),j.label=9;case 9:return N++,[3,5];case 10:return k++,[3,4];case 11:return S++,[3,3];case 12:return p.dispose(),x.dispose(),v.dispose(),[2,y]}})})},e.prototype.extractPredictedClass=function(t,r){return en(this,void 0,void 0,function(){var s,o,i,a;return tn(this,function(l){switch(l.label){case 0:return s=r.row,o=r.col,i=r.anchor,[4,t.array()];case 1:return a=l.sent(),[2,Array(this.config.classes.length).fill(0).map(function(c,u){return a[s][o][i][u]}).map(function(c,u){return{classScore:c,label:u}}).reduce(function(c,u){return c.classScore>u.classScore?c:u})]}})})},e.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],e})(Yc),Iae=(function(n){yn(e,n);function e(t){t===void 0&&(t=!0);var r=this,s=Object.assign({},{withSeparableConvs:t,iouThreshold:gae,classes:["face"]},t?{anchors:vae,meanRgb:yae}:{anchors:xae,withClassScores:!0});return r=n.call(this,s)||this,r}return Object.defineProperty(e.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,r){return en(this,void 0,void 0,function(){var s;return tn(this,function(o){switch(o.label){case 0:return[4,this.detect(t,r)];case 1:return s=o.sent(),[2,s.map(function(i){return new xc(i.score,i.relativeBox,{width:i.imageWidth,height:i.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return this.withSeparableConvs?wae:bae},e.prototype.extractParamsFromWeigthMap=function(t){return n.prototype.extractParamsFromWeigthMap.call(this,t)},e})(HP),tg=(function(n){yn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t._name="TinyFaceDetectorOptions",t}return e})(M6),c1=(function(){function n(){}return n.prototype.then=function(e){return en(this,void 0,void 0,function(){var t;return tn(this,function(r){switch(r.label){case 0:return t=e,[4,this.run()];case 1:return[2,t.apply(void 0,[r.sent()])]}})})},n.prototype.run=function(){return en(this,void 0,void 0,function(){return tn(this,function(e){throw new Error("ComposableTask - run is not implemented")})})},n})();function zy(n,e,t,r,s){return s===void 0&&(s=function(o){var i=o.alignedRect;return i}),en(this,void 0,void 0,function(){var o,i,a,l,c;return tn(this,function(u){switch(u.label){case 0:return o=n.map(function(d){return Pie(d)?s(d):d.detection}),a=r,a?[3,5]:e instanceof Kr?[4,R6(e,o)]:[3,2];case 1:return l=u.sent(),[3,4];case 2:return[4,_6(e,o)];case 3:l=u.sent(),u.label=4;case 4:a=l,u.label=5;case 5:return i=a,[4,t(i)];case 6:return c=u.sent(),i.forEach(function(d){return d instanceof Kr&&d.dispose()}),[2,c]}})})}function L6(n,e,t,r,s){return en(this,void 0,void 0,function(){var o=this;return tn(this,function(i){return[2,zy([n],e,function(a){return en(o,void 0,void 0,function(){return tn(this,function(l){return[2,t(a[0])]})})},r,s)]})})}function Tae(n){return $t(function(){return Qi(js(n,3).reverse(),3)})}var hv=2,A2=12;function _ae(n,e){var t=Vy(n,e),r=D6(n,e);function s(c,u){var d=bs(n(c));return e.push({paramPath:u}),d}function o(c,u,d){d===void 0&&(d=!1);var f=t(c[0],c[1],3,u+"/conv1"),p=s(c[1],u+"/prelu1_alpha"),x=t(c[1],c[2],3,u+"/conv2"),v=s(c[2],u+"/prelu2_alpha"),y=t(c[2],c[3],d?2:3,u+"/conv3"),b=s(c[3],u+"/prelu3_alpha");return{conv1:f,prelu1_alpha:p,conv2:x,prelu2_alpha:v,conv3:y,prelu3_alpha:b}}function i(){var c=o([3,10,16,32],"pnet"),u=t(32,2,1,"pnet/conv4_1"),d=t(32,4,1,"pnet/conv4_2");return Fo(Fo({},c),{conv4_1:u,conv4_2:d})}function a(){var c=o([3,28,48,64],"rnet",!0),u=r(576,128,"rnet/fc1"),d=s(128,"rnet/prelu4_alpha"),f=r(128,2,"rnet/fc2_1"),p=r(128,4,"rnet/fc2_2");return Fo(Fo({},c),{fc1:u,prelu4_alpha:d,fc2_1:f,fc2_2:p})}function l(){var c=o([3,32,64,64],"onet"),u=t(64,128,2,"onet/conv4"),d=s(128,"onet/prelu4_alpha"),f=r(1152,256,"onet/fc1"),p=s(256,"onet/prelu5_alpha"),x=r(256,2,"onet/fc2_1"),v=r(256,4,"onet/fc2_2"),y=r(256,10,"onet/fc2_3");return Fo(Fo({},c),{conv4:u,prelu4_alpha:d,fc1:f,prelu5_alpha:p,fc2_1:x,fc2_2:v,fc2_3:y})}return{extractPNetParams:i,extractRNetParams:a,extractONetParams:l}}function Rae(n){var e=Jc(n),t=e.extractWeights,r=e.getRemainingWeights,s=[],o=_ae(t,s),i=o.extractPNetParams,a=o.extractRNetParams,l=o.extractONetParams,c=i(),u=a(),d=l();if(r().length!==0)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:c,rnet:u,onet:d},paramMappings:s}}function Dae(n,e){var t=xd(n,e);function r(u){var d=t(u+"/weights",4,u+"/filters"),f=t(u+"/bias",1);return{filters:d,bias:f}}function s(u){var d=t(u+"/weights",2),f=t(u+"/bias",1);return{weights:d,bias:f}}function o(u){return t(u,1)}function i(u){var d=r(u+"/conv1"),f=o(u+"/prelu1_alpha"),p=r(u+"/conv2"),x=o(u+"/prelu2_alpha"),v=r(u+"/conv3"),y=o(u+"/prelu3_alpha");return{conv1:d,prelu1_alpha:f,conv2:p,prelu2_alpha:x,conv3:v,prelu3_alpha:y}}function a(){var u=i("pnet"),d=r("pnet/conv4_1"),f=r("pnet/conv4_2");return Fo(Fo({},u),{conv4_1:d,conv4_2:f})}function l(){var u=i("rnet"),d=s("rnet/fc1"),f=o("rnet/prelu4_alpha"),p=s("rnet/fc2_1"),x=s("rnet/fc2_2");return Fo(Fo({},u),{fc1:d,prelu4_alpha:f,fc2_1:p,fc2_2:x})}function c(){var u=i("onet"),d=r("onet/conv4"),f=o("onet/prelu4_alpha"),p=s("onet/fc1"),x=o("onet/prelu5_alpha"),v=s("onet/fc2_1"),y=s("onet/fc2_2"),b=s("onet/fc2_3");return Fo(Fo({},u),{conv4:d,prelu4_alpha:f,fc1:p,prelu5_alpha:x,fc2_1:v,fc2_2:y,fc2_3:b})}return{extractPNetParams:a,extractRNetParams:l,extractONetParams:c}}function Aae(n){var e=[],t=Dae(n,e),r=t.extractPNetParams,s=t.extractRNetParams,o=t.extractONetParams,i=r(),a=s(),l=o();return Zc(n,e),{params:{pnet:i,rnet:a,onet:l},paramMappings:e}}function E5(n,e){var t=e[0],r=e[1];return{height:Math.floor(t*n),width:Math.floor(r*n)}}function $ae(n,e,t){for(var r=t[0],s=t[1],o=A2/n,i=[],a=Math.min(r,s)*o,l=0;a>=12;)i.push(o*Math.pow(e,l)),a=a*e,l+=1;return i}var j6=(function(n){yn(e,n);function e(t,r,s,o){return n.call(this,{left:t,top:r,right:s,bottom:o},!0)||this}return e})(ad);function GP(n){return $t(function(){return jo(Vs(n,St(127.5)),St(.0078125))})}function fp(n,e){return $t(function(){return jn(Xr(n),jo(e,N2(Xr(N2(n)))))})}function B6(n,e,t){return t===void 0&&(t=!1),$t(function(){var r=ol(n,e.conv1,"valid");return r=fp(r,e.prelu1_alpha),r=Js(r,t?[2,2]:[3,3],[2,2],"same"),r=ol(r,e.conv2,"valid"),r=fp(r,e.prelu2_alpha),r=t?r:Js(r,[3,3],[2,2],"valid"),r=ol(r,e.conv3,"valid"),r=fp(r,e.prelu3_alpha),r})}function Fae(n,e){return $t(function(){var t=B6(n,e,!0),r=ol(t,e.conv4_1,"valid"),s=ka(Py(r,3),3),o=Kc(Vs(r,s),3),i=ol(t,e.conv4_2,"valid");return{prob:o,regions:i}})}function Pae(n,e){return $t(function(){var t=E5(e,n.shape.slice(1)),r=t.height,s=t.width,o=x6.resizeBilinear(n,[r,s]),i=GP(o);return id(i,[0,2,1,3])})}function Oae(n,e,t,r){for(var s=[],o=n.arraySync(),i=0;i<n.shape[0];i++)for(var a=0;a<n.shape[1];a++)o[i][a]>=r&&s.push(new dr(a,i));var l=s.map(function(c){var u=new jy(Math.round((c.y*hv+1)/t),Math.round((c.x*hv+1)/t),Math.round((c.y*hv+A2)/t),Math.round((c.x*hv+A2)/t)),d=o[c.y][c.x],f=e.arraySync(),p=new j6(f[c.y][c.x][0],f[c.y][c.x][1],f[c.y][c.x][2],f[c.y][c.x][3]);return{cell:u,score:d,region:p}});return l}function Mae(n,e,t,r,s){s.stage1=[];var o=e.map(function(f){return $t(function(){var p={scale:f},x=Pae(n,f),v=Date.now(),y=Fae(x,r),b=y.prob,w=y.regions;p.pnet=Date.now()-v;var S=js(js(b,3)[1])[0],k=js(w)[0];return{scoresTensor:S,regionsTensor:k,scale:f,statsForScale:p}})}),i=o.map(function(f){var p=f.scoresTensor,x=f.regionsTensor,v=f.scale,y=f.statsForScale,b=Oae(p,x,v,t);if(p.dispose(),x.dispose(),!b.length)return s.stage1.push(y),[];var w=Date.now(),S=$g(b.map(function(k){return k.cell}),b.map(function(k){return k.score}),.5);return y.nms=Date.now()-w,y.numBoxes=S.length,s.stage1.push(y),S.map(function(k){return b[k]})}),a=i.reduce(function(f,p){return f.concat(p)},[]),l=[],c=[];if(a.length>0){var u=Date.now(),d=$g(a.map(function(f){return f.cell}),a.map(function(f){return f.score}),.7);s.stage1_nms=Date.now()-u,c=d.map(function(f){return a[f].score}),l=d.map(function(f){return a[f]}).map(function(f){var p=f.cell,x=f.region;return new jy(p.left+x.left*p.width,p.top+x.top*p.height,p.right+x.right*p.width,p.bottom+x.bottom*p.height).toSquare().round()})}return{boxes:l,scores:c}}function qP(n,e,t){var r=t.width,s=t.height;return en(this,void 0,void 0,function(){var o,i,a,l=this;return tn(this,function(c){switch(c.label){case 0:return o=Sf(n),[4,Promise.all(e.map(function(u){return en(l,void 0,void 0,function(){var d,f,p,x,v,y,b,w;return tn(this,function(S){return d=u.padAtBorders(n.height,n.width),f=d.y,p=d.ey,x=d.x,v=d.ex,y=x-1,b=f-1,w=o.getImageData(y,b,v-y,p-b),[2,zo.isNodejs()?T6(w):createImageBitmap(w)]})})}))];case 1:return i=c.sent(),a=[],i.forEach(function(u){var d=By({width:r,height:s}),f=Sf(d);f.drawImage(u,0,0,r,s);for(var p=f.getImageData(0,0,r,s).data,x=[],v=0;v<p.length;v+=4)x.push(p[v+2]),x.push(p[v+1]),x.push(p[v]);a.push(x)}),[2,a.map(function(u){var d=$t(function(){var f=id(yi(u,[1,r,s,3]),[0,2,1,3]).toFloat();return GP(f)});return d})]}})})}function Lae(n,e){return $t(function(){var t=B6(n,e),r=rl(t,[t.shape[0],e.fc1.weights.shape[0]]),s=Gl(r,e.fc1),o=fp(s,e.prelu4_alpha),i=Gl(o,e.fc2_1),a=ka(Py(i,1),1),l=Kc(Vs(i,a),1),c=Gl(o,e.fc2_2),u=js(l,1)[1];return{scores:u,regions:c}})}function jae(n,e,t,r,s){return en(this,void 0,void 0,function(){var o,i,a,l,c,u,d,f,p,x,v,y,b,w;return tn(this,function(S){switch(S.label){case 0:return o=Date.now(),[4,qP(n,e,{width:24,height:24})];case 1:return i=S.sent(),s.stage2_extractImagePatches=Date.now()-o,o=Date.now(),a=i.map(function(k){var N=Lae(k,r);return k.dispose(),N}),s.stage2_rnet=Date.now()-o,l=a.length>1?Ls(a.map(function(k){return k.scores})):a[0].scores,d=(u=Array).from,[4,l.data()];case 2:return c=d.apply(u,[S.sent()]),l.dispose(),f=c.map(function(k,N){return{score:k,idx:N}}).filter(function(k){return k.score>t}).map(function(k){var N=k.idx;return N}),p=f.map(function(k){return e[k]}),x=f.map(function(k){return c[k]}),v=[],y=[],p.length>0&&(o=Date.now(),b=$g(p,x,.7),s.stage2_nms=Date.now()-o,w=b.map(function(k){var N=a[f[k]].regions.arraySync();return new j6(N[0][0],N[0][1],N[0][2],N[0][3])}),y=b.map(function(k){return x[k]}),v=b.map(function(k,N){return p[k].calibrate(w[N])})),a.forEach(function(k){k.regions.dispose(),k.scores.dispose()}),[2,{boxes:v,scores:y}]}})})}function Bae(n,e){return $t(function(){var t=B6(n,e);t=Js(t,[2,2],[2,2],"same"),t=ol(t,e.conv4,"valid"),t=fp(t,e.prelu4_alpha);var r=rl(t,[t.shape[0],e.fc1.weights.shape[0]]),s=Gl(r,e.fc1),o=fp(s,e.prelu5_alpha),i=Gl(o,e.fc2_1),a=ka(Py(i,1),1),l=Kc(Vs(i,a),1),c=Gl(o,e.fc2_2),u=Gl(o,e.fc2_3),d=js(l,1)[1];return{scores:d,regions:c,points:u}})}function Vae(n,e,t,r,s){return en(this,void 0,void 0,function(){var o,i,a,l,c,u,d,f,p,x,v,y,b,w,S;return tn(this,function(k){switch(k.label){case 0:return o=Date.now(),[4,qP(n,e,{width:48,height:48})];case 1:return i=k.sent(),s.stage3_extractImagePatches=Date.now()-o,o=Date.now(),a=i.map(function(N){var I=Bae(N,r);return N.dispose(),I}),s.stage3_onet=Date.now()-o,l=a.length>1?Ls(a.map(function(N){return N.scores})):a[0].scores,d=(u=Array).from,[4,l.data()];case 2:return c=d.apply(u,[k.sent()]),l.dispose(),f=c.map(function(N,I){return{score:N,idx:I}}).filter(function(N){return N.score>t}).map(function(N){var I=N.idx;return I}),p=f.map(function(N){var I=a[N].regions.arraySync();return new j6(I[0][0],I[0][1],I[0][2],I[0][3])}),x=f.map(function(N,I){return e[N].calibrate(p[I])}),v=f.map(function(N){return c[N]}),y=[],b=[],w=[],x.length>0&&(o=Date.now(),S=$g(x,v,.7,!1),s.stage3_nms=Date.now()-o,y=S.map(function(N){return x[N]}),b=S.map(function(N){return v[N]}),w=S.map(function(N,I){return Array(5).fill(0).map(function(T,F){var R=a[N].points.arraySync();return new dr(R[0][F]*(y[I].width+1)+y[I].left,R[0][F+5]*(y[I].height+1)+y[I].top)})})),a.forEach(function(N){N.regions.dispose(),N.scores.dispose(),N.points.dispose()}),[2,{boxes:y,scores:b,points:w}]}})})}var zae=(function(n){yn(e,n);function e(){return n.call(this,"Mtcnn")||this}return e.prototype.load=function(t){return en(this,void 0,void 0,function(){return tn(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,n.prototype.load.call(this,t)]})})},e.prototype.loadFromDisk=function(t){return en(this,void 0,void 0,function(){return tn(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,n.prototype.loadFromDisk.call(this,t)]})})},e.prototype.forwardInput=function(t,r){return r===void 0&&(r={}),en(this,void 0,void 0,function(){var s,o,i,a,l,c,u,d,f,p,x,v,y,b,w,S,k,N,I,T,F;return tn(this,function(R){switch(R.label){case 0:if(s=this.params,!s)throw new Error("Mtcnn - load model before inference");if(o=t.canvases[0],!o)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return i={},a=Date.now(),l=$t(function(){return Tae(ka(k6.fromPixels(o)).toFloat())}),c=function(D){return l.dispose(),i.total=Date.now()-a,D},u=l.shape.slice(1),d=u[0],f=u[1],p=new WP(r),x=p.minFaceSize,v=p.scaleFactor,y=p.maxNumScales,b=p.scoreThresholds,w=p.scaleSteps,S=(w||$ae(x,v,[d,f])).filter(function(D){var A=E5(D,[d,f]);return Math.min(A.width,A.height)>A2}).slice(0,y),i.scales=S,i.pyramid=S.map(function(D){return E5(D,[d,f])}),k=Date.now(),[4,Mae(l,S,b[0],s.pnet,i)];case 1:return N=R.sent(),i.total_stage1=Date.now()-k,N.boxes.length?(i.stage2_numInputBoxes=N.boxes.length,k=Date.now(),[4,jae(o,N.boxes,b[1],s.rnet,i)]):[2,c({results:[],stats:i})];case 2:return I=R.sent(),i.total_stage2=Date.now()-k,I.boxes.length?(i.stage3_numInputBoxes=I.boxes.length,k=Date.now(),[4,Vae(o,I.boxes,b[2],s.onet,i)]):[2,c({results:[],stats:i})];case 3:return T=R.sent(),i.total_stage3=Date.now()-k,F=T.boxes.map(function(D,A){return F6(E6({},new xc(T.scores[A],new N6(D.left/f,D.top/d,D.width/f,D.height/d),{height:d,width:f})),new vie(T.points[A].map(function(P){return P.sub(new dr(D.left,D.top)).div(new dr(D.width,D.height))}),{width:D.width,height:D.height}))}),[2,c({results:F,stats:i})]}})})},e.prototype.forward=function(t,r){return r===void 0&&(r={}),en(this,void 0,void 0,function(){var s;return tn(this,function(o){switch(o.label){case 0:return s=this.forwardInput,[4,no(t)];case 1:return[4,s.apply(this,[o.sent(),r])];case 2:return[2,o.sent().results]}})})},e.prototype.forwardWithStats=function(t,r){return r===void 0&&(r={}),en(this,void 0,void 0,function(){var s;return tn(this,function(o){switch(o.label){case 0:return s=this.forwardInput,[4,no(t)];case 1:return[2,s.apply(this,[o.sent(),r])]}})})},e.prototype.getDefaultModelName=function(){return"mtcnn_model"},e.prototype.extractParamsFromWeigthMap=function(t){return Aae(t)},e.prototype.extractParams=function(t){return Rae(t)},e})(Yc),Wae=.4,Uae=[new dr(1.603231,2.094468),new dr(6.041143,7.080126),new dr(2.882459,3.518061),new dr(4.266906,5.178857),new dr(9.041765,10.66308)],Hae=[117.001,114.697,97.404],Gae=(function(n){yn(e,n);function e(){var t=this,r={withSeparableConvs:!0,iouThreshold:Wae,classes:["face"],anchors:Uae,meanRgb:Hae,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return t=n.call(this,r)||this,t}return Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,r){return en(this,void 0,void 0,function(){var s;return tn(this,function(o){switch(o.label){case 0:return[4,this.detect(t,r)];case 1:return s=o.sent(),[2,s.map(function(i){return new xc(i.score,i.relativeBox,{width:i.imageWidth,height:i.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},e.prototype.extractParamsFromWeigthMap=function(t){return n.prototype.extractParamsFromWeigthMap.call(this,t)},e})(HP),Bo={ssdMobilenetv1:new UP,tinyFaceDetector:new Gae,tinyYolov2:new Iae,mtcnn:new zae,faceLandmark68Net:new MP,faceLandmark68TinyNet:new Kie,faceRecognitionNet:new tae,faceExpressionNet:new Fie,ageGenderNet:new Uie},KP=(function(n){yn(e,n);function e(t,r,s){var o=n.call(this)||this;return o.parentTask=t,o.input=r,o.extractedFaces=s,o}return e})(c1),V6=(function(n){yn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return en(this,void 0,void 0,function(){var t,r,s=this;return tn(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return t=o.sent(),[4,zy(t,this.input,function(i){return en(s,void 0,void 0,function(){return tn(this,function(a){switch(a.label){case 0:return[4,Promise.all(i.map(function(l){return Bo.faceExpressionNet.predictExpressions(l)}))];case 1:return[2,a.sent()]}})})},this.extractedFaces)];case 2:return r=o.sent(),[2,t.map(function(i,a){return FP(i,r[a])})]}})})},e.prototype.withAgeAndGender=function(){return new H6(this,this.input)},e})(KP),z6=(function(n){yn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return en(this,void 0,void 0,function(){var t,r;return tn(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return t=s.sent(),t?[4,L6(t,this.input,function(o){return Bo.faceExpressionNet.predictExpressions(o)},this.extractedFaces)]:[2];case 2:return r=s.sent(),[2,FP(t,r)]}})})},e.prototype.withAgeAndGender=function(){return new G6(this,this.input)},e})(KP),W6=(function(n){yn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withAgeAndGender=function(){return new q6(this,this.input)},e.prototype.withFaceDescriptors=function(){return new X6(this,this.input)},e})(V6),U6=(function(n){yn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withAgeAndGender=function(){return new K6(this,this.input)},e.prototype.withFaceDescriptor=function(){return new Y6(this,this.input)},e})(z6),XP=(function(n){yn(e,n);function e(t,r,s){var o=n.call(this)||this;return o.parentTask=t,o.input=r,o.extractedFaces=s,o}return e})(c1),H6=(function(n){yn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return en(this,void 0,void 0,function(){var t,r,s=this;return tn(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return t=o.sent(),[4,zy(t,this.input,function(i){return en(s,void 0,void 0,function(){return tn(this,function(a){switch(a.label){case 0:return[4,Promise.all(i.map(function(l){return Bo.ageGenderNet.predictAgeAndGender(l)}))];case 1:return[2,a.sent()]}})})},this.extractedFaces)];case 2:return r=o.sent(),[2,t.map(function(i,a){var l=r[a],c=l.age,u=l.gender,d=l.genderProbability;return VP(zP(i,u,d),c)})]}})})},e.prototype.withFaceExpressions=function(){return new V6(this,this.input)},e})(XP),G6=(function(n){yn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return en(this,void 0,void 0,function(){var t,r,s,o,i;return tn(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return t=a.sent(),t?[4,L6(t,this.input,function(l){return Bo.ageGenderNet.predictAgeAndGender(l)},this.extractedFaces)]:[2];case 2:return r=a.sent(),s=r.age,o=r.gender,i=r.genderProbability,[2,VP(zP(t,o,i),s)]}})})},e.prototype.withFaceExpressions=function(){return new z6(this,this.input)},e})(XP),q6=(function(n){yn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withFaceExpressions=function(){return new W6(this,this.input)},e.prototype.withFaceDescriptors=function(){return new X6(this,this.input)},e})(H6),K6=(function(n){yn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withFaceExpressions=function(){return new U6(this,this.input)},e.prototype.withFaceDescriptor=function(){return new Y6(this,this.input)},e})(G6),YP=(function(n){yn(e,n);function e(t,r){var s=n.call(this)||this;return s.parentTask=t,s.input=r,s}return e})(c1),X6=(function(n){yn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return en(this,void 0,void 0,function(){var t,r;return tn(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return t=s.sent(),[4,zy(t,this.input,function(o){return Promise.all(o.map(function(i){return Bo.faceRecognitionNet.computeFaceDescriptor(i)}))},null,function(o){return o.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return r=s.sent(),[2,r.map(function(o,i){return BP(t[i],o)})]}})})},e.prototype.withFaceExpressions=function(){return new W6(this,this.input)},e.prototype.withAgeAndGender=function(){return new q6(this,this.input)},e})(YP),Y6=(function(n){yn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return en(this,void 0,void 0,function(){var t,r;return tn(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return t=s.sent(),t?[4,L6(t,this.input,function(o){return Bo.faceRecognitionNet.computeFaceDescriptor(o)},null,function(o){return o.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return r=s.sent(),[2,BP(t,r)]}})})},e.prototype.withFaceExpressions=function(){return new U6(this,this.input)},e.prototype.withAgeAndGender=function(){return new K6(this,this.input)},e})(YP),ZP=(function(n){yn(e,n);function e(t,r,s){var o=n.call(this)||this;return o.parentTask=t,o.input=r,o.useTinyLandmarkNet=s,o}return Object.defineProperty(e.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?Bo.faceLandmark68TinyNet:Bo.faceLandmark68Net},enumerable:!0,configurable:!0}),e})(c1),qae=(function(n){yn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return en(this,void 0,void 0,function(){var t,r,s,o,i,a=this;return tn(this,function(l){switch(l.label){case 0:return[4,this.parentTask];case 1:return t=l.sent(),r=t.map(function(c){return c.detection}),this.input instanceof Kr?[4,R6(this.input,r)]:[3,3];case 2:return o=l.sent(),[3,5];case 3:return[4,_6(this.input,r)];case 4:o=l.sent(),l.label=5;case 5:return s=o,[4,Promise.all(s.map(function(c){return a.landmarkNet.detectLandmarks(c)}))];case 6:return i=l.sent(),s.forEach(function(c){return c instanceof Kr&&c.dispose()}),[2,t.map(function(c,u){return F6(c,i[u])})]}})})},e.prototype.withFaceExpressions=function(){return new W6(this,this.input)},e.prototype.withAgeAndGender=function(){return new q6(this,this.input)},e.prototype.withFaceDescriptors=function(){return new X6(this,this.input)},e})(ZP),Kae=(function(n){yn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return en(this,void 0,void 0,function(){var t,r,s,o,i;return tn(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return t=a.sent(),t?(r=t.detection,this.input instanceof Kr?[4,R6(this.input,[r])]:[3,3]):[2];case 2:return o=a.sent(),[3,5];case 3:return[4,_6(this.input,[r])];case 4:o=a.sent(),a.label=5;case 5:return s=o,[4,this.landmarkNet.detectLandmarks(s[0])];case 6:return i=a.sent(),s.forEach(function(l){return l instanceof Kr&&l.dispose()}),[2,F6(t,i)]}})})},e.prototype.withFaceExpressions=function(){return new U6(this,this.input)},e.prototype.withAgeAndGender=function(){return new K6(this,this.input)},e.prototype.withFaceDescriptor=function(){return new Y6(this,this.input)},e})(ZP),JP=(function(n){yn(e,n);function e(t,r){r===void 0&&(r=new l1);var s=n.call(this)||this;return s.input=t,s.options=r,s}return e})(c1),QP=(function(n){yn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return en(this,void 0,void 0,function(){var t,r,s,o;return tn(this,function(i){switch(i.label){case 0:return t=this,r=t.input,s=t.options,s instanceof WP?[4,Bo.mtcnn.forward(r,s)]:[3,2];case 1:return[2,i.sent().map(function(a){return a.detection})];case 2:if(o=s instanceof tg?function(a){return Bo.tinyFaceDetector.locateFaces(a,s)}:s instanceof l1?function(a){return Bo.ssdMobilenetv1.locateFaces(a,s)}:s instanceof M6?function(a){return Bo.tinyYolov2.locateFaces(a,s)}:null,!o)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,o(r)]}})})},e.prototype.runAndExtendWithFaceDetections=function(){var t=this;return new Promise(function(r){return en(t,void 0,void 0,function(){var s;return tn(this,function(o){switch(o.label){case 0:return[4,this.run()];case 1:return s=o.sent(),[2,r(s.map(function(i){return E6({},i)}))]}})})})},e.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new qae(this.runAndExtendWithFaceDetections(),this.input,t)},e.prototype.withFaceExpressions=function(){return new V6(this.runAndExtendWithFaceDetections(),this.input)},e.prototype.withAgeAndGender=function(){return new H6(this.runAndExtendWithFaceDetections(),this.input)},e})(JP),Xae=(function(n){yn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return en(this,void 0,void 0,function(){var t,r;return tn(this,function(s){switch(s.label){case 0:return[4,new QP(this.input,this.options)];case 1:return t=s.sent(),r=t[0],t.forEach(function(o){o.score>r.score&&(r=o)}),[2,r]}})})},e.prototype.runAndExtendWithFaceDetection=function(){var t=this;return new Promise(function(r){return en(t,void 0,void 0,function(){var s;return tn(this,function(o){switch(o.label){case 0:return[4,this.run()];case 1:return s=o.sent(),[2,r(s?E6({},s):void 0)]}})})})},e.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new Kae(this.runAndExtendWithFaceDetection(),this.input,t)},e.prototype.withFaceExpressions=function(){return new z6(this.runAndExtendWithFaceDetection(),this.input)},e.prototype.withAgeAndGender=function(){return new G6(this.runAndExtendWithFaceDetection(),this.input)},e})(JP);function pv(n,e){return e===void 0&&(e=new l1),new Xae(n,e)}function Yae(n,e){return e===void 0&&(e=new l1),new QP(n,e)}function eO(n,e){if(n.length!==e.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var t=Array.from(n),r=Array.from(e);return Math.sqrt(t.map(function(s,o){return s-r[o]}).reduce(function(s,o){return s+Math.pow(o,2)},0))}(function(){function n(e,t){t===void 0&&(t=.6),this._distanceThreshold=t;var r=Array.isArray(e)?e:[e];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var s=1,o=function(){return"person "+s++};this._labeledDescriptors=r.map(function(i){if(i instanceof lv)return i;if(i instanceof Float32Array)return new lv(o(),[i]);if(i.descriptor&&i.descriptor instanceof Float32Array)return new lv(o(),[i.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(n.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),n.prototype.computeMeanDistance=function(e,t){return t.map(function(r){return eO(r,e)}).reduce(function(r,s){return r+s},0)/(t.length||1)},n.prototype.matchDescriptor=function(e){var t=this;return this.labeledDescriptors.map(function(r){var s=r.descriptors,o=r.label;return new LT(o,t.computeMeanDistance(e,s))}).reduce(function(r,s){return r.distance<s.distance?r:s})},n.prototype.findBestMatch=function(e){var t=this.matchDescriptor(e);return t.distance<this.distanceThreshold?t:new LT("unknown",t.distance)},n.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(e){return e.toJSON()})}},n.fromJSON=function(e){var t=e.labeledDescriptors.map(function(r){return lv.fromJSON(r)});return new n(t,e.distanceThreshold)},n})();const Zae=1e-7,Jae=1e-4;class tO{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class Z6{refCount(e){return mi("refCount")}incRef(e){return mi("incRef")}timerAvailable(){return!0}time(e){return mi("time")}read(e){return mi("read")}readSync(e){return mi("readSync")}readToGPU(e,t){return mi("readToGPU")}numDataIds(){return mi("numDataIds")}disposeData(e,t){return mi("disposeData")}write(e,t,r){return mi("write")}move(e,t,r,s,o){return mi("move")}createTensorFromGPUData(e,t,r){return mi("createTensorFromGPUData")}memory(){return mi("memory")}floatPrecision(){return mi("floatPrecision")}epsilon(){return this.floatPrecision()===32?Zae:Jae}dispose(){return mi("dispose")}}function mi(n){throw new Error(`'${n}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}function Qae(n){let e=n.length,t=0;for(;e>0;)t=Math.random()*e|0,e--,Qh(n,e,t)}function Nf(n,e,t){return Math.max(n,Math.min(e,t))}function J6(n){return n%2===0?n:n+1}function Qh(n,e,t){const r=n[e];n[e]=n[t],n[t]=r}function ele(n){let e=0;for(let t=0;t<n.length;t++)e+=n[t];return e}function X(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function Q6(n,e,t=""){X(lr(n,e),()=>t+` Shapes ${n} and ${e} must match`)}function nO(n){X(n!=null,()=>"The input to the tensor constructor must be a non-null value.")}function Le(n){if(n.length===0)return 1;let e=n[0];for(let t=1;t<n.length;t++)e*=n[t];return e}function lr(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function _p(n){return n%1===0}function I5(n){const e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function hp(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function UT(n,e=s=>0,t,r){return new Promise((s,o)=>{let i=0;const a=()=>{if(n()){s();return}i++;const l=e(i);if(t!=null&&i>=t){o();return}r!=null?r(a,l):setTimeout(a,l)};a()})}function rO(n,e){let t=1,r=-1;for(let o=0;o<n.length;++o)if(n[o]>=0)t*=n[o];else if(n[o]===-1){if(r!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${o}`);r=o}else if(n[o]<0)throw Error(`Shapes can not be < 0. Found ${n[o]} at dim ${o}`);if(r===-1){if(e>0&&e!==t)throw Error(`Size(${e}) must match the product of shape ${n}`);return n}if(t===0)throw Error(`Cannot infer the missing size in [${n}] when there are 0 elements`);if(e%t!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${t}`);const s=n.slice();return s[r]=e/t,s}function Fn(n,e){const t=e.length;return n=n==null?e.map((r,s)=>s):[].concat(n),X(n.every(r=>r>=-t&&r<t),()=>`All values in axis param must be in range [-${t}, ${t}) but got axis ${n}`),X(n.every(r=>_p(r)),()=>`All values in axis param must be integers but got axis ${n}`),n.map(r=>r<0?t+r:r)}function vd(n,e){const t=[],r=[],s=e!=null&&Array.isArray(e)&&e.length===0,o=e==null||s?null:Fn(e,n).sort();let i=0;for(let a=0;a<n.length;++a){if(o!=null){if(o[i]===a&&n[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${n[a]}' is not 1`);(o[i]==null||o[i]>a)&&n[a]===1&&(t.push(n[a]),r.push(a)),o[i]<=a&&i++}n[a]!==1&&(t.push(n[a]),r.push(a))}return{newShape:t,keptDims:r}}function po(n,e){return ns(n,e)}function ns(n,e){let t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else if(n==="string")t=new Array(e);else throw new Error(`Unknown data type ${n}`);return t}function tle(n,e){for(let t=0;t<n.length;t++){const r=n[t];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${e} being uploaded contains ${r}.`)}}function nle(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function sO(n,e){return!(e==="complex64"||e==="float32"&&n!=="complex64"||e==="int32"&&n!=="float32"&&n!=="complex64"||e==="bool"&&n==="bool")}function $2(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error(`Unknown dtype ${n}`)}function rle(n){if(n==null)return 0;let e=0;return n.forEach(t=>e+=t.length),e}function u1(n){return typeof n=="string"||n instanceof String}function sle(n){return typeof n=="boolean"}function T5(n){return typeof n=="number"}function Xp(n){return Array.isArray(n)?Xp(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":T5(n)?"float32":u1(n)?"string":sle(n)?"bool":"float32"}function _5(n){return!!(n&&n.constructor&&n.call&&n.apply)}function R5(n,e){for(let t=e;t<n;++t)if(n%t===0)return t;return n}function nn(n){const e=n.length;if(e<2)return[];const t=new Array(e-1);t[e-2]=n[e-1];for(let r=e-3;r>=0;--r)t[r]=t[r+1]*n[r+1];return t}function oO(n,e,t,r=!1){const s=new Array;if(e.length===1){const o=e[0]*(r?2:1);for(let i=0;i<o;i++)s[i]=t[n+i]}else{const o=e[0],i=e.slice(1),a=i.reduce((l,c)=>l*c)*(r?2:1);for(let l=0;l<o;l++)s[l]=oO(n+l*a,i,t,r)}return s}function il(n,e,t=!1){if(n.length===0)return e[0];const r=n.reduce((s,o)=>s*o)*(t?2:1);if(r===0)return[];if(r!==e.length)throw new Error(`[${n}] does not match the input size ${e.length}${t?" for a complex tensor":""}.`);return oO(0,n,e,t)}function ole(n,e){if(Array.isArray(n))return n;if(e==="float32")return n instanceof Float32Array?n:new Float32Array(n);if(e==="int32")return n instanceof Int32Array?n:new Int32Array(n);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(n));throw new Error(`Unknown dtype ${e}`)}function eS(n,e){const t=mo(n,e);for(let r=0;r<t.length;r++)t[r]=1;return t}function mo(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error(`Unknown data type ${e}`)}function iO(n,e){const t=n.reduce((r,s)=>r*s,1);if(e==null||e==="float32")return il(n,new Float32Array(t));if(e==="int32")return il(n,new Int32Array(t));if(e==="bool")return il(n,new Uint8Array(t));throw new Error(`Unknown data type ${e}`)}function Qc(n){n.forEach(e=>{X(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${n}].`)})}function Ql(n,e,t){if(e===0)return 0;if(e===1)return n[0];let r=n[n.length-1];for(let s=0;s<n.length-1;++s)r+=t[s]*n[s];return r}function Yp(n,e,t){if(e===0)return[];if(e===1)return[n];const r=new Array(e);for(let s=0;s<r.length-1;++s)r[s]=Math.floor(n/t[s]),n-=r[s]*t[s];return r[r.length-1]=n,r}function tS(n){return n&&n.then&&typeof n.then=="function"}const HT="tfjsflags";class ile{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=ale,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(De().getBool("IS_TEST")||De().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,r){if(this.flagRegistry[e]={evaluationFn:t,setHook:r},this.urlFlags[e]!=null){const s=this.urlFlags[e];De().getBool("IS_TEST")||De().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${s}.`),this.set(e,s)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(tS(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);HT in e&&e[HT].split(",").forEach(r=>{const[s,o]=r.split(":");this.urlFlags[s]=cle(s,o)})}}function ale(n){const e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...r)=>(lle(e,r[0],r[1]),r.join("="))),e}function lle(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function cle(n,e){const t=e.toLowerCase();return t==="true"||t==="false"?t==="true":`${+t}`===t?+t:e}function De(){return aO}let aO=null;function ule(n){aO=n}let o4;function lO(){if(o4==null){let n;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");o4=n}return o4}function dle(){const n=lO();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function nS(n,e){const t=dle();if(t.has(n))return t.get(n);{const r=e();return t.set(n,r),t.get(n)}}const Wy="Abs",d1="Acos",f1="Acosh",Zp="Add",rS="AddN",sS="All",oS="Any",Uy="ArgMax",Hy="ArgMin",h1="Asin",p1="Asinh",m1="Atan",g1="Atanh",x1="Atan2",Gy="AvgPool",iS="AvgPoolGrad",qy="AvgPool3D",aS="AvgPool3DGrad",Ky="BatchMatMul",Xy="BatchToSpaceND",lS="Bincount",cS="BitwiseAnd",fle="BroadcastTo",cO="BroadcastArgs",v1="Cast",y1="Ceil",b1="ClipByValue",uS="Complex",Yy="ComplexAbs",Zy="Concat",Jy="Conv2D",dS="Conv2DBackpropFilter",Qy="Conv2DBackpropInput",eb="Conv3D",fS="Conv3DBackpropFilterV2",hS="Conv3DBackpropInputV2",w1="Cos",C1="Cosh",pS="Cumprod",tb="Cumsum",mS="CropAndResize",gS="DenseBincount",xS="DepthToSpace",nb="DepthwiseConv2dNative",vS="DepthwiseConv2dNativeBackpropFilter",yS="DepthwiseConv2dNativeBackpropInput",uO="Diag",rb="Dilation2D",D5="Dilation2DBackpropInput",A5="Dilation2DBackpropFilter",hle="Draw",k1="RealDiv",bS="Einsum",S1="Elu",wS="EluGrad",N1="Erf",sb="Equal",E1="Exp",ob="ExpandDims",I1="Expm1",CS="FFT",kS="Fill",SS="FlipLeftRight",T1="Floor",_1="FloorDiv",ib="FusedBatchNorm",ab="GatherV2",dO="GatherNd",lb="Greater",R1="GreaterEqual",D1="Identity",NS="IFFT",ES="Imag",A1="IsFinite",$1="IsInf",F1="IsNan",cb="LeakyRelu",ub="Less",db="LessEqual",fO="LinSpace",P1="Log",O1="Log1p",fb="LogicalAnd",hb="LogicalNot",pb="LogicalOr",ple="LogSoftmax",mb="LRN",IS="LRNGrad",gb="Max",M1="Maximum",xb="MaxPool",TS="MaxPoolGrad",vb="MaxPool3D",_S="MaxPool3DGrad",hO="MaxPoolWithArgmax",yb="Mean",bb="Min",L1="Minimum",wb="MirrorPad",j1="Mod",pO="Multinomial",B1="Multiply",Cb="Neg",kb="NotEqual",RS="NonMaxSuppressionV3",DS="NonMaxSuppressionV4",AS="NonMaxSuppressionV5",Sb="OnesLike",Nb="OneHot",Eb="Pack",Ib="PadV2",V1="Pow",Tb="Prelu",_b="Prod",mO="RaggedGather",gO="RaggedRange",xO="RaggedTensorToTensor",$S="Range",FS="Real",z1="Reciprocal",W1="Relu",Rb="Reshape",Db="ResizeNearestNeighbor",PS="ResizeNearestNeighborGrad",Ab="ResizeBilinear",OS="ResizeBilinearGrad",U1="Relu6",$b="Reverse",H1="Round",G1="Rsqrt",vO="ScatterNd",yO="TensorScatterUpdate",bO="SearchSorted",Fb="Select",q1="Selu",Pb="Slice",K1="Sin",X1="Sinh",Y1="Sign",Z1="Sigmoid",J1="Softplus",Q1="Sqrt",Ob="Sum",Mb="SpaceToBatchND",Lb="SplitV",jb="Softmax",wO="SparseFillEmptyRows",CO="SparseReshape",kO="SparseSegmentMean",SO="SparseSegmentSum",NO="SparseToDense",e0="SquaredDifference",MS="Square",LS="StaticRegexReplace",jS="StridedSlice",EO="StringNGrams",IO="StringSplit",TO="StringToHashBucketFast",t0="Sub",n0="Tan",r0="Tanh",s0="Tile",BS="TopK",VS="Transform",pp="Transpose",zS="Unique",Bb="Unpack",Vb="UnsortedSegmentSum",zb="ZerosLike",o0="Step",mle="FromPixels",WS="RotateWithOffset",F2="_FusedMatMul",P2="FusedConv2D",_O="FusedDepthwiseConv2D";function Gi(...n){De().getBool("IS_TEST")||De().getBool("PROD")||console.warn(...n)}function gle(...n){De().getBool("IS_TEST")||De().getBool("PROD")||console.log(...n)}const O2=nS("kernelRegistry",()=>new Map),$5=nS("gradRegistry",()=>new Map);function GT(n,e){const t=DO(n,e);return O2.get(t)}function qT(n){return $5.get(n)}function KT(n){const e=O2.entries(),t=[];for(;;){const{done:r,value:s}=e.next();if(r)break;const[o,i]=s,[a]=o.split("_");a===n&&t.push(i)}return t}function RO(n){const{kernelName:e,backendName:t}=n,r=DO(e,t);O2.has(r)&&Gi(`The kernel '${e}' for backend '${t}' is already registered`),O2.set(r,n)}function xle(n){const{kernelName:e}=n;$5.has(e)&&De().getBool("DEBUG")&&Gi(`Overriding the gradient for '${e}'`),$5.set(e,n)}function DO(n,e){return`${e}_${n}`}function AO(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray}var i4,XT;function vle(){if(XT)return i4;XT=1,i4=e;var n=null;try{n=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function e(D,A,P){this.low=D|0,this.high=A|0,this.unsigned=!!P}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0});function t(D){return(D&&D.__isLong__)===!0}e.isLong=t;var r={},s={};function o(D,A){var P,B,L;return A?(D>>>=0,(L=0<=D&&D<256)&&(B=s[D],B)?B:(P=a(D,(D|0)<0?-1:0,!0),L&&(s[D]=P),P)):(D|=0,(L=-128<=D&&D<128)&&(B=r[D],B)?B:(P=a(D,D<0?-1:0,!1),L&&(r[D]=P),P))}e.fromInt=o;function i(D,A){if(isNaN(D))return A?w:b;if(A){if(D<0)return w;if(D>=x)return T}else{if(D<=-v)return F;if(D+1>=v)return I}return D<0?i(-D,A).neg():a(D%p|0,D/p|0,A)}e.fromNumber=i;function a(D,A,P){return new e(D,A,P)}e.fromBits=a;var l=Math.pow;function c(D,A,P){if(D.length===0)throw Error("empty string");if(D==="NaN"||D==="Infinity"||D==="+Infinity"||D==="-Infinity")return b;if(typeof A=="number"?(P=A,A=!1):A=!!A,P=P||10,P<2||36<P)throw RangeError("radix");var B;if((B=D.indexOf("-"))>0)throw Error("interior hyphen");if(B===0)return c(D.substring(1),A,P).neg();for(var L=i(l(P,8)),W=b,H=0;H<D.length;H+=8){var G=Math.min(8,D.length-H),M=parseInt(D.substring(H,H+G),P);if(G<8){var j=i(l(P,G));W=W.mul(j).add(i(M))}else W=W.mul(L),W=W.add(i(M))}return W.unsigned=A,W}e.fromString=c;function u(D,A){return typeof D=="number"?i(D,A):typeof D=="string"?c(D,A):a(D.low,D.high,typeof A=="boolean"?A:D.unsigned)}e.fromValue=u;var d=65536,f=1<<24,p=d*d,x=p*p,v=x/2,y=o(f),b=o(0);e.ZERO=b;var w=o(0,!0);e.UZERO=w;var S=o(1);e.ONE=S;var k=o(1,!0);e.UONE=k;var N=o(-1);e.NEG_ONE=N;var I=a(-1,2147483647,!1);e.MAX_VALUE=I;var T=a(-1,-1,!0);e.MAX_UNSIGNED_VALUE=T;var F=a(0,-2147483648,!1);e.MIN_VALUE=F;var R=e.prototype;return R.toInt=function(){return this.unsigned?this.low>>>0:this.low},R.toNumber=function(){return this.unsigned?(this.high>>>0)*p+(this.low>>>0):this.high*p+(this.low>>>0)},R.toString=function(A){if(A=A||10,A<2||36<A)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(F)){var P=i(A),B=this.div(P),L=B.mul(P).sub(this);return B.toString(A)+L.toInt().toString(A)}else return"-"+this.neg().toString(A);for(var W=i(l(A,6),this.unsigned),H=this,G="";;){var M=H.div(W),j=H.sub(M.mul(W)).toInt()>>>0,z=j.toString(A);if(H=M,H.isZero())return z+G;for(;z.length<6;)z="0"+z;G=""+z+G}},R.getHighBits=function(){return this.high},R.getHighBitsUnsigned=function(){return this.high>>>0},R.getLowBits=function(){return this.low},R.getLowBitsUnsigned=function(){return this.low>>>0},R.getNumBitsAbs=function(){if(this.isNegative())return this.eq(F)?64:this.neg().getNumBitsAbs();for(var A=this.high!=0?this.high:this.low,P=31;P>0&&(A&1<<P)==0;P--);return this.high!=0?P+33:P+1},R.isZero=function(){return this.high===0&&this.low===0},R.eqz=R.isZero,R.isNegative=function(){return!this.unsigned&&this.high<0},R.isPositive=function(){return this.unsigned||this.high>=0},R.isOdd=function(){return(this.low&1)===1},R.isEven=function(){return(this.low&1)===0},R.equals=function(A){return t(A)||(A=u(A)),this.unsigned!==A.unsigned&&this.high>>>31===1&&A.high>>>31===1?!1:this.high===A.high&&this.low===A.low},R.eq=R.equals,R.notEquals=function(A){return!this.eq(A)},R.neq=R.notEquals,R.ne=R.notEquals,R.lessThan=function(A){return this.comp(A)<0},R.lt=R.lessThan,R.lessThanOrEqual=function(A){return this.comp(A)<=0},R.lte=R.lessThanOrEqual,R.le=R.lessThanOrEqual,R.greaterThan=function(A){return this.comp(A)>0},R.gt=R.greaterThan,R.greaterThanOrEqual=function(A){return this.comp(A)>=0},R.gte=R.greaterThanOrEqual,R.ge=R.greaterThanOrEqual,R.compare=function(A){if(t(A)||(A=u(A)),this.eq(A))return 0;var P=this.isNegative(),B=A.isNegative();return P&&!B?-1:!P&&B?1:this.unsigned?A.high>>>0>this.high>>>0||A.high===this.high&&A.low>>>0>this.low>>>0?-1:1:this.sub(A).isNegative()?-1:1},R.comp=R.compare,R.negate=function(){return!this.unsigned&&this.eq(F)?F:this.not().add(S)},R.neg=R.negate,R.add=function(A){t(A)||(A=u(A));var P=this.high>>>16,B=this.high&65535,L=this.low>>>16,W=this.low&65535,H=A.high>>>16,G=A.high&65535,M=A.low>>>16,j=A.low&65535,z=0,V=0,K=0,J=0;return J+=W+j,K+=J>>>16,J&=65535,K+=L+M,V+=K>>>16,K&=65535,V+=B+G,z+=V>>>16,V&=65535,z+=P+H,z&=65535,a(K<<16|J,z<<16|V,this.unsigned)},R.subtract=function(A){return t(A)||(A=u(A)),this.add(A.neg())},R.sub=R.subtract,R.multiply=function(A){if(this.isZero())return b;if(t(A)||(A=u(A)),n){var P=n.mul(this.low,this.high,A.low,A.high);return a(P,n.get_high(),this.unsigned)}if(A.isZero())return b;if(this.eq(F))return A.isOdd()?F:b;if(A.eq(F))return this.isOdd()?F:b;if(this.isNegative())return A.isNegative()?this.neg().mul(A.neg()):this.neg().mul(A).neg();if(A.isNegative())return this.mul(A.neg()).neg();if(this.lt(y)&&A.lt(y))return i(this.toNumber()*A.toNumber(),this.unsigned);var B=this.high>>>16,L=this.high&65535,W=this.low>>>16,H=this.low&65535,G=A.high>>>16,M=A.high&65535,j=A.low>>>16,z=A.low&65535,V=0,K=0,J=0,oe=0;return oe+=H*z,J+=oe>>>16,oe&=65535,J+=W*z,K+=J>>>16,J&=65535,J+=H*j,K+=J>>>16,J&=65535,K+=L*z,V+=K>>>16,K&=65535,K+=W*j,V+=K>>>16,K&=65535,K+=H*M,V+=K>>>16,K&=65535,V+=B*z+L*j+W*M+H*G,V&=65535,a(J<<16|oe,V<<16|K,this.unsigned)},R.mul=R.multiply,R.divide=function(A){if(t(A)||(A=u(A)),A.isZero())throw Error("division by zero");if(n){if(!this.unsigned&&this.high===-2147483648&&A.low===-1&&A.high===-1)return this;var P=(this.unsigned?n.div_u:n.div_s)(this.low,this.high,A.low,A.high);return a(P,n.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?w:b;var B,L,W;if(this.unsigned){if(A.unsigned||(A=A.toUnsigned()),A.gt(this))return w;if(A.gt(this.shru(1)))return k;W=w}else{if(this.eq(F)){if(A.eq(S)||A.eq(N))return F;if(A.eq(F))return S;var H=this.shr(1);return B=H.div(A).shl(1),B.eq(b)?A.isNegative()?S:N:(L=this.sub(A.mul(B)),W=B.add(L.div(A)),W)}else if(A.eq(F))return this.unsigned?w:b;if(this.isNegative())return A.isNegative()?this.neg().div(A.neg()):this.neg().div(A).neg();if(A.isNegative())return this.div(A.neg()).neg();W=b}for(L=this;L.gte(A);){B=Math.max(1,Math.floor(L.toNumber()/A.toNumber()));for(var G=Math.ceil(Math.log(B)/Math.LN2),M=G<=48?1:l(2,G-48),j=i(B),z=j.mul(A);z.isNegative()||z.gt(L);)B-=M,j=i(B,this.unsigned),z=j.mul(A);j.isZero()&&(j=S),W=W.add(j),L=L.sub(z)}return W},R.div=R.divide,R.modulo=function(A){if(t(A)||(A=u(A)),n){var P=(this.unsigned?n.rem_u:n.rem_s)(this.low,this.high,A.low,A.high);return a(P,n.get_high(),this.unsigned)}return this.sub(this.div(A).mul(A))},R.mod=R.modulo,R.rem=R.modulo,R.not=function(){return a(~this.low,~this.high,this.unsigned)},R.and=function(A){return t(A)||(A=u(A)),a(this.low&A.low,this.high&A.high,this.unsigned)},R.or=function(A){return t(A)||(A=u(A)),a(this.low|A.low,this.high|A.high,this.unsigned)},R.xor=function(A){return t(A)||(A=u(A)),a(this.low^A.low,this.high^A.high,this.unsigned)},R.shiftLeft=function(A){return t(A)&&(A=A.toInt()),(A&=63)===0?this:A<32?a(this.low<<A,this.high<<A|this.low>>>32-A,this.unsigned):a(0,this.low<<A-32,this.unsigned)},R.shl=R.shiftLeft,R.shiftRight=function(A){return t(A)&&(A=A.toInt()),(A&=63)===0?this:A<32?a(this.low>>>A|this.high<<32-A,this.high>>A,this.unsigned):a(this.high>>A-32,this.high>=0?0:-1,this.unsigned)},R.shr=R.shiftRight,R.shiftRightUnsigned=function(A){if(t(A)&&(A=A.toInt()),A&=63,A===0)return this;var P=this.high;if(A<32){var B=this.low;return a(B>>>A|P<<32-A,P>>>A,this.unsigned)}else return A===32?a(P,0,this.unsigned):a(P>>>A-32,0,this.unsigned)},R.shru=R.shiftRightUnsigned,R.shr_u=R.shiftRightUnsigned,R.toSigned=function(){return this.unsigned?a(this.low,this.high,!1):this},R.toUnsigned=function(){return this.unsigned?this:a(this.low,this.high,!0)},R.toBytes=function(A){return A?this.toBytesLE():this.toBytesBE()},R.toBytesLE=function(){var A=this.high,P=this.low;return[P&255,P>>>8&255,P>>>16&255,P>>>24,A&255,A>>>8&255,A>>>16&255,A>>>24]},R.toBytesBE=function(){var A=this.high,P=this.low;return[A>>>24,A>>>16&255,A>>>8&255,A&255,P>>>24,P>>>16&255,P>>>8&255,P&255]},e.fromBytes=function(A,P,B){return B?e.fromBytesLE(A,P):e.fromBytesBE(A,P)},e.fromBytesLE=function(A,P){return new e(A[0]|A[1]<<8|A[2]<<16|A[3]<<24,A[4]|A[5]<<8|A[6]<<16|A[7]<<24,P)},e.fromBytesBE=function(A,P){return new e(A[4]<<24|A[5]<<16|A[6]<<8|A[7],A[0]<<24|A[1]<<16|A[2]<<8|A[3],P)},i4}var $O=vle();const FO=ay($O),yle=PR({__proto__:null,default:FO},[$O]);const rf=FO||yle;function Wb(n){return rf.fromString(n,!0,16)}const PO=Wb("c3a5c85c97cb3127"),tf=Wb("b492b66fbe98f273"),Po=Wb("9ae16a3b2f90404f");function F5(n){return n.xor(n.shru(47))}function OO(n,e,t){const r=n.slice(e,e+t);return rf.fromBytes(Array.from(r),!0,!0)}function Er(n,e){return OO(n,e,8)}function YT(n,e){return OO(n,e,4)}function Fs(n,e){return e===0?n:n.shru(e).or(n.shl(64-e))}function Ju(n,e,t=Wb("9ddfea08eb382d69")){let r=n.xor(e).mul(t);r=r.xor(r.shru(47));let s=e.xor(r).mul(t);return s=s.xor(s.shru(47)),s=s.mul(t),s}function ble(n,e,t,r,s,o){s=s.add(n),o=Fs(o.add(s).add(r),21);const i=s;return s=s.add(e),s=s.add(t),o=o.add(Fs(s,44)),[s.add(r),o.add(i)]}function mv(n,e,t,r){return ble(Er(n,e),Er(n,e+8),Er(n,e+16),Er(n,e+24),t,r)}function wle(n,e=n.length){if(e>=8){const t=Po.add(e*2),r=Er(n,0).add(Po),s=Er(n,e-8),o=Fs(s,37).mul(t).add(r),i=Fs(r,25).add(s).mul(t);return Ju(o,i,t)}if(e>=4){const t=Po.add(e*2),r=YT(n,0);return Ju(r.shl(3).add(e),YT(n,e-4),t)}if(e>0){const t=n[0],r=n[e>>1],s=n[e-1],o=t+(r<<8),i=e+(s<<2);return F5(Po.mul(o).xor(PO.mul(i))).mul(Po)}return Po}function Cle(n,e=n.length){const t=Po.add(e*2),r=Er(n,0).mul(tf),s=Er(n,8),o=Er(n,e-8).mul(t),i=Er(n,e-16).mul(Po);return Ju(Fs(r.add(s),43).add(Fs(o,30)).add(i),r.add(Fs(s.add(Po),18)).add(o),t)}function kle(n,e=n.length){const t=Po.add(e*2),r=Er(n,0).mul(Po),s=Er(n,8),o=Er(n,e-8).mul(t),i=Er(n,e-16).mul(Po),a=Fs(r.add(s),43).add(Fs(o,30)).add(i),l=Ju(a,r.add(Fs(s.add(Po),18)).add(o),t),c=Er(n,16).mul(t),u=Er(n,24),d=a.add(Er(n,e-32)).mul(t),f=l.add(Er(n,e-24)).mul(t);return Ju(Fs(c.add(u),43).add(Fs(d,30)).add(f),c.add(Fs(u.add(r),18)).add(d),t)}function Sle(n,e=n.length){const t=rf.fromNumber(81,!0);if(e<=32)return e<=16?wle(n,e):Cle(n,e);if(e<=64)return kle(n,e);let r=t,s=t.mul(tf).add(113),o=F5(s.mul(Po).add(113)).mul(Po),i=[rf.UZERO,rf.UZERO],a=[rf.UZERO,rf.UZERO];r=r.mul(Po).add(Er(n,0));let l=0;const c=(e-1>>6)*64,u=c+(e-1&63)-63;do r=Fs(r.add(s).add(i[0]).add(Er(n,l+8)),37).mul(tf),s=Fs(s.add(i[1]).add(Er(n,l+48)),42).mul(tf),r=r.xor(a[1]),s=s.add(i[0]).add(Er(n,l+40)),o=Fs(o.add(a[0]),33).mul(tf),i=mv(n,l,i[1].mul(tf),r.add(a[0])),a=mv(n,l+32,o.add(a[1]),s.add(Er(n,l+16))),[o,r]=[r,o],l+=64;while(l!==c);const d=tf.add(o.and(255).shl(1));return l=u,a[0]=a[0].add(e-1&63),i[0]=i[0].add(a[0]),a[0]=a[0].add(i[0]),r=Fs(r.add(s).add(i[0]).add(Er(n,l+8)),37).mul(d),s=Fs(s.add(i[1]).add(Er(n,l+48)),42).mul(d),r=r.xor(a[1].mul(9)),s=s.add(i[0].mul(9).add(Er(n,l+40))),o=Fs(o.add(a[0]),33).mul(d),i=mv(n,l,i[1].mul(d),r.add(a[0])),a=mv(n,l+32,o.add(a[1]),s.add(Er(n,l+16))),[o,r]=[r,o],Ju(Ju(i[0],a[0],d).add(F5(s).mul(PO)).add(o),Ju(i[1],a[1],d).add(r),d)}function yd(n,e){return e==="string"?Qu(n):qf([n],e)}function Nle(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function qf(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Ef(n)),De().getBool("DEBUG")&&tle(n,e),Nle(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){const t=new Uint8Array(n.length);for(let r=0;r<t.length;++r)Math.round(n[r])!==0&&(t[r]=1);return t}else throw new Error(`Unknown data type ${e}`)}function Yo(){return De().platform.now()}function Qu(n,e="utf-8"){return e=e||"utf-8",De().platform.encode(n,e)}function ld(n,e="utf-8"){return e=e||"utf-8",De().platform.decode(n,e)}function _a(n){return De().platform.isTypedArray!=null?De().platform.isTypedArray(n):AO(n)}function Ef(n,e=[],t=!1){if(e==null&&(e=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||tS(n)||n==null||_a(n)&&t)e.push(n);else if(Array.isArray(n)||_a(n))for(let r=0;r<n.length;++r)Ef(n[r],e,t);else{let r=-1;for(const s of Object.keys(n))/^([1-9]+[0-9]*|0)$/.test(s)&&(r=Math.max(r,Number(s)));for(let s=0;s<=r;s++)Ef(n[s],e,t)}return e}class Ele{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new Tle)}profileKernel(e,t,r){let s;const o=()=>{s=r()};let i;const a=Yo();if(this.backendTimer.timerAvailable())i=this.backendTimer.time(o);else{o();for(const c of s)c.dataSync();i=Promise.resolve({kernelMs:Yo()-a})}if(De().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let c=0;c<s.length;c++){const u=s[c];u.data().then(d=>{Ile(d,u.dtype,e)})}return{kernelName:e,outputs:s,inputs:t,timeMs:i.then(c=>c.kernelMs),extraInfo:i.then(c=>c.getExtraProfileInfo!=null?c.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:t,outputs:r,timeMs:s,inputs:o,extraInfo:i}=e;r.forEach(a=>{Promise.all([a.data(),s,i]).then(l=>{this.logger.logKernelProfile(t,a,l[0],l[1],o,l[2])})})}}function Ile(n,e,t){if(e!=="float32")return!1;for(let r=0;r<n.length;r++){const s=n[r];if(isNaN(s)||!isFinite(s))return console.warn(`Found ${s} in the result of '${t}'`),!0}return!1}class Tle{logKernelProfile(e,t,r,s,o,i){const a=typeof s=="number"?hp(`${s}ms`,9):s.error,l=hp(e,25),c=t.rank,u=t.size,d=hp(t.shape.toString(),14);let f="";for(const p in o){const x=o[p];if(x!=null){const v=x.shape||t.shape,y=v.length;f+=`${p}: ${y}D ${y>0?v:""} `}}console.log(`%c${l}	%c${a}	%c${c}D ${d}	%c${u}	%c${f}	%c${i}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}function _le(n,e,t){const r={},s={};for(let l=0;l<e.length;l++)r[e[l].id]=!0;for(let l=0;l<n.length;l++){const c=n[l],u=c.inputs;for(const d in u){const f=u[d];let p=!1;for(let x=0;x<e.length;x++)if(r[f.id]){c.outputs.forEach(v=>r[v.id]=!0),p=!0,s[c.id]=!0;break}if(p)break}}const o={};o[t.id]=!0;const i={};for(let l=n.length-1;l>=0;l--){const c=n[l],u=c.inputs;for(let d=0;d<c.outputs.length;d++)if(o[c.outputs[d].id]){for(const f in u)o[u[f].id]=!0,i[c.id]=!0;break}}const a=[];for(let l=0;l<n.length;l++){const c=n[l];if(s[c.id]&&i[c.id]){const u={};for(const f in c.inputs){const p=c.inputs[f];r[p.id]&&(u[f]=p)}const d=Object.assign({},c);d.inputs=u,d.outputs=c.outputs,a.push(d)}}return a}function Rle(n,e,t,r){for(let s=e.length-1;s>=0;s--){const o=e[s],i=[];if(o.outputs.forEach(l=>{const c=n[l.id];c!=null?i.push(c):i.push(null)}),o.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${o.kernelName}.`);const a=o.gradient(i);for(const l in o.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);const c=t(()=>a[l]());if(c.dtype!=="float32")throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${c.dtype}'`);const u=o.inputs[l];if(!lr(c.shape,u.shape))throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input '${l}' has shape '${c.shape}', which does not match the shape of the input '${u.shape}'`);if(n[u.id]==null)n[u.id]=c;else{const d=n[u.id];n[u.id]=r(d,c),d.dispose()}}}}const ZT=20,Xm=3,a4=7;function Dle(n,e,t,r){const s=nn(e),o=Ale(n,e,t,s),i=e.length,a=Lv(n,e,t,s,o),l=["Tensor"];return r&&(l.push(`  dtype: ${t}`),l.push(`  rank: ${i}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(a.map(c=>"    "+c).join(`
`)),l.join(`
`)}function Ale(n,e,t,r){const s=Le(e),o=r[r.length-1],i=new Array(o).fill(0),a=e.length,l=t==="complex64"?rg(n):n;if(a>1)for(let c=0;c<s/o;c++){const u=c*o;for(let d=0;d<o;d++)i[d]=Math.max(i[d],ng(l[u+d],0,t).length)}return i}function ng(n,e,t){let r;return Array.isArray(n)?r=`${parseFloat(n[0].toFixed(a4))} + ${parseFloat(n[1].toFixed(a4))}j`:u1(n)?r=`'${n}'`:t==="bool"?r=MO(n):r=parseFloat(n.toFixed(a4)).toString(),hp(r,e)}function MO(n){return n===0?"false":"true"}function Lv(n,e,t,r,s,o=!0){const i=t==="complex64"?2:1,a=e[0],l=e.length;if(l===0){if(t==="complex64"){const v=rg(n);return[ng(v[0],0,t)]}return t==="bool"?[MO(n[0])]:[n[0].toString()]}if(l===1){if(a>ZT){const y=Xm*i;let b=Array.from(n.slice(0,y)),w=Array.from(n.slice((a-Xm)*i,a*i));return t==="complex64"&&(b=rg(b),w=rg(w)),["["+b.map((S,k)=>ng(S,s[k],t)).join(", ")+", ..., "+w.map((S,k)=>ng(S,s[a-Xm+k],t)).join(", ")+"]"]}return["["+(t==="complex64"?rg(n):Array.from(n)).map((y,b)=>ng(y,s[b],t)).join(", ")+"]"]}const c=e.slice(1),u=r.slice(1),d=r[0]*i,f=[];if(a>ZT){for(let v=0;v<Xm;v++){const y=v*d,b=y+d;f.push(...Lv(n.slice(y,b),c,t,u,s,!1))}f.push("...");for(let v=a-Xm;v<a;v++){const y=v*d,b=y+d;f.push(...Lv(n.slice(y,b),c,t,u,s,v===a-1))}}else for(let v=0;v<a;v++){const y=v*d,b=y+d;f.push(...Lv(n.slice(y,b),c,t,u,s,v===a-1))}const p=l===2?",":"";f[0]="["+(a>0?f[0]+p:"");for(let v=1;v<f.length-1;v++)f[v]=" "+f[v]+p;let x=`,
`;for(let v=2;v<l;v++)x+=`
`;return f[f.length-1]=" "+f[f.length-1]+"]"+(o?"":x),f}function rg(n){const e=[];for(let t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}class to{constructor(e,t,r){if(this.dtype=t,this.shape=e.slice(),this.size=Le(e),r!=null){const s=r.length;X(s===this.size,()=>`Length of values '${s}' does not match the size inferred by the shape '${this.size}'.`)}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||ns(t,this.size),this.strides=nn(e)}set(e,...t){t.length===0&&(t=[0]),X(t.length===this.rank,()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`);const r=this.locToIndex(t);this.values[r]=e}get(...e){e.length===0&&(e=[0]);let t=0;for(const s of e){if(s<0||s>=this.shape[t]){const o=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(o)}t++}let r=e[e.length-1];for(let s=0;s<e.length-1;++s)r+=this.strides[s]*e[s];return this.values[r]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let t=e[e.length-1];for(let r=0;r<e.length-1;++r)t+=this.strides[r]*e[r];return t}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const t=new Array(this.shape.length);for(let r=0;r<t.length-1;++r)t[r]=Math.floor(e/this.strides[r]),e-=t[r]*this.strides[r];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return Za().makeTensor(this.values,this.shape,this.dtype)}}let Za=null,ep=null;function $le(n){Za=n}function Fle(n){ep=n}class ys{constructor(e,t,r,s){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Le(e),this.strides=nn(e),this.dataId=r,this.id=s,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return ep.buffer(this.shape,this.dtype,e)}bufferSync(){return ep.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return il(this.shape,e,this.dtype==="complex64")}arraySync(){return il(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=Za().read(this.dataId);if(this.dtype==="string"){const t=await e;try{return t.map(r=>ld(r))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),Za().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=Za().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>ld(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await Za().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),Za().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return ep.print(this,e)}clone(){return this.throwIfDisposed(),ep.clone(this)}toString(e=!1){const t=this.dataSync();return Dle(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),ep.cast(this,e)}variable(e=!0,t,r){return this.throwIfDisposed(),Za().makeVariable(this,e,t,r)}}Object.defineProperty(ys,Symbol.hasInstance,{value:n=>!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null});function Me(){return nS("Tensor",()=>ys)}Me();class M2 extends ys{constructor(e,t,r,s){super(e.shape,e.dtype,e.dataId,s),this.trainable=t,this.name=r}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!lr(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);Za().disposeTensor(this),this.dataId=e.dataId,Za().incRef(this,null)}dispose(){Za().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(M2,Symbol.hasInstance,{value:n=>n instanceof ys&&n.assign!=null&&n.assign instanceof Function});var JT;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(JT||(JT={}));var P5;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(P5||(P5={}));var O5;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(O5||(O5={}));var M5;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(M5||(M5={}));var L5;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(L5||(L5={}));const Ple={float32:M5,int32:P5,bool:O5,complex64:L5};function Ei(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${n} with ${e}`)}return Ple[n][e]}function US(n){return Ei(n,"int32")}function LO(n){return n!=null&&typeof n=="object"&&"texture"in n&&n.texture instanceof WebGLTexture}function jO(n){return typeof GPUBuffer<"u"&&n!=null&&typeof n=="object"&&"buffer"in n&&n.buffer instanceof GPUBuffer}function ss(n,e){if(n.dtype===e.dtype)return[n,e];const t=Ei(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function BO(n){const e=[];return VO(n,e,new Set),e}function VO(n,e,t){if(n==null)return;if(n instanceof ys){e.push(n);return}if(!Ole(n))return;const r=n;for(const s in r){const o=r[s];t.has(o)||(t.add(o),VO(o,e,t))}}function Ole(n){return Array.isArray(n)||typeof n=="object"}function l4(n){return n.kernelName!=null}class QT{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class Rp{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new QT}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const r=e[t];if(await this.initializeBackend(r).success){await this.setBackend(r);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:t}=this.initializeBackend(e);if(t)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,r=1){return e in this.registryFactory?(Gi(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:r},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:t,asyncInit:r}=this.initializeBackend(e);if(!(r?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Ele(this.backendInstance),!0}setupRegisteredKernels(){KT(this.backendName).forEach(t=>{t.setupFunc!=null&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){KT(e).forEach(r=>{r.disposeFunc!=null&&r.disposeFunc(this.registry[e])})}initializeBackend(e){const t=this.registryFactory[e];if(t==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const r=t.factory();if(r&&!(r instanceof Z6)&&typeof r.then=="function"){const s=++this.pendingBackendInitId,o=r.then(i=>s<this.pendingBackendInitId?!1:(this.registry[e]=i,this.pendingBackendInit=null,!0)).catch(i=>(s<this.pendingBackendInitId||(this.pendingBackendInit=null,Gi(`Initialization of backend ${e} failed`),Gi(i.stack||i.message)),!1));return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=r,{success:!0,asyncInit:!1}}catch(r){return Gi(`Initialization of backend ${e} failed`),Gi(r.stack||r.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const r=e[t],{success:s,asyncInit:o}=this.initializeBackend(r);if(o||s)return{name:r,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const r=this.state.tensorInfo.get(t),s=r.backend,o=this.readSync(t),i=s.refCount(t);s.disposeData(t,!0),r.backend=e,e.move(t,o,r.shape,r.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let r=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=e}let s;return this.scopedRun(()=>this.startScope(r),()=>this.endScope(s),()=>(s=t(),s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),s))}scopedRun(e,t,r){e();try{const s=r();return t(),s}catch(s){throw t(),s}}nextTensorId(){return Rp.nextTensorId++}nextVariableId(){return Rp.nextVariableId++}clone(e){const t=me.runKernel(D1,{x:e}),r={x:e},s=i=>({x:()=>{const a="float32",l={x:i},c={dtype:a};return me.runKernel(v1,l,c)}}),o=[];return this.addTapeNode(this.state.activeScope.name,r,[t],s,o,{}),t}runKernel(e,t,r){if(this.backendName==null&&this.backend,!(GT(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:r})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,r){const s=this.backend.numDataIds();let o=0;r.forEach(l=>{o+=l.dtype==="complex64"?3:1});const i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=s-t-o-i;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let t,r=[];const s=this.isTapeOn(),o=this.state.numBytes,i=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let l;const c=l4(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(l4(e)){const{kernelName:x,inputs:v,attrs:y}=e;this.backendName==null&&this.backend;const b=GT(x,this.backendName);X(b!=null,()=>`Cannot find registered kernel '${x}' for backend '${this.backendName}'`),a=()=>{const w=this.backend.numDataIds();l=b.kernelFunc({inputs:v,attrs:y,backend:this.backend});const S=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(x,w,S);const k=S.map(N=>N.rank!=null?N:this.makeTensorFromTensorInfo(N));if(s){const N=this.getTensorsForGradient(x,v,k);r=this.saveTensorsForBackwardMode(N)}return k}}else{const{forwardFunc:x}=e,v=y=>{s&&(r=y.map(b=>this.keep(this.clone(b))))};a=()=>{const y=this.backend.numDataIds();l=this.tidy(()=>x(this.backend,v));const b=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(c,y,b),b}}const{inputs:u,attrs:d}=e,f=l4(e)?null:e.backwardsFunc;let p;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?t=a():(p=this.profiler.profileKernel(c,u,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(p),t=p.outputs)}),s&&this.addTapeNode(c,u,t,f,r,d),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-i,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(u).map(x=>u[x]!=null?u[x].shape:null),outputShapes:t.map(x=>x.shape),kernelTimeMs:p.timeMs,extraInfo:p.extraInfo}),Array.isArray(l)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(r=>this.keep(this.clone(r)))}getTensorsForGradient(e,t,r){const s=qT(e);if(s!=null){const o=s.inputsToSave||[],i=s.outputsToSave||[];let a;s.saveAllInputs?(X(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(t).map(c=>t[c])):a=o.map(c=>t[c]);const l=r.filter((c,u)=>i[u]);return a.concat(l)}return[]}makeTensor(e,t,r,s){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",s=s||this.backend;let o=e;r==="string"&&u1(e[0])&&(o=e.map(l=>Qu(l)));const i=s.write(o,t,r),a=new ys(t,r,i,this.nextTensorId());if(this.trackTensor(a,s),r==="string"){const l=this.state.tensorInfo.get(i),c=rle(o);this.state.numBytes+=c-l.bytes,l.bytes=c}return a}makeTensorFromDataId(e,t,r,s){r=r||"float32";const o={dataId:e,shape:t,dtype:r};return this.makeTensorFromTensorInfo(o,s)}makeTensorFromTensorInfo(e,t){const{dataId:r,shape:s,dtype:o}=e,i=new ys(s,o,r,this.nextTensorId());return this.trackTensor(i,t),i}makeVariable(e,t=!0,r,s){r=r||this.nextVariableId().toString(),s!=null&&s!==e.dtype&&(e=e.cast(s));const o=new M2(e,t,r,this.nextTensorId());if(this.state.registeredVariables[o.name]!=null)throw new Error(`Variable with name ${o.name} was already registered`);return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o}trackTensor(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let r=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(r=e.size*$2(e.dtype)),this.state.numBytes+=r,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r})),e instanceof M2||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const r=e.size*$2(e.dtype);this.state.numBytes-=r}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,r=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(s=>s.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r;for(const s of this.state.activeProfile.kernels)s.kernelTimeMs=await s.kernelTimeMs,s.extraInfo=await s.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,t,r,s,o,i){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:r,saved:o},l=qT(e);l!=null&&(s=l.gradFunc),s!=null&&(a.gradient=c=>(c=c.map((u,d)=>{if(u==null){const f=r[d],p=mo(f.size,f.dtype);return this.makeTensor(p,f.shape,f.dtype)}return u}),s(c.length>1?c:c[0],o,i))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=BO(e),r=new Set(t.map(o=>o.id));for(let o=0;o<this.state.activeScope.track.length;o++){const i=this.state.activeScope.track[o];!i.kept&&!r.has(i.id)&&i.dispose()}const s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(o=>{!o.kept&&o.scopeId===s.id&&this.track(o)})}gradients(e,t,r,s=!1){if(X(t.length>0,()=>"gradients() received an empty list of xs."),r!=null&&r.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${r.dtype}'`);const o=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));X(o instanceof ys,()=>"The result y returned by f() must be a tensor.");const i=_le(this.state.activeTape,t,o);if(!s&&i.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[o.id]=r??Mle(o.shape),Rle(a,i,c=>this.tidy(c),Lle);const l=t.map(c=>a[c.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(c=>{for(const u of c.saved)u.dispose()}),this.state.activeTape=null),{value:o,grads:l}})}customGrad(e){return X(_5(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{X(t.every(a=>a instanceof ys),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let r;const s={};t.forEach((a,l)=>{s[l]=a});const o=(a,l)=>(r=e(...t,l),X(r.value instanceof ys,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),X(_5(r.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),r.value),i=(a,l)=>{const c=r.gradFunc(a,l),u=Array.isArray(c)?c:[c];X(u.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),X(u.every(f=>f instanceof ys),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const d={};return u.forEach((f,p)=>{d[p]=()=>f}),d};return this.runKernelFunc({forwardFunc:o,backwardsFunc:i,inputs:s})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=Yo(),r=await this.backend.time(e);return r.wallMs=Yo()-t,r}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new QT;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}Rp.nextTensorId=0;Rp.nextVariableId=0;function Mle(n){const e=eS(Le(n),"float32");return me.makeTensor(e,n,"float32")}function zO(){const n=lO();if(n._tfengine==null){const e=new ile(n);n._tfengine=new Rp(e)}return ule(n._tfengine.ENV),$le(()=>n._tfengine),n._tfengine}const me=zO();function Lle(n,e){const t={a:n,b:e};return me.runKernel(Zp,t)}function jle(){return typeof navigator<"u"&&navigator!=null}function WO(n){if(n||jle()){if(n||(n=navigator),n.product==="ReactNative")return!0;const e=n.userAgent||n.vendor||(typeof window<"u"?window.opera:"");if(!e){const t=n;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function UO(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}const ni=De();ni.registerFlag("DEBUG",()=>!1,n=>{n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});ni.registerFlag("IS_BROWSER",()=>UO());ni.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");ni.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));ni.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));ni.registerFlag("PROD",()=>!1);ni.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>ni.getBool("DEBUG"));ni.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);ni.registerFlag("IS_TEST",()=>!1);ni.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>ni.getBool("DEBUG"));ni.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);ni.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);ni.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);function Ub(n,e){let t=n;if(_a(n))return e==="string"?[]:[n.length];if(LO(n)){const s=n.channels||"RGBA";return[n.height,n.width*s.length]}else if(jO(n))return[n.buffer.size/(e==null?4:$2(e))];if(!Array.isArray(n))return[];const r=[];for(;Array.isArray(t)||_a(t)&&e!=="string";)r.push(t.length),t=t[0];return Array.isArray(n)&&De().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&HO(n,r,[]),r}function HO(n,e,t){if(t=t||[],!Array.isArray(n)&&!_a(n)){X(e.length===0,()=>`Element arr[${t.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}X(e.length>0,()=>`Element arr[${t.join("][")}] should be a primitive, but is an array of ${n.length} elements`),X(n.length===e[0],()=>`Element arr[${t.join("][")}] should have ${e[0]} elements, but has ${n.length} elements`);const r=e.slice(1);for(let s=0;s<n.length;++s)HO(n[s],r,t.concat(s))}function e_(n,e,t,r){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error(`Argument '${t}' passed to '${r}' must be ${n} tensor, but got ${e} tensor`)}}function se(n,e,t,r="numeric"){if(n instanceof Me())return e_(r,n.dtype,e,t),n;let s=Xp(n);if(s!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(s=r),e_(r,s,e,t),n==null||!_a(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){const l=n==null?"null":n.constructor.name;throw new Error(`Argument '${e}' passed to '${t}' must be a Tensor or TensorLike, but got '${l}'`)}const o=Ub(n,s);!_a(n)&&!Array.isArray(n)&&(n=[n]);const a=s!=="string"?qf(n,s):Ef(n,[],!0);return me.makeTensor(a,o,s)}function GO(n,e,t,r="numeric"){if(!Array.isArray(n))throw new Error(`Argument ${e} passed to ${t} must be a \`Tensor[]\` or \`TensorLike[]\``);return n.map((o,i)=>se(o,`${e}[${i}]`,t,r))}const Ble="__op";function be(n){const e=Object.keys(n);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let t=e[0];const r=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+Ble;const s=(...o)=>{me.startScope(t);try{const i=r(...o);return tS(i)&&console.error("Cannot return a Promise inside of tidy."),me.endScope(i),i}catch(i){throw me.endScope(null),i}};return Object.defineProperty(s,"name",{value:t,configurable:!0}),s}function Vle(n,e){const t=se(n,"real","complex"),r=se(e,"imag","complex");Q6(t.shape,r.shape,`real and imag shapes, ${t.shape} and ${r.shape}, must match in call to tf.complex().`);const s={real:t,imag:r};return me.runKernel(uS,s)}const Dp=be({complex_:Vle});function Hb(n,e,t,r){if(r==null)r=Xp(n);else if(r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(jO(n)||LO(n)){if(r!=="float32"&&r!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${r}.`);return me.backend.createTensorFromGPUData(n,e||t,r)}if(!_a(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){Qc(e);const s=Le(e),o=Le(t);X(s===o,()=>`Based on the provided shape, [${e}], the tensor should have ${s} values but has ${o}`);for(let i=0;i<t.length;++i){const a=t[i],l=i===t.length-1?a!==Le(e.slice(i)):!0;X(t[i]===e[i]||!l,()=>`Error creating a new Tensor. Inferred shape (${t}) does not match the provided shape (${e}). `)}}return!_a(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=r!=="string"?qf(n,r):Ef(n,[],!0),me.makeTensor(n,e,r)}function qO(n,e,t){const r=Ub(n,t);return Hb(n,e,r,t)}class Jp{static join(e){return new Jp(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(r=>_a(r)?r.buffer:r),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let r=0;r<e.length;r++){const s=e[r];r!==e.length-1&&s.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const o=t+s.byteLength;this.shards.push({buffer:s,start:t,end:o}),t=o}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,t=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);const r=this.findShardForByte(e);if(r===-1)throw new Error(`Could not find start shard for byte ${e}`);const s=t-e,o=new ArrayBuffer(s),i=new Uint8Array(o);let a=0;for(let l=r;l<this.shards.length;l++){const c=this.shards[l],d=e+a-c.start,f=a,x=Math.min(t,c.end)-c.start,v=new Uint8Array(c.buffer,d,x-d);if(i.set(v,f),a+=v.length,t<c.end)break}return o}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(s){return e<s.start?-1:e>=s.end?1:0}if(t(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const r=zle(this.shards,t);return r===-1?-1:(this.previousShardIndex=r,this.previousShardIndex)}}function zle(n,e){let t=0,r=n.length;for(;t<=r;){const s=Math.floor((r-t)/2)+t,o=e(n[s]);if(o===0)return s;o<0?r=s:t=s+1}return-1}function Pl(){return me}function t_(){return me.memory()}function Ne(n,e){return me.tidy(n,e)}function Mn(n){BO(n).forEach(t=>t.dispose())}function ec(n){return me.keep(n)}function Wle(n){return me.setBackend(n)}function Ule(){return me.ready()}function Hle(){return me.backendName}function KO(n,e,t=1){return me.registerBackend(n,e,t)}function Gle(){return me.backend}const n_=4;async function r_(n,e){const t=[],r=[],s=Array.isArray(n)?n.map(i=>i.name):Object.keys(n);for(let i=0;i<s.length;++i){const a=s[i],l=Array.isArray(n)?n[i].tensor:n[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);const c={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){const u=new Promise(async d=>{const f=await l.bytes(),p=f.reduce((y,b)=>y+b.length,0)+n_*f.length,x=new Uint8Array(p);let v=0;for(let y=0;y<f.length;y++){const b=f[y],w=new Uint8Array(new Uint32Array([b.length]).buffer);x.set(w,v),v+=n_,x.set(b,v),v+=b.length}d(x)});r.push(u)}else r.push(l.data());e!=null&&(c.group=e),t.push(c)}const o=await Promise.all(r);return{data:qle(o),specs:t}}function qle(n){if(n===null)throw new Error(`Invalid input value: ${JSON.stringify(n)}`);let e=0;const t=[];n.forEach(o=>{if(e+=o.byteLength,t.push(o.byteLength===o.buffer.byteLength?o:new o.constructor(o)),!(o instanceof Float32Array||o instanceof Int32Array||o instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${o.constructor.name}`)});const r=new Uint8Array(e);let s=0;return t.forEach(o=>{r.set(new Uint8Array(o.buffer),s),s+=o.byteLength}),r.buffer}const HS=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function s_(n){return HS?Buffer.byteLength(n,"utf8"):new Blob([n]).size}function Kle(n){if(HS)return Buffer.from(n).toString("base64");const e=new Uint8Array(n);let t="";for(let r=0,s=e.length;r<s;r++)t+=String.fromCharCode(e[r]);return btoa(t)}function Xle(n){if(HS){const r=Buffer.from(n,"base64");return r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}const e=atob(n),t=new Uint8Array(e.length);for(let r=0;r<e.length;++r)t.set([e.charCodeAt(r)],r);return t.buffer}function Yle(n){return Jp.join(n)}function XO(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:s_(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:s_(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:new Jp(n.weightData).byteLength}}class To{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return To.instance==null&&(To.instance=new To),To.instance}static registerSaveRouter(e){To.getInstance().saveRouters.push(e)}static registerLoadRouter(e){To.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return To.getHandlers(e,"save")}static getLoadHandlers(e,t){return To.getHandlers(e,"load",t)}static getHandlers(e,t,r){const s=[];return(t==="load"?To.getInstance().loadRouters:To.getInstance().saveRouters).forEach(i=>{const a=i(e,r);a!==null&&s.push(a)}),s}}const Zle=n=>To.getSaveHandlers(n);const j5="tensorflowjs",B5=1,uf="models_store",Hu="model_info_store";function YO(){if(!De().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const n=typeof window>"u"?self:window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function V5(n){const e=n.result;e.createObjectStore(uf,{keyPath:"modelPath"}),e.createObjectStore(Hu,{keyPath:"modelPath"})}class If{constructor(e){if(this.indexedDB=YO(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((r,s)=>{const o=this.indexedDB.open(j5,B5);o.onupgradeneeded=()=>V5(o),o.onsuccess=()=>{const i=o.result;if(t==null){const a=i.transaction(uf,"readonly"),c=a.objectStore(uf).get(this.modelPath);c.onsuccess=()=>{if(c.result==null)return i.close(),s(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));r(c.result.modelArtifacts)},c.onerror=u=>(i.close(),s(c.error)),a.oncomplete=()=>i.close()}else{t.weightData=Jp.join(t.weightData);const a=XO(t),l=i.transaction(Hu,"readwrite");let c=l.objectStore(Hu),u;try{u=c.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(f){return s(f)}let d;u.onsuccess=()=>{d=i.transaction(uf,"readwrite");const f=d.objectStore(uf);let p;try{p=f.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:a})}catch(x){return s(x)}p.onsuccess=()=>r({modelArtifactsInfo:a}),p.onerror=x=>{c=l.objectStore(Hu);const v=c.delete(this.modelPath);v.onsuccess=()=>(i.close(),s(p.error)),v.onerror=y=>(i.close(),s(p.error))}},u.onerror=f=>(i.close(),s(u.error)),l.oncomplete=()=>{d==null?i.close():d.oncomplete=()=>i.close()}}},o.onerror=i=>s(o.error)})}}If.URL_SCHEME="indexeddb://";const ZO=n=>De().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(If.URL_SCHEME)?Jle(n.slice(If.URL_SCHEME.length)):null;To.registerSaveRouter(ZO);To.registerLoadRouter(ZO);function Jle(n){return new If(n)}function Qle(n){return n.startsWith(If.URL_SCHEME)?n.slice(If.URL_SCHEME.length):n}class ece{constructor(){this.indexedDB=YO()}async listModels(){return new Promise((e,t)=>{const r=this.indexedDB.open(j5,B5);r.onupgradeneeded=()=>V5(r),r.onsuccess=()=>{const s=r.result,o=s.transaction(Hu,"readonly"),a=o.objectStore(Hu).getAll();a.onsuccess=()=>{const l={};for(const c of a.result)l[c.modelPath]=c.modelArtifactsInfo;e(l)},a.onerror=l=>(s.close(),t(a.error)),o.oncomplete=()=>s.close()},r.onerror=s=>t(r.error)})}async removeModel(e){return e=Qle(e),new Promise((t,r)=>{const s=this.indexedDB.open(j5,B5);s.onupgradeneeded=()=>V5(s),s.onsuccess=()=>{const o=s.result,i=o.transaction(Hu,"readwrite"),a=i.objectStore(Hu),l=a.get(e);let c;l.onsuccess=()=>{if(l.result==null)return o.close(),r(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const u=a.delete(e),d=()=>{c=o.transaction(uf,"readwrite");const p=c.objectStore(uf).delete(e);p.onsuccess=()=>t(l.result.modelArtifactsInfo),p.onerror=x=>r(l.error)};u.onsuccess=d,u.onerror=f=>(d(),o.close(),r(l.error))}},l.onerror=u=>(o.close(),r(l.error)),i.oncomplete=()=>{c==null?o.close():c.oncomplete=()=>o.close()}},s.onerror=o=>r(s.error)})}}const Oc="/",tp="tensorflowjs_models",JO="info",tce="model_topology",nce="weight_specs",rce="weight_data",sce="model_metadata";function QO(n){return{info:[tp,n,JO].join(Oc),topology:[tp,n,tce].join(Oc),weightSpecs:[tp,n,nce].join(Oc),weightData:[tp,n,rce].join(Oc),modelMetadata:[tp,n,sce].join(Oc)}}function eM(n){for(const e of Object.values(n))window.localStorage.removeItem(e)}function oce(n){const e=n.split(Oc);if(e.length<3)throw new Error(`Invalid key format: ${n}`);return e.slice(1,e.length-1).join(Oc)}function ice(n){return n.startsWith(Tf.URL_SCHEME)?n.slice(Tf.URL_SCHEME.length):n}class Tf{constructor(e){if(!De().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=QO(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const t=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),s=XO(e),o=Jp.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(s)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,Kle(o));const i={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),{modelArtifactsInfo:s}}catch{throw eM(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${s.modelTopologyBytes}, weightSpecsBytes=${s.weightSpecsBytes}, weightDataBytes=${s.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},r=JSON.parse(this.LS.getItem(this.keys.topology));if(r==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=r;const s=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(s==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=s;const o=this.LS.getItem(this.keys.modelMetadata);if(o!=null){const a=JSON.parse(o);t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,a.signature!=null&&(t.signature=a.signature),a.userDefinedMetadata!=null&&(t.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(t.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(t.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(t.trainingConfig=a.trainingConfig)}const i=this.LS.getItem(this.keys.weightData);if(i==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=Xle(i),t}}Tf.URL_SCHEME="localstorage://";const tM=n=>De().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Tf.URL_SCHEME)?ace(n.slice(Tf.URL_SCHEME.length)):null;To.registerSaveRouter(tM);To.registerLoadRouter(tM);function ace(n){return new Tf(n)}class lce{constructor(){X(De().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),X(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},t=tp+Oc,r=Oc+JO;for(let s=0;s<this.LS.length;++s){const o=this.LS.key(s);if(o.startsWith(t)&&o.endsWith(r)){const i=oce(o);e[i]=JSON.parse(this.LS.getItem(o))}}return e}async removeModel(e){e=ice(e);const t=QO(e);if(this.LS.getItem(t.info)==null)throw new Error(`Cannot find model at path '${e}'`);const r=JSON.parse(this.LS.getItem(t.info));return eM(t),r}}const o_="://";class Ol{constructor(){this.managers={}}static getInstance(){return Ol.instance==null&&(Ol.instance=new Ol),Ol.instance}static registerManager(e,t){X(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(o_)&&(e=e.slice(0,e.indexOf(o_))),X(e.length>0,()=>"scheme must not be an empty string.");const r=Ol.getInstance();X(r.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),r.managers[e]=t}static getManager(e){const t=Ol.getInstance().managers[e];if(t==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys(Ol.getInstance().managers)}}class cce{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${t}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){if(typeof window>"u"||!De().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",r=>{if(r.source===window&&r.data.name===this.messageName){r.stopPropagation();const s=this.functionRefs[r.data.index];s(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return AO(e)}}if(De().get("IS_BROWSER")){De().setPlatform("browser",new cce);try{Ol.registerManager(Tf.URL_SCHEME,new lce)}catch{}try{Ol.registerManager(If.URL_SCHEME,new ece)}catch{}}const uce={importFetch:()=>require("node-fetch")};let c4;class dce{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return De().global.fetch!=null?De().global.fetch(e,t):(c4==null&&(c4=uce.importFetch()),c4(e,t))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}De().get("IS_NODE")&&!De().get("IS_BROWSER")&&De().setPlatform("node",new dce);function $n(n,e="float32",t){return e=e||"float32",Qc(n),new to(n,e,t)}function fce(n,e){const t=se(n,"x","cast");if(!nle(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");const r={x:t},s={dtype:e};return me.runKernel(v1,r,s)}const It=be({cast_:fce});function hce(n){const t={x:se(n,"x","clone","string_or_numeric")};return me.runKernel(D1,t)}const gf=be({clone_:hce});function pce(n,e=!1){console.log(n.toString(e))}zO();const mce={buffer:$n,cast:It,clone:gf,print:pce};Fle(mce);function gce(n,e){let t=se(n,"a","add"),r=se(e,"b","add");[t,r]=ss(t,r);const s={a:t,b:r};return me.runKernel(Zp,s)}const ot=be({add_:gce});function xce(n,e){let t=se(n,"a","floorDiv"),r=se(e,"b","floorDiv");[t,r]=ss(t,r);const s={a:t,b:r};return me.runKernel(_1,s)}const nM=be({floorDiv_:xce});function vce(n,e){let t=se(n,"a","div"),r=se(e,"b","div");if([t,r]=ss(t,r),t.dtype==="int32"&&r.dtype==="int32")return nM(t,r);const s={a:t,b:r},o={};return me.runKernel(k1,s,o)}const ln=be({div_:vce});function yce(n,e){let t=se(n,"a","mul"),r=se(e,"b","mul");[t,r]=ss(t,r);const s={a:t,b:r};return me.runKernel(B1,s)}const fe=be({mul_:yce});function bce(n){const e=se(n,"x","abs");if(e.dtype==="complex64"){const t={x:e};return me.runKernel(Yy,t)}else{const t={x:e};return me.runKernel(Wy,t)}}const Ao=be({abs_:bce});function wce(n){const t={x:se(n,"x","acos")};return me.runKernel(d1,t)}const Cce=be({acos_:wce});function kce(n){const t={x:se(n,"x","acosh")};return me.runKernel(f1,t)}const Sce=be({acosh_:kce});function Nce(n,e=null,t=!1){const s={x:se(n,"x","all","bool")},o={axis:e,keepDims:t};return me.runKernel(sS,s,o)}const rM=be({all_:Nce});function Ece(n,e=null,t=!1){const s={x:se(n,"x","any","bool")},o={axis:e,keepDims:t};return me.runKernel(oS,s,o)}const z5=be({any_:Ece});function Ice(n,e=0){const r={x:se(n,"x","argMax")},s={axis:e};return me.runKernel(Uy,r,s)}const Fg=be({argMax_:Ice});function Tce(n,e=0){const r={x:se(n,"x","argMin")},s={axis:e};return me.runKernel(Hy,r,s)}const _ce=be({argMin_:Tce});function Rce(n){const t={x:se(n,"x","asin")};return me.runKernel(h1,t)}const Dce=be({asin_:Rce});function Ace(n){const t={x:se(n,"x","asinh")};return me.runKernel(p1,t)}const $ce=be({asinh_:Ace});function Fce(n){const t={x:se(n,"x","atan")};return me.runKernel(m1,t)}const Pce=be({atan_:Fce});function Oce(n,e){let t=se(n,"a","atan2"),r=se(e,"b","atan2");[t,r]=ss(t,r);const s={a:t,b:r};return me.runKernel(x1,s)}const Mce=be({atan2_:Oce});function Lce(n){const t={x:se(n,"x","atanh")};return me.runKernel(g1,t)}const jce=be({atanh_:Lce});function i0(n,e,t,r,s="NHWC",o){const i=n[3],a=[...e,i],l=tu(s);return ro(n,a,t,o,r,null,null,l)}function $a(n,e,t,r,s,o,i="channelsLast"){const[a,l]=Pg(e);let c;if(i==="channelsLast")c=[a,l,n[3],n[3]];else if(i==="channelsFirst")c=[a,l,n[1],n[1]];else throw new Error(`Unknown dataFormat ${i}`);return ro(n,c,t,r,s,o,!1,i)}function eu(n,e,t,r,s,o,i="NDHWC"){const[a,l,c]=W5(e);let u,d;if(i==="NDHWC")d="channelsLast",u=[a,l,c,n[4],n[4]];else if(i==="NCDHW")d="channelsFirst",u=[a,l,c,n[1],n[1]];else throw new Error(`Unknown dataFormat ${i}`);return bd(n,u,t,r,s,!1,d,o)}function ro(n,e,t,r,s,o,i=!1,a="channelsLast"){let[l,c,u,d]=[-1,-1,-1,-1];if(a==="channelsLast")[l,c,u,d]=n;else if(a==="channelsFirst")[l,d,c,u]=n;else throw new Error(`Unknown dataFormat ${a}`);const[f,p,,x]=e,[v,y]=Pg(t),[b,w]=Pg(r),S=mp(f,b),k=mp(p,w),{padInfo:N,outHeight:I,outWidth:T}=zce(s,c,u,v,y,S,k,o,a),F=i?x*d:x;let R;return a==="channelsFirst"?R=[l,F,I,T]:a==="channelsLast"&&(R=[l,I,T,F]),{batchSize:l,dataFormat:a,inHeight:c,inWidth:u,inChannels:d,outHeight:I,outWidth:T,outChannels:F,padInfo:N,strideHeight:v,strideWidth:y,filterHeight:f,filterWidth:p,effectiveFilterHeight:S,effectiveFilterWidth:k,dilationHeight:b,dilationWidth:w,inShape:n,outShape:R,filterShape:e}}function bd(n,e,t,r,s,o=!1,i="channelsLast",a){let[l,c,u,d,f]=[-1,-1,-1,-1,-1];if(i==="channelsLast")[l,c,u,d,f]=n;else if(i==="channelsFirst")[l,f,c,u,d]=n;else throw new Error(`Unknown dataFormat ${i}`);const[p,x,v,,y]=e,[b,w,S]=W5(t),[k,N,I]=W5(r),T=mp(p,k),F=mp(x,N),R=mp(v,I),{padInfo:D,outDepth:A,outHeight:P,outWidth:B}=Wce(s,c,u,d,b,w,S,T,F,R,a),L=o?y*f:y;let W;return i==="channelsFirst"?W=[l,L,A,P,B]:i==="channelsLast"&&(W=[l,A,P,B,L]),{batchSize:l,dataFormat:i,inDepth:c,inHeight:u,inWidth:d,inChannels:f,outDepth:A,outHeight:P,outWidth:B,outChannels:L,padInfo:D,strideDepth:b,strideHeight:w,strideWidth:S,filterDepth:p,filterHeight:x,filterWidth:v,effectiveFilterDepth:T,effectiveFilterHeight:F,effectiveFilterWidth:R,dilationDepth:k,dilationHeight:N,dilationWidth:I,inShape:n,outShape:W,filterShape:e}}function Bce(n,e,t,r,s){r==null&&(r=GS(n,e,t));const o=n[0],i=n[1],a=Og((o-e+2*r)/t+1,s),l=Og((i-e+2*r)/t+1,s);return[a,l]}function Vce(n,e,t,r,s,o){s==null&&(s=GS(n,e[0],r[0]));const i=[0,0,0,t];for(let a=0;a<3;a++)n[a]+2*s>=e[a]&&(i[a]=Og((n[a]-e[a]+2*s)/r[a]+1,o));return i}function GS(n,e,t,r=1){const s=mp(e,r);return Math.floor((n[0]*(t-1)-t+s)/2)}function Pg(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function W5(n){return typeof n=="number"?[n,n,n]:n}function mp(n,e){return e<=1?n:n+(n-1)*(e-1)}function zce(n,e,t,r,s,o,i,a,l){let c,u,d;if(typeof n=="number"){c={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};const p=Bce([e,t],o,r,n,a);u=p[0],d=p[1]}else if(n==="same"){u=Math.ceil(e/r),d=Math.ceil(t/s);const f=Math.max(0,(u-1)*r+o-e),p=Math.max(0,(d-1)*s+i-t),x=Math.floor(f/2),v=f-x,y=Math.floor(p/2),b=p-y;c={top:x,bottom:v,left:y,right:b,type:"SAME"}}else if(n==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},u=Math.ceil((e-o+1)/r),d=Math.ceil((t-i+1)/s);else if(typeof n=="object"){const f=l==="channelsLast"?n[1][0]:n[2][0],p=l==="channelsLast"?n[1][1]:n[2][1],x=l==="channelsLast"?n[2][0]:n[3][0],v=l==="channelsLast"?n[2][1]:n[3][1];c={top:f,bottom:p,left:x,right:v,type:f===0&&p===0&&x===0&&v===0?"VALID":"EXPLICIT"},u=Og((e-o+f+p)/r+1,a),d=Og((t-i+x+v)/s+1,a)}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:c,outHeight:u,outWidth:d}}function Wce(n,e,t,r,s,o,i,a,l,c,u){let d,f,p,x;if(n==="valid"&&(n=0),typeof n=="number"){d={top:n,bottom:n,left:n,right:n,front:n,back:n,type:n===0?"VALID":"NUMBER"};const y=Vce([e,t,r,1],[a,l,c],1,[s,o,i],n,u);f=y[0],p=y[1],x=y[2]}else if(n==="same"){f=Math.ceil(e/s),p=Math.ceil(t/o),x=Math.ceil(r/i);const v=(f-1)*s+a-e,y=(p-1)*o+l-t,b=(x-1)*i+c-r,w=Math.floor(v/2),S=v-w,k=Math.floor(y/2),N=y-k,I=Math.floor(b/2),T=b-I;d={top:k,bottom:N,left:I,right:T,front:w,back:S,type:"SAME"}}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:d,outDepth:f,outHeight:p,outWidth:x}}function Og(n,e){if(!e)return Math.trunc(n);switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error(`Unknown roundingMode ${e}`)}}function _f(n){const[e,t,r]=Pg(n);return e===1&&t===1&&r===1}function xo(n,e){return _f(n)||_f(e)}function Rf(n){return Pg(n).every(e=>e>0)}function tu(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${n}`)}function oi(n,e,t){if(t!=null){if(typeof e=="string")throw Error(`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);if(typeof e=="number")X(_p(e),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);else if(typeof e=="object")e.forEach(r=>{r.forEach(s=>{X(_p(s),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${s}.`)})});else throw Error(`Error in ${n}: Unknown padding parameter: ${e}`)}}function Uce(n,e){const r={x:se(n,"x","reshape","string_or_numeric")},s={shape:e};return me.runKernel(Rb,r,s)}const ye=be({reshape_:Uce});function Hce(n,e,t,r,s){const o=se(n,"x","avgPool","float32"),i=1;X(xo(t,i),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`);let a=o,l=!1;o.rank===3&&(l=!0,a=ye(o,[1,o.shape[0],o.shape[1],o.shape[2]])),X(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),oi("avgPool",r,s);const c={x:a},u={filterSize:e,strides:t,pad:r,dimRoundingMode:s};let d=me.runKernel(Gy,c,u);return d=It(d,o.dtype),l?ye(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const qS=be({avgPool_:Hce});function Gce(n,e,t,r,s,o="NDHWC"){const i=se(n,"x","avgPool3d","float32");let a=i,l=!1;i.rank===4&&(l=!0,a=ye(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),X(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),X(o==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`),X(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${t}'`),oi("avgPool3d",r,s);const c={x:a},u={filterSize:e,strides:t,pad:r,dimRoundingMode:s,dataFormat:o};let d=me.runKernel(qy,c,u);return d=It(d,a.dtype),l?ye(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const qce=be({avgPool3d_:Gce});function Kce(n,e=0){X(n.length>=1,()=>"Pass at least one tensor to concat");const t=GO(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(o=>{if(o.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${o.dtype}. `)}),t.length===1)return gf(t[0]);const r=t,s={axis:e};return me.runKernel(Zy,r,s)}const ei=be({concat_:Kce});function Xce(n,e,t=!1,r=!1){let s=se(n,"a","matMul"),o=se(e,"b","matMul");[s,o]=ss(s,o);const i={a:s,b:o},a={transposeA:t,transposeB:r};return me.runKernel(Ky,i,a)}const or=be({matMul_:Xce});function Yce(n){const t={x:se(n,"x","sigmoid","float32")};return me.runKernel(Z1,t)}const Qp=be({sigmoid_:Yce});function Zce(n,e,t){const r=se(n,"x","slice","string_or_numeric");if(r.rank===0)throw new Error("Slicing scalar is not possible");const s={x:r},o={begin:e,size:t};return me.runKernel(Pb,s,o)}const Ir=be({slice_:Zce});function Jce(n){const t={x:se(n,"x","tanh","float32")};return me.runKernel(r0,t)}const Gb=be({tanh_:Jce});function Qce(n,e,t){const r=se(n,"x","batchToSpaceND"),s=e.reduce((a,l)=>a*l);X(r.rank>=1+e.length,()=>`input rank is ${r.rank} but should be > than blockShape.length ${e.length}`),X(t.length===e.length,()=>`crops.length is ${t.length} but should be equal to blockShape.length  ${e.length}`),X(r.shape[0]%s===0,()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${s}`);const o={x:r},i={blockShape:e,crops:t};return me.runKernel(Xy,o,i)}const KS=be({batchToSpaceND_:Qce});function eue(n){let e;return n.rank===0||n.rank===1?e=ye(n,[1,1,1,n.size]):n.rank===2?e=ye(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?e=ye(n,[1,n.shape[0],n.shape[1],n.shape[2]]):e=n,e}function tue(n,e,t,r,s,o){o==null&&(o=.001);const i=se(n,"x","batchNorm"),a=se(e,"mean","batchNorm"),l=se(t,"variance","batchNorm");let c;s!=null&&(c=se(s,"scale","batchNorm"));let u;r!=null&&(u=se(r,"offset","batchNorm")),X(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),X(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),X(c==null||a.rank===c.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const f={x:eue(i),scale:c,offset:u,mean:a,variance:l},p={varianceEpsilon:o},x=me.runKernel(ib,f,p);return ye(x,i.shape)}const qb=be({batchNorm_:tue});function nue(n,e,t,r,s,o){const i=se(n,"x","batchNorm"),a=se(e,"mean","batchNorm"),l=se(t,"variance","batchNorm");let c;s!=null&&(c=se(s,"scale","batchNorm"));let u;return r!=null&&(u=se(r,"offset","batchNorm")),X(i.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${i.rank}.`),X(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),X(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),c!=null&&X(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${c.rank}.`),u!=null&&X(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${u.rank}.`),qb(i,a,l,u,c,o)}const rue=be({batchNorm2d_:nue});function sue(n,e,t,r,s,o){const i=se(n,"x","batchNorm"),a=se(e,"mean","batchNorm"),l=se(t,"variance","batchNorm");let c;s!=null&&(c=se(s,"scale","batchNorm"));let u;return r!=null&&(u=se(r,"offset","batchNorm")),X(i.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${i.rank}.`),X(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),X(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),c!=null&&X(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${c.rank}.`),u!=null&&X(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${u.rank}.`),qb(i,a,l,u,c,o)}const oue=be({batchNorm3d_:sue});function iue(n,e,t,r,s,o){const i=se(n,"x","batchNorm"),a=se(e,"mean","batchNorm"),l=se(t,"variance","batchNorm");let c;s!=null&&(c=se(s,"scale","batchNorm"));let u;return r!=null&&(u=se(r,"offset","batchNorm")),X(i.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${i.rank}.`),X(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),X(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),c!=null&&X(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${c.rank}.`),u!=null&&X(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${u.rank}.`),qb(i,a,l,u,c,o)}const aue=be({batchNorm4d_:iue});function lue(n,e,t){const r=se(n,"x","bincount"),s=se(e,"weights","bincount");X(r.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`),X(t>=0,()=>`size must be non-negative, but got ${t}.`),X(s.size===r.size||s.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${s.shape}.`);const o={x:r,weights:s},i={size:t};return me.runKernel(lS,o,i)}const cue=be({bincount_:lue});function uue(n,e){let t=se(n,"broadcastTo","x");const r=t.shape;if(Qc(e),e.length<t.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${t.rank}.`);if(e.length>t.rank){const c=t.shape.slice();for(;c.length<e.length;)c.unshift(1);t=ye(t,c)}const s=t.shape,o=Array.from(e);for(let c=e.length-1;c>=0;c--)if(s[c]===e[c])o[c]=1;else if(t.shape[c]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${e}].`);if(o.map((c,u)=>c>1?u:-1).filter(c=>c>=0).length===0)return gf(t);const a={x:t},l={reps:o};return me.runKernel(s0,a,l)}const pg=be({broadcastTo_:uue});function due(n){const t={x:se(n,"x","ceil","float32")};return me.runKernel(y1,t)}const fue=be({ceil_:due});function Kb(n,e,t){Qc(n),t=t||Xp(e);const r={shape:n,value:e,dtype:t};return me.runKernel(kS,{},r)}function hue(n,e,t){const r=se(n,"x","clipByValue");if(X(e<=t,()=>`Error in clip: min (${e}) must be less than or equal to max (${t}).`),e===t)return Kb(r.shape,e,r.dtype);const s={x:r},o={clipValueMin:e,clipValueMax:t};return me.runKernel(b1,s,o)}const na=be({clipByValue_:hue});function pue(n){return ei(n,0)}const mue=be({concat1d_:pue});function gue(n,e){return ei(n,e)}const xue=be({concat2d_:gue});function vue(n,e){return ei(n,e)}const yue=be({concat3d_:vue});function bue(n,e){return ei(n,e)}const wue=be({concat4d_:bue});function Cue(n,e,t,r,s="NHWC",o=[1,1],i){const a=se(n,"x","conv2d","float32"),l=se(e,"filter","conv2d","float32");let c=a,u=!1;a.rank===3&&(u=!0,c=ye(a,[1,a.shape[0],a.shape[1],a.shape[2]])),X(c.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`),X(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),oi("conv2d",r,i);const d=s==="NHWC"?c.shape[3]:c.shape[1];X(d===l.shape[2],()=>`Error in conv2d: depth of input (${d}) must match input depth for filter ${l.shape[2]}.`),X(xo(t,o),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),X(Rf(o),()=>"Error in conv2D: Dilated rates should be larger than 0."),X(Rf(t),()=>"Error in conv2D: Strides should be larger than 0.");const f={x:c,filter:l},p={strides:t,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i},x=me.runKernel(Jy,f,p);return u?ye(x,[x.shape[1],x.shape[2],x.shape[3]]):x}const Df=be({conv2d_:Cue});function kue(n,e,t,r,s="NWC",o=1,i){const a=se(n,"x","conv1d"),l=se(e,"filter","conv1d");let c=a,u=!1;a.rank===2&&(u=!0,c=ye(a,[1,a.shape[0],a.shape[1]])),X(c.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`),X(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),oi("conv1d",r,i),X(c.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${l.shape[1]}.`),X(xo(t,o),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${t} and dilation '${o}'`),X(Rf(o),()=>"Error in conv1D: Dilated rates should be larger than 0."),X(Rf(t),()=>"Error in conv1D: Stride should be larger than 0."),X(s==="NWC",()=>`Error in conv1d: got dataFormat of ${s} but only NWC is currently supported.`);const d=ye(l,[1,l.shape[0],l.shape[1],l.shape[2]]),f=ye(c,[c.shape[0],1,c.shape[1],c.shape[2]]),y=Df(f,d,[1,t],r,"NHWC",[1,o],i);return u?ye(y,[y.shape[2],y.shape[3]]):ye(y,[y.shape[0],y.shape[2],y.shape[3]])}const sM=be({conv1d_:kue});function Sue(n,e,t,r,s,o="NHWC",i){X(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let a=n,l=e,c=!1;e.rank===3&&(c=!0,l=ye(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,n[0],n[1],n[2]]),X(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),X(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),X(t.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${t.rank}`);const u=o==="NHWC"?a[3]:a[1],d=o==="NHWC"?l.shape[3]:l.shape[1];X(u===t.shape[2],()=>`Error in conv2dDerInput: depth of input (${u}) must match input depth for filter ${t.shape[2]}.`),X(d===t.shape[3],()=>`Error in conv2dDerInput: depth of output (${d}) must match output depth for filter ${t.shape[3]}.`),oi("conv2dDerInput",s,i);const f={dy:l,filter:t},p={strides:r,pad:s,dataFormat:o,dimRoundingMode:i,inputShape:a},x=me.runKernel(Qy,f,p);return c?ye(x,[x.shape[1],x.shape[2],x.shape[3]]):x}const XS=be({conv2DBackpropInput_:Sue});function Nue(n,e,t,r,s,o){const i=se(n,"x","conv2dTranspose"),a=se(e,"filter","conv2dTranspose");return XS(t,i,a,r,s,"NHWC",o)}const oM=be({conv2dTranspose_:Nue});function Eue(n,e,t,r,s="NDHWC",o=[1,1,1]){const i=se(n,"x","conv3d"),a=se(e,"filter","conv3d");let l=i,c=!1;i.rank===4&&(c=!0,l=ye(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),X(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),X(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),X(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),X(xo(t,o),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),X(s==="NDHWC",()=>`Error in conv3d: got dataFormat of ${s} but only NDHWC is currently supported.`),X(Rf(o),()=>"Error in conv3D: Dilated rates should be larger than 0."),X(Rf(t),()=>"Error in conv3D: Strides should be larger than 0.");const u={x:l,filter:a},d={strides:t,pad:r,dataFormat:s,dilations:o},f=me.runKernel(eb,u,d);return c?ye(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const Iue=be({conv3d_:Eue});function Tue(n,e,t,r,s){X(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let o=n,i=e,a=!1;e.rank===4&&(a=!0,i=ye(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),o=[1,n[0],n[1],n[2],n[3]]);const l=o[4],c=i.shape[4];X(o.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${o.length}.`),X(i.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${i.rank}`),X(t.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${t.rank}`),X(l===t.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${t.shape[3]}.`),X(c===t.shape[4],()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${t.shape[4]}.`);const u={dy:i,filter:t},d={pad:s,strides:r,inputShape:o},f=me.runKernel(hS,u,d);return a?ye(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const iM=be({conv3DBackpropInput_:Tue});function _ue(n,e,t,r,s){const o=se(n,"x","conv3dTranspose"),i=se(e,"filter","conv3dTranspose");return iM(t,o,i,r,s)}const Rue=be({conv3dTranspose_:_ue});function Due(n){const t={x:se(n,"x","cos","float32")};return me.runKernel(w1,t)}const YS=be({cos_:Due});function Aue(n){const t={x:se(n,"x","cosh","float32")};return me.runKernel(C1,t)}const aM=be({cosh_:Aue});function $ue(n,e=0,t=!1,r=!1){const o={x:se(n,"x","cumprod")},i={axis:e,exclusive:t,reverse:r};return me.runKernel(pS,o,i)}const U5=be({cumprod_:$ue});function Fue(n,e=0,t=!1,r=!1){const o={x:se(n,"x","cumsum")},i={axis:e,exclusive:t,reverse:r};return me.runKernel(tb,o,i)}const lM=be({cumsum_:Fue});function Pue(n,e,t,r=!1){const s=se(n,"x","denseBincount"),o=se(e,"weights","denseBincount");X(s.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${s.dtype}`),X(s.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${s.rank}.`),X(t>=0,()=>`size must be non-negative, but got ${t}.`),X(o.size===s.size||o.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${s.shape}, weights shape: ${o.shape}.`);const i={x:s,weights:o},a={size:t,binaryOutput:r};return me.runKernel(gS,i,a)}const i_=be({denseBincount_:Pue});function Oue(n,e,t="NHWC"){const r=se(n,"x","depthToSpace","float32"),s=t==="NHWC"?r.shape[1]:r.shape[2],o=t==="NHWC"?r.shape[2]:r.shape[3],i=t==="NHWC"?r.shape[3]:r.shape[1];X(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),X(s*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${s} and ${e}  for depthToSpace with input shape
    ${r.shape}`),X(o*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${o} and ${e} for depthToSpace with input shape
        ${r.shape}`),X(i%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${i} for depthToSpace with input shape ${r.shape}`);const a={x:r},l={blockSize:e,dataFormat:t};return me.runKernel(xS,a,l)}const Mue=be({depthToSpace_:Oue});function Lue(n,e,t,r,s="NHWC",o=[1,1],i){const a=se(n,"x","depthwiseConv2d","float32"),l=se(e,"filter","depthwiseConv2d","float32");let c=a,u=!1;a.rank===3&&(u=!0,c=ye(a,[1,a.shape[0],a.shape[1],a.shape[2]])),X(c.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`),X(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);const d=s==="NHWC"?c.shape[3]:c.shape[1];X(d===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${d}) must match the inChannels dimension in filter ${l.shape[2]}.`),oi("depthwiseConv2d",r,i);const f={x:c,filter:l},p={strides:t,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i},x=me.runKernel(nb,f,p);return u?ye(x,[x.shape[1],x.shape[2],x.shape[3]]):x}const ZS=be({depthwiseConv2d_:Lue});function jue(n,e,t,r,s=[1,1],o="NHWC"){const i=se(n,"x","dilation2d"),a=se(e,"filter","dilation2d");X(i.rank===3||i.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${i.rank}.`),X(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),X(o==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${o}`);let l=i,c=!1;i.rank===3&&(l=ye(i,[1,i.shape[0],i.shape[1],i.shape[2]]),c=!0),X(l.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${a.shape[2]}`);const u={x:l,filter:a},d={strides:t,pad:r,dilations:s},f=me.runKernel(rb,u,d);return c?ye(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const Bue=be({dilation2d_:jue});function Ap(n,e){const t=n.length,r=[];for(let s=0;s<t;s++){const o=t-1-s,i=n[o]||1;(e[e.length-1-s]||1)>1&&i===1&&r.unshift(o)}return r}function Es(n,e){const t=[];for(let r=0;r<e.length;r++){const s=n[n.length-r-1],o=e.length-r-1,i=e[o];(s==null||s===1&&i>1)&&t.unshift(o)}return t}function Sn(n,e){const t=Math.max(n.length,e.length),r=new Array(t);for(let s=0;s<t;s++){let o=n[n.length-s-1];o==null&&(o=1);let i=e[e.length-s-1];if(i==null&&(i=1),o===1)r[t-s-1]=i;else if(i===1)r[t-s-1]=o;else if(o!==i){const a=`Operands could not be broadcast together with shapes ${n} and ${e}.`;throw Error(a)}else r[t-s-1]=o}return r}function Vue(n,e){let t=se(n,"a","equal","string_or_numeric"),r=se(e,"b","equal","string_or_numeric");[t,r]=ss(t,r),Sn(t.shape,r.shape);const s={a:t,b:r};return me.runKernel(sb,s)}const ac=be({equal_:Vue});function zue(n,e,t){const r=se(e,"a","where"),s=se(t,"b","where"),o=se(n,"condition","where","bool"),i=Sn(Sn(o.shape,r.shape),s.shape),a=pg(o,i),l=pg(r,i),c=pg(s,i),u={condition:a,t:l,e:c};return me.runKernel(Fb,u)}const Vo=be({where_:zue});function Wue(n){const t={x:se(n,"x","zerosLike")};return me.runKernel(zb,t)}const Gn=be({zerosLike_:Wue});function Uue(n,e){let t=se(n,"a","div"),r=se(e,"b","div");[t,r]=ss(t,r);const s=ln(t,r),o=Gn(s),i=ac(r,o);return Vo(i,o,s)}const Hue=be({divNoNan_:Uue});function Gue(n,e){const t=se(n,"t1","dot"),r=se(e,"t2","dot");X((t.rank===1||t.rank===2)&&(r.rank===1||r.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${t.rank} and ${r.rank}.`);const s=t.rank===1?t.size:t.shape[1],o=r.rank===1?r.size:r.shape[0];if(X(s===o,()=>`Error in dot: inner dimensions of inputs must match, but got ${s} and ${o}.`),t.rank===1&&r.rank===1){const i=ye(t,[1,-1]),a=ye(r,[-1,1]),l=or(i,a);return ye(l,[])}else if(t.rank===1&&r.rank===2){const i=ye(t,[1,-1]),a=ye(r,[r.shape[0],r.shape[1]]),l=or(i,a);return ye(l,[l.size])}else if(t.rank===2&&r.rank===1){const i=ye(r,[-1,1]),a=or(t,i);return ye(a,[a.size])}else{const i=ye(r,[r.shape[0],r.shape[1]]);return or(t,i)}}const que=be({dot_:Gue});function Kue(n,...e){const t=e.map((s,o)=>se(s,`tensors${o}`,"einsum")),r={equation:n};return me.runKernel(bS,t,r)}const Ym=be({einsum_:Kue});function Xue(n){const t={x:se(n,"x","elu","float32")};return me.runKernel(S1,t)}const Xb=be({elu_:Xue});function Yue(n){let e=se(n,"x","erf");X(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=It(e,"float32"));const t={x:e};return me.runKernel(N1,t)}const cM=be({erf_:Yue});function JS(n,e){for(let t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function uM(n,e,t){const r=n.length+e.length,s=[];let o=0,i=0;for(let a=0;a<r;a++)t.indexOf(a)===-1?s.push(n[o++]):s.push(e[i++]);return s}function Ws(n,e){const t=[],r=n.length;for(let o=0;o<r;o++)e.indexOf(o)===-1&&t.push(n[o]);const s=e.map(o=>n[o]);return[t,s]}function ps(n,e){const t=e.map(r=>1);return uM(n,t,e)}function so(n,e,t){X(JS(e,t),()=>`${n} supports only inner-most axes for now. Got axes ${e} and rank-${t} input.`)}function Ur(n,e){if(JS(n,e))return null;const t=[];for(let r=0;r<e;++r)n.indexOf(r)===-1&&t.push(r);return n.forEach(r=>t.push(r)),t}function wd(n){return n.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function os(n,e){const t=[];for(let r=e-n;r<e;++r)t.push(r);return t}function Zue(n,e=null,t=!1){const s={x:se(n,"x","max")},o={reductionIndices:e,keepDims:t};return me.runKernel(gb,s,o)}const al=be({max_:Zue});function Jue(n,e=null,t=!1){const s={x:se(n,"x","min")},o={axis:e,keepDims:t};return me.runKernel(bb,s,o)}const L2=be({min_:Jue});function Que(n,e){let t=se(n,"base","pow"),r=se(e,"exp","pow");[t,r]=ss(t,r);const s={a:t,b:r};return me.runKernel(V1,s)}const Af=be({pow_:Que});function ar(n,e){if((_a(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&_a(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Hb(n,[],[],e)}function ede(n){const t={x:se(n,"x","sqrt","float32")};return me.runKernel(Q1,t)}const go=be({sqrt_:ede});function tde(n){const e=se(n,"x","square"),t={};return me.runKernel("Square",{x:e},t)}const Ar=be({square_:tde});function nde(n,e=null,t=!1){let r=se(n,"x","sum");r.dtype==="bool"&&(r=It(r,"int32"));const s={x:r},o={axis:e,keepDims:t};return me.runKernel(Ob,s,o)}const on=be({sum_:nde});function rde(n,e="euclidean",t=null,r=!1){n=se(n,"x","norm");const s=dM(n,e,t);let o=s.shape;if(r){const i=Fn(t,n.shape);o=ps(s.shape,i)}return ye(s,o)}function dM(n,e,t=null){if(n.rank===0)return Ao(n);if(n.rank!==1&&t===null)return dM(ye(n,[-1]),e,t);if(n.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return on(Ao(n),t);if(e===1/0)return al(Ao(n),t);if(e===-1/0)return L2(Ao(n),t);if(e==="euclidean"||e===2)return go(on(Af(Ao(n),ar(2,"int32")),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(t)&&t.length===2){if(e===1)return al(on(Ao(n),t[0]),t[1]-1);if(e===1/0)return al(on(Ao(n),t[1]),t[0]);if(e===-1/0)return L2(on(Ao(n),t[1]),t[0]);if(e==="fro"||e==="euclidean")return go(on(Ar(n),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${t}`)}const Yb=be({norm_:rde});function sde(n,e=null,t=!1){return Yb(n,"euclidean",e,t)}const ode=be({euclideanNorm_:sde});function ide(n){const t={x:se(n,"x","exp")};return me.runKernel(E1,t)}const lc=be({exp_:ide});function ade(n,e=0){const t=se(n,"x","expandDims","string_or_numeric");X(e<=t.rank,()=>"Axis must be <= rank of the tensor");const r={input:t},s={dim:e};return me.runKernel(ob,r,s)}const Jo=be({expandDims_:ade});function lde(n){const t={x:se(n,"x","expm1")};return me.runKernel(I1,t)}const cde=be({expm1_:lde});function ude(n,e){const t=se(n,"x","tile","string_or_numeric");X(t.rank===e.length,()=>`Error in transpose: rank of input ${t.rank} must match length of reps ${e}.`);const r={x:t},s={reps:e};return me.runKernel(s0,r,s)}const sl=be({tile_:ude});function dde(n,e,t,r="float32"){e==null&&(e=n);const s=$n([n,e],r),o=n<=e?n:e;for(let a=0;a<o;++a)s.set(1,a,a);const i=ye(s.toTensor(),[n,e]);if(t==null)return i;if(t.length===1)return sl(Jo(i,0),[t[0],1,1]);if(t.length===2)return sl(Jo(Jo(i,0),0),[t[0],t[1],1,1]);if(t.length===3)return sl(Jo(Jo(Jo(i,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${t.length}D.`)}const fM=be({eye_:dde});function fde(n){const t={x:se(n,"x","floor","float32")};return me.runKernel(T1,t)}const Zb=be({floor_:fde});function hde(n,e,t=0,r=0){const s=se(n,"x","gather"),o=se(e,"indices","gather","int32"),i={x:s,indices:o},a={axis:t,batchDims:r};return me.runKernel(ab,i,a)}const QS=be({gather_:hde});function pde(n,e){let t=se(n,"a","greater","string_or_numeric"),r=se(e,"b","greater","string_or_numeric");[t,r]=ss(t,r),Sn(t.shape,r.shape);const s={a:t,b:r};return me.runKernel(lb,s)}const sa=be({greater_:pde});function mde(n,e){let t=se(n,"a","greaterEqual","string_or_numeric"),r=se(e,"b","greaterEqual","string_or_numeric");[t,r]=ss(t,r),Sn(t.shape,r.shape);const s={a:t,b:r};return me.runKernel(R1,s)}const Kf=be({greaterEqual_:mde});function gde(n){const t={input:se(n,"input","imag")};return me.runKernel(ES,t)}const e8=be({imag_:gde});function xde(n){const t={x:se(n,"x","isFinite")};return me.runKernel(A1,t)}const vde=be({isFinite_:xde});function yde(n){const t={x:se(n,"x","isInf")};return me.runKernel($1,t)}const bde=be({isInf_:yde});function wde(n){const t={x:se(n,"x","isNaN")};return me.runKernel(F1,t)}const Cde=be({isNaN_:wde});function kde(n,e=.2){const r={x:se(n,"x","leakyRelu")},s={alpha:e};return me.runKernel(cb,r,s)}const t8=be({leakyRelu_:kde});function Sde(n,e){let t=se(n,"a","less","string_or_numeric"),r=se(e,"b","less","string_or_numeric");[t,r]=ss(t,r),Sn(t.shape,r.shape);const s={a:t,b:r};return me.runKernel(ub,s)}const j2=be({less_:Sde});function Nde(n,e){let t=se(n,"a","lessEqual","string_or_numeric"),r=se(e,"b","lessEqual","string_or_numeric");[t,r]=ss(t,r),Sn(t.shape,r.shape);const s={a:t,b:r};return me.runKernel(db,s)}const em=be({lessEqual_:Nde});function Ede(n,e=5,t=1,r=1,s=.5){const o=se(n,"x","localResponseNormalization");X(o.rank===4||o.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${o.rank}.`),X(_p(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let i=o,a=!1;o.rank===3&&(a=!0,i=ye(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const l={x:i},c={depthRadius:e,bias:t,alpha:r,beta:s},u=me.runKernel(mb,l,c);return a?ye(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const Ide=be({localResponseNormalization_:Ede});function Tde(n){const t={x:se(n,"x","log","float32")};return me.runKernel(P1,t)}const cc=be({log_:Tde});function _de(n){const t={x:se(n,"x","log1p")};return me.runKernel(O1,t)}const hM=be({log1p_:_de});function Rde(n,e){X(_5(n),()=>"The f passed in variableGrads(f) must be a function"),X(e==null||Array.isArray(e)&&e.every(c=>c instanceof M2),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const t=e!=null;if(!t){e=[];for(const c in me.registeredVariables)e.push(me.registeredVariables[c])}const r=t?e.filter(c=>!c.trainable):null,s=e.length;e=e.filter(c=>c.trainable),X(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${s} variables is trainable.`);const o=!0,{value:i,grads:a}=me.gradients(n,e,null,o);X(a.some(c=>c!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),X(i.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${i.rank} tensor`);const l={};return e.forEach((c,u)=>{a[u]!=null&&(l[c.name]=a[u])}),r?.forEach(c=>l[c.name]=null),{value:i,grads:l}}function $p(n){return me.customGrad(n)}function Dde(n){const t={x:se(n,"x","neg")};return me.runKernel(Cb,t)}const rs=be({neg_:Dde});function Ade(n){const t={x:se(n,"x","softplus")};return me.runKernel(J1,t)}const a0=be({softplus_:Ade});function $de(n){const e=se(n,"x","logSigmoid");return $p(r=>({value:rs(a0(rs(r))),gradFunc:i=>fe(i,Qp(rs(r)))}))(e)}const Fde=be({logSigmoid_:$de});function Pde(n,e){let t=se(n,"a","sub"),r=se(e,"b","sub");[t,r]=ss(t,r);const s={a:t,b:r};return me.runKernel(t0,s)}const hn=be({sub_:Pde});function Ode(n,e=-1){const t=se(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and axis was ${e}`);return $p((s,o)=>{const a=al(s,e,!0),l=hn(s,a),c=hn(It(l,"float32"),cc(on(lc(l),e,!0)));return o([c]),{value:c,gradFunc:(d,f)=>{const[p]=f,x=!0,v=lc(p);return hn(d,fe(on(d,e,x),v))}}})(t)}const pM=be({logSoftmax_:Ode});function Mde(n,e=null,t=!1){const r=se(n,"x","logSumExp"),s=Fn(e,r.shape),o=al(r,s,!0),i=hn(r,o),a=lc(i),l=on(a,s),c=cc(l),u=ot(ye(o,c.shape),c);if(t){const d=ps(u.shape,s);return ye(u,d)}return u}const mM=be({logSumExp_:Mde});function Lde(n,e){const t=se(n,"a","logicalAnd","bool"),r=se(e,"b","logicalAnd","bool");Sn(t.shape,r.shape);const s={a:t,b:r};return me.runKernel(fb,s)}const Wc=be({logicalAnd_:Lde});function jde(n){const t={x:se(n,"x","logicalNot","bool")};return me.runKernel(hb,t)}const n8=be({logicalNot_:jde});function Bde(n,e){const t=se(n,"a","logicalOr","bool"),r=se(e,"b","logicalOr","bool");Sn(t.shape,r.shape);const s={a:t,b:r};return me.runKernel(pb,s)}const gM=be({logicalOr_:Bde});function Vde(n,e){const t=se(n,"a","logicalXor","bool"),r=se(e,"b","logicalXor","bool");return Sn(t.shape,r.shape),Wc(gM(n,e),n8(Wc(n,e)))}const zde=be({logicalXor_:Vde});function Wde(n,e,t,r,s){const o=se(n,"x","maxPool"),i=1;let a=o,l=!1;o.rank===3&&(l=!0,a=ye(o,[1,o.shape[0],o.shape[1],o.shape[2]])),X(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),X(xo(t,i),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),oi("maxPool",r,s);const c={x:a},u={filterSize:e,strides:t,pad:r,dimRoundingMode:s},d=me.runKernel(xb,c,u);return l?ye(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const r8=be({maxPool_:Wde});function Ude(n,e=[1,1,1],t,r,s,o="NDHWC"){const i=se(n,"x","maxPool3d");let a=i,l=!1;i.rank===4&&(l=!0,a=ye(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),X(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),X(o==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`),oi("maxPool3d",r,s);const c={x:a},u={filterSize:e,strides:t,pad:r,dimRoundingMode:s,dataFormat:o},d=me.runKernel(vb,c,u);return l?ye(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const Hde=be({maxPool3d_:Ude});function Gde(n,e){let t=se(n,"a","maximum"),r=se(e,"b","maximum");[t,r]=ss(t,r),t.dtype==="bool"&&(t=It(t,"int32"),r=It(r,"int32")),Sn(t.shape,r.shape);const s={a:t,b:r};return me.runKernel(M1,s)}const Cd=be({maximum_:Gde});function qde(n,e=null,t=!1){const s={x:se(n,"x","mean")},o={axis:e,keepDims:t};return me.runKernel(yb,s,o)}const fs=be({mean_:qde});function Ps(n,e="float32"){if(Qc(n),e==="complex64"){const r=Ps(n,"float32"),s=Ps(n,"float32");return Dp(r,s)}const t=mo(Le(n),e);return me.makeTensor(t,n,e)}function kd(n,e="float32"){if(Qc(n),e==="complex64"){const r=kd(n,"float32"),s=Ps(n,"float32");return Dp(r,s)}const t=eS(Le(n),e);return me.makeTensor(t,n,e)}function Kde(n,e){let t=se(n,"a","minimum"),r=se(e,"b","minimum");[t,r]=ss(t,r),t.dtype==="bool"&&(t=It(t,"int32"),r=It(r,"int32")),Sn(t.shape,r.shape);const s={a:t,b:r};return me.runKernel(L1,s)}const Mg=be({minimum_:Kde});function Xde(n,e,t){X(t==="reflect"||t==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${t}.`);const r=se(n,"x","mirrorPad");if(r.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");X(e.length===r.rank,()=>`Padding doesn't match input. Must be ${r.rank}. Got ${e.length}.`);const s=t==="reflect"?1:0;for(let a=0;a<r.rank;a++)X(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),X(e[a][0]>=0&&e[a][0]<=r.shape[a]-s&&e[a][1]>=0&&e[a][1]<=r.shape[a]-s,()=>`Padding in dimension ${a} cannot be greater than or equal to ${r.shape[a]-s} or less than 0 for input of shape ${r.shape}`);const o={paddings:e,mode:t},i={x:r};return me.runKernel(wb,i,o)}const Yde=be({mirrorPad_:Xde});function Zde(n,e){let t=se(n,"a","mod"),r=se(e,"b","mod");[t,r]=ss(t,r);const s={a:t,b:r};return me.runKernel(j1,s)}const Jde=be({mod_:Zde});function Qde(n,e=null,t=!1){n=se(n,"x","moments");const r=Fn(e,n.shape),s=fs(n,r,t);let o=s.shape;t||(o=ps(s.shape,r));const i=Ar(hn(It(n,"float32"),ye(s,o))),a=fs(i,r,t);return{mean:s,variance:a}}const s8=be({moments_:Qde});function efe(n,e){let t=se(n,"a","notEqual","string_or_numeric"),r=se(e,"b","notEqual","string_or_numeric");[t,r]=ss(t,r),Sn(t.shape,r.shape);const s={a:t,b:r};return me.runKernel(kb,s)}const B2=be({notEqual_:efe});function tfe(n,e,t=1,r=0,s="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const i={indices:se(n,"indices","oneHot","int32")},a={dtype:s,depth:e,onValue:t,offValue:r};return me.runKernel(Nb,i,a)}const xM=be({oneHot_:tfe});function nfe(n){const t={x:se(n,"x","onesLike")};return me.runKernel(Sb,t)}const Ra=be({onesLike_:nfe});function rfe(n,e,t=0){const r=se(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const s={paddings:e,constantValue:t},o={x:r};return me.runKernel(Ib,o,s)}const o8=be({pad_:rfe});function sfe(n,e,t){const r=se(n,"x","spaceToBatchND");X(r.rank>=1+e.length,()=>`input rank ${r.rank} should be > than [blockShape] ${e.length}`),X(t.length===e.length,()=>`paddings.shape[0] ${t.length} must be equal to [blockShape] ${e.length}`),X(r.shape.reduce((i,a,l)=>l>0&&l<=e.length?i&&(a+t[l-1][0]+t[l-1][1])%e[l-1]===0:i,!0),()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${t.toString()} must be divisible by blockShapes ${e.toString()}`);const s={x:r},o={blockShape:e,paddings:t};return me.runKernel(Mb,s,o)}const i8=be({spaceToBatchND_:sfe});function ofe(n,e,t,r,s,o,i){s==null&&(s=[1,1]),o==null&&(o=1),r===0&&(r="valid");const a=se(n,"x","maxPool");let l=a,c=!1;a.rank===3&&(c=!0,l=ye(a,[1,a.shape[0],a.shape[1],a.shape[2]])),X(xo(o,s),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${o} and dilations '${s}'`);const u=$a(l.shape,e,o,s,r),d=[u.dilationHeight,u.dilationWidth];let f;r==="same"?f=afe([u.filterHeight,u.filterWidth],d):f=[[0,0],[0,0]];const p=d[0]===1&&d[1]===1,[x,v]=ife([u.inHeight,u.inWidth],d,f),y=p?r:"valid",b=p?l:i8(l,d,x),S=(t==="avg"?()=>qS(b,e,o,y,i):()=>r8(b,e,o,y,i))(),k=p?S:KS(S,d,v);return c?ye(k,[k.shape[1],k.shape[2],k.shape[3]]):k}function ife(n,e,t){const r=t.map(u=>u[0]),s=t.map(u=>u[1]),o=n.concat(r,s),i=e.map((u,d)=>(u-o[d]%u)%u),a=s.map((u,d)=>u+i[d]),l=e.map((u,d)=>[r[d],a[d]]),c=e.map((u,d)=>[0,i[d]]);return[l,c]}function afe(n,e){const r=n.map((i,a)=>i+(i-1)*(e[a]-1)).map(i=>i-1),s=r.map(i=>Math.floor(i/2)),o=r.map((i,a)=>i-s[a]);return r.map((i,a)=>[s[a],o[a]])}const lfe=be({pool_:ofe});function cfe(n,e){const t=se(n,"x","prelu"),r=se(e,"alpha","prelu"),s={x:t,alpha:r};return me.runKernel(Tb,s)}const a8=be({prelu_:cfe});function ufe(n,e=null,t=!1){let r=se(n,"x","prod");r.dtype==="bool"&&(r=It(r,"int32"));const s={x:r},o={axis:e,keepDims:t};return me.runKernel(_b,s,o)}const dfe=be({prod_:ufe});var jv={exports:{}},ffe=jv.exports,a_;function hfe(){return a_||(a_=1,(function(n){(function(e,t,r){function s(l){var c=this,u=a();c.next=function(){var d=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=d-(c.c=d|0)},c.c=1,c.s0=u(" "),c.s1=u(" "),c.s2=u(" "),c.s0-=u(l),c.s0<0&&(c.s0+=1),c.s1-=u(l),c.s1<0&&(c.s1+=1),c.s2-=u(l),c.s2<0&&(c.s2+=1),u=null}function o(l,c){return c.c=l.c,c.s0=l.s0,c.s1=l.s1,c.s2=l.s2,c}function i(l,c){var u=new s(l),d=c&&c.state,f=u.next;return f.int32=function(){return u.next()*4294967296|0},f.double=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.quick=f,d&&(typeof d=="object"&&o(d,u),f.state=function(){return o(u,{})}),f}function a(){var l=4022871197,c=function(u){u=String(u);for(var d=0;d<u.length;d++){l+=u.charCodeAt(d);var f=.02519603282416938*l;l=f>>>0,f-=l,f*=l,l=f>>>0,f-=l,l+=f*4294967296}return(l>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=i:this.alea=i})(ffe,n)})(jv)),jv.exports}var Bv={exports:{}},pfe=Bv.exports,l_;function mfe(){return l_||(l_=1,(function(n){(function(e,t,r){function s(a){var l=this,c="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var d=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^d^d>>>8},a===(a|0)?l.x=a:c+=a;for(var u=0;u<c.length+64;u++)l.x^=c.charCodeAt(u)|0,l.next()}function o(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function i(a,l){var c=new s(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=c.next()>>>11,p=(c.next()>>>0)/4294967296,x=(f+p)/(1<<21);while(x===0);return x},d.int32=c.next,d.quick=d,u&&(typeof u=="object"&&o(u,c),d.state=function(){return o(c,{})}),d}t&&t.exports?t.exports=i:this.xor128=i})(pfe,n)})(Bv)),Bv.exports}var Vv={exports:{}},gfe=Vv.exports,c_;function xfe(){return c_||(c_=1,(function(n){(function(e,t,r){function s(a){var l=this,c="";l.next=function(){var d=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(d^d<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:c+=a;for(var u=0;u<c.length+64;u++)l.x^=c.charCodeAt(u)|0,u==c.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function o(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function i(a,l){var c=new s(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=c.next()>>>11,p=(c.next()>>>0)/4294967296,x=(f+p)/(1<<21);while(x===0);return x},d.int32=c.next,d.quick=d,u&&(typeof u=="object"&&o(u,c),d.state=function(){return o(c,{})}),d}t&&t.exports?t.exports=i:this.xorwow=i})(gfe,n)})(Vv)),Vv.exports}var zv={exports:{}},vfe=zv.exports,u_;function yfe(){return u_||(u_=1,(function(n){(function(e,t,r){function s(a){var l=this;l.next=function(){var u=l.x,d=l.i,f,p;return f=u[d],f^=f>>>7,p=f^f<<24,f=u[d+1&7],p^=f^f>>>10,f=u[d+3&7],p^=f^f>>>3,f=u[d+4&7],p^=f^f<<7,f=u[d+7&7],f=f^f<<13,p^=f^f<<9,u[d]=p,l.i=d+1&7,p};function c(u,d){var f,p=[];if(d===(d|0))p[0]=d;else for(d=""+d,f=0;f<d.length;++f)p[f&7]=p[f&7]<<15^d.charCodeAt(f)+p[f+1&7]<<13;for(;p.length<8;)p.push(0);for(f=0;f<8&&p[f]===0;++f);for(f==8?p[7]=-1:p[f],u.x=p,u.i=0,f=256;f>0;--f)u.next()}c(l,a)}function o(a,l){return l.x=a.x.slice(),l.i=a.i,l}function i(a,l){a==null&&(a=+new Date);var c=new s(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=c.next()>>>11,p=(c.next()>>>0)/4294967296,x=(f+p)/(1<<21);while(x===0);return x},d.int32=c.next,d.quick=d,u&&(u.x&&o(u,c),d.state=function(){return o(c,{})}),d}t&&t.exports?t.exports=i:this.xorshift7=i})(vfe,n)})(zv)),zv.exports}var Wv={exports:{}},bfe=Wv.exports,d_;function wfe(){return d_||(d_=1,(function(n){(function(e,t,r){function s(a){var l=this;l.next=function(){var u=l.w,d=l.X,f=l.i,p,x;return l.w=u=u+1640531527|0,x=d[f+34&127],p=d[f=f+1&127],x^=x<<13,p^=p<<17,x^=x>>>15,p^=p>>>12,x=d[f]=x^p,l.i=f,x+(u^u>>>16)|0};function c(u,d){var f,p,x,v,y,b=[],w=128;for(d===(d|0)?(p=d,d=null):(d=d+"\0",p=0,w=Math.max(w,d.length)),x=0,v=-32;v<w;++v)d&&(p^=d.charCodeAt((v+32)%d.length)),v===0&&(y=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,v>=0&&(y=y+1640531527|0,f=b[v&127]^=p+y,x=f==0?x+1:0);for(x>=128&&(b[(d&&d.length||0)&127]=-1),x=127,v=512;v>0;--v)p=b[x+34&127],f=b[x=x+1&127],p^=p<<13,f^=f<<17,p^=p>>>15,f^=f>>>12,b[x]=p^f;u.w=y,u.X=b,u.i=x}c(l,a)}function o(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function i(a,l){a==null&&(a=+new Date);var c=new s(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=c.next()>>>11,p=(c.next()>>>0)/4294967296,x=(f+p)/(1<<21);while(x===0);return x},d.int32=c.next,d.quick=d,u&&(u.X&&o(u,c),d.state=function(){return o(c,{})}),d}t&&t.exports?t.exports=i:this.xor4096=i})(bfe,n)})(Wv)),Wv.exports}var Uv={exports:{}},Cfe=Uv.exports,f_;function kfe(){return f_||(f_=1,(function(n){(function(e,t,r){function s(a){var l=this,c="";l.next=function(){var d=l.b,f=l.c,p=l.d,x=l.a;return d=d<<25^d>>>7^f,f=f-p|0,p=p<<24^p>>>8^x,x=x-d|0,l.b=d=d<<20^d>>>12^f,l.c=f=f-p|0,l.d=p<<16^f>>>16^x,l.a=x-d|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):c+=a;for(var u=0;u<c.length+20;u++)l.b^=c.charCodeAt(u)|0,l.next()}function o(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function i(a,l){var c=new s(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=c.next()>>>11,p=(c.next()>>>0)/4294967296,x=(f+p)/(1<<21);while(x===0);return x},d.int32=c.next,d.quick=d,u&&(typeof u=="object"&&o(u,c),d.state=function(){return o(c,{})}),d}t&&t.exports?t.exports=i:this.tychei=i})(Cfe,n)})(Uv)),Uv.exports}var Hv={exports:{}};const Sfe={},Nfe=Object.freeze(Object.defineProperty({__proto__:null,default:Sfe},Symbol.toStringTag,{value:"Module"})),Efe=jW(Nfe);var Ife=Hv.exports,h_;function Tfe(){return h_||(h_=1,(function(n){(function(e,t,r){var s=256,o=6,i=52,a="random",l=r.pow(s,o),c=r.pow(2,i),u=c*2,d=s-1,f;function p(k,N,I){var T=[];N=N==!0?{entropy:!0}:N||{};var F=b(y(N.entropy?[k,S(t)]:k??w(),3),T),R=new x(T),D=function(){for(var A=R.g(o),P=l,B=0;A<c;)A=(A+B)*s,P*=s,B=R.g(1);for(;A>=u;)A/=2,P/=2,B>>>=1;return(A+B)/P};return D.int32=function(){return R.g(4)|0},D.quick=function(){return R.g(4)/4294967296},D.double=D,b(S(R.S),t),(N.pass||I||function(A,P,B,L){return L&&(L.S&&v(L,R),A.state=function(){return v(R,{})}),B?(r[a]=A,P):A})(D,F,"global"in N?N.global:this==r,N.state)}function x(k){var N,I=k.length,T=this,F=0,R=T.i=T.j=0,D=T.S=[];for(I||(k=[I++]);F<s;)D[F]=F++;for(F=0;F<s;F++)D[F]=D[R=d&R+k[F%I]+(N=D[F])],D[R]=N;(T.g=function(A){for(var P,B=0,L=T.i,W=T.j,H=T.S;A--;)P=H[L=d&L+1],B=B*s+H[d&(H[L]=H[W=d&W+P])+(H[W]=P)];return T.i=L,T.j=W,B})(s)}function v(k,N){return N.i=k.i,N.j=k.j,N.S=k.S.slice(),N}function y(k,N){var I=[],T=typeof k,F;if(N&&T=="object")for(F in k)try{I.push(y(k[F],N-1))}catch{}return I.length?I:T=="string"?k:k+"\0"}function b(k,N){for(var I=k+"",T,F=0;F<I.length;)N[d&F]=d&(T^=N[d&F]*19)+I.charCodeAt(F++);return S(N)}function w(){try{var k;return f&&(k=f.randomBytes)?k=k(s):(k=new Uint8Array(s),(e.crypto||e.msCrypto).getRandomValues(k)),S(k)}catch{var N=e.navigator,I=N&&N.plugins;return[+new Date,e,I,e.screen,S(t)]}}function S(k){return String.fromCharCode.apply(0,k)}if(b(r.random(),t),n.exports){n.exports=p;try{f=Efe}catch{}}else r["seed"+a]=p})(typeof self<"u"?self:Ife,[],Math)})(Hv)),Hv.exports}var u4,p_;function _fe(){if(p_)return u4;p_=1;var n=hfe(),e=mfe(),t=xfe(),r=yfe(),s=wfe(),o=kfe(),i=Tfe();return i.alea=n,i.xor128=e,i.xorwow=t,i.xorshift7=r,i.xor4096=s,i.tychei=o,u4=i,u4}var l8=_fe();class vM{constructor(e,t,r,s,o){this.mean=e,this.stdDev=t,this.dtype=r,this.nextVal=NaN,this.truncated=s,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const i=o||Math.random();this.random=l8.alea(i.toString())}nextValue(){if(!isNaN(this.nextVal)){const s=this.nextVal;return this.nextVal=NaN,s}let e,t,r=!1;for(;!r;){let s,o,i;do s=2*this.random()-1,o=2*this.random()-1,i=s*s+o*o;while(i>=1||i===0);const a=Math.sqrt(-2*Math.log(i)/i);e=this.mean+this.stdDev*s*a,t=this.mean+this.stdDev*o*a,(!this.truncated||this.isValidTruncated(e))&&(r=!0)}return(!this.truncated||this.isValidTruncated(t))&&(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class Rfe{constructor(e=0,t=1,r,s){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=t-e,this.dtype=r,s==null&&(s=Math.random()),typeof s=="number"&&(s=s.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=l8.alea(s)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}function Dfe(n,e=0,t=1,r,s){if(Qc(n),r!=null&&r==="bool")throw new Error(`Unsupported data type ${r}`);const o=new vM(e,t,r,!1,s),i=$n(n,r);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const Afe=be({randomNormal_:Dfe});function $fe(n,e=0,t=1,r="float32",s){Qc(n);const o=$n(n,r),i=new Rfe(e,t,null,s);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const l0=be({randomUniform_:$fe});function Lg(n,e,t=1,r="float32"){if(t===0)throw new Error("Cannot have a step of zero");const s={start:n,stop:e,step:t,dtype:r};return me.runKernel($S,{},s)}function Ffe(n){const t={input:se(n,"input","real")};return me.runKernel(FS,t)}const V2=be({real_:Ffe});function Pfe(n){const t={x:se(n,"x","reciprocal")};return me.runKernel(z1,t)}const Ofe=be({reciprocal_:Pfe});function Mfe(n){const t={x:se(n,"x","relu")};return me.runKernel(W1,t)}const Xf=be({relu_:Mfe});function Lfe(n){const t={x:se(n,"x","relu6")};return me.runKernel(U1,t)}const yM=be({relu6_:Lfe});function jfe(n,e){const r={x:se(n,"x","reverse")},s={dims:e};return me.runKernel($b,r,s)}const $f=be({reverse_:jfe});function Bfe(n){const t={x:se(n,"x","round")};return me.runKernel(H1,t)}const bM=be({round_:Bfe});function Vfe(n){const t={x:se(n,"x","rsqrt","float32")};return me.runKernel(G1,t)}const wM=be({rsqrt_:Vfe});function zfe(n){const t={x:se(n,"x","selu")};return me.runKernel(q1,t)}const CM=be({selu_:zfe});function Wfe(n,e,t,r,s,o=[1,1],i="NHWC"){const a=se(n,"x","separableConv2d"),l=se(e,"depthwiseFilter","separableConv2d"),c=se(t,"pointwiseFilter","separableConv2d");let u=a,d=!1;if(a.rank===3&&(d=!0,u=ye(a,[1,a.shape[0],a.shape[1],a.shape[2]])),i==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");X(u.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${u.rank}.`),X(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),X(c.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),X(c.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`),X(c.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`);const f=l.shape[2],p=l.shape[3];X(c.shape[2]===f*p,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${f*p}, but got ${c.shape[2]}.`);const x=ZS(u,l,r,s,i,o),y=Df(x,c,1,"valid",i);return d?ye(y,[y.shape[1],y.shape[2],y.shape[3]]):y}const kM=be({separableConv2d_:Wfe});function Ufe(n){const t={x:se(n,"x","sign")};return me.runKernel(Y1,t)}const Hfe=be({sign_:Ufe});function Gfe(n){const t={x:se(n,"x","sin","float32")};return me.runKernel(K1,t)}const SM=be({sin_:Gfe});function qfe(n){const t={x:se(n,"x","sinh")};return me.runKernel(X1,t)}const NM=be({sinh_:qfe});function Kfe(n,e,t){const r=se(n,"x","slice1d");return X(r.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`),Ir(r,[e],[t])}const c8=be({slice1d_:Kfe});function Xfe(n,e,t){const r=se(n,"x","slice2d");return X(r.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`),Ir(r,e,t)}const EM=be({slice2d_:Xfe});function Yfe(n,e,t){const r=se(n,"x","slice3d");return X(r.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`),Ir(r,e,t)}const u8=be({slice3d_:Yfe});function Zfe(n,e,t){const r=se(n,"x","slice4d");return X(r.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`),Ir(r,e,t)}const z2=be({slice4d_:Zfe});function Jfe(n,e=-1){const t=se(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and dim was ${e}`);const r={logits:t},s={dim:e};return me.runKernel(jb,r,s)}const d8=be({softmax_:Jfe});function Qfe(n){X(n.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${n.dtype}.`);const e={input:n};return me.runKernel(CS,e)}const IM=be({fft_:Qfe});function ehe(n){X(n.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${n.dtype}.`);const e={input:n};return me.runKernel(NS,e)}const H5=be({ifft_:ehe});function the(n){const e=n.shape[n.shape.length-1],t=n.size/e;let r;if(e<=2){const s=ye(n,[t,e]);r=H5(s)}else{const s=[t,2*(e-1)],o=ye(V2(n),[t,e]),i=ye(e8(n),[t,e]),a=$f(Ir(o,[0,1],[t,e-2]),1),l=fe($f(Ir(i,[0,1],[t,e-2]),1),ar(-1)),c=ei([o,a],1),u=ei([i,l],1),d=ye(Dp(c,u),[s[0],s[1]]);r=H5(d)}if(r=V2(r),n.rank===3&&n.shape[0]!==0){const s=r,o=n.shape[0];r=ye(r,[o,r.shape[0]/o,r.shape[1]]),s.dispose()}return r}const nhe=be({irfft_:the});function rhe(n,e,t=0){const s={x:se(n,"x","split")},o={numOrSizeSplits:e,axis:t};return me.runKernel(Lb,s,o)}const ea=be({split_:rhe});function she(n,e){X(n.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${n.dtype}`);let t=n.shape[n.shape.length-1];const r=n.size/t;let s;if(e!=null&&e<t){const x=n.shape.map(y=>0),v=n.shape.map(y=>y);v[n.shape.length-1]=e,s=Ir(n,x,v),t=e}else if(e!=null&&e>t){const x=n.shape.map(v=>v);x[n.shape.length-1]=e-t,s=ei([n,Ps(x)],n.shape.length-1),t=e}else s=n;const o=Gn(s),i=ye(Dp(s,o),[r,t]),a=IM(i),l=Math.floor(t/2)+1,c=V2(a),u=e8(a),d=ea(c,[l,t-l],c.shape.length-1),f=ea(u,[l,t-l],u.shape.length-1),p=s.shape.slice();return p[s.shape.length-1]=l,ye(Dp(d[0],f[0]),p)}const ohe=be({rfft_:she});function ihe(n,e){let t=se(n,"a","squaredDifference"),r=se(e,"b","squaredDifference");[t,r]=ss(t,r),Sn(t.shape,r.shape);const s={a:t,b:r},o={};return me.runKernel(e0,s,o)}const ahe=be({squaredDifference_:ihe});function lhe(n,e){const t=se(n,"x","squeeze","string_or_numeric");return ye(t,vd(t.shape,e).newShape)}const c0=be({squeeze_:lhe});function che(n,e=0){const t=GO(n,"tensors","stack","string_or_numeric");X(t.length>=1,()=>"Pass at least one tensor to tf.stack"),t.length>0&&X(e<=t[0].rank,()=>"Axis must be <= rank of the tensor");const r=t,s={axis:e};return me.runKernel(Eb,r,s)}const Uc=be({stack_:che});function uhe(n,e=0){const r={x:se(n,"x","step")},s={alpha:e};return me.runKernel(o0,r,s)}const u0=be({step_:uhe});function dhe(n,e,t,r,s=0,o=0,i=0,a=0,l=0){const u={x:se(n,"x","stridedSlice","string_or_numeric")},d={begin:e,end:t,strides:r,beginMask:s,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:l};return me.runKernel(jS,u,d)}const fhe=be({stridedSlice_:dhe});function hhe(n){const t={x:se(n,"x","tan","float32")};return me.runKernel(n0,t)}const phe=be({tan_:hhe});function Ci(n,e){nO(n);const t=Ub(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Hb(n,null,t,e)}function d4(n,e,t){if(nO(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const r=Ub(n,t);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Hb(n,e,r,t)}function TM(n,e,t){const r=e.rank>1?e.shape[e.rank-1]:1,s=e.rank>1?e.rank-1:1,o=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${t.shape}, indices.shape: ${e.shape}, shape: ${n}, sliceDim: ${r}, and batchDim: ${s}.`;if(t.rank<s)throw new Error(o+` update.rank < ${s}. `);if(n.length<r+(t.rank-s))throw new Error(o+` Output shape length < ${r+(t.rank-s)}`);if(t.rank!==s+n.length-r)throw new Error(o+` update.rank != ${s+n.length-r}`);for(let i=0;i<s;++i)if(t.shape[i]!==e.shape[i])throw new Error(o+` updates.shape[${i}] (${t.shape[i]}) != indices.shape[${i}] (${e.shape[i]}).`);for(let i=0;i<t.rank-s;++i)if(t.shape[i+s]!==n[i+r])throw new Error(o+` updates.shape[${i+s}] (${t.shape[i+s]}) != shape[${i+s}] (${n[i+s]})`)}function mhe(n,e,t){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(n.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${n.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(t.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${t}`);if(t.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(n.size===0)throw new Error(`Updates specified for empty output. updates shape: ${n.shape}`)}TM(t,e,n)}function Yf(n,e,t){const r=e.shape.length,s=r>1?e.shape[r-1]:1,o=t.length;let i=1;for(let d=s;d<o;++d)i*=t[d];const a=s<1?1:s,l=Le(e.shape)/a,c=[...nn(t.slice(0,s)),1],u=Le(t);return{sliceRank:s,numUpdates:l,sliceSize:i,strides:c,outputSize:u}}function ghe(n,e=1,t=!0){const r=se(n,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const s=r.shape[r.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>s)throw new Error(`'k' passed to topk() must be <= the last dimension (${s}) but got ${e}`);const o={x:r},i={k:e,sorted:t},[a,l]=me.runKernel(BS,o,i);return{values:a,indices:l}}const xhe=be({topk_:ghe});function vhe(n,e=0,t=1,r,s){if(Qc(n),r!=null&&r==="bool")throw new Error("Unsupported data type $ { dtype }");const o=new vM(e,t,r,!0,s),i=$n(n,r);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const _M=be({truncatedNormal_:vhe});function yhe(n,e=0){const t=se(n,"x","unique","string_or_numeric");X(t.rank>0,()=>"The input tensor must be at least 1D");const r={x:t},s={axis:e},[o,i]=me.runKernel(zS,r,s);return{values:o,indices:i}}const bhe=be({unique_:yhe});function whe(n,e,t){const r=se(n,"x","unsortedSegmentSum"),s=se(e,"segmentIds","unsortedSegmentSum","int32");X(_p(t),()=>"numSegments must be of dtype int");const o={x:r,segmentIds:s},i={numSegments:t};return me.runKernel(Vb,o,i)}const RM=be({unsortedSegmentSum_:whe});function Che(n,e=0){const t=se(n,"x","unstack","string_or_numeric");X(e>=-t.shape.length&&e<t.shape.length,()=>`Axis = ${e} is not in [-${t.shape.length}, ${t.shape.length})`);const r={value:t},s={axis:e};return me.runKernel(Bb,r,s)}const Ff=be({unstack_:Che});function khe(n,e=!0,t,r){return me.makeVariable(n,e,t,r)}function DM(n,e){const t=[];for(let o=0;o<e.length;o++)e[o]&&t.push(o);const r=$n(n,"int32"),s=$n([t.length,n.length],"int32");for(let o=0;o<t.length;o++){const i=r.indexToLoc(t[o]),a=o*n.length;s.values.set(i,a)}return s.toTensor()}function She(n,e,t){const r=se(n,"x","transpose");if(e==null&&(e=r.shape.map((i,a)=>a).reverse()),X(r.rank===e.length,()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${e}.`),e.forEach(i=>{X(i>=0&&i<r.rank,()=>`All entries in 'perm' must be between 0 and ${r.rank-1} but got ${e}`)}),r.rank<=1)return r.clone();const s={x:r},o={perm:e};return r.dtype==="complex64"?Ne(()=>{let i=V2(r),a=e8(r);return i=me.runKernel(pp,{x:i},o),a=me.runKernel(pp,{x:a},o),t&&(a=rs(a)),Dp(i,a)}):me.runKernel(pp,s,o)}const Hn=be({transpose_:She});function Nhe(n,e){if(e==null)return n.shape.slice();if(lr(n.shape,e))return e;if(n.shape.length===e.length){const t=[];for(let r=0;r<n.shape.length;r++)e[r]==null&&n.shape[r]!=null?t.push(n.shape[r]):t.push(e[r]);return t}return e}function Ehe(n,e,t,r){const s=se(n,"x","dropout");if(X(s.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${s.dtype} tensor instead.`),X(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return n instanceof ys?s.clone():s;const o=Nhe(s,t),i=1-e,a=ln(Zb(ot(l0(o,0,1,"float32",r),i)),i);return fe(s,a)}const Ihe=be({dropout_:Ehe});function The(n,e,t,r,s,o="NHWC",i){let a=n;n.rank===3&&(a=ye(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=e;l.rank===3&&(l=ye(e,[1,e.shape[0],e.shape[1],e.shape[2]])),X(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),X(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),X(t.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${t}.`);const c=o==="NHWC"?a.shape[3]:a.shape[1],u=o==="NHWC"?l.shape[3]:l.shape[1];X(c===t[2],()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${t[2]}.`),X(u===t[3],()=>`Error in conv2dDerFilter: depth of dy (${u}) must match output depth for filter (${t[3]}).`),oi("conv2dDerFilter",s,i);const d={x:a,dy:l},f={strides:r,pad:s,dataFormat:o,dimRoundingMode:i,filterShape:t};return me.runKernel(dS,d,f)}const f8=be({conv2DBackpropFilter_:The});function h8(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return fe(n,u0(e));throw new Error(`Cannot compute gradient for fused activation ${t}.`)}function p8(n,e){let t=e;const r=Es(n.shape,e.shape);return r.length>0&&(t=on(t,r)),ye(t,n.shape)}function m8(n,e,t,r){if(e==="linear")return n;if(e==="relu")return Xf(n);if(e==="elu")return Xb(n);if(e==="relu6")return yM(n);if(e==="prelu")return a8(n,t);if(e==="leakyrelu")return t8(n,r);if(e==="sigmoid")return Qp(n);throw new Error(`Unknown fused activation ${e}.`)}const g8=(n,e)=>!(n>0)||e==="linear";function _he({x:n,filter:e,strides:t,pad:r,dataFormat:s="NHWC",dilations:o=[1,1],dimRoundingMode:i,bias:a,activation:l="linear",preluActivationWeights:c,leakyreluAlpha:u}){if(l=l||"linear",g8(me.state.gradientDepth,l)===!1){X(s==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${s} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let I=Df(n,e,t,r,s,o,i);return a!=null&&(I=ot(I,a)),m8(I,l,c,u)}const d=se(n,"x","conv2d","float32"),f=se(e,"filter","conv2d","float32");let p=d,x=!1;d.rank===3&&(x=!0,p=ye(d,[1,d.shape[0],d.shape[1],d.shape[2]])),X(p.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${p.rank}.`),X(f.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${f.rank}.`),oi("fused conv2d",r,i);const v=s==="NHWC"?p.shape[3]:p.shape[1];X(f.shape[2]===v,()=>`Error in conv2d: depth of input (${v}) must match input depth for filter ${f.shape[2]}.`),X(xo(t,o),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`);const y=ro(p.shape,f.shape,t,o,r,i);let b;a!=null&&(b=se(a,"bias","fused conv2d"),[b]=ss(b,d),s==="NHWC"?Sn(y.outShape,b.shape):(X(b.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${b.shape.length}.`),X(b.shape.length===0||b.shape[0]===y.outChannels||b.shape[0]===1,()=>`Error in fused conv2d: bias shape (${b.shape}) is not compatible with the number of output channels (${y.outChannels})`)));let w;if(c!=null){const I=c.shape;if(X(I.length<=1||I.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${I.length}.`),I.length===1)X(I[0]===1||I[0]===y.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${I}) is not compatible with the number of output channels (${y.outChannels}).`);else if(I.length===3)try{Sn(I,y.outShape)}catch{const F=`Error in fused conv2d: PReLU activation weights (${I}) is not compatible with the output shape of the conv2d (${y.outShape}).`;throw Error(F)}w=se(c,"prelu weights","fused conv2d")}const S=(I,T)=>{X(s==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${s} but only NHWC is currently supported.`);const[F,R,D,A]=T,P=h8(I,D,l);X(_f(o),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`);const B=XS(R.shape,P,F,t,r),L=f8(R,P,F.shape,t,r),W=[B,L];if(A!=null){const H=p8(A,P);W.push(H)}return W},k={x:p,filter:f,bias:b,preluActivationWeights:w},N={strides:t,pad:r,dataFormat:s,dilations:o,dimRoundingMode:i,activation:l,leakyreluAlpha:u};return a==null?$p((T,F,R)=>{let D=me.runKernel(P2,k,N);return R([F,T,D]),x&&(D=ye(D,[D.shape[1],D.shape[2],D.shape[3]])),{value:D,gradFunc:S}})(p,f):$p((T,F,R,D)=>{let A=me.runKernel(P2,k,N);return D([F,T,A,R]),x&&(A=ye(A,[A.shape[1],A.shape[2],A.shape[3]])),{value:A,gradFunc:S}})(p,f,b)}const Rhe=be({fusedConv2d_:_he});function Dhe(n,e,t,r,s,o=[1,1],i){let a=n;n.rank===3&&(a=ye(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=e;l.rank===3&&(l=ye(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={x:a,dy:l},u={strides:r,pad:s,dimRoundingMode:i,dilations:o,filterShape:t};return me.runKernel(vS,c,u)}const Ahe=be({depthwiseConv2dNativeBackpropFilter_:Dhe});function $he(n,e,t,r,s,o=[1,1],i){let a=e,l=!1;e.rank===3&&(l=!0,a=ye(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={dy:a,filter:t},u={strides:r,pad:s,dimRoundingMode:i,dilations:o,inputShape:n},d=me.runKernel(yS,c,u);return l?ye(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const Fhe=be({depthwiseConv2dNativeBackpropInput_:$he});function Phe({a:n,b:e,transposeA:t=!1,transposeB:r=!1,bias:s,activation:o="linear",preluActivationWeights:i,leakyreluAlpha:a=.2}){if(g8(me.state.gradientDepth,o)===!1){let A=or(n,e,t,r);return s!=null&&(A=ot(A,s)),m8(A,o,i,a)}let l=se(n,"a","fused matMul"),c=se(e,"b","fused matMul");[l,c]=ss(l,c);const u=t?l.shape[l.rank-2]:l.shape[l.rank-1],d=r?c.shape[c.rank-1]:c.shape[c.rank-2],f=t?l.shape[l.rank-1]:l.shape[l.rank-2],p=r?c.shape[c.rank-2]:c.shape[c.rank-1],x=l.shape.slice(0,-2),v=c.shape.slice(0,-2),y=Le(x),b=Le(v);X(u===d,()=>`Error in fused matMul: inner shapes (${u}) and (${d}) of Tensors with shapes ${l.shape} and ${c.shape} and transposeA=${t} and transposeB=${r} must match.`);const S=Sn(l.shape.slice(0,-2),c.shape.slice(0,-2)).concat([f,p]),k=t?ye(l,[y,u,f]):ye(l,[y,f,u]),N=r?ye(c,[b,p,d]):ye(c,[b,d,p]);let I;s!=null&&(I=se(s,"bias","fused matMul"),[I]=ss(I,l),Sn(S,I.shape));let T;i!=null&&(T=se(i,"prelu weights","fused matMul"));const F=(A,P)=>{const[B,L,W,H]=P,G=h8(ye(A,W.shape),W,o);let M,j;if(!t&&!r?(M=or(G,L,!1,!0),j=or(B,G,!0,!1)):!t&&r?(M=or(G,L,!1,!1),j=or(G,B,!0,!1)):t&&!r?(M=or(L,G,!1,!0),j=or(B,G,!1,!1)):(M=or(L,G,!0,!0),j=or(G,B,!0,!0)),s!=null){const z=p8(H,G);return[M,j,z]}else return[M,j]},R={a:k,b:N,bias:I,preluActivationWeights:T},D={transposeA:t,transposeB:r,activation:o,leakyreluAlpha:a};return s==null?$p((P,B,L)=>{const W=me.runKernel(F2,R,D);return L([P,B,W]),{value:ye(W,S),gradFunc:F}})(k,N):$p((P,B,L,W)=>{const H=me.runKernel(F2,R,D);return W([P,B,H,L]),{value:ye(H,S),gradFunc:F}})(k,N,I)}const m_=be({fusedMatMul_:Phe});function Ohe(n,e,t,r,s="bilinear",o=0){const i=se(n,"image","cropAndResize"),a=se(e,"boxes","cropAndResize","float32"),l=se(t,"boxInd","cropAndResize","int32"),c=a.shape[0];X(i.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${i.rank}.`),X(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${c},4] but had shape ${a.shape}.`),X(l.rank===1&&l.shape[0]===c,()=>`Error in cropAndResize: boxInd must be have size [${c}] but had shape ${a.shape}.`),X(r.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`),X(r[0]>=1&&r[1]>=1,()=>`cropSize must be atleast [1,1], but was ${r}`),X(s==="bilinear"||s==="nearest",()=>`method must be bilinear or nearest, but was ${s}`);const u={image:i,boxes:a,boxInd:l},d={method:s,extrapolationValue:o,cropSize:r};return me.runKernel(mS,u,d)}const Mhe=be({cropAndResize_:Ohe});function Lhe(n){const e=se(n,"image","flipLeftRight","float32");X(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const t={image:e};return me.runKernel(SS,t,{})}const jhe=be({flipLeftRight_:Lhe});function Bhe(n){const e=se(n,"image","grayscaleToRGB"),t=e.rank-1,r=e.shape[t];X(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),X(r===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${r}.`);const s=new Array(e.rank);return s.fill(1,0,t),s[t]=3,sl(e,s)}const Vhe=be({grayscaleToRGB_:Bhe});function zhe(n){const e=se(n,"image","RGBToGrayscale"),t=e.rank-1,r=e.shape[t];X(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),X(r===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${r}.`);const s=e.dtype,o=It(e,"float32"),i=Ci([.2989,.587,.114]);let a;switch(e.rank){case 2:a=Ym("ij,j->i",o,i);break;case 3:a=Ym("ijk,k->ij",o,i);break;case 4:a=Ym("ijkl,l->ijk",o,i);break;case 5:a=Ym("ijklm,m->ijkl",o,i);break;case 6:a=Ym("ijklmn,n->ijklm",o,i);break;default:throw new Error("Not a valid tensor rank.")}return a=Jo(a,-1),It(a,s)}const Whe=be({rgbToGrayscale_:zhe});function Uhe(n,e,t=0,r=.5){const s=se(n,"image","rotateWithOffset","float32");X(s.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${s.rank}.`);const o={image:s},i={radians:e,fillValue:t,center:r};return me.runKernel(WS,o,i)}const Hhe=be({rotateWithOffset_:Uhe});function tm(n,e,t,r,s,o){r==null&&(r=.5),s==null&&(s=Number.NEGATIVE_INFINITY),o==null&&(o=0);const i=n.shape[0];return t=Math.min(t,i),X(0<=r&&r<=1,()=>`iouThreshold must be in [0, 1], but was '${r}'`),X(n.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${n.rank}'`),X(n.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${n.shape[1]}`),X(e.rank===1,()=>"scores must be a 1D tensor"),X(e.shape[0]===i,()=>`scores has incompatible shape with boxes. Expected ${i}, but was ${e.shape[0]}`),X(0<=o&&o<=1,()=>`softNmsSigma must be in [0, 1], but was '${o}'`),{maxOutputSize:t,iouThreshold:r,scoreThreshold:s,softNmsSigma:o}}function Ghe(n,e,t,r=.5,s=Number.NEGATIVE_INFINITY){const o=se(n,"boxes","nonMaxSuppression","float32"),i=se(e,"scores","nonMaxSuppression","float32"),a=tm(o,i,t,r,s);t=a.maxOutputSize,r=a.iouThreshold,s=a.scoreThreshold;const l={maxOutputSize:t,iouThreshold:r,scoreThreshold:s};return me.runKernel(RS,{boxes:o,scores:i},l)}const qhe=be({nonMaxSuppression_:Ghe});function Khe(n,e,t){const r=Xhe(n,e,t),s=r<0?-(r+1):r;n.splice(s,0,e)}function Xhe(n,e,t){return Zhe(n,e,t||Yhe)}function Yhe(n,e){return n>e?1:n<e?-1:0}function Zhe(n,e,t){let r=0,s=n.length,o=0,i=!1;for(;r<s;){o=r+(s-r>>>1);const a=t(e,n[o]);a>0?r=o+1:(s=o,i=!a)}return i?r:-r-1}function x8(n,e,t,r,s){return b8(n,e,t,r,s,0)}function v8(n,e,t,r,s,o){return b8(n,e,t,r,s,0,!1,o,!0)}function y8(n,e,t,r,s,o){return b8(n,e,t,r,s,o,!0)}function b8(n,e,t,r,s,o,i=!1,a=!1,l=!1){const c=[];for(let y=0;y<e.length;y++)e[y]>s&&c.push({score:e[y],boxIndex:y,suppressBeginIndex:0});c.sort(g_);const u=o>0?-.5/o:0,d=[],f=[];for(;d.length<t&&c.length>0;){const y=c.pop(),{score:b,boxIndex:w,suppressBeginIndex:S}=y;if(b<s)break;let k=!1;for(let N=d.length-1;N>=S;--N){const I=Jhe(n,w,d[N]);if(I>=r){k=!0;break}if(y.score=y.score*Qhe(r,u,I),y.score<=s)break}y.suppressBeginIndex=d.length,k||(y.score===b?(d.push(w),f.push(y.score)):y.score>s&&Khe(c,y,g_))}const p=d.length,x=t-p;a&&x>0&&(d.push(...new Array(x).fill(0)),f.push(...new Array(x).fill(0)));const v={selectedIndices:d};return i&&(v.selectedScores=f),l&&(v.validOutputs=p),v}function Jhe(n,e,t){const r=n.subarray(e*4,e*4+4),s=n.subarray(t*4,t*4+4),o=Math.min(r[0],r[2]),i=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),l=Math.max(r[1],r[3]),c=Math.min(s[0],s[2]),u=Math.min(s[1],s[3]),d=Math.max(s[0],s[2]),f=Math.max(s[1],s[3]),p=(a-o)*(l-i),x=(d-c)*(f-u);if(p<=0||x<=0)return 0;const v=Math.max(o,c),y=Math.max(i,u),b=Math.min(a,d),w=Math.min(l,f),S=Math.max(b-v,0)*Math.max(w-y,0);return S/(p+x-S)}function Qhe(n,e,t){const r=Math.exp(e*t*t);return t<=n?r:0}function g_(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}async function epe(n,e,t,r=.5,s=Number.NEGATIVE_INFINITY){const o=se(n,"boxes","nonMaxSuppressionAsync"),i=se(e,"scores","nonMaxSuppressionAsync"),a=tm(o,i,t,r,s);t=a.maxOutputSize,r=a.iouThreshold,s=a.scoreThreshold;const l=await Promise.all([o.data(),i.data()]),c=l[0],u=l[1],{selectedIndices:d}=x8(c,u,t,r,s);return o!==n&&o.dispose(),i!==e&&i.dispose(),Ci(d,"int32")}const tpe=epe;function npe(n,e,t,r=.5,s=Number.NEGATIVE_INFINITY,o=0){const i=se(n,"boxes","nonMaxSuppression"),a=se(e,"scores","nonMaxSuppression"),l=tm(i,a,t,r,s,o);t=l.maxOutputSize,r=l.iouThreshold,s=l.scoreThreshold,o=l.softNmsSigma;const c={boxes:i,scores:a},u={maxOutputSize:t,iouThreshold:r,scoreThreshold:s,softNmsSigma:o},d=me.runKernel(AS,c,u);return{selectedIndices:d[0],selectedScores:d[1]}}const rpe=be({nonMaxSuppressionWithScore_:npe});async function spe(n,e,t,r=.5,s=Number.NEGATIVE_INFINITY,o=0){const i=se(n,"boxes","nonMaxSuppressionAsync"),a=se(e,"scores","nonMaxSuppressionAsync"),l=tm(i,a,t,r,s,o);t=l.maxOutputSize,r=l.iouThreshold,s=l.scoreThreshold,o=l.softNmsSigma;const c=await Promise.all([i.data(),a.data()]),u=c[0],d=c[1],{selectedIndices:f,selectedScores:p}=y8(u,d,t,r,s,o);return i!==n&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:Ci(f,"int32"),selectedScores:Ci(p)}}const ope=spe;function ipe(n,e,t,r=.5,s=Number.NEGATIVE_INFINITY,o=!1){const i=se(n,"boxes","nonMaxSuppression"),a=se(e,"scores","nonMaxSuppression"),l=tm(i,a,t,r,s,null),c=l.maxOutputSize,u=l.iouThreshold,d=l.scoreThreshold,f={boxes:i,scores:a},p={maxOutputSize:c,iouThreshold:u,scoreThreshold:d,padToMaxOutputSize:o},x=me.runKernel(DS,f,p);return{selectedIndices:x[0],validOutputs:x[1]}}const ape=be({nonMaxSuppressionPadded_:ipe});async function lpe(n,e,t,r=.5,s=Number.NEGATIVE_INFINITY,o=!1){const i=se(n,"boxes","nonMaxSuppressionAsync"),a=se(e,"scores","nonMaxSuppressionAsync"),l=tm(i,a,t,r,s,null),c=l.maxOutputSize,u=l.iouThreshold,d=l.scoreThreshold,[f,p]=await Promise.all([i.data(),a.data()]),{selectedIndices:x,validOutputs:v}=v8(f,p,c,u,d,o);return i!==n&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:Ci(x,"int32"),validOutputs:ar(v,"int32")}}const cpe=lpe;function upe(n,e,t=!1,r=!1){const s=se(n,"images","resizeBilinear");X(s.rank===3||s.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${s.rank}.`),X(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),X(r===!1||t===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let o=s,i=!1;s.rank===3&&(i=!0,o=ye(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const a={images:o},l={alignCorners:t,halfPixelCenters:r,size:e},c=me.runKernel(Ab,a,l);return i?ye(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const AM=be({resizeBilinear_:upe});function dpe(n,e,t=!1,r=!1){const s=se(n,"images","resizeNearestNeighbor");X(s.rank===3||s.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${s.rank}.`),X(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),X(s.dtype==="float32"||s.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),X(r===!1||t===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let o=s,i=!1;s.rank===3&&(i=!0,o=ye(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const a={images:o},l={alignCorners:t,halfPixelCenters:r,size:e},c=me.runKernel(Db,a,l);return i?ye(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const $M=be({resizeNearestNeighbor_:dpe});function fpe(n,e="binary",t=!1,r=.5){const s=se(n,"image","threshold"),o=.2989,i=.587,a=.114,l=s.shape[0]*s.shape[1];let c=fe(Ci([r]),255),u,d,f,p;if(X(s.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${s.rank}.`),X(s.shape[2]===3||s.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${s.shape[2]}.`),X(s.dtype==="int32"||s.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${s.dtype}.`),X(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),s.shape[2]===3){[u,d,f]=ea(s,[1,1,1],-1);const y=fe(u,o),b=fe(d,i),w=fe(f,a);p=ot(ot(y,b),w)}else p=n;if(e==="otsu"){const y=cue(It(bM(p),"int32"),qO([]),256);c=hpe(y,l)}const x=t?em(p,c):sa(p,c);return It(fe(x,255),"int32")}function hpe(n,e){let t=Ci([-1]),r=Ci([0]),s=Ci([0]),o,i,a,l,c,u;for(let d=0;d<n.size-1;d++){o=Ir(n,0,d+1),i=Ir(n,d+1),c=ln(on(o),e),u=ln(on(i),e);const f=on(fe(o,Lg(0,o.size)));a=ln(f,on(o));const p=Kb(i.shape,o.size),x=ot(Lg(0,i.size),p),v=fe(i,x);l=ln(on(v),on(i));const y=hn(a,l),b=hn(a,l),w=fe(c,u);s=fe(fe(w,y),b);const S=sa(s,r);r=Vo(S,s,r),t=Vo(S,Ci([d]),t)}return t}const ppe=be({threshold_:fpe});function mpe(n,e,t="nearest",r="constant",s=0,o){const i=se(n,"image","transform","float32"),a=se(e,"transforms","transform","float32");X(i.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${i.rank}.`),X(a.rank===2&&(a.shape[0]===i.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),X(o==null||o.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${o}.`);const l={image:i,transforms:a},c={interpolation:t,fillMode:r,fillValue:s,outputShape:o};return me.runKernel(VS,l,c)}const gpe=be({transform_:mpe});function xpe(n,e,t){const r=se(n,"a","bandPart");X(r.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`);const s=r.shape,[o,i]=r.shape.slice(-2);let a,l;typeof e=="number"?(X(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),X(e<=o,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${o}).`),a=se(e<0?o:e,"numLower","bandPart")):(X(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=Vo(j2(e,0),o,Mg(e,o))),typeof t=="number"?(X(t%1===0,()=>`bandPart(): numUpper must be an integer, got ${t}.`),X(t<=i,()=>`bandPart(): numUpper (${t}) must not be greater than the number of columns (${i}).`),l=se(t<0?i:t,"numUpper","bandPart")):(X(t.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),l=Vo(j2(t,0),i,Mg(t,i)));const c=ye(Lg(0,o,1,"int32"),[-1,1]),u=Lg(0,i,1,"int32"),d=hn(c,u),f=Wc(em(d,a),Kf(d,rs(l))),p=Ps([o,i],r.dtype);return ye(Uc(Ff(ye(r,[-1,o,i])).map(x=>Vo(f,x,p))),s)}const vpe=be({bandPart_:xpe});function ype(n){let e;if(Array.isArray(n)){e=!1,X(n!=null&&n.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const s=n[0].shape[0];for(let o=1;o<n.length;++o)X(n[o].shape[0]===s,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${n[o].shape[0]} vs. ${s})`)}else e=!0,n=ea(n,n.shape[0],0).map(s=>c0(s,[0]));X(n.length<=n[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${n.length}) exceeds number of dimensions (${n[0].shape[0]}).`);const t=[],r=n;for(let s=0;s<n.length;++s)t.push(me.tidy(()=>{let o=r[s];if(s>0)for(let i=0;i<s;++i){const a=fe(on(fe(t[i],o)),t[i]);o=hn(o,a)}return ln(o,Yb(o,"euclidean"))}));return e?Uc(t,0):t}const bpe=be({gramSchmidt_:ype});function wpe(n,e=!1){if(X(n.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${n.rank}`),n.rank===2)return x_(n,e);{const t=n.shape.slice(0,n.shape.length-2).reduce((l,c)=>l*c),r=Ff(ye(n,[t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),s=[],o=[];r.forEach(l=>{const[c,u]=x_(l,e);s.push(c),o.push(u)});const i=ye(Uc(s,0),n.shape),a=ye(Uc(o,0),n.shape);return[i,a]}}function x_(n,e=!1){return me.tidy(()=>{X(n.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${n.shape.length}D Tensor.`);const t=n.shape[0],r=n.shape[1];let s=fM(t),o=gf(n);const i=d4([[1]],[1,1]);let a=gf(i);const l=t>=r?r:t;for(let c=0;c<l;++c){const u=o,d=a,f=s;[a,o,s]=me.tidy(()=>{const p=Ir(o,[c,c],[t-c,1]),x=Yb(p),v=Ir(o,[c,c],[1,1]),y=Vo(sa(v,0),d4([[-1]]),d4([[1]])),b=hn(v,fe(y,x)),w=ln(p,b);w.shape[0]===1?a=gf(i):a=ei([i,Ir(w,[1,0],[w.shape[0]-1,w.shape[1]])],0);const S=rs(ln(or(y,b),x)),k=Ir(o,[c,0],[t-c,r]),N=fe(S,a),I=Hn(a);if(c===0)o=hn(k,or(N,or(I,k)));else{const R=hn(k,or(N,or(I,k)));o=ei([Ir(o,[0,0],[c,r]),R],0)}const T=Hn(N),F=Ir(s,[0,c],[t,s.shape[1]-c]);if(c===0)s=hn(F,or(or(F,a),T));else{const R=hn(F,or(or(F,a),T));s=ei([Ir(s,[0,0],[t,c]),R],1)}return[a,o,s]}),Mn([u,d,f])}return!e&&t>r&&(s=Ir(s,[0,0],[t,r]),o=Ir(o,[0,0],[r,r])),[s,o]})}const Cpe=be({qr_:wpe});const Mc={flipLeftRight:jhe,grayscaleToRGB:Vhe,resizeNearestNeighbor:$M,resizeBilinear:AM,rgbToGrayscale:Whe,rotateWithOffset:Hhe,cropAndResize:Mhe,nonMaxSuppression:qhe,nonMaxSuppressionAsync:tpe,nonMaxSuppressionWithScore:rpe,nonMaxSuppressionWithScoreAsync:ope,nonMaxSuppressionPadded:ape,nonMaxSuppressionPaddedAsync:cpe,threshold:ppe,transform:gpe},kpe={bandPart:vpe,gramSchmidt:bpe,qr:Cpe};const Spe=new Map,Npe=new Map;class nm{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class Na{constructor(){this.classNameMap={}}static getMap(){return Na.instance==null&&(Na.instance=new Na),Na.instance}static register(e){Na.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function Qe(n,e,t){X(n.className!=null,()=>"Class being registered does not have the static className property defined."),X(typeof n.className=="string",()=>"className is required to be a string, but got type "+typeof n.className),X(n.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof t>"u"&&(t=n.className);const r=t,s=e+">"+r;return Na.register(n),Spe.set(s,n),Npe.set(n,s),n}class Sd extends nm{minimize(e,t=!1,r){const{value:s,grads:o}=this.computeGradients(e,r);if(r!=null){const i=r.map(a=>({name:a.name,tensor:o[a.name]}));this.applyGradients(i)}else this.applyGradients(o);return Mn(o),t?s:(s.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return Rde(e,t)}dispose(){this.iterations_!=null&&Mn(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:ar(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(Sd,Symbol.hasInstance,{value:n=>n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null});class FM extends Sd{static get className(){return"Adadelta"}constructor(e,t,r=null){super(),this.learningRate=e,this.rho=t,this.epsilon=r,this.accumulatedGrads=[],this.accumulatedUpdates=[],r==null&&(this.epsilon=me.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,s)=>{const o=me.registeredVariables[r],i=!1;this.accumulatedGrads[s]==null&&(this.accumulatedGrads[s]={originalName:`${r}/accum_grad`,variable:Ne(()=>Gn(o).variable(i))}),this.accumulatedUpdates[s]==null&&(this.accumulatedUpdates[s]={originalName:`${r}/accum_var`,variable:Ne(()=>Gn(o).variable(i))});const a=Array.isArray(e)?e[s].tensor:e[r];if(a==null)return;const l=this.accumulatedGrads[s].variable,c=this.accumulatedUpdates[s].variable;Ne(()=>{const u=ot(fe(l,this.rho),fe(Ar(a),1-this.rho)),d=fe(ln(go(ot(c,this.epsilon)),go(ot(l,this.epsilon))),a),f=ot(fe(c,this.rho),fe(Ar(d),1-this.rho));l.assign(u),c.assign(f);const p=ot(fe(d,-this.learningRate),o);o.assign(p)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(Mn(this.accumulatedGrads.map(e=>e.variable)),Mn(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=e.length/2,r=!1;this.accumulatedGrads=e.slice(0,t).map(s=>({originalName:s.name,variable:s.tensor.variable(r)})),this.accumulatedUpdates=e.slice(t,t*2).map(s=>({originalName:s.name,variable:s.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}class PM extends Sd{static get className(){return"Adagrad"}constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,s)=>{const o=me.registeredVariables[r];this.accumulatedGrads[s]==null&&(this.accumulatedGrads[s]={originalName:`${r}/accumulator`,variable:Ne(()=>Kb(o.shape,this.initialAccumulatorValue).variable(!1))});const i=Array.isArray(e)?e[s].tensor:e[r];if(i==null)return;const a=this.accumulatedGrads[s].variable;Ne(()=>{const l=ot(a,Ar(i));a.assign(l);const c=ot(fe(ln(i,go(ot(l,me.backend.epsilon()))),-this.learningRate),o);o.assign(c)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&Mn(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulatedGrads=e.map(r=>({originalName:r.name,variable:r.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}class OM extends Sd{static get className(){return"Adam"}constructor(e,t,r,s=null){super(),this.learningRate=e,this.beta1=t,this.beta2=r,this.epsilon=s,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],Ne(()=>{this.accBeta1=ar(t).variable(),this.accBeta2=ar(r).variable()}),s==null&&(this.epsilon=me.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(r=>r.name):Object.keys(e);Ne(()=>{const r=hn(1,this.accBeta1),s=hn(1,this.accBeta2);t.forEach((o,i)=>{const a=me.registeredVariables[o],l=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${o}/m`,variable:Ne(()=>Gn(a).variable(l))}),this.accumulatedSecondMoment[i]==null&&(this.accumulatedSecondMoment[i]={originalName:`${o}/v`,variable:Ne(()=>Gn(a).variable(l))});const c=Array.isArray(e)?e[i].tensor:e[o];if(c==null)return;const u=this.accumulatedFirstMoment[i].variable,d=this.accumulatedSecondMoment[i].variable,f=ot(fe(u,this.beta1),fe(c,1-this.beta1)),p=ot(fe(d,this.beta2),fe(Ar(c),1-this.beta2)),x=ln(f,r),v=ln(p,s);u.assign(f),d.assign(p);const y=ot(fe(ln(x,ot(go(v),this.epsilon)),-this.learningRate),a);a.assign(y)}),this.accBeta1.assign(fe(this.accBeta1,this.beta1)),this.accBeta2.assign(fe(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Mn(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&Mn(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e),Ne(()=>{this.accBeta1.assign(Af(this.beta1,this.iterations_+1)),this.accBeta2.assign(Af(this.beta2,this.iterations_+1))});const t=e.length/2,r=!1;this.accumulatedFirstMoment=e.slice(0,t).map(s=>({originalName:s.name,variable:s.tensor.variable(r)})),this.accumulatedSecondMoment=e.slice(t,t*2).map(s=>({originalName:s.name,variable:s.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}class MM extends Sd{static get className(){return"Adamax"}constructor(e,t,r,s=null,o=0){super(),this.learningRate=e,this.beta1=t,this.beta2=r,this.epsilon=s,this.decay=o,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],Ne(()=>{this.iteration=ar(0).variable(),this.accBeta1=ar(t).variable()}),s==null&&(this.epsilon=me.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(r=>r.name):Object.keys(e);Ne(()=>{const r=hn(1,this.accBeta1),s=ln(-this.learningRate,ot(fe(this.iteration,this.decay),1));t.forEach((o,i)=>{const a=me.registeredVariables[o],l=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${o}/m`,variable:Gn(a).variable(l)}),this.accumulatedWeightedInfNorm[i]==null&&(this.accumulatedWeightedInfNorm[i]={originalName:`${o}/v`,variable:Gn(a).variable(l)});const c=Array.isArray(e)?e[i].tensor:e[o];if(c==null)return;const u=this.accumulatedFirstMoment[i].variable,d=this.accumulatedWeightedInfNorm[i].variable,f=ot(fe(u,this.beta1),fe(c,1-this.beta1)),p=fe(d,this.beta2),x=Ao(c),v=Cd(p,x);u.assign(f),d.assign(v);const y=ot(fe(ln(s,r),ln(f,ot(v,this.epsilon))),a);a.assign(y)}),this.iteration.assign(ot(this.iteration,1)),this.accBeta1.assign(fe(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Mn(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&Mn(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}class w8 extends Sd{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,s)=>{const o=Array.isArray(e)?e[s].tensor:e[r];if(o==null)return;const i=me.registeredVariables[r];Ne(()=>{const a=ot(fe(this.c,o),i);i.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=ec(ar(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}class LM extends w8{static get className(){return"Momentum"}constructor(e,t,r=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=r,this.accumulations=[],this.m=ar(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,s)=>{const o=me.registeredVariables[r];this.accumulations[s]==null&&(this.accumulations[s]={originalName:`${r}/momentum`,variable:Ne(()=>Gn(o).variable(!1))});const i=this.accumulations[s].variable,a=Array.isArray(e)?e[s].tensor:e[r];a!=null&&Ne(()=>{let l;const c=ot(fe(this.m,i),a);this.useNesterov?l=ot(fe(this.c,ot(a,fe(c,this.m))),o):l=ot(fe(this.c,c),o),i.assign(c),o.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&Mn(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulations=e.map(r=>({originalName:r.name,variable:r.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}class jM extends Sd{static get className(){return"RMSProp"}constructor(e,t=.9,r=0,s=null,o=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=r,this.epsilon=s,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=o,s==null&&(this.epsilon=me.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(r=>r.name):Object.keys(e)).forEach((r,s)=>{const o=me.registeredVariables[r],i=!1;this.accumulatedMeanSquares[s]==null&&(this.accumulatedMeanSquares[s]={originalName:`${r}/rms`,variable:Ne(()=>Gn(o).variable(i))}),this.accumulatedMoments[s]==null&&(this.accumulatedMoments[s]={originalName:`${r}/momentum`,variable:Ne(()=>Gn(o).variable(i))}),this.accumulatedMeanGrads[s]==null&&this.centered&&(this.accumulatedMeanGrads[s]={originalName:`${r}/mg`,variable:Ne(()=>Gn(o).variable(i))});const a=Array.isArray(e)?e[s].tensor:e[r];if(a==null)return;const l=this.accumulatedMeanSquares[s].variable,c=this.accumulatedMoments[s].variable;Ne(()=>{const u=ot(fe(l,this.decay),fe(Ar(a),1-this.decay));if(this.centered){const d=this.accumulatedMeanGrads[s].variable,f=ot(fe(d,this.decay),fe(a,1-this.decay)),p=ln(fe(a,this.learningRate),go(hn(u,ot(Ar(f),this.epsilon)))),x=ot(fe(c,this.momentum),p);l.assign(u),d.assign(f),c.assign(x);const v=hn(o,x);o.assign(v)}else{const d=ot(fe(l,this.decay),fe(Ar(a),1-this.decay)),f=ot(fe(c,this.momentum),ln(fe(a,this.learningRate),go(ot(d,this.epsilon))));l.assign(d),c.assign(f);const p=hn(o,f);o.assign(p)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&Mn(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&Mn(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&Mn(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,r=!1;this.accumulatedMeanSquares=e.slice(0,t).map(s=>({originalName:s.name,variable:s.tensor.variable(r)})),this.accumulatedMoments=e.slice(t,t*2).map(s=>({originalName:s.name,variable:s.tensor.variable(r)})),this.centered&&(this.accumulatedMeanGrads=e.slice(t*2,t*3).map(s=>({originalName:s.name,variable:s.tensor.variable(r)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}const Epe=[FM,PM,OM,MM,LM,jM,w8];function Ipe(){for(const n of Epe)Qe(n)}function C8(n,e){const t=n.shape.length,r=e.shape.length;if(t<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${t}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[r-1]>t)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[r-1]} vs. ${t}`);if(Le(n.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${n.shape}.`);const s=e.shape,o=s[s.length-1];let i=1;for(let d=0;d<s.length-1;++d)i*=s[d];const a=n.shape,l=s.slice();l.pop();let c=1;for(let d=o;d<t;++d)c*=a[d],l.push(a[d]);const u=[...nn(n.shape).map(d=>d/c),1].slice(0,o);return[l,i,c,u]}const G5=-2,Tpe=-1;function k8(n,e,t){const r=n.shape.length;X(r===e.length,()=>`Error in slice${r}D: Length of begin ${e} must match the rank of the array (${r}).`),X(r===t.length,()=>`Error in slice${r}D: Length of size ${t} must match the rank of the array (${r}).`);for(let s=0;s<r;++s)X(e[s]+t[s]<=n.shape[s],()=>`Error in slice${r}D: begin[${s}] + size[${s}] (${e[s]+t[s]}) would overflow input.shape[${s}] (${n.shape[s]})`)}function _pe(n){const e=[];let t=0;for(;n>0;)n&1&&e.push(t),n/=2,t++;return e}function S8(n,e,t){const r=[];for(let s=0;s<n.length;s++)r[s]=Math.ceil((e[s]-n[s])/t[s]);return r}function BM(n,e,t,r){const s=[...n];for(let o=s.length;o<r.length;o++)s.push(1);for(let o=0;o<t;o++)o===0?s[e]=1:(s.splice(e,0,1),s.pop());return s}function VM(n,e,t){return t<=n?t:t-(e-1)}function zM(n,e){const t=[];for(let r=0;r<n;r++)t.push(e+r);return t}function Rpe(n,e,t,r,s,o,i,a,l){const c=n.length;let u=new Array(c),d=new Array(c),f=new Array(c);if(e.length&&t>0){const p=e[0],x=t+1;u=WM(i,p,x,r,n),d=UM(a,p,x,s,n),f=BM(o,p,x,n)}else for(let p=0;p<c;p++)u[p]=GM(i,r,o,n,p,l),d[p]=qM(a,s,o,n,p,l),f[p]=HM(o,p,l);return{begin:u,end:d,strides:f}}function WM(n,e,t,r,s){const o=[...s],i=zM(t,e);for(let a=0;a<o.length;a++)if(i.indexOf(a)>-1)o[a]=0;else{const l=VM(e,t,a);let c=r[l];n&1<<l&&(c=0),o[a]=c}return o}function UM(n,e,t,r,s){const o=[...s],i=zM(t,e);for(let a=0;a<o.length;a++)if(i.indexOf(a)>-1)o[a]=Number.MAX_SAFE_INTEGER;else{const l=VM(e,t,a);let c=r[l];n&1<<l&&(c=Number.MAX_SAFE_INTEGER),o[a]=c}for(let a=0;a<o.length;a++){const l=s[a];o[a]<0&&(o[a]+=l),o[a]=Nf(0,o[a],s[a])}return o}function HM(n,e,t){let r=n[e];return(t&1<<e||r==null)&&(r=1),r}function GM(n,e,t,r,s,o){let i=e[s];const a=t[s]||1;(n&1<<s||o&1<<s||i==null)&&(a>0?i=Number.MIN_SAFE_INTEGER:i=Number.MAX_SAFE_INTEGER);const l=r[s];return i<0&&(i+=l),i=Nf(0,i,l-1),i}function qM(n,e,t,r,s,o){let i=e[s];const a=t[s]||1;(n&1<<s||o&1<<s||i==null)&&(a>0?i=Number.MAX_SAFE_INTEGER:i=Number.MIN_SAFE_INTEGER);const l=r[s];return i<0&&(i+=l),a>0?i=Nf(0,i,l):i=Nf(-1,i,l-1),i}function N8(n,e,t){let r=t.length;for(let s=0;s<t.length;s++)if(t[s]>1){r=s;break}for(let s=r+1;s<t.length;s++)if(e[s]>0||t[s]!==n[s])return!1;return!0}function E8(n,e){let t=n.length>0?n[n.length-1]:1;for(let r=0;r<n.length-1;r++)t+=n[r]*e[r];return t}function Jb(n,e,t){let r;const s=n.shape.length;typeof e=="number"?r=[e,...new Array(s-1).fill(0)]:e.length<s?r=e.concat(new Array(s-e.length).fill(0)):r=e.slice(),r.forEach(i=>{X(i!==-1,()=>"slice() does not support negative begin indexing.")});let o;return t==null?o=new Array(s).fill(-1):typeof t=="number"?o=[t,...new Array(s-1).fill(-1)]:t.length<s?o=t.concat(new Array(s-t.length).fill(-1)):o=t,o=o.map((i,a)=>i>=0?i:(X(i===-1,()=>`Negative size values should be exactly -1 but got ${i} for the slice() size at index ${a}.`),n.shape[a]-r[a])),[r,o]}function I8(n,e,t,r,s,o,i,a,l){let c;if(r==null?(c=new Array(e.length),c.fill(1)):c=r,i!=null&&(i&i-1)!==0)throw new Error("Multiple ellipses in slice is not allowed.");let u=!1;const d={dims:c.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:t.slice(),strides:c.slice(),beginMask:s,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:l};for(let S=0;S<d.dims;S++)u&&(1<<S&a)!==0&&d.numAddAxisAfterEllipsis++,1<<S&i&&(u=!0);u||(d.ellipsisMask|=1<<d.dims,d.dims++);const f={dims:n.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};Dpe(d,f);let p=!0,x=!0,v=!0;const y=[],b=[];for(let S=0;S<n.length;++S){if(f.strides[S]===0)throw Error(`strides[${S}] must be non-zero`);const k=!!(f.shrinkAxisMask&1<<S),N=n[S];if(N===-1){y.push(k?1:-1);continue}const I=[f.beginMask&1<<S,f.endMask&1<<S],T=[f.strides[S]>0?0:-1,f.strides[S]>0?N:N-1];if(k&&f.strides[S]<=0)throw Error("only stride 1 allowed on non-range indexing.");v=v&&f.strides[S]===1;const F=!!(f.beginMask&1<<S&&f.endMask&1<<S);if(f.beginValid&&f.endValid){if(k){const P=f.begin[S]<0?N+f.begin[S]:f.begin[S];if(f.begin[S]=P,f.end[S]=f.begin[S]+1,P<0||P>=N)throw Error(`slice index ${f.begin[S]} of dimension ${S} out of bounds.`)}else f.begin[S]=v_(f.begin[S],0,f.strides[S],N,I,T),f.end[S]=v_(f.end[S],1,f.strides[S],N,I,T);const A=f.strides[S]===1&&f.begin[S]===0&&f.end[S]===N;p=p&&A,x=x&&(S===0&&f.strides[S]===1||A)}else p=p&&f.strides[S]===1&&F,x=x&&(S===0&&f.strides[S]===1||F);let R,D=!1;if(f.beginValid&&f.endValid?(R=f.end[S]-f.begin[S],D=!0):k?(R=1,D=!0):F&&N>=0&&(f.strides[S]<0?R=-N:R=N,D=!0),D){let A;R===0||R<0!=f.strides[S]<0?A=0:A=Math.trunc(R/f.strides[S])+(R%f.strides[S]!==0?1:0),y.push(A)}else y.push(-1)}for(let S=0;S<f.finalShapeGatherIndices.length;++S){const k=f.finalShapeGatherIndices[S];k>=0?b.push(y[k]):k===G5&&b.push(1)}return{finalShapeSparse:b.filter((S,k)=>f.finalShapeGatherIndices[k]!==G5),finalShape:b,isIdentity:p,sliceDim0:x,isSimpleSlice:v,begin:f.begin,end:f.end,strides:f.strides}}function Dpe(n,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let t=0;e.beginValid=n.begin!=null,e.endValid=n.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let r=0;r<n.dims;r++)if(1<<r&n.ellipsisMask){const s=Math.min(e.dims-(n.dims-r)+1+n.numAddAxisAfterEllipsis,e.dims);for(;t<s;t++)e.begin[t]=0,e.end[t]=0,e.strides[t]=1,e.beginMask|=1<<t,e.endMask|=1<<t,e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[t]=r}else if(1<<r&n.newAxisMask)e.finalShapeGatherIndices.push(G5),e.finalShapeGatherIndicesSparse.push(-1);else{if(t===e.begin.length)throw Error(`Index out of range using input dim ${t}; input has only ${e.dims} dims, ${e.begin.length}.`);n.begin!=null&&(e.begin[t]=n.begin[r]),n.end!=null&&(e.end[t]=n.end[r]),e.strides[t]=n.strides[r],n.beginMask&1<<r&&(e.beginMask|=1<<t),n.endMask&1<<r&&(e.endMask|=1<<t),n.shrinkAxisMask&1<<r?(e.finalShapeGatherIndices.push(Tpe),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<t):(e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(r)),e.inputShapeGatherIndicesSparse[t]=r,t++}}function v_(n,e,t,r,s,o){if(s[e])return t>0?o[e]:o[e+1&1];{const i=n<0?r+n:n;return i<o[0]?o[0]:i>o[1]?o[1]:i}}const Ape=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:k8,computeFlatOffset:E8,computeOutShape:S8,getNormalizedAxes:Rpe,isSliceContinous:N8,maskToAxes:_pe,parseSliceParams:Jb,sliceInfo:I8,startForAxis:GM,startIndicesWithElidedDims:WM,stopForAxis:qM,stopIndicesWithElidedDims:UM,stridesForAxis:HM,stridesWithElidedDims:BM},Symbol.toStringTag,{value:"Module"}));class $pe{static sgd(e){return new w8(e)}static momentum(e,t,r=!1){return new LM(e,t,r)}static rmsprop(e,t=.9,r=0,s=null,o=!1){return new jM(e,t,r,s,o)}static adam(e=.001,t=.9,r=.999,s=null){return new OM(e,t,r,s)}static adadelta(e=.001,t=.95,r=null){return new FM(e,t,r)}static adamax(e=.002,t=.9,r=.999,s=null,o=0){return new MM(e,t,r,s,o)}static adagrad(e,t=.1){return new PM(e,t)}}const Vh=$pe;const Fpe=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:n=>n();function KM(){return new Promise(n=>Fpe(()=>n()))}function T8(n,e){const t=n[0].length;n.forEach((s,o)=>{X(s.length===t,()=>`Error in concat${t}D: rank of tensors[${o}] must be the same as the rank of the rest (${t})`)}),X(e>=0&&e<t,()=>`Error in concat${t}D: axis must be between 0 and ${t-1}.`);const r=n[0];n.forEach((s,o)=>{for(let i=0;i<t;i++)X(i===e||s[i]===r[i],()=>`Error in concat${t}D: Shape of tensors[${o}] (${s}) does not match the shape of the rest (${r}) along the non-concatenated axis ${o}.`)})}function tc(n,e){const t=n[0].slice();for(let r=1;r<n.length;r++)t[e]+=n[r][e];return t}var Ja;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(Ja||(Ja={}));function XM(n,e,t){let r=new Array;if(t==null&&e==null)return r;if(e==null)for(;r.length<n+t.length;)r.push(-1);else r=e.slice();if(t==null)return r;if(n+t.length!==r.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${n+t.length}, but shape.rank = ${r.length}`);for(let s=1;s<t.length;++s){const o=t[s],i=r[r.length-t.length+s],a=r[i];if(o>=0)if(a>=0){if(a!==o)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${s+n}] = ${o} but shape[${s+n}] = ${a}`)}else r[i]=o}return r}function YM(n){const e={FIRST_DIM_SIZE:Ja.FIRST_DIM_SIZE,VALUE_ROWIDS:Ja.VALUE_ROWIDS,ROW_LENGTHS:Ja.ROW_LENGTHS,ROW_SPLITS:Ja.ROW_SPLITS,ROW_LIMITS:Ja.ROW_LIMITS,ROW_STARTS:Ja.ROW_STARTS},t=[];for(const r of n)if(r in e)t.push(e[r]);else break;return t}function ZM(n){return n.length===0?0:n[0]===Ja.FIRST_DIM_SIZE?n.length-1:n.length}function JM(n,e){if(n==null||e==null)return;const t=n.length,r=e.length;if(t>=r)throw new Error(`defaultValue.shape=${n} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${t} must be less than ragged tensor input flatValues.rank = ${r})`);for(let s=0;s<Math.min(t,r-1);++s){const o=n[s],i=e[s+1];if(o>=0&&i>=0&&o!==1&&o!==i)throw new Error(`defaultValue.shape=${n}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${s-n.length}] = ${o} but ragged tensor input.flatValues.shape[${s-n.length}] = ${i}`)}}const _8=30;function Qb(n){return n<=_8?n:R5(n,Math.floor(Math.sqrt(n)))}function R8(n,e,t){const r=t*(typeof n=="number"?n:n[0]),s=e*(typeof n=="number"?n:n[1]);return[r,s]}function d0(n,e,t,r=!0){let s=[];if(r)s=s.concat(e.slice(0)),s.push(n[0]/t),s=s.concat(n.slice(1));else{s=s.concat(n[0]);const o=e.length;for(let i=0;i<o;++i)s=s.concat([n[i+1]/e[i],e[i]]);s=s.concat(n.slice(o+1))}return s}function f0(n,e,t=!0){const r=[];if(t){r.push(e);for(let s=e+1;s<n;++s)s<=2*e?(r.push(s),r.push(s-(e+1))):r.push(s)}else{const s=[],o=[];for(let i=1;i<n;++i)i>=e*2+1||i%2===1?o.push(i):s.push(i);r.push(...s),r.push(0),r.push(...o)}return r}function h0(n,e,t,r=!0){const s=[];r?s.push(n[0]/t):s.push(n[0]*t);for(let o=1;o<n.length;++o)o<=e.length?r?s.push(e[o-1]*n[o]):s.push(n[o]/e[o-1]):s.push(n[o]);return s}function D8(n,e){const t=[0];for(let r=0;r<e;++r)t.push(n[r][0]);return t}function A8(n,e,t){const r=n.slice(0,1);for(let s=0;s<t;++s)r.push(n[s+1]-e[s][0]-e[s][1]);return r}const ew=1.7580993408473768,tw=1.0507009873554805;const $8=.3275911,F8=.254829592,P8=-.284496736,O8=1.421413741,M8=-1.453152027,L8=1.061405429;function Hc(n,e){if(n.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${n.length}, imag: ${e.length}.`);const t=new Float32Array(n.length*2);for(let r=0;r<t.length;r+=2)t[r]=n[r/2],t[r+1]=e[r/2];return t}function QM(n){const e=new Float32Array(n.length/2),t=new Float32Array(n.length/2);for(let r=0;r<n.length;r+=2)e[r/2]=n[r],t[r/2]=n[r+1];return{real:e,imag:t}}function eL(n){const e=Math.ceil(n.length/4),t=new Float32Array(e),r=new Float32Array(e);for(let s=0;s<n.length;s+=4)t[Math.floor(s/4)]=n[s],r[Math.floor(s/4)]=n[s+1];return{real:t,imag:r}}function tL(n){const e=Math.floor(n.length/4),t=new Float32Array(e),r=new Float32Array(e);for(let s=2;s<n.length;s+=4)t[Math.floor(s/4)]=n[s],r[Math.floor(s/4)]=n[s+1];return{real:t,imag:r}}function j8(n,e){const t=n[e*2],r=n[e*2+1];return{real:t,imag:r}}function nL(n,e,t,r){n[r*2]=e,n[r*2+1]=t}function rL(n,e){const t=new Float32Array(n/2),r=new Float32Array(n/2);for(let s=0;s<Math.ceil(n/2);s++){const o=(e?2:-2)*Math.PI*(s/n);t[s]=Math.cos(o),r[s]=Math.sin(o)}return{real:t,imag:r}}function sL(n,e,t){const r=(t?2:-2)*Math.PI*(n/e),s=Math.cos(r),o=Math.sin(r);return{real:s,imag:o}}const f4="->",Ppe=/->/g,y_=",",b_="...";function B8(n,e){n=n.replace(/\s/g,"");const t=(n.length-n.replace(Ppe,"").length)/f4.length;if(t<1)throw new Error("Equations without an arrow are not supported.");if(t>1)throw new Error(`Equation must contain exactly one arrow ("${f4}").`);const[r,s]=n.split(f4);X(r.indexOf(b_)===-1,()=>`The ellipsis notation ("${b_}") is not supported yet.`);const o=r.split(y_),i=o.length;if(e!==i)throw new Error(`Expected ${i} input tensors, received ${e}`);if(i>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let f=0;f<s.length;++f){const p=s[f];if(!o.some(x=>x.indexOf(p)!==-1))throw new Error(`Output subscripts contain the label ${p} not present in the input subscripts.`);a.indexOf(p)===-1&&a.push(p)}for(let f=0;f<r.length;++f){const p=r[f];a.indexOf(p)===-1&&p!==y_&&a.push(p)}const l=new Array(o.length);for(let f=0;f<i;++f){if(new Set(o[f].split("")).size!==o[f].length)throw new Error(`Found duplicate axes in input component ${o[f]}. Support for duplicate axes in input is not implemented yet.`);l[f]=[];for(let p=0;p<o[f].length;++p)l[f].push(a.indexOf(o[f][p]))}const c=a.length,u=s.length,d=[];for(let f=u;f<c;++f)d.push(f);return{allDims:a,summedDims:d,idDims:l}}function V8(n,e){let t=new Array(n);t.fill(-1);for(let s=0;s<e.length;++s)t[e[s]]=s;const r=[];for(let s=0;s<n;++s)t[s]===-1&&r.push(s);return t=t.filter(s=>s!==-1),{permutationIndices:t,expandDims:r}}function z8(n,e,t){const r=new Array(n);for(let s=0;s<t.length;++s){const o=t[s].shape;for(let i=0;i<e[s].length;++i)r[e[s][i]]===void 0?r[e[s][i]]=o[i]:X(r[e[s][i]]===o[i],()=>`Expected dimension ${r[e[s][i]]} at axis ${i} of input shaped ${JSON.stringify(o)}, but got dimension ${o[i]}`)}}function W8(n,e){const t=n,r=[];let s=0;n.length===0&&t.push(-1),s=n.length+1;for(let i=0;i<s;++i)r.push([]);const o=[];for(let i=0;i<t.length;++i){const a=t[i],l=Ope(e,a);for(const c of l)o.indexOf(c)===-1&&(r[i].push(c),o.push(c))}return{path:t,steps:r}}function U8(n){return n.every((e,t)=>e===t)}function Ope(n,e){const t=[];for(let r=0;r<n.length;++r)(n[r].length===0||n[r].indexOf(e)!==-1||e===-1)&&t.push(r);return t}function H8(n,e,t=0){let r=[];if(typeof e=="number")X(n.shape[t]%e===0,()=>"Number of splits must evenly divide the axis."),r=new Array(e).fill(n.shape[t]/e);else{const s=e.reduce((i,a)=>(a===-1&&(i+=1),i),0);X(s<=1,()=>"There should be only one negative value in split array.");const o=e.indexOf(-1);if(o!==-1){const i=e.reduce((a,l)=>l>0?a+l:a);e[o]=n.shape[t]-i}X(n.shape[t]===e.reduce((i,a)=>i+a),()=>"The sum of sizes must match the size of the axis dimension."),r=e}return r}function oL(n){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${n}`}function iL(n,e){return`indices(${n}, 0) is invalid: ${e} < 0`}function aL(n,e,t){return`indices(${n}, 0) is invalid: ${e} >= ${t}`}function lL(n,e){return`only one output dimension may be -1, not both ${n} and ${e}`}function cL(n,e){return`size ${n} must be non-negative, not ${e}`}function uL(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function dL(n,e){const t=Le(n),r=Le(e);return`Input to reshape is a SparseTensor with ${t}
  dense values, but the requested shape requires a multiple of ${r}. inputShape=${n} outputShape= ${e}`}function fL(n,e){const t=Le(n),r=Le(e);return`Input to reshape is a tensor with ${t} dense values, but the requested shape has ${r}. inputShape=${n} outputShape=${e}`}function q5(){return"segment ids must be >= 0"}function hL(){return"segment ids are not increasing"}function pL(n,e){return`Segment id ${n} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function mL(n,e,t){return`Bad: indices[${n}] == ${e} out of range [0, ${t})`}function gL(n,e){let t=!1,r;for(n<=_8?(r=n,t=!0):r=R5(n,Math.floor(Math.sqrt(n)));!t;)r>e||r===n?t=!0:r=R5(n,r+1);return r}function xL(n,e,t){const r=[],s=n.length;for(let o=0;o<s;o++)o!==e?r.push(n[o]):r.push(t);return r}function G8(n,e,t,r){const s=e.shape.length,o=n.shape.length;if(r!==0&&(r<-s||r>s))throw new Error(`Expect batchDims in the range of [-${s}, ${s}], but got ${r}`);if(r<0&&(r+=s),r>o)throw new Error(`batchDims (${r}) must be less than rank(x) (
    ${o}).`);if(t<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${t}).`);for(let d=0;d<r;++d)if(n.shape[d]!==e.shape[d])throw new Error(`x.shape[${d}]: ${n.shape[d]} should be equal to indices.shape[${d}]: ${e.shape[d]}.`);const i=n.shape[t],a=[];let l=1,c=1,u=1;for(let d=0;d<r;++d)a.push(n.shape[d]),l*=n.shape[d];for(let d=r;d<t;d++)a.push(n.shape[d]),c*=n.shape[d];for(let d=r;d<s;d++)a.push(e.shape[d]);for(let d=t+1;d<o;d++)a.push(n.shape[d]),u*=n.shape[d];return{batchSize:l,sliceSize:u,outerSize:c,dimSize:i,outputShape:a}}const Mpe=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:G8,computeOutShape:xL,segOpComputeOptimalWindowSize:gL},Symbol.toStringTag,{value:"Module"}));function Gc(n){try{return n.map(e=>ld(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function vL(n){return n.map(e=>Qu(e))}const Lpe=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:F8,ERF_A2:P8,ERF_A3:O8,ERF_A4:M8,ERF_A5:L8,ERF_P:$8,PARALLELIZE_THRESHOLD:_8,get RowPartitionType(){return Ja},SELU_SCALE:tw,SELU_SCALEALPHA:ew,applyActivation:m8,assertAndGetBroadcastShape:Sn,assertAxesAreInnerMostDims:so,assertParamsConsistent:T8,assignToTypedArray:nL,axesAreInnerMostDims:JS,calculateShapes:Yf,checkEinsumDimSizes:z8,checkPadOnDimRoundingMode:oi,combineLocations:uM,combineRaggedTensorToTensorShapes:XM,complexWithEvenIndex:eL,complexWithOddIndex:tL,computeConv2DInfo:ro,computeConv3DInfo:bd,computeDefaultPad:GS,computeDilation2DInfo:i0,computeOptimalWindowSize:Qb,computeOutAndReduceShapes:Ws,computeOutShape:tc,computePool2DInfo:$a,computePool3DInfo:eu,convertConv2DDataFormat:tu,decodeEinsumEquation:B8,eitherStridesOrDilationsAreOne:xo,expandShapeToKeepDim:ps,exponent:sL,exponents:rL,fromStringArrayToUint8:vL,fromUint8ToStringArray:Gc,getAxesPermutation:Ur,getBroadcastDims:Ap,getComplexWithIndex:j8,getEinsumComputePath:W8,getEinsumPermutation:V8,getFusedBiasGradient:p8,getFusedDyActivation:h8,getImageCenter:R8,getInnerMostAxes:os,getPermuted:f0,getRaggedRank:ZM,getReductionAxes:Es,getReshaped:d0,getReshapedPermuted:h0,getRowPartitionTypesHelper:YM,getSliceBeginCoords:D8,getSliceSize:A8,getSparseFillEmptyRowsIndicesDenseShapeMismatch:oL,getSparseFillEmptyRowsNegativeIndexErrorMessage:iL,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:aL,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:uL,getSparseReshapeInputOutputMismatchErrorMessage:fL,getSparseReshapeInputOutputMultipleErrorMessage:dL,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:lL,getSparseReshapeNegativeOutputDimErrorMessage:cL,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:mL,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:q5,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:hL,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:pL,getUndoAxesPermutation:wd,isIdentityPermutation:U8,log:gle,mergeRealAndImagArrays:Hc,prepareAndValidate:C8,prepareSplitSize:H8,segment_util:Mpe,shouldFuse:g8,slice_util:Ape,splitRealAndImagArrays:QM,stridesOrDilationsArePositive:Rf,tupleValuesAreOne:_f,upcastType:Ei,validateDefaultValueShape:JM,validateInput:mhe,validateUpdateShape:TM,warn:Gi},Symbol.toStringTag,{value:"Module"}));Ipe();const yL={kernelName:Wy,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>fe(n,u0(It(t,"float32"),-1))}}};const jpe={kernelName:d1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const r=Ar(It(t,"float32")),s=go(hn(ar(1),r));return rs(ln(n,s))}}}};const Bpe={kernelName:f1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const r=go(hn(Ar(It(t,"float32")),1));return ln(n,r)}}}};const Vpe={kernelName:Zp,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=Sn(t.shape,r.shape);return{a:()=>{let a=n;const l=Es(t.shape,s);return l.length>0&&(a=on(a,l)),ye(a,t.shape)},b:()=>{let a=n;const l=Es(r.shape,s);return l.length>0&&(a=on(a,l)),ye(a,r.shape)}}}};const zpe={kernelName:rS,saveAllInputs:!0,gradFunc:(n,e)=>{const t={};return e.forEach((r,s)=>{t[s]=()=>n.clone()}),t}};const Wpe={kernelName:Uy,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Gn(t)}}};const Upe={kernelName:Hy,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Gn(t)}}};const Hpe={kernelName:h1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ln(n,go(hn(ar(1),Ar(It(t,"float32")))))}}};const Gpe={kernelName:p1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const r=go(ot(ar(1),Ar(It(t,"float32"))));return ln(n,r)}}}};const qpe={kernelName:x1,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=Sn(t.shape,r.shape);return{a:()=>{const a=ot(Ar(t),Ar(r));let l=fe(n,ln(r,a));const c=Es(t.shape,s);return c.length>0&&(l=on(l,c)),ye(l,t.shape)},b:()=>{const a=ot(Ar(t),Ar(r));let l=rs(fe(n,ln(t,a)));const c=Es(r.shape,s);return c.length>0&&(l=on(l,c)),ye(l,r.shape)}}}};const Kpe={kernelName:m1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ln(n,ot(Ar(It(t,"float32")),1))}}};const Xpe={kernelName:g1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ln(n,hn(ar(1),Ar(It(t,"float32"))))}}};function Ype(n,e,t,r,s,o){const i=se(n,"dy","avgPool3dGrad"),a=se(e,"input","avgPool3dGrad");let l=i,c=a,u=!1;a.rank===4&&(u=!0,l=ye(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]]),c=ye(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),X(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),X(c.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${c.rank}.`),oi("avgPool3dGrad",s,o);const d={dy:l,input:c},f={filterSize:t,strides:r,pad:s,dimRoundingMode:o},p=me.runKernel(aS,d,f);return u?ye(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const Zpe=be({avgPool3dGrad_:Ype});const Jpe={kernelName:qy,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{filterSize:s,strides:o,pad:i,dimRoundingMode:a}=t;return{x:()=>Zpe(n,r,s,o,i,a)}}};function Qpe(n,e,t,r,s){const o=se(n,"dy","avgPoolGrad"),i=se(e,"input","avgPoolGrad");X(i.rank===o.rank,()=>`Rank of input (${i.rank}) does not match rank of dy (${o.rank})`);let a=i,l=o,c=!1;i.rank===3&&(c=!0,a=ye(i,[1,i.shape[0],i.shape[1],i.shape[2]]),l=ye(o,[1,o.shape[0],o.shape[1],o.shape[2]])),X(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),X(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const u={dy:l,input:a},d={filterSize:t,strides:r,pad:s},f=me.runKernel(iS,u,d);return c?ye(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const eme=be({avgPoolGrad_:Qpe});const tme={kernelName:Gy,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{filterSize:s,strides:o,pad:i}=t;return{x:()=>eme(n,r,s,o,i)}}};const nme={kernelName:Ky,inputsToSave:["a","b"],gradFunc:(n,e,t)=>{const[r,s]=e,{transposeA:o,transposeB:i}=t;return!o&&!i?{a:()=>or(n,s,!1,!0),b:()=>or(r,n,!0,!1)}:!o&&i?{a:()=>or(n,s,!1,!1),b:()=>or(n,r,!0,!1)}:o&&!i?{a:()=>or(s,n,!1,!0),b:()=>or(r,n,!1,!1)}:{a:()=>or(s,n,!0,!0),b:()=>or(n,r,!0,!0)}}};const rme={kernelName:Xy,gradFunc:(n,e,t)=>{const{blockShape:r,crops:s}=t;return{x:()=>i8(n,r,s)}}};const sme={kernelName:fle,gradFunc:(n,e,t)=>{const r=t,s=r.inputShape,o=r.shape,i=Array.from(o);for(let l=s.length-1;l>=0;l--)if(s[l]===o[l])i[l]=1;else if(s[l]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${o}].`);const a=[];for(let l=0;l<i.length;l++)i[l]>1&&a.push(l);return{x:()=>on(n,a,!0)}}};const ome={kernelName:v1,gradFunc:n=>({x:()=>n.clone()})};const ime={kernelName:y1,gradFunc:n=>({x:()=>Gn(n)})};const ame={kernelName:b1,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{clipValueMin:s,clipValueMax:o}=t;return{x:()=>Vo(Wc(Kf(r,s),em(r,o)),n,Gn(n))}}};const lme={kernelName:Yy,inputsToSave:["x"],gradFunc:yL.gradFunc};const cme={kernelName:Zy,saveAllInputs:!0,gradFunc:(n,e,t)=>{const r=e.map(l=>l.shape),{axis:s}=t,o=Fn(s,e[0].shape)[0],i=r.map(l=>l[o]);return ea(n,i,o).map(l=>()=>l)}};const ume={kernelName:Jy,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[r,s]=e,{dilations:o,strides:i,pad:a,dataFormat:l}=t;return X(_f(o),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`),{x:()=>XS(r.shape,n,s,i,a,l),filter:()=>f8(r,n,s.shape,i,a,l)}}};const dme={kernelName:Qy,inputsToSave:["dy","filter"],gradFunc:(n,e,t)=>{const[r,s]=e,{strides:o,pad:i,dataFormat:a,dimRoundingMode:l}=t;return{dy:()=>Df(n,s,o,i,a,1,l),filter:()=>f8(n,r,s.shape,o,i,a,l)}}};function fme(n,e,t,r,s){let o=n;n.rank===4&&(o=ye(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));let i=e;i.rank===4&&(i=ye(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),X(o.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${o.shape}.`),X(i.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${i.shape}.`),X(t.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${t}.`),X(o.shape[4]===t[3],()=>`Error in conv3dDerFilter: depth of input ${o.shape[4]}) must match input depth in filter (${t[3]}.`),X(i.shape[4]===t[4],()=>`Error in conv3dDerFilter: depth of dy (${i.shape[4]}) must match output depth for filter (${t[4]}).`);const a={x:o,dy:i},l={strides:r,pad:s,filterShape:t};return me.runKernel(fS,a,l)}const hme=be({conv3DBackpropFilter_:fme});const pme={kernelName:eb,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:r,strides:s,pad:o}=t;X(_f(r),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`);const[i,a]=e;return{x:()=>iM(i.shape,n,a,s,o),filter:()=>hme(i,n,a.shape,s,o)}}};const mme={kernelName:w1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>fe(rs(SM(It(t,"float32"))),n)}}};const gme={kernelName:C1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>fe(NM(It(t,"float32")),n)}}};const xme={kernelName:tb,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{axis:s,exclusive:o,reverse:i}=t;return{x:()=>{const a=Ur([s],r.rank);let l=lM(n,s,o,!i);return a!=null&&(l=Hn(l,a)),l}}}};const vme={kernelName:nb,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:r,strides:s,pad:o,dimRoundingMode:i}=t,a=r??[1,1];X(_f(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[l,c]=e;return X(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),X(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${c.rank}.`),X(l.shape[3]===c.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${c.shape[2]}.`),X(xo(s,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${s} and dilations '${a}'.`),oi("depthwiseConv2d",o,i),{x:()=>Fhe(l.shape,n,c,s,o,a,i),filter:()=>Ahe(l,n,c.shape,s,o,a,i)}}};const yme={kernelName:rb,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[r,s]=e,o={x:r,filter:s,dy:n},i={x:r,filter:s,dy:n};return{x:()=>me.runKernel(D5,o,t),filter:()=>me.runKernel(A5,i,t)}}};const bme={kernelName:S1,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e,r={dy:n,y:t};return{x:()=>me.runKernel(wS,r)}}};const wme={kernelName:N1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,r=fe(lc(rs(Ar(t))),2/Math.sqrt(Math.PI));return{x:()=>fe(n,r)}}};const Cme={kernelName:E1,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>fe(n,t)}}};const kme={kernelName:ob,inputsToSave:["input"],gradFunc:(n,e)=>{const[t]=e;return{input:()=>ye(n,t.shape)}}};const Sme={kernelName:I1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>fe(n,lc(t))}}};const Nme={kernelName:T1,gradFunc:n=>({x:()=>Gn(n)})};const Eme={kernelName:_1,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=Sn(t.shape,r.shape);return{a:()=>{const a=ln(n,It(r,"float32")),l=Es(t.shape,s);return l.length>0?ye(on(a,l),t.shape):a},b:()=>{let a=fe(n,It(t,"float32"));const l=Es(r.shape,s);l.length>0&&(a=ye(on(a,l),r.shape));const c=Ar(r);return rs(ln(a,It(c,"float32")))}}}};const Ime={kernelName:ib,inputsToSave:["x","mean","variance","scale"],gradFunc:(n,e,t)=>{const{varianceEpsilon:r}=t,[s,o,i,a]=e,l=a??ar(1),c=Es(o.shape,s.shape),u=[];if(o.rank===1){for(let k=0;k<s.shape.length-1;++k)u.push(s.shape[k]);u.push(1)}const d=hn(s,o),f=fe(n,l),p=wM(ot(i,ar(r))),x=fe(fe(fe(p,p),p),ar(-.5));return{x:()=>o.rank===1?ye(fe(fe(n,sl(ye(p,[1,1,1,o.shape[0]]),u)),l),s.shape):ye(fe(fe(n,p),l),s.shape),mean:()=>{let k=fe(fe(p,ar(-1)),f);return o.rank===1&&(k=on(k,c)),ye(k,o.shape)},variance:()=>{let k=fe(fe(x,d),f);return o.rank===1&&(k=on(k,c)),ye(k,o.shape)},scale:()=>{const k=fe(d,p);let N=fe(n,k);return o.rank===1&&(N=on(N,c)),ye(N,o.shape)},offset:()=>{let k=n;return o.rank===1&&(k=on(k,c)),ye(k,o.shape)}}}};const Tme={kernelName:ab,inputsToSave:["x","indices"],gradFunc:(n,e,t)=>{const[r,s]=e,{axis:o,batchDims:i}=t,a=Fn(o,r.shape)[0],l=(c,u,d)=>()=>{const f=c.shape,p=u.size,x=f.slice(0,a),v=x.length,y=f.slice(o,f.length).slice(1),b=y.length,w=w_(0,v),S=w_(v+1,v+1+b),k=C_([x,[p],y]),N=ye(d,k),I=ye(u,[p]),T=C_([[v],w,S]),F=Hn(N,T);let R=RM(F,I,c.shape[a]);const D=wd(T);return R=Hn(R,D),R};if(i===1){const c=r.shape[0],u=r.split(c,0);return{x:()=>Uc(u.map((p,x)=>l(p,s.slice(x,1),n.slice(x,1))())).reshape(r.shape),indices:()=>s}}else return{x:l(r,s,n),indices:()=>s}}};function w_(n,e){const t=[];for(let r=n;r<e;++r)t.push(r);return t}function C_(n){const e=[];for(let t=0;t<n.length;++t)for(let r=0;r<n[t].length;++r)e.push(n[t][r]);return e}const _me={kernelName:R1,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e;return{a:()=>Gn(t),b:()=>Gn(r)}}};const Rme={kernelName:D1,gradFunc:n=>({x:()=>It(n,"float32")})};const Dme={kernelName:A1,gradFunc:n=>({x:()=>Gn(n)})};const Ame={kernelName:$1,gradFunc:n=>({x:()=>Gn(n)})};const $me={kernelName:F1,gradFunc:n=>({x:()=>Gn(n)})};const Fme={kernelName:cb,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{alpha:s}=t,o=sa(r,0);return{x:()=>Vo(o,n,fe(n,s))}}};const Pme={kernelName:O1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ln(n,ot(t,1))}}};const Ome={kernelName:P1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ln(n,It(t,"float32"))}}};const Mme={kernelName:ple,inputsToSave:[],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[r]=e,{axis:s}=t;return{logits:()=>{const i=lc(r);return hn(n,fe(on(n,s,!0),i))}}}};function Lme(n,e,t,r=5,s=1,o=1,i=.5){const a={x:n,y:e,dy:t},l={depthRadius:r,bias:s,alpha:o,beta:i};return me.runKernel(IS,a,l)}const jme=be({localResponseNormalizationBackprop_:Lme});const Bme={kernelName:mb,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[r,s]=e,{depthRadius:o,bias:i,alpha:a,beta:l}=t;return{x:()=>jme(r,s,n,o,i,a,l)}}};function bL(n,e,t,r){return e.rank<t.rank&&(e=ye(e,ps(e.shape,r))),n.rank<t.rank&&(n=ye(n,ps(n.shape,r))),{x:()=>fe(n,It(ac(t,e),n.dtype))}}const k_={kernelName:gb,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const r=t,{reductionIndices:s}=r,o=e[0],i=e[1],a=Fn(s,o.shape),l=bL(n,i,o,a);return{x:()=>l.x()}}};const Vme={kernelName:M1,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e;return{a:()=>fe(n,It(Kf(t,r),"float32")),b:()=>fe(n,It(j2(t,r),"float32"))}}};function zme(n,e,t,r,s,o,i){const a=se(n,"dy","maxPool3dGrad"),l=se(e,"input","maxPool3dGrad"),c=se(t,"output","maxPool3dGrad");let u=a,d=l,f=c,p=!1;l.rank===4&&(p=!0,u=ye(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),d=ye(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),f=ye(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),X(u.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),X(d.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${d.rank}.`),X(f.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${f.rank}.`),oi("maxPool3dGrad",o,i);const x={dy:u,input:d,output:f},v={filterSize:r,strides:s,pad:o,dimRoundingMode:i},y=me.runKernel(_S,x,v);return p?ye(y,[y.shape[1],y.shape[2],y.shape[3],y.shape[4]]):y}const Wme=be({maxPool3dGrad_:zme});const Ume={kernelName:vb,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[r,s]=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:l}=t;return{x:()=>Wme(n,r,s,o,i,a,l)}}};function Hme(n,e,t,r,s,o,i){const a=se(n,"dy","maxPoolGrad"),l=se(e,"input","maxPoolGrad"),c=se(t,"output","maxPoolGrad");X(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),X(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),X(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),oi("maxPoolGrad",o,i);const u={dy:a,input:l,output:c},d={filterSize:r,strides:s,pad:o,dimRoundingMode:i};return me.runKernel(TS,u,d)}const Gme=be({maxPoolGrad_:Hme});const qme={kernelName:xb,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[r,s]=e,{filterSize:o,strides:i,pad:a}=t;return{x:()=>Gme(n,r,s,o,i,a)}}};const Kme={kernelName:yb,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{axis:s}=t,o=Fn(s,r.shape),a=Ws(r.shape,o)[1],l=Le(a);return{x:()=>{const u=r.shape.slice();o.forEach(p=>{u[p]=1});const d=ye(n,u);return ln(fe(d,kd(r.shape,"float32")),l)}}}};const Xme={kernelName:bb,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const r=t,{axis:s}=r,[o,i]=e,a=Fn(s,o.shape),l=bL(n,i,o,a);return{x:()=>l.x()}}};const Yme={kernelName:L1,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e;return{a:()=>fe(n,It(em(t,r),"float32")),b:()=>fe(n,It(sa(t,r),"float32"))}}};const Zme={kernelName:wb,inputsToSave:["x"],gradFunc:(n,e,t)=>{const r=e[0],{paddings:s}=t,o=s.map(i=>i[0]);return{x:()=>Ir(n,o,r.shape)}}};const Jme={kernelName:j1,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=Sn(t.shape,r.shape);return{a:()=>{const a=Es(t.shape,s);return a.length>0?ye(on(n,a),t.shape):n},b:()=>{const a=fe(n,rs(Zb(ln(t,r)))),l=Es(r.shape,s);return l.length>0?ye(on(a,l),r.shape):a}}}};const Qme={kernelName:B1,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=Sn(t.shape,r.shape);return{a:()=>{const a=fe(n,It(r,"float32")),l=Es(t.shape,s);return l.length>0?ye(on(a,l),t.shape):a},b:()=>{const a=fe(n,It(t,"float32")),l=Es(r.shape,s);return l.length>0?ye(on(a,l),r.shape):a}}}};const ege={kernelName:Cb,gradFunc:n=>({x:()=>rs(n)})};const tge={kernelName:Nb,inputsToSave:["indices"],gradFunc:(n,e)=>{const t=e[0];return{indices:()=>Ps(t.shape,"float32")}}};const nge={kernelName:Sb,gradFunc:n=>({x:()=>Gn(n)})};const rge={kernelName:Eb,saveAllInputs:!0,gradFunc:(n,e,t)=>{const{axis:r}=t;return Ff(n,r).map(o=>()=>o)}};const S_={kernelName:Ib,inputsToSave:["x"],gradFunc:(n,e,t)=>{const r=e[0],{paddings:s}=t,o=s.map(i=>i[0]);return{x:()=>Ir(n,o,r.shape)}}};const sge={kernelName:V1,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(n,e)=>{const[t,r,s]=e,o=t,i=r,a=Sn(o.shape,i.shape);return{a:()=>{const u=It(i,"float32");let d=fe(n,fe(u,Af(o,hn(u,ar(1)))));const f=Es(o.shape,a);return f.length>0&&(d=on(d,f)),ye(d,o.shape)},b:()=>{const u=sa(o,0),d=Vo(u,cc(o),Gn(o));let f=fe(n,fe(s,d));const p=Es(i.shape,a);return p.length>0&&(f=on(f,p)),ye(f,i.shape)}}}};const oge={kernelName:Tb,inputsToSave:["x","alpha"],gradFunc:(n,e)=>{const[t,r]=e,s=sa(t,0);return{x:()=>Vo(s,n,fe(n,r)),alpha:()=>{let o=Vo(s,Gn(n),fe(n,t));const i=Es(r.shape,n.shape);return i.length>0&&(o=on(o,i)),ye(o,r.shape)}}}};function ige(n,e,t){const r=n.shape.slice();r[t]=1;const s=ye(e,r),o=U5(n,t,!0,!1),i=U5(n,t,!0,!0),a=fe(o,i);return fe(s,a)}function age(n,e,t){const r=n.shape.length,s=r-t.length,o=Ur(t,r);let i=n;o!=null&&(i=Hn(n,o));const a=i.shape.slice(),c=a.splice(r-t.length,t.length).reduce((f,p)=>f*p,1);a.push(c);const u=i.reshape(a);let d=ige(u,e,s);if(d=d.reshape(i.shape),o!=null){const f=wd(o);d=Hn(d,f)}return d}const lge={kernelName:_b,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{axis:s}=t;let o=[];return s==null?o=r.shape.map((i,a)=>a):typeof s=="number"?o=[s]:o=s,{x:()=>age(r,n,o)}}};const cge={kernelName:k1,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=Sn(t.shape,r.shape);return{a:()=>{const a=ln(n,It(r,"float32")),l=Es(t.shape,s);return l.length>0?ye(on(a,l),t.shape):a},b:()=>{let a=fe(n,It(t,"float32"));const l=Es(r.shape,s);l.length>0&&(a=ye(on(a,l),r.shape));const c=Ar(r);return rs(ln(a,It(c,"float32")))}}}};const uge={kernelName:z1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ln(n,rs(Ar(t)))}}};const dge={kernelName:U1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,r=fe(em(t,6),u0(t));return{x:()=>fe(n,It(r,"float32"))}}};const fge={kernelName:W1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>fe(n,It(u0(t),"float32"))}}};const hge={kernelName:Rb,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ye(n,t.shape)}}};const pge={kernelName:Ab,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[r]=e,s={dy:n,images:r};return{images:()=>me.runKernel(OS,s,t)}}};const mge={kernelName:Db,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[r]=e,s={dy:n,images:r};return{images:()=>me.runKernel(PS,s,t)}}};const gge={kernelName:$b,gradFunc:(n,e,t)=>{const{dims:r}=t,s=Fn(r,n.shape);return{x:()=>$f(n,s)}}};const xge={kernelName:H1,gradFunc:n=>({x:()=>Gn(n)})};const vge={kernelName:G1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>rs(ln(n,fe(Af(t,1.5),2)))}}};const yge={kernelName:Fb,inputsToSave:["condition"],gradFunc:(n,e)=>{const[t]=e;return{condition:()=>It(Gn(t),"float32"),t:()=>fe(n,It(t,n.dtype)),e:()=>fe(n,It(n8(t),n.dtype))}}};const bge={kernelName:q1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const r=sa(t,ar(0)),s=ar(ew),o=ar(tw),i=fe(n,o),a=fe(fe(n,s),lc(It(t,"float32")));return Vo(r,i,a)}}}};const wge={kernelName:Z1,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>fe(n,fe(t,hn(ar(1),t)))}}};const Cge={kernelName:Y1,gradFunc:n=>({x:()=>Gn(n)})};const kge={kernelName:K1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>fe(YS(It(t,"float32")),n)}}};const Sge={kernelName:X1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>fe(aM(It(t,"float32")),n)}}};const Nge={kernelName:Pb,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{begin:s,size:o}=t,i=r.shape,[a,l]=Jb(r,s,o),c=[];for(let u=0;u<n.rank;u++)c.push([a[u],i[u]-a[u]-l[u]]);return{x:()=>o8(n,c)}}};const Ege={kernelName:jb,outputsToSave:[!0],gradFunc:(n,e,t)=>{const[r]=e,{dim:s}=t,o=!0,i=fe(n,r);return{logits:()=>hn(i,fe(on(i,[s],o),r))}}};const Ige={kernelName:J1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>fe(n,Qp(t))}}};const N_={kernelName:Mb,gradFunc:(n,e,t)=>{const{blockShape:r,paddings:s}=t;return{x:()=>KS(n,r,s)}}};const E_={kernelName:Lb,gradFunc:(n,e,t)=>{const{axis:r}=t;return{x:()=>ei(n,r)}}};const Tge={kernelName:Q1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ln(n,fe(go(It(t,"float32")),2))}}};const _ge={kernelName:MS,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>fe(n,fe(It(t,"float32"),2))}}};const Rge={kernelName:e0,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=ar(2);return{a:()=>fe(n,fe(s,hn(t,r))),b:()=>fe(n,fe(s,hn(r,t)))}}};const Dge={kernelName:o0,gradFunc:n=>({x:()=>Gn(n)})};const Age={kernelName:t0,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,r]=e,s=Sn(t.shape,r.shape);return{a:()=>{let a=n;const l=Es(t.shape,s);return l.length>0&&(a=on(a,l)),ye(a,t.shape)},b:()=>{let a=n;const l=Es(r.shape,s);return l.length>0&&(a=on(a,l)),ye(rs(a),r.shape)}}}};const $ge={kernelName:Ob,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,s=r.shape.slice(),{axis:o}=t;Fn(o,r.shape).forEach(c=>{s[c]=1});const a=ye(n,s),l=fe(a,kd(r.shape,"float32"));return{x:()=>l}}};const Fge={kernelName:n0,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>ln(n,Ar(YS(t)))}}};const Pge={kernelName:r0,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>fe(hn(ar(1),Ar(t)),n)}}};const Oge={kernelName:s0,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[r]=e,{reps:s}=t;return{x:()=>{let i=Gn(r);if(r.rank===1)for(let a=0;a<s[0];++a)i=ot(i,Ir(n,[a*r.shape[0]],[r.shape[0]]));else if(r.rank===2)for(let a=0;a<s[0];++a)for(let l=0;l<s[1];++l)i=ot(i,Ir(n,[a*r.shape[0],l*r.shape[1]],[r.shape[0],r.shape[1]]));else if(r.rank===3)for(let a=0;a<s[0];++a)for(let l=0;l<s[1];++l)for(let c=0;c<s[2];++c)i=ot(i,Ir(n,[a*r.shape[0],l*r.shape[1],c*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else if(r.rank===4)for(let a=0;a<s[0];++a)for(let l=0;l<s[1];++l)for(let c=0;c<s[2];++c)for(let u=0;u<s[3];++u)i=ot(i,Ir(n,[a*r.shape[0],l*r.shape[1],c*r.shape[2],u*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${r.rank} tensors yet.`);return i}}}};const Mge={kernelName:pp,gradFunc:(n,e,t)=>{const r=t,{perm:s}=r,o=wd(s);return{x:()=>Hn(n,o)}}};const Lge={kernelName:Bb,gradFunc:(n,e,t)=>{const r=t,{axis:s}=r;return{value:()=>Uc(n,s)}}};const jge={kernelName:Vb,inputsToSave:["segmentIds"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Bge(n,t)}}};function Bge(n,e){const t=Cd(e,Gn(e)),r=QS(n,t);let s=Kf(e,ar(0,"int32"));const o=r.rank-s.rank;for(let a=0;a<o;++a)s=Jo(s,a+1);s=Wc(s,kd(r.shape,"bool"));const i=Gn(r);return Vo(s,r,i)}const Vge={kernelName:zb,gradFunc:n=>({x:()=>Gn(n)})};const zge=[yL,jpe,Bpe,Vpe,zpe,Wpe,Upe,Hpe,Gpe,qpe,Kpe,Xpe,Jpe,tme,nme,rme,sme,ome,ime,ame,lme,cme,dme,ume,pme,mme,gme,xme,vme,yme,cge,bme,wme,Cme,kme,Sme,Eme,Nme,Ime,Tme,_me,Rme,Dme,Ame,$me,Fme,Pme,Ome,Mme,Bme,k_,k_,Vme,Ume,qme,Kme,Xme,Yme,Zme,Jme,Qme,ege,tge,nge,rge,S_,S_,sge,oge,lge,uge,dge,fge,hge,pge,mge,gge,xge,vge,yge,bge,wge,Cge,kge,Sge,Nge,Ege,Ige,N_,N_,E_,E_,Tge,Rge,_ge,Dge,Age,$ge,Fge,Pge,Oge,Mge,Lge,jge,Vge];for(const n of zge)xle(n);Me().prototype.abs=function(){return this.throwIfDisposed(),Ao(this)};Me().prototype.acos=function(){return this.throwIfDisposed(),Cce(this)};Me().prototype.acosh=function(){return this.throwIfDisposed(),Sce(this)};Me().prototype.add=function(n){return this.throwIfDisposed(),ot(this,n)};Me().prototype.all=function(n,e){return this.throwIfDisposed(),rM(this,n,e)};Me().prototype.any=function(n,e){return this.throwIfDisposed(),z5(this,n,e)};Me().prototype.argMax=function(n){return this.throwIfDisposed(),Fg(this,n)};Me().prototype.argMin=function(n){return this.throwIfDisposed(),_ce(this,n)};Me().prototype.asScalar=function(){return this.throwIfDisposed(),X(this.size===1,()=>"The array must have only 1 element."),ye(this,[])};Me().prototype.asType=function(n){return this.throwIfDisposed(),It(this,n)};Me().prototype.as1D=function(){return this.throwIfDisposed(),ye(this,[this.size])};Me().prototype.as2D=function(n,e){return this.throwIfDisposed(),ye(this,[n,e])};Me().prototype.as3D=function(n,e,t){return this.throwIfDisposed(),ye(this,[n,e,t])};Me().prototype.as4D=function(n,e,t,r){return this.throwIfDisposed(),ye(this,[n,e,t,r])};Me().prototype.as5D=function(n,e,t,r,s){return this.throwIfDisposed(),ye(this,[n,e,t,r,s])};Me().prototype.asin=function(){return this.throwIfDisposed(),Dce(this)};Me().prototype.asinh=function(){return this.throwIfDisposed(),$ce(this)};Me().prototype.atan=function(){return this.throwIfDisposed(),Pce(this)};Me().prototype.atan2=function(n){return this.throwIfDisposed(),Mce(this,n)};Me().prototype.atanh=function(){return this.throwIfDisposed(),jce(this)};Me().prototype.avgPool=function(n,e,t,r){return this.throwIfDisposed(),qS(this,n,e,t,r)};Me().prototype.batchToSpaceND=function(n,e){return this.throwIfDisposed(),KS(this,n,e)};Me().prototype.batchNorm=function(n,e,t,r,s){return this.throwIfDisposed(),qb(this,n,e,t,r,s)};Me().prototype.broadcastTo=function(n){return this.throwIfDisposed(),pg(this,n)};Me().prototype.cast=function(n){return this.throwIfDisposed(),It(this,n)};Me().prototype.ceil=function(){return this.throwIfDisposed(),fue(this)};Me().prototype.clipByValue=function(n,e){return this.throwIfDisposed(),na(this,n,e)};Me().prototype.concat=function(n,e){return this.throwIfDisposed(),n instanceof ys&&(n=[n]),ei([this,...n],e)};Me().prototype.conv1d=function(n,e,t,r,s,o){return this.throwIfDisposed(),sM(this,n,e,t,r,s,o)};Me().prototype.conv2dTranspose=function(n,e,t,r,s){return this.throwIfDisposed(),oM(this,n,e,t,r,s)};Me().prototype.conv2d=function(n,e,t,r,s,o){return this.throwIfDisposed(),Df(this,n,e,t,r,s,o)};Me().prototype.cos=function(){return this.throwIfDisposed(),YS(this)};Me().prototype.cosh=function(){return this.throwIfDisposed(),aM(this)};Me().prototype.cumprod=function(n,e,t){return this.throwIfDisposed(),U5(this,n,e,t)};Me().prototype.cumsum=function(n,e,t){return this.throwIfDisposed(),lM(this,n,e,t)};Me().prototype.depthToSpace=function(n,e){return this.throwIfDisposed(),Mue(this,n,e)};Me().prototype.depthwiseConv2d=function(n,e,t,r,s,o){return this.throwIfDisposed(),ZS(this,n,e,t,r,s,o)};Me().prototype.dilation2d=function(n,e,t,r,s){return this.throwIfDisposed(),Bue(this,n,e,t,r,s)};Me().prototype.divNoNan=function(n){return this.throwIfDisposed(),Hue(this,n)};Me().prototype.div=function(n){return this.throwIfDisposed(),ln(this,n)};Me().prototype.dot=function(n){return this.throwIfDisposed(),que(this,n)};Me().prototype.elu=function(){return this.throwIfDisposed(),Xb(this)};Me().prototype.equal=function(n){return this.throwIfDisposed(),ac(this,n)};Me().prototype.erf=function(){return this.throwIfDisposed(),cM(this)};Me().prototype.euclideanNorm=function(n,e){return this.throwIfDisposed(),ode(this,n,e)};Me().prototype.exp=function(){return this.throwIfDisposed(),lc(this)};Me().prototype.expandDims=function(n){return this.throwIfDisposed(),Jo(this,n)};Me().prototype.expm1=function(){return this.throwIfDisposed(),cde(this)};Me().prototype.fft=function(){return this.throwIfDisposed(),IM(this)};Me().prototype.flatten=function(){return this.throwIfDisposed(),ye(this,[this.size])};Me().prototype.floor=function(){return this.throwIfDisposed(),Zb(this)};Me().prototype.floorDiv=function(n){return this.throwIfDisposed(),nM(this,n)};Me().prototype.gather=function(n,e,t){return this.throwIfDisposed(),QS(this,n,e,t)};Me().prototype.greaterEqual=function(n){return this.throwIfDisposed(),Kf(this,n)};Me().prototype.greater=function(n){return this.throwIfDisposed(),sa(this,n)};Me().prototype.ifft=function(){return this.throwIfDisposed(),H5(this)};Me().prototype.irfft=function(){return this.throwIfDisposed(),nhe(this)};Me().prototype.isFinite=function(){return this.throwIfDisposed(),vde(this)};Me().prototype.isInf=function(){return this.throwIfDisposed(),bde(this)};Me().prototype.isNaN=function(){return this.throwIfDisposed(),Cde(this)};Me().prototype.leakyRelu=function(n){return this.throwIfDisposed(),t8(this,n)};Me().prototype.lessEqual=function(n){return this.throwIfDisposed(),em(this,n)};Me().prototype.less=function(n){return this.throwIfDisposed(),j2(this,n)};Me().prototype.localResponseNormalization=function(n,e,t,r){return this.throwIfDisposed(),Ide(this,n,e,t,r)};Me().prototype.logSigmoid=function(){return this.throwIfDisposed(),Fde(this)};Me().prototype.logSoftmax=function(n){return this.throwIfDisposed(),pM(this,n)};Me().prototype.logSumExp=function(n,e){return this.throwIfDisposed(),mM(this,n,e)};Me().prototype.log=function(){return this.throwIfDisposed(),cc(this)};Me().prototype.log1p=function(){return this.throwIfDisposed(),hM(this)};Me().prototype.logicalAnd=function(n){return this.throwIfDisposed(),Wc(this,n)};Me().prototype.logicalNot=function(){return this.throwIfDisposed(),n8(this)};Me().prototype.logicalOr=function(n){return this.throwIfDisposed(),gM(this,n)};Me().prototype.logicalXor=function(n){return this.throwIfDisposed(),zde(this,n)};Me().prototype.matMul=function(n,e,t){return this.throwIfDisposed(),or(this,n,e,t)};Me().prototype.maxPool=function(n,e,t,r){return this.throwIfDisposed(),r8(this,n,e,t,r)};Me().prototype.max=function(n,e){return this.throwIfDisposed(),al(this,n,e)};Me().prototype.maximum=function(n){return this.throwIfDisposed(),Cd(this,n)};Me().prototype.mean=function(n,e){return this.throwIfDisposed(),fs(this,n,e)};Me().prototype.min=function(n,e){return this.throwIfDisposed(),L2(this,n,e)};Me().prototype.minimum=function(n){return this.throwIfDisposed(),Mg(this,n)};Me().prototype.mirrorPad=function(n,e){return this.throwIfDisposed(),Yde(this,n,e)};Me().prototype.mod=function(n){return this.throwIfDisposed(),Jde(this,n)};Me().prototype.mul=function(n){return this.throwIfDisposed(),fe(this,n)};Me().prototype.neg=function(){return this.throwIfDisposed(),rs(this)};Me().prototype.norm=function(n,e,t){return this.throwIfDisposed(),Yb(this,n,e,t)};Me().prototype.notEqual=function(n){return this.throwIfDisposed(),B2(this,n)};Me().prototype.oneHot=function(n,e=1,t=0){return this.throwIfDisposed(),xM(this,n,e,t)};Me().prototype.onesLike=function(){return this.throwIfDisposed(),Ra(this)};Me().prototype.pad=function(n,e){return this.throwIfDisposed(),o8(this,n,e)};Me().prototype.pool=function(n,e,t,r,s,o){return this.throwIfDisposed(),lfe(this,n,e,t,r,s,o)};Me().prototype.pow=function(n){return this.throwIfDisposed(),Af(this,n)};Me().prototype.prelu=function(n){return this.throwIfDisposed(),a8(this,n)};Me().prototype.prod=function(n,e){return this.throwIfDisposed(),dfe(this,n,e)};Me().prototype.reciprocal=function(){return this.throwIfDisposed(),Ofe(this)};Me().prototype.relu=function(){return this.throwIfDisposed(),Xf(this)};Me().prototype.relu6=function(){return this.throwIfDisposed(),yM(this)};Me().prototype.reshapeAs=function(n){return this.throwIfDisposed(),ye(this,n.shape)};Me().prototype.reshape=function(n){return this.throwIfDisposed(),ye(this,n)};Me().prototype.resizeBilinear=function(n,e,t){return this.throwIfDisposed(),AM(this,n,e,t)};Me().prototype.resizeNearestNeighbor=function(n,e,t){return this.throwIfDisposed(),$M(this,n,e,t)};Me().prototype.reverse=function(n){return this.throwIfDisposed(),$f(this,n)};Me().prototype.rfft=function(){return this.throwIfDisposed(),ohe(this)};Me().prototype.round=function(){return this.throwIfDisposed(),bM(this)};Me().prototype.rsqrt=function(){return this.throwIfDisposed(),wM(this)};Me().prototype.selu=function(){return this.throwIfDisposed(),CM(this)};Me().prototype.separableConv2d=function(n,e,t,r,s,o){return this.throwIfDisposed(),kM(this,n,e,t,r,s,o)};Me().prototype.sigmoid=function(){return this.throwIfDisposed(),Qp(this)};Me().prototype.sign=function(){return this.throwIfDisposed(),Hfe(this)};Me().prototype.sin=function(){return this.throwIfDisposed(),SM(this)};Me().prototype.sinh=function(){return this.throwIfDisposed(),NM(this)};Me().prototype.slice=function(n,e){return this.throwIfDisposed(),Ir(this,n,e)};Me().prototype.softmax=function(n){return this.throwIfDisposed(),d8(this,n)};Me().prototype.softplus=function(){return this.throwIfDisposed(),a0(this)};Me().prototype.spaceToBatchND=function(n,e){return this.throwIfDisposed(),i8(this,n,e)};Me().prototype.split=function(n,e){return this.throwIfDisposed(),ea(this,n,e)};Me().prototype.sqrt=function(){return this.throwIfDisposed(),go(this)};Me().prototype.square=function(){return this.throwIfDisposed(),Ar(this)};Me().prototype.squaredDifference=function(n){return this.throwIfDisposed(),ahe(this,n)};Me().prototype.squeeze=function(n){return this.throwIfDisposed(),c0(this,n)};Me().prototype.stack=function(n,e){this.throwIfDisposed();const t=n instanceof ys?[this,n]:[this,...n];return Uc(t,e)};Me().prototype.step=function(n){return this.throwIfDisposed(),u0(this,n)};Me().prototype.stridedSlice=function(n,e,t,r,s,o,i,a){return this.throwIfDisposed(),fhe(this,n,e,t,r,s,o,i,a)};Me().prototype.sub=function(n){return this.throwIfDisposed(),hn(this,n)};Me().prototype.sum=function(n,e){return this.throwIfDisposed(),on(this,n,e)};Me().prototype.tan=function(){return this.throwIfDisposed(),phe(this)};Me().prototype.tanh=function(){return this.throwIfDisposed(),Gb(this)};Me().prototype.tile=function(n){return this.throwIfDisposed(),sl(this,n)};Me().prototype.toBool=function(){return this.throwIfDisposed(),It(this,"bool")};Me().prototype.toFloat=function(){return this.throwIfDisposed(),It(this,"float32")};Me().prototype.toInt=function(){return this.throwIfDisposed(),It(this,"int32")};Me().prototype.topk=function(n,e){return this.throwIfDisposed(),xhe(this,n,e)};Me().prototype.transpose=function(n){return this.throwIfDisposed(),Hn(this,n)};Me().prototype.unique=function(n){return this.throwIfDisposed(),bhe(this,n)};Me().prototype.unsortedSegmentSum=function(n,e){return this.throwIfDisposed(),RM(this,n,e)};Me().prototype.unstack=function(n){return this.throwIfDisposed(),Ff(this,n)};Me().prototype.where=function(n,e){return this.throwIfDisposed(),Vo(n,this,e)};Me().prototype.zerosLike=function(){return this.throwIfDisposed(),Gn(this)};class Ll extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Ll.prototype)}}class Ia extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Ia.prototype)}}class ue extends Error{constructor(e){super(e),Object.setPrototypeOf(this,ue.prototype)}}class Tn extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Tn.prototype)}}class q8 extends Error{constructor(e){super(e),Object.setPrototypeOf(this,q8.prototype)}}class wL{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const r=this.cache.keys().next().value;this.cache.delete(r)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){const r=this.cache.keys().next().value;this.cache.delete(r)}this.maxEntries=e}}function Pf(n,e){if(Array.isArray(n)){let t=[];for(let r=0;r<e;r++)t=t.concat(n);return t}else{const t=new Array(e);return t.fill(n),t}}function jl(n,e){if(!n)throw new q8(e)}function I_(n,e){let t=0;for(const r of n)r===e&&t++;return t}function Qo(n){return n.length===1?n[0]:n}function hr(n){return Array.isArray(n)?n:[n]}function Fc(n){const t=n.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return t[0]!=="_"?t:"private"+t}function sf(n){return n.length<=1||n.indexOf("_")===-1?n:n.replace(/[_]+(\w|$)/g,(e,t)=>t.toUpperCase())}let ba={};function K8(n){if(n==null)return null;const e={};return e.className=n.getClassName(),e.config=n.getConfig(),e}function K5(n){if(!(n==null||typeof n!="object"))if(Array.isArray(n))n.forEach(e=>K5(e));else{const e=Object.keys(n);for(const t of e){const r=n[t];r!=null&&typeof r=="object"&&(!Array.isArray(r)&&r.type==="ndarray"&&typeof r.value=="number"?n[t]=r.value:K5(r))}}}function p0(n,e={},t={},r="object",s=!1){if(typeof n=="string"){const o=n;let i;if(o in t)i=t[o];else if(o in ba)i=ba[o];else if(i=e[o],i==null)throw new ue(`Unknown ${r}: ${n}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return i}else{const o=n;if(o.className==null||o.config==null)throw new ue(`${r}: Improper config format: ${JSON.stringify(o)}.
'className' and 'config' must set.`);const i=o.className;let a,l;if(i in t?[a,l]=t[i]:i in ba?[a,l]=ba.className:i in e&&([a,l]=e[i]),a==null)throw new ue(`Unknown ${r}: ${i}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){const c={};for(const p of Object.keys(ba))c[p]=ba[p];for(const p of Object.keys(t))c[p]=t[p];const u=o.config;u.customObjects=c;const d=Object.assign({},ba);for(const p of Object.keys(t))ba[p]=t[p];K5(o.config);const f=l(a,o.config,t,s);return ba=Object.assign({},d),f}else{const c=Object.assign({},ba);for(const d of Object.keys(t))ba[d]=t[d];const u=new a(o.config);return ba=Object.assign({},c),u}}}function Wge(n,e){return n<e?-1:n>e?1:0}function gv(n,e){return-1*Wge(n,e)}function ed(n){if(n==null)return n;const e=[];for(const t of n)e.indexOf(t)===-1&&e.push(t);return e}function Uge(n){if(n==null)throw new ue(`Invalid value in obj: ${JSON.stringify(n)}`);for(const e in n)if(n.hasOwnProperty(e))return!1;return!0}function Zf(n,e,t){if(t!=null&&n.indexOf(t)<0)throw new ue(`${t} is not a valid ${e}.  Valid values are ${n} or null/undefined.`)}function X8(n,e,t=0,r=1/0){return jl(t>=0),jl(r>=t),Array.isArray(n)&&n.length>=t&&n.length<=r&&n.every(s=>typeof s===e)}function Os(n,e){Array.isArray(n)?(X(n.length>0,()=>`${e} is unexpectedly an empty array.`),n.forEach((t,r)=>Os(t,`element ${r+1} of ${e}`))):X(Number.isInteger(n)&&n>0,()=>`Expected ${e} to be a positive integer, but got ${CL(n)}.`)}function CL(n){return n===null?"null":Array.isArray(n)?"["+n.map(e=>CL(e)).join(",")+"]":typeof n=="string"?`"${n}"`:`${n}`}function Hge(n,e,t){let r=t!=null?t():Yo(),s;return(...i)=>{const a=t!=null?t():Yo();return a-r<e||(r=a,s=n(...i)),s}}function kL(n){return n==="relu"?"relu":n==="linear"?"linear":n==="elu"?"elu":null}let Gge=0;function SL(){return Gge++}const xv={};function nw(n=""){return n in xv||(xv[n]=0),xv[n]+=1,n+xv[n].toString()}const qge=["channelsFirst","channelsLast"],Kge=["nearest","bilinear"],Xge=["valid","same","causal"],Yge=["max","avg"],Zge=["sum","mul","concat","ave"];const zh=new Map;function is(n){Zf(qge,"DataFormat",n)}function Jge(n){Zf(Kge,"InterpolationFormat",n)}function oa(n){Zf(Xge,"PaddingMode",n)}function NL(n){Zf(Yge,"PoolMode",n)}const mg=[],T_="/";function xf(n,e){mg.push(n);try{const t=e();return mg.pop(),t}catch(t){throw mg.pop(),t}}function Qge(){return mg.length===0?"":mg.join(T_)+T_}function EL(n){if(!TL(n))throw new Error("Not a valid tensor name: '"+n+"'");return Qge()+n}function IL(n){if(!TL(n))throw new Error("Not a valid tensor name: '"+n+"'");zh.has(n)||zh.set(n,0);const e=zh.get(n);if(zh.set(n,zh.get(n)+1),e>0){const t=`${n}_${e}`;return zh.set(t,1),t}else return n}const e1e=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function TL(n){return!!n.match(e1e)}function t1e(n){return n===parseInt(n.toString(),10)}function td(n,e,t){e==null&&(e=0),t==null&&(t=n.length);let r=1;for(let s=e;s<t;++s)r*=n[s];return r}function Fp(n){if(n.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let t=0;t<n.length;t++){const r=n[t];r<e&&(e=r)}return e}function cd(n){if(n.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let t=0;t<n.length;t++){const r=n[t];r>e&&(e=r)}return e}function dl(n,e){if(e<n)throw new ue(`end (${e}) < begin (${n}) is forbidden.`);const t=[];for(let r=n;r<e;++r)t.push(r);return t}let h4;function ws(){return h4==null&&(h4=Gle().epsilon()),h4}function fl(){return"channelsLast"}function nc(n,e){return It(n,e)}function m0(n,e=-1){const t=n.shape.slice();return e<0&&(e=t.length+e+1),t.splice(e,0,1),ye(n,t)}function n1e(n,e){return Ne(()=>{if(n.shape.length!==2)throw new ue(`repeat() expects a rank-2 tensor, but received a rank-${n.shape.length} tensor.`);const t=m0(n,1);return X5(t,[1,e,1])})}function r1e(n){const e=[td(n.shape)];return ye(n,e)}function s1e(n){if(n.rank<=1)throw new ue(`batchFlatten requires a minimum rank of 2. Got rank: ${n.rank}.`);const e=[n.shape[0],td(n.shape,1)];return ye(n,e)}function vf(n,e,t){return Ne(()=>{switch(n.rank){case 1:return c8(n,e,t);case 2:return EM(n,[e,0],[t,n.shape[1]]);case 3:return u8(n,[e,0,0],[t,n.shape[1],n.shape[2]]);case 4:return z2(n,[e,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3]]);case 5:return Ir(n,[e,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4]]);case 6:return Ir(n,[e,0,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4],n.shape[5]]);default:throw new ue(`sliceAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}})}function p4(n,e,t){return Ne(()=>{switch(n.rank){case 1:return c8(n,e,t);case 2:return EM(n,[0,e],[n.shape[0],t]);case 3:return u8(n,[0,0,e],[n.shape[0],n.shape[1],t]);case 4:return z2(n,[0,0,0,e],[n.shape[0],n.shape[1],n.shape[2],t]);default:throw new ue(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function vv(n,e,t,r){return Ne(()=>{switch(n.rank){case 1:return c8(n,e,t);case 2:switch(r){case 1:return vf(n,e,t);case 2:return p4(n,e,t);default:throw new ue(`The axis is not within the rank of the tensor ${r}`)}case 3:switch(r){case 1:return vf(n,e,t);case 2:return u8(n,[0,e,0],[n.shape[0],t,n.shape[2]]);case 3:return p4(n,e,t);default:throw new ue(`The axis is not within the rank of the tensor ${r}`)}case 4:switch(r){case 1:return vf(n,e,t);case 2:return z2(n,[0,e,0,0],[n.shape[0],t,n.shape[2],n.shape[3]]);case 3:return z2(n,[0,0,e,0],[n.shape[0],n.shape[1],t,n.shape[3]]);case 4:return p4(n,e,t);default:throw new ue(`The axis is not within the rank of the tensor ${r}`)}default:throw new ue(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function Y8(n,e=-1){let t;return e<0&&(t=n[0].rank,t!==0?e=t:e=0),e===n[0].rank&&(e=-1),ei(n,e)}function __(n,e){switch(n.rank){case 1:return mue([n,e]);case 2:return xue([n,e],0);case 3:return yue([n,e],0);case 4:return wue([n,e],0);default:throw new ue(`concatAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}}function X5(n,e){if(Array.isArray(e)||(e=[e]),n.rank!==e.length)throw new ue(`The length of input n (${e.length}) does not match the number of dimensions in input x (${n.rank})`);return sl(n,e)}function rw(n,e=0,t=1,r,s){return Afe(n,e,t,r,s)}function rc(n,e,t,r){if(n.rank<2||e.rank<2)throw new Tn(`dot requires both inputs to be rank >= 2 but got x shape = ${n.shape} and y shape = ${e.shape}`);if(e.rank>=3){const s=n.shape.slice(-1)[0],o=e.shape.slice(-2)[0];if(s!==o)throw new Tn(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${n.shape} and  y shape = ${e.shape}`)}if(n.rank===2&&e.rank===2)return m_({a:n,b:e,transposeA:!1,transposeB:!1,bias:r?Y5(n.rank,r,fl()):null,activation:t});{const s=n.shape.slice(),o=s.pop();n=ye(n,[-1,o]);const i=e.shape.slice(),a=i.pop(),l=i.pop(),c=[...i,a],u=Array.from({length:e.rank},(x,v)=>v===0?e.rank-2:v<=e.rank-2?v-1:v);e=ye(Hn(e,u),[l,-1]);const d=[...s,...c];return ye(m_({a:n,b:e,transposeA:!1,transposeB:!1,bias:r?Y5(n.rank,r,fl()):null,activation:t}),d)}}function _L(n,e,t){return Ne(()=>(Array.isArray(e)?e=Ci(e,"int32"):e=It(e,"int32"),QS(n,e,t)))}function g0(n){return fe(n,n)}function Y5(n,e,t){const r=e.shape;if(e.rank!==1&&e.rank!==n)throw new ue(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${n}`);if(n===5){if(t==="channelsFirst")return r.length===1?ye(e,[1,r[0],1,1,1]):ye(e,[1,r[3],r[0],r[1],r[2]]);if(t==="channelsLast")return r.length===1?ye(e,[1,1,1,1,r[0]]):ye(e,[1].concat(r))}else if(n===4){if(t==="channelsFirst")return r.length===1?ye(e,[1,r[0],1,1]):ye(e,[1,r[2],r[0],r[1]]);if(t==="channelsLast")return r.length===1?ye(e,[1,1,1,r[0]]):ye(e,[1].concat(r))}else if(n===3){if(t==="channelsFirst")return r.length===1?ye(e,[1,r[0],1]):ye(e,[1,r[1],r[0]]);if(t==="channelsLast")return r.length===1?ye(e,[1,1,r[0]]):ye(e,[1].concat(r))}else if(n<3)return e;throw new ue(`Unsupported input rank by biasAdd: ${e.rank}`)}function xl(n,e,t){return Ne(()=>(t==null&&(t=fl()),is(t),ot(n,Y5(n.rank,e,t))))}function o1e(n,e=1){if(e!==1)throw new Tn(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return Xb(n)}function i1e(n){return Ne(()=>ln(n,ot(Ao(n),1)))}function RL(n,e,t,r){return Ne(()=>Ihe(n,e,t,r))}function a1e(n){return Ne(()=>{const e=ot(.5,fe(.2,n));return na(e,0,1)})}function x0(n,e,t=!1){return t?n():e()}const l1e=["fanIn","fanOut","fanAvg"],c1e=["normal","uniform","truncatedNormal"];function u1e(n){Zf(l1e,"FanMode",n)}function d1e(n){Zf(c1e,"Distribution",n)}class Fa extends nm{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class DL extends Fa{apply(e,t){return Ps(e,t)}}DL.className="Zeros";Qe(DL);class Z8 extends Fa{apply(e,t){return kd(e,t)}}Z8.className="Ones";Qe(Z8);class AL extends Fa{constructor(e){if(super(),typeof e!="object")throw new ue(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new ue(`config must have value set but got ${e}`);this.value=e.value}apply(e,t){return Ne(()=>fe(ar(this.value),kd(e,t)))}getConfig(){return{value:this.value}}}AL.className="Constant";Qe(AL);class $L extends Fa{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return l0(e,this.minval,this.maxval,t,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}$L.className="RandomUniform";Qe($L);class FL extends Fa{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new Tn(`randomNormal does not support dType ${t}.`);return rw(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}FL.className="RandomNormal";Qe(FL);class PL extends Fa{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new Tn(`truncatedNormal does not support dType ${t}.`);return _M(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}PL.className="TruncatedNormal";Qe(PL);class OL extends Fa{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,t){return Ne(()=>{if(e.length!==2||e[0]!==e[1])throw new ue("Identity matrix initializer can only be used for 2D square matrices.");return fe(this.gain,fM(e[0]))})}getConfig(){return{gain:this.gain}}}OL.className="Identity";Qe(OL);function f1e(n,e="channelsLast"){let t,r;if(is(e),n.length===2)t=n[0],r=n[1];else if([3,4,5].indexOf(n.length)!==-1){if(e==="channelsFirst"){const s=td(n,2);t=n[1]*s,r=n[0]*s}else if(e==="channelsLast"){const s=td(n,0,n.length-2);t=n[n.length-2]*s,r=n[n.length-1]*s}}else{const s=td(n);t=Math.sqrt(s),r=Math.sqrt(s)}return[t,r]}class Ii extends Fa{constructor(e){if(super(),e.scale<0)throw new ue(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,u1e(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,d1e(this.distribution),this.seed=e.seed}apply(e,t){const r=f1e(e),s=r[0],o=r[1];let i=this.scale;if(this.mode==="fanIn"?i/=Math.max(1,s):this.mode==="fanOut"?i/=Math.max(1,o):i/=Math.max(1,(s+o)/2),this.distribution==="normal"){const a=Math.sqrt(i);if(t=t||"float32",t!=="float32"&&t!=="int32")throw new Tn(`${this.getClassName()} does not support dType ${t}.`);return _M(e,0,a,t,this.seed)}else{const a=Math.sqrt(3*i);return l0(e,-a,a,t,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}Ii.className="VarianceScaling";Qe(Ii);class J8 extends Ii{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Ii.className}}J8.className="GlorotUniform";Qe(J8);class Q8 extends Ii{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Ii.className}}Q8.className="GlorotNormal";Qe(Q8);class eN extends Ii{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Ii.className}}eN.className="HeNormal";Qe(eN);class tN extends Ii{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Ii.className}}tN.className="HeUniform";Qe(tN);class nN extends Ii{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Ii.className}}nN.className="LeCunNormal";Qe(nN);class rN extends Ii{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Ii.className}}rN.className="LeCunUniform";Qe(rN);class ML extends Fa{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,t){return Ne(()=>{if(e.length<2)throw new Tn("Shape must be at least 2D.");if(t!=="int32"&&t!=="float32"&&t!==void 0)throw new TypeError(`Unsupported data type ${t}.`);t=t;const r=Le(e.slice(0,-1)),s=e[e.length-1],o=r*s;o>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${o}) elements: Slowness may result.`);const i=[Math.max(s,r),Math.min(s,r)],a=rw(i,0,1,t,this.seed),l=kpe.qr(a,!1);let c=l[0];const d=l[1].flatten().stridedSlice([0],[Math.min(s,r)*Math.min(s,r)],[Math.min(s,r)+1]);return c=fe(c,d.sign()),r<s&&(c=c.transpose()),fe(ar(this.gain),c.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}ML.className="Orthogonal";Qe(ML);const R_={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function D_(n,e={}){return p0(n,Na.getMap().classNameMap,e,"initializer")}function Wr(n){return K8(n)}function Lr(n){if(typeof n=="string"){const e=n in R_?R_[n]:n;if(e==="GlorotNormal")return new Q8;if(e==="GlorotUniform")return new J8;if(e==="HeNormal")return new eN;if(e==="HeUniform")return new tN;if(e==="LeCunNormal")return new nN;if(e==="LeCunUniform")return new rN;{const t={};return t.className=e,t.config={},D_(t)}}else return n instanceof Fa?n:D_(n)}function Z5(n){return Array.isArray(n)&&Array.isArray(n[0])}function W2(n){return n.length===0?[]:Array.isArray(n[0])?n:[n]}function mn(n){let e;if(Array.isArray(n)){if(n.length!==1)throw new ue(`Expected Tensor length to be 1; got ${n.length}`);e=n[0]}else e=n;return e}function Zn(n){if(Array.isArray(n)&&Array.isArray(n[0])){if(n.length===1)return n=n,n[0];throw new ue(`Expected exactly 1 Shape; got ${n.length}`)}else return n}function U2(n){let e=0;for(const t of n)t.shape.length===0?e+=1:e+=t.shape.reduce((r,s)=>r*s);return e}const A_="Variable";class h1e{constructor(e,t="float32",r=A_,s=!0,o=null){this.dtype=t??"float32",this.shape=e.shape,this.id=SL(),r=r??A_,this.originalName=EL(r),this.name=IL(this.originalName),this.trainable_=s,this.constraint=o,this.val=khe(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),p1e(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function p1e(n,e){if(n.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(n.shape)+" vs. "+JSON.stringify(e.shape))}function J5(n){return n.map(e=>e.read())}function sN(n){n.forEach(e=>{e[0].write(e[1])})}class Cs{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class uc{constructor(e,t,r,s,o,i,a){this.dtype=e,this.shape=t,this.sourceLayer=r,this.inputs=s,this.callArgs=o,this.outputTensorIndex=a,this.id=SL(),i!=null&&(this.originalName=EL(i),this.name=IL(this.originalName)),this.rank=t.length}}let m1e=0,sw=class{constructor(e,t){this.callArgs=t,this.id=m1e++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const r of e.inboundLayers)r?.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)t!=null?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}},g1e=0;class Pn extends nm{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=g1e++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const r=this.getClassName();t=Fc(r)+"_"+nw(r)}if(this.name=t,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let r;if(e.batchInputShape!=null)r=e.batchInputShape;else if(e.inputShape!=null){let o=null;e.batchSize!=null&&(o=e.batchSize),r=[o].concat(e.inputShape)}this.batchInputShape=r;let s=e.dtype;s==null&&(s=e.inputDType),s==null&&(s="float32"),this.dtype=s}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(this.inboundNodes.length===0)throw new Ia(`The layer has never been called and thus has no defined ${t}.`);if(this.inboundNodes.length<=e)throw new ue(`Asked to get ${t} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return Qo(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return Qo(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new Ll(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new Ll(`Layer ${this.name} is not connected, no input to return.`);return Qo(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new Ll(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new Ll(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return Qo(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(t=>t.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const t=hr(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const r=hr(this.inputSpec);if(t.length!==r.length)throw new ue(`Layer ${this.name} expects ${r.length} inputs, but it received ${t.length} input tensors. Input received: ${e}`);for(let s=0;s<t.length;s++){const o=t[s],i=r[s];if(i==null)continue;const a=o.rank;if(i.ndim!=null&&a!==i.ndim)throw new ue(`Input ${s} is incompatible with layer ${this.name}: expected ndim=${i.ndim}, found ndim=${a}`);if(i.maxNDim!=null&&a>i.maxNDim)throw new ue(`Input ${s} is incompatible with layer ${this.name}: expected max_ndim=${i.maxNDim}, found ndim=${a}`);if(i.minNDim!=null&&a<i.minNDim)throw new ue(`Input ${s} is incompatible with layer ${this.name}: expected min_ndim=${i.minNDim}, found ndim=${a}.`);if(i.dtype!=null&&o.dtype!==i.dtype)throw new ue(`Input ${s} is incompatible with layer ${this.name} : expected dtype=${i.dtype}, found dtype=${o.dtype}.`);if(i.axes){const l=o.shape;for(const c in i.axes){const u=Number(c),d=i.axes[c],f=u>=0?l[u]:l[l.length+u];if(d!=null&&[d,null].indexOf(f)===-1)throw new ue(`Input ${s} is incompatible with layer ${this.name}: expected axis ${u} of input shape to have value ${d} but got shape ${l}.`)}}if(i.shape!=null)for(let l=0;l<i.shape.length;++l){const c=i.shape[l],u=o.shape[l];if(c!=null&&u!=null&&c!==u)throw new ue(`Input ${s} is incompatible with layer ${this.name}: expected shape=${i.shape}, found shape=${o.shape}.`)}}}call(e,t){return e}invokeCallHook(e,t){this._callHook!=null&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const r=hr(e),s=y1e(e),o=b1e(e);if(s===o)throw new ue("Arguments to apply() must be all SymbolicTensors or all Tensors");return xf(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const i=[];for(const a of hr(e))i.push(a.shape);this.build(Qo(i)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&o&&(this._refCount=1)}if(this.assertInputCompatibility(e),o){let i=this.call(e,t);this.supportsMasking&&this.setMaskMetadata(e,i);const a=hr(i),l=[];for(let c of a)r.indexOf(c)!==-1&&(c=c.clone()),l.push(c);if(i=Qo(l),this.activityRegularizer!=null)throw new Tn("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return i}else{const i=x1e(e),a=this.computeOutputShape(i);let l;const c=v1e(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?i[0]:i),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((u,d)=>new uc(c,u,this,hr(e),t,this.name,d)):l=new uc(c,a,this,hr(e),t,this.name),this.addInboundNode(e,l,null,null,i,a,t),this._refCount++,this.activityRegularizer!=null)throw new Tn("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let t=!1;this.batchInputShape.forEach((r,s)=>{r!=null&&e[s]!=null&&e[s]!==r&&(t=!0)}),t&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new Ll(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const t of this.inboundNodes){const r=JSON.stringify(t.outputShapes);e.indexOf(r)===-1&&e.push(r)}if(e.length===1){const t=this.inboundNodes[0].outputShapes;return Array.isArray(t)&&Array.isArray(t[0])&&t.length===1?t[0]:t}else throw new Ll(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Ia(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return U2(this.weights)}build(e){this.built=!0}getWeights(e=!1){return J5(e?this.trainableWeights:this.weights)}setWeights(e){Ne(()=>{const t=this.weights;if(t.length!==e.length)throw new ue(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${t.length} weights. Provided weights: ${e}...`);if(t.length===0)return;const r=[],s=J5(t);for(let o=0;o<s.length;++o){const i=s[o],a=t[o],l=e[o];if(!lr(i.shape,l.shape))throw new ue(`Layer weight shape ${i.shape} not compatible with provided weight shape ${l.shape}`);r.push([a,l])}sN(r)})}addWeight(e,t,r,s,o,i,a,l){if(this._addedWeightNames.indexOf(e)!==-1)throw new ue(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),r==null&&(r="float32"),this.fastWeightInitDuringBuild&&(s=l!=null?l():Lr("zeros"));const c=s.apply(t,r),u=new h1e(c,r,e,i,a);return c.dispose(),o!=null&&this.addLoss(()=>o.apply(u.read())),i==null&&(i=!0),i?this._trainableWeights.push(u):this._nonTrainableWeights.push(u),u}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=hr(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(t!=null)if(Array.isArray(t))t.forEach(r=>{if(r!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return t}setMaskMetadata(e,t,r){if(!this.supportsMasking)return;const s=this.computeMask(e,r),o=hr(t),i=hr(s);if(o.length!==i.length)throw new Error(`${this.name} outputs ${o.length} tensors but ${o.length} masks for those tensors`);for(let a=0;a<o.length;a++)o[a].kerasMask=i[a]}addInboundNode(e,t,r,s,o,i,a=null){const l=hr(e);t=hr(t),r=hr(r),s=hr(s),o=W2(o),i=W2(i);const c=[],u=[],d=[];for(const f of l)c.push(f.sourceLayer),u.push(f.nodeIndex),d.push(f.tensorIndex);new sw({outboundLayer:this,inboundLayers:c,nodeIndices:u,tensorIndices:d,inputTensors:l,outputTensors:t,inputMasks:r,outputMasks:s,inputShapes:o,outputShapes:i},a);for(let f=0;f<t.length;f++)t[f].sourceLayer=this,t[f].nodeIndex=this.inboundNodes.length-1,t[f].tensorIndex=f}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function x1e(n){n=hr(n);const e=[];for(const t of n)e.push(t.shape);return Qo(e)}function v1e(n){return"float32"}function LL(n,e,t){if((e==null||t!=null&&t>0)&&(e=n.sourceLayer,t=n.nodeIndex),e.inboundNodes.length===0)return[n];{const r=e.inboundNodes[t];if(r.inboundLayers.length===0)return r.inputTensors;{const s=[];for(let o=0;o<r.inboundLayers.length;o++){const i=r.inputTensors[o],a=r.inboundLayers[o],l=r.nodeIndices[o],c=LL(i,a,l);for(const u of c)s.indexOf(u)===-1&&s.push(u)}return s}}}function y1e(n){let e=!0;for(const t of hr(n))if(!(t instanceof uc)){e=!1;break}return e}function b1e(n){let e=!0;for(const t of hr(n))if(t instanceof uc){e=!1;break}return e}class v0 extends Pn{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:nw("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new ue("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(t==null){if(e.inputShape==null)throw new ue("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new ue("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const r=e.dtype||"float32";this.batchInputShape=t,this.dtype=r,this.inputSpec=[{shape:t}];const s=new uc(this.dtype,this.batchInputShape,this,[],{},this.name);s.nodeIndex=0,s.tensorIndex=0,new sw({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[s],outputTensors:[s],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new ue(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}v0.className="InputLayer";Qe(v0);function w1e(n){if(n.batchShape==null&&n.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(n.batchShape!=null&&n.shape!=null)throw new ue("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=n.batchShape;n.shape!=null&&e==null&&(e=[null].concat(n.shape));let t=n.dtype;return t==null&&(t="float32"),new v0({batchInputShape:e,name:n.name,dtype:t,sparse:n.sparse}).inboundNodes[0].outputTensors[0]}function C1e(n,e){if(n.dtype==null||n.dtype===e.dtype)return e;try{return It(e,n.dtype)}catch{throw new ue(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${n.name}' (${n.dtype}).`)}}class Gu{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof Gu)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(e==null)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,r){if(this.id2Value[e.id]==null)this.id2Value[e.id]=C1e(e,t),this.name2Id[e.name]=e.id,r!=null&&(this.id2Mask[e.id]=r);else throw new ue(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof uc){if(this.id2Value[e.id]==null)throw new ue(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const t=this.name2Id[e];if(t==null)throw new ue(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[t]}}getMask(e){if(e instanceof uc){if(this.id2Value[e.id]==null)throw new ue(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const t=this.name2Id[e];if(t==null)throw new ue(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[t]}}disposeMasks(){this.id2Mask!=null&&Mn(this.id2Mask)}}const H2=new wL,G2=new wL;function k1e(n){H2?.setMaxEntries(n),G2?.setMaxEntries(n)}function sg(n,e,t,r){const s=t==null?!1:t.training,o=Array.isArray(n),i=o?n:[n],a=i.map(x=>x.name),l=[],c=e.names();for(const x of a)c.indexOf(x)!==-1?l.push(e.getValue(x)):l.push(null);const u=a.join(",")+"|"+e.names().sort().join(",");let d=H2.get(u),f;if(d==null){const x=S1e(i,e);d=x.sorted,f=x.recipientCounts,H2.put(u,d),G2.put(u,f)}f={},s||Object.assign(f,G2.get(u));const p=new Gu(e);for(let x=0;x<d.length;++x){const v=d[x],y=v.sourceLayer;if(y instanceof v0)continue;const b=[],w=[],S=[];let k=!1;for(const R of v.inputs){const D=p.getValue(R),A=p.getMask(R);b.push(D),w.push(A),A!=null&&(k=!0),s||(f[R.name]--,f[R.name]===0&&!e.hasKey(R)&&a.indexOf(R.name)===-1&&!D.isDisposed&&R.sourceLayer.stateful!==!0&&S.push(D))}k&&(t=t||{},t.mask=w[0]);const N=hr(y.apply(b,t));let I=null;y.supportsMasking&&(I=y.computeMask(b,w));const T=E1e(v),F=Array.isArray(T)?T:[T];for(let R=0;R<F.length;++R){p.hasKey(F[R])||p.add(F[R],N[R],Array.isArray(I)?I[0]:I);const D=a.indexOf(F[R].name);D!==-1&&(l[D]=N[R])}s||Mn(S)}return p.disposeMasks(),o?l:l[0]}function S1e(n,e){X(n!=null&&n.length>0,()=>"Expected at least one fetch, got none");let t=[],r={};if(n.length===1){const s=$_(n[0],e);t=s.sorted,r=s.recipientMap}else{const s=new Set;for(const o of n){const{sorted:i,recipientMap:a}=$_(o,e);for(const l of i)s.has(l.name)||(t.push(l),s.add(l.name));for(const l in a)r[l]==null&&(r[l]=new Set),a[l].forEach(c=>r[l].add(c))}}return{sorted:t,recipientCounts:N1e(r)}}function N1e(n){const e={};for(const t in n)e[t]=n[t].size;return e}function $_(n,e){const t=new Set,r=[],s={};for(const a of e.names())t.add(a);const o=[],i=[];for(o.push(n);o.length>0;){const a=o[o.length-1];if(t.has(a.name)){o.pop();continue}const l=i[i.length-1]===o.length-1;if(a.inputs.length===0||l)o.pop(),r.push(a),t.add(a.name),l&&i.pop();else{i.push(o.length-1);for(const c of a.inputs)s[c.name]==null&&(s[c.name]=new Set),s[c.name].add(a.name),!t.has(c.name)&&o.push(c)}}return{sorted:r,recipientMap:s}}function E1e(n){let e;if(n.sourceLayer.inboundNodes.length===1)e=n.sourceLayer.output;else{let t=null;for(let r=0;r<n.sourceLayer.inboundNodes.length;++r)for(const s of n.sourceLayer.inboundNodes[r].outputTensors)if(s.id===n.id){t=r;break}e=n.sourceLayer.getOutputAt(t)}return e}const I1e=De();I1e.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,k1e);function oN(n,e){return Ne(()=>go(on(fe(n,n),e,!0)))}class y0 extends nm{getConfig(){return{}}}class jL extends y0{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return Ne(()=>{const t=oN(e,this.axis),r=na(t,0,this.maxValue);return fe(e,ln(r,ot(ws(),t)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}jL.className="MaxNorm";Qe(jL);class BL extends y0{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return Ne(()=>ln(e,ot(ws(),oN(e,this.axis))))}getConfig(){return{axis:this.axis}}}BL.className="UnitNorm";Qe(BL);class VL extends y0{apply(e){return Xf(e)}}VL.className="NonNeg";Qe(VL);class zL extends y0{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return Ne(()=>{const t=oN(e,this.axis),r=ot(fe(this.rate,na(t,this.minValue,this.maxValue)),fe(1-this.rate,t));return fe(e,ln(r,ot(ws(),t)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}zL.className="MinMaxNorm";Qe(zL);const F_={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Ss(n){return K8(n)}function P_(n,e={}){return p0(n,Na.getMap().classNameMap,e,"constraint")}function Ns(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in F_?F_[n]:n,config:{}};return P_(t)}else return n instanceof y0?n:P_(n)}async function Zd(n){if(n==null)return;const e=[],t=[],r=[];for(const s in n){const o=n[s];if(typeof o!="number"){const i=o;e.push(i.data()),t.push(s),r.push(i)}}if(e.length>0){const s=await Promise.all(e);for(let o=0;o<s.length;++o)n[t[o]]=s[o][0];Mn(r)}}function WL(n){if(n!=null)for(const e in n){const t=n[e];typeof t!="number"&&t.dispose()}}var O_;(function(n){n[n.SILENT=0]="SILENT",n[n.VERBOSE=1]="VERBOSE"})(O_||(O_={}));const T1e=125;class jg{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class _1e{constructor(e,t=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){t==null&&(t={});for(const r of this.callbacks)await r.onEpochBegin(e,t)}async onEpochEnd(e,t){t==null&&(t={});for(const r of this.callbacks)await r.onEpochEnd(e,t)}async onBatchBegin(e,t){t==null&&(t={});for(const r of this.callbacks)await r.onBatchBegin(e,t)}async onBatchEnd(e,t){t==null&&(t={});for(const r of this.callbacks)await r.onBatchEnd(e,t)}async onTrainBegin(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class R1e extends jg{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){t==null&&(t={});const r=t.size==null?0:t.size;this.seen+=r;for(const s in t){const o=t[s];if(typeof o=="number")this.totals.hasOwnProperty(s)||(this.totals[s]=0),this.totals[s]=this.totals[s]+o*r;else{let i;s in this.totals?i=this.totals[s]:this.totals[s]=0;const a=Ne(()=>ot(this.totals[s],fe(o,r)));this.totals[s]=a,i?.dispose()}}}async onEpochEnd(e,t){if(t!=null)for(const r of this.params.metrics)this.totals[r]!=null&&(typeof this.totals[r]=="number"?t[r]=this.totals[r]/this.seen:Ne(()=>{const s=fe(ln(1,this.seen),this.totals[r]);t[r]=s,this.totals[r].dispose(),ec(t[r])}))}}class D1e extends jg{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){t==null&&(t={}),this.epoch.push(e);for(const r in t)this.history[r]==null&&(this.history[r]=[]),this.history[r].push(t[r])}async syncData(){const e=[],t=[],r=[];for(const o in this.history){const i=this.history[o];for(let a=0;a<i.length;++a)if(typeof i[a]!="number"){const l=i[a];e.push(l.data()),t.push(o),r.push(a)}}const s=await Promise.all(e);for(let o=0;o<s.length;++o)this.history[t[o]][r[o]].dispose(),this.history[t[o]][r[o]]=s[o][0]}}class A1e extends jg{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||KM,this.yieldEvery=t||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=T1e),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");T5(this.yieldEvery)&&(this.maybeWait=Hge(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,r){const s=[];this.yield!=null&&(await Zd(r),s.push(this.yield(e,t,r))),s.push(this.nextFrameFunc()),await Promise.all(s)}async onEpochBegin(e,t){this.currentEpoch=e,this.epochBegin!=null&&(await Zd(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const r=[];this.epochEnd!=null&&(await Zd(t),r.push(this.epochEnd(e,t))),this.yieldEvery==="epoch"&&r.push(this.nextFrameFunc()),await Promise.all(r)}async onBatchBegin(e,t){this.batchBegin!=null&&(await Zd(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const r=[];this.batchEnd!=null&&(await Zd(t),r.push(this.batchEnd(e,t))),this.yieldEvery==="batch"?r.push(this.nextFrameFunc()):T5(this.yieldEvery)&&r.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(r)}async onTrainBegin(e){this.trainBegin!=null&&(await Zd(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await Zd(e),await this.trainEnd(e))}}function UL(n,e){return n==null&&(n={}),n instanceof jg?[n]:Array.isArray(n)&&n[0]instanceof jg?n:hr(n).map(r=>new A1e(r,e))}class Ca{constructor(){}static registerCallbackConstructor(e,t){X(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),Ca.checkForDuplicate(t),Ca.constructors[e]==null&&(Ca.constructors[e]=[]),Ca.constructors[e].push(t)}static checkForDuplicate(e){for(const t in Ca.constructors)Ca.constructors[+t].forEach(s=>{if(s===e)throw new ue("Duplicate callback constructor.")})}static clear(){Ca.constructors={}}static createCallbacks(e){const t=[];for(const r in Ca.constructors){const s=+r;e>=s&&t.push(...Ca.constructors[s])}return t.map(r=>new r)}}Ca.constructors={};function HL(n,e,t,r,s,o,i,a,l){const c=new D1e,u=[new R1e,...Ca.createCallbacks(e)];n!=null&&u.push(...n),u.push(c);const d=new _1e(u);return d.setParams({epochs:t,initialEpoch:r,samples:s,steps:o,batchSize:i,verbose:e,doValidation:a,metrics:l}),{callbackList:d,history:c}}function Lc(n,e={},t=!1){return p0(n,Na.getMap().classNameMap,e,"layer",t)}function q2(n,e){return Ne(()=>{n.dtype!=="float32"&&(n=It(n,"float32"));const t=on(g0(n),e,!0),r=Kb(t.shape,ws()),s=go(Cd(t,r));return ln(n,s)})}function ow(n,e){return Ne(()=>fs(g0(hn(e,n)),-1))}function iN(n,e){return Ne(()=>fs(Ao(hn(e,n)),-1))}function aN(n,e){return Ne(()=>{const t=hn(n,e),r=na(Ao(n),ws(),Number.MAX_VALUE),s=Ao(ln(t,r));return fe(100,fs(s,-1))})}function $1e(n,e){return Ne(()=>{const t=na(e,ws(),Number.MAX_VALUE),r=cc(ot(1,t)),s=na(n,ws(),Number.MAX_VALUE),o=cc(ot(1,s));return fs(g0(hn(r,o)),-1)})}function F1e(n,e){return Ne(()=>{const t=Cd(0,hn(1,fe(n,e)));return fs(g0(t),-1)})}function P1e(n,e){return Ne(()=>{const t=Cd(0,hn(1,fe(n,e)));return fs(t,-1)})}function O1e(n,e){return Ne(()=>{const t=on(fe(n,e),-1),r=al(fe(hn(1,n),e),-1);return Cd(0,ot(1,hn(r,t)))})}function M1e(n,e){return Ne(()=>{const t=Math.log(2),r=hn(e,n),s=hn(ot(r,a0(fe(-2,r))),t);return fs(s,-1)})}function Bg(n,e,t=!1){return Ne(()=>{if(t)e=d8(e);else{const r=on(e,e.shape.length-1,!0);e=ln(e,r)}return e=na(e,ws(),1-ws()),rs(on(fe(It(n,"float32"),cc(e)),e.shape.length-1))})}function K2(n,e,t=!1){return Ne(()=>{const r=It(Zb(r1e(n)),"int32");e=na(e,ws(),1-ws());const s=e.shape,o=ye(xM(r,s[s.length-1]),s);return Bg(o,e,t)})}function L1e(n,e){if(!lr(n.shape,e.shape))throw new ue(`logits and labels must have the same shape, but got shapes ${JSON.stringify(n.shape)} and ${JSON.stringify(e.shape)}`);return Ne(()=>{const t=Xf(e),r=rs(Ao(e));return ot(hn(t,fe(e,n)),hM(lc(r)))})}function iw(n,e){return Ne(()=>{let t;return t=na(e,ws(),1-ws()),t=cc(ln(t,hn(1,t))),fs(L1e(n,t),-1)})}function j1e(n,e){return Ne(()=>{const t=na(n,ws(),1),r=na(e,ws(),1);return on(fe(n,cc(ln(t,r))),-1)})}function B1e(n,e){return Ne(()=>{const t=cc(ot(ws(),e));return fs(hn(e,fe(n,t)),-1)})}function GL(n,e){return Ne(()=>{const t=q2(n,-1),r=q2(e,-1),s=fe(t,r);return rs(on(s,-1))})}const X2={meanSquaredError:ow,meanAbsoluteError:iN,meanAbsolutePercentageError:aN,meanSquaredLogarithmicError:$1e,squaredHinge:F1e,hinge:P1e,categoricalHinge:O1e,logcosh:M1e,categoricalCrossentropy:Bg,sparseCategoricalCrossentropy:K2,binaryCrossentropy:iw,kullbackLeiblerDivergence:j1e,poisson:B1e,cosineProximity:GL};function m4(n){if(typeof n=="string"){if(n in X2)return X2[n];let e=`Unknown loss ${n}`;throw n.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${n}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new ue(e)}else return n}function qL(n,e){return Ne(()=>{const t=fe(.5,Ra(e)),r=nc(sa(e,t),n.dtype);return fs(ac(n,r),-1)})}function KL(n,e){return Ne(()=>nc(ac(Fg(n,-1),Fg(e,-1)),"float32"))}function V1e(n,e){return Ne(()=>It(on(Wc(ac(n,1),ac(e,1))),"float32"))}function z1e(n,e){return Ne(()=>It(on(Wc(ac(n,0),ac(e,1))),"float32"))}function W1e(n,e){return Ne(()=>{const t=V1e(n,e),r=z1e(n,e),s=ot(t,r);return It(Vo(sa(s,0),ln(t,s),0),"float32")})}function U1e(n,e){return iw(n,e)}function H1e(n,e){return n.rank===e.rank&&(n=c0(n,[n.rank-1])),e=Fg(e,-1),e.dtype!==n.dtype&&(e=It(e,n.dtype)),It(ac(n,e),"float32")}const G1e=ow,q1e=ow,K1e=iN,X1e=iN,Y1e=aN,Z1e=aN,XL=Bg,J1e=GL,YL=K2,Y2={binaryAccuracy:qL,categoricalAccuracy:KL,precision:W1e,categoricalCrossentropy:XL,sparseCategoricalCrossentropy:YL,mse:G1e,MSE:q1e,mae:K1e,MAE:X1e,mape:Y1e,MAPE:Z1e,cosine:J1e};function Q1e(n){if(typeof n=="string"&&n in Y2)return Y2[n];if(typeof n!="string"&&n!=null)return n;throw new ue(`Unknown metric ${n}`)}function yv(n){if(jl(n!==null,`Unknown LossOrMetricFn ${n}`),typeof n=="string")return n;{let e;for(const t of Object.keys(X2))if(X2[t]===n){e=t;break}if(e!==void 0)return e;for(const t of Object.keys(Y2))if(Y2[t]===n){e=t;break}return e!==void 0?e:n.name}}function e0e(n){const e={Adagrad:()=>Vh.adagrad(.01),Adadelta:()=>Vh.adadelta(1,.95,ws()),Adam:()=>Vh.adam(.001,.9,.999,ws()),Adamax:()=>Vh.adamax(.002,.9,.999,ws(),0),RMSProp:()=>Vh.rmsprop(.001,.9,0,ws()),SGD:()=>Vh.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,n in e)return e[n]();throw new ue(`Unknown Optimizer ${n}`)}const M_=1*1024*1024;function L_(n,e,t=!1){if(n==null||typeof n!="object"||Object.getPrototypeOf(n)!==Object.prototype||!Q5(n))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(t){const r=JSON.stringify(n);r.length>M_&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${r.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${M_}.`)}}function Q5(n){if(n===null)return!0;if(typeof n=="object")if(Object.getPrototypeOf(n)===Object.prototype){const e=Object.keys(n);for(const t of e)if(typeof t!="string"||!Q5(n[t]))return!1;return!0}else if(Array.isArray(n)){for(const e of n)if(!Q5(e))return!1;return!0}else return!1;else{const e=typeof n;return e==="string"||e==="number"||e==="boolean"}}function t0e(n,e,t,r=console.log){const s=r0e(n),o=["Layer (type)","Input Shape","Output shape","Param #"];s?(e=e||90,t=t||[.32,.61,.89,1]):(e=e||115,t=t||[.24,.48,.7,.8,1]),t[t.length-1]<=1&&(t=t.map(u=>Math.floor(e*u)));let i;if(!s){o.push("Receives inputs"),i=[];for(const u in n.nodesByDepth)i.push(...n.nodesByDepth[u])}r("_".repeat(e)),Z2(o,t,r),r("=".repeat(e));const a=n.layers;for(let u=0;u<a.length;++u)s?s0e(a[u],t,r):o0e(a[u],t,i,r),r((u===a.length-1?"=":"_").repeat(e));n.checkTrainableWeightsConsistency();const l=n0e(n),c=U2(n.nonTrainableWeights);r(`Total params: ${l+c}`),r(`Trainable params: ${l}`),r(`Non-trainable params: ${c}`),r("_".repeat(e))}function n0e(n){let e;return n.collectedTrainableWeights!=null?e=U2(n.collectedTrainableWeights):e=U2(n.trainableWeights),e}function r0e(n){let e=!0;const t=[],r=[];for(const s in n.nodesByDepth)t.push(n.nodesByDepth[s]);for(const s of t){if(s.length>1||s.length===1&&s[0].inboundLayers.length>1){e=!1;break}r.push(...s)}if(e)for(const s of n.layers){let o=!1;for(const i of s.inboundNodes)if(r.indexOf(i)!==-1)if(o){e=!1;break}else o=!0;if(!e)break}return e}function Z2(n,e,t=console.log){let r="";for(let s=0;s<n.length;++s)s>0&&(r=r.slice(0,r.length-1)+" "),r+=n[s],r=r.slice(0,e[s]),r+=" ".repeat(e[s]-r.length);t(r)}function s0e(n,e,t){let r,s;try{s=n.inboundNodes.map(l=>JSON.stringify(l.inputShapes)).join(",")}catch{s="multiple"}try{r=JSON.stringify(n.outputShape)}catch{r="multiple"}const o=n.name,i=n.getClassName(),a=[`${o} (${i})`,s,r,n.countParams().toString()];Z2(a,e,t)}function o0e(n,e,t,r){let s,o;try{o=n.inboundNodes.map(d=>JSON.stringify(d.inputShapes)).join(",")}catch{o="multiple"}try{s=JSON.stringify(n.outputShape)}catch{s="multiple"}const i=[];for(const d of n.inboundNodes)if(!(t!=null&&t.length>0&&t.indexOf(d)===-1))for(let f=0;f<d.inboundLayers.length;++f){const p=d.inboundLayers[f].name,x=d.nodeIndices[f],v=d.tensorIndices[f];i.push(`${p}[${x}][${v}]`)}const a=n.name,l=n.getClassName(),c=i.length===0?"":i[0],u=[`${a} (${l})`,o,s,n.countParams().toString(),c];Z2(u,e,r);for(let d=1;d<i.length;++d)Z2(["","","","",i[d]],e,r)}function ZL(n,e,t){return(n==="inboundNodes"||n==="outputLayers"||n==="inputLayers")&&e===0&&typeof t=="string"}function ek(n,e){if(n===null)return null;if(typeof n=="string")return sf(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],r=n.length;for(let s=0;s<r;++s){const o=n[s];ZL(e,s,o)?t.push(o):t.push(ek(o,e))}return t}else{const t={};for(const r of Object.keys(n)){const s=n[r];if(r==="name"&&typeof s=="string")t[r]=s;else{const o=sf(r);t[o]=ek(s,o)}}return t}}function tk(n,e){if(n==null)return null;if(typeof n=="string")return Fc(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],r=n.length;for(let s=0;s<r;++s){const o=n[s];ZL(e,s,o)?t.push(o):t.push(tk(o,e))}return t}else{const t={};for(const r of Object.keys(n)){const s=n[r],o=Fc(r);(r==="name"||r==="className")&&typeof s=="string"?t[o]=s:t[o]=tk(s,r)}return t}}const JL="4.22.0";const i0e=n=>{const e=Object.keys(n);if(e.length===0)return!1;const t=e[0].split("/");return!isNaN(parseInt(t[t.length-1],10))};class Ka extends Pn{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const w=this.getClassName().toLowerCase();this.name=nw(w)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],ed(this.inputs).length!==this.inputs.length)throw new ue(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(w=>w.name)}`);ed(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(w=>w.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const w of this.outputs){const S=w.sourceLayer,k=w.nodeIndex,N=w.tensorIndex;this.outputLayers.push(S),this.outputLayersNodeIndices.push(k),this.outputLayersTensorIndices.push(N)}for(const w of this.inputs){const S=w.sourceLayer,k=w.nodeIndex,N=w.tensorIndex;jl(k===0,"input layer has >1 nodes"),jl(N===0,"input layer has >1 tensors"),this.inputLayers.push(S),this.inputLayersNodeIndices.push(k),this.inputLayersTensorIndices.push(N)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let w=0;w<this.inputLayers.length;w++){const S=this.inputLayers[w];if(!(S instanceof v0))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${w} (0-based) originates from layer type ${S.getClassName()}.`);this.inputNames.push(S.name),this.feedInputShapes.push(S.batchInputShape),this.feedInputNames.push(S.name)}for(const w of this.outputLayers)this.outputNames.push(w.name);this.internalInputShapes=this.inputs.map(w=>w.shape),this.internalOutputShapes=this.outputs.map(w=>w.shape);const t={},r={},s={},o={},i={},a=[],l=(w,S,k,N,I,T)=>{(N==null||I==null||T==null)&&(N=w.sourceLayer,I=w.nodeIndex,T=w.tensorIndex);const F=N.inboundNodes[I];if(k.indexOf(F)!==-1)throw new Ia(`The tensor ${w.name} at layer "${N.name}" is part of a cycle.`);if(S.indexOf(F)!==-1)return;this.containerNodes.add(Ka.nodeKey(N,I)),N.id in i||(i[N.id]=Object.keys(i).length),k.indexOf(F)===-1&&k.push(F);const R=F.inboundLayers.length;for(let D=0;D<R;D++){const A=F.inputTensors[D],P=F.inboundLayers[D],B=F.nodeIndices[D],L=F.tensorIndices[D];l(A,S,k,P,B,L)}for(S.push(F);k.indexOf(F)>=0;)k.splice(k.indexOf(F),1);a.push(F)},c=[],u=[];for(const w of this.outputs)l(w,c,u);const d=a.slice().reverse();for(const w of d){r[w.id]=w,w.id in t||(t[w.id]=0);let S=t[w.id];const k=s[w.outboundLayer.id]==null?0:s[w.outboundLayer.id];S=Math.max(S,k),s[w.outboundLayer.id]=S,o[w.outboundLayer.id]=w.outboundLayer,t[w.id]=S;for(let N=0;N<w.inboundLayers.length;N++){const I=w.inboundLayers[N],T=w.nodeIndices[N],F=I.inboundNodes[T],R=t[F.id]==null?0:t[F.id];t[F.id]=Math.max(S+1,R),r[F.id]=F}}const f={};for(const w in t){const S=t[w];S in f||(f[S]=[]),f[S].push(r[w])}const p={};for(const w in s){const S=s[w];S in p||(p[S]=[]),p[S].push(o[w])}let x=Object.keys(p).map(w=>parseInt(w,10)).sort(gv);this.layers=[];for(const w of x){const S=p[w];S.sort((k,N)=>{const I=i[k.id],T=i[N.id];return I<T?-1:I>T?1:0});for(const k of S)k instanceof Ka&&this.internalContainerRefs.push(k),this.layers.push(k)}this.layersByDepth=p,x=Object.keys(f).map(w=>parseInt(w,10)).sort(gv);const v=this.inputs.slice(),y=[];for(const w of x)for(const S of f[w]){const k=S.outboundLayer;if(k!=null){for(const N of S.inputTensors)if(v.indexOf(N)===-1)throw new Ia(`Graph disconnected: cannot obtain value for tensor ${N} at layer "${k.name}". The following previous layers were accessed without issue: ${y}`);for(const N of S.outputTensors)v.push(N);y.push(k.name)}}this.nodesByDepth=f;const b=this.layers.map(w=>w.name);for(const w of b){const S=b.filter(k=>k===w).length;if(S!==1)throw new Ia(`The name "${w}" is used ${S} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(b))}this.outboundNodes=[],this.inboundNodes=[],new sw({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(w=>null),outputMasks:this.outputs.map(w=>null),inputShapes:this.inputs.map(w=>w.shape),outputShapes:this.outputs.map(w=>w.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(t=>{t._trainableWeights.forEach(r=>r.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new ue("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const r of this.layers)t.push(...r.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,t=!0){const r={};let s=0;const o=i0e(e);o&&this.parseWeights(e);for(const a of this.layers)for(const[l,c]of a.weights.entries()){const u=o?`${c.name.split("/").slice(0,-1).join("/")+"/"}${l}`:c.originalName;if(r[u]!=null)throw new ue(`Duplicate weight name: ${u}`);r[u]=c,s++}const i=[];for(const a in e){let l=a;if(r[a]==null){const c=a.split("/");l=c.slice(0,-2).concat([c[c.length-1]]).join("/")}if(r[l]!=null)i.push([r[l],e[a]]);else if(t)throw new ue(`Provided weight data has no target variable: ${a}`);delete r[l]}if(t){const a=[];for(const l in r)a.push(l);if(a.length>0)throw new ue(`${a.length} of ${s} weights are not set: ${a}`)}sN(i)}parseWeights(e){for(const t in Object.keys(e)){const r=t.split("/"),s=["vars","layer_checkpoint_dependencies"],o=r.map(i=>i.startsWith("_")?i.slice(1):i).filter(i=>!s.includes(i)).join("/");o!==t&&(e[o]=e[t],delete e[t])}}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion=`tfjs-layers ${JL}`,t.backend="TensorFlow.js",t}toJSON(e,t=!0){const r=tk(this.updatedConfig());return t?JSON.stringify(r):r}call(e,t){return Ne(()=>{e=hr(e);const r=new Gu;for(let s=0;s<this.inputs.length;++s)r.add(this.inputs[s],e[s]);return sg(this.outputs,r,t)})}computeMask(e,t){return Ne(()=>{e=hr(e);let r;return t==null?r=Pf(null,e.length):r=hr(t),this.runInternalGraph(e,r)[1]})}computeOutputShape(e){const t=W2(e);if(t.length!==this.inputLayers.length)throw new ue(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const r={};for(let a=0;a<t.length;a++){const l=this.inputLayers[a],c=t[a],u=l.name+"_0_0";r[u]=c}const s=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(gv);if(s.length>1)for(const a of s){const l=this.nodesByDepth[a];for(const c of l){const u=c.outboundLayer;if(this.inputLayers.map(v=>v.id).indexOf(u.id)!==-1)continue;const d=[];for(let v=0;v<c.inboundLayers.length;v++){const y=c.inboundLayers[v],b=c.nodeIndices[v],w=c.tensorIndices[v],S=`${y.name}_${b}_${w}`,k=r[S];d.push(k)}const f=u.computeOutputShape(Qo(d)),p=W2(f),x=u.inboundNodes.indexOf(c);for(let v=0;v<p.length;v++){const y=`${u.name}_${x}_${v}`;r[y]=p[v]}}}const o=[],i=[];for(let a=0;a<this.outputLayers.length;a++){const l=this.outputLayers[a],c=this.outputLayersNodeIndices[a],u=this.outputLayersTensorIndices[a],d=`${l.name}_${c}_${u}`;i.push(d)}for(let a=0;a<i.length;a++){const l=i[a];jl(l in r),o.push(r[l])}return Qo(o)}runInternalGraph(e,t){t==null&&(t=Pf(null,e.length));const r={};for(let l=0;l<this.inputs.length;++l){const c=this.inputs[l],u=e[l],d=t[l];r[c.id]=[u,d]}const s=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(gv);for(const l of s){const c=this.nodesByDepth[l];for(const u of c){const d=u.outboundLayer,f=u.inputTensors,p=u.outputTensors,x=new Array;for(const v of f)v.id in r&&x.push(r[v.id]);if(x.length===f.length){let v={},y,b,w,S;if(u.callArgs!=null&&(v=u.callArgs),x.length===1){const[k,N]=x[0];v.mask==null&&(v.mask=N),w=hr(d.call(k,v)),S=hr(d.computeMask(k,N)),y=[k],b=[N]}else y=x.map(k=>k[0]),b=x.map(k=>k[1]),v.mask==null&&(v.mask=b),w=hr(d.call(y,v)),S=hr(d.computeMask(y,b));if(d.activityRegularizer)throw new Tn("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let k=0;k<p.length;++k){const N=p[k],I=w[k],T=S[k];r[N.id]=[I,T]}}}}const o=[],i=[],a=[];for(const l of this.outputs){jl(l.id in r,`Could not compute output ${l.name} : ${l.id}`);const[c,u]=r[l.id];a.push(c.shape),o.push(c),i.push(u)}return[o,i,a]}buildNodeConversionMap(e){const t={};let r;for(const s of this.layers){r=s instanceof Ka?1:0;for(let o=0;o<s.inboundNodes.length;o++){const i=Ka.nodeKey(s,o);this.containerNodes.has(i)&&(t[i]=r,r+=1)}}return t}getLayer(e,t){if(t!=null)return this.findLayer(t);if(e==null)throw new ue("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const r of this.layers)if(r.name===e)return r;throw new ue(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new ue(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return Ne(()=>{const e=[];for(const t of this.layers)for(let r=0;r<t.inboundNodes.length;++r){const s=Ka.nodeKey(t,r);this.containerNodes.has(s)&&e.push(...t.calculateLosses())}return e})}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),r=[];for(const i of this.layers){const a=i.getClassName(),l=i.getConfig(),c=[];for(let d=0;d<i.inboundNodes.length;d++){const f=i.inboundNodes[d],p=Ka.nodeKey(i,d);let x={};if(this.containerNodes.has(p)){if(f.callArgs)try{JSON.stringify(f.callArgs),x=f.callArgs}catch{console.warn(`Layer ${i.name} was passed non-serializable keyword arguments: ${f.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),x={}}if(f.inboundLayers.length>0){const v=[];for(let y=0;y<f.inboundLayers.length;y++){const b=f.inboundLayers[y],w=f.nodeIndices[y],S=f.tensorIndices[y],k=Ka.nodeKey(b,w);let N=t[k];N==null&&(N=0),v.push([b.name,N,S,x])}c.push(v)}}}const u={};u.name=i.name,u.className=a,u.config=l,u.inboundNodes=c,r.push(u)}e.layers=r;const s=[];for(let i=0;i<this.inputLayers.length;i++){const a=this.inputLayers[i],l=this.inputLayersNodeIndices[i],c=Ka.nodeKey(a,l);if(!this.containerNodes.has(c))continue;let u=t[c];u==null&&(u=0);const d=this.inputLayersTensorIndices[i];s.push([a.name,u,d])}e.inputLayers=s;const o=[];for(let i=0;i<this.outputLayers.length;i++){const a=this.outputLayers[i],l=this.outputLayersNodeIndices[i],c=Ka.nodeKey(a,l);if(!this.containerNodes.has(c))continue;let u=t[c];u==null&&(u=0);const d=this.outputLayersTensorIndices[i];o.push([a.name,u,d])}return e.outputLayers=o,e}static fromConfig(e,t,r={},s=!1){const o={},i={};function a(y,b){y.name in i?i[y.name].push(b):i[y.name]=[b]}function l(y,b){const w=[];let S;for(const k of b){const N=k[0],I=k[1],T=k[2];if(S=k[3]==null?{}:k[3],!(N in o)){a(y,b);return}const F=o[N];if(F.inboundNodes.length<=I){a(y,b);return}const R=F.inboundNodes[I];w.push(R.outputTensors[T])}w.length>0&&y.apply(Qo(w),S)}function c(y){const b=y.name,w=Lc(y,t.customObjects!=null?t.customObjects:{});w.setFastWeightInitDuringBuild(s),o[b]=w,y.inboundNodes.forEach(k=>{if(!(k instanceof Array))throw new ue(`Corrupted configuration, expected array for nodeData: ${k}`);a(w,k)})}const u=t.name,d=t.layers;for(const y of d)c(y);for(;!Uge(i);)for(const y of d){const b=o[y.name];if(b.name in i){const w=i[b.name];delete i[b.name];for(const S of w)l(b,S)}}const f=[],p=[],x=t.inputLayers;for(const y of x){const b=y[0],w=y[1],S=y[2];jl(b in o);const N=o[b].inboundNodes[w].outputTensors;f.push(N[S])}const v=t.outputLayers;for(const y of v){const b=y[0],w=y[1],S=y[2];jl(b in o);const N=o[b].inboundNodes[w].outputTensors;p.push(N[S])}return new e({inputs:f,outputs:p,name:u})}get stateful(){if(this._stateful)throw new ue("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){Ne(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}function a0e(n,e,t){const r=e.length;if(n==null||Array.isArray(n)&&n.length===0)return e.map(s=>null);if(r===1)return Array.isArray(n)&&n.length===1?n:typeof n=="object"&&e[0]in n?[n[e[0]]]:[n];if(Array.isArray(n)){if(n.length!==r)throw new Error(`Provided ${t} is an array of ${n.length} element(s), but the model has ${r} outputs. Make sure a set of weights is provided for each model output.`);return n}else if(typeof n=="object"&&Object.keys(n).length>0&&typeof n[Object.keys(n)[0]]=="object"){const s=[];return e.forEach(o=>{o in n?s.push(n[o]):s.push(null)}),s}else throw new Error(`The model has multiple (${r}) outputs, so ${t} must be either an array with ${r} elements or an object with ${e} keys. Provided ${t} not understood: ${JSON.stringify(n)}`)}function QL(n,e){return a0e(n,e,"classWeight")}async function ej(n,e,t,r){if(t!=null){const s=Ne(()=>{if(n.shape.length===1)return gf(n);if(n.shape.length===2){if(n.shape[1]>1)return Fg(n,1);if(n.shape[1]===1)return ye(n,[n.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${n.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${n.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),o=Array.from(await s.data());Mn(s);const i=[];return o.forEach(a=>{if(t[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);i.push(t[a])}),Ci(i,"float32")}else return null}function l0e(n,e){return fe(n,e)}const c0e=32;function tj(n,e){let t,r;const s=e;t=s.xs,r=s.ys,X(t!=null&&r!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const o=j_("input",n.inputNames,t),i=j_("output",n.outputNames,r),a=o[0].shape[0];X(o.length===n.inputs.length,()=>`LayersModel has ${n.inputs.length} inputs, but the dataset provides ${o.length} inputs.  (Expected input keys: ${JSON.stringify(n.inputNames)})`),X(i.length===n.outputs.length,()=>`LayersModel has ${n.outputs.length} outputs, but the dataset provides ${i.length} outputs.  (Expected output keys: ${JSON.stringify(n.outputNames)})`);for(let l=0;l<o.length;l++)X(o[l].shape[0]===a,()=>`Batch size mismatch: input ${n.inputNames[l]} has ${o[l].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);for(let l=0;l<i.length;l++)X(i[l].shape[0]===a,()=>`Batch size mismatch: output ${n.outputNames[l]} has ${i[l].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);return{xs:o,ys:i}}function j_(n,e,t){if(t instanceof ys)return[t];if(Array.isArray(t))return X(t.length===e.length,()=>`Received an array of ${t.length} Tensors, but expected ${e.length} to match the ${n} keys ${e}.`),t;{const r=[];for(const s of e){if(t[s]==null)throw new ue(`The feature data generated by the dataset lacks the required ${n} key '${s}'.`);r.push(t[s])}return r}}function u0e(n){if(n.length===3)throw new Tn("Validation with sample weights is not implemented yet.");return{xs:n[0],ys:n[1]}}async function d0e(n,e,t){const r=t.batchesPerEpoch!=null;if(X(n.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),X(t!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),X(t.epochs!=null&&t.epochs>0&&Number.isInteger(t.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${t.epochs}`),X(!r||t.batchesPerEpoch>0&&Number.isInteger(t.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${t.batchesPerEpoch}`),X(t.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),n.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");n.isTraining=!0;try{const s=t.validationData!=null;let o,i;if(s)if(B_(t.validationData))X(t.validationBatches==null||t.validationBatches>0&&Number.isInteger(t.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${t.validationBatches}`);else{const y=u0e(t.validationData);o=y.xs,i=y.ys}const a=n.makeTrainFunction(),l=n.getDedupedMetricsNames();let c;s?c=l.slice().concat(l.map(y=>"val_"+y)):c=l.slice();const u=UL(t.callbacks,t.yieldEvery),d=t.verbose==null?1:t.verbose,{callbackList:f,history:p}=HL(u,d,t.epochs,null,null,f0e(e,t),null,s,c);f.setModel(n),n.history=p,await f.onTrainBegin(),n.stopTraining_=!1;let x=t.initialEpoch==null?0:t.initialEpoch,v=await e.iterator();for(;x<t.epochs;){const y={};await f.onEpochBegin(x);let b=0,w=0;for(r||(v=await e.iterator());!r||b<t.batchesPerEpoch;){const S=await v.next();if(r&&S.done){console.warn(`You provided \`batchesPerEpoch\` as ${t.batchesPerEpoch}, but your dataset iterator ran out of data after ${b} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${t.batchesPerEpoch*t.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(S.value!=null){const{xs:k,ys:N}=tj(n,S.value),I={};I.batch=w,I.size=k[0].shape[0],await f.onBatchBegin(w,I);const T=[];if(t.classWeight!=null){const D=QL(t.classWeight,n.outputNames);for(let A=0;A<D.length;++A)T.push(await ej(N[A],null,D[A]))}const F=k.concat(N).concat(T),R=a(F);Mn(F);for(let D=0;D<l.length;++D){const A=l[D],P=R[D];I[A]=P,ec(P)}await f.onBatchEnd(w,I),WL(I),w++,b++}if(r?b>=t.batchesPerEpoch:S.done){if(s){let k;B_(t.validationData)?k=hr(await n.evaluateDataset(t.validationData,{batches:t.validationBatches})):k=hr(n.evaluate(o,i,{batchSize:t.validationBatchSize==null?c0e:t.validationBatchSize,verbose:0}));for(let N=0;N<n.metricsNames.length;++N)y[`val_${n.metricsNames[N]}`]=k[N]}break}if(n.stopTraining_)break}if(await f.onEpochEnd(x,y),x++,n.stopTraining_)break}return await f.onTrainEnd(),await n.history.syncData(),n.history}finally{n.isTraining=!1}}function f0e(n,e){let t=null;return e.batchesPerEpoch!=null?t=e.batchesPerEpoch:Number.isFinite(n.size)&&(t=n.size),t}function B_(n){return typeof n.iterator=="function"}function h0e(n){return typeof n.next=="function"}async function p0e(n,e,t){t=t||{};const r=t.batches!=null,s=n.testFunction;let o=[];if(t.verbose>0)throw new Tn("Verbose mode is not implemented yet.");X(!r||t.batches>0&&Number.isInteger(t.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(t.batches)}`);const i=h0e(e)?e:await e.iterator();let a=0,l=0;for(;!r||l<t.batches;){const c=await i.next();if(o=Ne(()=>{if(c.value){const{xs:u,ys:d}=tj(n,c.value),f=u.concat(d),p=Ne(()=>s(f));if(Mn(f),l===0)for(let v=0;v<p.length;++v)o.push(ar(0));const x=f[0].shape[0];for(let v=0;v<p.length;++v){const y=p[v],b=o[v];o[v]=Ne(()=>ot(o[v],fe(x,y))),l>0&&Mn(b)}Mn(p),a+=x,++l}return o}),c.done){r&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${t.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let c=0;c<o.length;++c){const u=o[c];o[c]=ln(o[c],a),Mn(u)}return Qo(o)}function g4(n){X(n>0&&Number.isInteger(n),()=>`batchSize is required to be a positive integer, but got ${n}`)}function Zm(n,e,t){return n==null?[null]:Array.isArray(n)?n.map(r=>vf(r,e,t-e)):vf(n,e,t-e)}function nk(n,e){return Ne(()=>n==null?null:Array.isArray(n)?n.map(t=>nk(t,e)):_L(n,e.dtype==="int32"?e:It(e,"int32")))}function x4(n,e){const t=[];let r=0,s=null;for(;r<n;)s=r+e,s>=n&&(s=n),t.push([r,s]),r=s;return t}function nj(n){const e=[];n instanceof ys&&(n=[n]);for(let t=0;t<n.length;++t){const r=n[t];if(r.rank===1)e.push(m0(r,1));else{if(r.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(r)}}return e}function qa(n,e){if(n==null)return;const t=[];if(e instanceof ys)t.push(e.id);else if(Array.isArray(e))e.forEach(s=>t.push(s.id));else if(e!=null)for(const s in e){const o=e[s];t.push(o.id)}const r=[];if(n instanceof ys)t.indexOf(n.id)===-1&&r.push(n);else if(Array.isArray(n))n.forEach(s=>{t.indexOf(s.id)===-1&&r.push(s)});else if(n!=null)for(const s in n){const o=n[s];t.indexOf(o.id)===-1&&r.push(o)}r.forEach(s=>{s.isDisposed||s.dispose()})}function m0e(n){return n instanceof ys}function rk(n){return Array.isArray(n)}function V_(n){return!m0e(n)&&!rk(n)}function z_(n,e,t,r=!0,s=""){if(e==null||e.length===0){if(n!=null){let i=!1;if(rk(n)&&n.length>0)i=!0;else if(V_(n)){for(const a in n)if(n.hasOwnProperty(a)){i=!0;break}}else i=!0;if(i)throw new ue(`Error when checking model ${s} expected no data, but got ${n}`)}return[]}if(n==null)return e.map(i=>null);let o;if(V_(n)){n=n,o=[];for(const i of e){if(n[i]==null)throw new ue(`No data provided for "${i}". Need data for each key in: ${e}`);o.push(n[i])}}else if(rk(n)){if(n=n,n.length!==e.length)throw new ue(`Error when checking model ${s}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${n}`);o=n}else{if(n=n,e.length>1)throw new ue(`The model ${s} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${n.shape}`);o=[n]}if(o=nj(o),t!=null)for(let i=0;i<e.length;++i){if(t[i]==null)continue;const a=o[i];if(a.shape.length!==t[i].length)throw new ue(`Error when checking ${s}: expected ${e[i]} to have ${t[i].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<t[i].length;++l){if(l===0&&!r)continue;const c=a.shape[l],u=t[i][l];if(u!=null&&u>=0&&c!==u)throw new ue(`${s} expected a batch of elements where each example has shape [${t[i].slice(1,t[i].length)}] (i.e.,tensor shape [*,${t[i].slice(1,t[i].length)}]) but the ${s} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return o}function g0e(n,e,t){const r=ed(n.map(o=>o.shape[0]));r.sort();const s=ed(e.map(o=>o.shape[0]));if(s.sort(),r.length>1)throw new ue(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(o=>o.shape))}`);if(s.length>1)throw new ue(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(o=>o.shape))}`);if(r.length>0&&s.length>0&&!lr(r,s))throw new ue(`Input Tensors should have the same number of samples as target Tensors. Found ${r[0]} input sample(s) and ${s[0]} target sample(s).`)}function x0e(n,e,t){const r=[ow,iw,Bg];for(let s=0;s<n.length;++s){const o=n[s],i=e[s],a=t[s];if(i!=null){if(i===Bg&&o.shape[o.shape.length-1]===1)throw new ue(`You are passing a target array of shape ${o.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(r.indexOf(i)!==-1){const l=o.shape.slice(1),c=a.slice(1);for(let u=0;u<l.length;++u){const d=l[u],f=c[u];if(f!=null&&d!==f)throw new ue(`A target Tensor with shape ${o.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function W_(n,e,t,r=!0,s=""){let o;if(Array.isArray(n)){if(n.length!==e.length)throw new ue(`Error when checking model ${s}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${n.length} Tensors(s).`);o=n}else{if(e.length>1)throw new ue(`The model expects ${e.length} ${s} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(n.shape)}.`);o=[n]}if(t!=null)for(let i=0;i<e.length;++i){if(t[i]==null)continue;const a=o[i];if(a.shape.length!==t[i].length)throw new ue(`Error when checking ${s}: expected ${e[i]} to have ${t[i].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<t[i].length;++l){if(l===0&&!r)continue;const c=a.shape[l],u=t[i][l];if(u!=null&&u!==c)throw new ue(`Error when checking ${s}: expected ${e[i]} to have shape ${JSON.stringify(t[i])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function v0e(n,e){if(n==null||Array.isArray(n)&&n.length===0)return e.map(r=>[]);let t;if(typeof n=="string"||typeof n=="function")t=[n];else if(Array.isArray(n)||typeof n=="object")t=n;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${n}`);if(Array.isArray(t))return e.map(r=>t);{const r=[];for(const s of e){let o=t.hasOwnProperty(s)?t[s]:[];Array.isArray(o)||(o=[o]),r.push(o)}return r}}const y0e="layers-model";class gp extends Ka{constructor(e){super(e),this.isTraining=!1}summary(e,t,r=console.log){if(!this.built)throw new ue("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");t0e(this,e,t,r)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=e0e(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof Sd))throw new ue("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const i in e.loss)if(this.outputNames.indexOf(i)===-1)throw new ue(`Unknown entry in loss dictionary: "${i}". Only expected the following keys: ${this.outputNames}`);for(const i of this.outputNames)e.loss[i]==null&&console.warn(`Output "${i}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${i} during training`),t.push(m4(e.loss[i]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new ue(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);t=e.loss.map(a=>m4(a))}else{const i=m4(e.loss);this.outputs.forEach(a=>{t.push(i)})}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let i=0;i<this.outputs.length;++i){const a=this.internalOutputShapes[i],l=this.outputNames[i];this.feedOutputNames.push(l),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[i])}const r=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],xf("loss",()=>{for(let i=0;i<this.outputs.length;++i){if(r.indexOf(i)!==-1)continue;const a=this.lossFunctions[i];this.outputs.length>1&&(this.metricsTensors.push([a,i]),this.metricsNames.push(this.outputNames[i]+"_loss"))}});const s=v0e(e.metrics,this.outputNames),o=(i,a,l)=>{this.outputNames.length>1&&(a=this.outputNames[i]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([l,i])};xf("metric",()=>{for(let i=0;i<this.outputs.length;++i){if(r.indexOf(i)!==-1)continue;const a=s[i];(c=>{let d,f,p;for(const x of c){if(typeof x=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(x)!==-1){const y=this.internalOutputShapes[i];y[y.length-1]===1||this.lossFunctions[i]===iw?["accuracy","acc"].indexOf(x)!==-1?f=qL:["crossentropy","ce"].indexOf(x)!==-1&&(f=U1e):this.lossFunctions[i]===K2?["accuracy","acc"].indexOf(x)!==-1?f=H1e:["crossentropy","ce"].indexOf(x)!==-1&&(f=YL):["accuracy","acc"].indexOf(x)!==-1?f=KL:["crossentropy","ce"].indexOf(x)!==-1&&(f=XL);let b;["accuracy","acc"].indexOf(x)!==-1?b="acc":["crossentropy","ce"].indexOf(x)!==-1&&(b="ce"),p=f,d=""+b}else p=Q1e(x),d=""+yv(x);let v;xf(d,()=>{v=p}),o(i,d,v)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t,r={}){const s=r.batchSize==null?32:r.batchSize;g4(s);const i=this.standardizeUserDataXY(e,t,!0,s);try{const a=i[0].concat(i[1]);this.makeTestFunction();const l=this.testFunction,c=this.testLoop(l,a,s,r.verbose,r.steps);return Qo(c)}finally{qa(i[0],e),qa(i[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),p0e(this,e,t)}checkNumSamples(e,t,r,s="steps"){let o;if(r!=null){if(o=null,t!=null)throw new ue(`If ${s} is set, batchSize must be null or undefined.Got batchSize = ${t}`)}else if(e!=null)Array.isArray(e)?o=e[0].shape[0]:o=e.shape[0];else throw new ue(`Either the input data should have a defined shape, or ${s} shoud be specified.`);return o}execute(e,t){if(Array.isArray(t)&&t.length===0)throw new ue("`outputs` is an empty Array, which is not allowed.");const r=Array.isArray(t),s=r?t:[t],o=this.retrieveSymbolicTensors(s),i=new Gu;if(e instanceof ys&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new ue(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let l=0;l<this.inputs.length;++l)i.add(this.inputs[l],e[l])}else for(const l of this.inputs){const c=e[l.name];if(c==null)throw new ue(`No value is provided for the model's input ${l.name}`);i.add(l,c)}const a=sg(o,i);return r?a:a[0]}retrieveSymbolicTensors(e){const t=Pf(null,e.length);let r=e.length;for(const s of this.layers){const o=Array.isArray(s.output)?s.output:[s.output],i=o.map(a=>a.name);for(let a=0;a<e.length;++a){const l=i.indexOf(e[a]);if(l!==-1&&(t[a]=o[l],r--),r===0)break}if(r===0)break}if(r>0){const s=[];throw t.forEach((o,i)=>{o==null&&s.push(e[i])}),new ue(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(s)}`)}return t}predictLoop(e,t=32,r=!1){return Ne(()=>{const s=this.checkNumSamples(e);if(r)throw new Tn("Verbose predictLoop() is not implemented yet.");const o=x4(s,t),i=this.outputs.map(a=>[]);for(let a=0;a<o.length;++a)Ne(()=>{const c=o[a][0],u=o[a][1],d=Zm(e,c,u),f=[];if(Array.isArray(d))for(let x=0;x<d.length;++x)f.push({key:this.inputs[x],value:d[x]});else f.push({key:this.inputs[0],value:d});const p=new Gu(f);return sg(this.outputs,p)}).forEach((c,u)=>i[u].push(c));return Qo(i.map(a=>ei(a,0)))})}predict(e,t={}){const r=nj(e);W_(r,this.inputNames,this.feedInputShapes,!1);try{const s=t.batchSize==null?32:t.batchSize;return g4(s),this.predictLoop(r,s)}finally{qa(r,e)}}predictOnBatch(e){W_(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t,r=!0,s){if(this.optimizer_==null)throw new Ia("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const o=[];for(let i=0;i<this.feedOutputShapes.length;++i){const a=this.feedOutputShapes[i];this.feedLossFns[i]===K2?o.push(a.slice(0,a.length-1).concat([1])):o.push(a)}if(e=z_(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=z_(t,this.feedOutputNames,o,!1,"target"),g0e(e,t),x0e(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&s!=null&&s>0&&e[0].shape[0]%s!==0)throw new ue(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${s}. Found: ${e[0].shape[0]} sample(s).`);return[e,t]}async standardizeUserData(e,t,r,s,o=!0,i){const[a,l]=this.standardizeUserDataXY(e,t,o,i);if(r!=null)throw new Error("sample weight is not supported yet.");let c=null;if(s!=null){const u=QL(s,this.outputNames);c=[];for(let d=0;d<u.length;++d)c.push(await ej(l[d],null,u[d]))}return[a,l,c]}testLoop(e,t,r,s=0,o){return Ne(()=>{const i=this.checkNumSamples(t,r,o,"steps"),a=[];if(s>0)throw new Tn("Verbose mode is not implemented yet.");if(o!=null)throw new Tn("steps mode in testLoop() is not implemented yet");{const l=x4(i,r),c=Ci(dl(0,i));for(let u=0;u<l.length;++u){const d=l[u][0],f=l[u][1],p=vf(c,d,f-d),x=nk(t,p),v=e(x);if(u===0)for(let y=0;y<v.length;++y)a.push(ar(0));for(let y=0;y<v.length;++y){const b=v[y];a[y]=ot(a[y],fe(f-d,b))}}for(let u=0;u<a.length;++u)a[u]=ln(a[u],i)}return a})}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let r=0;r<e.length;++r){const s=e[r];let o=s;if(I_(e,s)>1){const i=I_(e.slice(0,r),s);o+=`_${i}`}t.push(o)}return t}makeTrainFunction(){return e=>{const t=[],r=e.slice(0,this.inputs.length),s=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),i=[],a=()=>{const d=[];for(let v=0;v<this.inputs.length;++v)d.push({key:this.inputs[v],value:r[v]});const f=new Gu(d),p=sg(this.outputs,f,{training:!0});let x;for(let v=0;v<this.lossFunctions.length;++v){const y=this.lossFunctions[v];let b=y(s[v],p[v]);o[v]!=null&&(b=l0e(b,o[v]));const w=fs(b);t.push(w),v===0?x=b:x=ot(x,b)}for(let v=0;v<this.metricsTensors.length;++v){let y;if(this.outputs.length>1&&v<this.outputs.length)y=t[v];else{const b=this.metricsTensors[v][0],w=this.metricsTensors[v][1];y=fs(b(s[w],p[w]))}ec(y),i.push(y)}return x=fs(x),this.calculateLosses().forEach(v=>{x=ot(x,v)}),x},l=this.collectedTrainableWeights.map(d=>d.read());return[this.optimizer_.minimize(a,!0,l)].concat(i)}}makeTestFunction(){this.testFunction=e=>Ne(()=>{const t=[];let r;const s=e.slice(0,this.inputs.length),o=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=[];for(let c=0;c<this.inputs.length;++c)i.push({key:this.inputs[c],value:s[c]});const a=new Gu(i),l=sg(this.outputs,a);for(let c=0;c<this.lossFunctions.length;++c){const u=this.lossFunctions[c],d=fs(u(o[c],l[c]));c===0?r=d:r=ot(r,d),t.push(r)}for(let c=0;c<this.metricsTensors.length;++c){const u=this.metricsTensors[c][0],d=this.metricsTensors[c][1],f=fs(u(o[d],l[d]));t.push(f)}return t})}async fit(e,t,r={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let s,o,i,a,l,c,u,d,f;try{const p=r.batchSize==null?32:r.batchSize;g4(p);const v=await this.standardizeUserData(e,t,r.sampleWeight,r.classWeight,!1,p);s=v[0],o=v[1],f=v[2];let y=!1,b;if(r.validationData!=null&&r.validationData.length>0){if(y=!0,r.validationData.length===2)l=r.validationData[0],c=r.validationData[1];else throw r.validationData.length===3?new Tn("validationData including sample weights is not supported yet."):new ue(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${r.validationData} is invalid.`);const D=await this.standardizeUserData(l,c,null,null,!0,p);u=D[0],d=D[1],b=u.concat(d)}else if(r.validationSplit!=null&&r.validationSplit>0&&r.validationSplit<1){y=!0;const R=Math.floor(s[0].shape[0]*(1-r.validationSplit)),D=s[0].shape[0];u=Zm(s,R,D),i=s,s=Zm(s,0,R),d=Zm(o,R,D),a=o,o=Zm(o,0,R),b=u.concat(d)}else r.validationSteps!=null&&(y=!0);const w=s.concat(o).concat(f);this.checkTrainableWeightsConsistency();const S=this.makeTrainFunction(),k=this.getDedupedMetricsNames();let N,I;y?(this.makeTestFunction(),N=this.testFunction,I=k.slice().concat(k.map(R=>"val_"+R))):(N=null,b=[],I=k.slice());const T=UL(r.callbacks,r.yieldEvery);return await this.fitLoop(S,w,k,p,r.epochs,r.verbose,T,N,b,r.shuffle,I,r.initialEpoch,null,null)}finally{this.isTraining=!1,qa(s,e),qa(o,t),qa(i,e),qa(a,t),qa(u,l),qa(d,c),f!=null&&Mn(f)}}async fitLoop(e,t,r,s,o,i,a,l,c,u,d,f,p,x){s==null&&(s=32),o==null&&(o=1),u==null&&(u=!0),f==null&&(f=0);let v=!1;if(l!=null&&c!=null&&(v=!0),x!=null&&(v=!0,p==null))throw new ue("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const y=this.checkNumSamples(t,s,p,"steps_per_epoch");let b;y!=null&&(b=dl(0,y)),i==null&&(i=1);const{callbackList:w,history:S}=HL(a,i,o,f,y,p,s,v,d);w.setModel(this),this.history=S,await w.onTrainBegin(),this.stopTraining_=!1;for(let k=f;k<o;++k){await w.onEpochBegin(k);const N={};if(p!=null)throw new Tn("stepsPerEpoch mode is not implemented yet.");{if(u==="batch")throw new Tn("batch shuffling is not implemneted yet");u&&Qae(b);const I=Ci(b),T=x4(y,s);for(let F=0;F<T.length;++F){const R={};if(await w.onBatchBegin(F,R),Ne(()=>{const D=T[F][0],A=T[F][1],P=vf(I,D,A-D);R.batch=F,R.size=A-D;const B=nk(t,P),L=e(B);for(let W=0;W<r.length;++W){const H=r[W],G=L[W];R[H]=G,ec(G)}if(F===T.length-1&&v){const W=this.testLoop(l,c,s);for(let H=0;H<r.length;++H){const G=r[H],M=W[H];ec(M),N["val_"+G]=M}}}),await w.onBatchEnd(F,R),WL(R),this.stopTraining_)break}I.dispose()}if(await w.onEpochEnd(k,N),this.stopTraining_)break}return await w.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,t){return d0e(this,e,t)}async trainOnBatch(e,t){const r=await this.standardizeUserData(e,t),s=r[0],o=r[1],a=this.makeTrainFunction()(s.concat(o)),l=[];for(const c of a){const u=await c.data();l.push(u[0])}return Mn(a),qa(r[0],e),qa(r[1],t),Qo(l)}getNamedWeights(e){const t=[],r=e!=null&&e.trainableOnly,s=r?this.trainableWeights:this.weights,o=this.getWeights(r);for(let i=0;i<s.length;++i)r&&!s[i].trainable||t.push({name:s[i].originalName,tensor:o[i]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const t=t_().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-t_().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=Fc(this.loss);else if(Array.isArray(this.loss)){for(const t of this.loss)if(typeof t!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(t=>Fc(t))}else{const t=Object.keys(this.loss);e={};const r=this.loss;for(const s of t)if(typeof r[s]=="string")e[s]=Fc(r[s]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Fc(yv(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>Fc(yv(e)));{const e={};for(const t in this.metrics)e[t]=Fc(yv(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const t=ek(e.optimizer_config),r=Lc(t);let s;if(typeof e.loss=="string")s=sf(e.loss);else if(Array.isArray(e.loss))s=e.loss.map(i=>sf(i));else if(e.loss!=null){s={};for(const i in e.loss)s[i]=sf(e.loss[i])}let o;if(Array.isArray(e.metrics))o=e.metrics.map(i=>sf(i));else if(e.metrics!=null){o={};for(const i in e.metrics)o[i]=sf(e.metrics[i])}this.compile({loss:s,metrics:o,optimizer:r})}async save(e,t){if(typeof e=="string"){const c=Zle(e);if(c.length===0)throw new ue(`Cannot find any save handlers for URL '${e}'`);if(c.length>1)throw new ue(`Found more than one (${c.length}) save handlers for URL '${e}'`);e=c[0]}if(e.save==null)throw new ue("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const r=await r_(this.getNamedWeights(t)),a={modelTopology:this.toJSON(null,!1),format:y0e,generatedBy:`TensorFlow.js tfjs-layers v${JL}`,convertedBy:null};if((t==null?!1:t.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const c="optimizer",{data:u,specs:d}=await r_(await this.optimizer.getWeights(),c);r.specs.push(...d),r.data=Yle([r.data,u])}return this.userDefinedMetadata!=null&&(L_(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=r.data,a.weightSpecs=r.specs,e.save(a)}setUserDefinedMetadata(e){L_(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}gp.className="Model";Qe(gp);class rj extends gp{}rj.className="Functional";Qe(rj);class Vg extends gp{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:nw("sequential_"),e.layers!=null)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(r=>r<0))throw new ue(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const t=e instanceof Vg||e instanceof gp;let r;if(t){if(r=e,r.outputs.length!==1)throw new ue("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(r.inputs.length!==1)throw new ue("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new ue("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const s=w1e({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(s)}if(t)this.outputs=r.outputs,this.inputs=r.inputs;else{if(e.inboundNodes.length!==1)throw new ue(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new ue("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=LL(this.outputs[0])}this.inboundNodes=[],new sw({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Pf(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(s=>s.shape),outputShapes:this.outputs[0].shape})}else{const s=e.apply(this.outputs[0]);if(Array.isArray(s))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[s],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return this.model==null&&this.build(),this.model.call(e,t)}build(e){if(Zn(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new gp({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t,r=console.log){this.built||this.build(),super.summary(e,t,r)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,t,r={}){if(!this.built)throw new Ia("The model needs to be compiled before being used.");return this.model.evaluate(e,t,r)}async evaluateDataset(e,t){if(!this.built)throw new Ia("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e,t={}){return this.model==null&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t,r={}){if(!this.built)throw new Ia("The model needs to be compiled before being used.");return this.model.fit(e,t,r)}async fitDataset(e,t){if(!this.built)throw new Ia("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t,r={},s=!1){let o,i={};if(t instanceof Array){if(t[0].className==null||t[0].className==="Merge")throw new ue("Legacy serialization format not supported yet.");o=t}else X(t.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),o=t.layers,delete t.layers,i=t;const a=new e(i);if(!(a instanceof Vg))throw new Tn(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const l of o){const u=Lc(l,void 0,s);s&&u.setFastWeightInitDuringBuild(!0),a.add(u)}return a}set stopTraining(e){if(this.model==null)throw new ue("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new ue("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const r={};r.className=t.getClassName(),r.config=t.getConfig(),e.push(r)}return{name:this.name,layers:e}}}Vg.className="Sequential";Qe(Vg);let vo=class extends nm{getConfig(){return{}}};class sj extends vo{apply(e,t=1){return o1e(e,t)}}sj.className="elu";Qe(sj);class oj extends vo{apply(e){return CM(e)}}oj.className="selu";Qe(oj);class ij extends vo{apply(e){return Xf(e)}}ij.className="relu";Qe(ij);class aj extends vo{apply(e){return Ne(()=>Mg(6,Xf(e)))}}aj.className="relu6";Qe(aj);class lj extends vo{apply(e){return e}}lj.className="linear";Qe(lj);class cj extends vo{apply(e){return Qp(e)}}cj.className="sigmoid";Qe(cj);class uj extends vo{apply(e){return a1e(e)}}uj.className="hardSigmoid";Qe(uj);class dj extends vo{apply(e){return a0(e)}}dj.className="softplus";Qe(dj);class fj extends vo{apply(e){return i1e(e)}}fj.className="softsign";Qe(fj);class hj extends vo{apply(e){return Gb(e)}}hj.className="tanh";Qe(hj);let lN=class extends vo{apply(e,t=-1){return d8(e,t)}};lN.className="softmax";Qe(lN);class pj extends vo{apply(e,t=-1){return pM(e,t)}}pj.className="logSoftmax";Qe(pj);class mj extends vo{apply(e){return Ne(()=>Ne(()=>{const t=Math.sqrt(2),r=fe(.5,ot(1,cM(ln(e,t))));return fe(e,r)}))}}mj.className="gelu";Qe(mj);class gj extends vo{apply(e){return Ne(()=>fe(.5,fe(e,ot(1,Gb(fe(go(ln(2,Math.PI)),ot(e,fe(.044715,Af(e,3)))))))))}}gj.className="gelu_new";Qe(gj);class xj extends vo{apply(e){return Ne(()=>fe(e,Gb(a0(e))))}}xj.className="mish";Qe(xj);class vj extends vo{apply(e,t=1){return Ne(()=>fe(Qp(fe(e,t)),e))}}vj.className="swish";Qe(vj);function ud(n){return n.getClassName()}function v4(n,e={}){return p0(n,Na.getMap().classNameMap,e,"activation")}function dd(n){if(n==null){const e={};return e.className="linear",e.config={},v4(e)}if(typeof n=="string"){const e={};return e.className=n,e.config={},v4(e)}else return n instanceof vo?n:v4(n)}function b0e(n){if(n!=null&&typeof n!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${n}`)}class yj extends nm{}class bj extends yj{constructor(e){super(),b0e(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return Ne(()=>{let t=Ps([1]);return this.hasL1&&(t=ot(t,on(fe(this.l1,Ao(e))))),this.hasL2&&(t=ot(t,on(fe(this.l2,g0(e))))),ye(t,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}bj.className="L1L2";Qe(bj);const U_={l1l2:"L1L2"};function Cr(n){return K8(n)}function H_(n,e={}){return p0(n,Na.getMap().classNameMap,e,"regularizer")}function jr(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in U_?U_[n]:n,config:{}};return H_(t)}else return n instanceof yj?n:H_(n)}class wj extends Pn{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,t){e=mn(e);let r=Xf(e);return this.maxValue!=null&&(r=na(r,0,this.maxValue)),r}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}wj.className="ReLU";Qe(wj);class Cj extends Pn{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const r=mn(e);return t8(r,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}Cj.className="LeakyReLU";Qe(Cj);class kj extends Pn{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=Lr(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=jr(e.alphaRegularizer),this.alphaConstraint=Ns(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new ue(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=Zn(e);const t=e.slice(1);if(this.sharedAxes!=null)for(const s of this.sharedAxes)t[s-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const r={};if(this.sharedAxes!=null)for(let s=1;s<e.length;++s)r[s]=e[s];this.inputSpec=[new Cs({ndim:e.length,axes:r})],this.built=!0}call(e,t){return e=mn(e),a8(e,this.alpha.read())}getConfig(){const e={alphaInitializer:Wr(this.alphaInitializer),alphaRegularizer:Cr(this.alphaRegularizer),alphaConstraint:Ss(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}kj.className="PReLU";Qe(kj);let Sj=class extends Pn{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new Tn(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const r=mn(e);return Xb(r)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}};Sj.className="ELU";Qe(Sj);class Nj extends Pn{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,t){const r=mn(e);return fe(r,It(sa(r,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}Nj.className="ThresholdedReLU";Qe(Nj);class Ej extends Pn{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new lN().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,t){return Ne(()=>{let r=mn(e);const s=t.mask;if(s!=null){const o=fe(hn(kd(r.shape),It(s,r.dtype)),ar(-1e9));r=ot(r,o)}return this.axis instanceof Array?this.axis.length>1?lc(hn(r,mM(r,this.axis,!0))):this.softmax(r,this.axis[0]):this.softmax(r,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}Ej.className="Softmax";Qe(Ej);function xp(n,e,t){if(typeof n=="number")return Pf(n,e);if(n.length!==e)throw new ue(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${n.length} elements.`);for(let r=0;r<e;++r){const s=n[r];if(!t1e(s))throw new ue(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(n)} including a non-integer number ${s}`)}return n}function ll(n,e,t,r,s=1){if(n==null)return n;const o=e+(e-1)*(s-1);let i;return t==="same"?i=n:i=n-o+1,Math.floor((i+r-1)/r)}function Bl(n,e,t,r){if(n==null)return null;if(r==="valid")n=n*e+cd([t-e,0]);else if(r==="same")n=n*e;else throw new ue(`Unsupport padding mode: ${r}.`);return n}function cN(n,e){return Ne(()=>(is(e),e==="channelsFirst"?Hn(n,[0,2,3,1]):n))}function Ij(n,e){return Ne(()=>(is(e),e==="channelsFirst"?Hn(n,[0,2,3,4,1]):n))}function w0e(n,e,t,r=1,s="valid",o,i=1){return Ne(()=>{if(o==null&&(o=fl()),is(o),n.shape.length!==3)throw new ue(`The input of a conv1dWithBias operation should be 3, but is ${n.shape.length} instead.`);if(e.shape.length!==3)throw new ue(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(t!=null&&t.shape.length!==1)throw new ue(`The bias for a conv1dWithBias operation should be 1, but is ${t.shape.length} instead`);if(o==="channelsFirst"&&(n=Hn(n,[0,2,1])),s==="causal")throw new Tn("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=sM(n,e,r,s==="same"?"same":"valid","NWC",i);return t!=null&&(a=xl(a,t)),a})}function G_(n,e,t,r=[1,1],s="valid",o,i,a=null){return Ne(()=>{if(o==null&&(o=fl()),is(o),n.rank!==3&&n.rank!==4)throw new ue(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${n.rank}.`);if(e.rank!==3&&e.rank!==4)throw new ue(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${n.rank}.`);let l=cN(n,o);if(s==="causal")throw new Tn("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=Rhe({x:l,filter:e,strides:r,pad:s==="same"?"same":"valid",dilations:i,dataFormat:"NHWC",bias:t,activation:a}),o==="channelsFirst"&&(l=Hn(l,[0,3,1,2])),l})}function C0e(n,e,t,r=[1,1,1],s="valid",o,i){return Ne(()=>{if(o==null&&(o=fl()),is(o),n.rank!==4&&n.rank!==5)throw new ue(`conv3dWithBias expects input to be of rank 4 or 5, but received ${n.rank}.`);if(e.rank!==4&&e.rank!==5)throw new ue(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${n.rank}.`);let a=Ij(n,o);if(s==="causal")throw new Tn("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=Iue(a,e,r,s==="same"?"same":"valid","NDHWC",i),t!=null&&(a=xl(a,t)),o==="channelsFirst"&&(a=Hn(a,[0,4,1,2,3])),a})}class aw extends Pn{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",aw.verifyArgs(t),this.rank=e,Os(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new Tn(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=xp(t.kernelSize,e,"kernelSize"),this.strides=xp(t.strides==null?1:t.strides,e,"strides"),this.padding=t.padding==null?"valid":t.padding,oa(this.padding),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,is(this.dataFormat),this.activation=dd(t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.biasInitializer=Lr(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=Ns(t.biasConstraint),this.biasRegularizer=jr(t.biasRegularizer),this.activityRegularizer=jr(t.activityRegularizer),this.dilationRate=xp(t.dilationRate==null?1:t.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new ue(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new ue(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new ue(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(jl("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!X8(e.kernelSize,"number",1,3))throw new ue(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:ud(this.activation),useBias:this.useBias,biasInitializer:Wr(this.biasInitializer),biasRegularizer:Cr(this.biasRegularizer),activityRegularizer:Cr(this.activityRegularizer),biasConstraint:Ss(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class rm extends aw{constructor(e,t){super(e,t),this.kernel=null,rm.verifyArgs(t),this.filters=t.filters,Os(this.filters,"filters"),this.kernelInitializer=Lr(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=Ns(t.kernelConstraint),this.kernelRegularizer=jr(t.kernelRegularizer)}build(e){e=Zn(e);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new ue(`The channel dimension of the input should be defined. Found ${e[t]}`);const r=e[t],s=this.kernelSize.concat([r,this.filters]);this.kernel=this.addWeight("kernel",s,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:r}}],this.built=!0}call(e,t){return Ne(()=>{e=mn(e);let r;const s=this.bias==null?null:this.bias.read(),o=kL(this.activation.getClassName());if(o!=null&&this.rank===2)r=G_(e,this.kernel.read(),s,this.strides,this.padding,this.dataFormat,this.dilationRate,o);else{if(this.rank===1)r=w0e(e,this.kernel.read(),s,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)r=G_(e,this.kernel.read(),s,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)r=C0e(e,this.kernel.read(),s,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new Tn("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(r=this.activation.apply(r))}return r})}computeOutputShape(e){e=Zn(e);const t=[],r=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let o=0;o<r.length;++o){const i=ll(r[o],this.kernelSize[o],this.padding,this.strides[o],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[o]);t.push(i)}let s=[e[0]];return this.dataFormat==="channelsLast"?(s=s.concat(t),s.push(this.filters)):(s.push(this.filters),s=s.concat(t)),s}getConfig(){const e={filters:this.filters,kernelInitializer:Wr(this.kernelInitializer),kernelRegularizer:Cr(this.kernelRegularizer),kernelConstraint:Ss(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new ue(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class b0 extends rm{constructor(e){super(2,e),b0.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!X8(e.kernelSize,"number",1,2))throw new ue(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}b0.className="Conv2D";Qe(b0);class w0 extends rm{constructor(e){super(3,e),w0.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new ue(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}w0.className="Conv3D";Qe(w0);class Tj extends b0{constructor(e){if(super(e),this.inputSpec=[new Cs({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new ue(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Zn(e),e.length!==4)throw new ue("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new ue("The channel dimension of the inputs should be defined. Found `None`.");const r=e[t],s=this.kernelSize.concat([this.filters,r]);this.kernel=this.addWeight("kernel",s,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Cs({ndim:4,axes:{[t]:r}})],this.built=!0}call(e,t){return Ne(()=>{let r=mn(e);if(r.shape.length!==4)throw new ue(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${r.shape.length}`);const s=r.shape,o=s[0];let i,a;this.dataFormat==="channelsFirst"?(i=2,a=3):(i=1,a=2);const l=s[i],c=s[a],u=this.kernelSize[0],d=this.kernelSize[1],f=this.strides[0],p=this.strides[1],x=Bl(l,f,u,this.padding),v=Bl(c,p,d,this.padding),y=[o,x,v,this.filters];this.dataFormat!=="channelsLast"&&(r=Hn(r,[0,2,3,1]));let b=oM(r,this.kernel.read(),y,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(b=Hn(b,[0,3,1,2])),this.bias!=null&&(b=xl(b,this.bias.read(),this.dataFormat)),this.activation!=null&&(b=this.activation.apply(b)),b})}computeOutputShape(e){e=Zn(e);const t=e.slice();let r,s,o;this.dataFormat==="channelsFirst"?(r=1,s=2,o=3):(r=3,s=1,o=2);const i=this.kernelSize[0],a=this.kernelSize[1],l=this.strides[0],c=this.strides[1];return t[r]=this.filters,t[s]=Bl(t[s],l,i,this.padding),t[o]=Bl(t[o],c,a,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}Tj.className="Conv2DTranspose";Qe(Tj);class _j extends w0{constructor(e){if(super(e),this.inputSpec=[new Cs({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new ue(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Zn(e),e.length!==5)throw new ue("Input should have rank 5; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new ue("The channel dimension of the inputs should be defined. Found `None`.");const r=e[t],s=this.kernelSize.concat([this.filters,r]);this.kernel=this.addWeight("kernel",s,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Cs({ndim:5,axes:{[t]:r}})],this.built=!0}call(e,t){return Ne(()=>{let r=mn(e);if(r.shape.length!==5)throw new ue(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${r.shape.length}`);const s=r.shape,o=s[0];let i,a,l;this.dataFormat==="channelsFirst"?(l=2,i=3,a=4):(l=1,i=2,a=3);const c=s[l],u=s[i],d=s[a],f=this.kernelSize[0],p=this.kernelSize[1],x=this.kernelSize[2],v=this.strides[0],y=this.strides[1],b=this.strides[2],w=Bl(c,v,f,this.padding),S=Bl(u,y,p,this.padding),k=Bl(d,b,x,this.padding),N=[o,w,S,k,this.filters];this.dataFormat!=="channelsLast"&&(r=Hn(r,[0,2,3,4,1]));let I=Rue(r,this.kernel.read(),N,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(I=Hn(I,[0,4,1,2,3])),this.bias!==null&&(I=xl(I,this.bias.read(),this.dataFormat)),this.activation!==null&&(I=this.activation.apply(I)),I})}computeOutputShape(e){e=Zn(e);const t=e.slice();let r,s,o,i;this.dataFormat==="channelsFirst"?(r=1,s=2,o=3,i=4):(r=4,s=1,o=2,i=3);const a=this.kernelSize[0],l=this.kernelSize[1],c=this.kernelSize[2],u=this.strides[0],d=this.strides[1],f=this.strides[2];return t[r]=this.filters,t[s]=Bl(t[s],u,a,this.padding),t[o]=Bl(t[o],d,l,this.padding),t[i]=Bl(t[i],f,c,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}_j.className="Conv3DTranspose";Qe(_j);class Rj extends rm{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,t.filters==null)throw new ue("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(t.kernelInitializer!=null||t.kernelRegularizer!=null||t.kernelConstraint!=null)throw new ue("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(t.padding!=null&&t.padding!=="same"&&t.padding!=="valid")throw new ue(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(t.padding)}`);this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=Lr(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=jr(t.depthwiseRegularizer),this.depthwiseConstraint=Ns(t.depthwiseConstraint),this.pointwiseInitializer=Lr(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=jr(t.pointwiseRegularizer),this.pointwiseConstraint=Ns(t.pointwiseConstraint)}build(e){if(e=Zn(e),e.length<this.rank+2)throw new ue(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null||e[t]<0)throw new ue(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[t])}`);const r=e[t],s=this.kernelSize.concat([r,this.depthMultiplier]),o=[];for(let a=0;a<this.rank;++a)o.push(1);o.push(r*this.depthMultiplier,this.filters);const i=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",s,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,i,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",o,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,i,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,i,this.biasConstraint):this.bias=null,this.inputSpec=[new Cs({ndim:this.rank+2,axes:{[t]:r}})],this.built=!0}call(e,t){return Ne(()=>{e=mn(e);let r;if(this.rank===1)throw new Tn("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=Hn(e,[0,2,3,1])),r=kM(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(r=xl(r,this.bias.read(),this.dataFormat)),this.activation!=null&&(r=this.activation.apply(r)),this.dataFormat==="channelsFirst"&&(r=Hn(r,[0,3,1,2])),r})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Wr(this.depthwiseInitializer),e.pointwiseInitializer=Wr(this.pointwiseInitializer),e.depthwiseRegularizer=Cr(this.depthwiseRegularizer),e.pointwiseRegularizer=Cr(this.pointwiseRegularizer),e.depthwiseConstraint=Ss(this.depthwiseConstraint),e.pointwiseConstraint=Ss(this.pointwiseConstraint),e}}Rj.className="SeparableConv";class Dj extends Rj{constructor(e){super(2,e)}}Dj.className="SeparableConv2D";Qe(Dj);class lw extends rm{constructor(e){super(1,e),lw.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!X8(e.kernelSize,"number",1,1))throw new ue(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}lw.className="Conv1D";Qe(lw);class Aj extends Pn{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return Ne(()=>{if(e=mn(e),this.dataFormat==="channelsLast"){const r=vv(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return vv(r,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const r=vv(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return vv(r,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}Aj.className="Cropping2D";Qe(Aj);class $j extends Pn{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,is(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,Jge(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const t=e[2]==null?null:this.size[0]*e[2],r=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],t,r]}else{const t=e[1]==null?null:this.size[0]*e[1],r=e[2]==null?null:this.size[1]*e[2];return[e[0],t,r,e[3]]}}call(e,t){return Ne(()=>{let r=mn(e);const s=r.shape;if(this.dataFormat==="channelsFirst"){r=Hn(r,[0,2,3,1]);const o=this.size[0]*s[2],i=this.size[1]*s[3],a=this.interpolation==="nearest"?Mc.resizeNearestNeighbor(r,[o,i]):Mc.resizeBilinear(r,[o,i]);return Hn(a,[0,3,1,2])}else{const o=this.size[0]*s[1],i=this.size[1]*s[2];return this.interpolation==="nearest"?Mc.resizeNearestNeighbor(r,[o,i]):Mc.resizeBilinear(r,[o,i])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}}$j.className="UpSampling2D";Qe($j);function k0e(n,e,t=[1,1],r="valid",s,o){return Ne(()=>{s==null&&(s=fl()),is(s);let i=cN(n,s);if(n.rank!==4)throw new ue(`Input for depthwiseConv2d is required to be 4-D, but is instead ${n.rank}-D`);if(e.rank!==4)throw new ue(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return i=ZS(i,e,t,r==="same"?"same":"valid","NHWC",o),s==="channelsFirst"&&(i=Hn(i,[0,3,1,2])),i})}class Fj extends aw{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=Lr(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=Ns(e.depthwiseConstraint),this.depthwiseRegularizer=jr(e.depthwiseRegularizer)}build(e){if(e=Zn(e),e.length<4)throw new ue(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const t=this.dataFormat==="channelsFirst"?1:3;if(e[t]==null||e[t]<0)throw new ue(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[t]}).`);const r=e[t],s=[this.kernelSize[0],this.kernelSize[1],r,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",s,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[r*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return Ne(()=>{e=mn(e);let r=k0e(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(r=xl(r,this.bias.read(),this.dataFormat)),this.activation!=null&&(r=this.activation.apply(r)),r})}computeOutputShape(e){e=Zn(e);const t=this.dataFormat==="channelsFirst"?e[2]:e[1],r=this.dataFormat==="channelsFirst"?e[3]:e[2],s=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,o=ll(t,this.kernelSize[0],this.padding,this.strides[0]),i=ll(r,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],s,o,i]:[e[0],o,i,s]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Wr(this.depthwiseInitializer),e.depthwiseRegularizer=Cr(this.depthwiseRegularizer),e.depthwiseConstraint=Ss(this.depthwiseRegularizer),e}}Fj.className="DepthwiseConv2D";Qe(Fj);function Pj(n,e,t,r){if(Array.isArray(n)){if(e!=null||t!=null)throw new ue("When inputs is an array, neither initialState or constants should be provided");r!=null&&(t=n.slice(n.length-r,n.length),n=n.slice(0,n.length-r)),n.length>1&&(e=n.slice(1,n.length)),n=n[0]}function s(o){return o==null||Array.isArray(o)?o:[o]}return e=s(e),t=s(t),{inputs:n,initialState:e,constants:t}}function Oj(n,e,t,r=!1,s,o,i=!1,a=!1){return Ne(()=>{const l=e.shape.length;if(l<3)throw new ue(`Input should be at least 3D, but is ${l}D.`);const c=[1,0].concat(dl(2,l));e=Hn(e,c),i&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),s!=null&&(s=It(It(s,"bool"),"float32"),s.rank===l-1&&(s=Jo(s,-1)),s=Hn(s,c)),r&&(e=$f(e,0),s!=null&&(s=$f(s,0)));const u=[];let d,f=t;const p=e.shape[0],x=Ff(e);let v;s!=null&&(v=Ff(s));for(let b=0;b<p;++b){const w=x[b],S=Ne(()=>n(w,f));if(s==null)d=S[0],f=S[1];else{const k=Ne(()=>{const N=v[b],I=hn(Ra(N),N),T=ot(fe(S[0],N),fe(f[0],I)),F=f.map((R,D)=>ot(fe(S[1][D],N),fe(R,I)));return{output:T,newStates:F}});d=k.output,f=k.newStates}a&&u.push(d)}let y;return a&&(y=Uc(u,1)),[d,y,f]})}class Nd extends Pn{constructor(e){super(e);let t;if(e.cell==null)throw new ue("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?t=new fN({cells:e.cell}):t=e.cell,t.stateSize==null)throw new ue("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new Cs({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return dl(0,e).map(t=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){Z5(e)&&(e=e[0]),e=e;let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const r=t[0];let s;if(this.returnSequences?s=[e[0],e[1],r]:s=[e[0],r],this.returnState){const o=[];for(const i of t)o.push([e[0],i]);return[s].concat(o)}else return s}computeMask(e,t){return Ne(()=>{Array.isArray(t)&&(t=t[0]);const r=this.returnSequences?t:null;if(this.returnState){const s=this.states.map(o=>null);return[r].concat(s)}else return r})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let r=0;r<e;++r)t.push(null);return t}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new Tn("Constants support is not implemented in RNN yet.");Z5(e)&&(e=e[0]),e=e;const t=this.stateful?e[0]:null,r=e.slice(2);this.inputSpec[0]=new Cs({shape:[t,null,...r]});const s=[e[0]].concat(e.slice(2));this.cell.build(s);let o;if(Array.isArray(this.cell.stateSize)?o=this.cell.stateSize:o=[this.cell.stateSize],this.stateSpec!=null){if(!lr(this.stateSpec.map(i=>i.shape[i.shape.length-1]),o))throw new ue(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=o.map(i=>new Cs({shape:[null,i]}));this.stateful&&this.resetStates()}resetStates(e,t=!1){Ne(()=>{if(!this.stateful)throw new Ll("Cannot call resetStates() on an RNN Layer that is not stateful.");const r=this.inputSpec[0].shape[0];if(r==null)throw new ue("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(s=>Ps([r,s])):this.states_=[Ps([r,this.cell.stateSize])];else if(e==null)Mn(this.states_),this.keptStates!=null&&(Mn(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(s=>Ps([r,s])):this.states_[0]=Ps([r,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new ue(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t===!0?this.keptStates.push(this.states_.slice()):Mn(this.states_);for(let s=0;s<this.states_.length;++s){const o=e[s],i=Array.isArray(this.cell.stateSize)?this.cell.stateSize[s]:this.cell.stateSize,a=[r,i];if(!lr(o.shape,a))throw new ue(`State ${s} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${o.shape}`);this.states_[s]=o}}this.states_=this.states_.map(s=>ec(s.clone()))})}apply(e,t){let r=t==null?null:t.initialState,s=t==null?null:t.constants;t==null&&(t={});const o=Pj(e,r,s,this.numConstants);e=o.inputs,r=o.initialState,s=o.constants;let i=[],a=[];if(r!=null){t.initialState=r,i=i.concat(r),this.stateSpec=[];for(const c of r)this.stateSpec.push(new Cs({shape:c.shape}));a=a.concat(this.stateSpec)}if(s!=null&&(t.constants=s,i=i.concat(s),this.numConstants=s.length),i[0]instanceof uc){const c=[e].concat(i),u=this.inputSpec.concat(a),d=this.inputSpec;this.inputSpec=u;const f=super.apply(c,t);return this.inputSpec=d,f}else return super.apply(e,t)}call(e,t){return Ne(()=>{const r=t==null?null:t.mask,s=t==null?null:t.training;let o=t==null?null:t.initialState;e=mn(e),o==null&&(this.stateful?o=this.states_:o=this.getInitialState(e));const i=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(o.length!==i)throw new ue(`RNN Layer has ${i} state(s) but was passed ${o.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:s},c=Oj((x,v)=>{const y=this.cell.call([x].concat(v),a);return[y[0],y.slice(1)]},e,o,this.goBackwards,r,null,this.unroll,this.returnSequences),u=c[0],d=c[1],f=c[2];this.stateful&&this.resetStates(f,s);const p=this.returnSequences?d:u;return this.returnState?[p].concat(f):p})}getInitialState(e){return Ne(()=>{let t=Ps(e.shape);return t=on(t,[1,2]),t=m0(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(r=>r>1?X5(t,[1,r]):t):this.cell.stateSize>1?[X5(t,[1,this.cell.stateSize])]:[t]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(t.numConstants=this.numConstants);const r=this.cell.getConfig();return this.getClassName()===Nd.className&&(t.cell={className:this.cell.getClassName(),config:r}),Object.assign(Object.assign(Object.assign({},r),e),t)}static fromConfig(e,t,r={}){const s=t.cell,o=Lc(s,r);return new e(Object.assign(t,{cell:o}))}}Nd.className="RNN";Qe(Nd);class cw extends Pn{}class uN extends cw{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Os(this.units,"units"),this.activation=dd(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Lr(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Lr(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Lr(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=jr(e.kernelRegularizer),this.recurrentRegularizer=jr(e.recurrentRegularizer),this.biasRegularizer=jr(e.biasRegularizer),this.kernelConstraint=Ns(e.kernelConstraint),this.recurrentConstraint=Ns(e.recurrentConstraint),this.biasConstraint=Ns(e.biasConstraint),this.dropout=Fp([1,cd([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Fp([1,cd([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Zn(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return Ne(()=>{if(e=e,e.length!==2)throw new ue(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let r=e[1];e=e[0];const s=t.training==null?!1:t.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=fd({ones:()=>Ra(e),rate:this.dropout,training:s,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=fd({ones:()=>Ra(r),rate:this.recurrentDropout,training:s,dropoutFunc:this.dropoutFunc}));let o;const i=this.dropoutMask,a=this.recurrentDropoutMask;i!=null?o=rc(fe(e,i),this.kernel.read()):o=rc(e,this.kernel.read()),this.bias!=null&&(o=xl(o,this.bias.read())),a!=null&&(r=fe(r,a));let l=ot(o,rc(r,this.recurrentKernel.read()));return this.activation!=null&&(l=this.activation.apply(l)),[l,l]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:ud(this.activation),useBias:this.useBias,kernelInitializer:Wr(this.kernelInitializer),recurrentInitializer:Wr(this.recurrentInitializer),biasInitializer:Wr(this.biasInitializer),kernelRegularizer:Cr(this.kernelRegularizer),recurrentRegularizer:Cr(this.recurrentRegularizer),biasRegularizer:Cr(this.biasRegularizer),activityRegularizer:Cr(this.activityRegularizer),kernelConstraint:Ss(this.kernelConstraint),recurrentConstraint:Ss(this.recurrentConstraint),biasConstraint:Ss(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}uN.className="SimpleRNNCell";Qe(uN);class Mj extends Nd{constructor(e){e.cell=new uN(e),super(e)}call(e,t){return Ne(()=>{this.cell.dropoutMask!=null&&(Mn(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Mn(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=t==null?null:t.mask,s=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:r,training:s,initialState:o})})}static fromConfig(e,t){return new e(t)}}Mj.className="SimpleRNN";Qe(Mj);class dN extends cw{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new ue("GRUCell does not support reset_after parameter set to true.");this.units=e.units,Os(this.units,"units"),this.activation=dd(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=dd(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Lr(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Lr(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Lr(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=jr(e.kernelRegularizer),this.recurrentRegularizer=jr(e.recurrentRegularizer),this.biasRegularizer=jr(e.biasRegularizer),this.kernelConstraint=Ns(e.kernelConstraint),this.recurrentConstraint=Ns(e.recurrentConstraint),this.biasConstraint=Ns(e.biasConstraint),this.dropout=Fp([1,cd([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Fp([1,cd([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Zn(e);const t=e[e.length-1];this.kernel=this.addWeight("kernel",[t,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return Ne(()=>{if(e=e,e.length!==2)throw new ue(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const r=t.training==null?!1:t.training;let s=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=fd({ones:()=>Ra(e),rate:this.dropout,training:r,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=fd({ones:()=>Ra(s),rate:this.recurrentDropout,training:r,count:3,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,i=this.recurrentDropoutMask;let a,l,c;0<this.dropout&&this.dropout<1&&(e=fe(e,o[0]));let u=rc(e,this.kernel.read());this.useBias&&(u=xl(u,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(s=fe(s,i[0]));const d=this.recurrentKernel.read(),[f,p]=ea(d,[2*this.units,this.units],d.rank-1),x=rc(s,f),[v,y,b]=ea(u,3,u.rank-1),[w,S]=ea(x,2,x.rank-1);a=this.recurrentActivation.apply(ot(v,w)),l=this.recurrentActivation.apply(ot(y,S));const k=rc(fe(l,s),p);c=this.activation.apply(ot(b,k));const N=ot(fe(a,s),fe(ot(1,rs(a)),c));return[N,N]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:ud(this.activation),recurrentActivation:ud(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Wr(this.kernelInitializer),recurrentInitializer:Wr(this.recurrentInitializer),biasInitializer:Wr(this.biasInitializer),kernelRegularizer:Cr(this.kernelRegularizer),recurrentRegularizer:Cr(this.recurrentRegularizer),biasRegularizer:Cr(this.biasRegularizer),activityRegularizer:Cr(this.activityRegularizer),kernelConstraint:Ss(this.kernelConstraint),recurrentConstraint:Ss(this.recurrentConstraint),biasConstraint:Ss(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}dN.className="GRUCell";Qe(dN);class Lj extends Nd{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new dN(e),super(e)}call(e,t){return Ne(()=>{this.cell.dropoutMask!=null&&(Mn(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Mn(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=t==null?null:t.mask,s=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:r,training:s,initialState:o})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}Lj.className="GRU";Qe(Lj);class uw extends cw{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Os(this.units,"units"),this.activation=dd(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=dd(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Lr(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Lr(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Lr(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=jr(e.kernelRegularizer),this.recurrentRegularizer=jr(e.recurrentRegularizer),this.biasRegularizer=jr(e.biasRegularizer),this.kernelConstraint=Ns(e.kernelConstraint),this.recurrentConstraint=Ns(e.recurrentConstraint),this.biasConstraint=Ns(e.biasConstraint),this.dropout=Fp([1,cd([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Fp([1,cd([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;e=Zn(e);const r=e[e.length-1];this.kernel=this.addWeight("kernel",[r,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let s;if(this.useBias){if(this.unitForgetBias){const o=this.biasInitializer,i=this.units;s=new(t=class extends Fa{apply(l,c){const u=o.apply([i]),d=new Z8().apply([i]),f=o.apply([i*2]);return __(__(u,d),f)}},t.className="CustomInit",t)}else s=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,s,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return Ne(()=>{const r=t.training==null?!1:t.training;if(e=e,e.length!==3)throw new ue(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let s=e[1];const o=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=fd({ones:()=>Ra(e),rate:this.dropout,training:r,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=fd({ones:()=>Ra(s),rate:this.recurrentDropout,training:r,count:4,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,a=this.recurrentDropoutMask;let l,c,u,d;0<this.dropout&&this.dropout<1&&(e=fe(e,i[0]));let f=rc(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(s=fe(s,a[0])),f=ot(f,rc(s,this.recurrentKernel.read())),this.useBias&&(f=xl(f,this.bias.read()));const[p,x,v,y]=ea(f,4,f.rank-1);l=this.recurrentActivation.apply(p),c=this.recurrentActivation.apply(x),u=ot(fe(c,o),fe(l,this.activation.apply(v))),d=this.recurrentActivation.apply(y);const b=fe(d,this.activation.apply(u));return[b,b,u]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:ud(this.activation),recurrentActivation:ud(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Wr(this.kernelInitializer),recurrentInitializer:Wr(this.recurrentInitializer),biasInitializer:Wr(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Cr(this.kernelRegularizer),recurrentRegularizer:Cr(this.recurrentRegularizer),biasRegularizer:Cr(this.biasRegularizer),activityRegularizer:Cr(this.activityRegularizer),kernelConstraint:Ss(this.kernelConstraint),recurrentConstraint:Ss(this.recurrentConstraint),biasConstraint:Ss(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}uw.className="LSTMCell";Qe(uw);class jj extends Nd{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new uw(e),super(e)}call(e,t){return Ne(()=>{this.cell.dropoutMask!=null&&(Mn(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Mn(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=t==null?null:t.mask,s=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:r,training:s,initialState:o})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}jj.className="LSTM";Qe(jj);class fN extends cw{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return Ne(()=>{e=e;let r=e.slice(1);const s=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?s.push(r.splice(0,a.stateSize.length)):s.push(r.splice(0,1));s.reverse();const o=[];let i;for(let a=0;a<this.cells.length;++a){const l=this.cells[a];r=s[a],a===0?i=[e[0]].concat(r):i=[i[0]].concat(r),i=l.call(i,t),o.push(i.slice(1))}r=[];for(const a of o.slice().reverse())r.push(...a);return[i[0]].concat(r)})}build(e){Z5(e)&&(e=e[0]),e=e;let t;this.cells.forEach((r,s)=>{xf(`RNNCell_${s}`,()=>{r.build(e),Array.isArray(r.stateSize)?t=r.stateSize[0]:t=r.stateSize,e=[e[0],t]})}),this.built=!0}getConfig(){const e=super.getConfig(),t=o=>({className:o.getClassName(),config:o.getConfig()}),s={cells:this.cells.map(t)};return Object.assign(Object.assign({},e),s)}static fromConfig(e,t,r={}){const s=[];for(const o of t.cells)s.push(Lc(o,r));return new e({cells:s})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const r of this.cells)t.push(...r.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return J5(e)}setWeights(e){const t=[];for(const r of this.cells){const s=r.weights.length,o=e.splice(s);for(let i=0;i<r.weights.length;++i)t.push([r.weights[i],o[i]])}sN(t)}}fN.className="StackedRNNCells";Qe(fN);function fd(n){const{ones:e,rate:t,training:r=!1,count:s=1,dropoutFunc:o}=n,i=()=>o!=null?o(e(),t):RL(e(),t),a=()=>x0(i,e,r);return!s||s<=1?ec(a().clone()):Array(s).fill(void 0).map(a).map(c=>ec(c.clone()))}var S0e=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};class Bj extends Nd{constructor(e){if(e.unroll)throw new Tn("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new Tn("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new Cs({ndim:5})]}call(e,t){return Ne(()=>{if(this.cell.dropoutMask!=null&&(Mn(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Mn(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new ue("ConvRNN2D cell does not support constants");const r=t==null?null:t.mask,s=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:r,training:s,initialState:o})})}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return Ne(()=>{const{stateSize:t}=this.cell,r=e.shape,s=this.computeSingleOutputShape(r),o=[s[0],...s.slice(2)],i=Ps(o);return Array.isArray(t)?Array(t.length).fill(i):[i]})}resetStates(e,t=!1){Ne(()=>{if(!this.stateful)throw new Ll("Cannot call resetStates() on an RNN Layer that is not stateful.");const r=this.inputSpec[0].shape,s=this.computeSingleOutputShape(r),o=[s[0],...s.slice(2)];if(r[0]==null)throw new ue("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Ps(o)):this.states_=[Ps(o)];else if(e==null)Mn(this.states_),this.keptStates!=null&&(Mn(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Ps(o)):this.states_[0]=Ps(o);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new ue(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t?this.keptStates.push(this.states_.slice()):Mn(this.states_);for(let a=0;a<this.states_.length;++a){const l=e[a],c=o;if(!lr(l.shape,c))throw new ue(`State ${a} is incompatible with layer ${this.name}: expected shape=${c}, received shape=${l.shape}`);this.states_[a]=l}}this.states_=this.states_.map(a=>ec(a.clone()))})}computeSingleOutputShape(e){const{dataFormat:t,filters:r,kernelSize:s,padding:o,strides:i,dilationRate:a}=this.cell,l=t==="channelsFirst",c=e[l?3:2],u=e[l?4:3],d=ll(c,s[0],o,i[0],a[0]),f=ll(u,s[1],o,i[1],a[1]);return[...e.slice(0,2),...l?[r,d,f]:[d,f,r]]}}Bj.className="ConvRNN2D";class hN extends uw{constructor(e){const{filters:t,kernelSize:r,strides:s,padding:o,dataFormat:i,dilationRate:a}=e;super(Object.assign(Object.assign({},e),{units:t})),this.filters=t,Os(this.filters,"filters"),this.kernelSize=xp(r,2,"kernelSize"),this.kernelSize.forEach(l=>Os(l,"kernelSize")),this.strides=xp(s||1,2,"strides"),this.strides.forEach(l=>Os(l,"strides")),this.padding=o||"valid",oa(this.padding),this.dataFormat=i||"channelsLast",is(this.dataFormat),this.dilationRate=xp(a||1,2,"dilationRate"),this.dilationRate.forEach(l=>Os(l,"dilationRate"))}build(e){var t;e=Zn(e);const r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null)throw new ue(`The channel dimension of the input should be defined. Found ${e[r]}`);const s=e[r],o=4,i=this.kernelSize.concat([s,this.filters*o]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*o]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let l;if(this.unitForgetBias){const c=this.biasInitializer,u=this.filters;l=new(t=class extends Fa{apply(f,p){const x=c.apply([u]),v=kd([u]),y=c.apply([u*2]);return Y8([x,v,y])}},t.className="CustomInit",t)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*o],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return Ne(()=>{if(e.length!==3)throw new ue(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const r=t.training||!1,s=e[0],o=e[1],i=e[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=fd({ones:()=>Ra(s),rate:this.dropout,training:r,count:a,dropoutFunc:this.dropoutFunc}));const l=this.dropoutMask,c=(z,V,K)=>!V||!V[K]?z:fe(V[K],z);let u=c(s,l,0),d=c(s,l,1),f=c(s,l,2),p=c(s,l,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=fd({ones:()=>Ra(o),rate:this.recurrentDropout,training:r,count:a,dropoutFunc:this.dropoutFunc}));const x=this.recurrentDropoutMask;let v=c(o,x,0),y=c(o,x,1),b=c(o,x,2),w=c(o,x,3);const S=3,[k,N,I,T]=ea(this.kernel.read(),a,S),[F,R,D,A]=this.useBias?ea(this.bias.read(),a):[null,null,null,null];u=this.inputConv(u,k,F,this.padding),d=this.inputConv(d,N,R,this.padding),f=this.inputConv(f,I,D,this.padding),p=this.inputConv(p,T,A,this.padding);const[P,B,L,W]=ea(this.recurrentKernel.read(),a,S);v=this.recurrentConv(v,P),y=this.recurrentConv(y,B),b=this.recurrentConv(b,L),w=this.recurrentConv(w,W);const H=this.recurrentActivation.apply(ot(u,v)),G=this.recurrentActivation.apply(ot(d,y)),M=ot(fe(G,i),fe(H,this.activation.apply(ot(f,b)))),j=fe(this.recurrentActivation.apply(ot(p,w)),this.activation.apply(M));return[j,j,M]})}getConfig(){const e=super.getConfig(),{units:t}=e,r=S0e(e,["units"]),s={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},r),s)}inputConv(e,t,r,s){const o=Df(e,t,this.strides,s||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return r?xl(o,r,this.dataFormat):o}recurrentConv(e,t){return Df(e,t,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}hN.className="ConvLSTM2DCell";Qe(hN);class Vj extends Bj{constructor(e){const t=new hN(e);super(Object.assign(Object.assign({},e),{cell:t}))}static fromConfig(e,t){return new e(t)}}Vj.className="ConvLSTM2D";Qe(Vj);class pN extends Pn{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const t=e.shape,r=[];for(let s=0;s<this.noiseShape.length;++s)r.push(this.noiseShape[s]==null?t[s]:this.noiseShape[s]);return r}call(e,t){return Ne(()=>{this.invokeCallHook(e,t);const r=mn(e);if(0<this.rate&&this.rate<1){const s=t.training==null?!1:t.training,o=this.getNoiseShape(r);return x0(()=>RL(r,this.rate,o,this.seed),()=>r,s)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}pN.className="Dropout";Qe(pN);class zj extends pN{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}zj.className="SpatialDropout1D";Qe(zj);class Wj extends Pn{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let t=null;e.batchSize!=null&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,Os(this.units,"units"),this.activation=dd(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=Lr(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=Lr(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=Ns(e.kernelConstraint),this.biasConstraint=Ns(e.biasConstraint),this.kernelRegularizer=jr(e.kernelRegularizer),this.biasRegularizer=jr(e.biasRegularizer),this.activityRegularizer=jr(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=Zn(e);const t=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){e=Zn(e);const t=e.slice();return t[t.length-1]=this.units,t}call(e,t){return Ne(()=>{this.invokeCallHook(e,t);const r=mn(e),s=kL(this.activation.getClassName());let o;return s!=null?o=rc(r,this.kernel.read(),s,this.bias?this.bias.read():null):(o=rc(r,this.kernel.read()),this.bias!=null&&(o=xl(o,this.bias.read())),this.activation!=null&&(o=this.activation.apply(o))),o})}getConfig(){const e={units:this.units,activation:ud(this.activation),useBias:this.useBias,kernelInitializer:Wr(this.kernelInitializer),biasInitializer:Wr(this.biasInitializer),kernelRegularizer:Cr(this.kernelRegularizer),biasRegularizer:Cr(this.biasRegularizer),activityRegularizer:Cr(this.activityRegularizer),kernelConstraint:Ss(this.kernelConstraint),biasConstraint:Ss(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}Wj.className="Dense";Qe(Wj);class Uj extends Pn{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=Zn(e);for(const t of e.slice(1))if(t==null)throw new ue(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],td(e,1)]}call(e,t){return Ne(()=>{this.invokeCallHook(e,t);let r=mn(e);if(this.dataFormat==="channelsFirst"&&r.rank>1){const s=[0];for(let o=2;o<r.rank;++o)s.push(o);s.push(1),r=Hn(r,s)}return s1e(r)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}Uj.className="Flatten";Qe(Uj);class Hj extends Pn{constructor(e){super(e),this.supportsMasking=!0,this.activation=dd(e.activation)}call(e,t){return Ne(()=>{this.invokeCallHook(e,t);const r=mn(e);return this.activation.apply(r)})}getConfig(){const e={activation:ud(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}Hj.className="Activation";Qe(Hj);class Gj extends Pn{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return Ne(()=>(e=mn(e),n1e(e,this.n)))}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}Gj.className="RepeatVector";Qe(Gj);class qj extends Pn{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,t){const r="Total size of new array must be unchanged.",s=t.slice();let o=1,i=null;for(let l=0;l<s.length;++l){const c=s[l];if(this.isUnknown(c))if(i===null)i=l;else throw new ue("Can only specifiy one unknown dimension.");else o*=c}const a=td(e);if(i!==null){if(o===0||a%o!==0)throw new ue(r);s[i]=a/o}else if(a!==o)throw new ue(r);return s}computeOutputShape(e){let t=!1;for(let r=0;r<e.length;++r)if(this.isUnknown(e[r])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return Ne(()=>{this.invokeCallHook(e,t);const r=mn(e),s=r.shape,o=s.slice(0,1).concat(this.fixUnknownDimension(s.slice(1),this.targetShape));return ye(r,o)})}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}qj.className="Reshape";Qe(qj);class Kj extends Pn{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const t=dl(1,e.dims.length+1);if(!lr(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new Cs({ndim:this.dims.length+1})]}computeOutputShape(e){e=Zn(e);const t=e.slice();return this.dims.forEach((r,s)=>{t[s+1]=e[r]}),t}call(e,t){return Hn(mn(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}Kj.className="Permute";Qe(Kj);class Xj extends Pn{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const r=mn(e);return z5(B2(r,this.maskValue),-1)}call(e,t){return Ne(()=>{this.invokeCallHook(e,t);const r=mn(e),i=z5(B2(r,this.maskValue),-1,!0);return fe(r,It(i,r.dtype))})}}Xj.className="Masking";Qe(Xj);class Yj extends Pn{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let t=null;e.batchSize!=null&&(t=e.batchSize),e.inputLength==null?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(hr(e.inputLength))}this.inputDim=e.inputDim,Os(this.inputDim,"inputDim"),this.outputDim=e.outputDim,Os(this.outputDim,"outputDim"),this.embeddingsInitializer=Lr(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=jr(e.embeddingsRegularizer),this.activityRegularizer=jr(e.activityRegularizer),this.embeddingsConstraint=Ns(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return Ne(()=>this.maskZero?(e=mn(e),B2(e,Gn(e))):null)}computeOutputShape(e){if(e=Zn(e),this.inputLength==null)return[...e,this.outputDim];const t=hr(this.inputLength);if(t.length!==e.length-1)throw new ue(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let r=0;for(let s=0;s<t.length;++s){const o=t[s],i=e[s+1];if(o!=null&&i!=null&&o!==i)throw new ue(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);o==null&&(t[r]=i),r++}}return[e[0],...t,this.outputDim]}call(e,t){return Ne(()=>{this.invokeCallHook(e,t);let r=mn(e);r.dtype!=="int32"&&(r=nc(r,"int32"));const s=_L(this.embeddings.read(),ye(r,[r.size]));return ye(s,Zn(this.computeOutputShape(r.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Wr(this.embeddingsInitializer),embeddingsRegularizer:Cr(this.embeddingsRegularizer),activityRegularizer:Cr(this.activityRegularizer),embeddingsConstraint:Ss(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}Yj.className="Embedding";Qe(Yj);class Jf extends Pn{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new Tn}computeElementwiseOpOutputShape(e,t){if(e==null||t==null)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(t.length===0)return e;const r=e.slice(0,e.length-t.length);for(let s=0;s<t.length;++s){const o=e[e.length-t.length+s],i=t[s];if(o==null||i==null||o<0||i<0)r.push(null);else if(o===1)r.push(i);else if(i===1)r.push(o);else{if(o!==i)throw new ue("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));r.push(o)}}return r}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[Zn(e)]),e=e,e.length<2)throw new ue(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let t=[];for(const o of e)o!=null&&o[0]!==null&&t.push(o[0]);if(t=ed(t),t.length>1)throw new ue(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let r=e[0]==null?null:e[0].slice(1);for(let o=1;o<e.length;++o){const i=e[o]==null?null:e[o].slice(1);r=this.computeElementwiseOpOutputShape(r,i)}const s=e.map(o=>o.length);e.indexOf(null)===-1&&ed(s).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return Ne(()=>{if(e=e,this.reshapeRequired){const r=[],s=e.map(o=>o.rank);if(s.indexOf(null)===-1){const o=cd(s);for(let i of e){const a=i.rank;for(let l=0;l<o-a;++l)i=m0(i,1);r.push(i)}return this.mergeFunction(r)}else{let o=!1;for(const l of e){const c=l.rank;if(c==null){const u=l.shape,d=u[0],f=u.slice(1).concat([d]);let p=ye(l,[d].concat(td(u.slice(1))));p=Hn(p,[1,0]),p=ye(p,f),r.push(p),o=!0}else if(c>1){const u=dl(1,c).concat([0]);r.push(Hn(l,u)),o=!0}else r.push(l)}let i=this.mergeFunction(r);const a=i.rank;if(o){if(a==null){const l=i.shape,c=l.length,u=l[c-1],d=[u].concat(l.slice(0,l.length-1));i=ye(Hn(ye(i,[-1,u]),[1,0]),d)}else if(a>1){const l=[a-1].concat(dl(0,a-1));i=Hn(i,l)}}return i}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let t;e[0]==null?t=null:t=e[0].slice(1);for(let s=1;s<e.length;++s){const o=e[s]==null?null:e[s].slice(1);t=this.computeElementwiseOpOutputShape(t,o)}let r=[];for(const s of e)s!=null&&s[0]!==null&&r.push(s[0]);return r=ed(r),r.length===1?t=r.concat(t):t=[null].concat(t),t}computeMask(e,t){return Ne(()=>{if(t==null)return null;if(!Array.isArray(t))throw new ue("`mask` should be an Array");if(!Array.isArray(e))throw new ue("`inputs` should be an Array");if(t.length!==e.length)throw new ue(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${t.length})`);if(t.every(s=>s==null))return null;t=t.map(s=>s==null?s:Jo(s,0));let r=t[0];for(let s=1;s<t.length-1;++s)r=Wc(r,t[s]);return r})}}class Zj extends Jf{constructor(e){super(e)}mergeFunction(e){return Ne(()=>{let t=e[0].clone();for(let r=1;r<e.length;++r)t=ot(t,e[r]);return t})}}Zj.className="Add";Qe(Zj);class Jj extends Jf{constructor(e){super(e)}mergeFunction(e){return Ne(()=>{let t=e[0].clone();for(let r=1;r<e.length;++r)t=fe(t,e[r]);return t})}}Jj.className="Multiply";Qe(Jj);class Qj extends Jf{constructor(e){super(e)}mergeFunction(e){return Ne(()=>{let t=e[0].clone();for(let r=1;r<e.length;++r)t=ot(t,e[r]);return fe(1/e.length,t)})}}Qj.className="Average";Qe(Qj);class eB extends Jf{constructor(e){super(e)}mergeFunction(e){return Ne(()=>{let t=e[0];for(let r=1;r<e.length;++r)t=Cd(t,e[r]);return t})}}eB.className="Maximum";Qe(eB);class tB extends Jf{constructor(e){super(e)}mergeFunction(e){return Ne(()=>{let t=e[0];for(let r=1;r<e.length;++r)t=Mg(t,e[r]);return t})}}tB.className="Minimum";Qe(tB);class nB extends Jf{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new ue("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let t=!0;for(const s of e)if(s!=null){t=!1;break}if(t)return;const r=[];for(let s=0;s<e.length;++s){const o=e[s].slice();o.splice(this.axis,1);let i=!1;for(const a of r)if(lr(a,o)){i=!0;break}i||r.push(o)}if(r.length>1)throw new ue("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return Ne(()=>Y8(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new ue("A `Concatenate` layer should be called on a list of inputs.");const t=e,r=t[0].slice(),s=this.axis<0?r.length+this.axis:this.axis;for(const o of t.slice(1)){if(r[s]==null||o[s]==null){r[s]=null;break}r[s]+=o[s]}return r}computeMask(e,t){if(t==null)return null;if(!Array.isArray(t))throw new ue("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new ue("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new ue(`Mismatch in the length of mask (${t.length}) and the legnth of inputs (${e.length})`);return Ne(()=>{let r=!0;if(t.forEach(i=>{if(i!=null){r=!1;return}}),r)return null;const s=[];for(let i=0;i<e.length;++i)t[i]==null?s.push(It(Ra(e[i]),"bool")):t[i].rank<e[i].rank?s.push(Jo(t[i],-1)):s.push(t[i]);const o=ei(s,this.axis);return rM(o,-1,!1)})}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}nB.className="Concatenate";Qe(nB);function Jm(n,e){for(;n<0;)n+=e;return n}function N0e(n,e,t){if(n.shape.length>3||e.shape.length>3)throw new Tn("batchDot is not implemented for tensors of 4D or higher rank yet");if(X(n.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${n.shape.length}`),X(n.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof t=="number"&&(t=[t,t]),n.dtype==="complex64"||e.dtype==="complex64")throw new Tn("batchDot is not implemented for complex64-type Tensors yet.");const r=n.shape.length,s=e.shape.length;t==null&&(t=[r-1,s-2]);const o=t;return Ne(()=>{let i;if(r>s){i=r-s;const l=[];for(let c=0;c<i;++c)l.push(1);e=ye(e,e.shape.concat(l))}else if(s>r){i=s-r;const l=[];for(let c=0;c<i;++c)l.push(1);n=ye(n,n.shape.concat(l))}else i=0;let a;if(n.shape.length===2&&e.shape.length===2)o[0]===o[1]?a=on(fe(n,e),o[0]):a=on(fe(Hn(n,[1,0]),e),o[1]);else{const l=o[0]!==n.shape.length-1,c=o[1]===e.shape.length-1;a=or(n,e,l,c)}if(i>0){let l;r>s?l=r+s-3:l=r-1;const c=[];for(let u=l;u<l+i;++u)c.push(u);a=c0(a,c)}return a.shape.length===1&&(a=Jo(a,1)),a})}class rB extends Jf{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){X(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0],r=e[1];if(t.length>3||r.length>3)throw new Tn("Dot layer does not support tensors of 4D or higher rank yet.");const s=this.interpretAxes(t,r);if(t[s[0]]!==r[s[1]])throw new ue(`Dimension incompatibility: ${t[s[0]]} !== ${r[s[1]]}`)}mergeFunction(e){if(e.length!==2)throw new ue(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let t=e[0],r=e[1],s;return Array.isArray(this.axes)?s=this.axes.map((o,i)=>Jm(o,e[i].shape.length)):s=[Jm(this.axes,t.shape.length),Jm(this.axes,r.shape.length)],this.normalize&&(t=q2(t,s[0]),r=q2(r,s[1])),N0e(t,r,s)}interpretAxes(e,t){let r;return Array.isArray(this.axes)?r=this.axes:r=[Jm(this.axes,e.length),Jm(this.axes,t.length)],r}computeOutputShape(e){X(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0].slice(),r=e[1].slice();if(t.length>3||r.length>3)throw new Tn("Dot layer does not support tensors of 4D or higher rank yet.");const s=this.interpretAxes(t,r);t.splice(s[0],1),r.splice(s[1],1),r.splice(0,1);const o=t.concat(r);return o.length===1&&o.push(1),o}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}rB.className="Dot";Qe(rB);class sB extends Pn{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return Ne(()=>{this.invokeCallHook(e,t);const r=mn(e);return x0(()=>ot(rw(r.shape,0,this.stddev),r),()=>r,t.training||!1)})}}sB.className="GaussianNoise";Qe(sB);class oB extends Pn{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return Ne(()=>{this.invokeCallHook(e,t);const r=mn(e);return this.rate>0&&this.rate<1?x0(()=>{const o=Math.sqrt(this.rate/(1-this.rate));return fe(r,rw(r.shape,1,o))},()=>r,t.training||!1):r})}}oB.className="GaussianDropout";Qe(oB);class iB extends Pn{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||mn(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return Ne(()=>{if(this.rate<1&&this.rate>0){const r=this._getNoiseShape(e);return x0(()=>{const o=mn(e),a=-1.6732632423543772*1.0507009873554805;let l=Kf(l0(r),this.rate);l=nc(l,"float32");const c=((1-this.rate)*(1+this.rate*a**2))**-.5,u=-c*a*this.rate,d=ot(fe(o,l),fe(ot(l,-1),a));return ot(fe(d,c),u)},()=>mn(e),t.training||!1)}return e})}}iB.className="AlphaDropout";Qe(iB);function zg(n,e,t,r,s,o=.001){let i;if(n.rank===2)i=rue(n,e,t,r,s,o);else if(n.rank===3)i=oue(n,e,t,r,s,o);else if(n.rank===4)i=aue(n,e,t,r,s,o);else throw new Tn(`batchNormalization is not implemented for array of rank ${n.rank} yet`);return i}function E0e(n,e,t,r,s=.001){return Ne(()=>{const o=s8(n,r),i=o.mean,a=o.variance;return[zg(n,i,a,t,e,s),i,a]})}function I0e(n,e,t,r,s=.001){return Ne(()=>{const o=s8(n,r),i=o.mean,a=o.variance,l=[];for(const x of dl(0,n.rank))r.indexOf(x)!==-1?l.push(1):l.push(n.shape[x]);const c=ye(i,l),u=ye(a,l),d=e==null?null:ye(e,l),f=t==null?null:ye(t,l);return[zg(n,c,u,f,d,s),i,a]})}function T0e(n,e,t,r,s=.001){return lr(r.slice().sort(),dl(0,n.rank-1))?E0e(n,e,t,r,s):I0e(n,e,t,r,s)}class aB extends Pn{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Lr(e.betaInitializer||"zeros"),this.gammaInitializer=Lr(e.gammaInitializer||"ones"),this.movingMeanInitializer=Lr(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=Lr(e.movingVarianceInitializer||"ones"),this.betaConstraint=Ns(e.betaConstraint),this.gammaConstraint=Ns(e.gammaConstraint),this.betaRegularizer=jr(e.betaRegularizer),this.gammaRegularizer=jr(e.gammaRegularizer)}build(e){e=Zn(e);const t=this.axis>=0?this.axis:this.axis+e.length,r=e[t];if(r==null)throw new ue(`Axis ${t} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new Cs({ndim:e.length,axes:{[t]:r}})];const s=[r];this.scale&&(this.gamma=this.addWeight("gamma",s,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",s,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",s,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",s,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return Ne(()=>{const r=t.training==null?!1:t.training,s=mn(e),o=s.shape,i=o.length,a=dl(0,i),l=this.axis>=0?this.axis:this.axis+i;a.splice(l,1);const c=Pf(1,i);c[l]=o[l];const u=a.slice();u.sort();const d=!lr(u,dl(0,i).slice(0,i-1)),f=()=>{if(d){const w=ye(this.movingMean.read(),c),S=ye(this.movingVariance.read(),c),k=this.center?ye(this.beta.read(),c):null,N=this.scale?ye(this.gamma.read(),c):null;return zg(s,w,S,k,N,this.epsilon)}else return zg(s,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!r)return f();const[p,x,v]=T0e(s,this.gamma.read(),this.beta.read(),a,this.epsilon),y=(w,S,k)=>{Ne(()=>{const N=1-k,I=w.read(),T=fe(hn(I,S),N);w.write(hn(I,T))})};return(()=>{y(this.movingMean,x,this.momentum),y(this.movingVariance,v,this.momentum)})(),p})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Wr(this.betaInitializer),gammaInitializer:Wr(this.gammaInitializer),movingMeanInitializer:Wr(this.movingMeanInitializer),movingVarianceInitializer:Wr(this.movingVarianceInitializer),betaRegularizer:Cr(this.betaRegularizer),gammaRegularizer:Cr(this.gammaRegularizer),betaConstraint:Ss(this.betaConstraint),gammaConstraint:Ss(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}aB.className="BatchNormalization";Qe(aB);class lB extends Pn{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const t of this.axis)if(!Number.isInteger(t))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Lr(e.betaInitializer||"zeros"),this.gammaInitializer=Lr(e.gammaInitializer||"ones"),this.betaRegularizer=jr(e.betaRegularizer),this.gammaRegularizer=jr(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=Zn(e);const t=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let o=0;o<this.axis.length;++o)this.axis[o]<0&&(this.axis[o]+=t);for(const o of this.axis)if(o<0||o>=t)throw new Error(`Invalid axis: ${o}`);if(this.axis.length!==ed(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const r=this.axis.map(o=>e[o]),s=!0;this.scale?this.gamma=this.addWeight("gamma",r,"float32",this.gammaInitializer,this.gammaRegularizer,s):this.gamma=null,this.center?this.beta=this.addWeight("beta",r,"float32",this.betaInitializer,this.betaRegularizer,s):this.beta=null,this.built=!0}call(e,t){const r=mn(e),s=r.shape,o=s.length;return Ne(()=>{let{mean:a,variance:l}=s8(r,this.axis,!0);const c=Pf(1,o);for(const v of this.axis)c[v]=s[v];const u=v=>v!=null&&v.shape.length!==o?ye(v,c):v;let d=this.scale?u(this.gamma.read()):null,f=this.center?u(this.beta.read()):null;const p=[],x=[];for(let v=0;v<o;++v)this.axis.indexOf(v)!==-1?(p.push(s[v]),x.push(1)):(p.push(1),x.push(s[v]));return a=sl(a,p),l=sl(l,p),d!=null&&(d=sl(d,x)),f!=null&&(f=sl(f,x)),zg(r,a,l,f,d,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Wr(this.betaInitializer),gammaInitializer:Wr(this.gammaInitializer),betaRegularizer:Cr(this.betaRegularizer),gammaRegularizer:Cr(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}lB.className="LayerNormalization";Qe(lB);function _0e(n,e,t){return Ne(()=>{if(n.rank!==4)throw new ue(`temporalPadding expects input tensor to be 4-D, but received a ${n.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new ue("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(t==null&&(t=fl()),t!=="channelsLast"&&t!=="channelsFirst")throw new ue(`Unknown data format: ${t}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let r;return t==="channelsFirst"?r=[[0,0],[0,0],e[0],e[1]]:r=[[0,0],e[0],e[1],[0,0]],o8(n,r)})}class cB extends Pn{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?fl():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new ue(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let t,r;if(typeof e.padding[0]=="number")t=[e.padding[0],e.padding[0]],r=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new ue(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(t=e.padding[0],e.padding[1].length!==2)throw new ue(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);r=e.padding[1]}this.padding=[t,r]}this.inputSpec=[new Cs({ndim:4})]}computeOutputShape(e){e=Zn(e);let t,r;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?t=e[2]+this.padding[0][0]+this.padding[0][1]:t=null,e[3]!=null&&e[3]>=0?r=e[3]+this.padding[1][0]+this.padding[1][1]:r=null,[e[0],e[1],t,r]):(e[1]!=null&&e[1]>=0?t=e[1]+this.padding[0][0]+this.padding[0][1]:t=null,e[2]!=null&&e[2]>=0?r=e[2]+this.padding[1][0]+this.padding[1][1]:r=null,[e[0],t,r,e[3]])}call(e,t){return Ne(()=>_0e(mn(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}cB.className="ZeroPadding2D";Qe(cB);function dw(n,e,t,r,s,o){return Ne(()=>{is(s),NL(o),oa(r),t==null&&(t=[1,1]),r==null&&(r="valid"),s==null&&(s=fl()),o==null&&(o="max"),n=cN(n,s);let i;const a=r==="same"?"same":"valid";return o==="max"?i=r8(n,e,t,a):i=qS(n,e,t,a),s==="channelsFirst"&&(i=Hn(i,[0,3,1,2])),i})}function uB(n,e,t,r,s,o){return Ne(()=>{is(s),NL(o),oa(r),t==null&&(t=[1,1,1]),r==null&&(r="valid"),s==null&&(s=fl()),o==null&&(o="max"),n=Ij(n,s);let i;const a=r==="same"?"same":"valid";return o==="max"?i=Hde(n,e,t,a):i=qce(n,e,t,a),s==="channelsFirst"&&(i=Hn(i,[0,4,1,2,3])),i})}class dB extends Pn{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new ue(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(Os(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new ue(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);Os(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,oa(this.padding),this.inputSpec=[new Cs({ndim:3})]}computeOutputShape(e){e=Zn(e);const t=ll(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return Ne(()=>{this.invokeCallHook(e,t),e=m0(mn(e),2);const r=this.poolingFunction(mn(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return c0(r,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class fB extends dB{constructor(e){super(e)}poolingFunction(e,t,r,s,o){return is(o),oa(s),dw(e,t,r,s,o,"max")}}fB.className="MaxPooling1D";Qe(fB);class hB extends dB{constructor(e){super(e)}poolingFunction(e,t,r,s,o){return is(o),oa(s),dw(e,t,r,s,o,"avg")}}hB.className="AveragePooling1D";Qe(hB);class pB extends Pn{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new ue(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];Os(this.poolSize,"poolSize"),Os(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,is(this.dataFormat),oa(this.padding),this.inputSpec=[new Cs({ndim:4})]}computeOutputShape(e){e=Zn(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],r=this.dataFormat==="channelsFirst"?e[3]:e[2];return t=ll(t,this.poolSize[0],this.padding,this.strides[0]),r=ll(r,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,r]:[e[0],t,r,e[3]]}call(e,t){return Ne(()=>(this.invokeCallHook(e,t),this.poolingFunction(mn(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class mB extends pB{constructor(e){super(e)}poolingFunction(e,t,r,s,o){return is(o),oa(s),dw(e,t,r,s,o,"max")}}mB.className="MaxPooling2D";Qe(mB);class gB extends pB{constructor(e){super(e)}poolingFunction(e,t,r,s,o){return is(o),oa(s),dw(e,t,r,s,o,"avg")}}gB.className="AveragePooling2D";Qe(gB);class xB extends Pn{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new ue(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];Os(this.poolSize,"poolSize"),Os(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,is(this.dataFormat),oa(this.padding),this.inputSpec=[new Cs({ndim:5})]}computeOutputShape(e){e=Zn(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],r=this.dataFormat==="channelsFirst"?e[3]:e[2],s=this.dataFormat==="channelsFirst"?e[4]:e[3];return t=ll(t,this.poolSize[0],this.padding,this.strides[0]),r=ll(r,this.poolSize[1],this.padding,this.strides[1]),s=ll(s,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,r,s]:[e[0],t,r,s,e[4]]}call(e,t){return Ne(()=>(this.invokeCallHook(e,t),this.poolingFunction(mn(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class vB extends xB{constructor(e){super(e)}poolingFunction(e,t,r,s,o){return is(o),oa(s),uB(e,t,r,s,o,"max")}}vB.className="MaxPooling3D";Qe(vB);class yB extends xB{constructor(e){super(e)}poolingFunction(e,t,r,s,o){return is(o),oa(s),uB(e,t,r,s,o,"avg")}}yB.className="AveragePooling3D";Qe(yB);class bB extends Pn{constructor(e){super(e),this.inputSpec=[new Cs({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new Tn}}class wB extends bB{constructor(e){super(e||{})}call(e,t){return Ne(()=>{const r=mn(e);return fs(r,1)})}}wB.className="GlobalAveragePooling1D";Qe(wB);class CB extends bB{constructor(e){super(e||{})}call(e,t){return Ne(()=>{const r=mn(e);return al(r,1)})}}CB.className="GlobalMaxPooling1D";Qe(CB);class kB extends Pn{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,is(this.dataFormat),this.inputSpec=[new Cs({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new Tn}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class SB extends kB{call(e,t){return Ne(()=>{const r=mn(e);return this.dataFormat==="channelsLast"?fs(r,[1,2]):fs(r,[2,3])})}}SB.className="GlobalAveragePooling2D";Qe(SB);class NB extends kB{call(e,t){return Ne(()=>{const r=mn(e);return this.dataFormat==="channelsLast"?al(r,[1,2]):al(r,[2,3])})}}NB.className="GlobalMaxPooling2D";Qe(NB);class EB extends Pn{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t,r={}){const s=t.layer,o=Lc(s,r);delete t.layer;const i={layer:o};return Object.assign(i,t),new e(i)}}class IB extends EB{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=Zn(e),e.length<3)throw new ue(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=Zn(e);const t=[e[0]].concat(e.slice(2)),r=this.layer.computeOutputShape(t),s=e[1];return[r[0],s].concat(r.slice(1))}call(e,t){return Ne(()=>(e=mn(e),Oj((i,a)=>[mn(this.layer.call(i,t)),[]],e,[],!1,null,null,!1,!0)[1]))}}IB.className="TimeDistributed";Qe(IB);function R0e(n){Zf(Zge,"BidirectionalMergeMode",n)}const D0e="concat";class TB extends EB{constructor(e){super(e);const t=e.layer.getConfig(),r={};r.className=e.layer.getClassName(),r.config=t,this.forwardLayer=Lc(r),t.goBackwards=t.goBackwards!==!0;const s={};if(s.className=e.layer.getClassName(),s.config=t,this.backwardLayer=Lc(s),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?D0e:e.mergeMode,R0e(this.mergeMode),e.weights)throw new Tn("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=e.length,r=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,r)),this.backwardLayer.setWeights(e.slice(r))}computeOutputShape(e){let t=this.forwardLayer.computeOutputShape(e);Array.isArray(t)&&Array.isArray(t[0])||(t=[t]),t=t;let r,s,o;return this.returnState&&(o=t.slice(1)),r=t[0],r=r,this.mergeMode==="concat"?(r[r.length-1]*=2,s=[r]):this.mergeMode==null?s=[r,r.slice()]:s=[r],this.returnState?this.mergeMode==null?s.concat(o).concat(o.slice()):[r].concat(o).concat(o.slice()):Qo(s)}apply(e,t){let r=t==null?null:t.initialState,s=t==null?null:t.constants;t==null&&(t={});const o=Pj(e,r,s,this.numConstants);if(e=o.inputs,r=o.initialState,s=o.constants,Array.isArray(e)&&(r=e.slice(1),e=e[0]),(r==null||r.length===0)&&s==null)return super.apply(e,t);const i=[],a=[];if(r!=null){const c=r.length;if(c%2>0)throw new ue("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=r,i.push(...r);const u=r.map(d=>new Cs({shape:d.shape}));this.forwardLayer.stateSpec=u.slice(0,c/2),this.backwardLayer.stateSpec=u.slice(c/2),a.push(...u)}if(s!=null)throw new Tn("Support for constants in Bidirectional layers is not implemented yet.");const l=i[0]instanceof uc;for(const c of i)if(c instanceof uc!==l)throw new ue("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){const c=[e].concat(i),u=this.inputSpec.concat(a),d=this.inputSpec;this.inputSpec=u;const f=super.apply(c,t);return this.inputSpec=d,f}else return super.apply(e,t)}call(e,t){return Ne(()=>{const r=t.initialState;let s,o;if(r==null)s=this.forwardLayer.call(e,t),o=this.backwardLayer.call(e,t);else{const l=r.slice(0,r.length/2),c=r.slice(r.length/2);s=this.forwardLayer.call(e,Object.assign(t,{initialState:l})),o=this.backwardLayer.call(e,Object.assign(t,{initialState:c}))}let i;this.returnState&&(Array.isArray(s)&&(i=s.slice(1).concat(o.slice(1))),s=s[0],o=o[0]),this.returnSequences&&(o=$f(o,1));let a;return this.mergeMode==="concat"?a=Y8([s,o]):this.mergeMode==="sum"?a=ot(s,o):this.mergeMode==="ave"?a=fe(.5,ot(s,o)):this.mergeMode==="mul"?a=fe(s,o):this.mergeMode==null&&(a=[s,o]),this.returnState?this.mergeMode==null?a.concat(i):[a].concat(i):a})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){xf(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),xf(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,t){Array.isArray(t)&&(t=t[0]);let r;if(this.returnSequences?this.mergeMode==null?r=[t,t]:r=t:this.mergeMode==null?r=[null,null]:r=null,this.returnState){const o=this.forwardLayer.states.map(i=>null);return Array.isArray(r)?r.concat(o).concat(o):[r].concat(o).concat(o)}else return r}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const r=Lc(t.layer);if(delete t.layer,t.numConstants!=null)throw new Tn("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const s=t;return s.layer=r,new e(s)}}TB.className="Bidirectional";Qe(TB);class _B extends Pn{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return Ne(()=>(e=mn(e),e.dtype!=="float32"&&(e=nc(e,"float32")),ot(fe(e,this.scale),this.offset)))}}_B.className="Rescaling";Qe(_B);const{resizeBilinear:A0e,cropAndResize:$0e}=Mc;class RB extends Pn{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,t,r,s,o,i,a,l){return Ne(()=>{let c,u=!1;const d=t/i,f=r/a,p=(s+t)/i,x=(o+r)/a,v=[d,f,p,x],y=[];e.rank===3?(u=!0,c=Uc([e])):c=e;for(let N=0;N<c.shape[0];N++)y.push(v);const b=qO(y,[y.length,4]),w=Lg(0,y.length,1,"int32"),k=$0e(c,b,w,[s,o],"nearest");return nc(u?mn(Ff(k)):k,l)})}upsize(e,t,r,s){return Ne(()=>{const o=A0e(e,[t,r]);return nc(o,s)})}call(e,t){return Ne(()=>{const r=mn(e),s=r.dtype,o=r.shape,i=o[o.length-3],a=o[o.length-2];let l=0;i!==this.height&&(l=Math.floor((i-this.height)/2));let c=0;return a!==this.width&&(c=Math.floor((a-this.width)/2),c===0&&(c=1)),l>=0&&c>=0?this.centerCrop(r,l,c,this.height,this.width,i,a,s):this.upsize(e,this.height,this.width,s)})}getConfig(){const e={height:this.height,width:this.width},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=Zn(e);const t=e.length-3,r=e.length-2;return e[t]=this.height,e[r]=this.width,e}}RB.className="CenterCrop";Qe(RB);function F0e(n,e,t,r){let s=mn(n);if(s.dtype!=="int32"&&(s=nc(s,"int32")),e==="int")return s;const o=s.shape;if(s.rank===0&&(s=Jo(s,-1)),e==="oneHot"&&s.shape[s.shape.length-1]!==1&&(s=Jo(s,-1)),s.rank>2)throw new ue(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${o} which would result in output rank ${s.rank}.`);const i=["multiHot","oneHot"].includes(e),a=s;let l;if(typeof r<"u"&&e==="count"?l=i_(a,r,t,i):l=i_(a,[],t,i),e!=="tfIdf")return l;if(r)return fe(l,r);throw new ue("When outputMode is 'tfIdf', weights must be provided.")}class DB extends Pn{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){return e=Zn(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,t){return Ne(()=>{e=mn(e),e.dtype!=="int32"&&(e=nc(e,"int32"));let r;if(typeof t.countWeights<"u"){if(this.outputMode!=="count")throw new ue(`countWeights is not used when outputMode !== count.
              Received countWeights=${t.countWeights}`);r=mn(t.countWeights)}const s=al(e),o=L2(e),i=sa(this.numTokens,s).bufferSync().get(0),a=Kf(o,0).bufferSync().get(0);if(!(i&&a))throw new ue(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return F0e(e,this.outputMode,this.numTokens,r)})}}DB.className="CategoryEncoding";Qe(DB);const P0e=["bilinear","nearest"],q_=new Set(P0e);class AB extends Pn{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(q_.has(e.interpolation))this.interpolation=e.interpolation;else throw new ue(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=Zn(e);const t=e[2];return[this.height,this.width,t]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return Ne(()=>{const r=[this.height,this.width];if(this.interpolation==="bilinear")return Mc.resizeBilinear(e,r,!this.cropToAspectRatio);if(this.interpolation==="nearest")return Mc.resizeNearestNeighbor(e,r,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...q_]} are supported`)})}}AB.className="Resizing";Qe(AB);class $B{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}$B.className="RandomSeed";class FB extends Pn{constructor(e){super(e),this.randomGenerator=new $B(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},t=super.getConfig();return Object.assign(e,t),e}}FB.className="BaseRandomLayer";const O0e=["bilinear","nearest"],K_=new Set(O0e);class PB extends FB{constructor(e){super(e);const{factor:t,interpolation:r="bilinear"}=e;if(this.factor=t,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new ue(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new ue(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new ue(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(r)if(K_.has(r))this.interpolation=r;else throw new ue(`Invalid interpolation parameter: ${r} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=Zn(e);const t=e[2];return[this.imgHeight,-1,t]}call(e,t){return Ne(()=>{const r=mn(e);this.imgHeight=r.shape[r.shape.length-3];const s=r.shape[r.shape.length-2];this.widthFactor=l0([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let o=this.widthFactor.dataSync()[0]*s;o=Math.round(o);const i=[this.imgHeight,o];switch(this.interpolation){case"bilinear":return Mc.resizeBilinear(e,i);case"nearest":return Mc.resizeNearestNeighbor(e,i);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...K_]} are supported`)}})}}PB.className="RandomWidth";Qe(PB);const M0e=De();M0e.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,n=>{n&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});var X_;(function(n){n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_QINT16=15]="DT_QINT16",n[n.DT_QUINT16=16]="DT_QUINT16",n[n.DT_UINT16=17]="DT_UINT16",n[n.DT_COMPLEX128=18]="DT_COMPLEX128",n[n.DT_HALF=19]="DT_HALF",n[n.DT_RESOURCE=20]="DT_RESOURCE",n[n.DT_VARIANT=21]="DT_VARIANT",n[n.DT_UINT32=22]="DT_UINT32",n[n.DT_UINT64=23]="DT_UINT64",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n[n.DT_QINT16_REF=115]="DT_QINT16_REF",n[n.DT_QUINT16_REF=116]="DT_QUINT16_REF",n[n.DT_UINT16_REF=117]="DT_UINT16_REF",n[n.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",n[n.DT_HALF_REF=119]="DT_HALF_REF",n[n.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",n[n.DT_VARIANT_REF=121]="DT_VARIANT_REF",n[n.DT_UINT32_REF=122]="DT_UINT32_REF",n[n.DT_UINT64_REF=123]="DT_UINT64_REF"})(X_||(X_={}));var Y_;(function(n){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})(Y_||(Y_={}));var Z_;(function(n){n[n.FAIL=0]="FAIL",n[n.SHORTEST=1]="SHORTEST",n[n.LONGEST=2]="LONGEST"})(Z_||(Z_={}));function Mt(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&X(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}const L0e=DM;class fw extends Z6{nextDataId(){return fw.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new tO(this,Pl())}write(e,t,r){this.firstUse&&(this.firstUse=!1,De().get("IS_NODE")&&Gi(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const s={id:this.nextDataId()};return this.data.set(s,{values:e,dtype:r,refCount:1}),s}makeTensorInfo(e,t,r){let s;if(t==="string"&&r!=null&&r.length>0&&u1(r[0])){const o=r.map(i=>Qu(i));s=this.write(o,e,t)}else s=this.write(r,e,t);return{dataId:s,shape:e,dtype:t}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const t=this.data.get(e);t.refCount++}decRef(e){if(this.data.has(e)){const t=this.data.get(e);t.refCount--}}move(e,t,r,s,o){this.data.set(e,{values:t,dtype:s,refCount:o})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:r}=this.data.get(e);if(t==="complex64"){const s=this.readSync(r.real.dataId),o=this.readSync(r.imag.dataId);return Hc(s,o)}return ole(this.data.get(e).values,t)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const r=t.map(s=>ld(s));return $n(e.shape,e.dtype,r)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return $n(e.shape,e.dtype,t)}makeOutput(e,t,r){return Pl().makeTensorFromTensorInfo(this.makeTensorInfo(t,r,e),this)}disposeData(e,t=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:r}=this.data.get(e);r!=null&&(this.disposeData(r.real.dataId,!0),this.disposeData(r.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const t=Yo();return e(),{kernelMs:Yo()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){Mt([e],"where");const t=this.readSync(e.dataId);return L0e(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}fw.nextDataId=0;function OB(n){const e=new Float32Array(n.length);for(let t=0;t<n.length;++t)e[t]=Math.abs(n[t]);return e}const j0e=n=>{const{x:e}=n.inputs,t=n.backend;Mt(e,"abs");let r=new Float32Array(Le(e.shape));const s=t.data.get(e.dataId).values;return r=OB(s),t.makeOutput(r,e.shape,e.dtype)},B0e={kernelName:Wy,backendName:"cpu",kernelFunc:j0e};function as(n){return(e,t,r,s,o)=>{const i=Sn(e,t),a=i.length,l=nn(i),c=Le(i),u=po(o,c),d=e.length,f=t.length,p=nn(e),x=nn(t),v=Ap(e,i),y=Ap(t,i);if(v.length+y.length===0)for(let b=0;b<u.length;++b)u[b]=n(r[b%r.length],s[b%s.length]);else for(let b=0;b<u.length;++b){const w=Yp(b,a,l),S=w.slice(-d);v.forEach(T=>S[T]=0);const k=Ql(S,d,p),N=w.slice(-f);y.forEach(T=>N[T]=0);const I=Ql(N,f,x);u[b]=n(r[k],s[I])}return[u,i]}}function wi(n){const{inputs:e,backend:t}=n,{real:r,imag:s}=e,o=t.data.get(r.dataId).values,i=t.data.get(s.dataId).values,a=t.makeTensorInfo(r.shape,"complex64"),l=t.data.get(a.dataId);return l.complexTensorInfos={real:t.makeTensorInfo(r.shape,"float32",o),imag:t.makeTensorInfo(s.shape,"float32",i)},a}const V0e={kernelName:uS,backendName:"cpu",kernelFunc:wi};function J2(n,e,t="float32"){if(t==="complex64"){const s=J2(n,e,"float32"),o=J2(n,e,"float32");return wi({inputs:{real:s,imag:o},backend:n})}const r=mo(Le(e),t);return n.makeTensorInfo(e,t,r)}function dc(n){const{inputs:e,backend:t}=n,{x:r}=e;return t.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const z0e={kernelName:D1,backendName:"cpu",kernelFunc:dc};function Of(n){const{inputs:e,backend:t}=n,{input:r}=e,s=t.data.get(r.dataId).complexTensorInfos.real,o=t.data.get(s.dataId).values;return t.makeTensorInfo(s.shape,s.dtype,o)}const W0e={kernelName:FS,backendName:"cpu",kernelFunc:Of};function MB(n,e,t,r){if(r==="int32"){const s=Int32Array.from(n);return[e,"int32",s]}if(r==="bool"){const s=qf([0],t),[o,i]=as((a,l)=>a!==l?1:0)(e,[],n,s,"bool");return[i,"bool",o]}throw new Error(`Error in Cast: failed to cast ${t} to ${r}`)}function hd(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{dtype:o}=r;if(o==="complex64"){if(s.dtype==="complex64")return dc({inputs:{x:s},backend:t});const u=J2(t,s.shape,s.dtype),d=hd({inputs:{x:s},backend:t,attrs:{dtype:"float32"}}),f=wi({inputs:{real:d,imag:u},backend:t});return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(d),f}if(s.dtype==="complex64"){const u=Of({inputs:{input:s},backend:t}),d=hd({inputs:{x:u},backend:t,attrs:{dtype:o}});return t.disposeIntermediateTensorInfo(u),d}if(!sO(s.dtype,o)){const u=dc({inputs:{x:s},backend:t});return{dataId:u.dataId,shape:u.shape,dtype:o}}const i=t.data.get(s.dataId).values,[a,l,c]=MB(i,s.shape,s.dtype,o);return t.makeTensorInfo(a,l,c)}const U0e={kernelName:v1,backendName:"cpu",kernelFunc:hd};function Ts(n,e,t,r){return t==null?({inputs:s,backend:o})=>{const{a:i,b:a}=s,l=o;Mt([i,a],n);const c=l.data.get(i.dataId).values,u=l.data.get(a.dataId).values,d=i.dtype==="string"?Gc(c):c,f=i.dtype==="string"?Gc(u):u,p=r||i.dtype,[x,v]=e(i.shape,a.shape,d,f,p);return l.makeTensorInfo(v,p,x)}:({inputs:s,backend:o})=>{const{a:i,b:a}=s,l=o;if(i.dtype==="complex64"||a.dtype==="complex64"){const c=hd({inputs:{x:i},backend:l,attrs:{dtype:"complex64"}}),u=l.data.get(c.dataId),d=u.complexTensorInfos.real,f=u.complexTensorInfos.imag,p=l.data.get(d.dataId).values,x=l.data.get(f.dataId).values,v=hd({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),y=l.data.get(v.dataId),b=y.complexTensorInfos.real,w=y.complexTensorInfos.imag,S=l.data.get(b.dataId).values,k=l.data.get(w.dataId).values,[N,I,T]=t(i.shape,a.shape,p,x,S,k),F=l.makeTensorInfo(T,"float32",N),R=l.makeTensorInfo(T,"float32",I),D=wi({inputs:{real:F,imag:R},backend:l});return l.disposeIntermediateTensorInfo(c),l.disposeIntermediateTensorInfo(v),l.disposeIntermediateTensorInfo(F),l.disposeIntermediateTensorInfo(R),D}else{const c=l.data.get(i.dataId).values,u=l.data.get(a.dataId).values,d=r||i.dtype,[f,p]=e(i.shape,a.shape,c,u,d);return l.makeTensorInfo(p,d,f)}}}function mN(n){return(e,t,r,s,o,i)=>{const a=Sn(e,t),l=Le(a),c=a.length,u=nn(a),d=po("float32",l),f=po("float32",l),p=Ap(e,a),x=Ap(t,a),v=Hc(r,s),y=Hc(o,i),b=e.length,w=nn(e),S=t.length,k=nn(t);if(p.length+x.length===0)for(let N=0;N<d.length;N++){const I=N%v.length,T=N%y.length,F=n(v[I*2],v[I*2+1],y[T*2],y[T*2+1]);d[N]=F.real,f[N]=F.imag}else for(let N=0;N<d.length;N++){const I=Yp(N,c,u),T=I.slice(-b);p.forEach(P=>T[P]=0);const F=Ql(T,b,w),R=I.slice(-S);x.forEach(P=>R[P]=0);const D=Ql(R,S,k),A=n(v[F*2],v[F*2+1],y[D*2],y[D*2+1]);d[N]=A.real,f[N]=A.imag}return[d,f,a]}}const LB=as(((n,e)=>n+e)),H0e=mN(((n,e,t,r)=>({real:n+t,imag:e+r}))),Pp=Ts(Zp,LB,H0e),G0e={kernelName:Zp,backendName:"cpu",kernelFunc:Pp};function gN(n,e,t,r,s){const o=Le(r),i=mo(s,t);for(let a=0;a<n.length;a++){const l=n[a];if(l<0)throw new Error("Input x must be non-negative!");l>=s||(o>0?i[l]+=e[a]:i[l]+=1)}return i}function jB(n,e,t,r=!1){const s=n.shape[0],o=n.shape[1],i=$n([s,t],e.dtype);for(let a=0;a<s;a++)for(let l=0;l<o;l++){const c=n.get(a,l);if(c<0)throw new Error("Input x must be non-negative!");c>=t||(r?i.set(1,a,c):e.size>0?i.set(i.get(a,c)+e.get(a,l),a,c):i.set(i.get(a,c)+1,a,c))}return i}const BB=as(((n,e)=>n&e)),q0e=Ts(cS,BB),K0e={kernelName:cS,backendName:"cpu",kernelFunc:q0e};function vc(n){return(e,t,r)=>{const s=ns(t,e.length);for(let o=0;o<e.length;++o)s[o]=n(e[o],r);return s}}function mr(n,e,t){const r=vc(e);return Ed(n,r,t)}function Ed(n,e,t){return({inputs:r,attrs:s,backend:o})=>{const{x:i}=r;Mt(i,n);const a=o,l=a.data.get(i.dataId).values;let c;if(i.dtype==="string"){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");c=Gc(l)}else c=l;const u=t||i.dtype,d=e(c,u,s);return a.makeTensorInfo(i.shape,u,d)}}const VB=vc(n=>Math.ceil(n)),X0e=Ed(y1,VB),Y0e={kernelName:y1,backendName:"cpu",kernelFunc:X0e};function zB(n,e,t,r){const s=ns(t,Le(e));if(r&&t!=="string"){let o=0;n.forEach(i=>{const a=Le(i.shape);s.set(i.vals,o),o+=a})}else{let o=0;n.forEach(i=>{const a=t==="string"?Gc(i.vals):i.vals;let l=0;for(let c=0;c<i.shape[0];++c){const u=c*e[1]+o;for(let d=0;d<i.shape[1];++d)s[u+d]=a[l++]}o+=i.shape[1]})}return s}const WB=as((n,e)=>n===e?1:0),UB=Ts(sb,WB,null,"bool"),Z0e={kernelName:sb,backendName:"cpu",kernelFunc:UB};const HB=vc(n=>Math.exp(n)),GB=Ed(E1,HB,"float32"),J0e={kernelName:E1,backendName:"cpu",kernelFunc:GB};const qB=vc(n=>Math.expm1(n)),Q0e=Ed(I1,qB),exe={kernelName:I1,backendName:"cpu",kernelFunc:Q0e};const KB=vc(n=>Math.floor(n)),txe=Ed(T1,KB),nxe={kernelName:T1,backendName:"cpu",kernelFunc:txe};const XB=as((n,e)=>Math.floor(n/e)),rxe=Ts(_1,XB,null,"int32"),sxe={kernelName:_1,backendName:"cpu",kernelFunc:rxe};function YB(n,e,t,r,s,o,i,a,l){const c=$n([r,o],t);for(let u=0;u<r;u++){const d=[];let f=0;for(let p=0;p<s;p++){const x=n[u*s+p];f+=x*i[p],d.push(x)}if(f<0||f>=l/o)throw new Error(`Invalid indices: ${d} does not index into ${a}`);for(let p=0;p<o;p++)c.values[u*o+p]=e.get(...e.indexToLoc(f*o+p))}return c}function ZB(n,e,t){const r=$n(t,n.dtype);for(let s=0;s<r.size;++s){const i=r.indexToLoc(s).slice(),a=i[0],l=i[2],c=e.locToIndex([a,l]);i[2]=e.values[c];const u=n.locToIndex(i);0<=u&&u<n.values.length&&(r.values[s]=n.values[u])}return r}const JB=as((n,e)=>n>e?1:0),oxe=Ts(lb,JB,null,"bool"),ixe={kernelName:lb,backendName:"cpu",kernelFunc:oxe};const QB=as((n,e)=>n>=e?1:0),axe=Ts(R1,QB,null,"bool"),lxe={kernelName:R1,backendName:"cpu",kernelFunc:axe};const eV=as((n,e)=>n<e?1:0),cxe=Ts(ub,eV,null,"bool"),uxe={kernelName:ub,backendName:"cpu",kernelFunc:cxe};const tV=as((n,e)=>n<=e?1:0),dxe=Ts(db,tV,null,"bool"),fxe={kernelName:db,backendName:"cpu",kernelFunc:dxe};function nV(n,e,t){const r=(e-n)/(t-1),s=mo(t,"float32");s[0]=n;for(let o=1;o<s.length;o++)s[o]=s[o-1]+r;return s}const rV=vc(n=>Math.log(n)),hxe=Ed(P1,rV),pxe={kernelName:P1,backendName:"cpu",kernelFunc:hxe};function sV(n,e,t,r){const s=po(r,Le(t));for(let o=0;o<s.length;++o){const i=o*e;let a=n[i];for(let l=0;l<e;++l){const c=n[i+l];(Number.isNaN(c)||c>a)&&(a=c)}s[o]=a}return s}const oV=as(((n,e)=>Math.max(n,e))),mxe=Ts(M1,oV),gxe={kernelName:M1,backendName:"cpu",kernelFunc:mxe};const iV=as(((n,e)=>Math.min(n,e))),xxe=Ts(L1,iV),vxe={kernelName:L1,backendName:"cpu",kernelFunc:xxe};const xN=as(((n,e)=>n*e)),yxe=mN(((n,e,t,r)=>({real:n*t-e*r,imag:n*r+e*t}))),hw=Ts(B1,xN,yxe),bxe={kernelName:B1,backendName:"cpu",kernelFunc:hw};function aV(n,e,t){const r=yd(-1,t);return xN([],e,r,n,t)}function wxe(n){const{inputs:e,backend:t}=n,{x:r}=e;Mt(r,"neg");const s=t.data.get(r.dataId).values,[o,i]=aV(s,r.shape,r.dtype);return t.makeTensorInfo(i,r.dtype,o)}const Cxe={kernelName:Cb,backendName:"cpu",kernelFunc:wxe};const lV=as(((n,e)=>n!==e?1:0)),kxe=Ts(kb,lV,null,"bool"),Sxe={kernelName:kb,backendName:"cpu",kernelFunc:kxe};function vN(n,e,t,r,s){const o=e.length,i=Le(e),a=nn(e),l=nn(s),c=po(t,Le(s));for(let u=0;u<i;++u){const d=Yp(u,o,a),f=new Array(d.length);for(let x=0;x<f.length;x++)f[x]=d[r[x]];const p=Ql(f,o,l);c[p]=n[u]}return c}function ri(n){const{inputs:e,attrs:t,backend:r}=n,{x:s}=e,{perm:o}=t;Mt(s,"transpose");const i=s.shape.length,a=new Array(i);for(let d=0;d<a.length;d++)a[d]=s.shape[o[d]];const l=r.data.get(s.dataId).values,c=vN(l,s.shape,s.dtype,o,a);return{dataId:r.write(c,a,s.dtype),shape:a,dtype:s.dtype}}const Nxe={kernelName:pp,backendName:"cpu",kernelFunc:ri};function cV(n,e,t,r){const[s,o]=Ws(n,r),i=Ei(e,"int32"),a=mo(Le(s),i),l=Le(o);for(let c=0;c<a.length;++c){const u=c*l;let d=1;for(let f=0;f<l;++f)d*=t[u+f];a[c]=d}return{outVals:a,outShape:s,outDtype:i}}function Exe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:o,keepDims:i}=r;Mt(s,"prod");const a=s.shape.length,l=Fn(o,s.shape),c=Ur(l,a);let u=l,d=s;const f=[];c!=null&&(d=ri({inputs:{x:s},backend:t,attrs:{perm:c}}),f.push(d),u=os(u.length,a));const p=t.data.get(d.dataId).values,{outVals:x,outShape:v,outDtype:y}=cV(d.shape,d.dtype,p,u);let b=v;return i&&(b=ps(v,l)),f.forEach(w=>t.disposeIntermediateTensorInfo(w)),t.makeTensorInfo(b,y,x)}const Ixe={kernelName:_b,backendName:"cpu",kernelFunc:Exe};function Txe(n,e,t){n.forEach((r,s)=>{if(r<0||r>=t){const o=Yp(s,e.length,nn(e)).join(",");throw new Error(`indices[${o}] = ${r} is not in [0, ${t})`)}})}function _xe(n,e){for(let t=0;t<n.length;++t){const r=n[t],s=t===n.length-1?e:n[t+1].length;if(r.length===0)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>s)throw new Error("Ragged splits must not point past values");for(let o=1;o<r.length;++o)if(r[o-1]>r[o])throw new Error("Ragged splits must be sorted in ascending order")}}function Rxe(n,e,t,r){const s=[];let o=0;const i=e.length-1+t.length,a=new Array(i).fill(null).map(()=>[0]);_xe(t,r);let l=1;for(let c=0;c<e.length-1;++c){l*=e[c];const u=e[c+1];for(let d=1;d<l+1;++d)a[c].push(d*u)}for(let c=0;c<n.length;++c){let u=n[c],d=n[c]+1;for(let f=0;f<t.length;++f){const p=t[f],x=f+e.length-1;if(x>=0){const v=a[x],y=v[v.length-1]-p[u];for(let b=u;b<d;++b)a[x].push(p[b+1]+y)}u=p[u],d=p[d]}d!==u&&(s.push([u,d]),o+=d-u)}return{outSplits:a,valueSlices:s,numValues:o}}function Dxe(n){const e=[];for(let t=0;t<n.length;++t){const r=n[t].length,s=ns("int32",r);e.push(s),n[t].forEach((o,i)=>s[i]=o)}return e}function J_(n,e){const t=n.slice(0,e);for(;t.length<e;)t.push(1);for(let r=e;r<n.length;r++)t[e-1]*=n[r];return t}function Axe(n,e,t,r,s,o){const i=J_(e,2)[1],a=J_(o,2)[1];let l=0;for(const c of t)for(let u=c[0];u<c[1];++u){for(let d=0;d<r;++d)s[l*a+d]=n[u*i+d];++l}}function $xe(n,e,t,r,s){const o=e.slice();o[0]=s;const i=ns(t,Le(o)),a=n.length,l=a===0?0:a/e[0];return Axe(n,e,r,l,i,o),[i,o]}function uV(n,e,t,r,s,o,i,a){if(n.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const l=e[0][0]-1;if(Txe(o,i,l),r.length===0)throw new Error("params.rank must be nonzero");const c=r[0],{outSplits:u,valueSlices:d,numValues:f}=Rxe(o,i,n,c),p=Dxe(u),x=$xe(t,r,s,d,f);return[p,x[0],x[1]]}const Q_=2147483647;function dV(n,e,t,r,s,o,i){if(e.length>1)throw new Error("starts must be a scalar or vector");if(s.length>1)throw new Error("limits must be a scalar or vector");if(i.length>1)throw new Error("deltas must be a scalar or vector");const a=e.length===0,l=s.length===0,c=i.length===0,u=[];a||u.push(e[0]),l||u.push(s[0]),c||u.push(i[0]);for(let y=1;y<u.length;++y)if(u[y]!==u[y-1])throw new Error("starts, limits, and deltas must have the same shape");const d=u.length===0?1:u[0],f=ns("int32",d+1);f[0]=0;for(let y=0;y<d;++y){const b=a?n[0]:n[y],w=l?r[0]:r[y],S=c?o[0]:o[y];if(S===0)throw new Error("Requires delta != 0");let k;if(S>0&&w<b||S<0&&w>b)k=0;else if(k=Math.ceil(Math.abs((w-b)/S)),k>Q_)throw new Error(`Requires ((limit - start) / delta) <= ${Q_}`);f[y+1]=f[y]+k}const p=f[d],x=ns(t,p);let v=0;for(let y=0;y<d;++y){const b=f[y+1]-f[y];let w=a?n[0]:n[y];const S=c?o[0]:o[y];for(let k=0;k<b;++k)x[v++]=w,w+=S}return[f,x]}var wa=Ja;class Q2{constructor(e,t,r,s,o,i,a,l,c,u){this.shape=e,this.shapeShape=t,this.values=r,this.valuesShape=s,this.valuesDType=o,this.defaultValue=i,this.defaultValueShape=a,this.rowPartitionValues=l,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=YM(u),this.raggedRank=ZM(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===wa.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===wa.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case wa.VALUE_ROWIDS:return Q2.getMaxWidthValueRowID(t);case wa.ROW_SPLITS:return Q2.getMaxWidthRowSplit(t);default:throw new Error(`Cannot handle partition type ${wa[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const t=e.length;if(t===0||t===1)return 0;let r=0;for(let s=0;s<t-1;++s){const o=e[s+1]-e[s];o>r&&(r=o)}return r}static getMaxWidthValueRowID(e){const t=e.length;if(t===0)return 0;let r=0,s=e[0],o=0;for(let i=1;i<t;++i){const a=e[i];a!==s&&(s=a,o=Math.max(i-r,o),r=i)}return Math.max(t-r,o)}tensorShapeFromTensor(e,t,r=!0){if(t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return tR(e,r)}calculateOutputSize(e){const t=this.valuesShape,r=this.defaultValueShape;JM(r,t);const s=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=XM(this.raggedRank,s,t);i[0]<0&&(i[0]=e);for(let a=1;a<=this.raggedRank;++a)i[a]<0&&(i[a]=this.getMaxWidth(a));return i}calculateFirstParentOutputIndex(e,t,r){const s=Math.min(e,r),o=[];let i=0;for(let a=0;a<s;++a,i+=t)o.push(i);for(let a=s;a<e;++a)o.push(-1);return X(o.length===e,()=>"Final length of result must be equal to firstDimension."),o}calculateOutputIndexRowSplit(e,t,r,s){const o=e.length,i=[];for(let a=0;a<o-1;++a){const l=e[a+1]-e[a];let c=Math.min(s,l),u=t[a];u===-1&&(c=0);for(let d=0;d<c;++d)i.push(u),u+=r;for(let d=0;d<l-c;++d)i.push(-1)}if(o>0&&i.length!==e[o-1])throw new Error("Invalid row split size.");return i}calculateOutputIndexValueRowID(e,t,r,s){const o=e.length,i=[];if(o===0)return[];let a=0,l=e[0];if(l>=t.length)throw new Error(`Got currentValueRowId=${l}, which is not less than ${t.length}`);let c=t[l];i.push(c);for(let u=1;u<o;++u){const d=e[u];if(d===l)c>=0&&(++a,a<s?c+=r:c=-1);else{if(a=0,l=d,d>=t.length)throw new Error(`Got nextValueRowId=${d} which is not less than ${t.length}`);c=t[d]}i.push(c)}if(i.length!==e.length)throw new Error("Invalid row ids.");return i}calculateOutputIndex(e,t,r,s){const o=this.getRowPartitionTensor(e),i=this.getRowPartitionTypeByDimension(e);switch(i){case wa.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(o,t,r,s);case wa.ROW_SPLITS:if(o.length-1>t.length)throw new Error(`Row partition size is greater than output size: ${o.length-1} > ${t.length}`);return this.calculateOutputIndexRowSplit(o,t,r,s);default:throw new Error(`Unsupported partition type: ${wa[i]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const t=this.rowPartitionTypes[0];switch(t){case wa.FIRST_DIM_SIZE:return e[0];case wa.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case wa.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${wa[t]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const t=this.getFirstDimensionSize(),r=this.calculateOutputSize(t),s=new Array(this.raggedRank+1);s[s.length-1]=1;for(let l=s.length-2;l>=0;--l)s[l]=s[l+1]*r[l+1];const o=tR(r,!1),i=ns(this.valuesDType,Le(o));if(s[0]*r[0]>0){let l=this.calculateFirstParentOutputIndex(t,s[0],r[0]);for(let c=1;c<=this.raggedRank;++c)l=this.calculateOutputIndex(c-1,l,s[c],r[c]);this.setOutput(this.raggedRank,l,i,o)}return[o,i]}setOutput(e,t,r,s){if(r.length===0)return;const o=this.values,i=r;let a=s.slice();a=a.slice(e+1);const l=Le(a),c=t.length;let u=this.defaultValue;if(u.length!==l&&u.length!==1){const x=this.defaultValueShape;Ne(()=>{const v=ye(u,x);u=pg(v,a).dataSync()})}let d=0,f=0,p=0;for(let x=0;x<=c;++x){let v=x<c?t[x]:-1;if(v===p){++p;continue}if(f<p){const y=o.subarray(d*l),b=i.subarray(f*l),w=(p-f)*l;eR(b,y,w)}if(x>=c){const y=r.length;v=Math.floor(y/l)}if(v>p)if(this.defaultValue.length===1)i.subarray(p*l,v*l).fill(this.defaultValue[0]),p=v;else for(;v>p;){const y=i.slice(p*l);eR(y,u,l),++p}v<0?(d=x+1,f=p):(d=x,f=p,p=f+1)}}}function eR(n,e,t){for(let r=0;r<t;r++)n[r]=e[r]}function tR(n,e){const t=[];for(let r of n){if(r<0){if(!e)throw new Error(`Dimension ${r} must be >= 0`);if(r<-1)throw new Error(`Dimension ${r} must be >= -1`);r=-1}t.push(r)}return t}function fV(n,e,t,r,s,o,i,a,l,c){return new Q2(n,e,t,r,s,o,i,a,l,c).compute()}function hV(n,e,t,r){const s=n===e,o=n<e&&t<0,i=e<n&&t>1;if(s||o||i)return mo(0,r);const a=Math.abs(Math.ceil((e-n)/t)),l=mo(a,r);e<n&&t===1&&(t=-1),l[0]=n;for(let c=1;c<l.length;c++)l[c]=l[c-1]+t;return l}const pV=vc(n=>1/Math.sqrt(n)),Fxe=Ed(G1,pV),Pxe={kernelName:G1,backendName:"cpu",kernelFunc:Fxe};function df(n,e,t,r,s,o,i,a,l,c){const u=[r/s,s],d=n.values,f=e.values;if(r===0)return $n(t,e.dtype);const p=l instanceof to?l:$n(u,e.dtype);typeof l=="string"||typeof l=="number"?p.values.fill(l):typeof l=="boolean"&&p.values.fill(+l);for(let x=0;x<o;x++){const v=[];let y=0;for(let b=0;b<i;b++){const w=d[x*i+b];v.push(w),y+=w*a[b]}if(y<0||y>=r/s)throw new Error(`Invalid indices: ${v} does not index into ${t}`);for(let b=0;b<s;b++)c?p.values[y*s+b]+=f[x*s+b]:p.values[y*s+b]=e.rank===0?f[0]:f[x*s+b]}return p}const Oxe=vc(n=>1/(1+Math.exp(-n))),mV=mr(Z1,n=>1/(1+Math.exp(-n))),Mxe={kernelName:Z1,backendName:"cpu",kernelFunc:mV};function gV(n,e,t,r,s){const o=N8(r,e,t),i=Le(t),a=nn(r);if(o){const d=E8(e,a);return s==="string"?n.slice(d,d+i):n.subarray(d,d+i)}const l=s==="string"?Gc(n):n,c=$n(r,s,l),u=$n(t,s);for(let d=0;d<u.size;++d){const f=u.indexToLoc(d),p=f.map((x,v)=>x+e[v]);u.set(c.get(...p),...f)}return s==="string"?vL(u.values):u.values}function Mf(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{begin:o,size:i}=r;Mt(s,"slice");const[a,l]=Jb(s,o,i);k8(s,a,l);const c=t.data.get(s.dataId).values,u=gV(c,a,l,s.shape,s.dtype);return t.makeTensorInfo(l,s.dtype,u)}const Lxe={kernelName:Pb,backendName:"cpu",kernelFunc:Mf};function xV(n,e,t,r,s,o,i){const a=e[0],l=o[0],c=new Array(l),u=new Array(a),d=e[1];if(l===0){if(a!==0)throw new Error(oL(a));const y=ns(t,0),b=ns(s,0);return[y,[0,d],b,c,u]}let f=!0,p=0;const x=new Array(l).fill(0);for(let y=0;y<a;++y){const b=n[y*d];if(b<0)throw new Error(iL(y,b));if(b>=l)throw new Error(aL(y,b,l));++x[b],f=f&&b>=p,p=b}let v=!0;for(let y=0;y<l;++y){const b=x[y]===0;c[y]=b,v=v&&!b,x[y]=Math.max(x[y],1),y>0&&(x[y]+=x[y-1])}if(v&&f){const y=n,b=r;for(let w=0;w<a;++w)u[w]=w;return[y,[a,d],b,c,u]}else{const y=x[l-1],b=ns(t,y*d),w=ns(s,y),S=new Array(l).fill(0);for(let k=0;k<a;++k){const N=n[k*d],I=S[N],T=(N===0?0:x[N-1])+I;S[N]++;for(let F=0;F<d;++F)b[T*d+F]=n[k*d+F];w[T]=r[k],u[k]=T}for(let k=0;k<l;++k)if(S[k]===0){const I=k===0?0:x[k-1];b[I*d+0]=k;for(let T=1;T<d;++T)b[I*d+T]=0;w[I]=i}return[b,[y,d],w,c,u]}}function vV(n,e,t,r,s){const o=Le(r),i=e[0],a=s.length,l=[];let c=1,u=-1;for(let y=0;y<a;++y){const b=s[y];if(b===-1){if(u!==-1)throw new Error(lL(u,y));u=y,l.push(1)}else{if(b<0)throw new Error(cL(y,b));c*=b,l.push(b)}}if(u!==-1){if(c<=0)throw new Error(uL());const y=Math.trunc(o/c);if(c*y!==o)throw new Error(dL(r,l));l[u]=y}if(Le(l)!==o)throw new Error(fL(r,l));const f=r.length,p=[];if(f>0){p[f-1]=1;for(let y=f-2;y>=0;--y)p[y]=p[y+1]*r[y+1]}const x=[];if(a>0){x[a-1]=1;for(let y=a-2;y>=0;--y)x[y]=x[y+1]*l[y+1]}const v=ns(t,i*a);for(let y=0;y<i;++y){let b=0;for(let w=0;w<f;++w)b+=n[y*f+w]*p[w];for(let w=0;w<a;++w)v[y*a+w]=Math.trunc(b/x[w]),b%=x[w]}return[v,[i,a],l]}function yN(n,e,t,r,s,o=!1,i=0){const a=r.length,l=[e[0],n.length/e[0]],c=l[1],d=a>0?s[a-1]+1:0;if(d<0)throw new Error(q5());const f=e.slice();f[0]=d;const p=f.reduce((S,k)=>S*k,1),x=ns(t,p);if(a===0)return d>0&&x.fill(i),[x,f];if(d<=0)throw new Error(q5());let v=0,y=1,b=0,w=s[v];for(;;){let S=0;if(y<a){if(S=s[y],w===S){++y;continue}if(w>=S)throw new Error(hL())}if(w<0||w>=d)throw new Error(pL(w,d));w>b&&x.fill(i,b*c,w*c);for(let k=v;k<y;++k){const N=r[k];if(N<0||N>=l[0])throw new Error(mL(k,r[k],l[0]));for(let I=0;I<c;I++)x[w*c+I]+=n[N*c+I]}if(o)for(let k=0;k<c;k++)x[w*c+k]/=y-v;if(v=y,++y,b=w+1,w=S,y>a)break}return b<d&&x.fill(i,b*c,d*c),[x,f]}const jxe=vc(n=>Math.sqrt(n)),Bxe=mr(Q1,n=>Math.sqrt(n)),Vxe={kernelName:Q1,backendName:"cpu",kernelFunc:Bxe};const yV=as(((n,e)=>{const t=n-e;return t*t})),zxe=Ts(e0,yV),Wxe={kernelName:e0,backendName:"cpu",kernelFunc:zxe};const bV=vc((n,e)=>{const{pattern:t,replaceGlobal:r,rewrite:s}=e;return n.replace(new RegExp(t,r?"g":""),s)}),Uxe=Ed(LS,bV),Hxe={kernelName:LS,backendName:"cpu",kernelFunc:Uxe};function wV(n,e,t,r){const s=$n(n,e.dtype);for(let o=0;o<s.size;o++){const i=s.indexToLoc(o),a=new Array(i.length);for(let l=0;l<a.length;l++)a[l]=i[l]*t[l]+r[l];s.set(e.get(...a),...i)}return s}class Gxe{constructor(e,t,r,s,o,i){this.separator=Qu(e),this.nGramWidths=t,this.leftPad=Qu(r),this.rightPad=Qu(s),this.padWidth=o,this.preserveShort=i}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){const r=this.getPadWidth(t);return Math.max(0,e+2*r-t+1)}createNGrams(e,t,r,s,o,i){for(let a=0;a<o;++a){const l=this.getPadWidth(i),c=Math.max(0,l-a),u=Math.max(0,l-(o-(a+1))),d=i-(c+u),f=t+(c>0?0:a-l);let p=0;p+=c*this.leftPad.length;for(let w=0;w<d;++w)p+=e[f+w].length;p+=u*this.rightPad.length;const x=c+u+d-1;p+=x*this.separator.length,r[s+a]=new Uint8Array(p);const v=r[s+a];let y=0;const b=w=>w.forEach(S=>v[y++]=S);for(let w=0;w<c;++w)b(this.leftPad),b(this.separator);for(let w=0;w<d-1;++w)b(e[f+w]),b(this.separator);if(d>0){b(e[f+d-1]);for(let w=0;w<u;++w)b(this.separator),b(this.rightPad)}else{for(let w=0;w<u-1;++w)b(this.rightPad),b(this.separator);b(this.rightPad)}}}compute(e,t){const r=e.length,s=t.length;if(s>0){let l=t[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let c=1;c<s;++c){let u=t[c]>=l;if(u=u&&t[c]<=r,!u)throw new Error(`Invalid split value ${t[c]}, must be in [${l}, ${r}]`);l=t[c]}if(l!==r)throw new Error(`Last split value must be data size. Expected ${r}, got ${l}`)}const o=s-1,i=ns("int32",s);if(r===0||s===0){const l=new Array(r);for(let c=0;c<=o;++c)i[c]=0;return[l,i]}i[0]=0;for(let l=1;l<=o;++l){const c=t[l]-t[l-1];let u=0;this.nGramWidths.forEach(d=>{u+=this.getNumNGrams(c,d)}),this.preserveShort&&c>0&&u===0&&(u=1),i[l]=i[l-1]+u}const a=new Array(i[o]);for(let l=0;l<o;++l){const c=t[l];let u=i[l];if(this.nGramWidths.forEach(d=>{const f=t[l+1]-t[l],p=this.getNumNGrams(f,d);this.createNGrams(e,c,a,u,p,d),u+=p}),this.preserveShort&&u===i[l]){const d=t[l+1]-t[l];if(d===0)continue;const f=d+2*this.padWidth;this.createNGrams(e,c,a,u,1,f)}}return[a,i]}}function CV(n,e,t,r,s,o,i,a){return new Gxe(t,r,s,o,i,a).compute(n,e)}function qxe(n,e,t,r){if(!n.length)return;if(e.length===0){for(let o=0;o<n.length;++o)r.push(n.subarray(o,o+1));return}if(e.length===1){const o=e[0];let i=n.indexOf(o);for(;i!==-1;){const a=n.subarray(0,i);(!t||a.length!==0)&&r.push(a),n=n.subarray(i+1),i=n.indexOf(o)}(!t||n.length!==0)&&r.push(n);return}let s=0;for(let o=0;o<n.length+1;o++)if(o===n.length||e.indexOf(n[o])!==-1){const i=n.subarray(s,o);(!t||i.length!==0)&&r.push(i),s=o+1}}function kV(n,e,t){const r=n.length,s=[];let o=0,i=0;const a=new Array(r);for(let f=0;f<r;++f){const p=s.length;qxe(n[f],e,t,s);const x=s.length-p;a[f]=x,o+=x,i=Math.max(i,x)}const l=ns("int32",o*2),c=new Array(o),u=[r,i];let d=0;for(let f=0;f<r;++f)for(let p=0;p<a[f];++p)l[d*2]=f,l[d*2+1]=p,c[d]=s[d],++d;return[l,c,u]}function SV(n,e){const t=ns("int32",n.length);for(let r=0;r<n.length;++r)t[r]=Sle(n[r]).modulo(e).getLowBitsUnsigned();return t}const NV=as(((n,e)=>n-e)),Kxe=mN(((n,e,t,r)=>({real:n-t,imag:e-r}))),bN=Ts(t0,NV,Kxe),Xxe={kernelName:t0,backendName:"cpu",kernelFunc:bN};function EV(n,e){const t=new Array(n.rank);for(let s=0;s<t.length;s++)t[s]=n.shape[s]*e[s];const r=$n(t,n.dtype);for(let s=0;s<r.values.length;++s){const o=r.indexToLoc(s),i=new Array(n.rank);for(let l=0;l<i.length;l++)i[l]=o[l]%n.shape[l];const a=n.locToIndex(i);r.values[s]=n.values[a]}return r}const og=(n,e)=>{const t=e.value-n.value;return t===0?n.index-e.index:t};function IV(n,e,t=0,r=n.length-1){for(;r>t;){if(r-t>600){const a=r-t+1,l=e-t+1,c=Math.log(a),u=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*u*(a-u)/a)*Math.sign(l-a/2),f=Math.max(t,Math.floor(e-l*u/a+d)),p=Math.min(r,Math.floor(e+(a-l)*u/a+d));IV(n,e,f,p)}const s=n[e];let o=t,i=r;for(Qh(n,t,e),og(n[r],s)>0&&Qh(n,t,r);o<i;){for(Qh(n,o,i),o++,i--;og(n[o],s)<0;)o=o+1;for(;og(n[i],s)>0;)i=i-1}og(n[t],s)===0?Qh(n,t,i):(i=i+1,Qh(n,i,r)),i<=e&&(t=i+1),e<=i&&(r=i-1)}}function TV(n,e,t,r,s){const o=e[e.length-1],[i,a]=[n.length/o,o],l=po(t,i*r),c=po("int32",i*r);for(let d=0;d<i;d++){const f=d*a,p=n.subarray(f,f+a);let x=new Array(p.length);p.forEach((w,S)=>x[S]={value:w,index:S}),r<x.length&&(IV(x,r),x=x.slice(0,r)),s&&x.sort(og);const v=d*r,y=l.subarray(v,v+r),b=c.subarray(v,v+r);for(let w=0;w<r;w++)y[w]=x[w].value,b[w]=x[w].index}const u=e.slice();return u[u.length-1]=r,[$n(u,t,l),$n(u,"int32",c)]}function _V(n,e,t,r){const s=Fn(e,t)[0],o=[1,t[0],1];for(let x=0;x<s;x++)o[0]*=t[x];o[1]=t[s];for(let x=s+1;x<t.length;x++)o[2]*=t[x];const i=new Map,a=new Int32Array(t[s]),l=new to(o,r,n),c=[],u=o[0]===1&&o[2]===1;for(let x=0;x<t[s];x++){let v;if(u)v=n[x].toString();else{const b=[];for(let w=0;w<o[0];w++)for(let S=0;S<o[2];S++)b.push(l.get(w,x,S));v=b.join(",")}const y=i.get(v);if(y!=null)a[x]=y;else{const b=i.size;i.set(v,b),a[x]=b,c.push(x)}}const d=o.slice();d[1]=i.size;const f=new to(d,r);c.forEach((x,v)=>{for(let y=0;y<o[0];y++)for(let b=0;b<o[2];b++)f.set(l.get(y,x,b),y,v,b)});const p=t.slice();return p[s]=d[1],{outputValues:f.values,outputShape:p,indices:a}}const Yxe=Object.freeze(Object.defineProperty({__proto__:null,addImpl:LB,bincountImpl:gN,bincountReduceImpl:jB,bitwiseAndImpl:BB,castImpl:MB,ceilImpl:VB,concatImpl:zB,equalImpl:WB,expImpl:HB,expm1Impl:qB,floorDivImpl:XB,floorImpl:KB,gatherNdImpl:YB,gatherV2Impl:ZB,greaterEqualImpl:QB,greaterImpl:JB,lessEqualImpl:tV,lessImpl:eV,linSpaceImpl:nV,logImpl:rV,maxImpl:sV,maximumImpl:oV,minimumImpl:iV,multiplyImpl:xN,negImpl:aV,notEqualImpl:lV,prodImpl:cV,raggedGatherImpl:uV,raggedRangeImpl:dV,raggedTensorToTensorImpl:fV,rangeImpl:hV,rsqrtImpl:pV,scatterImpl:df,sigmoidImpl:Oxe,simpleAbsImpl:OB,sliceImpl:gV,sparseFillEmptyRowsImpl:xV,sparseReshapeImpl:vV,sparseSegmentReductionImpl:yN,sqrtImpl:jxe,squaredDifferenceImpl:yV,staticRegexReplaceImpl:bV,stridedSliceImpl:wV,stringNGramsImpl:CV,stringSplitImpl:kV,stringToHashBucketFastImpl:SV,subImpl:NV,tileImpl:EV,topKImpl:TV,transposeImpl:vN,uniqueImpl:_V},Symbol.toStringTag,{value:"Module"}));KO("cpu",()=>new fw,1);const RV=mr(S1,n=>n>=0?n:Math.exp(n)-1),Zxe={kernelName:S1,backendName:"cpu",kernelFunc:RV};function DV(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{alpha:o}=r;Mt([s],"leakyRelu");const i=Le(s.shape),a=t.data.get(s.dataId).values,l=po("float32",i);for(let c=0;c<a.length;c++)l[c]=a[c]<0?o*a[c]:a[c];return t.makeTensorInfo(s.shape,"float32",l)}const Jxe={kernelName:cb,backendName:"cpu",kernelFunc:DV};const Qxe=as((n,e)=>n<0?e*n:n);function AV(n){const{inputs:e,backend:t}=n,{x:r,alpha:s}=e;Mt([r,s],"prelu");const o=t.data.get(r.dataId).values,i=t.data.get(s.dataId).values,[a,l]=Qxe(r.shape,s.shape,o,i,"float32");return t.makeTensorInfo(l,"float32",a)}const eve={kernelName:Tb,backendName:"cpu",kernelFunc:AV};const $V=mr(W1,n=>Math.max(0,n)),tve={kernelName:W1,backendName:"cpu",kernelFunc:$V};const FV=mr(U1,n=>Math.min(Math.max(0,n),6)),nve={kernelName:U1,backendName:"cpu",kernelFunc:FV};function ey(n,e,t,r,s){if(t==="linear")return dc({inputs:{x:e},backend:n});if(t==="relu")return $V({inputs:{x:e},backend:n});if(t==="elu")return RV({inputs:{x:e},backend:n});if(t==="relu6")return FV({inputs:{x:e},backend:n});if(t==="prelu")return AV({inputs:{x:e,alpha:r},backend:n});if(t==="leakyrelu")return DV({inputs:{x:e},backend:n,attrs:{alpha:s}});if(t==="sigmoid")return mV({inputs:{x:e},backend:n});throw new Error(`Activation ${t} has not been implemented for the CPU backend.`)}function Tr(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{shape:o}=r,i=Le(s.shape),a=rO(o,i),l=Le(a);X(i===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${s.shape}) has ${i} elements. The new shape and old shape must have the same number of elements.`),t.incRef(s.dataId);const c=t.data.get(s.dataId);if(c.complexTensorInfos!=null){const u=c.complexTensorInfos.real,d=c.complexTensorInfos.imag;u.shape=a,d.shape=a}return{dataId:s.dataId,shape:a,dtype:s.dtype}}const rve={kernelName:Rb,backendName:"cpu",kernelFunc:Tr};function PV(n){const{inputs:e,backend:t,attrs:r}=n,{a:s,b:o}=e,{transposeA:i,transposeB:a}=r;Mt([s,o],"matMul");const l=s.shape.length,c=o.shape.length,u=i?s.shape[l-2]:s.shape[l-1],d=a?o.shape[c-1]:o.shape[c-2],f=i?s.shape[l-1]:s.shape[l-2],p=a?o.shape[c-2]:o.shape[c-1],x=s.shape.slice(0,-2),v=o.shape.slice(0,-2),y=Le(x),b=Le(v),S=Sn(s.shape.slice(0,-2),o.shape.slice(0,-2)).concat([f,p]);X(u===d,()=>`Error in matMul: inner shapes (${u}) and (${d}) of Tensors with shapes ${s.shape} and ${o.shape} and transposeA=${i} and transposeB=${a} must match.`);const k=i?[y,u,f]:[y,f,u],N=a?[b,p,d]:[b,d,p],I=Tr({inputs:{x:s},backend:t,attrs:{shape:k}}),T=Tr({inputs:{x:o},backend:t,attrs:{shape:N}}),F=i?I.shape[1]:I.shape[2],R=i?I.shape[2]:I.shape[1],D=a?T.shape[1]:T.shape[2],A=Math.max(y,b),P=t.data.get(I.dataId).values,B=t.data.get(T.dataId).values,L=nn(I.shape),W=nn(T.shape),[H,G,M]=i?[L[0],1,L[1]]:[L[0],L[1],1],[j,z,V]=a?[1,W[1],W[0]]:[W[1],1,W[0]],K=R*D,J=$n([A,R,D],I.dtype),oe=J.values,Z=t.blockSize;for(let de=0;de<A;de++){const pe=de%y,Ce=de%b;for(let Ae=0;Ae<R;Ae+=Z){const ze=Math.min(Ae+Z,R);for(let et=0;et<D;et+=Z){const gt=Math.min(et+Z,D);for(let dt=0;dt<F;dt+=Z){const Ct=Math.min(dt+Z,F);for(let lt=Ae;lt<ze;lt++)for(let bt=et;bt<gt;bt++){let rn=0;for(let Ft=dt;Ft<Ct;Ft++){const vn=P[pe*H+lt*G+Ft*M],te=B[Ft*j+bt*z+Ce*V];rn+=vn*te}oe[de*K+(lt*D+bt)]+=rn}}}}}return t.disposeIntermediateTensorInfo(I),t.disposeIntermediateTensorInfo(T),t.makeTensorInfo(S,J.dtype,J.values)}const sve={kernelName:Ky,backendName:"cpu",kernelFunc:PV};function ove(n){const{inputs:e,backend:t,attrs:r}=n,{a:s,b:o,bias:i,preluActivationWeights:a}=e,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:d}=r;let f,p,x;const v=[];f=PV({inputs:{a:s,b:o},attrs:{transposeA:l,transposeB:c},backend:t}),i&&(p=Pp({inputs:{a:f,b:i},backend:t}),v.push(f),f=p),u&&(x=ey(t,f,u,a,d),v.push(f),f=x);for(const b of v)t.disposeIntermediateTensorInfo(b);return f}const ive={kernelName:F2,backendName:"cpu",kernelFunc:ove};const ave=mr(d1,n=>Math.acos(n)),lve={kernelName:d1,backendName:"cpu",kernelFunc:ave};const cve=mr(f1,n=>Math.acosh(n)),uve={kernelName:f1,backendName:"cpu",kernelFunc:cve};function dve(n){const{inputs:e,backend:t}=n,r=e;Mt(e,"addN");const s=r.map(a=>t.data.get(a.dataId).values),o=$n(r[0].shape,r[0].dtype),i=o.values;for(let a=0;a<r.length;a++){const l=s[a];for(let c=0;c<i.length;c++)i[c]+=l[c]}return t.makeTensorInfo(o.shape,o.dtype,o.values)}const fve={kernelName:rS,backendName:"cpu",kernelFunc:dve};function hve(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:o,keepDims:i}=r;Mt(s,"all");const a=Fn(o,s.shape);let l=a;const c=Ur(l,s.shape.length);let u=s;c!=null&&(u=ri({inputs:{x:s},backend:t,attrs:{perm:c}}),l=os(l.length,s.shape.length)),so("all",l,u.shape.length);const[d,f]=Ws(u.shape,l),p=Le(f),x=mo(Le(d),u.dtype),v=t.data.get(u.dataId).values;for(let b=0;b<x.length;++b){const w=b*p;let S=v[w];for(let k=0;k<p;++k){const N=v[w+k];S=S&&N}x[b]=S}c!=null&&t.disposeIntermediateTensorInfo(u);const y=t.makeTensorInfo(d,u.dtype,x);if(i){const b=ps(d,a),w=Tr({inputs:{x:y},backend:t,attrs:{shape:b}});return t.disposeIntermediateTensorInfo(y),w}return y}const pve={kernelName:sS,backendName:"cpu",kernelFunc:hve};function mve(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:o,keepDims:i}=r;Mt(s,"any");const a=Fn(o,s.shape);let l=a;const c=Ur(l,s.shape.length);let u=s;c!=null&&(u=ri({inputs:{x:s},backend:t,attrs:{perm:c}}),l=os(l.length,s.shape.length)),so("any",l,u.shape.length);const[d,f]=Ws(u.shape,l),p=Le(f),x=mo(Le(d),u.dtype),v=t.data.get(u.dataId).values;for(let b=0;b<x.length;++b){const w=b*p;let S=v[w];for(let k=0;k<p;++k){const N=v[w+k];S=S||N}x[b]=S}c!=null&&t.disposeIntermediateTensorInfo(u);const y=t.makeTensorInfo(d,u.dtype,x);if(i){const b=ps(d,a),w=Tr({inputs:{x:y},backend:t,attrs:{shape:b}});return t.disposeIntermediateTensorInfo(y),w}return y}const gve={kernelName:oS,backendName:"cpu",kernelFunc:mve};function xve(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:o}=r;Mt(s,"argMax");let i=Fn(o,s.shape);const a=Ur(i,s.shape.length);let l=s;const c=[];a!=null&&(l=ri({inputs:{x:s},backend:t,attrs:{perm:a}}),c.push(l),i=os(i.length,l.shape.length)),i=[i[0]],so("argMax",i,l.shape.length);const[u,d]=Ws(l.shape,i),f=Le(u),p=mo(f,"int32"),x=Le(d),v=t.data.get(l.dataId).values;for(let y=0;y<p.length;++y){const b=y*x;let w=v[b],S=0;for(let k=0;k<x;++k){const N=v[b+k];N>w&&(w=N,S=k)}p[y]=S}return c.forEach(y=>t.disposeIntermediateTensorInfo(y)),t.makeTensorInfo(u,"int32",p)}const vve={kernelName:Uy,backendName:"cpu",kernelFunc:xve};function yve(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:o}=r;Mt(s,"argMin");let i=Fn(o,s.shape);const a=Ur(i,s.shape.length);let l=s;const c=[];a!=null&&(l=ri({inputs:{x:s},backend:t,attrs:{perm:a}}),c.push(l),i=os(i.length,l.shape.length)),i=[i[0]],so("argMin",i,l.shape.length);const[u,d]=Ws(l.shape,i),f=Le(u),p=mo(f,"int32"),x=Le(d),v=t.data.get(l.dataId).values;for(let y=0;y<p.length;++y){const b=y*x;let w=v[b],S=0;for(let k=0;k<x;++k){const N=v[b+k];N<w&&(w=N,S=k)}p[y]=S}return c.forEach(y=>t.disposeIntermediateTensorInfo(y)),t.makeTensorInfo(u,"int32",p)}const bve={kernelName:Hy,backendName:"cpu",kernelFunc:yve};const wve=mr(h1,n=>Math.asin(n)),Cve={kernelName:h1,backendName:"cpu",kernelFunc:wve};const kve=mr(p1,n=>Math.asinh(n)),Sve={kernelName:p1,backendName:"cpu",kernelFunc:kve};const Nve=mr(m1,n=>Math.atan(n)),Eve={kernelName:m1,backendName:"cpu",kernelFunc:Nve};const Ive=as((n,e)=>Math.atan2(n,e)),Tve=Ts(x1,Ive),_ve={kernelName:x1,backendName:"cpu",kernelFunc:Tve};const Rve=mr(g1,n=>Math.atanh(n)),Dve={kernelName:g1,backendName:"cpu",kernelFunc:Rve};function wN(n,e,t,r,s,o){const i=s.strideHeight,a=s.strideWidth,l=s.dilationHeight,c=s.dilationWidth,u=s.effectiveFilterHeight,d=s.effectiveFilterWidth,f=s.padInfo.top,p=s.padInfo.left,x=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=$n(s.outShape,t),y=v.values,b=s.outShape[1]*s.outShape[2]*s.outShape[3],w=s.outShape[2]*s.outShape[3],S=s.outShape[3];for(let k=0;k<s.batchSize;++k){const N=k*b,I=k*r[0];for(let T=0;T<s.inChannels;++T)for(let F=0;F<s.outHeight;++F){const R=F*i-f,D=Math.max(0,R),A=Math.min(s.inHeight,u+R),P=N+F*w;for(let B=0;B<s.outWidth;++B){const L=B*a-p,W=Math.max(0,L),H=Math.min(s.inWidth,d+L);let G=x,M=0,j=0;for(let V=D;V<A;V+=l){const K=I+V*r[1];for(let J=W;J<H;J+=c){const oe=K+J*r[2],Z=n[oe+T];o==="max"&&Z>G?G=Z:o==="avg"&&(M+=Z,j++)}if(isNaN(G))break}const z=P+B*S+T;y[z]=o==="avg"?M/j:G}}}return v}function OV(n,e,t,r,s=!1,o=!1){const i=$n(r.outShape,"int32"),a=r.strideHeight,l=r.strideWidth,c=r.dilationHeight,u=r.dilationWidth,d=r.effectiveFilterHeight,f=r.effectiveFilterWidth,p=r.padInfo.top,x=r.padInfo.left,v=$n(e,t,n);for(let y=0;y<r.batchSize;++y)for(let b=0;b<r.inChannels;++b)for(let w=0;w<r.outHeight;++w){const S=w*a-p;let k=S;for(;k<0;)k+=c;const N=Math.min(r.inHeight,d+S);for(let I=0;I<r.outWidth;++I){const T=I*l-x;let F=T;for(;F<0;)F+=u;const R=Math.min(r.inWidth,f+T);let D=Number.NEGATIVE_INFINITY,A=-1;for(let P=k;P<N;P+=c){const B=P-S;for(let L=F;L<R;L+=u){const W=L-T,H=v.get(y,P,L,b);H>D&&(D=H,s?A=o?((y*r.inHeight+P)*r.inWidth+L)*r.inChannels+b:(P*r.inWidth+L)*r.inChannels+b:A=B*f+W)}}i.set(A,y,w,I,b)}}return i}function MV(n,e,t,r,s,o){const i=s.strideDepth,a=s.strideHeight,l=s.strideWidth,c=s.dilationDepth,u=s.dilationHeight,d=s.dilationWidth,f=s.effectiveFilterDepth,p=s.effectiveFilterHeight,x=s.effectiveFilterWidth,v=s.padInfo.front,y=s.padInfo.top,b=s.padInfo.left,w=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,S=$n(s.outShape,t),k=S.values,N=s.outShape[1]*s.outShape[2]*s.outShape[3]*s.outShape[4],I=s.outShape[2]*s.outShape[3]*s.outShape[4],T=s.outShape[3]*s.outShape[4],F=s.outShape[4];for(let R=0;R<s.batchSize;++R){const D=R*N,A=R*r[0];for(let P=0;P<s.inChannels;++P)for(let B=0;B<s.outDepth;++B){const L=B*i-v;let W=L;for(;W<0;)W+=c;const H=Math.min(s.inDepth,f+L),G=D+B*I;for(let M=0;M<s.outHeight;++M){const j=M*a-y;let z=j;for(;z<0;)z+=u;const V=Math.min(s.inHeight,p+j),K=G+M*T;for(let J=0;J<s.outWidth;++J){const oe=J*l-b;let Z=oe;for(;Z<0;)Z+=d;const de=Math.min(s.inWidth,x+oe),pe=K+J*F;let Ce=w,Ae=0,ze=0;for(let gt=W;gt<H;gt+=c){const dt=A+gt*r[1];for(let Ct=z;Ct<V;Ct+=u){const lt=dt+Ct*r[2];for(let bt=Z;bt<de;bt+=d){const rn=lt+bt*r[3],Ft=n[rn+P];if(o==="max"&&Ft>Ce?Ce=Ft:o==="avg"&&(Ae+=Ft,ze++),isNaN(Ce))break}if(isNaN(Ce))break}if(isNaN(Ce))break}const et=pe+P;k[et]=o==="avg"?Ae/Math.max(ze,1):Ce}}}}return S}function Ave(n,e){const t=$n(e.outShape,"int32"),r=e.strideDepth,s=e.strideHeight,o=e.strideWidth,i=e.dilationDepth,a=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterDepth,u=e.effectiveFilterHeight,d=e.effectiveFilterWidth,f=e.padInfo.front,p=e.padInfo.top,x=e.padInfo.left;for(let v=0;v<e.batchSize;++v)for(let y=0;y<e.inChannels;++y)for(let b=0;b<e.outDepth;++b){const w=b*r-f;let S=w;for(;S<0;)S+=i;const k=Math.min(e.inDepth,c+w);for(let N=0;N<e.outHeight;++N){const I=N*s-p;let T=I;for(;T<0;)T+=a;const F=Math.min(e.inHeight,u+I);for(let R=0;R<e.outWidth;++R){const D=R*o-x;let A=D;for(;A<0;)A+=l;const P=Math.min(e.inWidth,d+D);let B=Number.NEGATIVE_INFINITY,L=-1;for(let W=S;W<k;W+=i){const H=W-w;for(let G=T;G<F;G+=a){const M=G-I;for(let j=A;j<P;j+=l){const z=j-D,V=n.get(v,W,G,j,y);V>=B&&(B=V,L=H*u*d+M*u+z)}}}t.set(L,v,b,N,R,y)}}}return t}function $ve(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e;Mt(s,"avgPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:l}=r,c=1;X(xo(i,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);const u=$a(s.shape,o,i,c,a,l);let d;if(u.filterWidth===1&&u.filterHeight===1&&lr(u.inShape,u.outShape))d=dc({inputs:{x:s},backend:t});else{const f=t.data.get(s.dataId).values,p=nn(s.shape),x=wN(f,s.shape,s.dtype,p,u,"avg");d=t.makeTensorInfo(u.outShape,s.dtype,x.values)}return d}const Fve={kernelName:Gy,backendName:"cpu",kernelFunc:$ve};function Pve(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:l,dataFormat:c}=r;Mt(s,"avgPool3d");const u=eu(s.shape,o,i,1,a,l,c),d=t.data.get(s.dataId).values,f=MV(d,s.shape,s.dtype,nn(s.shape),u,"avg");return t.makeTensorInfo(f.shape,"float32",f.values)}const Ove={kernelName:qy,backendName:"cpu",kernelFunc:Pve};function Mve(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:o}=e,{filterSize:i,strides:a,pad:l,dimRoundingMode:c}=r;Mt([s,o],"avgPool3DGrad");const u=eu(o.shape,i,a,1,l,c),d=u.strideDepth,f=u.strideHeight,p=u.strideWidth,x=u.filterDepth,v=u.filterHeight,y=u.filterWidth,b=u.dilationDepth,w=u.dilationHeight,S=u.dilationWidth,k=u.effectiveFilterDepth,N=u.effectiveFilterHeight,I=u.effectiveFilterWidth,T=k-1-u.padInfo.front,F=I-1-u.padInfo.left,R=N-1-u.padInfo.top,D=$n(o.shape,"float32"),A=1/(x*v*y),P=t.bufferSync(s);for(let B=0;B<u.batchSize;++B)for(let L=0;L<u.inChannels;++L)for(let W=0;W<u.inDepth;++W)for(let H=0;H<u.inHeight;++H)for(let G=0;G<u.inWidth;++G){const M=W-T,j=H-R,z=G-F;let V=0;for(let K=0;K<k;K+=b){const J=(M+K)/d;if(!(J<0||J>=u.outDepth||Math.floor(J)!==J))for(let oe=0;oe<N;oe+=w){const Z=(j+oe)/f;if(!(Z<0||Z>=u.outHeight||Math.floor(Z)!==Z))for(let de=0;de<I;de+=S){const pe=(z+de)/p;if(pe<0||pe>=u.outWidth||Math.floor(pe)!==pe)continue;const Ce=P.get(B,J,Z,pe,L);V+=Ce}}}D.set(V*A,B,W,H,G,L)}return t.makeTensorInfo(D.shape,D.dtype,D.values)}const Lve={kernelName:aS,backendName:"cpu",kernelFunc:Mve};function jve(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:o}=e,i=o;Mt([s,o],"avgPoolGrad");const{filterSize:a,strides:l,pad:c}=r,u=$a(i.shape,a,l,1,c),d=u.strideHeight,f=u.strideWidth,p=u.filterHeight,x=u.filterWidth,v=u.dilationHeight,y=u.dilationWidth,b=u.effectiveFilterHeight,w=u.effectiveFilterWidth,S=w-1-u.padInfo.left,k=b-1-u.padInfo.top,N=$n(i.shape,"float32"),I=1/(p*x),T=t.data.get(s.dataId).values,F=$n(s.shape,"float32",T);for(let R=0;R<u.batchSize;++R)for(let D=0;D<u.inChannels;++D)for(let A=0;A<u.inHeight;++A)for(let P=0;P<u.inWidth;++P){const B=A-k,L=P-S;let W=0;for(let H=0;H<b;H+=v){const G=(B+H)/d;if(!(G<0||G>=u.outHeight||Math.floor(G)!==G))for(let M=0;M<w;M+=y){const j=(L+M)/f;if(j<0||j>=u.outWidth||Math.floor(j)!==j)continue;const z=F.get(R,G,j,D);W+=z}}N.set(W*I,R,A,P,D)}return t.makeTensorInfo(N.shape,N.dtype,N.values)}const Bve={kernelName:iS,backendName:"cpu",kernelFunc:jve};function Vve(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,scale:o,offset:i,mean:a,variance:l}=e;X(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),X(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),X(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),Mt([s,a,l,o,i],"batchNorm");let{varianceEpsilon:c}=r;c==null&&(c=.001);const u=t.data.get(s.dataId).values,d=t.data.get(a.dataId).values,f=t.data.get(l.dataId).values,p=o?t.data.get(o.dataId).values:new Float32Array([1]),x=i?t.data.get(i.dataId).values:new Float32Array([0]),v=new Float32Array(u.length),y=x.length,b=p.length,w=f.length,S=d.length;let k=0,N=0,I=0,T=0;for(let F=0;F<u.length;++F)v[F]=x[k++]+(u[F]-d[N++])*p[I++]/Math.sqrt(f[T++]+c),k>=y&&(k=0),N>=S&&(N=0),I>=b&&(I=0),T>=w&&(T=0);return t.makeTensorInfo(s.shape,s.dtype,v)}const zve={kernelName:ib,backendName:"cpu",kernelFunc:Vve};function Wve(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{blockShape:o,crops:i}=r;Mt([s],"batchToSpaceND");const a=o.reduce((b,w)=>b*w),l=d0(s.shape,o,a),c=f0(l.length,o.length),u=h0(s.shape,o,a),d=D8(i,o.length),f=A8(u,i,o.length),p=Tr({inputs:{x:s},backend:t,attrs:{shape:l}}),x=ri({inputs:{x:p},backend:t,attrs:{perm:c}}),v=Tr({inputs:{x},backend:t,attrs:{shape:u}}),y=Mf({inputs:{x:v},backend:t,attrs:{begin:d,size:f}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(v),y}const Uve={kernelName:Xy,backendName:"cpu",kernelFunc:Wve};function Hve(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,weights:o}=e,{size:i}=r,a=t.data.get(s.dataId).values,l=t.data.get(o.dataId).values,c=gN(a,l,o.dtype,o.shape,i);return t.makeTensorInfo([i],o.dtype,c)}const Gve={kernelName:lS,backendName:"cpu",kernelFunc:Hve};function qve(n){const{inputs:e,backend:t}=n,{s0:r,s1:s}=e,o=t.data.get(r.dataId).values,i=t.data.get(s.dataId).values,a=Sn(Array.from(o),Array.from(i));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const Kve={kernelName:cO,backendName:"cpu",kernelFunc:qve};const Xve=mr(b1,(n,e)=>{const t=e;return n>t.clipValueMax?t.clipValueMax:n<t.clipValueMin?t.clipValueMin:n}),Yve={kernelName:b1,backendName:"cpu",kernelFunc:Xve};const Zve=n=>{const{x:e}=n.inputs,t=n.backend,r=new Float32Array(Le(e.shape)),s=t.data.get(e.dataId),o=s.complexTensorInfos.real,i=s.complexTensorInfos.imag,a=t.data.get(o.dataId).values,l=t.data.get(i.dataId).values;for(let c=0;c<a.length;c++){const u=a[c],d=l[c];r[c]=Math.hypot(u,d)}return t.makeOutput(r,e.shape,"float32")},Jve={kernelName:Yy,backendName:"cpu",kernelFunc:Zve};function Op(n){const{inputs:e,backend:t}=n,{input:r}=e,s=t.data.get(r.dataId).complexTensorInfos.imag,o=t.data.get(s.dataId).values;return t.makeTensorInfo(s.shape,s.dtype,o)}const Qve={kernelName:ES,backendName:"cpu",kernelFunc:Op};function Mp(n){const{inputs:e,backend:t,attrs:r}=n,{axis:s}=r,o=Fn(s,e[0].shape)[0],i=e.map(v=>v.shape);T8(i,o);let a=tc(e.map(v=>v.shape),o);if(Le(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(v=>Le(v.shape)>0);if(l.length===1)return dc({inputs:{x:l[0]},backend:t});if(l[0].dtype==="complex64"){const v=l.map(k=>Of({inputs:{input:k},backend:t})),y=l.map(k=>Op({inputs:{input:k},backend:t})),b=Mp({inputs:v,backend:t,attrs:{axis:o}}),w=Mp({inputs:y,backend:t,attrs:{axis:o}}),S=wi({inputs:{real:b,imag:w},backend:t});return v.forEach(k=>t.disposeIntermediateTensorInfo(k)),y.forEach(k=>t.disposeIntermediateTensorInfo(k)),t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(w),S}const c=l.map(v=>{const b=[-1,Le(v.shape.slice(o))];return Tr({inputs:{x:v},backend:t,attrs:{shape:b}})}),u=c.map(v=>({vals:t.data.get(v.dataId).values,shape:v.shape}));a=tc(c.map(v=>v.shape),1);const d=c[0].shape[0]===1,f=zB(u,a,e[0].dtype,d),p=tc(l.map(v=>v.shape),o),x=t.makeTensorInfo(p,e[0].dtype,f);return c.forEach(v=>t.disposeIntermediateTensorInfo(v)),x}const e2e={kernelName:Zy,backendName:"cpu",kernelFunc:Mp};function LV(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:o}=e,{strides:i,pad:a,dataFormat:l,dilations:c,dimRoundingMode:u}=r;Mt([s,o],"conv2d");const d=tu(l),f=ro(s.shape,o.shape,i,c,a,u,!1,d),p=f.filterHeight,x=f.filterWidth,v=f.dilationHeight,y=f.dilationWidth,b=f.padInfo.left,w=f.padInfo.top,S=f.dataFormat==="channelsLast",k=new to(f.outShape,s.dtype),N=nn(s.shape),I=nn(o.shape),T=N[0],F=S?N[1]:N[2],R=S?N[2]:1,D=S?1:N[1],A=k.strides[0],P=S?k.strides[1]:k.strides[2],B=S?k.strides[2]:1,L=S?1:k.strides[1],W=t.data.get(s.dataId).values,H=t.data.get(o.dataId).values,G=k.values;for(let M=0;M<f.batchSize;++M){const j=M*T,z=M*A;for(let V=0;V<f.outHeight;++V){const K=z+V*P,J=V*f.strideHeight-w;for(let oe=0;oe<p;++oe){const Z=J+oe*v;if(Z<0||Z>=f.inHeight)continue;const de=oe*I[0],pe=j+Z*F;for(let Ce=0;Ce<f.outWidth;++Ce){const Ae=K+Ce*B,ze=Ce*f.strideWidth-b;for(let et=0;et<x;++et){const gt=ze+et*y;if(gt<0||gt>=f.inWidth)continue;const dt=de+et*I[1],Ct=pe+gt*R;let lt=dt;for(let bt=0;bt<f.inChannels;++bt){const rn=W[Ct+bt*D];for(let Ft=0;Ft<f.outChannels;++Ft)G[Ae+Ft*L]+=rn*H[lt+Ft];lt+=f.outChannels}}}}}}return t.makeTensorInfo(k.shape,k.dtype,G)}const t2e={kernelName:Jy,backendName:"cpu",kernelFunc:LV};function n2e(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,dy:o}=e,{strides:i,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:u}=r;Mt([s,o],"conv2dBackpropFilter");const d=tu(l),f=ro(s.shape,u,i,1,a,c,!1,d),{strideHeight:p,strideWidth:x,filterHeight:v,filterWidth:y}=f,b=f.dataFormat==="channelsLast",w=new to(f.filterShape,"float32"),S=f.padInfo.left,k=f.padInfo.top,N=t.data.get(s.dataId).values,I=t.data.get(o.dataId).values,T=new to(s.shape,s.dtype,N),F=new to(o.shape,o.dtype,I);for(let R=0;R<v;++R){const D=Math.max(0,Math.ceil((k-R)/p)),A=Math.min(f.outHeight,(f.inHeight+k-R)/p);for(let P=0;P<y;++P){const B=Math.max(0,Math.ceil((S-P)/x)),L=Math.min(f.outWidth,(f.inWidth+S-P)/x);for(let W=0;W<f.inChannels;++W)for(let H=0;H<f.outChannels;++H){let G=0;for(let M=0;M<f.batchSize;++M)for(let j=D;j<A;++j){const z=R+j*p-k;for(let V=B;V<L;++V){const K=P+V*x-S;b?G+=T.get(M,z,K,W)*F.get(M,j,V,H):G+=T.get(M,W,z,K)*F.get(M,H,j,V)}}w.set(G,R,P,W,H)}}}return t.makeTensorInfo(w.shape,w.dtype,w.values)}const r2e={kernelName:dS,backendName:"cpu",kernelFunc:n2e};function s2e(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,filter:o}=e,{inputShape:i,strides:a,pad:l,dataFormat:c,dimRoundingMode:u}=r;Mt([s,o],"conv2dBackpropInput");const d=nn(o.shape),f=nn(s.shape);let p=tu(c);const x=ro(i,o.shape,a,1,l,u,!1,p),v=new to(x.inShape,"float32"),y=v.values,b=t.data.get(s.dataId).values,w=t.data.get(o.dataId).values,[S,k,N]=d,{batchSize:I,filterHeight:T,filterWidth:F,inChannels:R,inHeight:D,inWidth:A,outChannels:P,outHeight:B,outWidth:L,strideHeight:W,strideWidth:H}=x;p=x.dataFormat;const G=T-1-x.padInfo.top,M=F-1-x.padInfo.left,j=p==="channelsLast",z=v.strides[0],V=j?v.strides[1]:v.strides[2],K=j?v.strides[2]:1,J=j?1:v.strides[1],oe=f[0],Z=j?f[1]:f[2],de=j?f[2]:1,pe=j?1:f[1];for(let Ce=0;Ce<I;++Ce)for(let Ae=0;Ae<R;++Ae)for(let ze=0;ze<D;++ze){const et=ze-G,gt=Math.max(0,Math.ceil(et/W)),dt=Math.min(B,(T+et)/W);for(let Ct=0;Ct<A;++Ct){const lt=Ct-M,bt=Math.max(0,Math.ceil(lt/H)),rn=Math.min(L,(F+lt)/H);let Ft=0;for(let te=gt;te<dt;++te){const q=te*W-et;for(let ke=bt;ke<rn;++ke){const He=ke*H-lt,Ke=oe*Ce+Z*te+de*ke,Be=S*(T-1-q)+k*(F-1-He)+N*Ae;for(let ct=0;ct<P;++ct){const Nt=b[Ke+pe*ct],Rt=w[Be+ct];Ft+=Nt*Rt}}}const vn=z*Ce+V*ze+K*Ct+J*Ae;y[vn]=Ft}}return t.makeTensorInfo(v.shape,v.dtype,v.values)}const o2e={kernelName:Qy,backendName:"cpu",kernelFunc:s2e};function i2e(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:o}=e,{strides:i,pad:a,dilations:l}=r;Mt([s,o],"conv3d");const c=bd(s.shape,o.shape,i,l,a),{filterDepth:u,filterHeight:d,filterWidth:f,dilationDepth:p,dilationHeight:x,dilationWidth:v,padInfo:y}=c,b=y.front,w=y.left,S=y.top,k=new to(c.outShape,s.dtype),N=t.data.get(s.dataId).values,I=t.data.get(o.dataId).values,T=k.values,F=nn(s.shape),R=nn(o.shape);for(let D=0;D<c.batchSize;++D){const A=D*F[0],P=D*k.strides[0];for(let B=0;B<c.outDepth;++B){const L=P+B*k.strides[1],W=B*c.strideDepth-b;for(let H=0;H<u;++H){const G=W+H*p;if(G<0||G>=c.inDepth)continue;const M=H*R[0],j=A+G*F[1];for(let z=0;z<c.outHeight;++z){const V=L+z*k.strides[2],K=z*c.strideHeight-S;for(let J=0;J<d;++J){const oe=K+J*x;if(oe<0||oe>=c.inHeight)continue;const Z=M+J*R[1],de=j+oe*F[2];for(let pe=0;pe<c.outWidth;++pe){const Ce=V+pe*c.outChannels,Ae=pe*c.strideWidth-w;for(let ze=0;ze<f;++ze){const et=Ae+ze*v;if(et<0||et>=c.inWidth)continue;const gt=Z+ze*R[2],dt=de+et*c.inChannels;let Ct=gt;for(let lt=0;lt<c.inChannels;++lt){const bt=N[dt+lt];for(let rn=0;rn<c.outChannels;++rn)T[Ce+rn]+=bt*I[Ct+rn];Ct+=c.outChannels}}}}}}}}return t.makeTensorInfo(k.shape,k.dtype,k.values)}const a2e={kernelName:eb,backendName:"cpu",kernelFunc:i2e};function l2e(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,dy:o}=e,{strides:i,pad:a,filterShape:l}=r;Mt([s,o],"conv3dBackpropFilterV2");const c=nn(s.shape),u=nn(o.shape),d=bd(s.shape,l,i,1,a),f=d.strideDepth,p=d.strideHeight,x=d.strideWidth,v=d.filterDepth,y=d.filterHeight,b=d.filterWidth,w=new to(d.filterShape,"float32"),S=w.values,[k,N,I,T]=w.strides,F=t.data.get(o.dataId).values,[R,D,A,P]=u,B=t.data.get(s.dataId).values,[L,W,H,G]=c,M=d.padInfo.front,j=d.padInfo.left,z=d.padInfo.top;for(let V=0;V<v;++V){const K=Math.max(0,Math.ceil((M-V)/f)),J=Math.min(d.outDepth,(d.inDepth+M-V)/f),oe=V*k;for(let Z=0;Z<y;++Z){const de=Math.max(0,Math.ceil((z-Z)/p)),pe=Math.min(d.outHeight,(d.inHeight+z-Z)/p),Ce=Z*N+oe;for(let Ae=0;Ae<b;++Ae){const ze=Math.max(0,Math.ceil((j-Ae)/x)),et=Math.min(d.outWidth,(d.inWidth+j-Ae)/x),gt=Ae*I+Ce;for(let dt=0;dt<d.inChannels;++dt){const Ct=dt*T+gt;for(let lt=0;lt<d.outChannels;++lt){let bt=0;for(let rn=0;rn<d.batchSize;++rn){const Ft=rn*L,vn=rn*R;for(let te=K;te<J;++te){const ke=(V+te*f-M)*W+Ft,He=te*D+vn;for(let Ke=de;Ke<pe;++Ke){const ct=(Z+Ke*p-z)*H+ke,Nt=Ke*A+He;for(let Rt=ze;Rt<et;++Rt){const Kn=(Ae+Rt*x-j)*G+ct,Ee=Rt*P+Nt;bt+=B[Kn+dt]*F[Ee+lt]}}}}S[Ct+lt]=bt}}}}}return t.makeTensorInfo(w.shape,w.dtype,w.values)}const c2e={kernelName:fS,backendName:"cpu",kernelFunc:l2e};function u2e(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,filter:o}=e,{pad:i,strides:a,inputShape:l}=r;Mt([s],"conv3dBackpropInputV2");const c=nn(s.shape),u=nn(o.shape),d=bd(l,o.shape,a,1,i),f=new to(d.inShape,"float32"),p=f.values,[x,v,y,b]=f.strides,w=t.data.get(s.dataId).values,[S,k,N,I]=c,T=t.data.get(o.dataId).values,[F,R,D,A]=u,{batchSize:P,filterDepth:B,filterHeight:L,filterWidth:W,inChannels:H,inDepth:G,inHeight:M,inWidth:j,outChannels:z,outDepth:V,outHeight:K,outWidth:J,strideDepth:oe,strideHeight:Z,strideWidth:de}=d,pe=B-1-d.padInfo.front,Ce=L-1-d.padInfo.top,Ae=W-1-d.padInfo.left;for(let ze=0;ze<P;++ze)for(let et=0;et<H;++et)for(let gt=0;gt<G;++gt){const dt=gt-pe,Ct=Math.max(0,Math.ceil(dt/oe)),lt=Math.min(V,(B+dt)/oe);for(let bt=0;bt<M;++bt){const rn=bt-Ce,Ft=Math.max(0,Math.ceil(rn/Z)),vn=Math.min(K,(L+rn)/Z);for(let te=0;te<j;++te){const q=te-Ae,ke=Math.max(0,Math.ceil(q/de)),He=Math.min(J,(W+q)/de);let Ke=0;for(let Be=Ct;Be<lt;++Be){const ct=Be*oe-dt;for(let Nt=Ft;Nt<vn;++Nt){const Rt=Nt*Z-rn;for(let sn=ke;sn<He;++sn){const Kn=sn*de-q,Ee=S*ze+k*Be+N*Nt+I*sn,Ge=F*(B-1-ct)+R*(L-1-Rt)+D*(W-1-Kn)+A*et;for(let Q=0;Q<z;++Q){const ht=w[Ee+Q],it=T[Ge+Q];Ke+=ht*it}}}}p[x*ze+v*gt+y*bt+b*te+et]=Ke}}}return t.makeTensorInfo(f.shape,f.dtype,f.values)}const d2e={kernelName:hS,backendName:"cpu",kernelFunc:u2e};const f2e=mr(w1,n=>Math.cos(n)),h2e={kernelName:w1,backendName:"cpu",kernelFunc:f2e};const p2e=mr(C1,n=>Math.cosh(n)),m2e={kernelName:C1,backendName:"cpu",kernelFunc:p2e};function g2e(n){const{inputs:e,backend:t,attrs:r}=n,{image:s,boxes:o,boxInd:i}=e,{cropSize:a,method:l,extrapolationValue:c}=r,[u,d,f,p]=s.shape,x=o.shape[0],[v,y]=a,b=$n([x,v,y,p],"float32"),w=t.data.get(o.dataId).values,S=t.data.get(i.dataId).values,k=t.data.get(s.dataId).values,N=nn(s.shape),I=nn(b.shape);for(let T=0;T<x;T++){const F=T*4,R=w[F],D=w[F+1],A=w[F+2],P=w[F+3],B=S[T];if(B>=u)continue;const L=v>1?(A-R)*(d-1)/(v-1):0,W=y>1?(P-D)*(f-1)/(y-1):0;for(let H=0;H<v;H++){const G=v>1?R*(d-1)+H*L:.5*(R+A)*(d-1);if(G<0||G>d-1){for(let M=0;M<y;M++)for(let j=0;j<p;j++){const z=j+M*I[2]+H*I[1]+T*I[0];b.values[z]=c}continue}if(l==="bilinear"){const M=Math.floor(G),j=Math.ceil(G),z=G-M;for(let V=0;V<y;V++){const K=y>1?D*(f-1)+V*W:.5*(D+P)*(f-1);if(K<0||K>f-1){for(let de=0;de<p;de++){const pe=de+V*I[2]+H*I[1]+T*I[0];b.values[pe]=c}continue}const J=Math.floor(K),oe=Math.ceil(K),Z=K-J;for(let de=0;de<p;de++){let pe=de+J*N[2]+M*N[1]+B*N[0];const Ce=k[pe];pe=de+oe*N[2]+M*N[1]+B*N[0];const Ae=k[pe];pe=de+J*N[2]+j*N[1]+B*N[0];const ze=k[pe];pe=de+oe*N[2]+j*N[1]+B*N[0];const et=k[pe],gt=Ce+(Ae-Ce)*Z,dt=ze+(et-ze)*Z;pe=de+V*I[2]+H*I[1]+T*I[0],b.values[pe]=gt+(dt-gt)*z}}}else for(let M=0;M<y;++M){const j=y>1?D*(f-1)+M*W:.5*(D+P)*(f-1);if(j<0||j>f-1){for(let K=0;K<p;K++){const J=K+M*I[2]+H*I[1]+T*I[0];b.values[J]=c}continue}const z=Math.round(j),V=Math.round(G);for(let K=0;K<p;K++){const J=K+z*N[2]+V*N[1]+B*N[0],oe=K+M*I[2]+H*I[1]+T*I[0];b.values[oe]=k[J]}}}}return t.makeTensorInfo(b.shape,b.dtype,b.values)}const x2e={kernelName:mS,backendName:"cpu",kernelFunc:g2e};function v2e(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:o,exclusive:i,reverse:a}=r;Mt(s,"cumprod");const l=Ur([o],s.shape.length);let c=s;l!=null&&(c=ri({inputs:{x:s},backend:t,attrs:{perm:l}}));const u=os(1,s.shape.length)[0];if(u!==c.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${u}`);const d=Ei(c.dtype,"int32"),f=eS(Le(c.shape),d),p=t.data.get(c.dataId).values,x=c.shape[c.shape.length-1],v=a?(b,w)=>b+x-w-1:(b,w)=>b+w;for(let b=0;b<p.length;b+=x)for(let w=0;w<x;w++){const S=v(b,w);if(w===0)f[S]=i?1:p[S];else{const k=v(b,w-1);f[S]=i?p[k]*f[k]:p[S]*f[k]}}const y=t.makeTensorInfo(c.shape,d,f);if(l!=null){const b=wd(l),w=ri({inputs:{x:y},backend:t,attrs:{perm:b}});return t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(c),w}return y}const y2e={kernelName:pS,backendName:"cpu",kernelFunc:v2e};function b2e(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:o,exclusive:i,reverse:a}=r;Mt(s,"cumsum");const l=Ur([o],s.shape.length);let c=s;l!=null&&(c=ri({inputs:{x:s},backend:t,attrs:{perm:l}}));const u=os(1,s.shape.length)[0];if(u!==c.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${u}`);const d=Ei(c.dtype,"int32"),f=mo(Le(c.shape),d),p=t.data.get(c.dataId).values,x=c.shape[c.shape.length-1],v=a?(b,w)=>b+x-w-1:(b,w)=>b+w;for(let b=0;b<p.length;b+=x)for(let w=0;w<x;w++){const S=v(b,w);if(w===0)f[S]=i?0:p[S];else{const k=v(b,w-1);f[S]=i?p[k]+f[k]:p[S]+f[k]}}const y=t.makeTensorInfo(c.shape,d,f);if(l!=null){const b=wd(l),w=ri({inputs:{x:y},backend:t,attrs:{perm:b}});return t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(c),w}return y}const w2e={kernelName:tb,backendName:"cpu",kernelFunc:b2e};function C2e(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,weights:o}=e,{size:i,binaryOutput:a}=r;if(s.shape.length===1){const l=t.data.get(s.dataId).values,c=t.data.get(o.dataId).values,u=gN(l,c,o.dtype,o.shape,i);return t.makeTensorInfo([i],o.dtype,u)}else if(s.shape.length===2){const l=t.bufferSync(s),c=t.bufferSync(o),u=jB(l,c,i,a);return t.makeTensorInfo(u.shape,o.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${s.shape.length}.`)}const k2e={kernelName:gS,backendName:"cpu",kernelFunc:C2e};function S2e(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{blockSize:o,dataFormat:i}=r;X(i==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${i}`);const a=s.shape[0],l=s.shape[1],c=s.shape[2],u=s.shape[3],d=l*o,f=c*o,p=u/(o*o),x=t.data.get(s.dataId).values,v=new Float32Array(a*d*f*p);let y=0;for(let b=0;b<a;++b)for(let w=0;w<d;++w){const S=Math.floor(w/o),k=w%o;for(let N=0;N<f;++N){const I=Math.floor(N/o),T=N%o,F=(k*o+T)*p;for(let R=0;R<p;++R){const A=R+F+u*(I+c*(S+l*b));v[y++]=x[A]}}}return t.makeTensorInfo([a,d,f,p],s.dtype,v)}const N2e={kernelName:xS,backendName:"cpu",kernelFunc:S2e};function jV(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:o}=e,{strides:i,pad:a,dilations:l,dimRoundingMode:c}=r;Mt([s,o],"depthwiseConv2DNative");const u=nn(s.shape),d=nn(o.shape);let f=l;f==null&&(f=[1,1]),X(xo(i,f),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${f}'`);const p=ro(s.shape,o.shape,i,f,a,c,!0),{filterHeight:x,filterWidth:v,dilationHeight:y,dilationWidth:b,padInfo:w}=p,S=w.left,k=w.top,N=p.outChannels/p.inChannels,I=new to(p.outShape,s.dtype),T=t.data.get(s.dataId).values,F=t.data.get(o.dataId).values,R=I.values;for(let D=0;D<p.batchSize;++D){const A=D*u[0],P=D*I.strides[0];for(let B=0;B<p.outHeight;++B){const L=P+B*I.strides[1],W=B*p.strideHeight-k;for(let H=0;H<x;++H){const G=W+H*y;if(G<0||G>=p.inHeight)continue;const M=H*d[0],j=A+G*u[1];for(let z=0;z<p.outWidth;++z){const V=L+z*I.strides[2],K=z*p.strideWidth-S;for(let J=0;J<v;++J){const oe=K+J*b;if(oe<0||oe>=p.inWidth)continue;const Z=M+J*d[1],de=j+oe*p.inChannels;let pe=V,Ce=Z;for(let Ae=0;Ae<p.inChannels;++Ae){const ze=T[de+Ae];for(let et=0;et<N;++et)R[pe+et]+=ze*F[Ce+et];pe+=N,Ce+=N}}}}}}return t.makeTensorInfo(I.shape,I.dtype,I.values)}const E2e={kernelName:nb,backendName:"cpu",kernelFunc:jV};function I2e(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,dy:o}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:c,filterShape:u}=r;Mt([s,o],"depthwiseConv2dNativeBackpropFilter");const d=ro(s.shape,u,i,a,l,c,!0),{strideHeight:f,strideWidth:p,filterHeight:x,filterWidth:v}=d,y=new to(d.filterShape,"float32"),b=d.padInfo.left,w=d.padInfo.top,S=d.outChannels/d.inChannels,k=t.data.get(s.dataId).values,N=new to(s.shape,s.dtype,k),I=t.data.get(o.dataId).values,T=new to(o.shape,o.dtype,I);for(let F=0;F<x;++F){const R=Math.max(0,Math.ceil((w-F)/f)),D=Math.min(d.outHeight,(d.inHeight+w-F)/f);for(let A=0;A<v;++A){const P=Math.max(0,Math.ceil((b-A)/p)),B=Math.min(d.outWidth,(d.inWidth+b-A)/p);for(let L=0;L<d.outChannels;++L){const W=Math.trunc(L/S),H=L%S;let G=0;for(let M=0;M<d.batchSize;++M)for(let j=R;j<D;++j){const z=F+j*f-w;for(let V=P;V<B;++V){const K=A+V*p-b;G+=N.get(M,z,K,W)*T.get(M,j,V,L)}}y.set(G,F,A,W,H)}}}return t.makeTensorInfo(y.shape,y.dtype,y.values)}const T2e={kernelName:vS,backendName:"cpu",kernelFunc:I2e};function _2e(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,filter:o}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:c,inputShape:u}=r;Mt([s,o],"depthwiseConv2DNativeBackpropInput");const d=nn(s.shape),f=nn(o.shape),p=ro(u,o.shape,i,a,l,c,!0),x=new to(p.inShape,"float32"),v=x.values,[y,b,w]=x.strides,S=t.data.get(s.dataId).values,[k,N,I]=d,T=t.data.get(o.dataId).values,[F,R,D]=f,{batchSize:A,filterHeight:P,filterWidth:B,inChannels:L,inHeight:W,inWidth:H,outChannels:G,outHeight:M,outWidth:j,strideHeight:z,strideWidth:V}=p,K=P-1-p.padInfo.top,J=B-1-p.padInfo.left,oe=G/L;for(let Z=0;Z<A;++Z)for(let de=0;de<L;++de)for(let pe=0;pe<W;++pe){const Ce=pe-K,Ae=Math.max(0,Math.ceil(Ce/z)),ze=Math.min(M,(P+Ce)/z);for(let et=0;et<H;++et){const gt=et-J,dt=Math.max(0,Math.ceil(gt/V)),Ct=Math.min(j,(B+gt)/V);let lt=0;for(let bt=Ae;bt<ze;++bt){const rn=bt*z-Ce;for(let Ft=dt;Ft<Ct;++Ft){const vn=Ft*V-gt,te=k*Z+N*bt+I*Ft,q=F*(P-1-rn)+R*(B-1-vn)+D*de;for(let ke=0;ke<oe;++ke){const He=de*oe+ke,Ke=S[te+He],Be=T[q+ke];lt+=Ke*Be}}}v[y*Z+b*pe+w*et+de]=lt}}return t.makeTensorInfo(x.shape,x.dtype,x.values)}const R2e={kernelName:yS,backendName:"cpu",kernelFunc:_2e};function D2e(n){const{inputs:e,backend:t}=n,{x:r}=e,s=Le(r.shape),o=t.data.get(r.dataId).values,i=$n([s,s],r.dtype),a=i.values;for(let c=0;c<o.length;c++)a[c*s+c]=o[c];const l=[...r.shape,...r.shape];return t.makeTensorInfo(l,i.dtype,i.values)}const A2e={kernelName:uO,backendName:"cpu",kernelFunc:D2e};const $2e={kernelName:rb,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:r,filter:s}=n,{strides:o,pad:i,dilations:a}=t,l=e,c=l.data.get(r.dataId).values,u=r.shape.length,d=l.data.get(s.dataId).values,f=s.shape.length,{batchSize:p,inHeight:x,inWidth:v,inChannels:y,outHeight:b,outWidth:w,padInfo:S,strideHeight:k,strideWidth:N,filterHeight:I,filterWidth:T,dilationHeight:F,dilationWidth:R,outShape:D}=i0(r.shape,s.shape,o,i,"NHWC",a),A=Le(D),P=D.length,B=ns(r.dtype,A);for(let W=0;W<p;++W)for(let H=0;H<b;++H){const G=H*k-S.top;for(let M=0;M<w;++M){const j=M*N-S.left;for(let z=0;z<y;++z){let V=Number.MIN_SAFE_INTEGER;for(let J=0;J<I;++J){const oe=G+J*F;if(oe>=0&&oe<x)for(let Z=0;Z<T;++Z){const de=j+Z*R;if(de>=0&&de<v){const pe=Ql([W,oe,de,z],u,nn(r.shape)),Ce=Ql([J,Z,z],f,nn(s.shape)),Ae=c[pe]+d[Ce];Ae>V&&(V=Ae)}}}const K=Ql([W,H,M,z],P,nn(D));B[K]=V}}}return{dataId:l.write(qf(B,r.dtype),D,r.dtype),shape:D,dtype:r.dtype}}};const F2e={kernelName:A5,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:r,filter:s,dy:o}=n,{strides:i,pad:a,dilations:l}=t,c=e,u=il(r.shape,c.data.get(r.dataId).values),d=il(s.shape,c.data.get(s.dataId).values),{batchSize:f,inHeight:p,inWidth:x,inChannels:v,outHeight:y,outWidth:b,padInfo:w,strideHeight:S,strideWidth:k,filterHeight:N,filterWidth:I,dilationHeight:T,dilationWidth:F,outShape:R}=i0(r.shape,s.shape,i,a,"NHWC",l);X(o.rank===R.length,()=>`Error in ${A5}, dy must have the same rank as output ${R.length}, but got ${o.rank}`);const D=il(R,c.data.get(o.dataId).values),A=iO(s.shape,s.dtype);for(let B=0;B<f;++B)for(let L=0;L<y;++L){const W=L*S-w.top;for(let H=0;H<b;++H){const G=H*k-w.left;for(let M=0;M<v;++M){let j=Number.MIN_SAFE_INTEGER,z=0,V=0;for(let K=0;K<N;++K){const J=W+K*T;if(J>=0&&J<p)for(let oe=0;oe<I;++oe){const Z=G+oe*F;if(Z>=0&&Z<x){const de=u[B][J][Z][M]+d[K][oe][M];de>j&&(j=de,z=K,V=oe)}}}A[z][V][M]+=D[B][L][H][M]}}}return{dataId:c.write(qf(A,r.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};const P2e={kernelName:D5,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:r,filter:s,dy:o}=n,{strides:i,pad:a,dilations:l}=t,c=e,u=il(r.shape,c.data.get(r.dataId).values),d=il(s.shape,c.data.get(s.dataId).values),{batchSize:f,inHeight:p,inWidth:x,inChannels:v,outHeight:y,outWidth:b,padInfo:w,strideHeight:S,strideWidth:k,filterHeight:N,filterWidth:I,dilationHeight:T,dilationWidth:F,outShape:R}=i0(r.shape,s.shape,i,a,"NHWC",l);X(o.rank===R.length,()=>`Error in ${D5}, dy must have the same rank as output ${R.length}, but got ${o.rank}`);const D=il(R,c.data.get(o.dataId).values),A=iO(r.shape,r.dtype);for(let B=0;B<f;++B)for(let L=0;L<y;++L){const W=L*S-w.top;for(let H=0;H<b;++H){const G=H*k-w.left;for(let M=0;M<v;++M){let j=Number.MIN_SAFE_INTEGER,z=W<0?0:W,V=G<0?0:G;for(let K=0;K<N;++K){const J=W+K*T;if(J>=0&&J<p)for(let oe=0;oe<I;++oe){const Z=G+oe*F;if(Z>=0&&Z<x){const de=u[B][J][Z][M]+d[K][oe][M];de>j&&(j=de,z=J,V=Z)}}}A[B][z][V][M]+=D[B][L][H][M]}}}return{dataId:c.write(qf(A,r.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};function O2e(n){const{inputs:e,backend:t,attrs:r}=n,{image:s}=e,{canvas:o,options:i}=r,{contextOptions:a,imageOptions:l}=i||{},c=l?.alpha||1,u=a?.contextType||"2d";if(u!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const d=o.getContext(u,a?.contextAttributes||{});if(d==null)throw new Error(`Could not get the context with ${u} type.`);const[f,p]=s.shape.slice(0,2),x=s.shape.length===2?1:s.shape[2],v=t.data.get(s.dataId).values,y=s.dtype==="float32"?255:1,b=new Uint8ClampedArray(p*f*4);for(let S=0;S<f*p;++S){const k=[0,0,0,255*c];for(let I=0;I<x;I++){const T=v[S*x+I];if(s.dtype==="float32"){if(T<0||T>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${T}.`)}else if(s.dtype==="int32"&&(T<0||T>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${T}.`);x===1?(k[0]=T*y,k[1]=T*y,k[2]=T*y):k[I]=T*y}const N=S*4;b[N+0]=Math.round(k[0]),b[N+1]=Math.round(k[1]),b[N+2]=Math.round(k[2]),b[N+3]=Math.round(k[3])}o.width=p,o.height=f;const w=new ImageData(b,p,f);return d.putImageData(w,0,0),s}const M2e={kernelName:hle,backendName:"cpu",kernelFunc:O2e};function C0(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:o,keepDims:i}=r;Mt(s,"sum");let a;s.dtype==="bool"?a=hd({inputs:{x:s},backend:t,attrs:{dtype:"int32"}}):a=dc({inputs:{x:s},backend:t});const l=a.shape.length,c=Fn(o,a.shape),u=Ur(c,l);let d=c,f=a;u!=null&&(f=ri({inputs:{x:a},backend:t,attrs:{perm:u}}),d=os(d.length,l)),so("sum",d,f.shape.length);const[p,x]=Ws(f.shape,d),v=Ei(f.dtype,"int32");let y=J2(t,p,v);const b=Le(x),w=t.data.get(y.dataId).values,S=t.data.get(f.dataId).values;for(let k=0;k<w.length;++k){const N=k*b;let I=0;for(let T=0;T<b;++T)I+=S[N+T];w[k]=I}if(i){const k=ps(y.shape,c),N=y;y=Tr({inputs:{x:y},backend:t,attrs:{shape:k}}),t.disposeIntermediateTensorInfo(N)}return t.disposeIntermediateTensorInfo(a),u!=null&&t.disposeIntermediateTensorInfo(f),y}const L2e={kernelName:Ob,backendName:"cpu",kernelFunc:C0};function j2e(n){const{inputs:e,backend:t,attrs:r}=n,{equation:s}=r,o=e,{allDims:i,summedDims:a,idDims:l}=B8(s,o.length);z8(i.length,l,o);const{path:c,steps:u}=W8(a,l),d=u.length;let f=null,p=i.length;const x=[];for(let v=0;v<d;++v){for(const y of u[v]){const{permutationIndices:b,expandDims:w}=V8(p,l[y]);let S;U8(b)?S=o[y]:(S=ri({inputs:{x:o[y]},backend:t,attrs:{perm:b}}),x.push(S));const k=S.shape.slice();for(let N=0;N<w.length;++N)k.splice(w[N],0,1);lr(S.shape,k)||(S=Tr({inputs:{x:S},backend:t,attrs:{shape:k}}),x.push(S)),f===null?f=S:(f=hw({inputs:{a:S,b:f},backend:t}),x.push(f))}v<d-1&&(c[v]>=0&&(f=C0({inputs:{x:f},backend:t,attrs:{axis:c[v]-(i.length-p),keepDims:!1}}),x.push(f)),p--)}for(const v of x)v!==f&&t.disposeIntermediateTensorInfo(v);return f}const B2e={kernelName:bS,backendName:"cpu",kernelFunc:j2e};function V2e(n){const{inputs:e,backend:t}=n,{dy:r,y:s}=e;Mt([r,s],"eluGrad");const o=new Float32Array(Le(s.shape)),i=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values;for(let l=0;l<i.length;++l){const c=i[l];c>=0?o[l]=a[l]:o[l]=a[l]*(c+1)}return t.makeTensorInfo(s.shape,"float32",o)}const z2e={kernelName:wS,backendName:"cpu",kernelFunc:V2e};const W2e=$8,U2e=F8,H2e=P8,G2e=O8,q2e=M8,K2e=L8,X2e=mr(N1,n=>{const e=Math.sign(n),t=Math.abs(n),r=1/(1+W2e*t);return e*(1-((((K2e*r+q2e)*r+G2e)*r+H2e)*r+U2e)*r*Math.exp(-t*t))}),Y2e={kernelName:N1,backendName:"cpu",kernelFunc:X2e};function ty(n){const{inputs:e,backend:t,attrs:r}=n,{input:s}=e,{dim:o}=r,i=s.shape.length,a=s.shape.slice();let l=o;return o<0&&(X(-(i+1)<=o,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),l=i+o+1),a.splice(l,0,1),Tr({inputs:{x:s},backend:t,attrs:{shape:a}})}const Z2e={kernelName:ob,backendName:"cpu",kernelFunc:ty};const J2e=as((n,e)=>n/e),CN=Ts(k1,J2e),sk={kernelName:k1,backendName:"cpu",kernelFunc:CN};function BV(n,e,t){const r=n.shape,s=r[0],o=r[1],i=t.data.get(n.dataId),a=i.complexTensorInfos.real,l=i.complexTensorInfos.imag,c=[s,o],u=Le(c),d=po("float32",u),f=po("float32",u);for(let y=0;y<s;y++){const b=Mf({inputs:{x:a},backend:t,attrs:{begin:[y,0],size:[1,o]}}),w=Mf({inputs:{x:l},backend:t,attrs:{begin:[y,0],size:[1,o]}}),S=wi({inputs:{real:b,imag:w},backend:t}),{real:k,imag:N}=Q2e(S,e,t),I=Hc(k,N);for(let T=0;T<o;T++){const F=j8(I,T);d[y*o+T]=F.real,f[y*o+T]=F.imag}t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(S)}const p=t.makeTensorInfo(c,"float32",d),x=t.makeTensorInfo(c,"float32",f),v=wi({inputs:{real:p,imag:x},backend:t});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(x),v}function Q2e(n,e,t){const r=Le(n.shape),s=t.data.get(n.dataId),o=t.data.get(s.complexTensorInfos.real.dataId).values,i=t.data.get(s.complexTensorInfos.imag.dataId).values;if(eye(r)){const a=ok(o,i,r,e,t),l=[n.shape[0],n.shape[1]];if(e){const c=t.makeTensorInfo(l,"float32",a.real),u=t.makeTensorInfo(l,"float32",a.imag),d=t.makeTensorInfo([],"float32",yd(r,"float32")),f=dc({inputs:{x:d},backend:t}),p=sk.kernelFunc({inputs:{a:c,b:d},backend:t}),x=sk.kernelFunc({inputs:{a:u,b:f},backend:t}),v=t.data.get(p.dataId).values,y=t.data.get(x.dataId).values;return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(x),{real:v,imag:y}}return a}else{const a=Hc(o,i),l=tye(a,r,e);return QM(l)}}function eye(n){return(n&n-1)===0}function ok(n,e,t,r,s){if(t===1)return{real:n,imag:e};const o=Hc(n,e),i=t/2,a=eL(o),l=a.real,c=a.imag,u=[l.length],d=s.makeTensorInfo(u,"float32",l),f=s.makeTensorInfo(u,"float32",c),p=wi({inputs:{real:d,imag:f},backend:s}),x=tL(o),v=x.real,y=x.imag,b=[v.length],w=s.makeTensorInfo(b,"float32",v),S=s.makeTensorInfo(b,"float32",y),k=wi({inputs:{real:w,imag:S},backend:s}),N=ok(l,c,i,r,s),I=N.real,T=N.imag,F=[I.length],R=s.makeTensorInfo(F,"float32",I),D=s.makeTensorInfo(F,"float32",T),A=wi({inputs:{real:R,imag:D},backend:s}),P=ok(v,y,i,r,s),B=P.real,L=P.imag,W=[B.length],H=s.makeTensorInfo(W,"float32",B),G=s.makeTensorInfo(W,"float32",L),M=wi({inputs:{real:H,imag:G},backend:s}),j=rL(t,r),z=[j.real.length],V=s.makeTensorInfo(z,"float32",j.real),K=s.makeTensorInfo(z,"float32",j.imag),J=wi({inputs:{real:V,imag:K},backend:s}),oe=hw({inputs:{a:J,b:M},backend:s}),Z=Pp({inputs:{a:A,b:oe},backend:s}),de=bN({inputs:{a:A,b:oe},backend:s}),pe=Of({inputs:{input:Z},backend:s}),Ce=Of({inputs:{input:de},backend:s}),Ae=Op({inputs:{input:Z},backend:s}),ze=Op({inputs:{input:de},backend:s}),et=Mp({inputs:[pe,Ce],backend:s,attrs:{axis:0}}),gt=Mp({inputs:[Ae,ze],backend:s,attrs:{axis:0}}),dt=s.data.get(et.dataId).values,Ct=s.data.get(gt.dataId).values;return s.disposeIntermediateTensorInfo(d),s.disposeIntermediateTensorInfo(f),s.disposeIntermediateTensorInfo(p),s.disposeIntermediateTensorInfo(w),s.disposeIntermediateTensorInfo(S),s.disposeIntermediateTensorInfo(k),s.disposeIntermediateTensorInfo(R),s.disposeIntermediateTensorInfo(D),s.disposeIntermediateTensorInfo(A),s.disposeIntermediateTensorInfo(H),s.disposeIntermediateTensorInfo(G),s.disposeIntermediateTensorInfo(M),s.disposeIntermediateTensorInfo(V),s.disposeIntermediateTensorInfo(K),s.disposeIntermediateTensorInfo(J),s.disposeIntermediateTensorInfo(oe),s.disposeIntermediateTensorInfo(Z),s.disposeIntermediateTensorInfo(de),s.disposeIntermediateTensorInfo(pe),s.disposeIntermediateTensorInfo(Ae),s.disposeIntermediateTensorInfo(Ce),s.disposeIntermediateTensorInfo(ze),s.disposeIntermediateTensorInfo(et),s.disposeIntermediateTensorInfo(gt),{real:dt,imag:Ct}}function tye(n,e,t){const r=new Float32Array(e*2);for(let s=0;s<e;s++){let o=0,i=0;for(let a=0;a<e;a++){const l=sL(s*a,e,t),c=j8(n,a);o+=c.real*l.real-c.imag*l.imag,i+=c.real*l.imag+c.imag*l.real}t&&(o/=e,i/=e),nL(r,o,i,s)}return r}function nye(n){const{inputs:e,backend:t}=n,{input:r}=e,s=Le(r.shape),o=r.shape[r.shape.length-1],i=s/o,a=Tr({inputs:{x:r},backend:t,attrs:{shape:[i,o]}}),l=BV(a,!1,t),c=Tr({inputs:{x:l},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(l),c}const rye={kernelName:CS,backendName:"cpu",kernelFunc:nye};function kN(n){const{backend:e,attrs:t}=n,{shape:r,value:s,dtype:o}=t,i=o||Xp(s),a=ns(i,Le(r));return oye(a,s,i),e.makeTensorInfo(r,i,a)}const sye={kernelName:kS,backendName:"cpu",kernelFunc:kN};function oye(n,e,t){n.fill(e)}const iye={kernelName:SS,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:r}=n,s=t,o=po(r.dtype,Le(r.shape)),[i,a,l,c]=r.shape,u=s.data.get(r.dataId).values;for(let f=0;f<i;f++){const p=f*l*a*c;for(let x=0;x<a;x++){const v=x*(l*c);for(let y=0;y<l;y++){const b=y*c;for(let w=0;w<c;w++){const S=Math.round(l-y-1),k=p+v+b+w;let N=u[k];if(S>=0&&S<l){const I=S*c,T=p+v+I+w;N=u[T]}o[k]=N}}}}return{dataId:s.write(o,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};function aye(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:o,bias:i,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:f,activation:p,leakyreluAlpha:x}=r;let v=LV({inputs:{x:s,filter:o},backend:t,attrs:{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:f}});if(i){const y=v;if(u==="NCHW"&&i.shape.length===1&&i.shape[0]!==1){const b=Tr({inputs:{x:i},backend:t,attrs:{shape:[i.shape[0],1,1]}});v=Pp({inputs:{a:v,b},backend:t}),t.disposeIntermediateTensorInfo(b)}else v=Pp({inputs:{a:v,b:i},backend:t});t.disposeIntermediateTensorInfo(y)}if(p){const y=v;if(u==="NCHW"&&p==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const b=Tr({inputs:{x:a},backend:t,attrs:{shape:[a.shape[0],1,1]}});v=ey(t,v,p,b,x),t.disposeIntermediateTensorInfo(b)}else v=ey(t,v,p,a,x);t.disposeIntermediateTensorInfo(y)}return v}const lye={kernelName:P2,backendName:"cpu",kernelFunc:aye};function cye(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:o,bias:i,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:f,activation:p,leakyreluAlpha:x}=r;let v=jV({inputs:{x:s,filter:o},backend:t,attrs:{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:f}});if(i){const y=v;v=Pp({inputs:{a:v,b:i},backend:t}),t.disposeIntermediateTensorInfo(y)}if(p){const y=v;v=ey(t,v,p,a,x),t.disposeIntermediateTensorInfo(y)}return v}const uye={kernelName:_O,backendName:"cpu",kernelFunc:cye};function dye(n){const{inputs:e,backend:t}=n,{params:r,indices:s}=e,o=Le(r.shape),i=s.shape,a=i[i.length-1],[l,c,u,d]=C8(r,s);if(c===0)return t.makeTensorInfo(l,r.dtype,[]);const f=t.data.get(s.dataId).values,p=t.bufferSync(r),x=YB(f,p,r.dtype,c,a,u,d,r.shape,o);return t.makeTensorInfo(l,r.dtype,x.values)}const fye={kernelName:dO,backendName:"cpu",kernelFunc:dye};function hye(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,indices:o}=e,{axis:i,batchDims:a}=r;Mt([s,o],"gatherV2");const l=Fn(i,s.shape)[0],c=t.data.get(o.dataId).values,u=s.shape[l];for(let k=0;k<c.length;++k){const N=c[k];X(N<=u-1&&N>=0,()=>`GatherV2: the index value ${N} is not in [0, ${u-1}]`)}let d=a;a==null&&(d=0);const f=Le(o.shape),p=G8(s,o,l,d),x=Tr({inputs:{x:s},backend:t,attrs:{shape:[p.batchSize,p.outerSize,p.dimSize,p.sliceSize]}}),v=Tr({inputs:{x:o},backend:t,attrs:{shape:[p.batchSize,f/p.batchSize]}}),y=[p.batchSize,p.outerSize,f/p.batchSize,p.sliceSize],b=t.bufferSync(v),w=t.bufferSync(x),S=ZB(w,b,y);return t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(v),t.makeTensorInfo(p.outputShape,S.dtype,S.values)}const pye={kernelName:ab,backendName:"cpu",kernelFunc:hye};function mye(n){const{inputs:e,backend:t}=n,{input:r}=e,s=Le(r.shape),o=r.shape[r.shape.length-1],i=s/o,a=Tr({inputs:{x:r},backend:t,attrs:{shape:[i,o]}}),l=BV(a,!0,t),c=Tr({inputs:{x:l},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(l),c}const gye={kernelName:NS,backendName:"cpu",kernelFunc:mye};const xye=mr(A1,n=>Number.isFinite(n)?1:0,"bool"),vye={kernelName:A1,backendName:"cpu",kernelFunc:xye};const yye=mr($1,n=>Math.abs(n)===1/0?1:0,"bool"),bye={kernelName:$1,backendName:"cpu",kernelFunc:yye};const wye=mr(F1,n=>Number.isNaN(n)?1:0,"bool"),Cye={kernelName:F1,backendName:"cpu",kernelFunc:wye};function kye(n){const{backend:e,attrs:t}=n,{start:r,stop:s,num:o}=t,i=nV(r,s,o);return e.makeTensorInfo([i.length],"float32",i)}const Sye={kernelName:fO,backendName:"cpu",kernelFunc:kye};const Nye=mr(O1,n=>Math.log1p(n)),Eye={kernelName:O1,backendName:"cpu",kernelFunc:Nye};const Iye=as((n,e)=>n&&e),Tye=Ts(fb,Iye,null,"bool"),_ye={kernelName:fb,backendName:"cpu",kernelFunc:Tye};const Rye=mr(hb,n=>n?0:1,"bool"),Dye={kernelName:hb,backendName:"cpu",kernelFunc:Rye};const Aye=as((n,e)=>n||e),$ye=Ts(pb,Aye,null,"bool"),Fye={kernelName:pb,backendName:"cpu",kernelFunc:$ye};function Pye(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{depthRadius:o,bias:i,alpha:a,beta:l}=r;Mt(s,"LRN");const c=s.shape[3],u=c-1,d=t.data.get(s.dataId).values,f=Le(s.shape),p=new Float32Array(f);function x(v){const y=v%c;let b=v-y+Math.max(0,y-o);const w=v-y+Math.min(y+o,u);let S=0;for(;b<=w;b++){const k=d[b];S+=k*k}return S}for(let v=0;v<f;v++){const y=x(v),b=d[v]*Math.pow(i+a*y,-l);p[v]=b}return t.makeTensorInfo(s.shape,s.dtype,p)}const Oye={kernelName:mb,backendName:"cpu",kernelFunc:Pye};function Mye(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,y:o,dy:i}=e,{depthRadius:a,bias:l,alpha:c,beta:u}=r;Mt(i,"LRNGrad");const d=Le(i.shape),f=i.shape[3],p=t.data.get(i.dataId).values,x=t.data.get(s.dataId).values,v=t.data.get(o.dataId).values,y=new Float32Array(d),b=d;for(let w=0;w<b;w++){const S=w%f,k=w-S+Math.max(0,S-a),N=w-S+Math.min(f,S+a+1);let I=0;for(let T=k;T<N;T++)I+=Math.pow(x[T],2);I=c*I+l;for(let T=k;T<N;T++){let F=-2*c*u*x[T]*v[w]/I;w===T&&(F+=Math.pow(I,-u)),F*=p[w],y[T]+=F}}return t.makeTensorInfo(i.shape,s.dtype,y)}const Lye={kernelName:IS,backendName:"cpu",kernelFunc:Mye};function VV(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{reductionIndices:o,keepDims:i}=r,a=t;let l=s.shape;const c=l.length,u=Fn(o,l);let d=u;const f=Ur(d,c);let p=a.data.get(s.dataId).values;if(f!=null){const k=new Array(c);for(let N=0;N<k.length;N++)k[N]=l[f[N]];p=vN(p,l,s.dtype,f,k),d=os(d.length,c),l=k}Mt(s,"max"),so("max",d,c);const[x,v]=Ws(l,d),y=Le(v),b=sV(p,y,x,s.dtype),w=a.write(b,x,s.dtype);let S=x;return i&&(S=ps(x,u)),{dataId:w,shape:S,dtype:s.dtype}}const jye={kernelName:gb,backendName:"cpu",kernelFunc:VV};function Bye(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e;Mt(s,"maxPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:l}=r,c=1;X(xo(i,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);const u=$a(s.shape,o,i,c,a,l);let d;if(u.filterWidth===1&&u.filterHeight===1&&lr(u.inShape,u.outShape))d=dc({inputs:{x:s},backend:t});else{const f=t.data.get(s.dataId).values,p=nn(s.shape),x=wN(f,s.shape,s.dtype,p,u,"max");d=t.makeTensorInfo(u.outShape,s.dtype,x.values)}return d}const Vye={kernelName:xb,backendName:"cpu",kernelFunc:Bye};function zye(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:l,dataFormat:c}=r;Mt(s,"maxPool3d");const u=eu(s.shape,o,i,1,a,l,c),d=t.data.get(s.dataId).values,f=MV(d,s.shape,s.dtype,nn(s.shape),u,"max");return t.makeTensorInfo(f.shape,"float32",f.values)}const Wye={kernelName:vb,backendName:"cpu",kernelFunc:zye};function Uye(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:o}=e,{filterSize:i,strides:a,pad:l,dimRoundingMode:c}=r;Mt([s,o],"maxPool3DGrad");const u=eu(o.shape,i,a,1,l,c),d=t.bufferSync(o),f=Ave(d,u),p=u.strideDepth,x=u.strideHeight,v=u.strideWidth,y=u.dilationDepth,b=u.dilationHeight,w=u.dilationWidth,S=u.effectiveFilterDepth,k=u.effectiveFilterHeight,N=u.effectiveFilterWidth,I=S-1-u.padInfo.front,T=N-1-u.padInfo.left,F=k-1-u.padInfo.top,R=$n(o.shape,"float32"),D=t.bufferSync(s);for(let A=0;A<u.batchSize;++A)for(let P=0;P<u.inChannels;++P)for(let B=0;B<u.inDepth;++B)for(let L=0;L<u.inHeight;++L)for(let W=0;W<u.inWidth;++W){const H=B-I,G=L-F,M=W-T;let j=0;for(let z=0;z<S;z+=y){const V=(H+z)/p;if(!(V<0||V>=u.outDepth||Math.floor(V)!==V))for(let K=0;K<k;K+=b){const J=(G+K)/x;if(!(J<0||J>=u.outHeight||Math.floor(J)!==J))for(let oe=0;oe<N;oe+=w){const Z=(M+oe)/v;if(Z<0||Z>=u.outWidth||Math.floor(Z)!==Z)continue;const de=S*k*N-1-f.get(A,V,J,Z,P),pe=z*k*N+K*N+oe,Ce=de===pe?1:0;if(Ce===0)continue;const Ae=D.get(A,V,J,Z,P);j+=Ae*Ce}}}R.set(j,A,B,L,W,P)}return t.makeTensorInfo(R.shape,R.dtype,R.values)}const Hye={kernelName:_S,backendName:"cpu",kernelFunc:Uye};function Gye(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:o,output:i}=e,a=o;Mt([o,i],"maxPoolGrad");const{filterSize:l,strides:c,pad:u,dimRoundingMode:d}=r,f=$a(a.shape,l,c,1,u,d),p=t.data.get(a.dataId).values,x=$n(f.outShape,a.dtype,OV(p,a.shape,a.dtype,f).values),v=f.strideHeight,y=f.strideWidth,b=f.dilationHeight,w=f.dilationWidth,S=f.effectiveFilterHeight,k=f.effectiveFilterWidth,N=k-1-f.padInfo.left,I=S-1-f.padInfo.top,T=$n(a.shape,"float32"),F=t.data.get(s.dataId).values,R=$n(s.shape,"float32",F);for(let D=0;D<f.batchSize;++D)for(let A=0;A<f.inChannels;++A)for(let P=0;P<f.inHeight;++P)for(let B=0;B<f.inWidth;++B){const L=P-I,W=B-N;let H=0;for(let G=0;G<S;G+=b){const M=(L+G)/v;if(!(M<0||M>=f.outHeight||Math.floor(M)!==M))for(let j=0;j<k;j+=w){const z=(W+j)/y;if(z<0||z>=f.outWidth||Math.floor(z)!==z)continue;const V=S*k-1-x.get(D,M,z,A),K=G*k+j,J=V===K?1:0;if(J===0)continue;const oe=R.get(D,M,z,A);H+=oe*J}}T.set(H,D,P,B,A)}return t.makeTensorInfo(T.shape,T.dtype,T.values)}const qye={kernelName:TS,backendName:"cpu",kernelFunc:Gye};function Kye(n,e,t,r,s){const o=nn(e),i=wN(n,e,t,o,s,"max"),a=OV(n,e,t,s,!0,r);return[i.values,a.values]}const Xye={kernelName:hO,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:r}=n,{filterSize:s,strides:o,pad:i,includeBatchInIndex:a}=e,l=t;Mt(r,"MaxPoolWithArgmax");const c=l.data.get(r.dataId).values,u=$a(r.shape,s,o,[1,1],i),[d,f]=Kye(c,r.shape,r.dtype,a,u),p=l.write(d,u.outShape,r.dtype),x=l.write(f,u.outShape,r.dtype);return[{dataId:p,shape:u.outShape,dtype:r.dtype},{dataId:x,shape:u.outShape,dtype:"int32"}]}};function Yye(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:o,keepDims:i}=r,a=Fn(o,s.shape),c=Ws(s.shape,a)[1],u=Le(c),d=[],f=t.makeTensorInfo([],"float32",new Float32Array([u]));d.push(f);const p=hd({inputs:{x:s},backend:t,attrs:{dtype:"float32"}});d.push(p);const x=CN({inputs:{a:p,b:f},backend:t});d.push(x);const v=C0({inputs:{x},backend:t,attrs:{axis:o,keepDims:i}});return d.forEach(y=>t.disposeIntermediateTensorInfo(y)),v}const Zye={kernelName:yb,backendName:"cpu",kernelFunc:Yye};function Jye(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:o,keepDims:i}=r;Mt(s,"min");const a=Fn(o,s.shape);let l=a;const c=Ur(l,s.shape.length);let u=s;c!=null&&(u=ri({inputs:{x:s},backend:t,attrs:{perm:c}}),l=os(l.length,s.shape.length)),so("min",l,u.shape.length);const[d,f]=Ws(u.shape,l),p=Le(f),x=mo(Le(d),u.dtype),v=t.data.get(u.dataId).values;for(let b=0;b<x.length;++b){const w=b*p;let S=v[w];for(let k=0;k<p;++k){const N=v[w+k];(Number.isNaN(N)||N<S)&&(S=N)}x[b]=S}c!=null&&t.disposeIntermediateTensorInfo(u);const y=t.makeTensorInfo(d,u.dtype,x);if(i){const b=ps(d,a),w=Tr({inputs:{x:y},backend:t,attrs:{shape:b}});return t.disposeIntermediateTensorInfo(y),w}return y}const Qye={kernelName:bb,backendName:"cpu",kernelFunc:Jye};function ebe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{paddings:o,mode:i}=r;Mt(s,"mirrorPad");const a=o.map((S,k)=>S[0]+s.shape[k]+S[1]),l=o.map(S=>S[0]),c=o.map((S,k)=>S[0]+s.shape[k]),u=i==="reflect"?0:1,d=t.data.get(s.dataId).values,f=s.shape.length,p=nn(s.shape),x=Le(a),v=a.length,y=nn(a),b=po(s.dtype,x);for(let S=0;S<x;S++){let k=Yp(S,v,y);for(let I=0;I<v;I++)k[I]<l[I]?k[I]=l[I]*2-k[I]-u:k[I]>=c[I]&&(k[I]=(c[I]-1)*2-k[I]+u);k=k.map((I,T)=>I-l[T]);const N=Ql(k,f,p);b[S]=d[N]}return{dataId:t.write(b,a,s.dtype),shape:a,dtype:s.dtype}}const tbe={kernelName:wb,backendName:"cpu",kernelFunc:ebe};const nbe=as(((n,e)=>{const t=n%e;return n<0&&e<0||n>=0&&e>=0?t:(t+e)%e})),rbe=Ts(j1,nbe),sbe={kernelName:j1,backendName:"cpu",kernelFunc:rbe};function zV(n){const{inputs:e,backend:t,attrs:r}=n,{logits:s}=e,{dim:o}=r,i=s.shape.length;let a=o;if(a===-1&&(a=i-1),a!==i-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${i} and dim was ${a}`);const l=Fn([a],s.shape),c=VV({inputs:{x:s},backend:t,attrs:{reductionIndices:l,keepDims:!1}}),u=ps(c.shape,l),d=Tr({inputs:{x:c},backend:t,attrs:{shape:u}}),f=bN({inputs:{a:s,b:d},backend:t}),p=GB({inputs:{x:f},backend:t}),x=C0({inputs:{x:p},backend:t,attrs:{axis:l,keepDims:!1}}),v=Tr({inputs:{x},backend:t,attrs:{shape:u}}),y=CN({inputs:{a:p,b:v},backend:t});return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(v),y}const obe={kernelName:jb,backendName:"cpu",kernelFunc:zV};function ibe(n){const{inputs:e,backend:t,attrs:r}=n,{logits:s}=e,{numSamples:o,seed:i,normalized:a}=r;Mt(s,"multinomial");const l=a?s:zV({inputs:{logits:s},backend:t,attrs:{dim:-1}}),c=l.shape[0],u=l.shape[1],d=t.data.get(l.dataId).values,f=[c,o],p=mo(Le(f),"int32");for(let x=0;x<c;++x){const v=x*u,y=new Float32Array(u-1);y[0]=d[v];for(let S=1;S<y.length;++S)y[S]=y[S-1]+d[v+S];const b=l8.alea(i.toString()),w=x*o;for(let S=0;S<o;++S){const k=b();p[w+S]=y.length;for(let N=0;N<y.length;N++)if(k<y[N]){p[w+S]=N;break}}}return a||t.disposeIntermediateTensorInfo(l),t.makeTensorInfo(f,"int32",p)}const abe={kernelName:pO,backendName:"cpu",kernelFunc:ibe};const lbe=x8;function cbe(n){const{inputs:e,backend:t,attrs:r}=n,{boxes:s,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l}=r;Mt(s,"NonMaxSuppression");const c=t.data.get(s.dataId).values,u=t.data.get(o.dataId).values,{selectedIndices:d}=lbe(c,u,i,a,l);return t.makeTensorInfo([d.length],"int32",new Int32Array(d))}const ube={kernelName:RS,backendName:"cpu",kernelFunc:cbe};const dbe=v8;function fbe(n){const{inputs:e,backend:t,attrs:r}=n,{boxes:s,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=r;Mt(s,"NonMaxSuppressionPadded");const u=t.data.get(s.dataId).values,d=t.data.get(o.dataId).values,{selectedIndices:f,validOutputs:p}=dbe(u,d,i,a,l,c);return[t.makeTensorInfo([f.length],"int32",new Int32Array(f)),t.makeTensorInfo([],"int32",new Int32Array([p]))]}const hbe={kernelName:DS,backendName:"cpu",kernelFunc:fbe};const pbe=y8;function mbe(n){const{inputs:e,backend:t,attrs:r}=n,{boxes:s,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=r;Mt(s,"NonMaxSuppressionWithScore");const u=t.data.get(s.dataId).values,d=t.data.get(o.dataId).values,f=i,p=a,x=l,v=c,{selectedIndices:y,selectedScores:b}=pbe(u,d,f,p,x,v);return[t.makeTensorInfo([y.length],"int32",new Int32Array(y)),t.makeTensorInfo([b.length],"float32",new Float32Array(b))]}const gbe={kernelName:AS,backendName:"cpu",kernelFunc:mbe};function xbe(n){const{inputs:e,backend:t,attrs:r}=n,{indices:s}=e,{dtype:o,depth:i,onValue:a,offValue:l}=r;Mt(s,"oneHot");const c=Le(s.shape),u=new Float32Array(c*i);u.fill(l);const d=t.data.get(s.dataId).values;for(let f=0;f<c;++f)d[f]>=0&&d[f]<i&&(u[f*i+d[f]]=a);return t.makeTensorInfo([...s.shape,i],o,u)}const vbe={kernelName:Nb,backendName:"cpu",kernelFunc:xbe};function ny(n){const{inputs:e,backend:t}=n,{x:r}=e;if(r.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(r.dtype==="complex64"){const s=Of({inputs:{input:r},backend:t}),o=ny({inputs:{x:s},backend:t}),i=Op({inputs:{input:r},backend:t}),a=ny({inputs:{x:i},backend:t}),l=wi({inputs:{real:o,imag:a},backend:t});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(a),l}else return kN({backend:t,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}const ybe={kernelName:zb,backendName:"cpu",kernelFunc:ny};function WV(n){const{inputs:e,backend:t}=n,{x:r}=e;if(r.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(r.dtype==="complex64"){const s=Of({inputs:{input:r},backend:t}),o=WV({inputs:{x:s},backend:t}),i=Op({inputs:{input:r},backend:t}),a=ny({inputs:{x:i},backend:t}),l=wi({inputs:{real:o,imag:a},backend:t});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(a),l}else return kN({backend:t,attrs:{shape:r.shape,value:1,dtype:r.dtype}})}const bbe={kernelName:Sb,backendName:"cpu",kernelFunc:WV};function UV(n){const{inputs:e,backend:t,attrs:r}=n,{axis:s}=r;if(e.length===1)return ty({inputs:{input:e[0]},backend:t,attrs:{dim:s}});const o=e[0].shape,i=e[0].dtype;e.forEach(u=>{Q6(o,u.shape,"All tensors passed to stack must have matching shapes"),X(i===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(u=>{const d=ty({inputs:{input:u},backend:t,attrs:{dim:s}});return a.push(d),d}),c=Mp({inputs:l,backend:t,attrs:{axis:s}});return a.forEach(u=>t.disposeIntermediateTensorInfo(u)),c}const wbe={kernelName:Eb,backendName:"cpu",kernelFunc:UV};function Cbe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{paddings:o,constantValue:i}=r;Mt(s,"pad");const a=o.map((w,S)=>w[0]+s.shape[S]+w[1]),l=o.map(w=>w[0]),c=t.data.get(s.dataId).values,u=Le(s.shape),d=s.shape.length,f=nn(s.shape),p=Le(a),x=a.length,v=nn(a),y=po(s.dtype,p);i!==0&&y.fill(i);for(let w=0;w<u;w++){const k=Yp(w,d,f).map((I,T)=>I+l[T]),N=Ql(k,x,v);y[N]=c[w]}return{dataId:t.write(y,a,s.dtype),shape:a,dtype:s.dtype}}const HV={kernelName:Ib,backendName:"cpu",kernelFunc:Cbe};const kbe=as((n,e)=>Math.pow(n,e)),Sbe=Ts(V1,kbe),Nbe={kernelName:V1,backendName:"cpu",kernelFunc:Sbe};function Ebe(n){const{inputs:e,backend:t,attrs:r}=n,{paramsNestedSplits:s,paramsDenseValues:o,indices:i}=e,{outputRaggedRank:a}=r,l=s.map(b=>t.data.get(b.dataId).values),c=s.map(b=>b.shape),u=t.data.get(o.dataId).values,d=t.data.get(i.dataId).values,[f,p,x]=uV(l,c,u,o.shape,o.dtype,d,i.shape),v=f.map(b=>t.makeTensorInfo([b.length],"int32",b)),y=t.makeTensorInfo(x,o.dtype,p);return v.concat([y])}const Ibe={kernelName:mO,backendName:"cpu",kernelFunc:Ebe};function Tbe(n){const{inputs:e,backend:t}=n,{starts:r,limits:s,deltas:o}=e,i=t.data.get(r.dataId).values,a=t.data.get(s.dataId).values,l=t.data.get(o.dataId).values,[c,u]=dV(i,r.shape,r.dtype,a,s.shape,l,o.shape),d=t.makeTensorInfo([c.length],"int32",c),f=t.makeTensorInfo([u.length],r.dtype,u);return[d,f]}const _be={kernelName:gO,backendName:"cpu",kernelFunc:Tbe};function Rbe(n){const{inputs:e,backend:t,attrs:r}=n,{shape:s,values:o,defaultValue:i,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=r,c=t.data.get(s.dataId).values,u=t.data.get(o.dataId).values,d=t.data.get(i.dataId).values,f=a.map(y=>t.data.get(y.dataId).values),p=a.map(y=>y.shape),[x,v]=fV(c,s.shape,u,o.shape,o.dtype,d,i.shape,f,p,l);return t.makeTensorInfo(x,o.dtype,v)}const Dbe={kernelName:xO,backendName:"cpu",kernelFunc:Rbe};function Abe(n){const{backend:e,attrs:t}=n,{start:r,stop:s,dtype:o,step:i}=t,a=hV(r,s,i,o);return e.makeTensorInfo([a.length],o,a)}const $be={kernelName:$S,backendName:"cpu",kernelFunc:Abe};const Fbe=mr(z1,n=>1/n),Pbe={kernelName:z1,backendName:"cpu",kernelFunc:Fbe};function Obe(n){const{inputs:e,backend:t,attrs:r}=n,{images:s}=e,{alignCorners:o,halfPixelCenters:i,size:a}=r;Mt(s,"resizeBilinear");const l=nn(s.shape),[c,u]=a,[d,f,p,x]=s.shape,v=t.data.get(s.dataId).values,y=new Float32Array(Le([d,c,u,x])),b=[o&&c>1?f-1:f,o&&u>1?p-1:p],w=[o&&c>1?c-1:c,o&&u>1?u-1:u];let S=0;const k=b[0]/w[0],N=b[1]/w[1];for(let I=0;I<d;I++)for(let T=0;T<c;T++){let F;i?F=k*(T+.5)-.5:F=k*T;const R=Math.max(0,Math.floor(F)),D=F-R,A=Math.min(f-1,Math.ceil(F)),P=I*l[0]+R*l[1],B=I*l[0]+A*l[1];for(let L=0;L<u;L++){let W;i?W=N*(L+.5)-.5:W=N*L;const H=Math.max(0,Math.floor(W)),G=W-H,M=Math.min(p-1,Math.ceil(W)),j=P+H*l[2],z=B+H*l[2],V=P+M*l[2],K=B+M*l[2];for(let J=0;J<x;J++){const oe=v[j+J],Z=v[z+J],de=v[V+J],pe=v[K+J],Ce=oe+(de-oe)*G,Ae=Z+(pe-Z)*G,ze=Ce+(Ae-Ce)*D;y[S++]=ze}}}return t.makeTensorInfo([d,c,u,x],"float32",y)}const Mbe={kernelName:Ab,backendName:"cpu",kernelFunc:Obe};function Lbe(n){const{inputs:e,backend:t,attrs:r}=n,{images:s,dy:o}=e,{alignCorners:i}=r;Mt([o,s],"resizeBilinearGrad");const a=nn(s.shape),[l,c,u,d]=s.shape,[,f,p]=o.shape,x=new Float32Array(l*c*u*d),v=[i&&f>1?c-1:c,i&&p>1?u-1:u],y=[i&&f>1?f-1:f,i&&p>1?p-1:p],b=v[0]/y[0],w=v[1]/y[1],S=t.data.get(o.dataId).values;let k=0;for(let N=0;N<l;N++){const I=N*a[0];for(let T=0;T<f;T++){const F=T*b,R=Math.floor(F),D=Math.min(Math.ceil(F),c-1),A=I+R*a[1],P=I+D*a[1],B=F-R,L=1-B;for(let W=0;W<p;W++){const H=W*w,G=Math.floor(H),M=Math.min(Math.ceil(H),u-1),j=H-G,z=1-j,V=A+G*a[2],K=A+M*a[2],J=P+G*a[2],oe=P+M*a[2],Z=L*z,de=L*j,pe=B*z,Ce=B*j;for(let Ae=0;Ae<d;Ae++){const ze=S[k++];x[V+Ae]+=ze*Z,x[K+Ae]+=ze*de,x[J+Ae]+=ze*pe,x[oe+Ae]+=ze*Ce}}}}return t.makeTensorInfo([l,u,c,d],"float32",x)}const jbe={kernelName:OS,backendName:"cpu",kernelFunc:Lbe};function Bbe(n){const{inputs:e,backend:t,attrs:r}=n,{images:s}=e,{alignCorners:o,halfPixelCenters:i,size:a}=r;Mt(s,"resizeNearestNeighbor");const l=nn(s.shape),[c,u]=a,[d,f,p,x]=s.shape,v=t.data.get(s.dataId).values,y=new Float32Array(d*c*u*x),b=[o&&c>1?f-1:f,o&&u>1?p-1:p],w=[o&&c>1?c-1:c,o&&u>1?u-1:u],S=b[0]/w[0],k=b[1]/w[1];let N=0;for(let I=0;I<d;I++){const T=I*l[0];for(let F=0;F<c;F++){const R=i?S*(F+.5):S*F;let D=Math.min(f-1,o?Math.round(R):Math.floor(R));i&&(D=Math.max(0,D));const A=T+D*l[1];for(let P=0;P<u;P++){const B=i?k*(P+.5):k*P;let L=Math.min(p-1,o?Math.round(B):Math.floor(B));i&&(L=Math.max(0,L));const W=A+L*l[2];for(let H=0;H<x;H++){const G=v[W+H];y[N++]=G}}}}return t.makeTensorInfo([d,c,u,x],s.dtype,y)}const Vbe={kernelName:Db,backendName:"cpu",kernelFunc:Bbe};function zbe(n){const{inputs:e,backend:t,attrs:r}=n,{images:s,dy:o}=e,{alignCorners:i}=r;Mt([o,s],"resizeNearestNeighborGrad");const a=nn(s.shape),l=nn(o.shape),[c,u,d,f]=s.shape,[,p,x]=o.shape,v=new Float32Array(c*u*d*f),y=t.data.get(o.dataId).values,b=[i&&p>1?u-1:u,i&&x>1?d-1:d],w=[i&&p>1?p-1:p,i&&x>1?x-1:x],S=b[0]/w[0],k=b[1]/w[1],N=1/S,I=1/k,T=Math.ceil(N)*2+2,F=Math.ceil(I)*2+2;for(let R=0;R<c;R++){const D=R*a[0];for(let A=0;A<u;A++){const P=D+A*a[1],B=Math.floor(A*N),L=Math.floor(B-T/2);for(let W=0;W<d;W++){const H=P+W*a[2],G=Math.floor(W*I),M=Math.floor(G-F/2);for(let j=0;j<f;j++){let z=0;for(let V=0;V<T;V++){const K=V+L;if(K<0||K>=p)continue;const J=D+K*l[1],oe=K*S,Z=Math.min(u-1,i?Math.round(oe):Math.floor(oe));if(A===Z)for(let de=0;de<F;de++){const pe=de+M;if(pe<0||pe>=x)continue;const Ce=J+pe*l[2],Ae=pe*k,ze=Math.min(d-1,i?Math.round(Ae):Math.floor(Ae));W===ze&&(z+=y[Ce+j])}}v[H+j]=z}}}}return t.makeTensorInfo(s.shape,s.dtype,v)}const Wbe={kernelName:PS,backendName:"cpu",kernelFunc:zbe};function Ube(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{dims:o}=r;Mt(s,"reverse");const i=s.shape.length,a=Fn(o,s.shape);if(i===0)return dc({inputs:{x:s},backend:t});const l=new to(s.shape,s.dtype),c=t.bufferSync(s);for(let u=0;u<l.size;u++){const d=l.indexToLoc(u),f=d.slice();a.forEach(p=>f[p]=s.shape[p]-1-f[p]),l.set(c.get(...f),...d)}return t.makeTensorInfo(l.shape,l.dtype,l.values)}const Hbe={kernelName:$b,backendName:"cpu",kernelFunc:Ube};const Gbe={kernelName:WS,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:r}=n,{radians:s,fillValue:o,center:i}=e,a=t,l=po(r.dtype,Le(r.shape)),[c,u,d,f]=r.shape,[p,x]=R8(i,u,d),v=255,y=Math.sin(s),b=Math.cos(s),w=a.data.get(r.dataId).values;for(let k=0;k<c;k++){const N=k*d*u*f;for(let I=0;I<u;I++){const T=I*(d*f);for(let F=0;F<d;F++){const R=F*f;for(let D=0;D<f;D++){const A=[c,I,F,D],P=A[2],B=A[1];let L=(P-p)*b-(B-x)*y,W=(P-p)*y+(B-x)*b;L=Math.round(L+p),W=Math.round(W+x);let H=o;if(typeof o!="number"&&(D===3?H=v:H=o[D]),L>=0&&L<d&&W>=0&&W<u){const M=W*(d*f),j=L*f,z=N+M+j+D;H=w[z]}const G=N+T+R+D;l[G]=H}}}}return{dataId:a.write(l,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};const qbe=mr(H1,n=>{const e=Math.floor(n);return n-e<.5?Math.floor(n):n-e>.5?Math.ceil(n):e%2===0?e:e+1}),Kbe={kernelName:H1,backendName:"cpu",kernelFunc:qbe};function Xbe(n){const{inputs:e,backend:t,attrs:r}=n,{indices:s,updates:o}=e,{shape:i}=r,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=Yf(o,s,i),f=!0,p=t.bufferSync(s),x=t.bufferSync(o),v=df(p,x,i,d,c,l,a,u,0,f);return t.makeTensorInfo(i,v.dtype,v.values)}const Ybe={kernelName:vO,backendName:"cpu",kernelFunc:Xbe};function Zbe(n,e){let t=0,r=n.length,s=0;for(;t<r;)s=Math.floor((t+r)/2),n[s]<e?t=s+1:r=s;return r}function Jbe(n,e){let t=0,r=n.length,s=0;for(;t<r;)s=Math.floor((t+r)/2),n[s]<=e?t=s+1:r=s;return r}function Qbe(n,e,t,r,s,o){const i=ns("int32",t*s);for(let a=0;a<t;++a){const l=n.slice(a*r,(a+1)*r),c=a*s;for(let u=0;u<s;++u)i[c+u]=o==="left"?Zbe(l,e[u+c]):Jbe(l,e[u+c])}return i}function ewe(n){const{inputs:e,backend:t,attrs:r}=n,{sortedSequence:s,values:o}=e,{side:i}=r,a=t.data.get(s.dataId).values,l=t.data.get(o.dataId).values,c=Qbe(a,l,s.shape[0],s.shape[1],o.shape[1],i);return t.makeTensorInfo(o.shape,"int32",c)}const twe={kernelName:bO,backendName:"cpu",kernelFunc:ewe};function nwe(n){const{inputs:e,backend:t}=n,{condition:r,t:s,e:o}=e;Mt([r,s,o],"select");const i=r.shape.length,a=t.data.get(r.dataId).values,l=t.data.get(s.dataId).values,c=t.data.get(o.dataId).values,u=Ei(s.dtype,o.dtype),d=mo(Le(s.shape),u);let f=0;const p=i===0||i>1||s.shape.length===1?1:Le(s.shape.slice(1));for(let x=0;x<a.length;x++)for(let v=0;v<p;v++)a[x]===1?d[f++]=l[x]:d[f++]=c[x];return t.makeTensorInfo(s.shape,u,d)}const rwe={kernelName:Fb,backendName:"cpu",kernelFunc:nwe};const swe=ew,owe=tw,iwe=mr(q1,n=>n>=0?owe*n:swe*(Math.exp(n)-1)),awe={kernelName:q1,backendName:"cpu",kernelFunc:iwe};const lwe=mr(Y1,n=>n<0?-1:n>0?1:0),cwe={kernelName:Y1,backendName:"cpu",kernelFunc:lwe};const uwe=mr(K1,n=>Math.sin(n)),dwe={kernelName:K1,backendName:"cpu",kernelFunc:uwe};const fwe=mr(X1,n=>Math.sinh(n)),hwe={kernelName:X1,backendName:"cpu",kernelFunc:fwe};const pwe=11920928955078125e-23,nR=Math.log(pwe)+2,mwe=mr(J1,n=>{const e=n>-nR,t=n<nR,r=Math.exp(n);let s;return t?s=r:e?s=n:s=Math.log(1+r),s}),gwe={kernelName:J1,backendName:"cpu",kernelFunc:mwe};function xwe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{blockShape:o,paddings:i}=r;Mt([s],"spaceToBatchND");const a=Le(o),l=[[0,0]];l.push(...i);for(let I=1+o.length;I<s.shape.length;++I)l.push([0,0]);const c=HV.kernelFunc({inputs:{x:s},backend:t,attrs:{paddings:l,constantValue:0}}),u=d0(c.shape,o,a,!1),d=f0(u.length,o.length,!1),f=h0(c.shape,o,a,!1),v=Tr({inputs:{x:c},backend:t,attrs:{shape:u}}),w=ri({inputs:{x:v},backend:t,attrs:{perm:d}}),N=Tr({inputs:{x:w},backend:t,attrs:{shape:f}});return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(w),N}const vwe={kernelName:Mb,backendName:"cpu",kernelFunc:xwe};function ywe(n){const{inputs:e,backend:t}=n,{indices:r,values:s,denseShape:o,defaultValue:i}=e;if(o.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${o.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${r.shape}`);if(s.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${s.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);const a=t.data.get(r.dataId).values,l=t.data.get(s.dataId).values,c=t.data.get(o.dataId).values,u=t.data.get(i.dataId).values[0],[d,f,p,x,v]=xV(a,r.shape,r.dtype,l,s.dtype,c,u);return[t.makeTensorInfo(f,r.dtype,d),t.makeTensorInfo([f[0]],s.dtype,p),t.makeTensorInfo([x.length],"bool",new Uint8Array(x.map(y=>Number(y)))),t.makeTensorInfo([v.length],r.dtype,new Int32Array(v))]}const bwe={kernelName:wO,backendName:"cpu",kernelFunc:ywe};function wwe(n){const{inputs:e,backend:t}=n,{inputIndices:r,inputShape:s,newShape:o}=e;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${r.shape}`);if(s.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${s.shape}`);if(o.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const i=Array.from(t.data.get(s.dataId).values),a=t.data.get(r.dataId).values,l=Array.from(t.data.get(o.dataId).values),[c,u,d]=vV(a,r.shape,r.dtype,i,l);return[t.makeTensorInfo(u,r.dtype,c),t.makeTensorInfo([d.length],o.dtype,new Int32Array(d))]}const Cwe={kernelName:CO,backendName:"cpu",kernelFunc:wwe};function kwe(n){const{inputs:e,backend:t}=n,{data:r,indices:s,segmentIds:o}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(s.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${s.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${o.shape}`);if(s.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");const i=t.data.get(r.dataId).values,a=t.data.get(s.dataId).values,l=t.data.get(o.dataId).values,[c,u]=yN(i,r.shape,r.dtype,a,l,!0);return t.makeTensorInfo(u,r.dtype,c)}const Swe={kernelName:kO,backendName:"cpu",kernelFunc:kwe};function Nwe(n){const{inputs:e,backend:t}=n,{data:r,indices:s,segmentIds:o}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(s.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${s.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${o.shape}`);if(s.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");const i=t.data.get(r.dataId).values,a=t.data.get(s.dataId).values,l=t.data.get(o.dataId).values,[c,u]=yN(i,r.shape,r.dtype,a,l);return t.makeTensorInfo(u,r.dtype,c)}const Ewe={kernelName:SO,backendName:"cpu",kernelFunc:Nwe};function Iwe(n){const{inputs:e,backend:t,attrs:r}=n,{sparseIndices:s,sparseValues:o,defaultValue:i}=e,{outputShape:a}=r,{sliceRank:l,numUpdates:c,sliceSize:u,strides:d,outputSize:f}=Yf(o,s,a),p=!1,x=t.bufferSync(s);let v;switch(o.dtype){case"bool":{const y=t.bufferSync(o),b=!!t.data.get(i.dataId).values[0];v=df(x,y,a,f,u,c,l,d,b,p);break}case"float32":{const y=t.bufferSync(o),b=t.data.get(i.dataId).values[0];v=df(x,y,a,f,u,c,l,d,b,p);break}case"int32":{const y=t.bufferSync(o),b=t.data.get(i.dataId).values[0];v=df(x,y,a,f,u,c,l,d,b,p);break}case"string":{const y=t.bufferSync(o),b=ld(t.data.get(i.dataId).values[0]);v=df(x,y,a,f,u,c,l,d,b,p);break}default:throw new Error(`Unsupported type ${o.dtype}`)}return t.makeTensorInfo(a,v.dtype,v.values)}const Twe={kernelName:NO,backendName:"cpu",kernelFunc:Iwe};function _we(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{numOrSizeSplits:o,axis:i}=r,a=Fn(i,s.shape)[0],l=H8(s,o,a),c=new Array(s.shape.length).fill(0),u=s.shape.slice();return l.map(d=>{const f=[...u];f[a]=d;const p=Mf({inputs:{x:s},backend:t,attrs:{begin:c,size:f}});return c[a]+=d,p})}const Rwe={kernelName:Lb,backendName:"cpu",kernelFunc:_we};const Dwe={kernelName:MS,backendName:"cpu",kernelFunc:({inputs:n,backend:e})=>{const{x:t}=n,r=e;Mt(t,"square");const s=r.data.get(t.dataId).values,o=new Float32Array(s.length);for(let a=0;a<s.length;++a){const l=s[a];o[a]=l*l}return{dataId:r.write(o,t.shape,t.dtype),shape:t.shape,dtype:t.dtype}}};const Awe=mr(o0,(n,e)=>{const t=e;return isNaN(n)?NaN:n>0?1:t.alpha}),$we={kernelName:o0,backendName:"cpu",kernelFunc:Awe};function Fwe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{begin:o,end:i,strides:a,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:d,shrinkAxisMask:f}=r;Mt(s,"stridedSlice");const{finalShapeSparse:p,finalShape:x,isIdentity:v,sliceDim0:y,isSimpleSlice:b,begin:w,end:S,strides:k}=I8(s.shape,o,i,a,l,c,u,d,f);let N;if(v)N=Tr({inputs:{x:s},backend:t,attrs:{shape:x}});else if(y||b){X(s.shape.length>=1,()=>`Input must have rank at least 1, got: ${s.shape.length}`);const I=S8(w,S,k),T=Mf({inputs:{x:s},backend:t,attrs:{begin:w,size:I}});N=Tr({inputs:{x:T},backend:t,attrs:{shape:x}}),t.disposeIntermediateTensorInfo(T)}else{const I=t.bufferSync(s),T=wV(p,I,k,w);N=t.makeTensorInfo(x,T.dtype,T.values)}return N}const Pwe={kernelName:jS,backendName:"cpu",kernelFunc:Fwe};function Owe(n){const{inputs:e,backend:t,attrs:r}=n,{separator:s,nGramWidths:o,leftPad:i,rightPad:a,padWidth:l,preserveShortSequences:c}=r,{data:u,dataSplits:d}=e,f=t.data.get(u.dataId).values,p=t.data.get(d.dataId).values,[x,v]=CV(f,p,s,o,i,a,l,c);return[t.makeTensorInfo([x.length],"string",x),t.makeTensorInfo(d.shape,"int32",v)]}const Mwe={kernelName:EO,backendName:"cpu",kernelFunc:Owe};function Lwe(n){const{inputs:e,backend:t,attrs:r}=n,{skipEmpty:s}=r,{input:o,delimiter:i}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(o.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);const a=t.data.get(o.dataId).values,l=t.data.get(i.dataId).values[0],[c,u,d]=kV(a,l,s),f=u.length;return[t.makeTensorInfo([f,2],"int32",c),t.makeTensorInfo([f],"string",u),t.makeTensorInfo([2],"int32",new Int32Array(d))]}const jwe={kernelName:IO,backendName:"cpu",kernelFunc:Lwe};function Bwe(n){const{inputs:e,backend:t,attrs:r}=n,{numBuckets:s}=r,{input:o}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(s<=0)throw new Error("Number of buckets must be at least 1");const i=t.data.get(o.dataId).values,a=SV(i,s);return t.makeTensorInfo(o.shape,"int32",a)}const Vwe={kernelName:TO,backendName:"cpu",kernelFunc:Bwe};const zwe=mr(n0,n=>Math.tan(n)),Wwe={kernelName:n0,backendName:"cpu",kernelFunc:zwe};const Uwe=mr(r0,n=>Math.tanh(n)),Hwe={kernelName:r0,backendName:"cpu",kernelFunc:Uwe};function Gwe(n){const{inputs:e,backend:t}=n,{tensor:r,indices:s,updates:o}=e,{sliceRank:i,numUpdates:a,sliceSize:l,strides:c,outputSize:u}=Yf(o,s,r.shape),d=!1,f=t.bufferSync(s),p=t.bufferSync(o),x=t.bufferSync(r),v=df(f,p,r.shape,u,l,a,i,c,x,d);return t.makeTensorInfo(r.shape,v.dtype,v.values)}const qwe={kernelName:yO,backendName:"cpu",kernelFunc:Gwe};function Kwe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{reps:o}=r;Mt(s,"tile");const i=EV(t.bufferSync(s),o);return t.makeTensorInfo(i.shape,i.dtype,i.values)}const Xwe={kernelName:s0,backendName:"cpu",kernelFunc:Kwe};function Ywe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{k:o,sorted:i}=r;Mt(s,"topk");const a=t.data.get(s.dataId).values,[l,c]=TV(a,s.shape,s.dtype,o,i);return[t.makeTensorInfo(l.shape,l.dtype,l.values),t.makeTensorInfo(c.shape,c.dtype,c.values)]}const Zwe={kernelName:BS,backendName:"cpu",kernelFunc:Ywe};function Jwe(n){const{inputs:e,attrs:t,backend:r}=n,{image:s,transforms:o}=e,{interpolation:i,fillMode:a,fillValue:l,outputShape:c}=t,[u,d,f,p]=s.shape,[x,v]=c??[d,f],y=[u,x,v,p],b=nn(s.shape),w=b[0],S=b[1],k=b[2],N=nn(y),I=N[0],T=N[1],F=N[2],R=po(s.dtype,Le(y));R.fill(l);const D=r.data.get(s.dataId).values,A=r.data.get(o.dataId).values;for(let B=0;B<u;++B){const L=o.shape[0]===1?A:A.subarray(B*8,B*8+8);for(let W=0;W<x;++W)for(let H=0;H<v;++H)for(let G=0;G<p;++G){let M;const j=L[6]*H+L[7]*W+1;if(j===0)continue;const z=(L[0]*H+L[1]*W+L[2])/j,V=(L[3]*H+L[4]*W+L[5])/j,K=rR(z,f,a),J=rR(V,d,a);switch(i){case"nearest":M=s3e(D,d,f,w,S,k,B,J,K,G,l);break;case"bilinear":M=o3e(D,d,f,w,S,k,B,J,K,G,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${i}`)}const oe=B*I+W*T+H*F+G;R[oe]=M}return r.makeTensorInfo(y,s.dtype,R)}return{dataId:r.write(R,y,s.dtype),shape:s.shape,dtype:s.dtype}}const Qwe={kernelName:VS,backendName:"cpu",kernelFunc:Jwe};function rR(n,e,t){switch(t){case"reflect":return e3e(n,e);case"wrap":return t3e(n,e);case"nearest":return r3e(n,e);case"constant":default:return n3e(n)}}function e3e(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const r=2*e;t<r&&(t=r*Math.trunc(-t/r)+t),t=t<-e?t+r:-t-1}else if(t>e-1)if(e<=1)t=0;else{const r=2*e;t-=r*Math.trunc(t/r),t>=e&&(t=r-t-1)}return Nf(0,t,e-1)}function t3e(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const r=e-1;t+=e*(Math.trunc(-t/r)+1)}else if(t>e-1)if(e<=1)t=0;else{const r=e-1;t-=e*Math.trunc(t/r)}return Nf(0,t,e-1)}function n3e(n,e){return n}function r3e(n,e){return Nf(0,n,e-1)}function ig(n,e,t,r,s,o,i,a,l,c,u){const d=i*r+a*s+l*o+c;return 0<=a&&a<e&&0<=l&&l<t?n[d]:u}function s3e(n,e,t,r,s,o,i,a,l,c,u){const d=Math.round(a),f=Math.round(l);return ig(n,e,t,r,s,o,i,d,f,c,u)}function o3e(n,e,t,r,s,o,i,a,l,c,u){const d=Math.floor(a),f=Math.floor(l),p=d+1,x=f+1,v=(x-l)*ig(n,e,t,r,s,o,i,d,f,c,u)+(l-f)*ig(n,e,t,r,s,o,i,d,x,c,u),y=(x-l)*ig(n,e,t,r,s,o,i,p,f,c,u)+(l-f)*ig(n,e,t,r,s,o,i,p,x,c,u);return(p-a)*v+(a-d)*y}function i3e(n){const{inputs:e,attrs:t,backend:r}=n,{axis:s}=t,{x:o}=e;Mt(o,"unique");const i=r.data.get(o.dataId).values,{outputValues:a,outputShape:l,indices:c}=_V(i,s,o.shape,o.dtype);return[r.makeTensorInfo(l,o.dtype,a),r.makeTensorInfo([c.length],"int32",c)]}const a3e={kernelName:zS,backendName:"cpu",kernelFunc:i3e};function l3e(n){const{inputs:e,backend:t,attrs:r}=n,{value:s}=e;let{axis:o}=r;o<0&&(o+=s.shape.length);const i=s.shape.length,a=s.shape[o],l=new Array(i-1);let c=0;for(let p=0;p<i;p++)p!==o&&(l[c++]=s.shape[p]);const u=new Array(i).fill(0),d=s.shape.slice();d[o]=1;const f=new Array(a);for(let p=0;p<f.length;p++){u[o]=p;const x=Mf({inputs:{x:s},backend:t,attrs:{begin:u,size:d}});f[p]=Tr({inputs:{x},backend:t,attrs:{shape:l}}),t.disposeIntermediateTensorInfo(x)}return f}const c3e={kernelName:Bb,backendName:"cpu",kernelFunc:l3e};function u3e(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,segmentIds:o}=e,{numSegments:i}=r;Mt(s,"unsortedSegmentSum");const a=s.shape.length,l=o.shape.length,c=[],u=[],d=a-l;let f=o;for(let x=0;x<d;++x){const v=ty({inputs:{input:f},backend:t,attrs:{dim:x+1}});f=v,u.push(v)}for(let x=0;x<i;++x){const v=yd(x,"int32"),y=t.makeTensorInfo([],"int32",v),b=UB({inputs:{a:y,b:f},backend:t}),w=hd({inputs:{x:b},backend:t,attrs:{dtype:"float32"}}),S=hw({inputs:{a:w,b:s},backend:t}),k=C0({inputs:{x:S},backend:t,attrs:{axis:0,keepDims:!1}});c.push(k),u.push(y),u.push(b),u.push(w),u.push(S),u.push(k)}const p=UV({inputs:c,backend:t,attrs:{axis:0}});return u.forEach(x=>t.disposeIntermediateTensorInfo(x)),p}const d3e={kernelName:Vb,backendName:"cpu",kernelFunc:u3e};const f3e=[ive,B0e,lve,uve,G0e,fve,pve,gve,vve,bve,Cve,Sve,Eve,_ve,Dve,Fve,Ove,Lve,Bve,sve,zve,Uve,Gve,K0e,Kve,U0e,Y0e,Yve,V0e,Jve,e2e,t2e,r2e,o2e,a2e,c2e,d2e,h2e,m2e,x2e,y2e,w2e,k2e,N2e,E2e,T2e,R2e,A2e,$2e,F2e,P2e,M2e,B2e,Zxe,z2e,Z0e,Y2e,J0e,Z2e,exe,rye,sye,iye,nxe,sxe,lye,uye,fye,pye,ixe,lxe,z0e,gye,Qve,vye,bye,Cye,Jxe,uxe,fxe,Sye,pxe,Eye,_ye,Dye,Fye,Oye,Lye,jye,gxe,Vye,Wye,Hye,qye,Xye,Zye,Qye,vxe,tbe,sbe,abe,bxe,Cxe,ube,hbe,gbe,Sxe,vbe,bbe,wbe,HV,Nbe,eve,Ixe,Ibe,_be,Dbe,$be,W0e,sk,Pbe,tve,nve,rve,Mbe,jbe,Vbe,Wbe,Hbe,Gbe,Kbe,Pxe,Ybe,twe,rwe,awe,Mxe,cwe,dwe,hwe,Lxe,obe,gwe,vwe,bwe,Cwe,Swe,Ewe,Twe,Rwe,Vxe,Dwe,Wxe,Hxe,$we,Pwe,Mwe,jwe,Vwe,Xxe,L2e,Wwe,Hwe,qwe,Xwe,Zwe,Qwe,Nxe,a3e,c3e,d3e,ybe];for(const n of f3e)RO(n);const of={},bv={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function h3e(n,e){of[n]=e}function hl(n,e){if(!(n in of)||e!=null){const r=m3e(n,e);if(r!==null)of[n]=r;else return console.log("Could not get context for WebGL version",n),null}const t=of[n];return t==null||t.isContextLost()?(delete of[n],hl(n)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),of[n])}function p3e(n){if(!De().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&n===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function m3e(n,e){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const t=e??p3e(n);return t.addEventListener("webglcontextlost",r=>{r.preventDefault(),delete of[n]},!1),De().getBool("SOFTWARE_WEBGL_ENABLED")&&(bv.failIfMajorPerformanceCaveat=!1),n===1?t.getContext("webgl",bv)||t.getContext("experimental-webgl",bv):t.getContext("webgl2",bv)}var Wg;(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(Wg||(Wg={}));var Zi;(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(Zi||(Zi={}));var Qs;(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(Qs||(Qs={}));function k0(n,e){return[e,n]}function g3e(n,e){return n*e}function wv(n){const e=Le(n),t=Math.ceil(e/4);return I5(t)}function sm(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function x3e(n,e){const[t,r]=sm(n,e);return t*r*4}function SN(n,e){const t=n;let r,s,o,i,a,l,c,u,d,f;return De().getNumber("WEBGL_VERSION")===2?(r=t.R32F,s=t.R16F,o=t.RGBA16F,i=t.RGBA32F,a=t.RED,c=4,u=1,d=t.HALF_FLOAT,f=t.FLOAT,l=t.RGBA8):(r=n.RGBA,s=n.RGBA,o=n.RGBA,i=t.RGBA,a=n.RGBA,c=4,u=4,d=e!=null?e.HALF_FLOAT_OES:null,f=n.FLOAT,l=n.RGBA),{internalFormatFloat:r,internalFormatHalfFloat:s,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:c,defaultNumChannels:u,textureTypeHalfFloat:d,textureTypeFloat:f}}function Et(n,e){const t=e();return De().getBool("DEBUG")&&v3e(n),t}function v3e(n){const e=n.getError();if(e!==n.NO_ERROR)throw new Error("WebGL Error: "+C3e(n,e))}const y3e=596e-10,b3e=65504;function w3e(n){return!!(De().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||y3e<Math.abs(n)&&Math.abs(n)<b3e)}function C3e(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function Cv(n,e){return nu(n,()=>n.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function k3e(n,e){const t=nu(n,()=>n.createShader(n.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(Et(n,()=>n.shaderSource(t,e)),Et(n,()=>n.compileShader(t)),n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function S3e(n,e){const t=nu(n,()=>n.createShader(n.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(Et(n,()=>n.shaderSource(t,e)),Et(n,()=>n.compileShader(t)),De().get("ENGINE_COMPILE_ONLY"))return t;if(n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw GV(e,n.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}const N3e=/ERROR: [0-9]+:([0-9]+):/g;function GV(n,e){const t=N3e.exec(e);if(t==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(n);return}const r=+t[1],s=n.split(`
`),o=s.length.toString().length+2,i=s.map((d,f)=>hp((f+1).toString(),o)+d);let a=0;for(let d=0;d<i.length;d++)a=Math.max(i[d].length,a);const l=i.slice(0,r-1),c=i.slice(r-1,r),u=i.slice(r);console.log(l.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${hp(c[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(u.join(`
`))}function E3e(n){return nu(n,()=>n.createProgram(),"Unable to create WebGLProgram.")}function I3e(n,e){if(Et(n,()=>n.linkProgram(e)),!De().get("ENGINE_COMPILE_ONLY")&&n.getProgramParameter(e,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function y4(n,e){if(Et(n,()=>n.validateProgram(e)),n.getProgramParameter(e,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function T3e(n,e){const t=nu(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return Et(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),Et(n,()=>n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function _3e(n,e){const t=nu(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return Et(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t)),Et(n,()=>n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function R3e(n){return nu(n,()=>n.createTexture(),"Unable to create WebGLTexture.")}function D3e(n,e){const t=De().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){const r=`[${n}x${e}]`;throw new Error("Requested texture size "+r+" is invalid.")}if(n>t||e>t){const r=`[${n}x${e}]`,s=`[${t}x${t}]`;throw new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+s+".")}}function A3e(n){return nu(n,()=>n.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function sR(n,e,t,r,s,o,i){const a=n.getAttribLocation(e,t);return a===-1?!1:(Et(n,()=>n.bindBuffer(n.ARRAY_BUFFER,r)),Et(n,()=>n.vertexAttribPointer(a,s,n.FLOAT,!1,o,i)),Et(n,()=>n.enableVertexAttribArray(a)),!0)}function $3e(n,e,t){L3e(n,t),Et(n,()=>n.activeTexture(n.TEXTURE0+t)),Et(n,()=>n.bindTexture(n.TEXTURE_2D,e))}function F3e(n,e,t){return nu(n,()=>n.getUniformLocation(e,t),'uniform "'+t+'" not present in program.')}function P3e(n,e,t){return n.getUniformLocation(e,t)}function O3e(n,e,t,r){Et(n,()=>$3e(n,e,r)),Et(n,()=>n.uniform1i(t,r))}function b4(n,e,t){Et(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,t)),Et(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0))}function oR(n,e){Et(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,e)),Et(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0))}function kv(n){const e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+M3e(n,e))}function M3e(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function nu(n,e,t){const r=Et(n,()=>e());if(r==null)throw new Error(t);return r}function L3e(n,e){const t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+n.TEXTURE0;if(r<n.TEXTURE0||r>t){const s=`[gl.TEXTURE0, gl.TEXTURE${t}]`;throw new Error(`textureUnit must be in ${s}.`)}}function Lp(n,e=2){return Le(n.slice(0,n.length-e))}function jp(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function Sv(n){let e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[Lp(n),...jp(n)]),e}function j3e(n,e=!1){let t=De().getNumber("WEBGL_MAX_TEXTURE_SIZE"),r=De().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");r===1/0&&De().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(r=t/2),e&&(t=t*2,r=r*2,n=n.map((a,l)=>l>=n.length-2?J6(n[l]):n[l]),n.length===1&&(n=[2,n[0]])),n.length!==2&&(n=vd(n).newShape);let s=Le(n),o=null;n.length<=1&&s<=t?o=[1,s]:n.length===2&&n[0]<=t&&n[1]<=t?o=n:n.length===3&&n[0]*n[1]<=t&&n[2]<=t?o=[n[0]*n[1],n[2]]:n.length===3&&n[0]<=t&&n[1]*n[2]<=t?o=[n[0],n[1]*n[2]]:n.length===4&&n[0]*n[1]*n[2]<=t&&n[3]<=t?o=[n[0]*n[1]*n[2],n[3]]:n.length===4&&n[0]<=t&&n[1]*n[2]*n[3]<=t&&(o=[n[0],n[1]*n[2]*n[3]]);const i=o!=null&&Math.max(...o)>r&&Math.min(...o)<=(e?2:1)&&Math.min(...o)>0;if(o==null||i)if(e){const a=Lp(n);let l=2,c=2;n.length&&([l,c]=jp(n)),s=a*(l/2)*(c/2),o=I5(s).map(u=>u*2)}else o=I5(s);return o}function Nv(n){return n%2===0}function ry(n,e){if(n=n.slice(-2),e=e.slice(-2),lr(n,e)||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){const t=n[n.length-1],r=e[e.length-1];if(t===r||Nv(t)&&Nv(r)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&Nv(n[0])&&Nv(e[0])}let w4,C4;function B3e(n){if(w4==null){const e=hl(n);w4=e.getParameter(e.MAX_TEXTURE_SIZE)}return w4}function V3e(n){if(C4==null){const e=hl(n);C4=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,C4)}function z3e(n){if(n===0)return 0;let e;const t=hl(n);return Ta(t,"EXT_disjoint_timer_query_webgl2")&&n===2?e=2:Ta(t,"EXT_disjoint_timer_query")?e=1:e=0,e}function Ta(n,e){return n.getExtension(e)!=null}function iR(n){try{if(hl(n)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function W3e(n){if(n===0)return!1;const e=hl(n);if(n===1){if(!Ta(e,"OES_texture_float"))return!1}else if(!Ta(e,"EXT_color_buffer_float"))return!1;return ik(e)}function U3e(n){if(n===0)return!1;const e=hl(n);if(n===1){if(!Ta(e,"OES_texture_float")||!Ta(e,"WEBGL_color_buffer_float"))return!1}else{if(Ta(e,"EXT_color_buffer_float"))return ik(e);const r="EXT_color_buffer_half_float";if(Ta(e,r)){const s=e.getExtension(r);return H3e(e,s)}return!1}return ik(e)}function ik(n){const e=SN(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const o=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,o),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);const i=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(o),i}function H3e(n,e){const t=SN(n,e),r=n.createTexture();n.bindTexture(n.TEXTURE_2D,r),n.texImage2D(n.TEXTURE_2D,0,t.internalFormatHalfFloat,1,1,0,t.textureFormatFloat,t.textureTypeHalfFloat,null);const i=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,i),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,r,0);const a=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(r),n.deleteFramebuffer(i),a}function G3e(n){return n!==2?!1:hl(n).fenceSync!=null}function S0(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&X(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}const Wt=De();Wt.registerFlag("HAS_WEBGL",()=>Wt.getNumber("WEBGL_VERSION")>0);Wt.registerFlag("WEBGL_VERSION",()=>iR(2)?2:iR(1)?1:0);Wt.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);Wt.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Wt.get("WEBGL_VERSION")===2);Wt.registerFlag("WEBGL_CPU_FORWARD",()=>!0);Wt.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);Wt.registerFlag("WEBGL_PACK",()=>Wt.getBool("HAS_WEBGL"));Wt.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Wt.getBool("WEBGL_PACK"));Wt.registerFlag("WEBGL_PACK_CLIP",()=>Wt.getBool("WEBGL_PACK"));Wt.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Wt.getBool("WEBGL_PACK"));Wt.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Wt.getBool("WEBGL_PACK"));Wt.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Wt.getBool("WEBGL_PACK"));Wt.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Wt.getBool("WEBGL_PACK"));Wt.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Wt.getBool("WEBGL_PACK"));Wt.registerFlag("WEBGL_PACK_REDUCE",()=>Wt.getBool("WEBGL_PACK"));Wt.registerFlag("WEBGL_LAZILY_UNPACK",()=>Wt.getBool("WEBGL_PACK"));Wt.registerFlag("WEBGL_CONV_IM2COL",()=>Wt.getBool("WEBGL_PACK"));Wt.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>Wt.getBool("WEBGL_PACK"));Wt.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>B3e(Wt.getNumber("WEBGL_VERSION")));Wt.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>V3e(Wt.getNumber("WEBGL_VERSION")));Wt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const n=Wt.getNumber("WEBGL_VERSION");return n===0?0:z3e(n)});Wt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Wt.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!WO());Wt.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>W3e(Wt.getNumber("WEBGL_VERSION")));Wt.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>Wt.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Wt.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));Wt.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>U3e(Wt.getNumber("WEBGL_VERSION")));Wt.registerFlag("WEBGL_FENCE_API_ENABLED",()=>G3e(Wt.getNumber("WEBGL_VERSION")));Wt.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Wt.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);Wt.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${n}.`)});Wt.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>WO()?1:-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${n}.`)});Wt.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);Wt.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);Wt.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);Wt.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);Wt.registerFlag("WEBGL_EXP_CONV",()=>!1);Wt.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>Wt.getBool("IS_TEST"));Wt.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);Wt.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);Wt.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);Wt.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);function Uo(){let n,e,t,r,s,o,i,a,l,c;return De().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",r="in",s="texture",o="outputColor",i="out vec4 outputColor;",a=De().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",r="varying",s="texture2D",o="gl_FragColor",i="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:r,texture2D:s,output:o,defineOutput:i,defineSpecialNaN:a,defineSpecialInf:l,defineRound:c}}function Qf(n,e,t="index"){const r=nn(e);return r.map((s,o)=>{const i=`int ${n[o]} = ${t} / ${s}`,a=o===r.length-1?`int ${n[o+1]} = ${t} - ${n[o]} * ${s}`:`index -= ${n[o]} * ${s}`;return`${i}; ${a};`}).join("")}function pw(n,e,t="index"){const r=nn(e);return r.map((s,o)=>{const i=`int ${n[o]} = ${t} / outShapeStrides[${o}]`,a=o===r.length-1?`int ${n[o+1]} = ${t} - ${n[o]} * outShapeStrides[${o}]`:`index -= ${n[o]} * outShapeStrides[${o}]`;return`${i}; ${a};`}).join("")}function q3e(n,e){const t=n.length,r=n.map(o=>`${e}[${o}]`),s=new Array(t-1);s[t-2]=r[t-1];for(let o=t-3;o>=0;--o)s[o]=`(${s[o+1]} * ${r[o+1]})`;return s}function K3e(n,e,t="index"){const r=n.map((o,i)=>i),s=q3e(r,e);return s.map((o,i)=>{const a=`int ${n[i]} = ${t} / ${s[i]}`,l=i===s.length-1?`int ${n[i+1]} = ${t} - ${n[i]} * ${s[i]}`:`index -= ${n[i]} * ${s[i]}`;return`${a}; ${l};`}).join("")}function NN(n){const e=nn(n).map(t=>t.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function EN(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const qV=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;const{getBroadcastDims:KV}=Lpe;function X3e(n,e,t){const r=[];if(n.forEach(p=>{const x=Le(p.shapeInfo.logicalShape);if(p.shapeInfo.isUniform?r.push(`uniform float ${p.name}${x>1?`[${x}]`:""};`):(r.push(`uniform sampler2D ${p.name};`),r.push(`uniform int offset${p.name};`)),t.enableShapeUniforms){const{uniformShape:v}=IN(t.packedInputs,p.shapeInfo.logicalShape,p.shapeInfo.texShape);switch(v.length){case 1:r.push(`uniform int ${p.name}Shape;`);break;case 2:r.push(`uniform ivec2 ${p.name}Shape;`);break;case 3:r.push(`uniform ivec3 ${p.name}Shape;`);break;case 4:r.push(`uniform ivec4 ${p.name}Shape;`);break}r.push(`uniform ivec2 ${p.name}TexShape;`)}}),t.enableShapeUniforms){switch(e.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;");break}r.push("uniform ivec2 outTexShape;")}t.customUniforms&&t.customUniforms.forEach(p=>{r.push(`uniform ${p.type} ${p.name}${p.arrayIndex?`[${p.arrayIndex}]`:""};`)});const s=r.join(`
`),o=n.map(p=>Y3e(p,e,t.packedInputs,t.enableShapeUniforms)).join(`
`),i=e.texShape,a=Uo(),l=Q3e(a);let c,u,d=nCe(a);return e.isPacked?(c=Z3e(e.logicalShape,i,t.enableShapeUniforms),u=tCe(a)):(c=J3e(e.logicalShape,i,t.enableShapeUniforms),u=eCe(a)),t.packedInputs&&(d+=iCe),[d,l,u,s,c,o,t.userCode].join(`
`)}function om(n,e=!1){const t=n.shapeInfo.logicalShape;switch(t.length){case 0:return vCe(n,e);case 1:return bCe(n,e);case 2:return CCe(n,e);case 3:return SCe(n,e);case 4:return ECe(n,e);case 5:return ICe(n);case 6:return TCe(n);default:throw new Error(`${t.length}-D input sampling is not yet supported`)}}function XV(n,e){switch(n.shapeInfo.logicalShape.length){case 0:return xCe(n);case 1:return yCe(n,e);case 2:return wCe(n,e);case 3:return kCe(n,e);default:return NCe(n,e)}}function Y3e(n,e,t=!1,r){let s="";t?s+=XV(n,r):s+=om(n,r);const o=n.shapeInfo.logicalShape,i=e.logicalShape;return o.length<=i.length&&(t?s+=_Ce(n,e):s+=RCe(n,e)),s}function Z3e(n,e,t){switch(n.length){case 0:return YV();case 1:return aCe(n,e,t);case 2:return mCe(n,e,t);case 3:return cCe(n,e,t);default:return dCe(n,e,t)}}function J3e(n,e,t){switch(n.length){case 0:return YV();case 1:return lCe(n,e,t);case 2:return gCe(n,e,t);case 3:return uCe(n,e,t);case 4:return fCe(n,e,t);case 5:return hCe(n,e);case 6:return pCe(n,e);default:throw new Error(`${n.length}-D output sampling is not yet supported`)}}function Q3e(n){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${n.texture2D}(textureSampler, uv).r;
    }
  `}function eCe(n){return`
    void setOutput(float val) {
      ${n.output} = vec4(val, 0, 0, 0);
    }
  `}function tCe(n){return`
    void setOutput(vec4 val) {
      ${n.output} = val;
    }
  `}function nCe(n){return`${n.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${n.varyingFs} vec2 resultUV;
    ${n.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${n.defineSpecialNaN}
    ${n.defineSpecialInf}
    ${n.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${rCe}
    ${sCe}
    ${oCe}
  `}const rCe=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,sCe=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,oCe=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,iCe=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function YV(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function aCe(n,e,t){const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return r[0]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${r[1]}.0);
      }
    `:r[1]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${r[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      return 2 * (resTexRC.x * ${r[1]} + resTexRC.y);
    }
  `}function lCe(n,e,t){return e[0]===1?t?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?t?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function cCe(n,e,t){if(t)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],s=Math.ceil(n[2]/2),o=s*Math.ceil(n[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${s});
      int c = imod(index, ${s}) * 2;

      return ivec3(b, r, c);
    }
  `}function uCe(n,e,t){if(t)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${pw(["r","c","d"],n)}
    return ivec3(r, c, d);
  }
`;const r=Qf(["r","c","d"],n);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${r}
      return ivec3(r, c, d);
    }
  `}function dCe(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],s=Math.ceil(n[n.length-1]/2),o=s*Math.ceil(n[n.length-2]/2);let i=o,a="",l="b, r, c";for(let c=2;c<n.length-1;c++)i*=n[n.length-c-1],a=`
      int b${c} = index / ${i};
      index -= b${c} * ${i};
    `+a,l=`b${c}, `+l;return`
    ivec${n.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      ${a}

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${s});
      int c = imod(index, ${s}) * 2;

      return ivec${n.length}(${l});
    }
  `}function fCe(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${pw(["r","c","d","d2"],n)}
      return ivec4(r, c, d, d2);
    }
  `;const r=Qf(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${r}
      return ivec4(r, c, d, d2);
    }
  `}function hCe(n,e){const t=Qf(["r","c","d","d2","d3"],n);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function pCe(n,e){const t=Qf(["r","c","d","d2","d3","d4"],n);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function mCe(n,e,t){const r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(lr(n,e))return t?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${r[0]}, ${r[1]}));
      }
    `;const s=Math.ceil(n[1]/2);return t?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));

      int index = resTexRC.x * ${r[1]} + resTexRC.y;
      int r = 2 * (index / ${s});
      int c = imod(index, ${s}) * 2;

      return ivec2(r, c);
    }
  `}function gCe(n,e,t){return lr(n,e)?t?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:n[1]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:n[0]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:t?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${n[1]};
      int c = index - r * ${n[1]};
      return ivec2(r, c);
    }
  `}function eh(n){return`offset${n}`}function xCe(n){const e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),r=Uo();return`
    vec4 ${t}() {
      return ${r.texture2D}(${e}, halfCR);
    }
  `}function vCe(n,e){const t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`float ${r}() {return ${t};}`;const[s,o]=n.shapeInfo.texShape;if(s===1&&o===1)return`
      float ${r}() {
        return sampleTexture(${t}, halfCR);
      }
    `;const i=eh(t);if(e)return`
    float ${r}() {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], ${i});
      return sampleTexture(${t}, uv);
    }
  `;const[a,l]=n.shapeInfo.texShape;return`
    float ${r}() {
      vec2 uv = uvFromFlat(${a}, ${l}, ${i});
      return sampleTexture(${t}, uv);
    }
  `}function yCe(n,e){const t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),s=n.shapeInfo.texShape,o=Uo();if(e)return`
    vec4 ${r}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${o.texture2D}(${t}, uv);
    }
  `;const i=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];return`
    vec4 ${r}(int index) {
      vec2 uv = packedUVfrom1D(
        ${i[0]}, ${i[1]}, index);
      return ${o.texture2D}(${t}, uv);
    }
  `}function bCe(n,e){const t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`
      float ${r}(int index) {
        ${im(n)}
      }
    `;const s=n.shapeInfo.texShape,o=s[0],i=s[1];if(i===1&&o===1)return`
      float ${r}(int index) {
        return sampleTexture(${t}, halfCR);
      }
    `;const a=eh(t);return i===1?e?`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${t}TexShape[0]));
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${o}.0);
        return sampleTexture(${t}, uv);
      }
    `:o===1?e?`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${t}TexShape[1]), 0.5);
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${i}.0, 0.5);
        return sampleTexture(${t}, uv);
      }
    `:e?`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], index + ${a});
      return sampleTexture(${t}, uv);
    }
  `:`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${o}, ${i}, index + ${a});
      return sampleTexture(${t}, uv);
    }
  `}function wCe(n,e){const t=n.shapeInfo.logicalShape,r=n.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),o=n.shapeInfo.texShape,i=o[0],a=o[1],l=Uo();if(o!=null&&lr(t,o))return e?`
      vec4 ${s}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);

        return ${l.texture2D}(${r}, uv);
      }
    `:`
      vec4 ${s}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${i}.0);

        return ${l.texture2D}(${r}, uv);
      }
    `;if(e)return`
    vec4 ${s}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${r}, uv);
    }
  `;const c=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],u=Math.ceil(t[1]/2);return`
    vec4 ${s}(int row, int col) {
      vec2 uv = packedUVfrom2D(${u}, ${c[0]}, ${c[1]}, row, col);
      return ${l.texture2D}(${r}, uv);
    }
  `}function CCe(n,e){const t=n.shapeInfo.logicalShape,r=n.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),o=n.shapeInfo.texShape;if(o!=null&&lr(t,o)){if(e)return`
      float ${s}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `;const f=o[0],p=o[1];return`
    float ${s}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${p}.0, ${f}.0);
      return sampleTexture(${r}, uv);
    }
  `}const{newShape:i,keptDims:a}=vd(t),l=i;if(l.length<t.length){const f=am(n,l),p=["row","col"];return`
      ${om(f,e)}
      float ${s}(int row, int col) {
        return ${s}(${lm(p,a)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${t[1]}, 1)));
        ${im(n)}
      }
    `;const c=o[0],u=o[1],d=eh(r);return u===1?e?`
      float ${s}(int row, int col) {
        float index = dot(vec3(row, col, ${d}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${r}TexShape[0]));
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${s}(int row, int col) {
      float index = dot(vec3(row, col, ${d}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${c}.0);
      return sampleTexture(${r}, uv);
    }
  `:c===1?e?`
      float ${s}(int row, int col) {
        float index = dot(vec3(row, col, ${d}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${r}TexShape[1]), 0.5);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${s}(int row, int col) {
      float index = dot(vec3(row, col, ${d}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${u}.0, 0.5);
      return sampleTexture(${r}, uv);
    }
  `:e?`
      float ${s}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${r}Shape[1] + col + ${d};
        vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
        return sampleTexture(${r}, uv);
      }
    `:`
  float ${s}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${t[1]} + col + ${d};
    vec2 uv = uvFromFlat(${c}, ${u}, index);
    return sampleTexture(${r}, uv);
  }
`}function kCe(n,e){const t=n.shapeInfo.logicalShape,r=n.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),o=n.shapeInfo.texShape,i=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(t[0]===1){const f=t.slice(1),p=[1,2],x=am(n,f),v=["b","row","col"];return`
        ${XV(x,e)}
        vec4 ${s}(int b, int row, int col) {
          return ${s}(${lm(v,p)});
        }
      `}const a=Uo();if(e)return`
    vec4 ${s}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${r}, uv);
    }
  `;const l=i[0],c=i[1],u=Math.ceil(t[2]/2),d=u*Math.ceil(t[1]/2);return`
    vec4 ${s}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${c}, ${d}, ${u}, b, row, col);
      return ${a.texture2D}(${r}, uv);
    }
  `}function SCe(n,e){const t=n.shapeInfo.logicalShape,r=n.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),o=t[1]*t[2],i=t[2],{newShape:a,keptDims:l}=vd(t),c=a;if(c.length<t.length){const v=am(n,c),y=["row","col","depth"];return`
        ${om(v,e)}
        float ${s}(int row, int col, int depth) {
          return ${s}(${lm(y,l)});
        }
      `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${o}, ${i}, 1)));
        ${im(n)}
      }
    `;const u=n.shapeInfo.texShape,d=u[0],f=u[1],p=n.shapeInfo.flatOffset;if(f===o&&p==null)return e?`
      float ${s}(int row, int col, int depth) {
        int stride1 = ${r}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
        float ${s}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${i}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${f}.0, ${d}.0);
          return sampleTexture(${r}, uv);
        }
      `;if(f===i&&p==null)return e?`
      float ${s}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${r}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${s}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${t[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${f}.0, ${d}.0);
      return sampleTexture(${r}, uv);
    }
  `;const x=eh(r);return e?`
    float ${s}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${r}Shape[1] * ${r}Shape[2];
      int stride1 = ${r}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${x};
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
      return sampleTexture(${r}, uv);
    }
    `:`
      float ${s}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${o} + col * ${i} + depth + ${x};
        vec2 uv = uvFromFlat(${d}, ${f}, index);
        return sampleTexture(${r}, uv);
      }
  `}function NCe(n,e){const t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),s=Uo();if(e)return`
    vec4 ${r}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${t}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${t}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${t}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${s.texture2D}(${t}, uv);
    }
  `;const o=n.shapeInfo.logicalShape,i=o.length,a=n.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],c=l[0],u=l[1],d=Math.ceil(o[i-1]/2);let f=d*Math.ceil(o[i-2]/2),p="int b, int row, int col",x=`b * ${f} + (row / 2) * ${d} + (col / 2)`;for(let v=2;v<i-1;v++)p=`int b${v}, `+p,f*=o[i-v-1],x=`b${v} * ${f} + `+x;return`
    vec4 ${r}(${p}) {
      int index = ${x};
      int texR = index / ${u};
      int texC = index - texR * ${u};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${u}, ${c});
      return ${s.texture2D}(${t}, uv);
    }
  `}function ECe(n,e){const t=n.shapeInfo.logicalShape,r=n.name,s="get"+r.charAt(0).toUpperCase()+r.slice(1),o=t[3],i=t[2]*o,a=t[1]*i,{newShape:l,keptDims:c}=vd(t);if(l.length<t.length){const w=am(n,l),S=["row","col","depth","depth2"];return`
      ${om(w,e)}
      float ${s}(int row, int col, int depth, int depth2) {
        return ${s}(${lm(S,c)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${i}, ${o}, 1)));
        ${im(n)}
      }
    `;const u=n.shapeInfo.flatOffset,d=n.shapeInfo.texShape,f=d[0],p=d[1],x=`int stride2 = ${r}Shape[3];`,v=`int stride1 = ${r}Shape[2] * stride2;`,y=`int stride0 = ${r}Shape[1] * stride1;`;if(p===a&&u==null)return e?`
      float ${s}(int row, int col, int depth, int depth2) {
        ${x}
        ${v}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${s}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${i}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${f}.0);
        return sampleTexture(${r}, uv);
      }
    `;if(p===o&&u==null)return e?`
      float ${s}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${r}Shape[1] * ${r}Shape[2], ${r}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${s}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${t[1]*t[2]}, ${t[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${f}.0);
        return sampleTexture(${r}, uv);
      }
    `;const b=eh(r);return e?`
    float ${s}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${x}
      ${v}
      ${y}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index + ${b});
      return sampleTexture(${r}, uv);
    }
  `:`
    float ${s}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${i} +
          depth * ${o} + depth2;
      vec2 uv = uvFromFlat(${f}, ${p}, index + ${b});
      return sampleTexture(${r}, uv);
    }
  `}function ICe(n){const e=n.shapeInfo.logicalShape,t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),s=e[4],o=e[3]*s,i=e[2]*o,a=e[1]*i,{newShape:l,keptDims:c}=vd(e);if(l.length<e.length){const v=am(n,l),y=["row","col","depth","depth2","depth3"];return`
      ${om(v)}
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        return ${r}(${lm(y,c)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${i}, ${o}, ${s})) +
          depth3;
        ${im(n)}
      }
    `;const u=n.shapeInfo.flatOffset,d=n.shapeInfo.texShape,f=d[0],p=d[1];if(p===a&&u==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${i}, ${o}, ${s}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${f}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(p===s&&u==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${f}.0);
        return sampleTexture(${t}, uv);
      }
    `;const x=eh(t);return`
    float ${r}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${i} + depth * ${o} +
          depth2 * ${s} + depth3 + ${x};
      vec2 uv = uvFromFlat(${f}, ${p}, index);
      return sampleTexture(${t}, uv);
    }
  `}function TCe(n){const e=n.shapeInfo.logicalShape,t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),{newShape:s,keptDims:o}=vd(e);if(s.length<e.length){const y=am(n,s),b=["row","col","depth","depth2","depth3","depth4"];return`
      ${om(y)}
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${r}(${lm(b,o)});
      }
    `}const i=e[5],a=e[4]*i,l=e[3]*a,c=e[2]*l,u=e[1]*c;if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${u}, ${c}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${i}, 1)));
        ${im(n)}
      }
    `;const d=n.shapeInfo.flatOffset,f=n.shapeInfo.texShape,p=f[0],x=f[1];if(x===u&&d==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${c}, ${l}, ${a}, ${i})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${x}.0, ${p}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(x===i&&d==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${x}.0, ${p}.0);
        return sampleTexture(${t}, uv);
      }
    `;const v=eh(t);return`
    float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${u} + col * ${c} + depth * ${l} +
          depth2 * ${a} + depth3 * ${i} + depth4 + ${v};
      vec2 uv = uvFromFlat(${p}, ${x}, index);
      return sampleTexture(${t}, uv);
    }
  `}function im(n){const e=n.name,t=Le(n.shapeInfo.logicalShape);return t<2?`return ${e};`:`
    for (int i = 0; i < ${t}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function _Ce(n,e){const t=n.name,r=t.charAt(0).toUpperCase()+t.slice(1),s="get"+r+"AtOutCoords",o=n.shapeInfo.logicalShape.length,i=e.logicalShape.length,a=KV(n.shapeInfo.logicalShape,e.logicalShape),l=br(i),c=i-o;let u;const d=["x","y","z","w","u","v"];o===0?u="":i<2&&a.length>=1?u="coords = 0;":u=a.map(w=>`coords.${d[w+c]} = 0;`).join(`
`);let f="";i<2&&o>0?f="coords":f=n.shapeInfo.logicalShape.map((w,S)=>`coords.${d[S+c]}`).join(", ");let p="return outputValue;";const v=Le(n.shapeInfo.logicalShape)===1,b=Le(e.logicalShape)===1;if(o===1&&!v&&!b)p=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(v&&!b)i===1?p=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:p=`
        return vec4(outputValue.x);
      `;else if(a.length){const w=o-2,S=o-1;a.indexOf(w)>-1&&a.indexOf(S)>-1?p="return vec4(outputValue.x);":a.indexOf(w)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(S)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${s}() {
      ${l} coords = getOutputCoords();
      ${u}
      vec4 outputValue = get${r}(${f});
      ${p}
    }
  `}function RCe(n,e){const t=n.name,r=t.charAt(0).toUpperCase()+t.slice(1),s="get"+r+"AtOutCoords",o=e.texShape,i=n.shapeInfo.texShape,a=n.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!n.shapeInfo.isUniform&&a===l&&n.shapeInfo.flatOffset==null&&lr(i,o))return`
      float ${s}() {
        return sampleTexture(${t}, resultUV);
      }
    `;const c=br(l),u=KV(n.shapeInfo.logicalShape,e.logicalShape),d=l-a;let f;const p=["x","y","z","w","u","v"];a===0?f="":l<2&&u.length>=1?f="coords = 0;":f=u.map(v=>`coords.${p[v+d]} = 0;`).join(`
`);let x="";return l<2&&a>0?x="coords":x=n.shapeInfo.logicalShape.map((v,y)=>`coords.${p[y+d]}`).join(", "),`
    float ${s}() {
      ${c} coords = getOutputCoords();
      ${f}
      return get${r}(${x});
    }
  `}function br(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error(`GPU for rank ${n} is not yet supported`)}function IN(n,e,t){const{newShape:r,keptDims:s}=vd(e),o=e.length,i=n&&o===3&&e[0]===1,a=i?e.slice(1):r,l=!n&&o>1&&!lr(e,t)&&r.length<o||i;return{useSqueezeShape:l,uniformShape:l?a:e,keptDims:s}}function am(n,e){const t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function lm(n,e){return e.map(t=>n[t]).join(", ")}function DCe(n,e,t,r){const s=t.map((u,d)=>{const f={logicalShape:u.shape,texShape:u.isUniform?null:u.texData.texShape,isUniform:u.isUniform,isPacked:u.isUniform?!1:u.texData.isPacked,flatOffset:null};return u.texData!=null&&u.texData.slice!=null&&u.texData.slice.flatOffset>0&&(f.flatOffset=u.texData.slice.flatOffset),{name:e.variableNames[d],shapeInfo:f}}),o=s.map(u=>u.shapeInfo),i={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},a=X3e(s,i,e),l=S3e(n.gl,a),c=n.createProgram(l);return De().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:l,source:a,webGLProgram:c,inShapeInfos:o,outShapeInfo:i,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(n.buildVao(c),Object.assign({program:e,fragmentShader:l,source:a,webGLProgram:c,inShapeInfos:o,outShapeInfo:i},ZV(n,e,c)))}function ZV(n,e,t){const r=[],s=[];let o,i,a,l=null,c=null;c=n.getUniformLocation(t,"NAN",!1),De().getNumber("WEBGL_VERSION")===1&&(l=n.getUniformLocation(t,"INFINITY",!1));const u=!1;for(const d of e.variableNames){const f={name:d,uniform:n.getUniformLocation(t,d,u),offset:n.getUniformLocation(t,`offset${d}`,u)};e.enableShapeUniforms&&(f.shape=n.getUniformLocation(t,`${d}Shape`,u),f.texShape=n.getUniformLocation(t,`${d}TexShape`,u)),r.push(f)}if(e.enableShapeUniforms&&(o=n.getUniformLocation(t,"outShape",u),a=n.getUniformLocation(t,"outShapeStrides",u),i=n.getUniformLocation(t,"outTexShape",u)),e.customUniforms)for(const d of e.customUniforms)s.push(n.getUniformLocation(t,d.name,u));return{variablesLocations:r,customUniformLocations:s,infLoc:l,nanLoc:c,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:i}}function aR(n,e){if(n.length!==e.length)throw Error(`Binary was compiled with ${n.length} inputs, but was executed with ${e.length} inputs`);n.forEach((t,r)=>{const s=t.logicalShape,o=e[r],i=o.shape;if(!lr(s,i))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${s} and ${i} must match`);if(t.isUniform&&o.isUniform)return;const a=t.texShape,l=o.isUniform?null:o.texData.texShape;if(!lr(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function ACe(n,e,t,r,s){e.program.enableShapeUniforms||(aR(e.inShapeInfos,t),aR([e.outShapeInfo],[r]));const o=r.texData.texture,i=r.texData.texShape;r.texData.isPacked?n.setOutputPackedMatrixTexture(o.texture,i[0],i[1]):n.setOutputMatrixTexture(o.texture,i[0],i[1]),n.setProgram(e.webGLProgram),n.bindVertexArray(e.webGLProgram.vao),De().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&n.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&n.gl.uniform1f(e.nanLoc,NaN);for(let l=0;l<t.length;++l){const c=t[l],{uniform:u,offset:d,shape:f,texShape:p}=e.variablesLocations[l];if(f){const{uniformShape:x}=IN(e.program.packedInputs,c.shape,c.texData.texShape);switch(x.length){case 1:n.gl.uniform1iv(f,new Int32Array(x));break;case 2:n.gl.uniform2iv(f,new Int32Array(x));break;case 3:n.gl.uniform3iv(f,new Int32Array(x));break;case 4:n.gl.uniform4iv(f,new Int32Array(x));break}}if(p&&n.gl.uniform2i(p,c.texData.texShape[0],c.texData.texShape[1]),u!=null){if(c.isUniform){if(Le(c.shape)<2)n.gl.uniform1f(u,c.uniformValues[0]);else{let x=c.uniformValues;x instanceof Float32Array||(x=new Float32Array(x)),n.gl.uniform1fv(u,x)}continue}c.texData.slice!=null&&d!=null&&n.gl.uniform1i(d,c.texData.slice.flatOffset),n.setInputMatrixTexture(c.texData.texture.texture,u,l)}}const a=e.outShapeLocation;if(a)switch(r.shape.length){case 1:n.gl.uniform1iv(a,new Int32Array(r.shape));break;case 2:n.gl.uniform2iv(a,new Int32Array(r.shape));break;case 3:n.gl.uniform3iv(a,new Int32Array(r.shape));break;case 4:n.gl.uniform4iv(a,new Int32Array(r.shape));break}if(e.outShapeStridesLocation){const l=nn(r.shape);switch(r.shape.length){case 2:n.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(l));break;case 3:n.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(l));break;case 4:n.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(l));break}}if(e.outTexShapeLocation&&n.gl.uniform2i(e.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),e.program.customUniforms&&s)for(let l=0;l<e.program.customUniforms.length;++l){const c=e.program.customUniforms[l],u=e.customUniformLocations[l],d=s[l];if(c.type==="float")n.gl.uniform1fv(u,d);else if(c.type==="vec2")n.gl.uniform2fv(u,d);else if(c.type==="vec3")n.gl.uniform3fv(u,d);else if(c.type==="vec4")n.gl.uniform4fv(u,d);else if(c.type==="int")n.gl.uniform1iv(u,d);else if(c.type==="ivec2")n.gl.uniform2iv(u,d);else if(c.type==="ivec3")n.gl.uniform3iv(u,d);else if(c.type==="ivec4")n.gl.uniform4iv(u,d);else throw Error(`uniform type ${c.type} is not supported yet.`)}n.executeProgram()}function $Ce(n,e,t){let r="";e.concat(t).forEach(i=>{const a=i.texData!=null&&i.texData.slice!=null&&i.texData.slice.flatOffset>0;if(n.enableShapeUniforms&&!i.isUniform){const l=i.texData.texShape,{useSqueezeShape:c,uniformShape:u,keptDims:d}=IN(n.packedInputs,i.shape,l);let f="",p="",x="";if(u.length===1&&n.packedInputs){const N=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];f=`${N[0]>1}_${N[1]>1}`}else if(u.length===2&&!n.packedInputs)p=`${u[0]>1}_${u[1]>1}`;else if(u.length>2&&!n.packedInputs){const N=nn(u);x=`${N[0]===l[1]}_${N[N.length-1]===l[1]}`}const v=i.shape.length,y=u.length===2&&lr(i.shape,l),b=Le(i.shape)===1,w=Ap(i.shape,t.shape),S=!n.packedInputs&&v===t.shape.length&&lr(l,t.texData.texShape),k=n.packedInputs||u.length>2?"":`${l[0]>1}_${l[1]>1}`;r+=`${v}_${S}_${c?d:""}_${u.length}_${b}_${w}_${y}_${f}_${p}_${x}_${k}_${a}`}else{const l=i.isUniform?"uniform":i.texData.texShape;r+=`${i.shape}_${l}_${a}`}});const s=n.userCode;let o=n.constructor.name;return o+="_"+r+"_"+s+`${De().getNumber("WEBGL_VERSION")}`,o}function yo(n){return De().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&n<=4}class FCe{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Wg.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=Uo();this.outputShape=e,this.enableShapeUniforms=yo(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?pw(["r","c","d"],e):Qf(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${t.output} = result;
      }
    `}}class PCe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Wg.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=Uo();this.outputShape=e,this.enableShapeUniforms=yo(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?pw(["r","c","d"],e):Qf(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${t.output} = result;
      }
    `}}class OCe{constructor(e){this.variableNames=["A"],this.outTexUsage=Zi.DOWNLOAD;const t=Uo();this.outputShape=e,this.userCode=`
      ${qV}

      void main() {
        float x = getAAtOutCoords();
        ${t.output} = encode_float(x);
      }
    `}}class MCe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Zi.DOWNLOAD;const t=Uo();this.outputShape=e,this.userCode=`
      ${qV}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${t.output} = encode_float(x);
      }
    `}}const LCe={R:0,G:1,B:2,A:3};class lR{constructor(e,t=!1,r="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=Uo();this.outputShape=e,this.enableShapeUniforms=yo(this.outputShape.length);let o="result";t&&(o="floor(result * 255. + 0.5)");let i="";for(let a=0;a<r.length;a++){const l=r[a];i+=`
          if(offset == ${a}) {
            result = values[${LCe[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?EN():NN(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${r.length});

        flatIndex = idiv(flatIndex, ${r.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${s.texture2D}(A, uv);
          ${i}
        }
        ${s.output} = vec4(${o}, 0., 0., 0.);
      }
    `}}class jCe{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=Uo();this.outputShape=e,this.enableShapeUniforms=yo(this.outputShape.length);let s="",o="result";t&&(o="floor(result * 255. + 0.5)");for(let i=0;i<=1;i++)for(let a=0;a<=1;a++){const l=i*2+a;s+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${i} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${i};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${r.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?EN():NN(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${s}

          ${r.output} = ${o};
        }
    `}}function BCe(n){const e=Uo(),t=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return k3e(n,t)}function VCe(n){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return T3e(n,e)}function zCe(n){const e=new Uint16Array([0,1,2,2,1,3]);return _3e(n,e)}function N0(n,e,t,r,s,o){D3e(e,t);const i=R3e(n),a=n.TEXTURE_2D;return Et(n,()=>n.bindTexture(a,i)),Et(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)),Et(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),Et(n,()=>n.texParameteri(a,n.TEXTURE_MIN_FILTER,n.NEAREST)),Et(n,()=>n.texParameteri(a,n.TEXTURE_MAG_FILTER,n.NEAREST)),De().getNumber("WEBGL_VERSION")===1?Et(n,()=>n.texImage2D(a,0,r,e,t,0,s,o,null)):Et(n,()=>n.texStorage2D(a,1,r,e,t)),Et(n,()=>n.bindTexture(n.TEXTURE_2D,null)),{texture:i,texShape:[t,e]}}function JV(n){return n.internalFormatFloat}function WCe(n,e,t,r){const[s,o]=k0(e,t);return N0(n,s,o,JV(r),r.textureFormatFloat,n.FLOAT)}function QV(n){return n.internalFormatHalfFloat}function UCe(n,e,t,r){const[s,o]=k0(e,t);return N0(n,s,o,QV(r),r.textureFormatFloat,r.textureTypeHalfFloat)}function ez(n){return n.downloadTextureFormat}function HCe(n,e,t,r){const[s,o]=k0(e,t);return N0(n,s,o,ez(r),n.RGBA,n.UNSIGNED_BYTE)}function tz(n){return n.internalFormatPackedFloat}function GCe(n,e,t,r){const[s,o]=sm(e,t);return N0(n,s,o,tz(r),n.RGBA,n.FLOAT)}function nz(n){return n.internalFormatPackedHalfFloat}function qCe(n,e,t,r){const[s,o]=sm(e,t);return N0(n,s,o,nz(r),n.RGBA,r.textureTypeHalfFloat)}function KCe(n,e,t){return Et(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),sR(n,e,"clipSpacePos",t,3,20,0)&&sR(n,e,"uv",t,2,20,12)}function XCe(n,e,t,r,s,o){Et(n,()=>n.bindTexture(n.TEXTURE_2D,e));let i,a,l;s instanceof Uint8Array?(i=new Uint8Array(t*r*4),a=n.UNSIGNED_BYTE,l=n.RGBA):(i=new Float32Array(t*r*4),a=n.FLOAT,l=o.internalFormatPackedFloat),i.set(s),De().getNumber("WEBGL_VERSION")===2?Et(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t,r,n.RGBA,a,i)):Et(n,()=>n.texImage2D(n.TEXTURE_2D,0,l,t,r,0,n.RGBA,a,i)),Et(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function YCe(n,e,t){Et(n,()=>n.bindTexture(n.TEXTURE_2D,e)),t.data instanceof Uint8Array?De().getNumber("WEBGL_VERSION")===2?Et(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t.width,t.height,n.RGBA,n.UNSIGNED_BYTE,t.data)):Et(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t.width,t.height,0,n.RGBA,n.UNSIGNED_BYTE,t.data)):De().getNumber("WEBGL_VERSION")===2?Et(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,t)):Et(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)),Et(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function ZCe(n,e,t,r){const s=n.createBuffer();Et(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,s));const a=4*4*e*t;return Et(n,()=>n.bufferData(n.PIXEL_PACK_BUFFER,a,n.STREAM_READ)),Et(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,0)),Et(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,null)),s}function JCe(n,e,t){const r=n,s=new Float32Array(t);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,s),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),s}function QCe(n,e,t,r){const[s,o]=k0(e,t),i=4,a=new Uint8Array(g3e(e*t,i));return Et(n,()=>n.readPixels(0,0,s,o,r.downloadTextureFormat,n.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function e4e(n,e,t,r,s,o,i,a){const l=n,c=new Float32Array(x3e(o,i));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,c),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),c}function t4e(n,e,t){const r=new Float32Array(e*t*4);return Et(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,r)),r}class k4{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const t=De().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,h3e(t,e)):this.gl=hl(t),e=this.gl,De().getNumber("WEBGL_VERSION")===2){const o=e;this.createVertexArray=()=>Et(o,()=>o.createVertexArray()),this.bindVertexArray=i=>Et(o,()=>o.bindVertexArray(i)),this.deleteVertexArray=i=>Et(o,()=>o.deleteVertexArray(i)),this.getVertexArray=()=>Et(o,()=>o.getParameter(o.VERTEX_ARRAY_BINDING))}else if(e!=null){const o=e.getExtension("OES_vertex_array_object");if(o==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>Et(e,()=>o.createVertexArrayOES()),this.bindVertexArray=i=>Et(e,()=>o.bindVertexArrayOES(i)),this.deleteVertexArray=i=>Et(e,()=>o.deleteVertexArrayOES(i)),this.getVertexArray=()=>Et(e,()=>e.getParameter(o.VERTEX_ARRAY_BINDING_OES))}let r="WEBGL_color_buffer_float";const s="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),De().getNumber("WEBGL_VERSION")===1){const o="OES_texture_float",i="OES_texture_half_float";if(this.textureFloatExtension=Cv(this.gl,o),Ta(this.gl,i))this.textureHalfFloatExtension=Cv(this.gl,i);else if(De().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),Ta(this.gl,s))this.colorBufferHalfFloatExtension=Cv(this.gl,s);else if(De().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",Ta(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else if(Ta(this.gl,s))this.colorBufferHalfFloatExtension=this.gl.getExtension(s);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=VCe(this.gl),this.indexBuffer=zCe(this.gl),this.framebuffer=A3e(this.gl),this.textureConfig=SN(this.gl,this.textureHalfFloatExtension)}get debug(){return De().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;Et(e,()=>e.finish()),Et(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),Et(e,()=>e.deleteFramebuffer(this.framebuffer)),Et(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),Et(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),Et(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),WCe(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),UCe(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),HCe(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),YCe(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,r,s){this.throwIfDisposed(),XCe(this.gl,e,t,r,s,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),qCe(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),GCe(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(oR(this.gl,this.framebuffer),this.outputTexture=null),Et(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,r){return this.downloadMatrixDriver(e,()=>QCe(this.gl,t,r,this.textureConfig))}downloadPackedMatrixFromBuffer(e,t,r,s,o,i){return e4e(this.gl,e,t,r,s,o,i,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return JCe(this.gl,e,t)}createBufferFromTexture(e,t,r){this.bindTextureToFrameBuffer(e);const s=ZCe(this.gl,t,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),s}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,r;if(De().getBool("WEBGL_FENCE_API_ENABLED")){const s=e,o=s.fenceSync(s.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),r=()=>{const i=s.clientWaitSync(o,0,0);return i===s.ALREADY_SIGNALED||i===s.CONDITION_SATISFIED},t=o}else De().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),r=()=>this.isQueryAvailable(t,De().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):r=()=>!0;return{query:t,isFencePassed:r}}downloadMatrixFromPackedTexture(e,t,r){return this.downloadMatrixDriver(e,()=>t4e(this.gl,t,r))}createProgram(e){this.throwIfDisposed();const t=this.gl;this.vertexShader==null&&(this.vertexShader=BCe(t));const r=E3e(t);Et(t,()=>t.attachShader(r,this.vertexShader)),Et(t,()=>t.attachShader(r,e)),I3e(t,r);const s=Object.assign(r,{vao:this.createVertexArray()});return this.debug&&y4(t,s),s}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const t=this.gl;Et(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),KCe(t,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(Et(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&y4(this.gl,this.program),Et(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,t,r=!0){return this.throwIfDisposed(),r?F3e(this.gl,e,t):P3e(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),Et(this.gl,()=>this.gl.getAttribLocation(e,t))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,r){this.throwIfDisposed(),this.throwIfNoProgram(),O3e(this.gl,e,t,r)}setOutputMatrixTexture(e,t,r){this.setOutputMatrixTextureDriver(e,r,t)}setOutputPackedMatrixTexture(e,t,r){this.throwIfDisposed();const[s,o]=sm(t,r);this.setOutputMatrixTextureDriver(e,s,o)}setOutputMatrixWriteRegion(e,t,r,s){this.setOutputMatrixWriteRegionDriver(r,e,s,t)}setOutputPackedMatrixWriteRegion(e,t,r,s){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&y4(this.gl,this.program),kv(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}Et(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),Et(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Cv(this.gl,De().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(De().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const r=this.gl,s=this.getQueryTimerExtensionWebGL2(),o=r.createQuery();return r.beginQuery(s.TIME_ELAPSED_EXT,o),o}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(De().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const t=this.gl,r=this.getQueryTimerExtensionWebGL2();t.endQuery(r.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await UT(()=>this.disposed||this.isQueryAvailable(e,De().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,De().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(t===0)return null;if(t===2){const r=this.gl;return r.getQueryParameter(e,r.QUERY_RESULT)/1e6}else{const r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(t===0)return!0;if(t===2){const r=this.gl,s=this.getQueryTimerExtensionWebGL2(),o=r.getQueryParameter(e,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),o&&!this.disjoint}else{const r=this.getQueryTimerExtensionWebGL1(),s=r.getQueryObjectEXT(e,r.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),s&&!this.disjoint}}pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){const e=n4e(this.itemsToPoll.map(t=>t.isDoneFn));for(let t=0;t<=e;++t){const{resolveFn:r}=this.itemsToPoll[t];r()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let r;"setTimeoutCustom"in De().platform&&(r=De().platform.setTimeoutCustom.bind(De().platform)),UT(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,r)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),b4(this.gl,e,this.framebuffer),this.debug&&kv(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(b4(this.gl,this.outputTexture,this.framebuffer),this.debug&&kv(this.gl)):oR(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const r=t();return this.unbindTextureToFrameBuffer(),r}setOutputMatrixTextureDriver(e,t,r){this.throwIfDisposed();const s=this.gl;b4(s,e,this.framebuffer),this.debug&&kv(s),this.outputTexture=e,Et(s,()=>s.viewport(0,0,t,r)),Et(s,()=>s.scissor(0,0,t,r))}setOutputMatrixWriteRegionDriver(e,t,r,s){this.throwIfDisposed(),Et(this.gl,()=>this.gl.scissor(e,t,r,s))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function n4e(n){let e=0;for(;e<n.length&&n[e]();++e);return e-1}const{addImpl:r4e,bincountImpl:rz,bincountReduceImpl:s4e,bitwiseAndImpl:o4e,castImpl:i4e,ceilImpl:a4e,concatImpl:l4e,equalImpl:c4e,expImpl:u4e,expm1Impl:d4e,floorImpl:f4e,gatherNdImpl:h4e,gatherV2Impl:p4e,greaterImpl:m4e,greaterEqualImpl:g4e,lessImpl:x4e,lessEqualImpl:v4e,linSpaceImpl:y4e,logImpl:b4e,maxImpl:w4e,maximumImpl:C4e,minimumImpl:k4e,multiplyImpl:S4e,negImpl:N4e,notEqualImpl:E4e,prodImpl:I4e,raggedGatherImpl:T4e,raggedRangeImpl:_4e,raggedTensorToTensorImpl:R4e,rangeImpl:D4e,rsqrtImpl:A4e,scatterImpl:$4e,sigmoidImpl:F4e,simpleAbsImpl:sz,sliceImpl:P4e,sparseFillEmptyRowsImpl:O4e,sparseReshapeImpl:M4e,sparseSegmentReductionImpl:oz,sqrtImpl:L4e,staticRegexReplaceImpl:j4e,stridedSliceImpl:B4e,stringNGramsImpl:V4e,stringSplitImpl:z4e,stringToHashBucketFastImpl:W4e,subImpl:U4e,tileImpl:H4e,topKImpl:G4e,transposeImpl:TN,uniqueImpl:q4e}=Yxe;function iz(n,e){return["x","y","z","w","u","v"].slice(0,e).map(t=>`${n}.${t}`)}function Lo(n,e){return e===1?[n]:iz(n,e)}function K4e(n,e){if(n===1)return"rc";let t="";for(let r=0;r<n;r++)t+=e[r],r<n-1&&(t+=",");return t}class X4e{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=yo(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const t=Lo("rc",this.rank),r=br(this.rank),s=this.getOutOfBoundsCondition(t),o=this.getSetup(t),i=this.getOutput(t);this.userCode=`
        void main() {
          ${r} rc = getOutputCoords();

          if(${s}) {
            setOutput(vec4(0));
          } else {
            ${o}

            setOutput(vec4(${i}));
          }
        }
      `}}getSourceCoordsArr(e){const t=[];for(let r=0;r<=1;r++)for(let s=0;s<=1;s++){let o=`${r===0?"r":"rp1"}, ${s===0?"c":"cp1"}`;for(let i=2;i<this.rank;i++)o=`${e[e.length-1-i]},`+o;t.push(o)}return t}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let t="";for(let r=this.rank-2;r<this.rank;r++)t+=`${e[r]} >= ${this.enableShapeUniforms?`outShape[${r}]`:this.outputShape[r]}`,r<this.rank-1&&(t+="||");return t}getSetup(e){if(this.rank===1)return"";const t=e.slice(-2),r=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],s=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${t[0]};
      int c = ${t[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${r};
      bool rEdge = rp1 >= ${s};
    `}getOutput(e){const t=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${t[0]}),
            cEdge ? 0. : getA(${t[1]}),
            rEdge ? 0. : getA(${t[2]}),
            rEdge || cEdge ? 0. : getA(${t[3]})`}}class az{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=yo(this.outputShape.length);let r="";for(let s=0;s<4;s++){let o="thisRC = rc;";s%2===1&&(o+="thisRC.z += 1;"),s>1&&(o+="thisRC.y += 1;"),r+=`
        ${o}
        ${s>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${s}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${s>0?"}":""}
      `}this.userCode=`
      ${Y4e(t,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?EN():NN(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${r}

        setOutput(result);
      }
    `}}function Y4e(n,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?K3e(["r","c","d"],"inputShape"):Qf(["r","c","d"],n)}
      return ivec3(r, c, d);
    }
  `}class Z4e{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,t,r){const s=uR(t,r),o=dR(e,s,r);o in this.freeTextures||(this.freeTextures[o]=[]),o in this.usedTextures||(this.usedTextures[o]=[]);const i=cR(e,s,this.gpgpu.gl,this.gpgpu.textureConfig,r);if(this.freeTextures[o].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=i,this.log();const l=this.freeTextures[o].pop();return this.usedTextures[o].push(l),l}let a;return s===Qs.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):s===Qs.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):s===Qs.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):s===Qs.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):s===Qs.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[o].push(a),this.numUsedTextures++,this._numBytesAllocated+=i,this.log(),a}releaseTexture(e,t,r,s){if(this.freeTextures==null)return;const o=uR(r,s),i=dR(t,o,s);i in this.freeTextures||(this.freeTextures[i]=[]);const a=cR(t,o,this.gpgpu.gl,this.gpgpu.textureConfig,s),l=De().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const c=this.usedTextures[i],u=c&&c.indexOf(e);if(u==null||u<0)throw new Error("Cannot release a texture that was never provided by this texture manager");c[u]=c[c.length-1],c.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const t=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function J4e(n,e){const t=n;if(e===t.R32F)return 4;if(e===t.R16F)return 2;if(e===t.RGBA32F)return 16;if(e===n.RGBA)return 16;if(e===t.RGBA16F)return 8;if(e===t.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function cR(n,e,t,r,s){const o=Q4e(e,r);let i;if(s){const[l,c]=sm(n[0],n[1]);i=l*c}else{const[l,c]=k0(n[0],n[1]);i=l*c}const a=J4e(t,o);return i*a}function Q4e(n,e){switch(n){case Qs.PACKED_2X2_FLOAT32:return tz(e);case Qs.PACKED_2X2_FLOAT16:return nz(e);case Qs.UNPACKED_FLOAT32:return JV(e);case Qs.UNPACKED_FLOAT16:return QV(e);case Qs.PACKED_4X1_UNSIGNED_BYTE:return ez(e);default:throw new Error(`Unknown physical texture type ${n}`)}}function e5e(n){return De().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?Qs.PACKED_2X2_FLOAT32:Qs.UNPACKED_FLOAT32:n?Qs.PACKED_2X2_FLOAT16:Qs.UNPACKED_FLOAT16}function uR(n,e){if(n===Zi.UPLOAD)return Qs.PACKED_2X2_FLOAT32;if(n===Zi.RENDER||n==null)return e5e(e);if(n===Zi.DOWNLOAD||n===Zi.PIXELS)return Qs.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${n}`)}function dR(n,e,t){return`${n[0]}_${n[1]}_${e}_${t}`}class ql{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=yo(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${t}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const Pa="if (isnan(x)) return x;",t5e="return x;",fR="return abs(x);",n5e="return (x >= 0.0) ? x : (exp(x) - 1.0);",r5e=Pa+`
  return (x < 0.0) ? 0.0 : x;
`,s5e=Pa+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Lu="return x;",o5e="return 1.0 / (1.0 + exp(-1.0 * x));";const i5e="return x;",a5e=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,l5e=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,c5e=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,u5e="return 1.0 / (1.0 + exp(-1.0 * x));";class qu{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=yo(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${t}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}class d5e{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=yo(this.outputShape.length);const t=e.length,r=Lo("rc",t),s=br(t),o=K4e(t,r),i=r.slice(-2),a=t<=1?"rc":`vec2(${i.join(",")})`;this.userCode=`
      void main() {
        ${s} rc = getOutputCoords();
        vec4 packedInput = getA(${o});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}const f5e=DM,h5e=1e-7,p5e=1e-4,Ev={};function m5e(n){return n in Ev||(Ev[n]={}),Ev[n]}const g5e=De().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),x5e=600;function v5e(){return De().global.screen==null?1024:De().global.screen.height*De().global.screen.width*window.devicePixelRatio*x5e/1024/1024}class mw extends Z6{nextDataId(){return mw.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!De().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(e!=null){if(e instanceof k4)t=e;else{const r=hl(De().getNumber("WEBGL_VERSION"),e);t=new k4(r)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const r=hl(De().getNumber("WEBGL_VERSION"));t=new k4(r),this.binaryCache=m5e(De().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new Z4e(this.gpgpu),this.numMBBeforeWarning=v5e(),this.texData=new tO(this,Pl())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,t,r,s,o,i){const a=this.makeTensorInfo(t,r),l=this.texData.get(a.dataId);l.isPacked=!1,l.texture={texture:e,texShape:[s,o]},l.texShape=[s,o];const c=Sv(t),u=new lR(c,!1,i),d=this.runWebGLProgram(u,[a],r,[[s,o]]);return d.shape=t,l.texture=null,this.disposeIntermediateTensorInfo(a),d.dataId}write(e,t,r){if((De().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||De().getBool("DEBUG"))&&this.checkNumericalProblems(e),r==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const s={id:this.nextDataId()};return this.texData.set(s,{shape:t,dtype:r,values:e,usage:Zi.UPLOAD,refCount:1}),s}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const t=this.texData.get(e);t.refCount++}decRef(e){if(this.texData.has(e)){const t=this.texData.get(e);t.refCount--}}move(e,t,r,s,o){if(De().getBool("DEBUG")&&this.checkNumericalProblems(t),s==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:r,dtype:s,values:t,usage:Zi.UPLOAD,refCount:o})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:r,dtype:s,complexTensorInfos:o,slice:i,shape:a,isPacked:l}=t;if(i!=null){let f;l?f=new qu(a,Lu):f=new ql(a,Lu);const p=this.runWebGLProgram(f,[{dataId:e,shape:a,dtype:s}],s),x=this.readSync(p.dataId);return this.disposeIntermediateTensorInfo(p),x}if(r!=null)return this.convertAndCacheOnCPU(e);if(s==="string")return r;const c=this.activeTimers!=null;let u;c&&(u=Yo());let d;if(s==="complex64"){const f=this.readSync(o.real.dataId),p=this.readSync(o.imag.dataId);d=Hc(f,p)}else d=this.getValuesFromTexture(e);return c&&(this.downloadWaitMs+=Yo()-u),this.convertAndCacheOnCPU(e,d)}async read(e){if(this.pendingRead.has(e)){const x=this.pendingRead.get(e);return new Promise(v=>x.push(v))}const t=this.texData.get(e),{values:r,shape:s,slice:o,dtype:i,complexTensorInfos:a,isPacked:l}=t;if(o!=null){let x;l?x=new qu(s,Lu):x=new ql(s,Lu);const v=this.runWebGLProgram(x,[{dataId:e,shape:s,dtype:i}],i),y=this.read(v.dataId);return this.disposeIntermediateTensorInfo(v),y}if(r!=null)return this.convertAndCacheOnCPU(e);if(De().getBool("DEBUG")&&!De().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&De().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let c=null,u;if(i!=="complex64"&&De().get("WEBGL_BUFFER_SUPPORTED")){u=this.decode(e);const x=this.texData.get(u.dataId);c=this.gpgpu.createBufferFromTexture(x.texture.texture,...wv(s))}this.pendingRead.set(e,[]),i!=="complex64"&&await this.gpgpu.createAndWaitForFence();let d;if(i==="complex64"){const x=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),v=x[0],y=x[1];d=Hc(v,y)}else if(c==null)d=this.getValuesFromTexture(e);else{const x=Le(s);d=this.gpgpu.downloadFloat32MatrixFromBuffer(c,x)}if(u!=null&&this.disposeIntermediateTensorInfo(u),c!=null){const x=this.gpgpu.gl;Et(x,()=>x.deleteBuffer(c))}const f=this.convertAndCacheOnCPU(e,d),p=this.pendingRead.get(e);return this.pendingRead.delete(e),p.forEach(x=>x(f)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&Pl().removeDataId(e,this),this.pendingDeletes--),f}readToGPU(e,t={}){const r=this.texData.get(e),{values:s,shape:o,slice:i,dtype:a,isPacked:l,texture:c}=r;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(i!=null){let p;l?p=new qu(o,Lu):p=new ql(o,Lu);const x=this.runWebGLProgram(p,[{dataId:e,shape:o,dtype:a}],a),v=this.readToGPU(x,t);return this.disposeIntermediateTensorInfo(x),v}if(c==null)throw s!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const u=this.decode(e,t.customTexShape),d=Pl().makeTensorFromTensorInfo(u),f=this.texData.get(u.dataId);return Object.assign({tensorRef:d},f.texture)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const r=t.map(s=>ld(s));return $n(e.shape,e.dtype,r)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return $n(e.shape,e.dtype,t)}checkNumericalProblems(e){if(e!=null)for(let t=0;t<e.length;t++){const r=e[t];if(!w3e(r))throw De().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${r} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${r} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:t,dtype:r,isPacked:s}=this.texData.get(e),o=Le(t);if(De().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const f=this.decode(e),p=this.texData.get(f.dataId),x=this.gpgpu.downloadMatrixFromPackedTexture(p.texture.texture,...wv(t)).subarray(0,o);return this.disposeIntermediateTensorInfo(f),x}const i=De().getBool("WEBGL_PACK")&&s===!0,a=i?Sv(t):t,l=i?new MCe(a):new OCe(a),c=this.runWebGLProgram(l,[{shape:a,dtype:r,dataId:e}],"float32"),u=this.texData.get(c.dataId),d=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(u.texture.texture,u.texShape[0],u.texShape[1]).subarray(0,o);return this.disposeIntermediateTensorInfo(c),d}timerAvailable(){return De().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const t=this.activeTimers,r=[];let s=!1;this.programTimersStack==null?(this.programTimersStack=r,s=!0):this.activeTimers.push(r),this.activeTimers=r,e();const o=Ef(this.activeTimers.map(l=>l.query)).filter(l=>l!=null),i=Ef(this.activeTimers.map(l=>l.name)).filter(l=>l!=null);this.activeTimers=t,s&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(De().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const l=await Promise.all(o);a.kernelMs=ele(l),a.getExtraProfileInfo=()=>l.map((c,u)=>({name:i[u],ms:c})).map(c=>`${c.name}: ${c.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return De().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Yo(),endMs:null}}endTimer(e){return De().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Yo(),e)}async getQueryTime(e){if(De().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e,t=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:r}=this.texData.get(e);return r!=null&&(this.disposeData(r.real.dataId,t),this.disposeData(r.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:r,texShape:s,usage:o,isPacked:i,slice:a}=this.texData.get(e),l=a&&a.origDataId||e,c=this.dataRefCount.get(l);c>1?this.dataRefCount.set(l,c-1):(this.dataRefCount.delete(l),t!=null&&(this.numBytesInGPU-=this.computeBytes(s,r),this.textureManager.releaseTexture(t,s,o,i)));const u=this.texData.get(e);u.texture=null,u.texShape=null,u.isPacked=!1,u.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,t=g5e){return De().getBool("WEBGL_CPU_FORWARD")&&e.every(r=>this.texData.get(r.dataId).texture==null&&Le(r.shape)<t)}getGPGPUContext(){return this.gpgpu}where(e){Gi("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return f5e(e.shape,t)}packedUnaryOp(e,t,r){const s=new qu(e.shape,t),o=this.compileAndRun(s,[e],r);return Pl().makeTensorFromTensorInfo(o)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const s=sz(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,s)}if(De().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,fR,e.dtype);const t=new ql(e.shape,fR),r=this.compileAndRun(t,[e]);return Pl().makeTensorFromTensorInfo(r)}makeTensorInfo(e,t,r){let s;if(t==="string"&&r!=null&&r.length>0&&u1(r[0])){const o=r.map(i=>Qu(i));s=this.write(o,e,t)}else s=this.write(r,e,t);return this.texData.get(s).usage=null,{dataId:s,shape:e,dtype:t}}makeOutput(e,t,r){return Pl().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,r),this)}unpackTensor(e){const t=new d5e(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new X4e(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const r=[Lp(e.shape),...jp(e.shape)],s={dtype:e.dtype,shape:r,dataId:e.dataId},o=[Lp(t),...jp(t)],i=new az(o,r),a=!0,l=[r],c=this.runWebGLProgram(i,[s],e.dtype,l,a);return{dataId:c.dataId,shape:t,dtype:c.dtype}}decode(e,t){const r=this.texData.get(e),{isPacked:s,shape:o,dtype:i}=r;if(t!=null){const f=Le(o),p=t[0]*t[1]*4;X(f<=p,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=Sv(o);let l;s?l=new PCe(a):l=new FCe(a);const c=!0,u=[t??wv(a)],d=this.runWebGLProgram(l,[{shape:a,dtype:i,dataId:e}],i,u,c,t);return{dtype:i,shape:o,dataId:d.dataId}}runWebGLProgram(e,t,r,s,o=!1,i){const a=this.makeTensorInfo(e.outputShape,r),l=this.texData.get(a.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===Wg.DENSE){const b=i??wv(e.outputShape);l.texShape=b.map(w=>w*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),Le(a.shape)===0)return l.values=po(a.dtype,0),a;const c=[],u=t.map(b=>{if(b.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let w=this.texData.get(b.dataId);if(w.texture==null){if(!e.packedInputs&&Le(b.shape)<=De().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:b.shape,texData:null,isUniform:!0,uniformValues:w.values};e.packedInputs&&(w.isPacked=!0,w.shape=b.shape)}if(this.uploadToGPU(b.dataId),!!w.isPacked!=!!e.packedInputs)b=w.isPacked?this.unpackTensor(b):this.packTensor(b),c.push(b),w=this.texData.get(b.dataId);else if(w.isPacked&&!ry(w.shape,b.shape)){const S=b,k=b.shape;b.shape=w.shape,b=this.packedReshape(b,k),c.push(b),w=this.texData.get(b.dataId),S.shape=k}return{shape:b.shape,texData:w,isUniform:!1}});this.uploadToGPU(a.dataId);const d={shape:a.shape,texData:l,isUniform:!1},f=$Ce(e,u,d),p=this.getAndSaveBinary(f,()=>DCe(this.gpgpu,e,u,d)),x=this.activeTimers!=null;let v;x&&(v=this.startTimer()),De().get("ENGINE_COMPILE_ONLY")||ACe(this.gpgpu,p,u,d,s),c.forEach(b=>this.disposeIntermediateTensorInfo(b)),x&&(v=this.endTimer(v),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(v)}));const y=De().getNumber("WEBGL_FLUSH_THRESHOLD");if(y>0){const b=Yo();b-this.lastGlFlushTime>y&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=b)}if(!De().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&o===!1){const b=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),b}return a}compileAndRun(e,t,r,s,o=!1){return r=r||t[0].dtype,this.runWebGLProgram(e,t,r,s,o)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(De().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(t=>{this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram),delete this.binaryCache[t]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=Ne(()=>{if(!De().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=De().getBool("DEBUG");De().set("DEBUG",!1);const t=this.abs(ar(1e-8)).dataSync()[0];if(De().set("DEBUG",e),t>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?h5e:p5e}uploadToGPU(e){const t=this.texData.get(e),{shape:r,dtype:s,values:o,texture:i,usage:a,isPacked:l}=t;if(i!=null)return;const c=this.activeTimers!=null;let u;c&&(u=Yo());let d=t.texShape;if(d==null&&(d=j3e(r,l),t.texShape=d),o!=null){const f=Sv(r);let p,x=d[1],v=d[0];const y=o instanceof Uint8Array||o instanceof Uint8ClampedArray;(l||!y)&&([x,v]=sm(d[0],d[1])),l?p=new jCe(f,y):p=new lR(f,y);const b=y?[v,x]:d,w=this.makeTensorInfo(b,s),S=this.texData.get(w.dataId);y?S.usage=Zi.PIXELS:S.usage=Zi.UPLOAD,S.texShape=b,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(w.dataId),x,v,o);const k=[[v,x]],I=this.runWebGLProgram(p,[w],s,k,!0),T=this.texData.get(I.dataId);t.texShape=T.texShape,t.isPacked=T.isPacked,t.usage=T.usage,De().get("ENGINE_COMPILE_ONLY")?this.disposeData(I.dataId):(t.texture=T.texture,t.values=null,this.texData.delete(I.dataId)),this.disposeIntermediateTensorInfo(w),c&&(this.uploadWaitMs+=Yo()-u)}else{const f=this.acquireTexture(d,a,s,l);t.texture=f}}convertAndCacheOnCPU(e,t){const r=this.texData.get(e),{dtype:s}=r;return t!=null&&(r.values=y5e(t,s)),r.values}acquireTexture(e,t,r,s){if(this.numBytesInGPU+=this.computeBytes(e,r),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${o} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,t,s)}computeBytes(e,t){return e[0]*e[1]*$2(t)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}else{for(const[,t]of Object.entries(this.binaryCache)){const r=new Promise(s=>{try{this.checkCompletion_(t),s(!0)}catch(o){throw o}});e.push(r)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await KM(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(GV(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:t,customUniformLocations:r,infLoc:s,nanLoc:o,outShapeLocation:i,outShapeStridesLocation:a,outTexShapeLocation:l}=ZV(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=t,e.customUniformLocations=r,e.infLoc=s,e.nanLoc=o,e.outShapeLocation=i,e.outShapeStridesLocation=a,e.outTexShapeLocation=l}}createTensorFromGPUData(e,t,r){e.channels=e.channels||"RGBA";const{texture:s,height:o,width:i,channels:a}=e,l=Pl().backend;if(!l.gpgpu.gl.isTexture(s))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const c=l.writeTexture(s,t,r,o,i,a);return Pl().makeTensorFromDataId(c,t,r,l)}}mw.nextDataId=0;function y5e(n,e){if(e==="float32"||e==="complex64")return n;if(e==="int32"||e==="bool"){const t=e==="int32"?new Int32Array(n.length):new Uint8Array(n.length);for(let r=0;r<t.length;++r)t[r]=Math.round(n[r]);return t}else throw new Error(`Unknown dtype ${e}`)}UO()&&KO("webgl",()=>new mw,2);const _N=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class Lf{constructor(e,t,r){this.variableNames=["A","B"],this.outputShape=Sn(t,r),this.enableShapeUniforms=yo(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}const th=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class cm{constructor(e,t,r,s=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Sn(t,r);const o=this.outputShape.length;this.enableShapeUniforms=yo(o);let i="";if(s)if(o===0||Le(this.outputShape)===1)i=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(i=`
          ${br(o)} coords = getOutputCoords();
        `,o===1)this.enableShapeUniforms?i+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:i+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const l=Lo("coords",o);this.enableShapeUniforms?i+=`
            bool nextRowOutOfBounds =
              (${l[o-2]} + 1) >= outShape[${o} - 2];
            bool nextColOutOfBounds =
              (${l[o-1]} + 1) >= outShape[${o} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:i+=`
            bool nextRowOutOfBounds =
              (${l[o-2]} + 1) >= ${this.outputShape[o-2]};
            bool nextColOutOfBounds =
              (${l[o-1]} + 1) >= ${this.outputShape[o-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${i}

        setOutput(result);
      }
    `}}function Ti(n){const{inputs:e,backend:t}=n,{x:r}=e;return t.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const b5e={kernelName:D1,backendName:"webgl",kernelFunc:Ti};function Id(n){const{inputs:e,backend:t}=n,{real:r,imag:s}=e,o=t.makeTensorInfo(r.shape,"complex64"),i=t.texData.get(o.dataId),a=Ti({inputs:{x:r},backend:t}),l=Ti({inputs:{x:s},backend:t});return i.complexTensorInfos={real:a,imag:l},o}const w5e={kernelName:uS,backendName:"webgl",kernelFunc:Id};const lz="return (a < 0.) ? b * a : a;",cz=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function C5e(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{alpha:o}=r,i=t.makeTensorInfo([],"float32",yd(o,"float32")),a=De().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new cm(cz,s.shape,i.shape):new Lf(lz,s.shape,i.shape),l=t.runWebGLProgram(a,[s,i],"float32");return t.disposeIntermediateTensorInfo(i),l}const k5e={kernelName:cb,backendName:"webgl",kernelFunc:C5e};const uz="return (a < 0.) ? b * a : a;",dz=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function S5e(n){const{inputs:e,backend:t}=n,{x:r,alpha:s}=e,o=De().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new cm(dz,r.shape,s.shape):new Lf(uz,r.shape,s.shape);return t.runWebGLProgram(o,[r,s],"float32")}const N5e={kernelName:Tb,backendName:"webgl",kernelFunc:S5e};const um="if (isnan(x)) return x;";function qn({opSnippet:n,packedOpSnippet:e,cpuKernelImpl:t,dtype:r}){return({inputs:s,backend:o})=>{const{x:i}=s,a=o,l=r||i.dtype;if(a.shouldExecuteOnCPU([i])&&t!=null){const d=a.texData.get(i.dataId),f=t(d.values,l);return a.makeTensorInfo(i.shape,l,f)}const c=De().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let u;return c?u=new qu(i.shape,e):u=new ql(i.shape,n),a.runWebGLProgram(u,[i],l)}}function oo({opSnippet:n,packedOpSnippet:e,checkOutOfBounds:t=!1,supportsComplex:r=!1,cpuKernelImpl:s,dtype:o}){return({inputs:i,backend:a})=>{const{a:l,b:c}=i,u=a;if(r&&l.dtype==="complex64"){const x=u.texData.get(l.dataId),v=u.texData.get(c.dataId),[y,b]=[[x.complexTensorInfos.real,v.complexTensorInfos.real],[x.complexTensorInfos.imag,v.complexTensorInfos.imag]].map(S=>{const[k,N]=S,I={dataId:k.dataId,dtype:k.dtype,shape:l.shape},T={dataId:N.dataId,dtype:N.dtype,shape:c.shape},F=new Lf(n,l.shape,c.shape);return u.runWebGLProgram(F,[I,T],Ei(k.dtype,N.dtype))}),w=Id({inputs:{real:y,imag:b},backend:u});return u.disposeIntermediateTensorInfo(y),u.disposeIntermediateTensorInfo(b),w}const d=o||Ei(l.dtype,c.dtype);if((l.dtype==="string"||c.dtype==="string"||u.shouldExecuteOnCPU([l,c]))&&s!=null){const x=u.texData.get(l.dataId).values,v=u.texData.get(c.dataId).values,y=l.dtype==="string"?Gc(x):x,b=l.dtype==="string"?Gc(v):v,[w,S]=s(l.shape,c.shape,y,b,d),k=u.makeTensorInfo(S,d),N=u.texData.get(k.dataId);return N.values=w,k}const f=De().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let p;return f?p=new cm(e,l.shape,c.shape,t):p=new Lf(n,l.shape,c.shape),u.runWebGLProgram(p,[l,c],d)}}function Ug(n,e=!1){if(n==="linear")return e?i5e:t5e;if(n==="relu")return e?l5e:r5e;if(n==="elu")return e?a5e:n5e;if(n==="relu6")return e?c5e:s5e;if(n==="prelu")return e?dz:uz;if(n==="leakyrelu")return e?cz:lz;if(n==="sigmoid")return e?u5e:o5e;throw new Error(`Activation ${n} has not been implemented for the WebGL backend.`)}class fz{constructor(e,t,r,s=!1,o=!1,i=!1,a=null,l=!1,c=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.enableShapeUniforms=yo(this.outputShape.length);const u=s?e[1]:e[2],d=Math.ceil(u/2),f=s?"i * 2, rc.y":"rc.y, i * 2",p=o?"rc.z, i * 2":"i * 2, rc.z",x=s?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],v=o?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let y="",b="";a&&(l?y=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:c?y=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:y=`vec4 activation(vec4 x) {
          ${a}
        }`,b="result = activation(result);");const w=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");let S="rc.x",k="rc.x";e[0]<t[0]?S=`imod(rc.x, ${e[0]})`:t[0]<e[0]&&(k=`imod(rc.x, ${t[0]})`),this.userCode=`
      ${y}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${d}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${S};
        int batchB = ${k};
        for (int i = 0; i < ${d}; i++) {
          vec4 a = getMatrixA(batchA, ${f});
          vec4 b = getMatrixB(batchB, ${p});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${x[0]} * ${v[0]});
          result += (${x[1]} * ${v[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${w}

        ${b}

        setOutput(result);
      }
    `}}const hR={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class pR{constructor(e,t,r){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Sn(t,r),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}const mR="return a * b;";function RN(n){const{inputs:e,backend:t}=n,{a:r,b:s}=e,o=Ei(r.dtype,s.dtype);if(r.dtype==="complex64"){const a=t.texData.get(r.dataId),l=t.texData.get(s.dataId),c=new pR(hR.REAL,r.shape,s.shape),u=new pR(hR.IMAG,r.shape,s.shape),d=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:r.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:s.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:s.shape}],f=t.runWebGLProgram(c,d,"float32"),p=t.runWebGLProgram(u,d,"float32"),x=Id({inputs:{real:f,imag:p},backend:t});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),x}if(t.shouldExecuteOnCPU([r,s])){const a=t.texData.get(r.dataId),l=t.texData.get(s.dataId),[c,u]=S4e(r.shape,s.shape,a.values,l.values,o),d=t.makeTensorInfo(u,o),f=t.texData.get(d.dataId);return f.values=c,d}let i;return De().getBool("WEBGL_PACK_BINARY_OPERATIONS")?i=new cm(mR,r.shape,s.shape):i=new Lf(mR,r.shape,s.shape),t.runWebGLProgram(i,[r,s],o)}const E5e={kernelName:B1,backendName:"webgl",kernelFunc:RN};function I5e(n,e,t){const r=[Lp(n.shape),...jp(n.shape)],s={dtype:n.dtype,shape:r,dataId:n.dataId},o=[Lp(e),...jp(e)],i=new az(o,r),a=!0,l=[r],c=t.runWebGLProgram(i,[s],n.dtype,l,a);return{dataId:c.dataId,shape:e,dtype:c.dtype}}function yt(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{shape:o}=r,i=t,a=Le(s.shape),l=rO(o,a),c=Le(l);X(a===c,()=>`The new shape (${l}) has ${c} elements and the old shape (${s.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const u=i.texData.get(s.dataId);return u.isPacked&&!ry(s.shape,l)&&!(u.texture!==null&&ry(u.shape,l))?I5e(s,l,i):(i.incRef(s.dataId),{dataId:s.dataId,shape:l,dtype:s.dtype})}const T5e={kernelName:Rb,backendName:"webgl",kernelFunc:yt};class gR{constructor(e,t){this.variableNames=["x"];const{windowSize:r,batchSize:s,inSize:o,outSize:i}=e;this.outputShape=[s,i];const a=Math.floor(r/4)*4,l=r%4;let c="sumValue += dot(values, ones);";if(t!=null){const d=1/t;c=`sumValue += dot(values * ${_p(d)?d.toPrecision(2):d}, ones);`}let u="";o%r>0&&(u=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${u}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${c}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${c}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${c}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${c}
        }
        setOutput(sumValue);
      }
    `}}class _5e{constructor(e,t){this.variableNames=["x"];const{windowSize:r,batchSize:s,inSize:o,outSize:i}=e;this.outputShape=[s,i];let a="0.0",l="";t==="prod"?a="1.0":t==="min"?(a="1.0 / 1e-20",l="min"):t==="max"&&(a="-1.0 / 1e-20",l="max");let c=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="sum"?c="sumValue":t==="prod"?c="prodValue":t==="all"?c="allValue":t==="any"&&(c="anyValue");const u=Math.floor(r/4)*4,d=r%4;let f=`
      if (${t==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${t==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${t==="min"} || ${t==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,p="vec4";t==="all"?(a="1.0",f=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,p="bvec4"):t==="any"&&(a="0.0",f=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,p="bvec4");let x="";o%r>0&&(x=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${x}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${f}
        }

        int inIdx = inOffset + ${u};
        if (${d===1}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${f}
        } else if (${d===2}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${f}
        } else if (${d===3}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${f}
        }
        setOutput(${c});
      }
    `}}function R5e(n){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const t=e.length?e[e.length-1].outSize:n[1],r=Qb(t);e.push({inSize:t,windowSize:r,outSize:Math.ceil(t/r)})}return e}function nh(n,e,t,r){const s=R5e(n.shape);let o=n;for(let i=0;i<s.length;i++){const{inSize:a,windowSize:l,outSize:c}=s[i];let u,d;t==="mean"?u=i===0?new gR({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:c},a):new gR({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:c}):u=new _5e({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:c},t),d=o,o=r.runWebGLProgram(u,[o],e),d.dataId!==n.dataId&&r.disposeIntermediateTensorInfo(d)}return o}class D5e{constructor(e,t){this.variableNames=["A"];const r=new Array(e.length);for(let i=0;i<r.length;i++)r[i]=e[t[i]];this.outputShape=r,this.rank=r.length;const s=br(this.rank),o=A5e(t);this.userCode=`
    void main() {
      ${s} resRC = getOutputCoords();
      setOutput(getA(${o}));
    }
    `}}function A5e(n){const e=n.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(e);for(let s=0;s<n.length;s++)r[n[s]]=t[s];return r.join()}class $5e{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const r=new Array(e.length);for(let u=0;u<r.length;u++)r[u]=e[t[u]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const s=br(this.rank),o=iz("rc",this.rank),i=new Array(this.rank);for(let u=0;u<t.length;u++)i[t[u]]=o[u];const a=`vec2(${i.slice(-2).join()})`,l=`++${o[this.rank-1]} < ${r[this.rank-1]}`,c=`getChannel(getA(${i.join()}), ${a})`;this.userCode=`
    void main() {
      ${s} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${c};
      if(${l}) {
        result[1] = ${c};
      }
      --${o[this.rank-1]};
      if(++${o[this.rank-2]} < ${r[this.rank-2]}) {
        result[2] = ${c};
        if(${l}) {
          result[3] = ${c};
        }
      }
      setOutput(result);
    }
    `}}function gw(n,e,t){const r=De().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new $5e(n.shape,e):new D5e(n.shape,e);return t.runWebGLProgram(r,[n],n.dtype)}function F5e(n,e,t,r){const s=e,o=n.shape.length,i=Fn(s,n.shape);let a=i;const l=Ur(a,o),c=l!=null;let u=n;c&&(u=gw(n,l,r),a=os(a.length,o)),so("sum",a,o);const[d,f]=Ws(u.shape,a);let p=d;t&&(p=ps(d,i));const x=Le(f),y=Le(n.shape)/x,b=yt({inputs:{x:u},attrs:{shape:[y,x]},backend:r}),w=US(n.dtype),S=nh(b,w,"sum",r),k=yt({inputs:{x:S},attrs:{shape:p},backend:r});return r.disposeIntermediateTensorInfo(b),r.disposeIntermediateTensorInfo(S),c&&r.disposeIntermediateTensorInfo(u),k}function xw(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:o,keepDims:i}=r;return F5e(s,o,i,t)}const P5e={kernelName:Ob,backendName:"webgl",kernelFunc:xw};function Wo(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{perm:o}=r,i=t,a=s.shape.length,l=new Array(a);for(let u=0;u<l.length;u++)l[u]=s.shape[o[u]];let c;if(i.shouldExecuteOnCPU([s])){const d=i.texData.get(s.dataId).values,f=TN(d,s.shape,s.dtype,o,l);c=i.makeTensorInfo(l,s.dtype);const p=i.texData.get(c.dataId);p.values=f}else c=gw(s,o,i);return c}const O5e={kernelName:pp,backendName:"webgl",kernelFunc:Wo};const hz=1e3;function sy({a:n,b:e,transposeA:t,transposeB:r,backend:s,bias:o=null,preluActivationWeights:i=null,leakyreluAlpha:a=0,activation:l=null}){const c=n.shape.length,u=e.shape.length,d=t?n.shape[c-2]:n.shape[c-1],f=r?e.shape[u-1]:e.shape[u-2],p=t?n.shape[c-1]:n.shape[c-2],x=r?e.shape[u-2]:e.shape[u-1],v=n.shape.slice(0,-2),y=e.shape.slice(0,-2),b=Le(v),w=Le(y),k=Sn(n.shape.slice(0,-2),e.shape.slice(0,-2)).concat([p,x]);X(d===f,()=>`Error in matMul: inner shapes (${d}) and (${f}) of Tensors with shapes ${n.shape} and ${e.shape} and transposeA=${t} and transposeB=${r} must match.`);const N=t?[b,d,p]:[b,p,d],I=r?[w,x,f]:[w,f,x],T=yt({inputs:{x:n},backend:s,attrs:{shape:N}}),F=yt({inputs:{x:e},backend:s,attrs:{shape:I}}),R=[T,F],D=Math.max(b,w),A=t?T.shape[1]:T.shape[2],P=o!=null,B=i!=null,L=l==="leakyrelu",W=l!=null?Ug(l,!0):null,H=P||B||L||W!=null;let G;if((p===1||x===1)&&A>hz&&H===!1){let j=T,z=F;t&&(j=Wo({inputs:{x:T},backend:s,attrs:{perm:[0,2,1]}}),R.push(j)),r&&(z=Wo({inputs:{x:F},backend:s,attrs:{perm:[0,2,1]}}),R.push(z));const V=x!==1,K=x===1;let J=j;V&&(J=yt({inputs:{x:j},backend:s,attrs:{shape:[D,A,1]}}),R.push(J));const oe=x===1?2:1;let Z=z;K&&(Z=yt({inputs:{x:z},backend:s,attrs:{shape:[D,1,A]}}),R.push(Z));const de=RN({inputs:{a:J,b:Z},backend:s});G=xw({inputs:{x:de},backend:s,attrs:{axis:oe,keepDims:!0}}),R.push(de)}else{const j=Ei(n.dtype,e.dtype),z=new fz(N,I,[D,p,x],t,r,P,W,B,L),V=[T,F];if(o!=null&&V.push(o),B&&V.push(i),L){const K=s.makeTensorInfo([],"float32",yd(a,"float32"));V.push(K),R.push(K)}G=s.runWebGLProgram(z,V,j)}const M=yt({inputs:{x:G},backend:s,attrs:{shape:k}});R.push(G);for(const j of R)s.disposeIntermediateTensorInfo(j);return M}function M5e(n){const{inputs:e,backend:t,attrs:r}=n,{a:s,b:o,bias:i,preluActivationWeights:a}=e,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:d}=r;return sy({a:s,b:o,transposeA:l,transposeB:c,backend:t,bias:i,preluActivationWeights:a,leakyreluAlpha:d,activation:u})}const L5e={kernelName:F2,backendName:"webgl",kernelFunc:M5e};const xR="return abs(x);";function j5e(n){const{inputs:e,backend:t}=n,{x:r}=e;if(t.shouldExecuteOnCPU([r])&&r.dtype!=="complex64"){const o=t.texData.get(r.dataId),i=sz(o.values);return t.makeTensorInfo(r.shape,r.dtype,i)}let s;return De().getBool("WEBGL_PACK_UNARY_OPERATIONS")?s=new qu(r.shape,xR):s=new ql(r.shape,xR),t.runWebGLProgram(s,[r],r.dtype)}const B5e={kernelName:Wy,backendName:"webgl",kernelFunc:j5e};const V5e=Pa+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,z5e=qn({opSnippet:V5e}),W5e={kernelName:d1,backendName:"webgl",kernelFunc:z5e};const U5e=Pa+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,H5e=qn({opSnippet:U5e}),G5e={kernelName:f1,backendName:"webgl",kernelFunc:H5e};const vR="return a + b;",q5e=oo({opSnippet:vR,packedOpSnippet:vR,supportsComplex:!0,cpuKernelImpl:r4e}),K5e={kernelName:Zp,backendName:"webgl",kernelFunc:q5e};class X5e{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((o,i)=>`T${i}`);const r=[];this.variableNames.forEach(o=>{r.push(`float v${o} = get${o}AtOutCoords();`)});const s=this.variableNames.map(o=>`v${o}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        float result = ${s};
        setOutput(result);
      }
    `}}class Y5e{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((o,i)=>`T${i}`);const r=[];this.variableNames.forEach(o=>{r.push(`vec4 v${o} = get${o}AtOutCoords();`)});const s=this.variableNames.map(o=>`v${o}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        vec4 result = ${s};
        setOutput(result);
      }
    `}}function Gv(n){const{inputs:e,backend:t}=n,r=e;if(r.length===1)return Ti({inputs:{x:r[0]},backend:t});if(r.length>De().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const l=Math.floor(r.length/2),c=Gv({inputs:r.slice(0,l),backend:t}),u=Gv({inputs:r.slice(l),backend:t});return Gv({inputs:[c,u],backend:t})}const s=r.map(l=>l.dtype).reduce((l,c)=>Ei(l,c)),o=r.map(l=>l.shape),a=De().getBool("WEBGL_PACK")?new Y5e(r[0].shape,o):new X5e(r[0].shape,o);return t.runWebGLProgram(a,r,s)}const Z5e={kernelName:rS,backendName:"webgl",kernelFunc:Gv};function J5e(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:o,keepDims:i}=r,a=s.shape.length,l=Fn(o,s.shape);let c=l;const u=Ur(c,a);let d=s;u!=null&&(d=Wo({inputs:{x:s},backend:t,attrs:{perm:u}}),c=os(c.length,a)),so("all",c,a);const[f,p]=Ws(d.shape,c),x=Le(p),v=yt({inputs:{x:d},backend:t,attrs:{shape:[-1,x]}}),y=nh(v,v.dtype,"all",t);let b;if(i){const w=ps(f,l);b=yt({inputs:{x:y},backend:t,attrs:{shape:w}})}else b=yt({inputs:{x:y},backend:t,attrs:{shape:f}});return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(y),u!=null&&t.disposeIntermediateTensorInfo(d),b}const Q5e={kernelName:sS,backendName:"webgl",kernelFunc:J5e};function eke(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:o,keepDims:i}=r,a=s.shape.length,l=Fn(o,s.shape);let c=l;const u=Ur(c,a);let d=s;u!=null&&(d=Wo({inputs:{x:s},backend:t,attrs:{perm:u}}),c=os(c.length,a)),so("any",c,a);const[f,p]=Ws(d.shape,c),x=Le(p),v=yt({inputs:{x:d},backend:t,attrs:{shape:[-1,x]}}),y=nh(v,v.dtype,"any",t);let b;if(i){const w=ps(f,l);b=yt({inputs:{x:y},backend:t,attrs:{shape:w}})}else b=yt({inputs:{x:y},backend:t,attrs:{shape:f}});return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(y),u!=null&&t.disposeIntermediateTensorInfo(d),b}const tke={kernelName:oS,backendName:"webgl",kernelFunc:eke};class nke{constructor(e,t,r){this.variableNames=["A"];const{windowSize:s,batchSize:o,outSize:i}=e;r||this.variableNames.push("bestIndicesA"),this.outputShape=[o,i];const a=t==="max"?">":"<",l=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${s}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}class rke{constructor(e,t,r,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,X(e.length>2,()=>`Packed arg${r.charAt(0).toUpperCase()+r.slice(1)} supports only inputs with rank above 2.`);const o=e[e.length-1],i=Math.ceil(o/t);this.outputShape=e.slice(0,-1),i>1&&this.outputShape.push(i),s||this.variableNames.push("bestIndicesA");const a=this.outputShape,l=a.length,c=br(l),u=Lo("coords",l);let d,f;if(i===1){f=l+1;const F=br(f);d=`
        ${F} sourceLocR = ${F}(${u.join()}, 0);
        ++${u[l-1]};
        ${F} sourceLocG = ${F}(${u.join()}, 0);
        ++${u[l-2]};
        ${F} sourceLocA = ${F}(${u.join()}, 0);
        --${u[l-1]};
        ${F} sourceLocB = ${F}(${u.join()}, 0);
        --${u[l-2]};`}else f=l,d=`
        ${c} sourceLocR = coords;
        ++${u[l-1]};
        ${c} sourceLocG = coords;
        ++${u[l-2]};
        ${c} sourceLocA = coords;
        --${u[l-1]};
        ${c} sourceLocB = coords;
        --${u[l-2]};`;const p=["x","y","z","w","u","v"].slice(0,f),x="."+p[f-1],v=p.map(F=>"int "+F),y=Lo("sourceLocR",f-1).concat("inIdx.r"),b=Lo("sourceLocG",f-1).concat("inIdx.g"),w=Lo("sourceLocB",f-1).concat("inIdx.b"),S=Lo("sourceLocA",f-1).concat("inIdx.a"),k=r==="max"?"greaterThan":"lessThan",N=s?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${y.join()}),
                             getBestIndicesAChannel(${b.join()}),
                             getBestIndicesAChannel(${w.join()}),
                             getBestIndicesAChannel(${S.join()})));`,I=`vec4(
            getAChannel(${y.join()}),
            hasNextCol ? getAChannel(${b.join()}) : 0.,
            hasNextRow ? getAChannel(${w.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${S.join()}) : 0.)`,T=s?"":`
      float getBestIndicesAChannel(${v.join()}) {
        return getChannel(getBestIndicesA(${p.join()}),
                                          vec2(${p.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${v.join()}) {
        return getChannel(getA(${p.join()}),
                               vec2(${p.slice(-2).join()}));
      }
      ${T}
      void main() {
        ${c} coords = getOutputCoords();
        bool hasNextCol = ${u[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${u[l-2]} < ${a[l-2]-1};
        ${d}
        ivec4 srcIdx = ivec4(sourceLocR${x}, sourceLocG${x},
          sourceLocB${x}, sourceLocA${x}) * ${t};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${I};

        for (int i = 0; i < ${t}; i++) {
          inIdx = srcIdx;
          ${N}
          vec4 candidate = ${I};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${k}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}function pz(n,e,t,r=null){let s=e.shape[0],o=e.shape[1];r!=null&&(s=r.shape[0],o=r.shape[1]);const i=Qb(o),a={windowSize:i,inSize:o,batchSize:s,outSize:Math.ceil(o/i)},l=new nke(a,t,r==null),c=[e];r!=null&&c.push(r);const u=n.runWebGLProgram(l,c,"int32");if(u.shape[1]===1)return u;const d=pz(n,e,t,u);return n.disposeIntermediateTensorInfo(u),d}function mz(n,e,t,r=null){const s=r!=null?r.shape:e.shape,o=s[s.length-1],i=Qb(o),a=new rke(s,i,t,r==null),l=r==null?[e]:[e,r],c=n.runWebGLProgram(a,l,"int32");if(c.shape.length===e.shape.length){const u=mz(n,e,t,c);return n.disposeIntermediateTensorInfo(c),u}return c}function gz(n,e,t,r){const s=[t];if(so("arg"+r.charAt(0).toUpperCase()+r.slice(1),s,e.shape.length),!De().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const o=[],i=n.texData.get(e.dataId),a=i!==null&&i.isPacked;let l=e;a&&(l=n.unpackTensor(e),o.push(l));const[c,u]=Ws(l.shape,s),d=Le(u),f=yt({inputs:{x:l},backend:n,attrs:{shape:[-1,d]}});o.push(f);const p=pz(n,f,r);o.push(p);const x=yt({inputs:{x:p},backend:n,attrs:{shape:c}});return o.forEach(v=>n.disposeIntermediateTensorInfo(v)),x}return mz(n,e,r)}function ske(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:o}=r;let i=Fn(o,s.shape);const a=Ur(i,s.shape.length);let l=s;const c=[];a!=null&&(l=Wo({inputs:{x:s},backend:t,attrs:{perm:a}}),c.push(l),i=os(i.length,l.shape.length)),so("argMax",[i[0]],l.shape.length);const u=gz(t,l,i[0],"max");return c.forEach(d=>t.disposeIntermediateTensorInfo(d)),u}const oke={kernelName:Uy,backendName:"webgl",kernelFunc:ske};function ike(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:o}=r;let i=Fn(o,s.shape);const a=Ur(i,s.shape.length);let l=s;const c=[];a!=null&&(l=Wo({inputs:{x:s},backend:t,attrs:{perm:a}}),c.push(l),i=os(i.length,l.shape.length)),so("argMin",[i[0]],l.shape.length);const u=gz(t,l,i[0],"min");return c.forEach(d=>t.disposeIntermediateTensorInfo(d)),u}const ake={kernelName:Hy,backendName:"webgl",kernelFunc:ike};const lke=Pa+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,cke=qn({opSnippet:lke}),uke={kernelName:h1,backendName:"webgl",kernelFunc:cke};const dke=Pa+"return log(x + sqrt(x * x + 1.0));",fke=qn({opSnippet:dke}),hke={kernelName:p1,backendName:"webgl",kernelFunc:fke};const pke=Pa+`
  return atan(x);
`,mke=qn({opSnippet:pke}),gke={kernelName:m1,backendName:"webgl",kernelFunc:mke};const xke=_N+`
  return atan(a, b);
`,vke=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+th+`
  return result;
`,yke=oo({opSnippet:xke,packedOpSnippet:vke}),bke={kernelName:x1,backendName:"webgl",kernelFunc:yke};const wke=Pa+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,Cke=qn({opSnippet:wke}),kke={kernelName:g1,backendName:"webgl",kernelFunc:Cke};class Hg{constructor(e,t,r,s=!1,o=!1){if(this.variableNames=["x"],t==="avg"&&r)throw new Error("Cannot compute positions for average pool.");const i=e.filterWidth,a=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,u=e.dilationWidth,d=e.effectiveFilterHeight,f=e.effectiveFilterWidth,p=e.padInfo.top,x=e.padInfo.left;this.outputShape=e.outShape;const v=t==="avg",y=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,b=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let w="0.0";if(v||(w="-1.0 / 1e-20"),r){this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${p}, ${x});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${d};
              wR += ${c}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${f};
                wC += ${u}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${s?o?y:b:`wR * ${f} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const S="max";let k=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(k="avgValue / max(count, 1.0)");const N=Math.floor(i/4)*4,I=i%4,T=`
      if (${v}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${S}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${p}, ${x});
      const float initializationValue = ${w};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${w});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${d};
            wR += ${c}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${N}; wC += 4) {
            int xC = xCCorner + wC * ${u};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              getValue(batch, xR, xC + 3 * ${u}, d)
            );

            ${T}
          }

          int xC = xCCorner + ${N};
          if (${I===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${T}
          } else if (${I===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              initializationValue,
              initializationValue
            );

            ${T}
          } else if (${I===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              initializationValue
            );

            ${T}
          }
        }
        setOutput(${k});
      }
    `}}class DN{constructor(e,t,r,s=!1,o=!1){if(this.variableNames=["x"],t==="avg"&&r)throw new Error("Cannot compute positions for average pool.");const i=e.filterWidth,a=e.strideDepth,l=e.strideHeight,c=e.strideWidth,u=e.dilationDepth,d=e.dilationHeight,f=e.dilationWidth,p=e.effectiveFilterDepth,x=e.effectiveFilterHeight,v=e.effectiveFilterWidth,y=e.padInfo.front,b=e.padInfo.top,w=e.padInfo.left;this.outputShape=e.outShape;const S=t==="avg";let k="0.0";if(S||(k="-1.0 / 1e-20"),r){this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${c});
        const ivec3 pads = ivec3(${y}, ${b}, ${w});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${p};
              wD += ${u}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${x};
                wR += ${d}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${v};
                  wC += ${f}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${s?o?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${x} * ${v} +
                      wR * ${v} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const N="max";let I=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(I="avgValue / max(count, 1.0)");const T=Math.floor(i/4)*4,F=i%4,R=`
      if (${S}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${N}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${c});
      const ivec3 pads = ivec3(${y}, ${b}, ${w});
      const float initializationValue = ${k};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${k});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${p};
            wD += ${u}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${x};
            wR += ${d}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${T}; wC += 4) {
              int xC = xCCorner + wC * ${f};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                getValue(batch, xD, xR, xC + 2 * ${f}, ch),
                getValue(batch, xD, xR, xC + 3 * ${f}, ch)
              );

              ${R}
            }

            int xC = xCCorner + ${T};
            if (${F===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${R}
            } else if (${F===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                initializationValue,
                initializationValue
              );

              ${R}
            } else if (${F===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                getValue(batch, xD, xR, xC + 2 * ${f}, ch),
                initializationValue
              );

              ${R}
            }
          }
        }
        setOutput(${I});
      }
    `}}function Ske(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e;S0(s,"avgPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:l}=r,c=1;X(xo(i,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);const u=$a(s.shape,o,i,c,a,l);if(u.filterWidth===1&&u.filterHeight===1&&lr(u.inShape,u.outShape))return Ti({inputs:{x:s},backend:t});const d=new Hg(u,"avg",!1);return t.runWebGLProgram(d,[s],"float32")}const Nke={kernelName:Gy,backendName:"webgl",kernelFunc:Ske};function Eke(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:l,dataFormat:c}=r,u=[1,1,1],d=eu(s.shape,o,i,u,a,l,c),f=new DN(d,"avg",!1);return t.runWebGLProgram(f,[s],"float32")}const Ike={kernelName:qy,backendName:"webgl",kernelFunc:Eke};class Tke{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterHeight,r=e.filterWidth,s=e.strideHeight,o=e.strideWidth,i=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterHeight,c=e.effectiveFilterWidth,u=l-1-e.padInfo.top,d=c-1-e.padInfo.left,f=1/(t*r);this.userCode=`
      const ivec2 pads = ivec2(${u}, ${d});
      const float avgMultiplier = float(${f});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${i}) {
          float dyR = float(dyRCorner + wR) / ${s}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${c};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class _ke{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterDepth,r=e.filterHeight,s=e.filterWidth,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,u=e.dilationWidth,d=e.effectiveFilterDepth,f=e.effectiveFilterHeight,p=e.effectiveFilterWidth,x=d-1-e.padInfo.front,v=f-1-e.padInfo.top,y=p-1-e.padInfo.left,b=1/(t*r*s);this.userCode=`
      const ivec3 pads = ivec3(${x}, ${v}, ${y});
      const float avgMultiplier = float(${b});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${d};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${o}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${f};
              wR += ${c}) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${p};
                wC += ${u}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}function Rke(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:o}=e,i=o,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=r,d=[1,1,1],f=eu(i.shape,a,l,d,c,u),p=new _ke(f);return t.runWebGLProgram(p,[s],i.dtype)}const Dke={kernelName:aS,backendName:"webgl",kernelFunc:Rke};function Ake(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:o}=e,i=o;S0([s,o],"avgPoolGrad");const{filterSize:a,strides:l,pad:c}=r,u=$a(i.shape,a,l,1,c),d=new Tke(u);return t.runWebGLProgram(d,[s],i.dtype)}const $ke={kernelName:iS,backendName:"webgl",kernelFunc:Ake};function Fke(n){const{inputs:e,backend:t,attrs:r}=n,{a:s,b:o}=e,{transposeA:i,transposeB:a}=r;return sy({a:s,b:o,transposeA:i,transposeB:a,backend:t})}const Pke={kernelName:Ky,backendName:"webgl",kernelFunc:Fke};class Oke{constructor(e,t,r,s,o,i){this.outputShape=[],this.variableNames=["x","mean","variance"],Sn(e,t),Sn(e,r);let a="0.0";s!=null&&(Sn(e,s),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";o!=null&&(Sn(e,o),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${i}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}class Mke{constructor(e,t,r,s,o,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Sn(e,t),Sn(e,r);let a="vec4(0.0)";s!=null&&(Sn(e,s),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";o!=null&&(Sn(e,o),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${i}));

        setOutput((x - mean) * inv + offset);
      }
    `}}const Lke=({inputs:n,backend:e,attrs:t})=>{const{x:r,mean:s,variance:o,offset:i,scale:a}=n;X(s.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),X(i==null||s.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),X(a==null||s.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=t;l==null&&(l=.001);const c=[r,s,o];let u=null;i!=null&&(u=i.shape,c.push(i));let d=null;a!=null&&(d=a.shape,c.push(a));const f=De().getBool("WEBGL_PACK_NORMALIZATION")?new Mke(r.shape,s.shape,o.shape,u,d,l):new Oke(r.shape,s.shape,o.shape,u,d,l);return e.runWebGLProgram(f,c,c[0].dtype)},jke={kernelName:ib,backendName:"webgl",kernelFunc:Lke};class Bke{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=br(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const r=Vke(this.rank);let s;const o=e.map((i,a)=>`sourceLoc.${ak[a]} = start[${a}] + coords.${ak[a]};`);s=`
        ${t} sourceLoc;
        ${t} coords = getOutputCoords();
        ${o.join(`
`)}
      `,this.userCode=`
      void main() {
        ${s}
        setOutput(getSource(${r}));
      }
    `}}const ak=["x","y","z","w","u","v"];function Vke(n){if(n===1)return"sourceLoc";if(n<=6)return ak.slice(0,n).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${n} is not yet supported`)}class zke{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const t=br(this.rank),r=Lo("coords",this.rank),s=Lo("sourceLoc",this.rank),o=this.rank===1?"sourceLoc":`vec2(${s.slice(-2).join()})`,i=`getChannel(getSource(${s.join()}), ${o})`,a=`
      result.x = ${i};
      if (++${r[this.rank-1]} < ${e[this.rank-1]}) {
        ++${s[this.rank-1]};
        result.y = ${i};
        --${s[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${r[this.rank-1]};
      if (++${r[this.rank-2]} < ${e[this.rank-2]}) {
        ++${s[this.rank-2]};
        result.z = ${i};
        if (++${r[this.rank-1]} < ${e[this.rank-1]}) {
          ++${s[this.rank-1]};
          result.w = ${i};
        }
      }
    `,c=this.rank<=4?`sourceLoc = coords +
            ${t}(${e.map((u,d)=>`start[${d}]`).join()});`:e.map((u,d)=>`${s[d]} = ${r[d]} + start[${d}];`).join(`
`);this.userCode=`
      void main() {
        ${t} coords = getOutputCoords();
        ${t} sourceLoc;
        ${c}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}}function Wke(n,e,t,r){const s=r.texData.get(n.dataId),o=r.makeTensorInfo(t,n.dtype),i=r.texData.get(o.dataId);Object.assign(i,s),i.refCount=1,i.shape=t,i.dtype=n.dtype;let a=E8(e,nn(n.shape));s.slice&&(a+=s.slice.flatOffset),i.slice={flatOffset:a,origDataId:s.slice&&s.slice.origDataId||n.dataId};const l=r.dataRefCount.get(i.slice.origDataId)||1;return r.dataRefCount.set(i.slice.origDataId,l+1),o}function dm(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{begin:o,size:i}=r,[a,l]=Jb(s,o,i);if(k8(s,a,l),Le(l)===0)return t.makeTensorInfo(l,s.dtype,[]);if(t.shouldExecuteOnCPU([s])||s.dtype==="string"){const d=t.texData.get(s.dataId),f=P4e(d.values,a,l,s.shape,s.dtype);return t.makeTensorInfo(l,s.dtype,f)}const{isPacked:c}=t.texData.get(s.dataId),u=N8(s.shape,a,l);if(c||!u){const d=De().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new zke(l):new Bke(l),f=[a];return t.runWebGLProgram(d,[s],s.dtype,f)}return t.uploadToGPU(s.dataId),Wke(s,a,l,t)}const Uke={kernelName:Pb,backendName:"webgl",kernelFunc:dm};const Hke=n=>{const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{blockShape:o,crops:i}=r;X(s.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=o.reduce((w,S)=>w*S),l=d0(s.shape,o,a),c=f0(l.length,o.length),u=h0(s.shape,o,a),d=D8(i,o.length),f=A8(u,i,o.length),p=[],x=yt({inputs:{x:s},backend:t,attrs:{shape:l}}),v=Wo({inputs:{x},backend:t,attrs:{perm:c}}),y=yt({inputs:{x:v},backend:t,attrs:{shape:u}}),b=dm({inputs:{x:y},backend:t,attrs:{begin:d,size:f}});return p.push(x),p.push(v),p.push(y),p.forEach(w=>t.disposeIntermediateTensorInfo(w)),b},Gke={kernelName:Xy,backendName:"webgl",kernelFunc:Hke};function qke(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,weights:o}=e,{size:i}=r,a=t.readSync(s.dataId),l=t.readSync(o.dataId),c=rz(a,l,o.dtype,o.shape,i);return t.makeTensorInfo([i],o.dtype,c)}const Kke={kernelName:lS,backendName:"webgl",kernelFunc:qke};const Xke=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,Yke=`
  return float(int(a.r) & int(b.r));
`;function Zke(n){const{inputs:e,backend:t}=n,{a:r,b:s}=e,o=De().getBool("WEBGL_PACK_BINARY_OPERATIONS"),i=De().getNumber("WEBGL_VERSION");if(t.shouldExecuteOnCPU([r,s])||i===1){const l=t.texData.get(r.dataId).values,c=t.texData.get(s.dataId).values,[u,d]=o4e(r.shape,s.shape,l,c,r.dtype),f=t.makeTensorInfo(d,r.dtype),p=t.texData.get(f.dataId);return p.values=u,f}let a;return o?a=new cm(Xke,r.shape,s.shape,!1):a=new Lf(Yke,r.shape,s.shape),t.runWebGLProgram(a,[r,s],r.dtype)}const Jke={kernelName:cS,backendName:"webgl",kernelFunc:Zke};function Qke(n){const{inputs:e,backend:t}=n,{s0:r,s1:s}=e,o=t.readSync(r.dataId),i=t.readSync(s.dataId),a=Sn(Array.from(o),Array.from(i));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const e6e={kernelName:cO,backendName:"webgl",kernelFunc:Qke};const t6e="return float(a != b);",xz=oo({opSnippet:t6e,cpuKernelImpl:E4e,dtype:"bool"}),n6e={kernelName:kb,backendName:"webgl",kernelFunc:xz};function E0(n){const{inputs:e,backend:t}=n,{input:r}=e,s=t.texData.get(r.dataId);return Ti({inputs:{x:s.complexTensorInfos.real},backend:t})}const r6e={kernelName:FS,backendName:"webgl",kernelFunc:E0};const s6e="return float(int(x));";function o6e(n,e){const t=new ql(n.shape,s6e),r=e.runWebGLProgram(t,[n],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}function lk(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{dtype:o}=r;if(o==="complex64"){if(s.dtype==="complex64")return Ti({inputs:{x:s},backend:t});const i=Ps(s.shape),a=lk({inputs:{x:s},backend:t,attrs:{dtype:"float32"}}),l=Id({inputs:{real:a,imag:i},backend:t});return i.dispose(),t.disposeIntermediateTensorInfo(a),l}if(s.dtype==="complex64"){const i=E0({inputs:{input:s},backend:t}),a=lk({inputs:{x:i},backend:t,attrs:{dtype:o}});return t.disposeIntermediateTensorInfo(i),a}if(!sO(s.dtype,o)){const i=Ti({inputs:{x:s},backend:t});return{dataId:i.dataId,shape:i.shape,dtype:o}}if(t.shouldExecuteOnCPU([s])){const i=t.texData.get(s.dataId).values,[a,l,c]=i4e(i,s.shape,s.dtype,o);return t.makeTensorInfo(a,l,c)}if(o==="int32")return o6e(s,t);if(o==="bool"){const i=t.makeTensorInfo([],"bool",po("bool",1)),l=xz({inputs:{a:s,b:i},backend:t});return t.disposeIntermediateTensorInfo(i),l}throw new Error(`Error in Cast: failed to cast ${s.dtype} to ${o}`)}const i6e={kernelName:v1,backendName:"webgl",kernelFunc:lk};const yR="return ceil(x);",a6e=qn({opSnippet:yR,packedOpSnippet:yR,cpuKernelImpl:a4e}),l6e={kernelName:y1,backendName:"webgl",kernelFunc:a6e};class c6e{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}class u6e{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}function d6e(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{clipValueMin:o,clipValueMax:i}=r;let a;De().getBool("WEBGL_PACK_CLIP")?a=new u6e(s.shape):a=new c6e(s.shape);const l=[[o],[i]];return t.runWebGLProgram(a,[s],s.dtype,l)}const f6e={kernelName:b1,backendName:"webgl",kernelFunc:d6e};class h6e{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}function bR(n,e){return{dataId:e.dataId,dtype:e.dtype,shape:n.shape}}function p6e(n){const{inputs:e,backend:t}=n,{x:r}=e,s=t.texData.get(r.dataId),o=new h6e(r.shape),i=[bR(r,s.complexTensorInfos.real),bR(r,s.complexTensorInfos.imag)];return t.runWebGLProgram(o,i,i[0].dtype)}const m6e={kernelName:Yy,backendName:"webgl",kernelFunc:p6e};class g6e{constructor(e){this.outputShape=[],this.outputShape=tc(e,1),this.variableNames=e.map((i,a)=>`T${a}`);const t=new Array(e.length-1);t[0]=e[0][1];for(let i=1;i<t.length;i++)t[i]=t[i-1]+e[i][1];const r=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let i=1;i<t.length;i++){const a=t[i-1];r.push(`else if (yC < ${t[i]}) setOutput(getT${i}(yR, yC-${a}));`)}const s=t.length,o=t[t.length-1];r.push(`else setOutput(getT${s}(yR, yC-${o}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${r.join(`
        `)}
      }
    `}}class x6e{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=tc(e,t);const r=this.outputShape,s=r.length,o=br(s),i=Lo("coords",s),a=["x","y","z","w","u","v"].slice(0,s);this.variableNames=e.map((v,y)=>`T${y}`);const l=new Array(e.length-1);l[0]=e[0][t];for(let v=1;v<l.length;v++)l[v]=l[v-1]+e[v][t];const c=a[t],u=a.slice(-2),d=a.join();let f=`if (${c} < ${l[0]}) {
        return getChannel(
            getT0(${d}), vec2(${u.join()}));
        }`;for(let v=1;v<l.length;v++){const y=l[v-1];f+=`
        if (${c} < ${l[v]}  && ${c} >= ${l[v-1]}) {
          return getChannel(
            getT${v}(${Iv(a,c,y)}),
            vec2(${Iv(u,c,y)}));
        }`}const p=l.length,x=l[l.length-1];f+=`
        return getChannel(
          getT${p}(${Iv(a,c,x)}),
          vec2(${Iv(u,c,x)}));`,this.userCode=`
      float getValue(${a.map(v=>"int "+v)}) {
        ${f}
      }

      void main() {
        ${o} coords = getOutputCoords();
        vec4 result = vec4(getValue(${i}), 0., 0., 0.);

        ${i[s-1]} = ${i[s-1]} + 1;
        if (${i[s-1]} < ${r[s-1]}) {
          result.g = getValue(${i});
        }

        ${i[s-2]} = ${i[s-2]} + 1;
        if (${i[s-2]} < ${r[s-2]}) {
          result.a = getValue(${i});
        }

        ${i[s-1]} = ${i[s-1]} - 1;
        if (${i[s-2]} < ${r[s-2]} &&
            ${i[s-1]} < ${r[s-1]}) {
          result.b = getValue(${i});
        }
        setOutput(result);
      }
    `}}function Iv(n,e,t){const r=n.indexOf(e);return n.map((o,i)=>i===r?`${o} - ${t}`:o).join()}function vw(n){const{inputs:e,backend:t}=n,{input:r}=e,s=t.texData.get(r.dataId);return Ti({inputs:{x:s.complexTensorInfos.imag},backend:t})}const v6e={kernelName:ES,backendName:"webgl",kernelFunc:vw};function ag(n,e,t){const r=n[0].dtype;if(r==="complex64"){const p=n.map(w=>E0({inputs:{input:w},backend:t})),x=n.map(w=>vw({inputs:{input:w},backend:t})),v=ag(p,e,t),y=ag(x,e,t),b=Id({inputs:{real:v,imag:y},backend:t});return p.forEach(w=>t.disposeIntermediateTensorInfo(w)),x.forEach(w=>t.disposeIntermediateTensorInfo(w)),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(y),b}let s=t.shouldExecuteOnCPU(n);if(r==="string"&&(s=!0),s){const p=n.map(k=>{const I=[-1,Le(k.shape.slice(e))];return yt({inputs:{x:k},backend:t,attrs:{shape:I}})}),x=p.map(k=>({vals:t.readSync(k.dataId),shape:k.shape})),v=tc(p.map(k=>k.shape),1),y=p[0].shape[0]===1,b=l4e(x,v,r,y),w=tc(n.map(k=>k.shape),e),S=t.makeTensorInfo(w,r,b);return p.forEach(k=>t.disposeIntermediateTensorInfo(k)),S}const o=n.filter(p=>Le(p.shape)>0),i=De().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&o[0].shape.length>1;if(o.length===1){const p=i?new ql(n[0].shape,Lu):new qu(n[0].shape,Lu);return t.runWebGLProgram(p,n,r)}const a=De().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(o.length>a){const p=[];for(let v=0;v<o.length;v+=a){const y=o.slice(v,v+a);p.push(ag(y,e,t))}const x=ag(p,e,t);for(const v of p)t.disposeIntermediateTensorInfo(v);return x}if(i){const p=new x6e(o.map(x=>x.shape),e);return t.runWebGLProgram(p,o,r)}const{tensors2D:l,outShape:c}=y6e(o,e,t),u=new g6e(l.map(p=>p.shape)),d=t.runWebGLProgram(u,l,r);l.forEach(p=>t.disposeIntermediateTensorInfo(p));const f=yt({inputs:{x:d},attrs:{shape:c},backend:t});return t.disposeIntermediateTensorInfo(d),f}function y6e(n,e,t){const r=tc(n.map(o=>o.shape),e);return{tensors2D:n.map(o=>yt({inputs:{x:o},attrs:{shape:[-1,Le(o.shape.slice(e))]},backend:t})),outShape:r}}function vz(n){const{inputs:e,backend:t,attrs:r}=n,{axis:s}=r,o=Fn(s,e[0].shape)[0],i=e.map(c=>c.shape);T8(i,o);const a=tc(e.map(c=>c.shape),o);if(Le(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(c=>Le(c.shape)>0);return l.length===1?Ti({inputs:{x:l[0]},backend:t}):ag(l,o,t)}const b6e={kernelName:Zy,backendName:"webgl",kernelFunc:vz};class yz{constructor(e,t=!1,r=null,s=!1,o=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const i=e.padInfo.top,a=e.padInfo.left,l=e.strideHeight,c=e.strideWidth,u=e.dilationHeight,d=e.dilationWidth,f=e.filterHeight,p=e.filterWidth,x=Math.floor(e.inChannels/4)*4,v=e.inChannels%4,y=e.dataFormat==="channelsLast",b=y?1:2,w=y?2:3,S=y?3:1;let k="",N="";r&&(s?k=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:o?k=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:k=`
          float activation(float x) {
            ${r}
          }
        `,N="result = activation(result);");const I=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${k}

      const ivec2 strides = ivec2(${l}, ${c});
      const ivec2 pads = ivec2(${i}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${S}];

        ivec2 xRCCorner =
            ivec2(coords[${b}], coords[${w}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${f}; wR++) {
          int xR = xRCorner + wR * ${u};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${p}; wC++) {
            int xC = xCCorner + wC * ${d};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${x}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${y}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${v===1}) {

              if (${y}) {
                dotProd +=
                    getX(batch, xR, xC, ${x}) *
                    getW(wR, wC, ${x}, d2);
              } else {
                dotProd +=
                    getX(batch, ${x}, xR, xC) *
                    getW(wR, wC, ${x}, d2);
              }

            } else if (${v===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${x}, d2),
                getW(wR, wC, ${x} + 1, d2)
              );

              if (${y}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${x}),
                  getX(batch, xR, xC, ${x} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${x}, xR, xC),
                  getX(batch, ${x} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${v===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${x}, d2),
                getW(wR, wC, ${x} + 1, d2),
                getW(wR, wC, ${x} + 2, d2)
              );

              if (${y}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${x}),
                  getX(batch, xR, xC, ${x} + 1),
                  getX(batch, xR, xC, ${x} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${x}, xR, xC),
                  getX(batch, ${x} + 1, xR, xC),
                  getX(batch, ${x} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${I}
        ${N}
        setOutput(result);
      }
    `}}class w6e{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,r=e.padInfo.top,s=e.padInfo.left,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,u=e.dilationWidth,d=e.filterDepth,f=e.filterHeight,p=e.filterWidth,x=Math.floor(e.inChannels/4)*4,v=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${o}, ${i}, ${a});
      const ivec3 pads = ivec3(${t}, ${r}, ${s});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${d}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${f}; wR++) {
            int xR = xRCorner + wR * ${c};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${p}; wC++) {
              int xC = xCCorner + wC * ${u};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${x}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${v===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${x}) *
                  getW(wF, wR, wC, ${x}, d2);
              } else if (${v===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${x}),
                  getX(batch, xF, xR, xC, ${x} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${x}, d2),
                  getW(wF, wR, wC, ${x} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${v===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${x}),
                  getX(batch, xF, xR, xC, ${x} + 1),
                  getX(batch, xF, xR, xC, ${x} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${x}, d2),
                  getW(wF, wR, wC, ${x} + 1, d2),
                  getW(wF, wR, wC, ${x} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class bz{constructor(e,t=!1,r=null,s=!1,o=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=yo(this.outputShape.length);const i=e.padInfo.left,a=e.strideWidth,l=e.dilationWidth,c=e.filterHeight,u=e.filterWidth,d=u;let f=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let y=0;y<u;y++)f+=`
           vec4 xTexelC${y*2};
           int xTexelC${y*2}Ready;
           vec4 xTexelC${y*2+1};
           int xTexelC${y*2+1}Ready;
           vec4 xC${y};`;f+=`
     for (int r = 0; r < ${c}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let y=0;y<u;y++)f+=`
           xTexelC${y*2} = vec4(0.0);
           xTexelC${y*2}Ready = 0;
           xTexelC${y*2+1} = vec4(0.0);
           xTexelC${y*2+1}Ready = 0;
           xC${y} = vec4(0.0);`;f+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let y=0;y<(d+1)/2;y++){const b=y*2;if(f+=`
           xC = xCCorner + ${b*l};
           `,a===1){if(b<u&&(i%2===1?(f+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                   xTexelC${b} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${b}.zw = vec2(0.0);
                   }
                   xTexelC${b}Ready = 1;
                 }
               `,l===1&&b>0?f+=`
                 xC${b} = vec4(xTexelC${b-2}.zw, xTexelC${b}.xy);
                 `:f+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${b} = vec4(previous.zw, xTexelC${b}.xy);
                   } else {
                     xC${b} = vec4(0.0, 0.0, xTexelC${b}.xy);
                   }
                   `):f+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${b}Ready == 0) {
                   xTexelC${b} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${b}.zw = vec2(0.0);
                   }
                   xTexelC${b}Ready = 1;
                 }

                 xC${b} = xTexelC${b};
                 `,b+1<u)){const w=i%2===0?J6(l):l;l%2===0&&i%2===1||l%2!==0&&i%2!==1?(f+=`
                   xCOffset = xC + imod(pads[1], 2) + ${w};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                     xTexelC${b+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${b+1}.zw = vec2(0.0);
                     }
                     xTexelC${b+1}Ready = 1;
                   }
                   `,l>1?f+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${b+1} = vec4(previous.zw, xTexelC${b+1}.xy);
                     } else {
                      xC${b+1} = vec4(0.0, 0.0, xTexelC${b+1}.xy);
                     }
                     `:f+=`
                     xC${b+1} = vec4(xTexelC${b}.zw, xTexelC${b+1}.xy);
                     `):w===1?f+=`
                     xC${b+1} = xTexelC${b};
                     `:f+=`
                     xCOffset = xC + ${w};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                       xTexelC${b+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${b+1}.zw = vec2(0.0);
                       }
                       xTexelC${b+1}Ready = 1;
                     }

                     xC${b+1} = xTexelC${b+1};
                     `}}else b<u&&(i%2===1?(f+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                   xTexelC${b} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${b}.zw = vec2(0.0);
                   }
                   xTexelC${b}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${b+1}Ready == 0) {
                   xTexelC${b+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${b+1}.zw = vec2(0.0);
                   }
                   xTexelC${b+1}Ready = 1;
                 }

                 xC${b} = vec4(xTexelC${b}.zw, xTexelC${b+1}.zw);
               `,b+1<u&&(f+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${b+1} = vec4(xTexelC${b+1}.xy, final.xy);
                 `)):(f+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${b}Ready == 0) {
                   xTexelC${b} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${b}.zw = vec2(0.0);
                   }
                   xTexelC${b}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                   xTexelC${b+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${b+1}.zw = vec2(0.);
                   }
                   xTexelC${b+1}Ready = 1;
                 }

                 xC${b} = vec4(
                   xTexelC${b}.xy, xTexelC${b+1}.xy);
               `,b+1<u&&(f+=`
                   xC${b+1} = vec4(xTexelC${b}.zw, xTexelC${b+1}.zw);
                 `)));b<u&&(f+=`
             wTexel = getW(r, ${b}, d1, d2);
             dotProd += xC${b}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${b}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,b+1<u&&(f+=`
               wTexel = getW(r, ${b+1}, d1, d2);
               dotProd += xC${b+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${b+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}f+=`
     }
   `,f+=`
     }
   `,f+=`
     }
   `;let p="",x="";r&&(s?p=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${r}
         }`:o?p=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${r}
         }`:p=`vec4 activation(vec4 x) {
           ${r}
         }`,x="result = activation(result);");const v=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${p}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${f}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${v}
         ${x}
         setOutput(result);
       }
     `}}class C6e{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=yo(this.outputShape.length);const{dataFormat:r}=t,s=Uo(),o=r==="channelsLast",i=o?1:2,a=o?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let c="";for(let u=0;u<=1;u++)for(let d=0;d<=1;d++)c+=`
          blockIndex = rc.z + ${d};
          pos = rc.y + ${u};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${i}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${o}) {
                  innerDims = vec2(d1, ch);
                  result[${u*2+d}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${u*2+d}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${c}

        ${s.output} = result;
      }
    `}}function oy(n,e){const t=n.length;return t>=3?e?[...n.slice(0,-3),n[t-3]*n[t-2],n[t-1]]:[...n.slice(0,-3),n[t-3],n[t-2]*n[t-1]]:!e&&t===1&&n[0]>1?[n[0],1]:null}function wz({x:n,filter:e,convInfo:t,backend:r,bias:s=null,preluActivationWeights:o=null,leakyreluAlpha:i=0,activation:a=null}){const l=n.shape,c=r.texData.get(n.dataId),u=t.inChannels,d=l[0]*l[1]*l[2],f=t.outChannels,p=t.dataFormat==="channelsLast",x=!1,v=!1;let y;const b=[];if(o!=null){const k=oy(o.shape,p);k!=null&&(o=yt({inputs:{x:o},backend:r,attrs:{shape:k}}),b.push(o))}if(s!=null){const k=oy(s.shape,p);k!=null&&(s=yt({inputs:{x:s},backend:r,attrs:{shape:k}}),b.push(s))}if(!((d===1||f===1)&&u>hz)&&c.isPacked&&p&&c.texture!=null&&l[2]%2!==0&&lr(c.shape.slice(-3),l.slice(-3))){const k=l[0]*l[1]*(l[2]+1),N={dataId:n.dataId,shape:[1,k,t.inChannels],dtype:n.dtype},I=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,X(ry(c.shape,N.shape),()=>`packed reshape ${c.shape} to ${N.shape} isn't free`);const T=yt({inputs:{x:e},backend:r,attrs:{shape:[1,t.inChannels,t.outChannels]}});b.push(T);const F=sy({a:N,b:T,backend:r,transposeA:x,transposeB:v,bias:s,activation:a,preluActivationWeights:o,leakyreluAlpha:i}),R=r.texData.get(F.dataId);X(R.isPacked,()=>"batchMatMul result is expected to be packed"),c.shape=I,R.shape=t.outShape,y=Ti({inputs:{x:F},backend:r}),y.shape=t.outShape,b.push(F)}else{const k=t.outHeight*t.outWidth,N=yt({inputs:{x:n},backend:r,attrs:{shape:p?[t.batchSize,k,t.inChannels]:[t.batchSize,t.inChannels,k]}}),I=yt({inputs:{x:e},backend:r,attrs:{shape:[1,t.inChannels,t.outChannels]}}),T=sy({a:p?N:I,b:p?I:N,transposeA:!p,transposeB:v,backend:r,bias:s,activation:a,preluActivationWeights:o,leakyreluAlpha:i});y=yt({inputs:{x:T},backend:r,attrs:{shape:t.outShape}}),b.push(N),b.push(I),b.push(T)}for(const k of b)r.disposeIntermediateTensorInfo(k);return y}function Cz({x:n,filter:e,convInfo:t,backend:r,bias:s=null,preluActivationWeights:o=null,leakyreluAlpha:i=0,activation:a=null}){const{filterWidth:l,filterHeight:c,inChannels:u,outWidth:d,outHeight:f,dataFormat:p}=t,x=p==="channelsLast",v=l*c*u,y=f*d,b=[t.batchSize,v,y],w=!0,S=!1,k=[];if(o!=null){const M=oy(o.shape,x);M!=null&&(o=yt({inputs:{x:o},backend:r,attrs:{shape:M}}),k.push(o))}if(s!=null){const M=oy(s.shape,x);M!=null&&(s=yt({inputs:{x:s},backend:r,attrs:{shape:M}}),k.push(s))}const N=yt({inputs:{x:e},backend:r,attrs:{shape:[1,v,Le(e.shape)/v]}});k.push(N);const I=new C6e(b,t),T=[n.shape,[t.padInfo.top,t.padInfo.left],[t.strideHeight,t.strideWidth],[t.dilationHeight,t.dilationWidth],[t.inChannels],[t.filterWidth*t.inChannels],[t.outWidth]],F=r.runWebGLProgram(I,[n],"float32",T),R=yt({inputs:{x:F},backend:r,attrs:{shape:b}});k.push(F),k.push(R);const D=s!=null,A=o!=null,P=a==="leakyrelu",B=a?Ug(a,!0):null,L=new fz(x?R.shape:N.shape,x?N.shape:R.shape,x?[t.batchSize,y,t.outChannels]:[t.batchSize,t.outChannels,y],w,S,D,B,A,P),W=x?[R,N]:[N,R];if(s&&W.push(s),A&&W.push(o),P){const M=r.makeTensorInfo([],"float32",yd(i,"float32"));W.push(M),k.push(M)}const H=r.runWebGLProgram(L,W,"float32"),G=yt({inputs:{x:H},backend:r,attrs:{shape:t.outShape}});k.push(H);for(const M of k)r.disposeIntermediateTensorInfo(M);return G}function k6e(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:o}=e,{strides:i,pad:a,dataFormat:l,dilations:c,dimRoundingMode:u}=r,d=tu(l),f=ro(s.shape,o.shape,i,c,a,u,!1,d);let p;if(f.filterHeight===1&&f.filterWidth===1&&f.dilationHeight===1&&f.dilationWidth===1&&f.strideHeight===1&&f.strideWidth===1&&(f.padInfo.type==="SAME"||f.padInfo.type==="VALID"))p=wz({x:s,filter:o,convInfo:f,backend:t});else if(f.strideWidth<=2&&d==="channelsLast"&&De().getBool("WEBGL_EXP_CONV")){const v=new bz(f),y=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];p=t.runWebGLProgram(v,[s,o],"float32",y)}else if(De().getBool("WEBGL_CONV_IM2COL"))p=Cz({x:s,filter:o,convInfo:f,backend:t});else{const v=new yz(f);p=t.runWebGLProgram(v,[s,o],"float32")}const x=yt({inputs:{x:p},backend:t,attrs:{shape:f.outShape}});return t.disposeIntermediateTensorInfo(p),x}const S6e={kernelName:Jy,backendName:"webgl",kernelFunc:k6e};class N6e{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,r=e.strideWidth,s=e.padInfo.top,o=e.padInfo.left,i=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${s};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${o};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${i?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class E6e{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,r=e.filterWidth,s=e.strideHeight,o=e.strideWidth,i=e.dataFormat==="channelsLast",a=t-1-e.padInfo.top,l=r-1-e.padInfo.left,c=i?1:2,u=i?2:3,d=i?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${d}];

        ivec2 dyCorner = ivec2(coords[${c}], coords[${u}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${s}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${i}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class I6e{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideDepth,r=e.strideHeight,s=e.strideWidth,o=e.padInfo.front,i=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${t} - ${o};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${r} - ${i};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${s} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class T6e{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,r=e.filterHeight,s=e.filterWidth,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,l=t-1-e.padInfo.front,c=r-1-e.padInfo.top,u=s-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${c}, ${u});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${t}; wF++) {
          float dyF = float(dyFCorner + wF) / ${o}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${t} - 1 - wF;

          for (int wR = 0; wR < ${r}; wR++) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${r} - 1 - wR;

            for (int wC = 0; wC < ${s}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${s} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}function _6e(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,dy:o}=e,{strides:i,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:u}=r,d=tu(l),f=ro(s.shape,u,i,1,a,c,!1,d),p=new N6e(f);return t.runWebGLProgram(p,[s,o],"float32")}const R6e={kernelName:dS,backendName:"webgl",kernelFunc:_6e};class D6e{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=yo(this.outputShape.length);const t=e.filterHeight,r=e.filterWidth,s=t-1-e.padInfo.top,o=r-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${s}, ${o});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            int wCPerm = ${r} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}function A6e(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,filter:o}=e,{inputShape:i,strides:a,pad:l,dataFormat:c,dimRoundingMode:u}=r,d=tu(c),f=ro(i,o.shape,a,1,l,u,!1,d);if(De().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&d==="channelsLast"){const p=[[f.strideHeight,f.strideWidth]],x=new D6e(f);return t.runWebGLProgram(x,[s,o],"float32",p)}else{const p=new E6e(f);return t.runWebGLProgram(p,[s,o],"float32")}}const $6e={kernelName:Qy,backendName:"webgl",kernelFunc:A6e};function F6e(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:o}=e,{strides:i,pad:a,dilations:l}=r,c=bd(s.shape,o.shape,i,l,a),u=new w6e(c);return t.runWebGLProgram(u,[s,o],"float32")}const P6e={kernelName:eb,backendName:"webgl",kernelFunc:F6e};function O6e(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,dy:o}=e,{strides:i,pad:a,filterShape:l}=r,c=bd(s.shape,l,i,1,a),u=new I6e(c);return t.runWebGLProgram(u,[s,o],"float32")}const M6e={kernelName:fS,backendName:"webgl",kernelFunc:O6e};function L6e(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,filter:o}=e,{pad:i,strides:a,inputShape:l}=r,c=bd(l,o.shape,a,1,i),u=new T6e(c);return t.runWebGLProgram(u,[s,o],"float32")}const j6e={kernelName:hS,backendName:"webgl",kernelFunc:L6e};const B6e=um+`
  return cos(x);
`,V6e=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${th}
  return result;
`,z6e=qn({opSnippet:B6e,packedOpSnippet:V6e}),W6e={kernelName:w1,backendName:"webgl",kernelFunc:z6e};const U6e=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,H6e=qn({opSnippet:U6e}),G6e={kernelName:C1,backendName:"webgl",kernelFunc:H6e};class q6e{constructor(e,t,r,s,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[i,a,l,c]=e,[u]=t,[d,f]=r;this.outputShape=[u,d,f,c];const p=s==="bilinear"?1:0,[x,v]=[`${a-1}.0`,`${l-1}.0`],[y,b,w]=d>1?[`${(a-1)/(d-1)}`,"(y2-y1) * height_ratio",`y1*${x} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${x}`],[S,k,N]=f>1?[`${(l-1)/(f-1)}`,"(x2-x1) * width_ratio",`x1*${v} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${v}`];this.userCode=`
      const float height_ratio = float(${y});
      const float width_ratio = float(${S});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${i}) {
          return;
        }

        float height_scale = ${b};
        float width_scale = ${k};

        float in_y = ${w};
        if( in_y < 0.0 || in_y > ${x} ) {
          setOutput(float(${o}));
          return;
        }
        float in_x = ${N};
        if( in_x < 0.0 || in_x > ${v} ) {
          setOutput(float(${o}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${p} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}const K6e=n=>{const{inputs:e,backend:t,attrs:r}=n,{image:s,boxes:o,boxInd:i}=e,{cropSize:a,method:l,extrapolationValue:c}=r,u=new q6e(s.shape,o.shape,a,l,c);return t.runWebGLProgram(u,[s,o,i],"float32")},X6e={kernelName:mS,backendName:"webgl",kernelFunc:K6e};var Gg;(function(n){n.Prod="*",n.Sum="+"})(Gg||(Gg={}));class wR{constructor(e,t,r,s){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const o=this.outputShape.length,i=this.op===Gg.Prod?"1.0":"0.0",a=r?i:`getX(${CR(o,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1];let c="",u="";r?(c=s?`end != ${l-1}`:"end != 0",u=s?"end + 1":"end - 1"):(c=s?`end + pow2 < ${l}`:"end >= pow2",u=s?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${br(o)} coords = getOutputCoords();
        int end = ${kR(o,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${c}) {
          int idx = ${u};
          ${kR(o,"coords",this.op)} = idx;
          val ${this.op}= getX(${CR(o,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function CR(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.x, ${e}.y`;if(n===3)return`${e}.x, ${e}.y, ${e}.z`;if(n===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}function kR(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.y`;if(n===3)return`${e}.z`;if(n===4)return`${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}function kz(n,e,t,r,s,o){const i=e.shape.length,a=Ur([r],i);let l=e;a!=null&&(l=Wo({inputs:{x:e},backend:t,attrs:{perm:a}}));const c=os(1,i)[0];if(c!==i-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${r}`);const u=l.shape[c];let d=Ti({inputs:{x:l},backend:t});for(let f=0;f<=Math.ceil(Math.log2(u))-1;f++){const p=new wR(n,l.shape,!1,o),x=[[f]],v=d;d=t.runWebGLProgram(p,[d],d.dtype,x),t.disposeIntermediateTensorInfo(v)}if(s){const f=new wR(n,l.shape,s,o),p=d;d=t.runWebGLProgram(f,[d],d.dtype),t.disposeIntermediateTensorInfo(p)}if(a!=null){const f=wd(a),p=Wo({inputs:{x:d},backend:t,attrs:{perm:f}});return t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(l),p}return d}function Y6e(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:o,exclusive:i,reverse:a}=r;return kz(Gg.Prod,s,t,o,i,a)}const Z6e={kernelName:pS,backendName:"webgl",kernelFunc:Y6e};function J6e(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:o,exclusive:i,reverse:a}=r;return kz(Gg.Sum,s,t,o,i,a)}const Q6e={kernelName:tb,backendName:"webgl",kernelFunc:J6e};function eSe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,weights:o}=e,{size:i,binaryOutput:a}=r;if(s.shape.length===1){const l=t.readSync(s.dataId),c=t.readSync(o.dataId),u=rz(l,c,o.dtype,o.shape,i);return t.makeTensorInfo([i],o.dtype,u)}else if(s.shape.length===2){const l=t.bufferSync(s),c=t.bufferSync(o),u=s4e(l,c,i,a);return t.makeTensorInfo(u.shape,o.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${s.shape.length}.`)}const tSe={kernelName:gS,backendName:"webgl",kernelFunc:eSe};class nSe{constructor(e,t,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${t};
      int offset_h = imod(h, ${t});
      int in_w = w / ${t};
      int offset_w = imod(w, ${t});
      int offset_d = (offset_h * ${t} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}function rSe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{blockSize:o,dataFormat:i}=r,a=s.shape[0],l=i==="NHWC"?s.shape[1]:s.shape[2],c=i==="NHWC"?s.shape[2]:s.shape[3],u=i==="NHWC"?s.shape[3]:s.shape[1],d=l*o,f=c*o,p=u/(o*o),x=i==="NHWC"?[a,d,f,p]:[a,p,d,f],v=new nSe(x,o,i);return t.runWebGLProgram(v,[s],s.dtype)}const sSe={kernelName:xS,backendName:"webgl",kernelFunc:rSe};class Sz{constructor(e,t=!1,r=null,s=!1,o=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=yo(this.outputShape.length);const i=e.filterHeight,a=e.filterWidth,l=e.outChannels/e.inChannels;let c="",u="";r&&(s?c=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:o?c=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:c=`
          float activation(float x) {
            ${r}
          }
        `,u="result = activation(result);");const d=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${c}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${i}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${d}
        ${u}
        setOutput(result);
      }
    `}}class Nz{constructor(e,t=!1,r=null,s=!1,o=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=yo(this.outputShape.length);const i=e.outChannels/e.inChannels,a=e.padInfo.left,l=e.strideWidth,c=e.dilationWidth,u=e.filterHeight,d=e.filterWidth,f=d;let p=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let b=0;b<d;b++)p+=`
          vec4 xTexelC${b*2};
          int xTexelC${b*2}Ready;
          vec4 xTexelC${b*2+1};
          int xTexelC${b*2+1}Ready;
          vec4 xC${b};`;p+=`
    for (int r = 0; r < ${u}; r++) {
      `;for(let b=0;b<d;b++)p+=`
          xTexelC${b*2} = vec4(0.0);
          xTexelC${b*2}Ready = 0;
          xTexelC${b*2+1} = vec4(0.0);
          xTexelC${b*2+1}Ready = 0;
          xC${b} = vec4(0.0);`;p+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let b=0;b<(f+1)/2;b++){const w=b*2;if(p+=`
          xC = xCCorner + ${w*c};
          `,l===1){if(w<d&&(a%2===1?(p+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }
              `,c===1&&w>0?p+=`
                xC${w} = vec4(xTexelC${w-2}.zw, xTexelC${w}.xy);
                `:p+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${w} = vec4(previous.zw, xTexelC${w}.xy);
                  } else {
                    xC${w} = vec4(0.0, 0.0, xTexelC${w}.xy);
                  }
                  `):p+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }

                xC${w} = xTexelC${w};
                `,w+1<d)){const S=a%2===0?J6(c):c;c%2===0&&a%2===1||c%2!==0&&a%2!==1?(p+=`
                  xCOffset = xC + imod(pads[1], 2) + ${S};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                    xTexelC${w+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${w+1}.zw = vec2(0.0);
                    }
                    xTexelC${w+1}Ready = 1;
                  }
                  `,c>1?p+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${w+1} = vec4(previous.zw, xTexelC${w+1}.xy);
                    } else {
                     xC${w+1} = vec4(0.0, 0.0, xTexelC${w+1}.xy);
                    }
                    `:p+=`
                    xC${w+1} = vec4(xTexelC${w}.zw, xTexelC${w+1}.xy);
                    `):S===1?p+=`
                    xC${w+1} = xTexelC${w};
                    `:p+=`
                    xCOffset = xC + ${S};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                      xTexelC${w+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${w+1}.zw = vec2(0.0);
                      }
                      xTexelC${w+1}Ready = 1;
                    }

                    xC${w+1} = xTexelC${w+1};
                    `}}else w<d&&(a%2===1?(p+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${w+1}Ready == 0) {
                  xTexelC${w+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${w+1}.zw = vec2(0.0);
                  }
                  xTexelC${w+1}Ready = 1;
                }

                xC${w} = vec4(xTexelC${w}.zw, xTexelC${w+1}.zw);
              `,w+1<d&&(p+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${w+1} = vec4(xTexelC${w+1}.xy, final.xy);
                `)):(p+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${w}Ready == 0) {
                  xTexelC${w} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${w}.zw = vec2(0.0);
                  }
                  xTexelC${w}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${w+1}Ready == 0) {
                  xTexelC${w+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${w+1}.zw = vec2(0.);
                  }
                  xTexelC${w+1}Ready = 1;
                }

                xC${w} = vec4(
                  xTexelC${w}.xy, xTexelC${w+1}.xy);
              `,w+1<d&&(p+=`
                  xC${w+1} = vec4(xTexelC${w}.zw, xTexelC${w+1}.zw);
                `)));w<d&&(p+=`
            wTexel = getW(r, ${w}, d1, q);
            dotProd += xC${w} * vec4(wTexel.xz, wTexel.xz);
          `,w+1<d&&(p+=`
              wTexel = getW(r, ${w+1}, d1, q);
              dotProd += xC${w+1} * vec4(wTexel.xz, wTexel.xz);
            `))}p+=`
    }
  `,p+=`
      }
    `;let x="",v="";r&&(s?x=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:o?x=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:x=`vec4 activation(vec4 x) {
          ${r}
        }`,v="result = activation(result);");const y=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${x}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${i};
        int q = d2 - d1 * ${i};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${p}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${y}
        ${v}
        setOutput(result);
      }
    `}}function oSe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:o}=e,{strides:i,pad:a,dilations:l,dimRoundingMode:c}=r;let u=l;u==null&&(u=[1,1]),X(xo(i,u),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const d=ro(s.shape,o.shape,i,u,a,c,!0);let f;De().getBool("WEBGL_PACK_DEPTHWISECONV")&&d.strideWidth<=2&&d.outChannels/d.inChannels===1?f=new Nz(d):f=new Sz(d);const p=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];return t.runWebGLProgram(f,[s,o],"float32",p)}const iSe={kernelName:nb,backendName:"webgl",kernelFunc:oSe};class aSe{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,r=e.strideWidth,s=e.padInfo.top,o=e.padInfo.left,i=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${i} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${s};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${o};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class lSe{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,r=e.filterWidth,s=e.strideHeight,o=e.strideWidth,i=t-1-e.padInfo.top,a=r-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${i}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${s}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}function cSe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,dy:o}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:c,filterShape:u}=r,d=ro(s.shape,u,i,a,l,c,!0),f=new aSe(d);return t.runWebGLProgram(f,[s,o],"float32")}const uSe={kernelName:vS,backendName:"webgl",kernelFunc:cSe};function dSe(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,filter:o}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:c,inputShape:u}=r,d=ro(u,o.shape,i,a,l,c,!0),f=new lSe(d);return t.runWebGLProgram(f,[s,o],"float32")}const fSe={kernelName:yS,backendName:"webgl",kernelFunc:dSe};class hSe{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}function pSe(n){const{inputs:e,backend:t}=n,{x:r}=e,s=[...r.shape,...r.shape],o=Le(r.shape),i=yt({inputs:{x:r},backend:t,attrs:{shape:[o]}}),a=new hSe(o),l=t.runWebGLProgram(a,[i],i.dtype),c=yt({inputs:{x:l},backend:t,attrs:{shape:s}});return t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(l),c}const mSe={kernelName:uO,backendName:"webgl",kernelFunc:pSe};class gSe{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:r,padInfo:s,strideHeight:o,strideWidth:i,filterHeight:a,filterWidth:l,dilationHeight:c,dilationWidth:u}=e,{top:d,left:f}=s;this.userCode=`
      const ivec2 strides = ivec2(${o}, ${i});
      const ivec2 pads = ivec2(${d}, ${f});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${c};

          if (hIn >= 0 && hIn < ${t}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${u};

              if (wIn >= 0 && wIn < ${r}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}function xSe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:o}=e,{strides:i,pad:a,dilations:l}=r,c=i0(s.shape,o.shape,i,a,"NHWC",l);let u;const d=new gSe(c);u=t.runWebGLProgram(d,[s,o],"float32");const f=yt({inputs:{x:u},backend:t,attrs:{shape:c.outShape}});return t.disposeIntermediateTensorInfo(u),f}const vSe={kernelName:rb,backendName:"webgl",kernelFunc:xSe};function ySe(n){const{inputs:e,backend:t,attrs:r}=n,{equation:s}=r,o=e,{allDims:i,summedDims:a,idDims:l}=B8(s,o.length);z8(i.length,l,o);const{path:c,steps:u}=W8(a,l),d=u.length;let f=null,p=i.length;const x=[];for(let v=0;v<d;++v){for(const y of u[v]){const{permutationIndices:b,expandDims:w}=V8(p,l[y]);let S;U8(b)?S=o[y]:(S=Wo({inputs:{x:o[y]},backend:t,attrs:{perm:b}}),x.push(S));const k=S.shape.slice();for(let N=0;N<w.length;++N)k.splice(w[N],0,1);lr(S.shape,k)||(S=yt({inputs:{x:S},backend:t,attrs:{shape:k}}),x.push(S)),f===null?f=S:(f=RN({inputs:{a:S,b:f},backend:t}),x.push(f))}v<d-1&&(c[v]>=0&&(f=xw({inputs:{x:f},backend:t,attrs:{axis:c[v]-(i.length-p),keepDims:!1}}),x.push(f)),p--)}for(const v of x)v!==f&&t.disposeIntermediateTensorInfo(v);return f}const bSe={kernelName:bS,backendName:"webgl",kernelFunc:ySe};const wSe="return (x >= 0.0) ? x : (exp(x) - 1.0);",CSe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,kSe=qn({opSnippet:wSe,packedOpSnippet:CSe}),SSe={kernelName:S1,backendName:"webgl",kernelFunc:kSe};const NSe="return (b >= 0.0) ? a : a * (b + 1.0);",ESe=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,ISe=n=>{const{inputs:e,backend:t}=n,{dy:r,y:s}=e,o=De().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new cm(ESe,r.shape,s.shape):new Lf(NSe,r.shape,s.shape);return t.runWebGLProgram(o,[r,s],r.dtype)},TSe={kernelName:wS,backendName:"webgl",kernelFunc:ISe};const _Se=`
  return vec4(equal(a, b));
`,RSe="return float(a == b);",DSe=oo({opSnippet:RSe,packedOpSnippet:_Se,dtype:"bool",cpuKernelImpl:c4e}),ASe={kernelName:sb,backendName:"webgl",kernelFunc:DSe};const $Se=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${$8};
  float a1 = ${F8};
  float a2 = ${P8};
  float a3 = ${O8};
  float a4 = ${M8};
  float a5 = ${L8};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,FSe=qn({opSnippet:$Se}),PSe={kernelName:N1,backendName:"webgl",kernelFunc:FSe};const OSe=um+`
  return exp(x);
`,MSe=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Ez=qn({opSnippet:OSe,packedOpSnippet:MSe,cpuKernelImpl:u4e,dtype:"float32"}),LSe={kernelName:E1,backendName:"webgl",kernelFunc:Ez};function ck(n){const{inputs:e,attrs:t,backend:r}=n,{dim:s}=t,{input:o}=e,i=o.shape.length,a=o.shape.slice();let l=s;return s<0&&(X(-(i+1)<=s,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),l=i+s+1),a.splice(l,0,1),yt({inputs:{x:o},backend:r,attrs:{shape:a}})}const jSe={kernelName:ob,backendName:"webgl",kernelFunc:ck};const SR="return exp(x) - 1.0;",BSe=qn({opSnippet:SR,packedOpSnippet:SR,cpuKernelImpl:d4e}),VSe={kernelName:I1,backendName:"webgl",kernelFunc:BSe};class NR{constructor(e,t,r){this.variableNames=["real","imag"];const s=t[1];this.outputShape=t;const o=r?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,i=r?`${s}.0`:"1.0";let a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${o};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${s});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${s}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${i};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}function Iz(n,e,t){const r=t.texData.get(n.dataId),s=Le(n.shape),o=n.shape[n.shape.length-1],i=s/o,a=yt({inputs:{x:n},backend:t,attrs:{shape:[i,o]}}),l=a.shape,c=new NR("real",l,e),u=new NR("imag",l,e),d=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:l},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:l}],f=t.runWebGLProgram(c,d,"float32"),p=t.runWebGLProgram(u,d,"float32"),x=Id({inputs:{real:f,imag:p},backend:t});t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p);const v=yt({inputs:{x},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(x),v}function zSe(n){const{inputs:e,backend:t}=n,{input:r}=e;return Iz(r,!1,t)}const WSe={kernelName:CS,backendName:"webgl",kernelFunc:zSe};class USe{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}function I0(n){const{backend:e,attrs:t}=n,{shape:r,value:s}=t;let{dtype:o}=t;if(o=o||Xp(s),o==="string"){const i=ns(o,Le(r));return i.fill(s),e.makeTensorInfo(r,o,i)}else{const i=new USe(r,s),a=[[s]];return e.runWebGLProgram(i,[],o,a)}}const HSe={kernelName:kS,backendName:"webgl",kernelFunc:I0};class GSe{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${t} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${t}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}const qSe={kernelName:SS,backendName:"webgl",kernelFunc:({inputs:n,backend:e})=>{const{image:t}=n,r=e,s=new GSe(t.shape);return r.runWebGLProgram(s,[t],t.dtype)}};const ER="return floor(x);",KSe=qn({opSnippet:ER,packedOpSnippet:ER,cpuKernelImpl:f4e}),XSe={kernelName:T1,backendName:"webgl",kernelFunc:KSe};const YSe=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,ZSe=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,JSe=oo({opSnippet:YSe,packedOpSnippet:ZSe,dtype:"int32"}),QSe={kernelName:_1,backendName:"webgl",kernelFunc:JSe};class e8e{constructor(e){this.variableNames=["A"];const t=Uo(),[r,s]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}.0, ${r}.0);

        vec4 values = ${t.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}class t8e{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=Uo(),[r,s]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${s}.0, ${r}.0);
            vec4 values = ${t.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${t.output} = result;
      }
    `}}const n8e={kernelName:mle,backendName:"webgl",kernelFunc:r8e};let Wh,S4=De().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function r8e(n){const{inputs:e,backend:t,attrs:r}=n;let{pixels:s}=e;const{numChannels:o}=r,i=typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement,[l,c]=i?[s.videoWidth,s.videoHeight]:[s.width,s.height],u=[c,l],d=[c,l,o];if(a||i){const v=De().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(Wh==null||v!==S4)&&(S4=v,Wh=document.createElement("canvas").getContext("2d",{willReadFrequently:S4})),Wh.canvas.width=l,Wh.canvas.height=c,Wh.drawImage(s,0,0,l,c),s=Wh.canvas}const f=t.makeTensorInfo(u,"int32");t.texData.get(f.dataId).usage=Zi.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(f.dataId),s);const p=De().getBool("WEBGL_PACK")?new t8e(d):new e8e(d),x=t.runWebGLProgram(p,[f],"int32");return t.disposeData(f.dataId),x}function s8e(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:o,bias:i,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:f,activation:p,leakyreluAlpha:x}=r,v=tu(u),y=ro(s.shape,o.shape,l,d,c,f,!1,v);let b;const w=[],S=i!=null,k=a!=null,N=p==="leakyrelu",I=()=>{const F=[s,o],R=(D,A)=>{if(A==="NCHW"&&D.shape.length===1&&D.shape[0]!==1){const P=yt({inputs:{x:D},backend:t,attrs:{shape:[D.shape[0],1,1]}});return w.push(P),P}return D};if(S&&F.push(R(i,u)),k&&F.push(R(a,u)),N){const D=t.makeTensorInfo([],"float32",yd(x,"float32"));F.push(D),w.push(D)}return F};if(y.filterHeight===1&&y.filterWidth===1&&y.dilationHeight===1&&y.dilationWidth===1&&y.strideHeight===1&&y.strideWidth===1&&(y.padInfo.type==="SAME"||y.padInfo.type==="VALID"))b=wz({x:s,filter:o,convInfo:y,backend:t,bias:i,activation:p,preluActivationWeights:a,leakyreluAlpha:x});else if(y.strideWidth<=2&&v==="channelsLast"&&De().getBool("WEBGL_EXP_CONV")){const F=p?Ug(p,!0):null,R=new bz(y,S,F,k,N),D=[[y.padInfo.top,y.padInfo.left],[y.strideHeight,y.strideWidth],[y.dilationHeight,y.dilationWidth],[y.inHeight,y.inWidth]],A=I();b=t.runWebGLProgram(R,A,"float32",D)}else if(De().getBool("WEBGL_CONV_IM2COL"))b=Cz({x:s,filter:o,convInfo:y,backend:t,bias:i,activation:p,preluActivationWeights:a,leakyreluAlpha:x});else{const F=p?Ug(p,!1):null,R=new yz(y,S,F,k,N),D=I();b=t.runWebGLProgram(R,D,"float32")}const T=yt({inputs:{x:b},backend:t,attrs:{shape:y.outShape}});return w.push(b),w.forEach(F=>t.disposeIntermediateTensorInfo(F)),T}const o8e={kernelName:P2,backendName:"webgl",kernelFunc:s8e};function i8e(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,filter:o,bias:i,preluActivationWeights:a}=e,{strides:l,pad:c,dilations:u,dimRoundingMode:d,activation:f,leakyreluAlpha:p}=r,x=[];let v=u;v==null&&(v=[1,1]),X(xo(l,v),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${v}'`);const y=ro(s.shape,o.shape,l,v,c,d,!0),b=De().getBool("WEBGL_PACK_DEPTHWISECONV")&&y.strideWidth<=2&&y.outChannels/y.inChannels===1,w=f?Ug(f,b):null,S=[s,o],k=i!=null,N=a!=null,I=f==="leakyrelu";if(k&&S.push(i),N&&S.push(a),I){const D=t.makeTensorInfo([],"float32",yd(p,"float32"));S.push(D),x.push(D)}let T;b?T=new Nz(y,k,w,N,I):T=new Sz(y,k,w,N,I);const F=[[y.padInfo.top,y.padInfo.left],[y.strideHeight,y.strideWidth],[y.dilationHeight,y.dilationWidth],[y.inHeight,y.inWidth]],R=t.runWebGLProgram(T,S,"float32",F);return x.forEach(D=>t.disposeIntermediateTensorInfo(D)),R}const a8e={kernelName:_O,backendName:"webgl",kernelFunc:i8e};class l8e{constructor(e,t,r,s){this.sliceDim=e,this.strides=t,this.paramsShape=s,this.variableNames=["x","indices"],this.outputShape=r;const o=br(r.length);let i=`
    int index;`;for(let a=0;a<this.sliceDim;a++)i+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${o} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${i}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}function c8e(n){const{inputs:e,backend:t}=n,{params:r,indices:s}=e,o=s.shape,i=o[o.length-1],a=Le(r.shape),[l,c,u,d]=C8(r,s),f=yt({inputs:{x:s},backend:t,attrs:{shape:[c,i]}}),p=yt({inputs:{x:r},backend:t,attrs:{shape:[Le(r.shape)/u,u]}});if(t.shouldExecuteOnCPU([r,s])||r.dtype==="string"){const b=t.readSync(s.dataId),w=t.bufferSync(r),S=h4e(b,w,r.dtype,c,i,u,d,r.shape,a);return t.makeTensorInfo(l,r.dtype,S.values)}const x=new l8e(i,d,[c,u],r.shape),v=t.runWebGLProgram(x,[p,f],p.dtype),y=yt({inputs:{x:v},backend:t,attrs:{shape:l}});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(v),y}const u8e={kernelName:dO,backendName:"webgl",kernelFunc:c8e};class d8e{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const r=br(this.rank),s=f8e(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${s}));
      }
    `}}function f8e(n,e){const t=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let s=0;s<n.length;s++)s===2?r.push("index"):r.push(`${t[s]}`);return r.join()}function Tz(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,indices:o}=e,{axis:i,batchDims:a}=r,l=Fn(i,s.shape)[0];if(De().get("DEBUG")){const w=t.readSync(o.dataId),S=s.shape[l];for(let k=0;k<w.length;++k){const N=w[k];X(N<=S-1&&N>=0,()=>`GatherV2: the index value ${N} is not in [0, ${S-1}]`)}}const c=G8(s,o,l,a),u=Le(o.shape),d=[],f=yt({inputs:{x:s},backend:t,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),p=yt({inputs:{x:o},backend:t,attrs:{shape:[c.batchSize,u/c.batchSize]}});d.push(f),d.push(p);const x=[c.batchSize,c.outerSize,u/c.batchSize,c.sliceSize];if(t.shouldExecuteOnCPU([s,o])||s.dtype==="string"){const w=t.bufferSync(p),S=t.bufferSync(f),k=p4e(S,w,x);return d.forEach(N=>t.disposeIntermediateTensorInfo(N)),t.makeTensorInfo(c.outputShape,k.dtype,k.values)}const v=new d8e(f.shape,x),y=t.runWebGLProgram(v,[f,p],f.dtype);d.push(y);const b=yt({inputs:{x:y},backend:t,attrs:{shape:c.outputShape}});return d.forEach(w=>t.disposeIntermediateTensorInfo(w)),b}const h8e={kernelName:ab,backendName:"webgl",kernelFunc:Tz};const p8e="return float(a > b);",m8e=`
  return vec4(greaterThan(a, b));
`,g8e=oo({opSnippet:p8e,packedOpSnippet:m8e,cpuKernelImpl:m4e,dtype:"bool"}),x8e={kernelName:lb,backendName:"webgl",kernelFunc:g8e};const v8e="return float(a >= b);",y8e=`
  return vec4(greaterThanEqual(a, b));
`,b8e=oo({opSnippet:v8e,packedOpSnippet:y8e,dtype:"bool",cpuKernelImpl:g4e}),w8e={kernelName:R1,backendName:"webgl",kernelFunc:b8e};function C8e(n){const{inputs:e,backend:t}=n,{input:r}=e;return Iz(r,!0,t)}const k8e={kernelName:NS,backendName:"webgl",kernelFunc:C8e};const S8e="return float(!isnan(x) && !isinf(x));",N8e=qn({opSnippet:S8e,dtype:"bool"}),E8e={kernelName:A1,backendName:"webgl",kernelFunc:N8e};const I8e="return float(isinf(x));",T8e=qn({opSnippet:I8e,dtype:"bool"}),_8e={kernelName:$1,backendName:"webgl",kernelFunc:T8e};const R8e="return float(isnan(x));",D8e=qn({opSnippet:R8e,dtype:"bool"}),A8e={kernelName:F1,backendName:"webgl",kernelFunc:D8e};const $8e="return float(a < b);",F8e=`
  return vec4(lessThan(a, b));
`,P8e=oo({opSnippet:$8e,packedOpSnippet:F8e,cpuKernelImpl:x4e,dtype:"bool"}),O8e={kernelName:ub,backendName:"webgl",kernelFunc:P8e};const M8e="return float(a <= b);",L8e=`
  return vec4(lessThanEqual(a, b));
`,j8e=oo({opSnippet:M8e,packedOpSnippet:L8e,cpuKernelImpl:v4e,dtype:"bool"}),B8e={kernelName:db,backendName:"webgl",kernelFunc:j8e};function V8e(n){const{backend:e,attrs:t}=n,{start:r,stop:s,num:o}=t,i=y4e(r,s,o);return e.makeTensorInfo([i.length],"float32",i)}const z8e={kernelName:fO,backendName:"webgl",kernelFunc:V8e};const W8e=um+`
  return x < 0.0 ? 0./0. : log(x);
`,U8e=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,H8e=qn({opSnippet:W8e,packedOpSnippet:U8e,cpuKernelImpl:b4e}),G8e={kernelName:P1,backendName:"webgl",kernelFunc:H8e};const q8e=um+`
  return log(1.0 + x);
`,K8e=qn({opSnippet:q8e}),X8e={kernelName:O1,backendName:"webgl",kernelFunc:K8e};const Y8e="return float(a >= 1.0 && b >= 1.0);",Z8e=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,J8e=oo({opSnippet:Y8e,packedOpSnippet:Z8e,dtype:"bool"}),Q8e={kernelName:fb,backendName:"webgl",kernelFunc:J8e};const eNe="return float(!(x >= 1.0));",tNe=qn({opSnippet:eNe}),nNe={kernelName:hb,backendName:"webgl",kernelFunc:tNe};const rNe="return float(a >= 1.0 || b >= 1.0);",sNe=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,oNe=oo({opSnippet:rNe,packedOpSnippet:sNe,dtype:"bool"}),iNe={kernelName:pb,backendName:"webgl",kernelFunc:oNe};class aNe{constructor(e,t,r,s,o){this.variableNames=["x"],this.outputShape=[];const i=t,a=e[3]-1;this.outputShape=e;let l;const c=`float(${r}) + float(${s}) * sum`;o===.5?l=`inversesqrt(${c})`:o===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${o}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${i}; j <= ${i}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}}class lNe{constructor(e,t,r,s,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const i=t,a=e[3]-1;this.outputShape=e;let l;const c=`float(${r}) + float(${s}) * sum`;o===.5?l=`inversesqrt(${c})`:o===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${o}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${i};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${i}; j <= ${i}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}}const cNe=n=>{const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{depthRadius:o,bias:i,alpha:a,beta:l}=r,c=De().getBool("WEBGL_PACK_NORMALIZATION")?new lNe(s.shape,o,i,a,l):new aNe(s.shape,o,i,a,l);return t.runWebGLProgram(c,[s],s.dtype)},uNe={kernelName:mb,backendName:"webgl",kernelFunc:cNe};class dNe{constructor(e,t,r,s,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=r,this.alpha=s,this.beta=o,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${t})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${t} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${s}) * norm + float(${r});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${s})
                * float(${o})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${o});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}const fNe=n=>{const{inputs:e,backend:t,attrs:r}=n,{x:s,y:o,dy:i}=e,{depthRadius:a,bias:l,alpha:c,beta:u}=r,d=new dNe(s.shape,a,l,c,u);return t.runWebGLProgram(d,[s,o,i],s.dtype)},hNe={kernelName:IS,backendName:"webgl",kernelFunc:fNe};function pNe(n,e,t,r){const s=Le(e),i=Le(n.shape)/s,a=yt({inputs:{x:n},attrs:{shape:[i,s]},backend:r}),l=nh(a,n.dtype,"max",r),c=yt({inputs:{x:l},attrs:{shape:t},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(l),c}function _z(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{reductionIndices:o,keepDims:i}=r,a=s.shape.length,l=Fn(o,s.shape);let c=l;const u=Ur(c,a),d=u!=null,f=t.shouldExecuteOnCPU([s]);let p=s;if(d){if(f){const S=t.texData.get(p.dataId).values,k=new Array(a);for(let T=0;T<k.length;T++)k[T]=s.shape[u[T]];const N=TN(S,s.shape,s.dtype,u,k);p=t.makeTensorInfo(k,s.dtype);const I=t.texData.get(p.dataId);I.values=N}else p=gw(s,u,t);c=os(c.length,a)}so("max",c,a);const[x,v]=Ws(p.shape,c);let y=x;i&&(y=ps(x,l));let b;if(f){const S=t.texData.get(p.dataId).values,k=w4e(S,Le(v),y,s.dtype);b=t.makeTensorInfo(y,s.dtype);const N=t.texData.get(b.dataId);N.values=k}else b=pNe(p,v,y,t);return d&&t.disposeIntermediateTensorInfo(p),b}const mNe={kernelName:gb,backendName:"webgl",kernelFunc:_z};const gNe=_N+`
  return max(a, b);
`,xNe=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+th+`
  return result;
`,vNe=oo({opSnippet:gNe,packedOpSnippet:xNe,cpuKernelImpl:C4e}),yNe={kernelName:M1,backendName:"webgl",kernelFunc:vNe};function bNe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e;S0(s,"maxPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:l}=r,c=1;X(xo(i,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);const u=$a(s.shape,o,i,c,a,l);if(u.filterWidth===1&&u.filterHeight===1&&lr(u.inShape,u.outShape))return Ti({inputs:{x:s},backend:t});const d=new Hg(u,"max",!1);return t.runWebGLProgram(d,[s],s.dtype)}const wNe={kernelName:xb,backendName:"webgl",kernelFunc:bNe};function CNe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{filterSize:o,strides:i,pad:a,dataFormat:l,dimRoundingMode:c}=r,u=[1,1,1],d=eu(s.shape,o,i,u,a,c,l),f=new DN(d,"max",!1);return t.runWebGLProgram(f,[s],s.dtype)}const kNe={kernelName:vb,backendName:"webgl",kernelFunc:CNe};class SNe{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideHeight,r=e.strideWidth,s=e.dilationHeight,o=e.effectiveFilterHeight,i=e.effectiveFilterWidth,a=o-1-e.padInfo.top,l=i-1-e.padInfo.left,c=o*i-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${o};
          wR += ${s}) {
          float dyR = float(dyRCorner + wR) / ${t}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${i}; wC++) {
            float dyC = float(dyCCorner + wC) / ${r}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${c} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${i} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class NNe{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideDepth,r=e.strideHeight,s=e.strideWidth,o=e.dilationDepth,i=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterDepth,c=e.effectiveFilterHeight,u=e.effectiveFilterWidth,d=l-1-e.padInfo.front,f=c-1-e.padInfo.top,p=u-1-e.padInfo.left,x=l*c*u-1;this.userCode=`
      const ivec3 pads = ivec3(${d}, ${f}, ${p});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${o}) {
          float dyD = float(dyDCorner + wD) / ${t}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${c};
              wR += ${i}) {
            float dyR = float(dyRCorner + wR) / ${r}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${u};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${s}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${x} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${c} * ${u} +
                  wR * ${u} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}function ENe(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:o}=e,i=o,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=r,d=[1,1,1],f=eu(i.shape,a,l,d,c,u),p=new DN(f,"max",!0),x=t.runWebGLProgram(p,[i],i.dtype),v=new NNe(f),y=t.runWebGLProgram(v,[s,x],i.dtype);return t.disposeIntermediateTensorInfo(x),y}const INe={kernelName:_S,backendName:"webgl",kernelFunc:ENe};function TNe(n){const{inputs:e,backend:t,attrs:r}=n,{dy:s,input:o,output:i}=e,a=o;S0([o,i],"maxPoolGrad");const{filterSize:l,strides:c,pad:u,dimRoundingMode:d}=r,f=$a(a.shape,l,c,1,u,d),p=!0,x=new Hg(f,"max",p),v=t.runWebGLProgram(x,[a],a.dtype),y=new SNe(f),b=t.runWebGLProgram(y,[s,v],a.dtype);return t.disposeIntermediateTensorInfo(v),b}const _Ne={kernelName:TS,backendName:"webgl",kernelFunc:TNe};function RNe(n,e,t,r){let s=new Hg(t,"max",!1);const o=r.runWebGLProgram(s,[n],"float32");s=new Hg(t,"max",!0,!0,e);const i=r.runWebGLProgram(s,[n],"float32");return[o,i]}const DNe={kernelName:hO,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:r}=n,{filterSize:s,strides:o,pad:i,includeBatchInIndex:a}=e,l=t;X(r.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${r.shape.length}.`);const c=[1,1];X(xo(o,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const u=$a(r.shape,s,o,c,i),[d,f]=RNe(r,a,u,l);return[d,f]}};function ANe(n,e,t,r){const s=Le(e),i=Le(n.shape)/s,a=yt({inputs:{x:n},attrs:{shape:[i,s]},backend:r}),l=nh(a,"float32","mean",r),c=yt({inputs:{x:l},attrs:{shape:t},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(l),c}const $Ne={kernelName:yb,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:r}=n,{keepDims:s,axis:o}=e,i=t,a=r.shape.length,l=Fn(o,r.shape);let c=l;const u=Ur(c,a),d=u!=null,f=i.shouldExecuteOnCPU([r]),p=[];let x=r;if(d){if(f){const k=i.texData.get(x.dataId).values,N=new Array(a);for(let F=0;F<N.length;F++)N[F]=r.shape[u[F]];const I=TN(k,r.shape,r.dtype,u,N);x=i.makeTensorInfo(N,r.dtype);const T=i.texData.get(x.dataId);T.values=I}else x=gw(r,u,i);p.push(x),c=os(c.length,a)}so("sum",c,a);const[v,y]=Ws(x.shape,c);let b=v;s&&(b=ps(v,l));const w=ANe(x,y,b,i);for(const S of p)i.disposeIntermediateTensorInfo(S);return w}};function FNe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:o,keepDims:i}=r,a=s.shape.length,l=Fn(o,s.shape);let c=l;const u=Ur(c,a);let d=s;u!=null&&(d=Wo({inputs:{x:s},backend:t,attrs:{perm:u}}),c=os(c.length,s.shape.length)),so("min",c,a);const[f,p]=Ws(d.shape,c),x=Le(p),v=yt({inputs:{x:d},backend:t,attrs:{shape:[-1,x]}}),y=nh(v,v.dtype,"min",t);let b;if(i){const w=ps(f,l);b=yt({inputs:{x:y},backend:t,attrs:{shape:w}})}else b=yt({inputs:{x:y},backend:t,attrs:{shape:f}});return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(y),u!=null&&t.disposeIntermediateTensorInfo(d),b}const PNe={kernelName:bb,backendName:"webgl",kernelFunc:FNe};const ONe=_N+`
  return min(a, b);
`,MNe=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+th+`
  return result;
`,LNe=oo({opSnippet:ONe,packedOpSnippet:MNe,cpuKernelImpl:k4e}),jNe={kernelName:L1,backendName:"webgl",kernelFunc:LNe};class BNe{constructor(e,t,r){this.variableNames=["x"],this.outputShape=t.map((u,d)=>u[0]+e[d]+u[1]);const s=e.length,o=br(s),i=t.map(u=>u[0]).join(","),a=t.map((u,d)=>u[0]+e[d]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,s),c=r==="reflect"?0:1;if(s===1){this.userCode=`
        int start = ${i};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${c};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${c};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${o} start = ${o}(${i});
      ${o} end = ${o}(${a});

      void main() {
        ${o} outC = getOutputCoords();
        for (int i = 0; i < ${s}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${c};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${c};
          }
        }
        ${o} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}}class VNe{constructor(e,t,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((x,v)=>x[0]+e[v]+x[1]);const s=e.length,o=br(s),i=t.map(x=>x[0]).join(","),a=t.map((x,v)=>x[0]+e[v]).join(","),l=Lo("rc",s),c=Lo("source",s),u=`${l[s-1]} < ${this.outputShape[s-1]}`,d=s===1?"source":`vec2(${c.slice(-2).join()})`,f=r==="reflect"?0:1;let p="";if(s===1){const x=`
        ${o} source = rc;
        if (source < start) {
          source = start * 2 - source - ${f};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${f};
        }
        source -= start;
      `;p=`
        ${o} rc = outputLoc;
        ${x}
        result[0] = getChannel(getX(${c.join()}), ${d});
        ${l[s-1]} += 1;
        if(${u}) {
          ${x}
          result[1] = getChannel(getX(${c.join()}), ${d});
        }
      `}else{const x=`
        ${o} source = rc;
        ${o} lt = ${o}(lessThan(source, start));
        ${o} gte = ${o}(greaterThanEqual(source, end));
        ${o} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${f}) +
                gte * ((end - 1) * 2 - source + ${f});
        source -= start;
      `;p=`
        ${o} rc = outputLoc;
        ${x}
        result[0] = getChannel(getX(${c.join()}), ${d});
        ${l[s-1]} += 1;
        if(${u}) {
          ${x}
          result[1] = getChannel(getX(${c.join()}), ${d});
        }
        rc = outputLoc;
        ${l[s-2]} += 1;
        if(${l[s-2]} < ${this.outputShape[s-2]}) {
          ${x}
          result[2] = getChannel(getX(${c.join()}), ${d});
          ${l[s-1]} += 1;
          if(${u}) {
            ${x}
            result[3] = getChannel(getX(${c.join()}), ${d});
          }
        }
      `}this.userCode=`
      const ${o} start = ${o}(${i});
      const ${o} end = ${o}(${a});

      void main() {
        ${o} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${p}
        setOutput(result);
      }
    `}}const zNe=({inputs:n,backend:e,attrs:t})=>{const{x:r}=n,{paddings:s,mode:o}=t,i=De().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new VNe(r.shape,s,o):new BNe(r.shape,s,o);return e.runWebGLProgram(i,[r],r.dtype)},WNe={kernelName:wb,backendName:"webgl",kernelFunc:zNe};const UNe=`if (b == 0.0) return NAN;
  return mod(a, b);`,HNe=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+th+`
  return result;
`,GNe=oo({opSnippet:UNe,packedOpSnippet:HNe}),qNe={kernelName:j1,backendName:"webgl",kernelFunc:GNe};class KNe{constructor(e,t,r){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,r],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${t-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${t-1}));
      }
    `}}const XNe=`
if (a == b) {
  return 1.0;
};
return a / b;`,YNe=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,Rz=oo({opSnippet:XNe,packedOpSnippet:YNe,checkOutOfBounds:!0}),ZNe={kernelName:k1,backendName:"webgl",kernelFunc:Rz};const IR="return a - b;",Dz=oo({opSnippet:IR,packedOpSnippet:IR,supportsComplex:!0,cpuKernelImpl:U4e}),JNe={kernelName:t0,backendName:"webgl",kernelFunc:Dz};function Az(n){const{inputs:e,backend:t,attrs:r}=n,{logits:s}=e,{dim:o}=r,i=Fn([o],s.shape),a=_z({inputs:{x:s},backend:t,attrs:{reductionIndices:i,keepDims:!1}}),l=ps(a.shape,i),c=yt({inputs:{x:a},backend:t,attrs:{shape:l}}),u=Dz({inputs:{a:s,b:c},backend:t}),d=Ez({inputs:{x:u},backend:t}),f=xw({inputs:{x:d},backend:t,attrs:{axis:i,keepDims:!1}}),p=yt({inputs:{x:f},backend:t,attrs:{shape:l}}),x=Rz({inputs:{a:d,b:p},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),x}const QNe={kernelName:jb,backendName:"webgl",kernelFunc:Az};function e7e(n){const{inputs:e,backend:t,attrs:r}=n,{logits:s}=e,{numSamples:o,seed:i,normalized:a}=r,l=a?s:Az({inputs:{logits:s},backend:t,attrs:{dim:s.shape.length-1}}),c=l.shape[0],u=l.shape[1],d=new KNe(c,u,o),f=[[i]],p=t.runWebGLProgram(d,[l],"int32",f);return a||t.disposeIntermediateTensorInfo(l),p}const t7e={kernelName:pO,backendName:"webgl",kernelFunc:e7e};const n7e=Pa+`
  return -x;
`,r7e=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function s7e(n){const{inputs:e,backend:t}=n,{x:r}=e;if(t.shouldExecuteOnCPU([r])){const o=t.texData.get(r.dataId),[i,a]=N4e(o.values,r.shape,r.dtype);return t.makeTensorInfo(a,r.dtype,i)}let s;return De().getBool("WEBGL_PACK_UNARY_OPERATIONS")?s=new qu(r.shape,r7e):s=new ql(r.shape,n7e),t.runWebGLProgram(s,[r],r.dtype)}const o7e={kernelName:Cb,backendName:"webgl",kernelFunc:s7e};const i7e=x8;function a7e(n){Gi("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:r}=n,{boxes:s,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l}=r,c=t.readSync(s.dataId),u=t.readSync(o.dataId),{selectedIndices:d}=i7e(c,u,i,a,l);return t.makeTensorInfo([d.length],"int32",new Int32Array(d))}const l7e={kernelName:RS,backendName:"webgl",kernelFunc:a7e};const c7e=v8;function u7e(n){Gi("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:r}=n,{boxes:s,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=r,u=t.readSync(s.dataId),d=t.readSync(o.dataId),{selectedIndices:f,validOutputs:p}=c7e(u,d,i,a,l,c);return[t.makeTensorInfo([f.length],"int32",new Int32Array(f)),t.makeTensorInfo([],"int32",new Int32Array([p]))]}const d7e={kernelName:DS,backendName:"webgl",kernelFunc:u7e};const f7e=y8;function h7e(n){Gi("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:r}=n,{boxes:s,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=r,u=t.readSync(s.dataId),d=t.readSync(o.dataId),f=i,p=a,x=l,v=c,{selectedIndices:y,selectedScores:b}=f7e(u,d,f,p,x,v);return[t.makeTensorInfo([y.length],"int32",new Int32Array(y)),t.makeTensorInfo([b.length],"float32",new Float32Array(b))]}const p7e={kernelName:AS,backendName:"webgl",kernelFunc:h7e};class m7e{constructor(e,t,r,s){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${s}), float(${r}),
                      float(index == coords.y)));
      }
    `}}const g7e=n=>{const{inputs:e,backend:t,attrs:r}=n,{indices:s}=e,{dtype:o,depth:i,onValue:a,offValue:l}=r,c=Le(s.shape),u=new m7e(c,i,a,l),d=yt({inputs:{x:s},backend:t,attrs:{shape:[c]}}),f=t.runWebGLProgram(u,[d],o);t.disposeIntermediateTensorInfo(d);const p=[...s.shape,i],x=yt({inputs:{x:f},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(f),x},x7e={kernelName:Nb,backendName:"webgl",kernelFunc:g7e};function iy(n){const{inputs:e,backend:t}=n,{x:r}=e;if(r.dtype==="complex64"){const s=E0({inputs:{input:r},backend:t}),o=iy({inputs:{x:s},backend:t}),i=vw({inputs:{input:r},backend:t}),a=iy({inputs:{x:i},backend:t}),l=Id({inputs:{real:o,imag:a},backend:t});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(a),l}else return I0({attrs:{shape:r.shape,dtype:r.dtype,value:r.dtype==="string"?"":0},backend:t})}const v7e={kernelName:zb,backendName:"webgl",kernelFunc:iy};function $z(n){const{inputs:e,backend:t}=n,{x:r}=e;if(r.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(r.dtype==="complex64"){const s=E0({inputs:{input:r},backend:t}),o=$z({inputs:{x:s},backend:t}),i=vw({inputs:{input:r},backend:t}),a=iy({inputs:{x:i},backend:t}),l=Id({inputs:{real:o,imag:a},backend:t});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(a),l}else return I0({attrs:{shape:r.shape,dtype:r.dtype,value:1},backend:t})}const y7e={kernelName:Sb,backendName:"webgl",kernelFunc:$z};function b7e(n){const{inputs:e,backend:t,attrs:r}=n,{axis:s}=r;if(e.length===1)return ck({inputs:{input:e[0]},backend:t,attrs:{dim:s}});const o=e[0].shape,i=e[0].dtype;e.forEach(u=>{Q6(o,u.shape,"All tensors passed to stack must have matching shapes"),X(i===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(u=>{const d=ck({inputs:{input:u},backend:t,attrs:{dim:s}});return a.push(d),d}),c=vz({inputs:l,backend:t,attrs:{axis:s}});return a.forEach(u=>t.disposeIntermediateTensorInfo(u)),c}const w7e={kernelName:Eb,backendName:"webgl",kernelFunc:b7e};class C7e{constructor(e,t,r){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((c,u)=>c[0]+e[u]+c[1]);const s=e.length,o=br(s),i=t.map(c=>c[0]).join(","),a=t.map((c,u)=>c[0]+e[u]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,s);if(s===1){this.userCode=`
        int start = ${i};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${o} start = ${o}(${i});
      ${o} end = ${o}(${a});

      void main() {
        ${o} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${o} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}}class k7e{constructor(e,t,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((v,y)=>v[0]+e[y]+v[1]);const s=e.length,o=br(s),i=t.map(v=>v[0]).join(","),a=t.map((v,y)=>v[0]+e[y]).join(","),l=Lo("rc",s),c=Lo("source",s),u=`${l[s-1]} < ${this.outputShape[s-1]}`,d=s===1?"source":`vec2(${c.slice(-2).join()})`,f=[`${o} rc = outputLoc;`,`${l[s-1]} += 1;
       if(${u}) {
      `,s===1?"":`}
       rc = outputLoc;
       ${l[s-2]} += 1;
       if(${l[s-2]} < ${this.outputShape[s-2]}) {`,s===1?"":`  ${l[s-1]} += 1;
         if(${u}) {`],p=s===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let x="";for(let v=0,y=s===1?2:4;v<y;v++)x+=`
        ${f[v]}
        if (${p}) {
          result[${v}] = float(value);
        } else {
          ${o} source = rc - start;
          result[${v}] = getChannel(getX(${c.join()}), ${d});
        }
      `;x+=s===1?"} ":"}}",this.userCode=`
      const ${o} start = ${o}(${i});
      const ${o} end = ${o}(${a});

      void main() {
        ${o} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${x}
        setOutput(result);
      }
    `}}const Fz=n=>{const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{paddings:o,constantValue:i}=r;if(Le(s.shape)===0){const c=o.map((u,d)=>u[0]+s.shape[d]+u[1]);return I0({backend:t,attrs:{shape:c,value:i,dtype:s.dtype}})}const a=De().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new k7e(s.shape,o,i):new C7e(s.shape,o,i),l=[[i]];return t.runWebGLProgram(a,[s],s.dtype,l)},S7e={kernelName:Ib,backendName:"webgl",kernelFunc:Fz};const N7e=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,E7e=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+th+`
  return result;
`,I7e=oo({opSnippet:N7e,packedOpSnippet:E7e}),T7e={kernelName:V1,backendName:"webgl",kernelFunc:I7e};function _7e(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{axis:o,keepDims:i}=r,a=s.shape.length,l=[],c=Fn(o,s.shape);let u=c;const d=Ur(u,a);let f=s;d!=null&&(f=Wo({inputs:{x:s},backend:t,attrs:{perm:d}}),u=os(u.length,a),l.push(f)),so("prod",u,a);let p;if(t.shouldExecuteOnCPU([f])){const x=t.texData.get(f.dataId).values,{outVals:v,outShape:y,outDtype:b}=I4e(f.shape,f.dtype,x,u);p=t.makeTensorInfo(y,b,v)}else{const[x,v]=Ws(f.shape,u),y=Le(v),b=yt({inputs:{x:f},backend:t,attrs:{shape:[-1,y]}}),w=US(s.dtype),S=nh(b,w,"prod",t);p=yt({inputs:{x:S},backend:t,attrs:{shape:x}}),l.push(b),l.push(S)}if(i){l.push(p);const x=ps(p.shape,c);p=yt({inputs:{x:p},backend:t,attrs:{shape:x}})}return l.forEach(x=>t.disposeIntermediateTensorInfo(x)),p}const R7e={kernelName:_b,backendName:"webgl",kernelFunc:_7e};function D7e(n){const{inputs:e,backend:t,attrs:r}=n,{paramsNestedSplits:s,paramsDenseValues:o,indices:i}=e,{outputRaggedRank:a}=r,l=s.map(b=>t.readSync(b.dataId)),c=s.map(b=>b.shape),u=t.readSync(o.dataId),d=t.readSync(i.dataId),[f,p,x]=T4e(l,c,u,o.shape,o.dtype,d,i.shape,a),v=f.map(b=>t.makeTensorInfo([b.length],"int32",b)),y=t.makeTensorInfo(x,o.dtype,p);return v.concat([y])}const A7e={kernelName:mO,backendName:"webgl",kernelFunc:D7e};function $7e(n){const{inputs:e,backend:t}=n,{starts:r,limits:s,deltas:o}=e,i=t.readSync(r.dataId),a=t.readSync(s.dataId),l=t.readSync(o.dataId),[c,u]=_4e(i,r.shape,r.dtype,a,s.shape,l,o.shape),d=t.makeTensorInfo([c.length],"int32",c),f=t.makeTensorInfo([u.length],r.dtype,u);return[d,f]}const F7e={kernelName:gO,backendName:"webgl",kernelFunc:$7e};function P7e(n){const{inputs:e,backend:t,attrs:r}=n,{shape:s,values:o,defaultValue:i,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=r,c=t.readSync(s.dataId),u=t.readSync(o.dataId),d=t.readSync(i.dataId),f=a.map(y=>t.readSync(y.dataId)),p=a.map(y=>y.shape),[x,v]=R4e(c,s.shape,u,o.shape,o.dtype,d,i.shape,f,p,l);return t.makeTensorInfo(x,o.dtype,v)}const O7e={kernelName:xO,backendName:"webgl",kernelFunc:P7e};const Pz=n=>{const{backend:e,attrs:t}=n,{start:r,stop:s,step:o,dtype:i}=t,a=D4e(r,s,o,i);return e.makeTensorInfo([a.length],i,a)},M7e={kernelName:$S,backendName:"webgl",kernelFunc:Pz};const L7e="return 1.0 / x;",j7e=qn({opSnippet:L7e}),B7e={kernelName:z1,backendName:"webgl",kernelFunc:j7e};const V7e=Pa+`
  return (x < 0.0) ? 0.0 : x;
`,z7e=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,W7e=qn({opSnippet:V7e,packedOpSnippet:z7e}),U7e={kernelName:W1,backendName:"webgl",kernelFunc:W7e};const H7e=Pa+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,G7e=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,q7e=qn({opSnippet:H7e,packedOpSnippet:G7e}),K7e={kernelName:U1,backendName:"webgl",kernelFunc:q7e};class X7e{constructor(e,t,r,s,o){this.variableNames=["A"],this.outputShape=[];const[i,a,l,c]=e;this.outputShape=[i,t,r,c];const u=[s&&t>1?a-1:a,s&&r>1?l-1:l],d=[s&&t>1?t-1:t,s&&r>1?r-1:r];let f;o?f="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":f="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/d[0]},
          ${u[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${f};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}class Y7e{constructor(e,t,r,s,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,a,l,c]=e;this.outputShape=[i,t,r,c];const u=[s&&t>1?a-1:a,s&&r>1?l-1:l],d=[s&&t>1?t-1:t,s&&r>1?r-1:r];let f;o?f="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":f="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/d[0]},
          ${u[1]/d[1]},
          ${u[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${f};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${r-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}function Z7e(n){const{inputs:e,backend:t,attrs:r}=n,{images:s}=e,{alignCorners:o,halfPixelCenters:i,size:a}=r,[l,c]=a,u=De().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Y7e(s.shape,l,c,o,i):new X7e(s.shape,l,c,o,i);return t.runWebGLProgram(u,[s],"float32")}const J7e={kernelName:Ab,backendName:"webgl",kernelFunc:Z7e};class Q7e{constructor(e,t,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,s,o]=t,[,i,a]=e,l=[r&&i>1?s-1:s,r&&a>1?o-1:o],c=[r&&i>1?i-1:i,r&&a>1?a-1:a],u=l[0]/c[0],d=l[1]/c[1],f=1/u,p=1/d,x=Math.ceil(f)*2+2,v=Math.ceil(p)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${d});

        const float invHeightScale = float(${f});
        const float invWidthScale = float(${p});

        const int winHeight = int(${x});
        const int winWidth = int(${v});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${s-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${o-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}function eEe(n){const{inputs:e,backend:t,attrs:r}=n,{images:s,dy:o}=e,{alignCorners:i}=r,a=new Q7e(o.shape,s.shape,i);return t.runWebGLProgram(a,[o],o.dtype)}const tEe={kernelName:OS,backendName:"webgl",kernelFunc:eEe};class nEe{constructor(e,t,r,s,o){this.variableNames=["A"],this.outputShape=[];const[i,a,l,c]=e;this.outputShape=[i,t,r,c];const u=[s&&t>1?a-1:a,s&&r>1?l-1:l],d=[s&&t>1?t-1:t,s&&r>1?r-1:r],f=s?"0.5":"0.0";let p;o?p="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/d[0]},
          ${u[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${p};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}class rEe{constructor(e,t,r,s,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,a,l,c]=e;this.outputShape=[i,t,r,c];const u=[s&&t>1?a-1:a,s&&r>1?l-1:l],d=[s&&t>1?t-1:t,s&&r>1?r-1:r],f=s?"0.5":"0.0";let p;o?p="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/d[0]},
          ${u[1]/d[1]},
          ${u[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${p};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${r-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}function sEe(n){const{inputs:e,backend:t,attrs:r}=n,{images:s}=e,{alignCorners:o,halfPixelCenters:i,size:a}=r,[l,c]=a,u=De().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new rEe(s.shape,l,c,o,i):new nEe(s.shape,l,c,o,i);return t.runWebGLProgram(u,[s],s.dtype)}const oEe={kernelName:Db,backendName:"webgl",kernelFunc:sEe};class iEe{constructor(e,t,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,s,o]=t,[,i,a]=e,l=[r&&i>1?s-1:s,r&&a>1?o-1:o],c=[r&&i>1?i-1:i,r&&a>1?a-1:a],u=l[0]/c[0],d=l[1]/c[1],f=1/u,p=1/d,x=Math.ceil(f)*2+2,v=Math.ceil(p)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${d});

        const float invHeightScale = float(${f});
        const float invWidthScale = float(${p});

        const int winHeight = int(${x});
        const int winWidth = int(${v});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${c[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${c[1]}));

            int sourceNearestRow = int(min(
                float(int(${s}) - 1),
                ${r} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${o}) - 1),
                ${r} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}function aEe(n){const{inputs:e,backend:t,attrs:r}=n,{images:s,dy:o}=e,{alignCorners:i}=r,a=new iEe(o.shape,s.shape,i);return t.runWebGLProgram(a,[o],o.dtype)}const lEe={kernelName:PS,backendName:"webgl",kernelFunc:aEe};class cEe{constructor(e,t){this.variableNames=["x"];const r=e.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);if(this.outputShape=e,r===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const s=a=>t.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,o=e.map((a,l)=>s(l)).join(","),i=br(r);this.userCode=`
      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${o}));
      }
    `}}class uEe{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const r=e.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);this.outputShape=e;const s=Lo("rc",r),o=`${s[r-1]} + 1 < ${this.outputShape[r-1]}`,i=`${s[r-2]} + 1 < ${this.outputShape[r-2]}`,a=br(r);r===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${o}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(s.slice())};
          if(${o}){
            result.g = ${c(s.slice())};
          }
          if(${i}) {
            result.b = ${u(s.slice())};
            if(${o}) {
              result.a = ${d(s.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(x){return f(x)}function c(x){return x[r-1]="("+x[r-1]+" + 1)",f(x)}function u(x){return x[r-2]="("+x[r-2]+" + 1)",f(x)}function d(x){return x[r-1]="("+x[r-1]+" + 1)",x[r-2]="("+x[r-2]+" + 1)",f(x)}function f(x){const v=e.map((w,S)=>p(S,x)),y=v.join(","),b=v.slice(-2).join(",");return`getChannel(getX(${y}), vec2(${b}))`}function p(x,v){return t.indexOf(x)!==-1&&e[x]!==1?`${e[x]} - ${v[x]} - 1`:`${v[x]}`}}}function dEe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{dims:o}=r,i=s.shape.length,a=Fn(o,s.shape);if(i===0)return Ti({inputs:{x:s},backend:t});const l=De().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new uEe(s.shape,a):new cEe(s.shape,a);return t.runWebGLProgram(l,[s],s.dtype)}const fEe={kernelName:$b,backendName:"webgl",kernelFunc:dEe};class hEe{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const r=e[1],s=e[2];this.outputShape=e;let o="";typeof t=="number"?o=`float outputValue = ${t.toFixed(2)};`:o=`
        vec3 fill = vec3(${t.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${o}
          if(coordX >= 0 && coordX < ${s} && coordY >= 0 && coordY < ${r}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}const pEe={kernelName:WS,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:r}=n,{radians:s,fillValue:o,center:i}=e,a=t,l=new hEe(r.shape,o),[c,u]=R8(i,r.shape[1],r.shape[2]),d=[[c,u,Math.sin(s),Math.cos(s)]];return a.runWebGLProgram(l,[r],r.dtype,d)}};const mEe=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,gEe=qn({opSnippet:mEe}),xEe={kernelName:H1,backendName:"webgl",kernelFunc:gEe};const vEe="return inversesqrt(x);",yEe=qn({opSnippet:vEe,cpuKernelImpl:A4e}),bEe={kernelName:G1,backendName:"webgl",kernelFunc:yEe};class AN{constructor(e,t,r,s,o,i,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;const c=br(o.length),u=br(i.length);let d="";r===1?d="i":r===2&&(d="i, j");const f=`getIndices(${d})`;let p="";s===1?p="i":s===2&&(p="i, coords[1]");const x=`getUpdates(${p})`;let v="";l&&(v="coords[0], coords[1]");const y=`getDefaultValue(${v})`,b=t>1?"strides[j]":"strides";this.userCode=`
        ${c} strides = ${c}(${o});

        void main() {
          ${u} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${t}; j++) {
              int index = round(${f});
              flattenedIndex += index * ${b};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${x};
              found = true;
            }
          }
          setOutput(mix(${y}, sum, float(found)));
        }
      `}}class wEe{constructor(e,t,r,s,o,i,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=i;const c=br(o.length),u=br(i.length);let d="";r===1?d="i":r===2&&(d="i, j");const f=`getIndices(${d})`;let p="";s===1?p="i":s===2&&(p="i, coords[1]");const x=`getUpdates(${p})`;let v="";l&&(v="coords[0], coords[1]");const y=`getDefaultValue(${v})`,b=t>1?"strides[j]":"strides",w=t>1?"strides[j + 1]":"strides";this.userCode=`
        ${c} strides = ${c}(${o});

        void main() {
          ${u} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${t}; j+=2) {
              ivec4 index = round(${f});
              flattenedIndex += index.xz * ${b};
              if (j + 1 < ${t}) {
                flattenedIndex += index.yw * ${w};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${x};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${y}, sum, found));
        }
      `}}function CEe(n){const{inputs:e,backend:t,attrs:r}=n,{indices:s,updates:o}=e,{shape:i}=r,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=Yf(o,s,i),f=[d/c,c];if(d===0)return t.makeTensorInfo(i,s.dtype);const p=yt({inputs:{x:s},backend:t,attrs:{shape:[l,a]}}),x=yt({inputs:{x:o},backend:t,attrs:{shape:[l,c]}}),v=t.makeTensorInfo([],"float32",new Float32Array([0]));let y;De().getBool("WEBGL_PACK")?y=new wEe(l,a,p.shape.length,x.shape.length,u,f):y=new AN(l,a,p.shape.length,x.shape.length,u,f);const b=t.runWebGLProgram(y,[x,p,v],x.dtype),w=yt({inputs:{x:b},backend:t,attrs:{shape:i}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(v),w}const kEe={kernelName:vO,backendName:"webgl",kernelFunc:CEe};class SEe{constructor(e,t,r,s){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,r];const o="while (left < right) {",i=`for (int i = 0; i < ${Math.ceil(Math.log2(t+1))}; ++i) { if (left >= right) break;`,a=De().getNumber("WEBGL_VERSION")===2?o:i,l=s==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}function NEe(n){const{inputs:e,backend:t,attrs:r}=n,{sortedSequence:s,values:o}=e,{side:i}=r,a=new SEe(s.shape[0],s.shape[1],o.shape[1],i),l=[[s.shape[1]]];return t.runWebGLProgram(a,[s,o],"int32",l)}const EEe={kernelName:bO,backendName:"webgl",kernelFunc:NEe};class IEe{constructor(e,t,r){this.variableNames=["c","a","b"],this.outputShape=t;let s,o;if(r>4)throw Error(`Where for rank ${r} is not yet supported`);if(r===1)o="resRC",s="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],c=[];for(let u=0;u<t.length;u++)c.push(`${a[u]}`),u<e&&l.push(`${a[u]}`);s=l.join(),o=c.join()}const i=br(r);this.userCode=`
      void main() {
        ${i} resRC = getOutputCoords();
        float cVal = getC(${s});
        if (cVal >= 1.0) {
          setOutput(getA(${o}));
        } else {
          setOutput(getB(${o}));
        }
      }
    `}}function TEe(n){const{inputs:e,backend:t}=n,{condition:r,t:s,e:o}=e,i=new IEe(r.shape.length,s.shape,s.shape.length);return t.runWebGLProgram(i,[r,s,o],Ei(s.dtype,o.dtype))}const _Ee={kernelName:Fb,backendName:"webgl",kernelFunc:TEe};const REe=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${ew};
  float scale = ${tw};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,DEe=qn({opSnippet:REe}),AEe={kernelName:q1,backendName:"webgl",kernelFunc:DEe};const $Ee=um+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,FEe=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,PEe=qn({opSnippet:$Ee,packedOpSnippet:FEe,cpuKernelImpl:F4e}),OEe={kernelName:Z1,backendName:"webgl",kernelFunc:PEe};const MEe=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,LEe=qn({opSnippet:MEe}),jEe={kernelName:Y1,backendName:"webgl",kernelFunc:LEe};const BEe=um+`
  return sin(x);
`,VEe=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${th}
  return result;
`,zEe=qn({opSnippet:BEe,packedOpSnippet:VEe}),WEe={kernelName:K1,backendName:"webgl",kernelFunc:zEe};const UEe=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,HEe=qn({opSnippet:UEe}),GEe={kernelName:X1,backendName:"webgl",kernelFunc:HEe};const qEe=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,KEe=qn({opSnippet:qEe}),XEe={kernelName:J1,backendName:"webgl",kernelFunc:KEe};const YEe=n=>{const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{blockShape:o,paddings:i}=r;X(s.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=o.reduce((b,w)=>b*w),l=[[0,0]];l.push(...i);for(let b=1+o.length;b<s.shape.length;++b)l.push([0,0]);const c=[],u=Fz({inputs:{x:s},backend:t,attrs:{paddings:l,constantValue:0}}),d=d0(u.shape,o,a,!1),f=f0(d.length,o.length,!1),p=h0(u.shape,o,a,!1),x=yt({inputs:{x:u},backend:t,attrs:{shape:d}}),v=Wo({inputs:{x},backend:t,attrs:{perm:f}}),y=yt({inputs:{x:v},backend:t,attrs:{shape:p}});return c.push(u),c.push(x),c.push(v),c.forEach(b=>t.disposeIntermediateTensorInfo(b)),y},ZEe={kernelName:Mb,backendName:"webgl",kernelFunc:YEe};function JEe(n){const{inputs:e,backend:t}=n,{indices:r,values:s,denseShape:o,defaultValue:i}=e;if(o.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${o.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${r.shape}`);if(s.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${s.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);const a=t.readSync(r.dataId),l=t.readSync(s.dataId),c=t.readSync(o.dataId),u=t.readSync(i.dataId)[0],[d,f,p,x,v]=O4e(a,r.shape,r.dtype,l,s.dtype,c,u);return[t.makeTensorInfo(f,r.dtype,d),t.makeTensorInfo([f[0]],s.dtype,p),t.makeTensorInfo([x.length],"bool",new Uint8Array(x.map(y=>Number(y)))),t.makeTensorInfo([v.length],r.dtype,new Int32Array(v))]}const QEe={kernelName:wO,backendName:"webgl",kernelFunc:JEe};function eIe(n){const{inputs:e,backend:t}=n,{inputIndices:r,inputShape:s,newShape:o}=e;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${r.shape}`);if(s.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${s.shape}`);if(o.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const i=Array.from(t.readSync(s.dataId)),a=t.readSync(r.dataId),l=Array.from(t.readSync(o.dataId)),[c,u,d]=M4e(a,r.shape,r.dtype,i,l);return[t.makeTensorInfo(u,r.dtype,c),t.makeTensorInfo([d.length],o.dtype,new Int32Array(d))]}const tIe={kernelName:CO,backendName:"webgl",kernelFunc:eIe};function nIe(n){const{inputs:e,backend:t}=n,{data:r,indices:s,segmentIds:o}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(s.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${s.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${o.shape}`);const i=t.readSync(r.dataId),a=t.readSync(s.dataId),l=t.readSync(o.dataId),[c,u]=oz(i,r.shape,r.dtype,a,l,!0);return t.makeTensorInfo(u,r.dtype,c)}const rIe={kernelName:kO,backendName:"webgl",kernelFunc:nIe};function sIe(n){const{inputs:e,backend:t}=n,{data:r,indices:s,segmentIds:o}=e;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(s.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${s.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${o.shape}`);const i=t.readSync(r.dataId),a=t.readSync(s.dataId),l=t.readSync(o.dataId),[c,u]=oz(i,r.shape,r.dtype,a,l);return t.makeTensorInfo(u,r.dtype,c)}const oIe={kernelName:SO,backendName:"webgl",kernelFunc:sIe};function iIe(n){const{inputs:e,backend:t,attrs:r}=n,{sparseIndices:s,sparseValues:o,defaultValue:i}=e,{outputShape:a}=r,{sliceRank:l,numUpdates:c,sliceSize:u,strides:d,outputSize:f}=Yf(o,s,a),p=!1;if(o.dtype==="string"){const b=t.bufferSync(s),w=t.bufferSync(o),S=ld(t.readSync(i.dataId)[0]),k=$4e(b,w,a,f,u,c,l,d,S,p);return t.makeTensorInfo(a,k.dtype,k.values)}const x=new AN(c,l,s.shape.length,o.shape.length,d,[f,1],p),v=t.runWebGLProgram(x,[o,s,i],o.dtype),y=yt({inputs:{x:v},backend:t,attrs:{shape:a}});return t.disposeIntermediateTensorInfo(v),y}const aIe={kernelName:NO,backendName:"webgl",kernelFunc:iIe};function lIe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{numOrSizeSplits:o,axis:i}=r,a=Fn(i,s.shape)[0],l=H8(s,o,a),c=s.shape.length,u=new Array(c).fill(0),d=s.shape.slice();return l.map(f=>{const p=[...d];p[a]=f;const x=dm({inputs:{x:s},backend:t,attrs:{begin:u,size:p}});return u[a]+=f,x})}const cIe={kernelName:Lb,backendName:"webgl",kernelFunc:lIe};const TR="return sqrt(x);",uIe=qn({opSnippet:TR,packedOpSnippet:TR,cpuKernelImpl:L4e}),dIe={kernelName:Q1,backendName:"webgl",kernelFunc:uIe};const fIe="return x * x;",hIe=qn({opSnippet:fIe}),pIe={kernelName:MS,backendName:"webgl",kernelFunc:hIe};const _R="return (a - b) * (a - b);",mIe=oo({opSnippet:_R,packedOpSnippet:_R}),gIe={kernelName:e0,backendName:"webgl",kernelFunc:mIe};function xIe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e;if(s.dtype!=="string")throw new Error("Input must be of datatype string");const o=t.readSync(s.dataId),i=Gc(o),a=j4e(i,"string",r);return t.makeTensorInfo(s.shape,"string",a)}const vIe={kernelName:LS,backendName:"webgl",kernelFunc:xIe};function yIe({inputs:n,attrs:e,backend:t}){const{x:r}=n,s=Pa+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,o=new ql(r.shape,s);return t.runWebGLProgram(o,[r],r.dtype)}const bIe={kernelName:o0,backendName:"webgl",kernelFunc:yIe};class wIe{constructor(e,t,r){this.variableNames=["x"],this.outputShape=r;const s=r.length,o=br(r.length),i=br(r.length);let a="";if(s===1)a="coords * strides + begin";else{let l=0;a=r.map((c,u)=>(l++,r.length===1?`coords * strides[${u}] + begin[${u}]`:`coords[${l-1}] * strides[${u}] + begin[${u}]`)).join(",")}this.userCode=`
      ${o} begin = ${o}(${e});
      ${o} strides = ${o}(${t});

      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}function CIe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{begin:o,end:i,strides:a,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:d,shrinkAxisMask:f}=r,{finalShapeSparse:p,finalShape:x,isIdentity:v,sliceDim0:y,isSimpleSlice:b,begin:w,end:S,strides:k}=I8(s.shape,o,i,a,l,c,u,d,f);let N;if(v)N=yt({inputs:{x:s},backend:t,attrs:{shape:x}});else if(y||b){X(s.shape.length>=1,()=>`Input must have rank at least 1, got: ${s.shape.length}`);const T=S8(w,S,k),F=dm({inputs:{x:s},backend:t,attrs:{begin:w,size:T}});N=yt({inputs:{x:F},backend:t,attrs:{shape:x}}),t.disposeIntermediateTensorInfo(F)}else if(t.shouldExecuteOnCPU([s])){const F=t.readSync(s.dataId),R=$n(s.shape,s.dtype,F),D=B4e(p,R,k,w);N=t.makeTensorInfo(x,s.dtype,D.values)}else{const F=new wIe(w,k,p);N=t.runWebGLProgram(F,[s],s.dtype)}const I=yt({inputs:{x:N},backend:t,attrs:{shape:x}});return t.disposeIntermediateTensorInfo(N),I}const kIe={kernelName:jS,backendName:"webgl",kernelFunc:CIe};function SIe(n){const{inputs:e,backend:t,attrs:r}=n,{separator:s,nGramWidths:o,leftPad:i,rightPad:a,padWidth:l,preserveShortSequences:c}=r,{data:u,dataSplits:d}=e,f=t.readSync(u.dataId),p=t.readSync(d.dataId),[x,v]=V4e(f,p,s,o,i,a,l,c);return[t.makeTensorInfo([x.length],"string",x),t.makeTensorInfo(d.shape,"int32",v)]}const NIe={kernelName:EO,backendName:"webgl",kernelFunc:SIe};function EIe(n){const{inputs:e,backend:t,attrs:r}=n,{skipEmpty:s}=r,{input:o,delimiter:i}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(o.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);const a=t.readSync(o.dataId),l=t.readSync(i.dataId)[0],[c,u,d]=z4e(a,l,s),f=u.length;return[t.makeTensorInfo([f,2],"int32",c),t.makeTensorInfo([f],"string",u),t.makeTensorInfo([2],"int32",new Int32Array(d))]}const IIe={kernelName:IO,backendName:"webgl",kernelFunc:EIe};function TIe(n){const{inputs:e,backend:t,attrs:r}=n,{numBuckets:s}=r,{input:o}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(s<=0)throw new Error("Number of buckets must be at least 1");const i=t.readSync(o.dataId),a=W4e(i,s);return t.makeTensorInfo(o.shape,"int32",a)}const _Ie={kernelName:TO,backendName:"webgl",kernelFunc:TIe};const RIe="return tan(x);",DIe=qn({opSnippet:RIe}),AIe={kernelName:n0,backendName:"webgl",kernelFunc:DIe};const $Ie=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,FIe=qn({opSnippet:$Ie}),PIe={kernelName:r0,backendName:"webgl",kernelFunc:FIe};function OIe(n){const{inputs:e,backend:t,attrs:r}=n,{tensor:s,indices:o,updates:i}=e,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=Yf(i,o,s.shape),f=[d/c,c];if(d===0)return t.makeTensorInfo(s.shape,o.dtype);const p=yt({inputs:{x:o},backend:t,attrs:{shape:[l,a]}}),x=yt({inputs:{x:i},backend:t,attrs:{shape:[l,c]}}),v=yt({inputs:{x:s},backend:t,attrs:{shape:f}}),y=new AN(l,a,p.shape.length,x.shape.length,u,f,!1,!0),b=t.runWebGLProgram(y,[x,p,v],v.dtype),w=yt({inputs:{x:b},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(b),w}const MIe={kernelName:yO,backendName:"webgl",kernelFunc:OIe};class LIe{constructor(e,t){this.variableNames=["A"];const r=new Array(e.length);for(let i=0;i<r.length;i++)r[i]=e[i]*t[i];this.outputShape=r,this.rank=r.length;const s=br(this.rank),o=jIe(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        setOutput(getA(${o}));
      }
    `}}function jIe(n){const e=n.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${n[0]})`;const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let s=0;s<n.length;s++)r.push(`imod(${t[s]}, ${n[s]})`);return r.join()}function Oz(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{reps:o}=r;if(s.dtype==="string"||s.shape.length>5){const l=t.readSync(s.dataId),c=s.dtype==="string"?l.map(f=>ld(f)):l,u=$n(s.shape,s.dtype,c),d=H4e(u,o);return t.makeTensorInfo(d.shape,d.dtype,d.values)}const i=new LIe(s.shape,o);return t.runWebGLProgram(i,[s],s.dtype)}const BIe={kernelName:s0,backendName:"webgl",kernelFunc:Oz};class VIe{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class zIe{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}function Jd(n,e){e!==null&&n.disposeIntermediateTensorInfo(e)}function RR(n){let e=1;for(;e<n;)e*=2;return e}function WIe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s}=e,{k:o,sorted:i}=r,a=De().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=De().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=s.shape,u=c[c.length-1];if(t.shouldExecuteOnCPU([s])||u<a||o>l){const D=t.readSync(s.dataId),[A,P]=G4e(D,c,s.dtype,o,i);return[t.makeTensorInfo(A.shape,A.dtype,A.values),t.makeTensorInfo(P.shape,P.dtype,P.values)]}if(o===0)return c[c.length-1]=0,[t.makeTensorInfo(c,s.dtype,[]),t.makeTensorInfo(c,"int32",[])];if(u===1)return[s,I0({attrs:{shape:c,dtype:"int32",value:0},backend:t})];const d=t.texData.get(s.dataId),f=d!==null&&d.isPacked,p=f?t.unpackTensor(s):s,v=Le(c)/u,y=yt({inputs:{x:p},attrs:{shape:[v,u]},backend:t});f&&Jd(t,p);const b=RR(o),w=RR(u);let S=null;const k=()=>S===null?[y,y]:[y,S],N=(D,A,P)=>{const B=k(),L=new VIe(P),H=[[u],[S===null?1:0],[Number.NEGATIVE_INFINITY],[D],[A]],G=S;S=t.runWebGLProgram(L,B,"int32",H),Jd(t,G)};for(let D=1;D<b;D*=2){const A=D*2;for(let P=D;P>=1;P/=2)N(A,P,[v,w])}for(let D=w;D>b;D/=2){const A=k(),P=new zIe([v,D/2]),L=[[u],[S===null?1:0],[b]],W=S;S=t.runWebGLProgram(P,A,"int32",L),Jd(t,W);const H=b/2,G=H*2;for(let M=H;M>=1;M/=2)N(G,M,S.shape)}let I=S;S=dm({inputs:{x:S},backend:t,attrs:{begin:0,size:[v,o]}}),Jd(t,I);let T=Tz({inputs:{x:y,indices:S},backend:t,attrs:{axis:1,batchDims:1}});Jd(t,y);const F=c.slice(0,-1);F.push(o),I=S,S=yt({inputs:{x:S},attrs:{shape:F},backend:t}),Jd(t,I);const R=T;return T=yt({inputs:{x:T},attrs:{shape:F},backend:t}),Jd(t,R),[T,S]}const UIe={kernelName:BS,backendName:"webgl",kernelFunc:WIe};class HIe{constructor(e,t,r,s,o,i){this.variableNames=["Image","Transforms"],this.outputShape=i;const a=r==="nearest"?1:2;let l;switch(s){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${t}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${o});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${o});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${t}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}function GIe(n){const{inputs:e,backend:t,attrs:r}=n,{image:s,transforms:o}=e,{interpolation:i,fillMode:a,fillValue:l,outputShape:c}=r,[u,d,f,p]=s.shape,[x,v]=c??[d,f],y=[u,x,v,p],b=new HIe(d,f,i,a,l,y);return t.runWebGLProgram(b,[s,o],"float32")}const qIe={kernelName:VS,backendName:"webgl",kernelFunc:GIe};function KIe(n){const{inputs:e,attrs:t,backend:r}=n,{axis:s}=t,{x:o}=e;S0(o,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const i=r.readSync(o.dataId),{outputValues:a,outputShape:l,indices:c}=q4e(i,s,o.shape,o.dtype);return[r.makeTensorInfo(l,o.dtype,a),r.makeTensorInfo([c.length],"int32",c)]}const XIe={kernelName:zS,backendName:"webgl",kernelFunc:KIe};function YIe(n){const{inputs:e,backend:t,attrs:r}=n,{value:s}=e;let{axis:o}=r;o<0&&(o+=s.shape.length);const i=s,a=i.shape.length,l=s.shape[o],c=new Array(a-1);let u=0;for(let v=0;v<a;v++)v!==o&&(c[u++]=i.shape[v]);const d=[],f=new Array(a).fill(0),p=i.shape.slice();p[o]=1;const x=new Array(l);for(let v=0;v<x.length;v++){f[o]=v;const y=dm({inputs:{x:i},backend:t,attrs:{begin:f,size:p}}),b=yt({inputs:{x:y},backend:t,attrs:{shape:c}});x[v]=b,d.push(y)}return d.forEach(v=>t.disposeIntermediateTensorInfo(v)),x}const ZIe={kernelName:Bb,backendName:"webgl",kernelFunc:YIe};class JIe{constructor(e,t){this.variableNames=["x","segmentIds"];const r=e.windowSize,s=e.batchSize,o=e.inSize,i=e.numSegments,a=i*Math.ceil(o/r);this.outputShape=[s,a];const l="0.0",c="sumValue",u=Math.floor(r/4)*4,d=r%4,f=`
        sumValue += dot(values, segFilter);
    `;let p="";o%r>0&&(p=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return initializationValue;
        }
      `);let x="";o%r>0&&(x=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${p}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${x}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${i})) * float(${r}));
        int currentSeg = int(mod(float(outIdx), float(${i})));

        float sumValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${f}
        }

        int inIdx = inOffset + ${u};
        if (${d===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${f}
        } else if (${d===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${f}
        } else if (${d===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${f}
        }
        setOutput(${c});
      }
    `}}function QIe(n){const{inputs:e,backend:t,attrs:r}=n,{x:s,segmentIds:o}=e,{numSegments:i}=r,a=s.shape.length,l=[];let c=0;const u=Ur([c],a);let d=s;u!=null&&(d=Wo({inputs:{x:s},backend:t,attrs:{perm:u}}),l.push(d),c=os(1,a)[0]);const f=xL(d.shape,c,i),p=Le([d.shape[c]]),x=yt({inputs:{x:d},backend:t,attrs:{shape:[-1,p]}});l.push(x);const v=US(s.dtype),y=(k,N,I,T,F)=>{const R=k.shape[0],D=k.shape[1],A=gL(D,F),P={windowSize:A,inSize:D,batchSize:R,numSegments:F},B=new JIe(P,N),L=t.compileAndRun(B,[k,I],T);if(l.push(L),L.shape[1]===F)return L;const W=Pz({backend:t,attrs:{start:0,stop:F,step:1,dtype:"float32"}}),H=Oz({inputs:{x:W},backend:t,attrs:{reps:[D/A]}});return l.push(W),l.push(H),y(L,N,H,T,F)},b=y(x,"unsortedSegmentSum",o,v,i),w=yt({inputs:{x:b},backend:t,attrs:{shape:f}});let S=w;if(u!=null){l.push(w);const k=wd(u);S=Wo({inputs:{x:S},backend:t,attrs:{perm:k}})}return l.forEach(k=>t.disposeIntermediateTensorInfo(k)),S}const e9e={kernelName:Vb,backendName:"webgl",kernelFunc:QIe};const t9e=[L5e,B5e,W5e,G5e,K5e,Z5e,Q5e,tke,oke,ake,uke,hke,gke,bke,kke,Nke,Ike,Dke,$ke,Pke,jke,Gke,Kke,Jke,e6e,i6e,l6e,f6e,w5e,m6e,b6e,S6e,R6e,$6e,P6e,M6e,j6e,W6e,G6e,X6e,Z6e,Q6e,tSe,sSe,iSe,uSe,fSe,mSe,vSe,bSe,SSe,TSe,ASe,PSe,LSe,jSe,VSe,WSe,HSe,qSe,XSe,QSe,n8e,o8e,a8e,u8e,h8e,x8e,w8e,b5e,k8e,v6e,E8e,_8e,A8e,k5e,O8e,B8e,z8e,G8e,X8e,Q8e,nNe,iNe,uNe,hNe,mNe,yNe,wNe,kNe,INe,_Ne,DNe,$Ne,PNe,jNe,WNe,qNe,t7e,E5e,o7e,l7e,d7e,p7e,n6e,x7e,y7e,w7e,S7e,T7e,N5e,R7e,A7e,F7e,O7e,M7e,r6e,ZNe,B7e,U7e,K7e,T5e,J7e,tEe,oEe,lEe,fEe,pEe,xEe,bEe,kEe,EEe,_Ee,AEe,OEe,jEe,WEe,GEe,Uke,QNe,XEe,ZEe,QEe,tIe,rIe,oIe,aIe,cIe,dIe,pIe,gIe,vIe,bIe,kIe,NIe,IIe,_Ie,JNe,P5e,AIe,PIe,MIe,BIe,UIe,qIe,O5e,XIe,ZIe,e9e,v7e];for(const n of t9e)RO(n);function Qm(){return window.__opencvLoad||(window.__opencvLoad={startedAt:null,injected:!1,initialized:!1,ready:!1,timedOut:!1,error:null}),window.__opencvLoad}let N4=null;async function n9e(n={}){return window.cv&&window.cv.Mat?window.cv:(N4||(N4=new Promise(async(e,t)=>{try{const r=Qm();r.startedAt=Date.now();const s=Date.now(),o=n.timeoutMs||2e4,i=()=>{if(window.__cvReady&&window.cv&&window.cv.Mat){const a=Qm();return a.initialized=!0,a.ready=!0,e(window.cv)}if(window.cv&&window.cv.Mat){const a=Qm();return a.ready=!0,e(window.cv)}if(Date.now()-s>o){const a=Qm();return a.timedOut=!0,t(new Error("Timed out waiting for OpenCV initialization"))}setTimeout(i,200)};setTimeout(i,200)}catch(r){const s=Qm();s.error=r&&(r.message||String(r)),t(r)}})),N4)}async function r9e(){try{return await n9e(),!0}catch(n){return console.error("OpenCV failed to load:",n),!1}}function Mz({userId:n,onStepComplete:e}){const[t,r]=_.useState(!1),[s,o]=_.useState(!1),[i,a]=_.useState(""),[l,c]=_.useState(""),[u,d]=_.useState(""),[f,p]=_.useState(""),[x,v]=_.useState(""),[y,b]=_.useState(""),[w,S]=_.useState(""),[k,N]=_.useState(""),[I,T]=_.useState(!1),[F,R]=_.useState(""),[D,A]=_.useState(!1),[P,B]=_.useState(null),[L,W]=_.useState(!1),[H,G]=_.useState(!1),[M,j]=_.useState(!1),[z,V]=_.useState(!1),[K,J]=_.useState(0),[oe,Z]=_.useState(0),[de,pe]=_.useState(0),[Ce,Ae]=_.useState([]),[ze,et]=_.useState(0),[gt,dt]=_.useState(!1),[Ct,lt]=_.useState(!1),[bt,rn]=_.useState(""),[Ft,vn]=_.useState(!1),[te,q]=_.useState(),[ke,He]=_.useState(!1),[Ke,Be]=_.useState(""),[ct,Nt]=_.useState(0),[Rt,sn]=_.useState([3,4,3]),[Kn,Ee]=_.useState(null),[Ge,Q]=_.useState(0),[ht,it]=_.useState(0),[Yt,cn]=_.useState(0),[Lt,On]=_.useState(null),[An,Jn]=_.useState(!0),[nr,gr]=_.useState({}),[_i,xt]=_.useState({}),[In,_n]=_.useState({}),[xr,cr]=_.useState({}),[kr,fr]=_.useState({}),[bn,Sr]=_.useState({log:(he,re)=>console.log(`[${he}]`,re)}),[ls,ia]=_.useState(!1),[Nr,Te]=_.useState(null),[Re,we]=_.useState(null),[qe,Xe]=_.useState(null),[wt,pt]=_.useState(!1),[Ut,Tt]=_.useState("forward"),[qt,ve]=_.useState(!1),ae=_.useRef(null),ce=_.useRef(null),Pe=_.useRef(null),Ie=_.useRef(null),Ye=_.useRef(null),vt=_.useRef(void 0),jt=_.useRef(null),tt=_.useRef(null),Kt=_.useRef(null),Vn=_.useRef(null),Nn=_.useRef({cx:0,cy:0,rOuter:0,rInner:0,w:0,h:0}),vr=_.useRef(0),Un=_.useRef(null),Wn=_.useRef(100),ur=_.useRef(0),rh=_.useRef(0),yw=_.useRef(0),ru=_.useRef(null),su=_.useRef(null),Oa=_.useRef([]),io=_.useRef(0);_.useRef([]);const Ma=_.useRef({}),vl=_.useRef([]),Td=_.useRef(null),_d=_.useRef({});_.useRef({});const Ri=_.useRef({}),yc=_.useRef({}),ou=_.useRef({}),fm=_.useRef({});_.useRef({});const rr=_.useRef({}),Us=_.useRef(0);_.useRef(!0);const sh=_.useRef(!1),Rd=_.useRef(!1),aa=_.useRef(!1),hm=_.useRef(null),oh=_.useRef({}),la=_.useRef(!1),Dd=_.useRef(!1);_.useRef(0);const Di=_.useRef(null),ii=_.useRef(!1),_r=_.useRef(0),yl=_.useRef(0),bc=_.useRef(0),Hs=_.useRef(!1),wc=_.useRef(!1),Ai=_.useRef(0),bl=_.useRef(0),Ad=_.useRef(0),Ho=_.useRef(!1),wl=_.useRef(!1),pm=_.useRef(!1),La=_.useRef(!1),$i=_.useRef(!1),Fi=_.useRef(!1),Cl=_.useRef(!1),$d=_.useRef({}),iu=_.useRef(!1),Fd=_.useRef(!1);_.useRef(void 0),_.useRef(void 0);const au=_.useRef(null),wr=_.useRef({log:(he,re)=>console.log(`[${he}]`,re)}),ih=1,mm=6,Gs=3,lu=10,Pd=2,T0=5,Od=3,ah=3,_0=767,bo=4500;_.useEffect(()=>{let he=!1;return(async()=>{try{gm(),console.log("Setting TensorFlow.js backend to webgl..."),await Wle("webgl"),await Ule(),console.log("TensorFlow backend:",Hle()),console.log("Loading face-api models..."),await Promise.all([Bo.tinyFaceDetector.loadFromUri("/assets/weights"),Bo.faceLandmark68Net.loadFromUri("/assets/weights"),Bo.faceRecognitionNet.loadFromUri("/assets/weights"),Bo.faceExpressionNet.loadFromUri("/assets/weights")]),console.log(" FaceAPI models loaded"),console.log("Loading OpenCV.js...");try{await r9e(),he||j(!0),console.log(" OpenCV.js ready")}catch(Je){console.error("Failed to load OpenCV.js",Je)}console.log("Starting camera..."),await bw()}catch(Je){if(console.error("Camera initialization failed:",Je),he)return;Je?.name==="NotAllowedError"?d(" Camera permission denied. Please allow access and refresh."):Je?.name==="NotFoundError"?d(" No camera found on this device."):d(" Failed to access the camera. Try again."),r(!1)}})(),()=>{he=!0,jt.current!==null&&(cancelAnimationFrame(jt.current),jt.current=null),tt.current&&(clearInterval(tt.current),tt.current=null),Ie.current&&(Ie.current.getTracks().forEach(Je=>Je.stop()),Ie.current=null)}},[]);const an=_.useCallback((he,re,Je=!1,rt=2e3,_t=1e3)=>{(!he||!["statusMessage","dashedCircleAlignMessage","cameraErrorMessage","brightnessMessage","ovalAlignMessage","distanceMessage","recordingMessage","verificationMessage","mobileStatusMessage","headTurnAttemptStatus"].includes(he))&&(console.warn(` Unknown or empty message key provided: ${he}. Falling back to 'statusMessage'.`),he="statusMessage");let We;try{typeof re=="string"?We=re:re==null?We="":typeof re=="object"?We=JSON.stringify(re):We=String(re)}catch{We=String(re)}if(oh.current[he])return;const Ot={statusMessage:()=>i,dashedCircleAlignMessage:()=>l,cameraErrorMessage:()=>u,brightnessMessage:()=>f,ovalAlignMessage:()=>x,distanceMessage:()=>y,recordingMessage:()=>w,verificationMessage:()=>k,mobileStatusMessage:()=>F,headTurnAttemptStatus:()=>bt};if((Ot[he]?.()??"")===We)return;const pn={statusMessage:a,dashedCircleAlignMessage:c,cameraErrorMessage:d,brightnessMessage:p,ovalAlignMessage:v,distanceMessage:b,recordingMessage:S,verificationMessage:N,mobileStatusMessage:R,headTurnAttemptStatus:rn};L?(R(We),pn[he]?.("")):(pn[he]?.(We),R("")),Je&&setTimeout(()=>{(Ot[he]?.()??"")===We&&(pn[he]?.(""),L&&F===We&&R(""),oh.current[he]=!0,setTimeout(()=>{oh.current[he]=!1},_t))},rt)},[L,i,l,u,f,x,y,w,k,F,bt]);function gm(){if(typeof window>"u")return!1;const he=window.innerWidth<=_0;return W(he),he}const cu=_.useCallback(()=>{const he=Math.floor(Math.random()*2)+2,re=Math.floor(Math.random()*3)+2,Je=Math.max(lu-(he+re),1);sn([he,re,Je]),console.log(` Segment durations: [${he}s, ${re}s, ${Je}s] = ${he+re+Je}s total`)},[lu]),R0=_.useCallback(he=>!Ie.current||!ae.current?(console.log("info","Camera off or video element missing; stopping detection loop."),!1):!0,[]),ja=_.useCallback(he=>{jt.current=requestAnimationFrame(he)},[]),lh=_.useCallback(he=>Nn.current?!0:(console.log("info","Oval guide not initialized yet; scheduling next frame."),ja(he),!1),[ja]),uu=_.useCallback(()=>{if(!Un.current)return 0;const he=Pe.current.width,re=Pe.current.height;Un.current.drawImage(ae.current,0,0,he,re);const Je=Un.current.getImageData(0,0,he,re).data;let rt=0;const _t=Je.length/4;for(let mt=0;mt<Je.length;mt+=4){const We=Je[mt],Ot=Je[mt+1],un=Je[mt+2];rt+=.2126*We+.7152*Ot+.0722*un}return rt/_t},[]),Pi=_.useCallback(he=>{const re=ce.current.getContext("2d"),Je=ce.current.width,rt=ce.current.height;re.clearRect(0,0,Je,rt);const _t=Je/2,mt=rt/2,We=Math.min(Je,rt)*.35,Ot=We*1.2;he<60?re.fillStyle="white":he>180?re.fillStyle="black":re.fillStyle="rgba(0, 0, 0, 1)",re.fillRect(0,0,Je,rt),re.globalCompositeOperation="destination-out",re.beginPath(),re.arc(_t,mt,Ot,0,2*Math.PI),re.fill(),re.globalCompositeOperation="source-over";const un="#ffffff";if(re.beginPath(),re.arc(_t,mt,Ot,0,2*Math.PI),re.setLineDash([]),re.lineWidth=10,re.strokeStyle=un,re.stroke(),Ad.current>0){const pn=Ad.current/100*2*Math.PI;re.beginPath(),re.arc(_t,mt,Ot,-Math.PI/2,-Math.PI/2+pn),re.setLineDash([]),re.lineWidth=10,re.strokeStyle="#16a34a",re.stroke()}if(re.beginPath(),re.arc(_t,mt,We,0,2*Math.PI),re.setLineDash([8,6]),re.lineWidth=3,re.strokeStyle="#ffffff",re.stroke(),Di.current&&ii.current){re.beginPath(),re.lineWidth=12,re.strokeStyle="rgba(0, 191, 255, 1)",re.shadowColor="rgba(0, 191, 255, 0.7)",re.shadowBlur=20,re.setLineDash([8,6]);const pn=We;let Xn,Zr;switch(Di.current){case"left":Xn=-Math.PI*.5,Zr=Math.PI*.5;break;case"right":Xn=Math.PI*.5,Zr=Math.PI*1.5;break;case"down":Xn=0,Zr=Math.PI;break;case"up":Xn=Math.PI,Zr=Math.PI*2;break;case"forward":Xn=0,Zr=Math.PI*2;break;default:Xn=0,Zr=0;break}re.arc(_t,mt,pn,Xn,Zr),re.stroke(),re.shadowBlur=0,re.setLineDash([])}if(re.font="18px Arial",re.fillStyle="#ffffffff",re.textAlign="center",re.fillText("Align your face within the white circles",_t,mt+Ot+20),z){yw.current++;const pn=-Math.PI/2,Xn=pn+2*Math.PI*vr.current;re.beginPath(),re.arc(_t,mt,We,pn,Xn),re.strokeStyle="#16a34a",re.lineWidth=4,re.stroke()}Nn.current={cx:_t,cy:mt,rOuter:We,rInner:We*.7,w:We*2,h:We*2}},[z,s,ze]),xm=_.useCallback(he=>{const re=Math.max(0,Math.min(100,he));re>Ad.current&&(Ad.current=re,et(re),ce.current&&Pi(Wn.current||100))},[Pi]),D0=_.useCallback(()=>{if(!Un.current)return!0;Un.current.drawImage(ae.current,0,0,Pe.current.width,Pe.current.height);const he=Un.current.getImageData(0,0,Pe.current.width,Pe.current.height).data;let re=0;const Je=30;for(let _t=0;_t<he.length;_t+=4){const mt=he[_t],We=he[_t+1],Ot=he[_t+2];mt<Je&&We<Je&&Ot<Je&&re++}return re/(he.length/4)>.95},[]),ch=_.useCallback(async()=>{if(!Vn.current)return console.log("info","[FaceCheck] No reference descriptor; skipping check."),!1;try{if(!ae.current)return!1;const he=await pv(ae.current,new tg).withFaceLandmarks().withFaceDescriptor();if(he&&he.descriptor){const re=eO(Vn.current,he.descriptor);if(console.log("info",`[FaceCheck] distance=${re.toFixed(3)}, counter=${io.current}`),re>.6){if(io.current++,console.log("warn",`[FaceCheck] Mismatch counter incremented: ${io.current}`),an("verificationMessage"," Possible different face detected"),io.current>=ah){if(console.log("error",`[FaceCheck]  Different face confirmed (${io.current} checks)`),io.current=0,Fd.current=!0,Ye.current&&Ye.current.state==="recording")try{Ye.current.pause()}catch{}return!0}}else if(io.current>0&&console.log("info","[FaceCheck] Face match restored, counter reset."),io.current=0,Fd.current&&(Fd.current=!1,Ye.current&&Ye.current.state==="paused"&&!iu.current&&Hs.current))try{Ye.current.resume()}catch{}}else console.log("warn","[FaceCheck]  No face detected (null detection)"),io.current=0}catch(he){console.log("error",`[FaceCheck]  Error during face detection: ${he}`),io.current=0}return!1},[an]),du=he=>{const Je=["up","down","left","right","forward"].filter(rt=>!he.includes(rt));return Je[Math.floor(Math.random()*Je.length)]},Md=_.useCallback(he=>{Di.current=he,ii.current=!0,Kt.current&&clearInterval(Kt.current),Kt.current=setInterval(()=>{ii.current=!ii.current,Pi(Wn.current||100)},500)},[Pi]),uh=_.useCallback(()=>{Kt.current&&(clearInterval(Kt.current),Kt.current=null),Di.current=null,ii.current=!1,Pi(Wn.current||100)},[Pi]),A0=_.useCallback(he=>new Promise(re=>{try{const Je=[];let rt=null,_t=!1,mt=!1;try{if(!Ie.current){wr.current.log("error","[HeadVerification] No stream available"),re(!1);return}rt=new MediaRecorder(Ie.current,{mimeType:"video/webm;codecs=vp9"})}catch(Qn){wr.current.log("error",`[HeadVerification] Failed to create MediaRecorder: ${Qn}`),re(!1);return}rt.ondataavailable=Qn=>{Qn.data&&Qn.data.size>0&&Je.push(Qn.data)},rt.onstop=()=>{const Qn=new Blob(Je,{type:"video/webm"});Ee(Qn),_t?(N(" Head movement verified  downloading..."),wr.current.log("info","[HeadVerification]  Recording complete. Starting download."),an("headTurnAttemptStatus"," Head movement verified  downloading..."),re(!0)):(wr.current.log("info","[HeadVerification]  Recording complete. No verification."),re(!1))};const We=.35,Ot=.38,un=.12,pn=We*.2,Xn=.27,Zr=.2;wr.current.log("info",`[HeadVerification] Started. Direction: ${he}, YawThreshold: ${We}, PitchThreshold: ${Ot}`),an("headTurnAttemptStatus",`[HeadVerification] Started. Direction: ${he}, YawThreshold: ${We}, PitchThreshold: ${Ot}`),Md(he);try{if(au.current){const Qn=au.current.getContext("2d");Qn&&Qn.clearRect(0,0,au.current.width,au.current.height)}}catch(Qn){wr.current.log("warn",`[HeadVerification] Could not clear overlay canvas: ${Qn}`)}const _s=Qn=>{const qs=Qn.getLeftEye(),ao=Qn.getRightEye(),Go=Qn.getNose()[3],fa=qs[0],Jr=ao[3],li=Math.max(1,Jr.x-fa.x),ha=(fa.x+Jr.x)/2;return(Go.x-ha)/li},ai=Qn=>{const qs=Qn.getLeftEye(),ao=Qn.getRightEye(),Go=Qn.getNose(),fa=Qn.getJawOutline(),Jr={x:(qs[0].x+qs[3].x)/2,y:(qs[1].y+qs[5].y)/2},li={x:(ao[0].x+ao[3].x)/2,y:(ao[1].y+ao[5].y)/2},ha=(Jr.y+li.y)/2,fh=Go[3],Mi=fa[8],Nl=Math.max(1,Mi.y-ha);return(fh.y-ha)/Nl};let ca=null,ua=null;const da=.06,Sl=.05,Ba=-.05,mu=setInterval(async()=>{try{const Qn=ae.current;if(!Qn||!Nn.current)return;const qs=await pv(Qn,new tg).withFaceLandmarks();if(!qs||!qs.landmarks){wr.current.log("warn","[HeadVerification] No face detected in current frame");return}const ao=qs.landmarks,Go=qs.detection.box;if(ca===null||ua===null){ca=_s(ao),ua=ai(ao),wr.current.log("info",`[HeadVerification] Baseline yaw=${ca.toFixed(3)} pitch=${ua.toFixed(3)}`);return}const fa=Go.x+Go.width/2,Jr=Go.y+Go.height/2,li=fa-Nn.current.cx,ha=Jr-Nn.current.cy;if(Math.sqrt(li*li+ha*ha)>Nn.current.rOuter){mt&&rt&&rt.state!=="inactive"&&(wr.current.log("info","[HeadVerification] User moved outside oval, stopping recording."),rt.stop(),mt=!1);return}let Mi=!1;const Nl=_s(ao),hh=ai(ao),gu=Nl-ca,El=hh-ua;if(wr.current.log("info",`[HeadVerification] Yaw=${gu.toFixed(3)} Pitch=${El.toFixed(3)}`),he==="forward"){const Co=Math.abs(gu)<.03&&Math.abs(El)<.03;mt||(rt?.start(),mt=!0,an("headTurnAttemptStatus","Capturing face  keep looking STRAIGHT")),Co?(Mi=!0,_t=!0,N(" Face captured (STRAIGHT).")):N(" Keep your face STRAIGHT and STILL")}else if(he==="left"||he==="right"){const Co=he==="left"&&gu<-da||he==="right"&&gu>da;!mt&&Math.abs(gu)>da/2&&(rt?.start(),mt=!0,an("headTurnAttemptStatus",`Capturing head turn (${he.toUpperCase()})`)),mt&&Math.abs(gu)<da/3&&(rt?.stop(),mt=!1),Co?(Mi=!0,_t=!0,N(` ${he.toUpperCase()} movement detected.`)):N(`${he==="left"?"":""} Keep turning your head ${he.toUpperCase()}.`)}else if(he==="down"||he==="up"){const Co=he==="down"&&El>Sl||he==="up"&&El<Ba;!mt&&(he==="down"&&El>Sl/2||he==="up"&&El<Ba/2)&&(rt?.start(),mt=!0,an("headTurnAttemptStatus",`Capturing head movement (${he.toUpperCase()})`)),mt&&(he==="down"&&El<Sl/3||he==="up"&&El>Ba/3)&&(rt?.stop(),mt=!1),Co?(Mi=!0,_t=!0,N(` ${he.toUpperCase()} movement detected.`)):N(`${he==="down"?"":""} Keep moving your head ${he.toUpperCase()}.`)}if(Mi){_t=!0,He(!0),uh(),clearInterval(mu),ve(!0),rt&&rt.state!=="inactive"&&rt.stop(),N(` VERIFIED direction (${he.toUpperCase()})!`),an("statusMessage",` VERIFIED direction (${he.toUpperCase()})!`);const Co=ae.current;Co?(Co.classList.add("selfie-glow-green"),console.log("[HeadVerification]  Added glow-green class to video"),setTimeout(()=>{Co.classList.remove("selfie-glow-green"),console.log("[HeadVerification] Removed glow-green class from video")},3e3)):console.warn("[HeadVerification]  Could not find video element for glow effect")}}catch(Qn){wr.current.log("error",`[HeadVerification] Sampler error: ${Qn}`)}},150);setTimeout(()=>{try{clearInterval(mu),uh(),_t||(mt&&rt&&rt.state!=="inactive"&&rt.stop(),He(!1),pt(!0),N(` Head movement (${he.toUpperCase()}) timed out. Please try again.`),wr.current.log("error",`[HeadVerification]  TIMEOUT after ${bo}ms. Direction: ${he} not verified in time.`),re(!1))}catch(Qn){wr.current.log("error",`[HeadVerification] Timeout cleanup failed: ${Qn}`),re(!1)}},bo)}catch(Je){wr.current.log("error",`[HeadVerification] Unexpected error in verification: ${Je}`),re(!1)}}),[an,Md,uh,Ee,N,He,ve,pt]),$0=_.useCallback(async he=>{try{if(Ho.current)return wr.current.log("info","[HeadVerification] Ignored after session completion"),null;Tt(he),rn(""),vn(!0),$i.current=!0,Ee(null),He(!1);const re=he==="forward"?"Recording face  keep looking STRAIGHT into the camera...":`Recording head movement (${he.toUpperCase()})  keep your face in this direction...`;N(re),an("headTurnAttemptStatus",re),await new Promise(rt=>setTimeout(rt,100));const Je=await A0(he);return await new Promise(rt=>setTimeout(rt,3e3)),vn(!1),$i.current=!1,Je}catch(re){return wr.current.log("error",`[HeadVerification] Unexpected error: ${re}`),N(" Unexpected error during verification."),vn(!1),$i.current=!1,!1}},[t,an,A0]),fu=_.useCallback(()=>{J(1),_r.current=1,pe(0),Ai.current=0,V(!1),wc.current=!1,Ae([]),Us.current=0,Ad.current=0,et(0),gr({}),Ri.current={},xt({}),fm.current={},it(0),ou.current={},yc.current={},io.current=0,ia(!1),Te(null),we(null),Xe(null),bc.current=0,La.current=!1,Fi.current=!1,aa.current=!1,$i.current=!1,Us.current=0},[]),hu=_.useCallback(async()=>{const he=_r.current;console.log("info","[HeadVerification] performVerificationForCurrentSegment called for segment",he),lt(!0),Fi.current=!0;let re;if(La.current){wr.current.log("info","Head verification already in progress; skipping new request.");return}La.current=!0,yc.current[he]=!0;const Je=$d.current[he];if(Je?(re=Je,he===1?Te(re):he===2?we(re):Xe(re)):he===1?(re="forward",Te(re)):he===2?(re=du([Nr]),we(re)):(re=du([Nr,Re]),Xe(re)),q(re),an("headTurnAttemptStatus",`Please ${re==="left"?"turn your head LEFT and KEEP it there":re==="right"?"turn your head RIGHT and KEEP it there":re==="up"?"tilt your head UP and KEEP it there":re==="down"?"tilt your head DOWN and KEEP it there":"look STRAIGHT into the camera and KEEP your face still"}`),Ho.current){wr.current.log("info","Head verification prompt suppressed after session completion."),La.current=!1;return}if(wr.current.log("info",`Prompting user to ${re}`),Lt&&Lt.state==="recording"&&Lt.pause(),console.log("info","[HeadVerification] Checking stream readiness. streamRef.current=",!!Ie.current),!Ie.current){const We=ae.current;We&&We.srcObject instanceof MediaStream&&(Ie.current=We.srcObject,console.log("info","[HeadVerification] Recovered stream from video element  proceeding"))}if(!Ie.current){console.log("warn","[HeadVerification] Deferring  stream not ready (post-recovery)"),La.current=!1,lt(!1),Fi.current=!0,setTimeout(()=>{console.log("info","[HeadVerification] Re-attempting after deferral..."),Ho.current||hu()},1200);return}console.log("info","[HeadVerification] Stream ready, proceeding to create headMediaRecorder. Stream has",Ie.current.getTracks().length,"tracks");let rt;if(MediaRecorder.isTypeSupported("video/webm;codecs=vp9"))rt={mimeType:"video/webm;codecs=vp9"};else if(MediaRecorder.isTypeSupported("video/webm"))rt={mimeType:"video/webm"};else if(MediaRecorder.isTypeSupported("video/mp4"))rt={mimeType:"video/mp4",videoBitsPerSecond:1e5};else{wr.current.log("error","No supported MIME type found for MediaRecorder on this browser."),an("statusMessage"," MediaRecorder MIME type not supported.");return}if(vl.current=[],cn(0),!Ie.current){an("statusMessage"," Camera stream not ready for head verification.");return}const _t=new MediaRecorder(Ie.current,rt);vt.current=_t,_t.ondataavailable=We=>{We.data&&We.data.size>0&&(vl.current.push(We.data),cn(Ot=>Ot+1))},_t.onstop=()=>{if(Ho.current){wr.current.log("info","Head verification stop ignored after session completion.");return}const We=Math.min(vl.current.length,3),Ot=vl.current.slice(-We),un=new Blob(Ot,{type:rt?.mimeType??"video/webm"});Td.current=un,vl.current=[],cn(0)},_t.start(1e3);const mt=await $0(re);if((_t.state==="recording"||_t.state==="paused")&&_t.stop(),lt(!1),mt===!0){const We=_r.current;if(gr(un=>({...un,[We]:!0})),ou.current[We]=!0,Ri.current[We]=!0,xm(We===2?80:40),console.log("info",`[HeadVerification]  SUCCESS for segment ${We}. verificationDoneForSegmentRef is now:`,Ri.current),it(0),xt(un=>({...un,[We]:0})),an("headTurnAttemptStatus",` Head turn verified for segment ${We}.`),(We===1||We===2)&&!rr.current[We])try{let un=Td.current;if(!un){const pn=Math.min(vl.current.length,3),Xn=vl.current.slice(-pn);un=Xn.length?new Blob(Xn,{type:"video/webm"}):null}if(un){const pn=document.createElement("a");pn.style.display="none",pn.href=URL.createObjectURL(un),pn.download=`head${We}.webm`,document.body.appendChild(pn),pn.click(),setTimeout(()=>{URL.revokeObjectURL(pn.href),document.body.removeChild(pn)},100),rr.current[We]=!0,console.log("info",`[HeadVerification] Downloaded head${We}.webm`)}else console.warn("[HeadVerification] No head blob available to download after success")}catch(un){console.warn("[HeadVerification] Failed to download head video after success:",un)}finally{Td.current=null}if(!Ho.current){const un=Ai.current,pn=Rt[We-1];console.log("info",`[HeadVerification] Resuming segment ${We} from ${un}s (target: ${pn}s)`),console.log("info","   This will trigger immediate completion and move to next segment"),Us.current=1,setTimeout(()=>Oi(Ai.current),600)}Fi.current=!1}else if(mt===!1){const We=_r.current;it(un=>un+1);const Ot=ht+1;xt(un=>({...un,[We]:Ot})),an("headTurnAttemptStatus",` Head turn failed attempt ${Ot}. Please try again.`),Ot>=Pd?(ou.current[We]=!1,Ri.current[We]=!0,We===1?(pt(!0),an("headTurnAttemptStatus",` Verification 1 failed ${Ot} times. Restarting all segments.`),fu(),setTimeout(()=>Oi(0),1e3)):We===2?(pt(!0),an("headTurnAttemptStatus"," Verification 2 failed. Will trigger verification 3 after final video."),ia(!0),setTimeout(()=>Oi(Ai.current),600)):(pt(!0),an("headTurnAttemptStatus"," Verification 3 failed. Restarting all."),Ri.current[We]=!0,fu(),setTimeout(()=>Oi(0),1e3))):setTimeout(()=>hu(),1500)}else wr.current.log("info","[HeadVerification] Deferred; will retry when camera active"),setTimeout(()=>{t&&!Ho.current&&hu()},1500);La.current=!1},[K,Nr,Re,Lt,z,ht,Pd,de,Rt,lt,Te,we,Xe,q,cn,_n,gr,it,xt,pt,ia,an,wr,vl,du,$0,fu,t]),vm=_.useCallback(()=>{if(console.log("info","[Camera] Stopping camera and cleaning up..."),jt.current!==null&&(cancelAnimationFrame(jt.current),jt.current=null,console.log("info","[Camera] Cancelled animation frame")),tt.current&&(clearInterval(tt.current),tt.current=null,console.log("info","[Camera] Cleared timer interval")),Kt.current&&(clearInterval(Kt.current),Kt.current=null,console.log("info","[Camera] Cleared blink interval")),Ye.current&&Ye.current.state!=="inactive")try{Ye.current.stop(),console.log("info","[Camera] Stopped main media recorder")}catch(he){console.warn("[Camera] Error stopping main recorder:",he)}if(vt.current&&vt.current.state!=="inactive")try{vt.current.stop(),console.log("info","[Camera] Stopped head verification recorder")}catch(he){console.warn("[Camera] Error stopping head recorder:",he)}Ie.current&&(Ie.current.getTracks().forEach(he=>{he.stop(),console.log("info",`[Camera] Stopped track: ${he.kind}`)}),Ie.current=null),ae.current&&(ae.current.srcObject=null),r(!1),console.log("info","[Camera]  Camera stopped and cleaned up successfully")},[r]),F0=_.useCallback(()=>{if(pm.current){console.log("info","Downloads already triggered; skipping duplicate call.");return}pm.current=!0,console.log("info","[Downloads] Starting download of all segments"),console.log("info","[Downloads] completedSegments count:",Ce.length);const he=[];for(let re=1;re<=Gs;re++){const Je=Ma.current[re];if(Je&&Je.length>0)try{const _t=new Blob(Je,{type:"video/webm"});he.push(_t),console.log("info",`[Downloads] Using recorded chunks for segment ${re} (${Je.length} chunks).`);continue}catch(_t){console.log("error",`[Downloads] Failed to build blob from chunks for segment ${re}:`,_t)}const rt=Ce[re-1];rt?(he.push(rt),console.log("info",`[Downloads] Using fallback completedSegments entry for segment ${re}.`)):console.log("warn",`[Downloads] No blob available for segment ${re}.`)}he.forEach((re,Je)=>{const rt=Je+1,_t=Je*300;setTimeout(()=>{try{const mt=`segment_${rt}.webm`,We=URL.createObjectURL(re),Ot=document.createElement("a");Ot.href=We,Ot.download=mt,Ot.style.display="none",document.body.appendChild(Ot),Ot.click(),setTimeout(()=>{document.body.removeChild(Ot),URL.revokeObjectURL(We)},1e3),console.log("info",`[Downloads] Triggered: ${mt}`)}catch(mt){console.log("error","[Downloads] Failed to trigger download:",mt)}},_t)}),console.log("info","[Downloads] Skipping partial segment downloads (internal use only)"),console.log("info","[Downloads] Head verification videos already downloaded during verification"),a("Downloads complete  (segments + head verifications)"),Ho.current=!0,wl.current=!0,console.log("info","[Downloads] Stopping camera immediately to prevent duplicate downloads..."),vm(),console.log(" Session fully completed. Camera stopped.")},[Ce,xr,Kn,_i,a,fu,vm]),P0=_.useCallback(()=>{if(!ae.current)return;const he=ae.current,re=document.createElement("canvas");re.width=he.videoWidth,re.height=he.videoHeight;const Je=re.getContext("2d");if(!Je)return;Je.translate(re.width,0),Je.scale(-1,1),Je.drawImage(he,0,0,re.width,re.height);const rt=re.toDataURL("image/png");B(rt)},[]),O0=_.useCallback(async()=>{if(Ho.current){console.log("info","[onSegmentComplete] Ignored because sessionCompletedRef is true");return}const he=_r.current||K;if(he<Gs){const re=he+1;J(re),_r.current=re,bc.current=0,Us.current=1,setTimeout(()=>{Oi(0)},600)}else{const re=!!Ri.current[3];console.log("info",`[onSegmentComplete] Final segment. triggerVerification3=${ls}, segment3Done=${re}`),ls&&!re?(console.log("info","[onSegmentComplete] Segment 2 verification failed, triggering verification 3"),await hu()):(console.log("info","[onSegmentComplete] All segments and verifications complete! Completing session."),V(!1),wc.current=!1,Ho.current=!0,wl.current=!0,P0(),F0())}},[K,Gs,ls,nr,an,J,bc,hu,V,F0,P0]),M0=_.useCallback(he=>{if(console.log("info",`[shouldVerifyAfterSegment] Called for segment ${he}`),he===1||he===2){const re=!!Ri.current?.[he],Je=!re;return console.log("info",`[shouldVerifyAfterSegment] Segment ${he} done=${re} -> return ${Je}`),Je}if(he===3){const re=ou.current?.[2]===!1;return console.log("info",`[shouldVerifyAfterSegment] Segment 3: segment2Failed=${re} -> return ${re}`),re}return console.log("info",`[shouldVerifyAfterSegment] Segment ${he} -> returning FALSE`),!1},[]),Oi=_.useCallback(async(he=0)=>{if(la.current){console.log("warn","Start already in progress - ignoring duplicate call.");return}if(Ho.current||wl.current){console.log("info","[startSegment] Aborting start because sessionCompletedRef or autoStartDisabledRef is true");return}la.current=!0;try{if(!Ie.current){an("statusMessage"," Camera not initialized.");return}let re=_r.current||K;(!re||re<=0)&&(re=1,J(1),_r.current=1,console.log("warn","currentSegment was 0 or invalid, reset to 1."));let Je;if(he===0)if(Ma.current[re]=[],fr(mt=>({...mt,[re]:[]})),MediaRecorder.isTypeSupported("video/webm;codecs=vp9"))Je={mimeType:"video/webm;codecs=vp9"};else if(MediaRecorder.isTypeSupported("video/webm"))Je={mimeType:"video/webm"};else if(MediaRecorder.isTypeSupported("video/mp4"))Je={mimeType:"video/mp4",videoBitsPerSecond:1e5};else{console.log("info","No supported MIME type found for MediaRecorder on this browser."),an("statusMessage"," MediaRecorder MIME type not supported.");return}else MediaRecorder.isTypeSupported("video/webm;codecs=vp9")?Je={mimeType:"video/webm;codecs=vp9"}:MediaRecorder.isTypeSupported("video/webm")?Je={mimeType:"video/webm"}:MediaRecorder.isTypeSupported("video/mp4")&&(Je={mimeType:"video/mp4",videoBitsPerSecond:1e5});he===0&&!z?(console.log("info","Starting fresh new segment recording."),aa.current=!1,re===1&&de==null&&(Ae([]),gr({}),xt({}),_n({}),_d.current={}),pe(0),Ai.current=0,Q(0),bl.current=0,Jn(!0),V(!0),it(0),yl.current=0,gr(mt=>({...mt,[re]:!1})),Ri.current[re]=!1,xt(mt=>({...mt,[re]:0})),_n(mt=>({...mt,[re]:0}))):(pe(he),Ai.current=he,Q(0),bl.current=0,yl.current=he,fr(mt=>({...mt,[re]:[]})));const rt=new MediaRecorder(Ie.current,Je);Ye.current=rt,On(rt),V(!0),wc.current=!0,console.log("info","MediaRecorder created",{state:rt.state,options:Je});const _t=Rt[re-1]||lu/Gs;if(Z(_t-de),(!Rt||Rt.length===0)&&console.log("warn","Segment durations not initialized yet, using default values"),_t-de<=0){console.log("info","Segment duration already met or exceeded, calling _onSegmentComplete."),await O0();return}an("recordingMessage",` Recording segment ${re}/${Gs}  keep your face FORWARD and still (${_t-de}s remaining)`),rt.ondataavailable=mt=>{mt.data&&mt.data.size>0&&(console.log("info",` ondataavailable: received chunk of size ${mt.data.size} bytes`),Hs.current&&!iu.current&&!Fd.current&&(Ma.current[re]||(Ma.current[re]=[]),Ma.current[re].push(mt.data),fr(We=>({...We,[re]:[...Ma.current[re]]}))))},rt.onstop=async()=>{console.log("info",` [onstop] ENTERED for segment ${re}`),la.current=!1;const mt=Ai.current,We=Ma.current[re]?.length||0,Ot=mt>=_t,un=We>0;if(console.log("info",` onstop: wasFaceDetected(ref)=${Hs.current}, isSegmentValid=${An}, hasEnoughTime=${Ot} (${mt}>=${_t}), hasValidChunks=${un} (${We} chunks)`),Us.current=0,sh.current){const Zr=mt-yl.current;if(un&&Zr>0){const _s=Ma.current[re],ai=new Blob(_s,{type:Je?.mimeType??"video/webm"});_d.current[re]||(_d.current[re]=[]),_d.current[re].push({blob:ai,startTime:yl.current,endTime:mt,duration:Zr})}sh.current=!1,la.current=!1;return}const pn=Hs.current;if(An&&Ot&&un){const Zr=Ma.current[re],_s=new Blob(Zr,{type:Je?.mimeType??"video/webm"});Ae(ca=>[...ca,_s]),xm(re===3?100:re===2?60:20),console.log("info",` Segment ${re} COMPLETED and saved. Blob size: ${_s.size} bytes, Chunk count: ${Zr.length}`),console.log("info",`   Segment recorded for ${mt}s (target: ${_t}s)`)}else{console.log("warn",` Segment ${re} incomplete; retrying. (face=${pn}, valid=${An}, time=${Ot}, chunks=${un})`),setTimeout(()=>Oi(mt),600);return}console.log("info",`[onstop] About to check shouldVerifyAfterSegment(${re})`);const Xn=M0(re);if(console.log("info",`[onstop] shouldVerifyAfterSegment(${re}) returned:`,Xn),Xn){console.log("info",`[onstop] Calling performVerificationForCurrentSegment for segment ${re}`),await hu(),aa.current=!1,la.current=!1;return}await O0(),aa.current=!1,Us.current=0,la.current=!1},tt.current&&clearInterval(tt.current),tt.current=setInterval(async()=>{if(Us.current===0&&!wc.current){clearInterval(tt.current);return}if(!wc.current){clearInterval(tt.current);return}if(!Hs.current){rt.state==="recording"&&rt.pause();return}if(iu.current||Fd.current){rt.state==="recording"&&rt.pause();return}if(rt.state==="paused"&&rt.resume(),rt.state==="recording"){const mt=Ai.current;if(console.log("info",` Timer tick: currentSeconds=${mt}, target=${_t}`),mt<_t){const We=mt+1;if(Ai.current=We,pe(We),Z(_t-We),await ch()){Jn(!1),an("verificationMessage"," Different face detected for several seconds! Restarting from scratch..."),clearInterval(tt.current),fu(),wo(),(rt.state==="recording"||rt.state==="paused")&&rt.stop();return}}else{const We=bl.current;if(mt!==_t&&We<1){bl.current=We+1,Q(We+1),console.log("info",` Adding extra second buffer for timing mismatch (extra=${We+1})`);return}console.log("info",` Segment complete at ${mt}s (target: ${_t}s, extra=${We}), stopping recorder`),aa.current=!0,clearInterval(tt.current),(rt.state==="recording"||rt.state==="paused")&&rt.stop();return}}},1e3),console.log("info","Starting MediaRecorder..."),rt.start(1e3),console.log("info","MediaRecorder started, state=",rt.state)}catch(re){an("statusMessage"," Unable to start recording segment. Please try again."),console.error("Failed to start recording:",re),la.current=!1}},[Ie.current,K,de,Rt,lu,Gs,z,s,An,kr,an,bn,Ae,gr,xt,_n,cr,pe,Q,Jn,V,it,On,Z,fr,M0,ch,fu]),wo=_.useCallback(()=>{if(console.log("info","Attempting to restart current segment due to face loss."),Rd.current){console.log("warn","Restart called but cooldown active. Ignoring.");return}if(Rd.current=!0,console.log("info","Restart cooldown activated."),Ye.current&&Ye.current.state==="recording"){sh.current=!0,an("verificationMessage"," Recording reset due to face loss. Continuing from current progress..."),console.log("warn","Recording reset due to face loss or quality issues."),clearInterval(tt.current),console.log("info","Timer interval cleared.");try{console.log("info",`Stopping mediaRecorder. Current state: ${Ye.current.state}`),Ye.current.stop(),console.log("info","MediaRecorder.stop() called successfully.")}catch(he){console.log("error",`Error stopping mediaRecorder during restart: ${he}`)}}else console.log("info","MediaRecorder not recording or undefined, skipping stop.");setTimeout(()=>{Rd.current=!1,console.log("info","Restart cooldown reset.");const he=_r.current||K,re=Ai.current??0;Ri.current[he]=!1,ou.current[he]=!1,yc.current[he]=!1,io.current=0,console.log("info",`[Restart] Cleared verification flags for segment ${he}, reset face mismatch counter`);let Je;re>1&&hm.current!==re?(Je=re-1,hm.current=Je,console.log("info",`Adjusted segmentSecondsRecorded by -1 for segment ${he}`)):Je=re,console.log("info",`Resuming recording from ${Je}s for segment ${he}.`),!Ye.current||Ye.current.state!=="recording"?(console.log("info","Starting segment recording after restart."),Oi(Je)):console.log("warn","Attempted to restart recording but MediaRecorder is already recording.")},1e3)},[an,de,K]),kl=_.useCallback((he,re,Je,rt)=>(an(he,re),console.log(Je,re),z&&wo(),ja(rt),!0),[an,z,wo,ja]),L0=_.useCallback(async(he,re)=>{if(!ae.current)return!1;const Je=await Yae(ae.current,re),rt=Nn.current;if(!rt)return!1;const{cx:_t,cy:mt,rOuter:We}=rt,Ot=We*1.2;if(Je.filter(pn=>{const Xn=pn.box.x+pn.box.width/2,Zr=pn.box.y+pn.box.height/2,_s=Xn-_t,ai=Zr-mt;return Math.sqrt(_s*_s+ai*ai)<=Ot}).length>1){if(iu.current=!0,Ye.current&&Ye.current.state==="recording")try{Ye.current.pause()}catch{}return kl("verificationMessage"," Multiple faces detected. Ensure only one face remains.","warn",he)}else iu.current&&(iu.current=!1,an("verificationMessage",""));return!1},[z,Ft,wo,kl,an]),ym=_.useCallback(()=>{try{if(!M||!window.cv||!window.cv.imread)return null;const he=document.createElement("canvas");return he.width=ae.current.videoWidth,he.height=ae.current.videoHeight,he.getContext("2d").drawImage(ae.current,0,0,he.width,he.height),window.cv.imread(he)}catch(he){return console.error("Error reading frame for OpenCV:",he),null}},[M]),j0=_.useCallback(he=>{try{if(!M||!window.cv||!he)return"";const re=230,Je=500,rt=7e4,_t=20,mt=180,We=.3,Ot=1.3,un=window.cv;let pn=new un.Mat;un.cvtColor(he,pn,un.COLOR_RGBA2GRAY);const Xn=pn.rows,Zr=pn.cols,_s=Math.floor(Zr/2),ai=Math.floor(Xn/2),ca=Nn.current?.rInner||Math.max(Math.min(_s,ai)-10,1);let ua=new cv.Mat;cv.threshold(pn,ua,re,255,cv.THRESH_BINARY);let da=cv.Mat.zeros(pn.rows,pn.cols,cv.CV_8UC1);cv.circle(da,new cv.Point(_s,ai),ca,new cv.Scalar(255,255,255),-1);let Sl=new cv.Mat;cv.bitwise_and(ua,da,Sl);let Ba=new cv.MatVector,mu=new cv.Mat;cv.findContours(Sl,Ba,mu,cv.RETR_EXTERNAL,cv.CHAIN_APPROX_SIMPLE);let Qn=!1;for(let qs=0;qs<Ba.size();qs++){let ao=Ba.get(qs),Go=cv.contourArea(ao);if(Go<Je||Go>rt)continue;let fa=cv.minEnclosingCircle(ao),Jr=fa.radius,li=fa.center.x,ha=fa.center.y;if(Math.sqrt((li-_s)**2+(ha-ai)**2)>ca||Jr<_t||Jr>mt)continue;let Mi=cv.arcLength(ao,!0);if(Mi===0)continue;let Nl=4*Math.PI*(Go/(Mi*Mi));if(Nl>=We&&Nl<=Ot){console.log(`[BrightnessCheck] Contour ${qs} matched: area=${Go}, radius=${Jr}, circularity=${Nl.toFixed(2)}`),Qn=!0;break}}return pn.delete(),ua.delete(),da.delete(),Sl.delete(),Ba.delete(),mu.delete(),Qn?"spot detected":"no spot detected"}catch(re){return console.error("Bright spot detection error:",re),"error"}},[]),B0=_.useCallback(()=>{if(!Un.current||!M)return!1;Un.current.drawImage(ae.current,0,0,Pe.current.width,Pe.current.height);const re=Un.current.getImageData(0,0,Pe.current.width,Pe.current.height).data;let Je=0,rt=0;for(let We=0;We<re.length;We+=4){const Ot=re[We],un=re[We+1],pn=re[We+2],Xn=.299*Ot+.587*un+.114*pn;Je+=Xn,rt+=Xn*Xn}const _t=Je/(re.length/4);return rt/(re.length/4)-_t*_t<50},[M]),V0=_.useCallback(async he=>{const re=uu();if(console.log("info",`[BrightnessCheck] Frame brightness: ${re}`,"brightness"),Pi(re),D0())return z&&wo(),console.log("warn","[BrightnessCheck] Camera feed appears blank.","cameraError"),kl("cameraErrorMessage"," Camera feed appears blank. Check your camera or refresh the page.","warn",he);const Je=ym();let rt=!1;if(Je){const _t=j0(Je);console.log("info",`[BrightnessCheck] Bright spot detection result: ${_t}`,"brightness"),Je.delete(),_t==="spot detected"&&(rt=!0)}else Dd.current||(console.log("warn","[BrightnessCheck] Failed to get current frame as Mat (OpenCV not ready). Suppressing further warnings.","cameraError"),Dd.current=!0);return rt?(z&&!Ft&&wo(),console.log("warn","[BrightnessCheck] Bright spot detected in the oval.","brightnessWarning"),kl("brightnessMessage"," Bright spot detected in the oval. Please adjust lighting or avoid reflections.","warn",he)):re<60?(z&&!Ft&&wo(),console.log("warn","[BrightnessCheck] Too dark environment detected.","brightnessWarning"),kl("brightnessMessage"," Too dark  please move to a brighter place.","warn",he)):re>180?(z&&!Ft&&wo(),console.log("warn","[BrightnessCheck] Too bright environment detected.","brightnessWarning"),kl("brightnessMessage"," Too bright  reduce lighting.","warn",he)):(console.log("info","[BrightnessCheck] Brightness is within acceptable range.","brightness"),an("brightnessMessage",""),an("cameraErrorMessage",""),B0()?(z&&!Ft&&wo(),console.log("warn","[BrightnessCheck] Video is blurry detected.","blurWarning"),kl("dashedCircleAlignMessage"," Video is blurry. Clean your camera lens or adjust focus.","warn",he)):(console.log("info","[BrightnessCheck] No issues detected in current frame.","status"),!1))},[uu,Pi,D0,z,wo,kl,ym,j0,Ft,an,B0]),z0=_.useCallback(async he=>{if(!ae.current)return;const re=await pv(ae.current,he).withFaceLandmarks();ru.current=re?.landmarks??null,su.current=re?.detection?.box??null},[]),W0=_.useCallback(he=>{const re=Nn.current;if(!re||!he)return!1;const{cx:Je,cy:rt,rOuter:_t}=re,mt=_t*1.2;return he.positions.every(We=>{const Ot=We.x-Je,un=We.y-rt;return Math.sqrt(Ot*Ot+un*un)<=mt})},[]),U0=_.useCallback(async he=>{const re=su.current,Je=ru.current,rt=Nn.current;if(!re||!Je||!rt)return[!1,!1];const _t=re.height/rt.h*100;Oa.current.push(_t),Oa.current.length>T0&&Oa.current.shift();const mt=Oa.current.reduce((Xn,Zr)=>Xn+Zr,0)/Oa.current.length,We=55,Ot=80;let un=!1;mt<We?an("distanceMessage"," Please move closer to the camera."):mt>Ot?an("distanceMessage"," Please move slightly farther away from the camera."):(un=!0,an("distanceMessage",""));const pn=W0(Je);return an("ovalAlignMessage",pn?" Yay! Your face is perfectly inside the oval! ":""),[pn,un]},[an,W0]),H0=_.useCallback(async()=>{if(Ae([]),Ee(null),dt(!1),rn(""),lt(!1),Vn.current=null,La.current=!1,Fi.current=!1,aa.current=!1,$i.current=!1,Us.current=0,ou.current={},!Hs.current){an("statusMessage"," Please align your face inside the circle and adjust distance before starting."),console.log("info","Attempted to start recording but no face detected.");return}try{const he=ae.current;if(!he)console.log("warn","Video element not ready while capturing reference face.");else{const re=await pv(he,new tg).withFaceLandmarks().withFaceDescriptor();re&&re.descriptor?(Vn.current=re.descriptor,console.log("info"," Reference face captured"),ur.current+=1,console.log("Capturing frame",ur.current)):(console.log("warn"," Face not detected clearly; continuing without reference descriptor"),an("statusMessage"," Face not detected clearly. Please adjust position."))}}catch(he){console.log("error",` FaceAPI error while capturing reference face: ${he?.message||he}`),an("statusMessage"," Error detecting face, continuing with recording.")}(!_r.current||_r.current<=0)&&(J(1),_r.current=1)},[Ae,Ee,dt,rn,lt,ae,Vn,ur,_r,an]),dh=_.useCallback(he=>{o(!1),Hs.current=!1,rh.current=0,z&&!Ft&&wo()},[z,Ft,wo]),pu=_.useCallback(()=>{const he=new tg,re=async()=>{if(Ho.current||wl.current){console.log("info","[Detection] Loop stopped - session completed");return}if(R0(re)&&lh(re)&&(ur.current++,!(ur.current%mm===0&&await V0(re)))){if(ur.current%ih===0){if(await L0(re,he))return;await z0(he)}if(su.current&&ru.current){const[Je,rt]=await U0(re);if(rt&&Je){if(rh.current++,an("dashedCircleAlignMessage",""),rh.current>=Od){o(!0),Hs.current=!0,await ch();const _t=Ye.current&&(Ye.current.state==="recording"||Ye.current.state==="paused");if(console.log("info",`Recording flag: ${Us.current}, isRecording: ${z}, recorderState: ${Ye.current?.state||"none"}`),console.log("debug",`Ref states -> isRecordingRef=${wc.current}, startingGuard=${la.current}`),console.log("info",`Recording flag: ${Us.current}, isRecording(state)=${z}, isRecording(ref)=${wc.current}, recorderState: ${Ye.current?.state||"none"}`),Ho.current||wl.current)return;if(aa.current){console.log("info"," Processing segment completion, not starting new recording");return}if(Us.current===0&&!_t)if($i.current||La.current||Fi.current||aa.current)console.log("info","Deferring segment start. Flags:",{isVerifyingHeadTurn:$i.current,verificationInProgress:La.current,verificationPending:Fi.current,processingSegmentCompletion:aa.current,recordingFlag:Us.current,currentSegment:_r.current});else{if((!_r.current||_r.current<=0)&&H0(),Cl.current)return;const mt=_r.current||1;let We;if(mt===1)We=(()=>{const Ot=du([]);return Ot==="forward"?"up":Ot})(),Te(We);else if(mt===2)We=(()=>{const Ot=[Nr].filter(Boolean),un=du(Ot);return un==="forward"?"right":un})(),we(We);else{const Ot=[];Nr&&Ot.push(Nr),Re&&Ot.push(Re),We=(()=>{const un=du(Ot);return un==="forward"?"left":un})(),Xe(We)}$d.current[mt]=We,q(We),lt(!0),Md(We),an("headTurnAttemptStatus",`Please ${We==="left"?"turn your head LEFT":We==="right"?"turn your head RIGHT":We==="up"?"tilt your head UP":"tilt your head DOWN"} and KEEP it there  recording will start now.`),Cl.current=!0,setTimeout(async()=>{uh(),lt(!1),console.log("info"," Starting recording after head-turn prompt..."),Us.current=1;try{await Oi()}catch(Ot){console.log("error",` Error starting segment recording: ${Ot}`),Us.current=0}finally{Cl.current=!1}},1200)}else Us.current===1&&!_t&&console.log("info","Waiting for recorder to start...")}}else rh.current=0,o(!1),Hs.current=!1,z&&!Ft&&wo(),!rt&&!Je?console.log("dashedCircleAlignMessage"," Make sure your full face is inside the dashed circle and adjust distance."):Je?console.log("dashedCircleAlignMessage",""):console.log("dashedCircleAlignMessage"," Your entire face must be inside the dashed circle.")}else dh(re);ja(re)}};ja(re)},[R0,lh,V0,L0,z0,U0,an,ch,H0,Oi,dh,wo,ja,mm,ih,Od]),bw=_.useCallback(async()=>{try{const he=ae.current,re=ce.current;if(!he||!re){d(" Video or overlay element not available.");return}const Je=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:{ideal:640},height:{ideal:480},frameRate:{ideal:30,max:30}},audio:!1});Ie.current=Je,he.srcObject=Je,await he.play();const rt=Je.getVideoTracks();if(rt.length){const We=rt[0].getSettings();(We.width&&We.width<400||We.height&&We.height<300)&&d(" Low camera resolution. Face detection may not work properly."),We.frameRate&&We.frameRate<15&&d(" Low frame rate. Detection quality may be affected.")}if(await G0()<10&&d(" Camera FPS is too low for reliable detection."),!he.srcObject||!(he.srcObject instanceof MediaStream)){d(" Camera not providing video. Try refreshing or switching device.");return}r(!0),S(" Camera started successfully."),q0();const mt=()=>{const We=he.videoWidth||640,Ot=he.videoHeight||480;re.width=We,re.height=Ot,Nn.current.w=We*.5,Nn.current.h=Ot*.6,Nn.current.cx=We/2,Nn.current.cy=Ot/2,Pe.current||(Pe.current=document.createElement("canvas")),Pe.current.width=We,Pe.current.height=Ot;const un=Pe.current.getContext("2d",{willReadFrequently:!0});Un.current=un};mt(),he.addEventListener("loadedmetadata",mt,{once:!0}),cu(),pu(),console.log("info","Started detection loop via requestAnimationFrame.")}catch(he){const re=he?.name;d(re==="NotAllowedError"?" Camera permission denied. Please allow access and refresh.":re==="NotFoundError"?" No camera found on this device.":" Failed to access the camera. Try again."),r(!1)}},[ae,ce,r,S,d,cu,pu]),G0=_.useCallback(()=>new Promise(he=>{let re=0,Je=performance.now();const rt=()=>{re++,performance.now()-Je>=1e3?he(re):requestAnimationFrame(rt)};rt()}),[]),q0=_.useCallback(()=>{if(!ae.current)return;const he=ae.current.videoWidth,re=ae.current.videoHeight;console.log(` Video resolution: ${he}x${re}`),(he<400||re<300)&&console.log("cameraErrorMessage"," Low camera resolution. Face detection may not work properly.")},[]);return m.jsxs("div",{className:"selfie-app-root",children:[m.jsx("h3",{className:"note",children:" Please remove any accessories on your face (e.g. glasses)"}),(u||f||k)&&m.jsxs("div",{className:"selfie-error-messages",style:{margin:"12px 0",textAlign:"center"},children:[u&&m.jsx("div",{className:"selfie-error-message",style:{color:"#dc2626",fontWeight:600},children:u}),f&&m.jsx("div",{className:"selfie-error-message",style:{color:"#dc2626",fontWeight:600},children:f}),k&&k.toLowerCase().includes("error")&&m.jsx("div",{className:"selfie-error-message",style:{color:"#dc2626",fontWeight:600},children:k})]}),Ft&&m.jsxs("h3",{className:"head-turn-instruction",children:[" Move your head toward the"," ",m.jsx("span",{style:{color:"rgb(35, 27, 148)"},children:"blinking arc"})," and hold"]}),m.jsx("div",{className:"selfie-video-wrapper",children:m.jsxs("div",{className:"selfie-video-container",children:[m.jsx("div",{className:"selfie-video-area",children:P?m.jsxs("div",{className:"selfie-captured-frame-wrapper",children:[m.jsx("img",{src:P,alt:"Captured frame",className:"selfie-captured-frame"}),m.jsx("div",{className:"selfie-frame-overlay"})]}):m.jsxs(m.Fragment,{children:[m.jsx("video",{ref:ae,autoPlay:!0,playsInline:!0,muted:!0}),m.jsx("canvas",{ref:ce}),m.jsx("div",{className:"oval-overlay"})]})}),P&&m.jsx("div",{className:"selfie-capture-complete-message",children:m.jsx("p",{children:"Capture complete"})}),z&&m.jsxs("div",{className:"selfie-recording-panel",children:[m.jsxs("div",{className:"info",children:[!t&&m.jsx("p",{children:" Start the camera to begin."}),t&&!z&&Ce.length<Gs&&m.jsxs("p",{children:[" Ready  Keep your face inside the oval (7585% height), then hit ",m.jsx("strong",{children:"Start"}),"."]})]}),m.jsx("p",{children:" Recording "})]})]})}),L&&F&&m.jsx("div",{className:"selfie-mobile-status-message",children:F}),!z&&Ce.length===Gs&&m.jsx("div",{className:"post-record",children:m.jsxs("p",{children:[" All ",Gs," segments recorded.",m.jsx("br",{}),"Please complete ",m.jsx("strong",{children:"head-turn verification"})," before download."]})}),m.jsx("pre",{children:Ke}),D&&m.jsx("div",{className:"selfie-success-overlay",children:m.jsxs("div",{className:"selfie-success-message",children:[m.jsx("h1",{children:" Successfully Completed"}),m.jsx("p",{children:"Your video segments have been verified and downloaded."})]})})]})}function Lz({message:n}){return m.jsx("div",{className:"flex w-full flex-col items-center justify-center gap-2 text-center px-4 py-8",children:m.jsxs("div",{className:"flex flex-col items-center gap-2",children:[m.jsxs("svg",{className:"w-[270px] h-[124px] max-w-full",width:"270",height:"124",viewBox:"0 0 270 124",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("path",{d:"M85.3279 22.1817L78.0773 24.5986C77.434 24.813 77 25.4151 77 26.0933V64.3453C77 65.2155 77.7054 65.9209 78.5755 65.9209H191.227C192.097 65.9209 192.802 65.2155 192.802 64.3453V35.9856C194.546 23.1968 184.36 21.4894 177.822 22.3318C176.954 22.4437 176.115 21.8651 175.923 21.0114C169.802 -6.20549 153.204 2.6679 143.786 12.3146C142.867 13.2569 141.155 12.8031 140.472 11.6773C137.614 6.96655 131.053 8.36187 126.478 10.4315C125.425 10.908 124.154 10.2315 123.989 9.08721C122.429 -1.75121 117.469 0.119079 114.308 3.27733C113.684 3.9011 112.684 3.9987 111.958 3.49708C106.479 -0.288224 104.073 3.4716 103.285 7.11776C103.063 8.14607 101.996 8.83505 100.98 8.56145C89.6105 5.49927 86.5757 14.5459 86.4423 20.6214C86.4268 21.3237 85.9943 21.9596 85.3279 22.1817Z",fill:"url(#paint0_linear_2641_15388)"}),m.jsx("rect",{x:"123.5",y:"46.3867",width:"24.8794",height:"12.8687",fill:"url(#paint1_linear_2641_15388)"}),m.jsx("path",{d:"M123.759 42.4412L116.105 52.7943C115.745 53.2812 115.989 53.9778 116.575 54.1334L120.155 55.085C120.486 55.173 120.837 55.0557 121.049 54.7866L125.516 49.1128C125.679 48.9062 125.927 48.7856 126.19 48.7856H145.088C145.402 48.7856 145.69 48.9567 145.841 49.2318L148.89 54.8064C149.034 55.0694 149.305 55.2383 149.604 55.2517L154.138 55.4557C154.81 55.4859 155.254 54.7672 154.926 54.1803L148.42 42.5328C148.268 42.2614 147.982 42.0933 147.671 42.0933H124.448C124.176 42.0933 123.92 42.2224 123.759 42.4412Z",fill:"url(#paint2_linear_2641_15388)"}),m.jsx("path",{opacity:"0.6",d:"M157.998 75.1751H112.026C110.993 75.1751 110.448 73.9515 111.139 73.1837L114.18 69.8057H114.717H155.346C155.687 69.8057 156.012 69.9514 156.238 70.2061L158.89 73.1892C159.574 73.9586 159.027 75.1751 157.998 75.1751Z",fill:"#EFF1F5"}),m.jsx("path",{d:"M114.924 70.1123V53.812C114.924 52.8644 115.693 52.0962 116.64 52.0962H125.548C126.357 52.0962 127.056 52.6614 127.226 53.4525L127.931 56.7453C128.101 57.5364 128.8 58.1016 129.609 58.1016H141.747C142.601 58.1016 143.325 57.4737 143.446 56.6284L143.883 53.5694C144.004 52.7241 144.728 52.0962 145.581 52.0962H153.959C154.907 52.0962 155.675 52.8644 155.675 53.812V70.1123C155.675 71.0599 154.907 71.8281 153.959 71.8281H116.64C115.693 71.8281 114.924 71.0599 114.924 70.1123Z",fill:"url(#paint3_linear_2641_15388)"}),m.jsxs("defs",{children:[m.jsxs("linearGradient",{id:"paint0_linear_2641_15388",x1:"135",y1:"0.825195",x2:"135.295",y2:"33.9116",gradientUnits:"userSpaceOnUse",children:[m.jsx("stop",{stopColor:"#F1F1F1"}),m.jsx("stop",{offset:"1",stopColor:"#F8F8F8",stopOpacity:"0.2"})]}),m.jsxs("linearGradient",{id:"paint1_linear_2641_15388",x1:"135.94",y1:"46.3867",x2:"135.94",y2:"59.2554",gradientUnits:"userSpaceOnUse",children:[m.jsx("stop",{stopColor:"#BCD3FF"}),m.jsx("stop",{offset:"1",stopColor:"#EAF1FF"})]}),m.jsxs("linearGradient",{id:"paint2_linear_2641_15388",x1:"135.516",y1:"49.8145",x2:"135.516",y2:"40.3774",gradientUnits:"userSpaceOnUse",children:[m.jsx("stop",{stopColor:"#4372DF"}),m.jsx("stop",{offset:"1",stopColor:"#8EAFFE"})]}),m.jsxs("linearGradient",{id:"paint3_linear_2641_15388",x1:"135.514",y1:"52.3911",x2:"135.514",y2:"72.123",gradientUnits:"userSpaceOnUse",children:[m.jsx("stop",{stopColor:"#84ABF8"}),m.jsx("stop",{offset:"1",stopColor:"#C1D4FC"})]})]})]}),m.jsx("div",{className:"max-w-xs sm:max-w-sm md:max-w-md text-[#42526E] font-roboto text-[13px] font-medium leading-5 px-4",children:n})]})})}function jz({onScanFace:n,isScanning:e=!1}){return m.jsx("div",{className:"flex w-full flex-col gap-4 rounded bg-white",children:m.jsxs("div",{className:"flex flex-col items-start self-stretch rounded border border-[#DEDEDD]",children:[m.jsxs("div",{className:"flex flex-col justify-center items-center gap-2 self-stretch bg-white px-3 py-4",children:[m.jsxs("div",{className:"flex items-center gap-2 self-stretch pb-1",children:[m.jsx("svg",{width:"19",height:"19",viewBox:"0 0 19 19",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"w-[19px] h-[19px]",children:m.jsx("path",{d:"M6.30071 9.44844H12.6001M17.3246 9.44844C17.3246 13.7972 13.7992 17.3227 9.4504 17.3227C5.10158 17.3227 1.57617 13.7972 1.57617 9.44844C1.57617 5.09963 5.10158 1.57422 9.4504 1.57422C13.7992 1.57422 17.3246 5.09963 17.3246 9.44844Z",stroke:"#323238",strokeWidth:"1.57484",strokeLinecap:"round",strokeLinejoin:"round"})}),m.jsx("div",{className:"text-[#172B4D] font-roboto text-[17px] font-bold leading-[12.6px]",children:"Biometric Capture"})]}),m.jsx("div",{className:"flex justify-center items-center gap-2.5 self-stretch pl-[29px]",children:m.jsx("div",{className:"flex-1 text-[#172B4D] font-roboto text-[14px] font-normal leading-[21px]",children:"Take a live selfie to confirm you are the person in the ID document. Make sure you're in a well-lit area and your face is clearly visible."})})]}),!e&&m.jsx("div",{className:"flex w-full flex-col justify-center items-center border-t border-[#DEDEDD] bg-white p-4",children:m.jsxs("div",{className:"flex w-full min-h-[450px] flex-col xl:flex-row justify-center items-stretch gap-0",children:[m.jsxs("div",{className:"flex flex-1 flex-col justify-between items-center rounded-lg bg-white",children:[m.jsx("style",{children:`
                  @keyframes headTilt {
                    0%, 100% {
                      transform: rotate(0deg);
                    }
                    50% {
                      transform: rotate(-8deg);
                    }
                  }
                  .animated-head {
                    animation: headTilt 2s ease-in-out infinite;
                    transform-origin: center;
                  }
                `}),m.jsxs("svg",{className:"flex flex-col items-center gap-3 self-stretch w-full h-full",viewBox:"0 0 460 353",fill:"none",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"xMidYMid meet",children:[m.jsxs("g",{className:"animated-head",children:[m.jsx("path",{d:"M232.04 131.449C232.04 131.449 226.213 140.607 251.187 163.917C276.162 187.226 265.34 233.013 265.34 233.013L193.746 174.739L191.248 123.957L232.04 131.449Z",fill:"#2E1500"}),m.jsx("path",{d:"M203.318 166.413V136.776C203.318 135.777 203.901 134.862 204.9 134.445C207.48 133.446 213.308 132.198 221.633 135.195C233.038 139.274 239.698 131.365 243.86 105.142C244.027 104.226 244.693 103.393 245.608 103.144L252.685 101.146C254.266 100.729 254.932 98.898 254.1 97.4828L246.607 84.9954C246.108 84.1629 246.108 83.0807 246.774 82.2482L247.939 80.6665C248.189 80.4167 248.272 80.0837 248.356 79.6675C249.438 74.5893 257.18 35.4623 241.612 26.8876C226.295 18.4795 175.679 31.8826 167.771 34.047C167.105 34.2135 166.522 34.713 166.189 35.2958L143.628 80.5C143.462 80.833 143.379 81.166 143.379 81.499L141.797 118.711C141.797 119.128 141.88 119.461 142.047 119.794L157.947 155.757C158.197 156.423 158.78 156.923 159.446 157.089L200.404 170.242C202.319 170.825 204.15 168.994 203.484 167.079C203.401 166.912 203.318 166.663 203.318 166.413Z",fill:"#EAC6D0"}),m.jsx("path",{d:"M338.598 141.439C338.598 141.439 333.603 135.612 330.273 138.942C326.943 142.272 329.441 148.682 334.852 152.178C340.263 155.592 338.598 141.439 338.598 141.439Z",fill:"#C6A6B1"}),m.jsx("path",{d:"M338.764 140.607C338.764 140.607 331.854 132.948 337.349 130.201C342.927 127.454 347.755 134.363 347.755 137.86C347.755 141.273 338.764 140.607 338.764 140.607Z",fill:"#C6A6B1"}),m.jsx("path",{d:"M188.333 89.4075C188.333 89.4075 191.663 86.0775 190.831 70.2602C190.831 70.2602 234.12 70.2602 238.283 32.7982C238.283 32.7982 251.603 43.6205 246.608 80.2501H248.273C248.273 80.2501 266.588 35.2956 234.953 16.9809C203.318 -1.33391 166.689 11.9859 157.531 18.6458C157.531 18.6458 128.394 34.4632 130.892 74.4227C130.892 74.4227 135.054 132.697 118.404 155.174C118.404 155.174 137.552 141.854 170.851 156.839V156.007C170.851 156.007 179.176 125.205 172.516 98.5649C172.516 98.5649 154.201 94.4024 160.861 73.5902C160.861 73.5902 164.191 62.7678 175.014 65.2653C175.014 65.2653 170.851 81.9151 188.333 89.4075Z",fill:"#2E1500"}),m.jsx("path",{d:"M331.106 163.083C331.106 163.083 323.613 161.418 321.948 166.413C320.283 171.408 329.441 172.24 329.441 172.24L331.106 163.083Z",fill:"#C6A6B1"}),m.jsx("path",{d:"M334.52 153.178C334.52 153.178 326.361 147.683 323.614 153.095C320.284 159.754 331.939 162.252 331.939 162.252L334.52 153.178Z",fill:"#C6A6B1"}),m.jsx("path",{d:"M342.677 141.44L339.514 140.275C338.848 140.025 338.515 139.359 338.765 138.693L358.078 84.6642C358.328 83.9982 358.994 83.6652 359.66 83.915L362.824 85.0804C363.49 85.3302 363.822 85.9962 363.573 86.6622L344.259 140.691C344.092 141.357 343.343 141.69 342.677 141.44Z",fill:"#2D2628"}),m.jsx("path",{d:"M298.306 232.764L318.618 208.039C318.618 208.039 312.791 189.724 321.948 178.902C321.948 178.902 334.436 158.922 338.598 138.942C338.598 138.942 341.096 133.115 347.755 134.78C354.415 136.445 353.583 142.272 353.583 142.272L357.745 163.084C357.745 163.084 359.41 172.242 357.745 177.237C356.08 182.232 346.923 209.704 346.923 209.704L326.277 245.085L324.446 246.333L295.309 234.678L298.306 232.764Z",fill:"#EAC6D0"}),m.jsx("path",{d:"M347.756 166.413C347.756 166.413 352.751 168.078 351.086 155.591L351.918 139.773C351.918 139.773 345.258 160.586 347.756 166.413Z",fill:"#CFABB5"})]}),m.jsx("path",{d:"M96.3438 258.822L97.1762 195.552C97.1762 195.552 98.5082 155.843 132.391 149.849C166.273 143.855 257.847 178.07 266.172 228.019C266.172 228.019 272.832 246.334 271.167 253.827L291.979 228.852L326.943 244.669L318.619 260.487L96.3438 258.822Z",fill:"#59A4F0"}),m.jsx("path",{d:"M275.838 68.5959L304.143 68.1797L290.656 82.0823L275.838 68.5959Z",fill:"#59A4F0"}),m.jsx("path",{d:"M295.32 69.2632L285.33 68.6804C287.661 27.1392 264.185 8.74114 263.186 7.9919L269.179 0C270.345 0.915739 297.9 22.1442 295.32 69.2632Z",fill:"#59A4F0"}),m.jsx("text",{fill:"#222121",xmlSpace:"preserve",style:{whiteSpace:"pre"},fontFamily:"Roboto",fontSize:"18",fontWeight:"bold",letterSpacing:"0em",children:m.jsx("tspan",{x:"156.594",y:"290.641",children:"Look up and down"})}),m.jsxs("text",{fill:"#5F5555",xmlSpace:"preserve",style:{whiteSpace:"pre"},fontFamily:"Roboto",fontSize:"13",fontWeight:"500",letterSpacing:"0em",children:[m.jsxs("tspan",{x:"90.5039",y:"320.932",children:["Maintain your position in the frame as you move"," "]}),m.jsx("tspan",{x:"146.719",y:"344.932",children:"your head up, and then down"})]})]}),m.jsx("div",{className:"flex px-4 py-2 flex-col items-end gap-2 self-stretch bg-[#F6F7FB]",children:m.jsx("button",{onClick:n,className:"flex h-[34px] px-3 py-2 justify-center items-center gap-2 rounded bg-[#0073EA] text-white font-roboto text-[14px] font-medium hover:bg-[#0060C0] transition-colors",children:"Scan Your Face"})})]}),m.jsxs("div",{className:"hidden xl:flex flex-col justify-center items-center gap-1",children:[m.jsx("div",{className:"flex-1 w-px bg-[#D0D4E4]"}),m.jsx("div",{className:"text-[#676879] font-roboto text-[13.6px] px-2",children:"or"}),m.jsx("div",{className:"flex-1 w-px bg-[#D0D4E4]"})]}),m.jsxs("div",{className:"flex xl:hidden w-full justify-center items-center gap-2 py-4",children:[m.jsx("div",{className:"flex-1 h-px bg-[#D0D4E4]"}),m.jsx("div",{className:"text-[#676879] font-roboto text-[13.6px]",children:"or"}),m.jsx("div",{className:"flex-1 h-px bg-[#D0D4E4]"})]}),m.jsxs("div",{className:"flex flex-1 flex-col justify-stretch items-stretch",children:[m.jsx("div",{className:"flex flex-col items-center gap-0 self-stretch h-full",children:m.jsx("div",{className:"flex flex-col justify-center items-center flex-1 self-stretch rounded-t-lg border-[1.575px] border-dashed border-[#C3C6D4]",children:m.jsxs("div",{className:"flex flex-col justify-center items-center gap-4 flex-1 px-4 py-4",children:[m.jsx("img",{src:"https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://id.xyz/verify",alt:"QR Code",className:"w-[134px] h-[134px] flex-shrink-0"}),m.jsx("div",{className:"flex flex-col justify-center items-center gap-2 max-w-[280px]",children:m.jsx("div",{className:"flex w-full flex-col items-center",children:m.jsxs("div",{className:"w-full text-center font-roboto text-[13px] font-normal leading-[20px]",children:[m.jsx("span",{className:"text-[#676879]",children:"Continue on another device by scanning the QR code or opening"}),m.jsx("span",{className:"text-[#0073EA] break-all block",children:"https://id.xyz/verify"})]})})})]})})}),m.jsxs("div",{className:"flex w-full px-4 py-4 items-center justify-end gap-2 flex-shrink-0 bg-[#F6F7FB] rounded-b-lg",children:[m.jsxs("svg",{width:"21",height:"21",viewBox:"0 0 21 21",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"w-[21px] h-[21px] flex-shrink-0",children:[m.jsx("g",{clipPath:"url(#clip0_7664_76472)",children:m.jsx("path",{d:"M10.4991 13.9988V10.4991M10.4991 6.99948H10.5079M19.2483 10.4991C19.2483 15.3311 15.3311 19.2483 10.4991 19.2483C5.66712 19.2483 1.75 15.3311 1.75 10.4991C1.75 5.66712 5.66712 1.75 10.4991 1.75C15.3311 1.75 19.2483 5.66712 19.2483 10.4991Z",stroke:"#0073EA",strokeWidth:"1.57484",strokeLinecap:"round",strokeLinejoin:"round"})}),m.jsx("defs",{children:m.jsx("clipPath",{id:"clip0_7664_76472",children:m.jsx("rect",{width:"20.9979",height:"20.9979",fill:"white"})})})]}),m.jsx("div",{className:"text-[#0073EA] font-roboto text-[13px] font-normal leading-[21px]",children:"How does this work?"})]})]})]})})]})})}function Bz({section:n,sectionIndex:e,currentStep:t,isExpanded:r,onToggle:s,onSectionFocus:o,formData:i,setFormData:a,isEmailVerified:l,isPhoneVerified:c,emailLocked:u,onSendEmailOTP:d,onSendPhoneOTP:f,onIdentityDocumentComplete:p,onSelfieComplete:x,submissionId:v,shortCode:y,templateVersionId:b,userId:w,isFilled:S,documentFormState:k,setDocumentFormState:N,onDocumentUploaded:I,biometricFormState:T,setBiometricFormState:F,formVersion:R,docsVersion:D,connectionRef:A,shouldMaintainConnection:P,onHandoffConnected:B}){const[L,W]=_.useState(!1),H=()=>{W(!0)},G=()=>{if(e>t)return m.jsx("div",{className:"flex w-full h-[308px] border-t border-border bg-background",children:m.jsx(Lz,{message:"This step is locked until you complete the previous step."})});switch(n.sectionType){case"personalInformation":{if(!i||!a)return null;const M=n.fieldMappings?.[0]?.structure?.personalInfo??{},j={...M,requiredToggles:M?.requiredToggles??{}};return m.jsx("div",{className:"flex py-5 px-[34px] flex-col items-start self-stretch border-t border-border bg-background",children:m.jsx(E$,{formData:i,setFormData:a,isEmailVerified:l||!1,isPhoneVerified:c||!1,onSendEmailOTP:d||(()=>{}),onSendPhoneOTP:f||(()=>{}),fieldConfig:j,emailLocked:!!u},`pi-${R}`)})}case"documents":{const M=n.fieldMappings?.[0]?.structure?.documentVerification??{},j={allowUploadFromDevice:!!M.allowUploadFromDevice,allowCaptureWebcam:!!M.allowCaptureWebcam,documentHandling:M.documentHandlingRejectImmediately?"reject":M.documentHandlingAllowRetries?"retry":"",retryAttempts:Number(M.retryAttempts)||0,allowedFileTypes:Array.isArray(M.allowedFileTypes)?M.allowedFileTypes:[],supportedCountries:Array.isArray(M.supportedCountries)?M.supportedCountries:[],selectedCountries:Array.isArray(M.selectedCountries)?M.selectedCountries:[],selectedDocuments:Array.isArray(M.selectedDocuments)?M.selectedDocuments:[]};return m.jsxs("div",{className:"flex py-4 px-[34px] flex-col items-start self-stretch border-t border-[#DEDEDD] bg-white",children:[m.jsxs("div",{className:"text-xs text-muted-foreground flex flex-wrap gap-2 mb-3",children:[m.jsxs("span",{className:"px-2 py-1 rounded-full border bg-white",children:["Upload:"," ",j.allowUploadFromDevice?"Device ":"Device "]}),m.jsxs("span",{className:"px-2 py-1 rounded-full border bg-white",children:["Capture:"," ",j.allowCaptureWebcam?"Webcam ":"Webcam "]}),m.jsxs("span",{className:"px-2 py-1 rounded-full border bg-white",children:["Handling: ",j.documentHandling||""]}),j.documentHandling==="retry"&&m.jsxs("span",{className:"px-2 py-1 rounded-full border bg-white",children:["Retries: ",j.retryAttempts]}),!!j.allowedFileTypes.length&&m.jsxs("span",{className:"px-2 py-1 rounded-full border bg-white",children:["File types:"," ",j.allowedFileTypes.join(", ").toUpperCase()]})]}),m.jsx(O$,{onComplete:p||(()=>{}),documentConfig:j,submissionId:v,shortCode:y,templateVersionId:b,userId:w,documentFormState:k,setDocumentFormState:N,onDocumentUploaded:I,connectionRef:A,shouldMaintainConnection:P,onHandoffConnected:B},`docs-${D??0}`)]})}case"biometrics":{const M=n.fieldMappings?.[0]?.structure?.biometricVerification??{},j={maxRetries:Number(M.maxRetries)||0,askUserRetry:!!M.askUserRetry,blockAfterRetries:!!M.blockAfterRetries,dataRetention:M.dataRetention||"",livenessThreshold:Number(M.livenessThreshold)||0,faceMatchThreshold:Number(M.faceMatchThreshold)||0};return m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"flex w-full py-3 px-[34px] border-t border-border bg-background",children:m.jsxs("div",{className:"text-xs text-muted-foreground flex flex-wrap gap-2",children:[m.jsxs("span",{className:"px-2 py-1 rounded-full border bg-white",children:["Max retries: ",j.maxRetries]}),m.jsxs("span",{className:"px-2 py-1 rounded-full border bg-white",children:["Liveness  ",j.livenessThreshold,"%"]}),m.jsxs("span",{className:"px-2 py-1 rounded-full border bg-white",children:["Face match  ",j.faceMatchThreshold,"%"]}),m.jsxs("span",{className:"px-2 py-1 rounded-full border bg-white",children:["On low score:"," ",j.askUserRetry?"Ask to retry":j.blockAfterRetries?"Block after retries":""]}),j.dataRetention&&m.jsxs("span",{className:"px-2 py-1 rounded-full border bg-white",children:["Retention: ",j.dataRetention]})]})}),L?m.jsx("div",{className:"flex w-full flex-col gap-4 rounded bg-white",children:m.jsxs("div",{className:"flex flex-col items-start self-stretch rounded border border-[#DEDEDD]",children:[m.jsxs("div",{className:"flex flex-col justify-center items-center gap-2 self-stretch bg-white px-3 py-4",children:[m.jsxs("div",{className:"flex items-center gap-2 self-stretch pb-1",children:[m.jsx("svg",{width:"19",height:"19",viewBox:"0 0 19 19",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"w-[19px] h-[19px]",children:m.jsx("path",{d:"M6.30071 9.44844H12.6001M17.3246 9.44844C17.3246 13.7972 13.7992 17.3227 9.4504 17.3227C5.10158 17.3227 1.57617 13.7972 1.57617 9.44844C1.57617 5.09963 5.10158 1.57422 9.4504 1.57422C13.7992 1.57422 17.3246 5.09963 17.3246 9.44844Z",stroke:"#323238",strokeWidth:"1.57484",strokeLinecap:"round",strokeLinejoin:"round"})}),m.jsx("div",{className:"text-[#172B4D] font-roboto text-[17px] font-bold leading-[12.6px]",children:"Biometric Capture"})]}),m.jsx("div",{className:"flex justify-center items-center gap-2.5 self-stretch pl-[29px]",children:m.jsx("div",{className:"flex-1 text-[#172B4D] font-roboto text-[14px] font-normal leading-[21px]",children:"Take a live selfie to confirm you are the person in the ID document. Make sure you're in a well-lit area and your face is clearly visible."})})]}),m.jsx("div",{className:"flex w-full flex-col justify-center items-center border-t border-[#DEDEDD] bg-white p-4",children:m.jsxs("div",{className:"flex w-full flex-col lg:flex-row items-stretch lg:items-center gap-6",children:[m.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[m.jsx("div",{className:"flex h-[428px] flex-col items-center gap-2 rounded-t-lg border-[1.5px] border-dashed border-[#C3C6D4] bg-white pt-4",children:m.jsx(Mz,{onStepComplete:x||(()=>{}),userId:v})}),m.jsx("div",{className:"flex w-full px-4 py-2 items-center justify-end gap-2 rounded-b border-t-0 border-[1.5px] border-dashed border-[#C3C6D4] bg-[#F6F7FB]"})]}),m.jsxs("div",{className:"hidden lg:flex flex-col items-center justify-center gap-1 h-[428px]",children:[m.jsx("div",{className:"h-[160px] w-px bg-[#D0D4E4]"}),m.jsx("div",{className:"text-[#676879] font-roboto text-[13px] font-normal",children:"or"}),m.jsx("div",{className:"h-[160px] w-px bg-[#D0D4E4]"})]}),m.jsxs("div",{className:"flex lg:hidden w-full items-center justify-center gap-3 py-2",children:[m.jsx("div",{className:"flex-1 h-px bg-[#D0D4E4]"}),m.jsx("div",{className:"text-[#676879] font-roboto text-[13px] font-normal",children:"or"}),m.jsx("div",{className:"flex-1 h-px bg-[#D0D4E4]"})]}),m.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[m.jsxs("div",{className:"flex h-[428px] flex-col items-center justify-center gap-4 rounded-t-lg border-[1.5px] border-dashed border-[#C3C6D4] bg-white",children:[m.jsx("img",{src:"https://api.qrserver.com/v1/create-qr-code/?size=128x128&data=https://id.xyz/verify",alt:"QR Code",className:"w-32 h-32"}),m.jsx("div",{className:"flex flex-col items-center gap-3 max-w-[214px]",children:m.jsxs("p",{className:"text-[#676879] text-center font-roboto text-[13px] font-normal leading-5",children:["Continue on another device by scanning the QR code or opening"," ",m.jsx("a",{href:"https://id.xyz/verify",className:"text-[#0073EA]",target:"_blank",rel:"noopener noreferrer",children:"https://id.xyz/verify"})]})})]}),m.jsxs("div",{className:"flex w-full px-4 py-2 items-center gap-2 rounded-b border-t-0 border-[1.5px] border-dashed border-[#C3C6D4] bg-[#F6F7FB]",children:[m.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("g",{clipPath:"url(#clip0_info)",children:m.jsx("path",{d:"M10.0013 13.3307V9.9974M10.0013 6.66406H10.0096M18.3346 9.9974C18.3346 14.5997 14.6036 18.3307 10.0013 18.3307C5.39893 18.3307 1.66797 14.5997 1.66797 9.9974C1.66797 5.39502 5.39893 1.66406 10.0013 1.66406C14.6036 1.66406 18.3346 5.39502 18.3346 9.9974Z",stroke:"#0073EA",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),m.jsx("defs",{children:m.jsx("clipPath",{id:"clip0_info",children:m.jsx("rect",{width:"20",height:"20",fill:"white"})})})]}),m.jsx("span",{className:"text-[#0073EA] font-roboto text-[12px] font-normal leading-5",children:"How does this work?"})]})]})]})})]})}):m.jsx(jz,{onScanFace:H})]})}default:return m.jsx("div",{className:"flex p-4 px-6 flex-col items-start self-stretch border-t border-border bg-background",children:m.jsxs("div",{className:"text-text-primary font-roboto text-sm",children:["Unknown section type: ",n.sectionType]})})}};return n.sectionType==="biometrics"?m.jsx("div",{className:"w-full self-stretch",onClick:()=>o?.(e),onFocus:()=>o?.(e),children:G()}):m.jsx("div",{className:"flex flex-col items-start gap-4 bg-background rounded border border-[#DEDEDD]",children:m.jsxs("div",{className:"flex p-0.5 flex-col items-start self-stretch rounded-t border border-[#DEDEDD]",children:[m.jsxs("div",{className:"flex p-4 flex-col justify-center items-center gap-2 self-stretch bg-background",children:[m.jsx("div",{className:"flex pb-1 items-center gap-2 self-stretch",children:m.jsxs("button",{onClick:()=>s(e),className:"flex items-center gap-2",children:[m.jsx("svg",{className:`w-[18px] h-[18px] transform transition-transform ${r?"rotate-0":"rotate-180"}`,viewBox:"0 0 18 19",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M6.00391 9.33203H12.0039M16.5039 9.33203C16.5039 13.4741 13.146 16.832 9.00391 16.832C4.86177 16.832 1.50391 13.4741 1.50391 9.33203C1.50391 5.18989 4.86177 1.83203 9.00391 1.83203C13.146 1.83203 16.5039 5.18989 16.5039 9.33203Z",stroke:"#323238",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),m.jsx("div",{className:"text-text-primary font-roboto text-base font-bold leading-3",children:n.name})]})}),m.jsx("div",{className:"flex pl-6 justify-center items-center gap-2.5 self-stretch",children:m.jsx("div",{className:"flex-1 text-text-primary font-roboto text-[13px] font-normal leading-5",children:!r&&S?m.jsx("span",{className:"text-green-600 font-medium",children:"This section has been filled"}):n.description||`Complete the ${n.name.toLowerCase()} section.`})})]}),r&&m.jsx("div",{onClick:()=>o?.(e),onFocus:()=>o?.(e),children:G()})]})})}function Vz({section:n,sectionIndex:e,currentStep:t,onSectionFocus:r,formData:s,setFormData:o,isEmailVerified:i,isPhoneVerified:a,emailLocked:l,onSendEmailOTP:c,onSendPhoneOTP:u,onIdentityDocumentComplete:d,onSelfieComplete:f,submissionId:p,shortCode:x,templateVersionId:v,userId:y,isFilled:b,isExpanded:w,onToggle:S,documentFormState:k,setDocumentFormState:N,onDocumentUploaded:I,biometricFormState:T,setBiometricFormState:F,formVersion:R,docsVersion:D,connectionRef:A,shouldMaintainConnection:P,onHandoffConnected:B}){const[L,W]=_.useState(!1),H=()=>{W(!0)},G=()=>m.jsxs("div",{className:"flex p-4 flex-col justify-center items-center gap-2 self-stretch bg-background",children:[m.jsx("div",{className:"flex pb-1 items-center gap-2 self-stretch",children:m.jsxs("button",{onClick:()=>S?.(e),className:"flex items-center gap-2",children:[m.jsx("svg",{className:`w-[18px] h-[18px] transform transition-transform ${w?"rotate-0":"rotate-180"}`,viewBox:"0 0 18 19",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M6.00391 9.33203H12.0039M16.5039 9.33203C16.5039 13.4741 13.146 16.832 9.00391 16.832C4.86177 16.832 1.50391 13.4741 1.50391 9.33203C1.50391 5.18989 4.86177 1.83203 9.00391 1.83203C13.146 1.83203 16.5039 5.18989 16.5039 9.33203Z",stroke:"#323238",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),m.jsx("div",{className:"text-text-primary font-roboto text-base font-bold leading-3",children:n.sectionType==="biometrics"?"Biometric Verification":n.name})]})}),m.jsx("div",{className:"flex pl-7 justify-center items-center gap-2.5 self-stretch",children:m.jsx("div",{className:"flex-1 text-text-primary font-roboto text-[13px] font-normal leading-5",children:!w&&b?m.jsx("span",{className:"text-green-600 font-medium",children:"This section has been filled"}):n.description||`Complete the ${n.name.toLowerCase()} section.`})})]});return(()=>{if(e>t)return m.jsx("div",{className:"flex flex-col items-start gap-4 self-stretch rounded bg-background",children:m.jsxs("div",{className:"flex py-0 px-0.5 flex-col items-start self-stretch rounded border border-border",children:[G(),m.jsx("div",{className:"flex w-full h-[308px] border-t border-border bg-background",children:m.jsx(Lz,{message:"This step is locked until you complete the previous step."})})]})});switch(n.sectionType){case"personalInformation":{if(!s||!o)return null;const j=n.fieldMappings?.[0]?.structure?.personalInfo??{},z={...j,requiredToggles:j?.requiredToggles??{}};return m.jsx("div",{className:"flex flex-col items-start gap-4 self-stretch rounded bg-background",children:m.jsxs("div",{className:"flex py-0 px-0.5 flex-col items-start self-stretch rounded border border-border",children:[G(),w&&m.jsx("div",{className:"flex py-5 px-[34px] flex-col items-start self-stretch border-t border-border bg-background",onClick:()=>r?.(e),onFocus:()=>r?.(e),children:m.jsx(E$,{formData:s,setFormData:o,isEmailVerified:i||!1,isPhoneVerified:a||!1,onSendEmailOTP:c||(()=>{}),onSendPhoneOTP:u||(()=>{}),fieldConfig:z,emailLocked:!!l},`pi-${R}`)})]})})}case"documents":{const j=n.fieldMappings?.[0]?.structure?.documentVerification??{},z={allowUploadFromDevice:!!j.allowUploadFromDevice,allowCaptureWebcam:!!j.allowCaptureWebcam,documentHandling:j.documentHandlingRejectImmediately?"reject":j.documentHandlingAllowRetries?"retry":"",retryAttempts:Number(j.retryAttempts)||0,allowedFileTypes:Array.isArray(j.allowedFileTypes)?j.allowedFileTypes:[],supportedCountries:Array.isArray(j.supportedCountries)?j.supportedCountries:[],selectedCountries:Array.isArray(j.selectedCountries)?j.selectedCountries:[],selectedDocuments:Array.isArray(j.selectedDocuments)?j.selectedDocuments:[]};return m.jsx("div",{className:"flex flex-col items-start gap-4 self-stretch rounded bg-background",children:m.jsxs("div",{className:"flex py-0 px-0.5 flex-col items-start self-stretch rounded border border-[#DEDEDD] bg-white",children:[G(),w&&m.jsxs("div",{className:"flex py-4 px-[34px] flex-col items-start self-stretch border-t border-[#DEDEDD] bg-white",onClick:()=>r?.(e),onFocus:()=>r?.(e),children:[m.jsxs("div",{className:"text-xs text-muted-foreground flex flex-wrap gap-2 mb-3",children:[m.jsxs("span",{className:"px-2 py-1 rounded-full border bg-white",children:["Upload:"," ",z.allowUploadFromDevice?"Device ":"Device "]}),m.jsxs("span",{className:"px-2 py-1 rounded-full border bg-white",children:["Capture:"," ",z.allowCaptureWebcam?"Webcam ":"Webcam "]}),m.jsxs("span",{className:"px-2 py-1 rounded-full border bg-white",children:["Handling: ",z.documentHandling||""]}),z.documentHandling==="retry"&&m.jsxs("span",{className:"px-2 py-1 rounded-full border bg-white",children:["Retries: ",z.retryAttempts]}),!!z.allowedFileTypes.length&&m.jsxs("span",{className:"px-2 py-1 rounded-full border bg-white",children:["File types:"," ",z.allowedFileTypes.join(", ").toUpperCase()]})]}),m.jsx(O$,{onComplete:d||(()=>{}),documentConfig:z,submissionId:p,shortCode:x,templateVersionId:v,userId:y,documentFormState:k,setDocumentFormState:N,onDocumentUploaded:I,connectionRef:A,shouldMaintainConnection:P,onHandoffConnected:B},`docs-${D??0}`)]})]})})}case"biometrics":{const j=n.fieldMappings?.[0]?.structure?.biometricVerification??{},z={maxRetries:Number(j.maxRetries)||0,askUserRetry:!!j.askUserRetry,blockAfterRetries:!!j.blockAfterRetries,dataRetention:j.dataRetention||"",livenessThreshold:Number(j.livenessThreshold)||0,faceMatchThreshold:Number(j.faceMatchThreshold)||0};return m.jsxs("div",{className:"w-full self-stretch",onClick:()=>r?.(e),onFocus:()=>r?.(e),children:[m.jsx("div",{className:"flex w-full py-3 px-[34px] border-t border-border bg-background",children:m.jsxs("div",{className:"text-xs text-muted-foreground flex flex-wrap gap-2",children:[m.jsxs("span",{className:"px-2 py-1 rounded-full border bg-white",children:["Max retries: ",z.maxRetries]}),m.jsxs("span",{className:"px-2 py-1 rounded-full border bg-white",children:["Liveness  ",z.livenessThreshold,"%"]}),m.jsxs("span",{className:"px-2 py-1 rounded-full border bg-white",children:["Face match  ",z.faceMatchThreshold,"%"]}),m.jsxs("span",{className:"px-2 py-1 rounded-full border bg-white",children:["On low score:"," ",z.askUserRetry?"Ask to retry":z.blockAfterRetries?"Block after retries":""]}),z.dataRetention&&m.jsxs("span",{className:"px-2 py-1 rounded-full border bg-white",children:["Retention: ",z.dataRetention]})]})}),L?m.jsx("div",{className:"flex w-full flex-col gap-4 rounded bg-white",children:m.jsxs("div",{className:"flex flex-col items-start self-stretch rounded border border-[#DEDEDD]",children:[m.jsxs("div",{className:"flex flex-col justify-center items-center gap-2 self-stretch bg-white px-3 py-4",children:[m.jsxs("div",{className:"flex items-center gap-2 self-stretch pb-1",children:[m.jsx("svg",{width:"19",height:"19",viewBox:"0 0 19 19",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"w-[19px] h-[19px]",children:m.jsx("path",{d:"M6.30071 9.44844H12.6001M17.3246 9.44844C17.3246 13.7972 13.7992 17.3227 9.4504 17.3227C5.10158 17.3227 1.57617 13.7972 1.57617 9.44844C1.57617 5.09963 5.10158 1.57422 9.4504 1.57422C13.7992 1.57422 17.3246 5.09963 17.3246 9.44844Z",stroke:"#323238",strokeWidth:"1.57484",strokeLinecap:"round",strokeLinejoin:"round"})}),m.jsx("div",{className:"text-[#172B4D] font-roboto text-[17px] font-bold leading-[12.6px]",children:"Biometric Capture"})]}),m.jsx("div",{className:"flex justify-center items-center gap-2.5 self-stretch pl-[29px]",children:m.jsx("div",{className:"flex-1 text-[#172B4D] font-roboto text-[14px] font-normal leading-[21px]",children:"Take a live selfie to confirm you are the person in the ID document. Make sure you're in a well-lit area and your face is clearly visible."})})]}),m.jsx("div",{className:"flex w-full flex-col justify-center items-center border-t border-[#DEDEDD] bg-white p-4",children:m.jsxs("div",{className:"flex w-full flex-col xl:flex-row justify-center items-stretch gap-6 p-2",children:[m.jsxs("div",{className:"flex flex-1 min-w-0 flex-col flex-shrink-0",children:[m.jsx("div",{className:"flex h-[480px] flex-col items-center gap-2 rounded-t-lg border-[1.5px] border-dashed border-[#C3C6D4] bg-white pt-4 px-2",children:m.jsx(Mz,{onStepComplete:f||(()=>{}),userId:p})}),m.jsx("div",{className:"flex w-full px-4 py-2 items-center justify-end gap-2 rounded-b border-t-0 border-[1.5px] border-dashed border-[#C3C6D4] bg-[#F6F7FB]"})]}),m.jsxs("div",{className:"hidden xl:flex flex-col items-center justify-center gap-1 h-[100px]",children:[m.jsx("div",{className:"h-[36px] w-px bg-[#D0D4E4]"}),m.jsx("div",{className:"text-[#676879] font-roboto text-[13px] font-normal",children:"or"}),m.jsx("div",{className:"h-[36px] w-px bg-[#D0D4E4]"})]}),m.jsxs("div",{className:"flex xl:hidden w-full justify-center items-center gap-2 py-4",children:[m.jsx("div",{className:"w-[36px] h-px bg-[#D0D4E4]"}),m.jsx("div",{className:"text-[#676879] font-roboto text-[13px] font-normal",children:"or"}),m.jsx("div",{className:"w-[36px] h-px bg-[#D0D4E4]"})]}),m.jsxs("div",{className:"flex flex-1 min-w-0 flex-col flex-shrink-0",children:[m.jsxs("div",{className:"flex h-[480px] flex-col items-center justify-center gap-4 rounded-t-lg border-[1.5px] border-dashed border-[#C3C6D4] bg-white px-4 py-6",children:[m.jsx("img",{src:"https://api.qrserver.com/v1/create-qr-code/?size=128x128&data=https://id.xyz/verify",alt:"QR Code",className:"w-32 h-32 flex-shrink-0"}),m.jsx("div",{className:"flex flex-col items-center gap-3 max-w-[300px] px-2",children:m.jsxs("p",{className:"text-[#676879] text-center font-roboto text-[13px] font-normal leading-5",children:["Continue on another device by scanning the QR code or opening"," ",m.jsx("a",{href:"https://id.xyz/verify",className:"text-[#0073EA]",target:"_blank",rel:"noopener noreferrer",children:"https://id.xyz/verify"})]})})]}),m.jsxs("div",{className:"flex w-full px-4 py-2 items-center gap-2 rounded-b border-t-0 border-[1.5px] border-dashed border-[#C3C6D4] bg-[#F6F7FB]",children:[m.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("g",{clipPath:"url(#clip0_info)",children:m.jsx("path",{d:"M10.0013 13.3307V9.9974M10.0013 6.66406H10.0096M18.3346 9.9974C18.3346 14.5997 14.6036 18.3307 10.0013 18.3307C5.39893 18.3307 1.66797 14.5997 1.66797 9.9974C1.66797 5.39502 5.39893 1.66406 10.0013 1.66406C14.6036 1.66406 18.3346 5.39502 18.3346 9.9974Z",stroke:"#0073EA",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),m.jsx("defs",{children:m.jsx("clipPath",{id:"clip0_info",children:m.jsx("rect",{width:"20",height:"20",fill:"white"})})})]}),m.jsx("span",{className:"text-[#0073EA] font-roboto text-[12px] font-normal leading-5",children:"How does this work?"})]})]})]})})]})}):m.jsx(jz,{onScanFace:H})]})}default:return m.jsx("div",{className:"flex flex-col items-start gap-4 self-stretch rounded bg-background",children:m.jsxs("div",{className:"flex py-0 px-0.5 flex-col items-start self-stretch rounded border border-border",children:[G(),w&&m.jsx("div",{className:"flex p-4 flex-col items-start self-stretch border-t border-border bg-background",onClick:()=>r?.(e),onFocus:()=>r?.(e),children:m.jsxs("div",{className:"text-text-primary font-roboto text-sm",children:["Unknown section type: ",n.sectionType]})})]})})}})()}function zz({isOpen:n,onClose:e,onVerify:t,recipientEmail:r,recipientPhone:s,type:o,onResend:i,nonDismissable:a=!1,helperText:l=null,errorText:c=null,headline:u,bodyText:d}){const f=o==="phone"||!a,[p,x]=_.useState(["","","","","",""]),[v,y]=_.useState(!1),b=_.useRef([]),w=o==="email"?r:s,S=u??(o==="email"?"Check your email":"Check your phone"),k=d??`We sent a one-time passcode to ${w??(o==="email"?"your email":"your phone")}.`;_.useEffect(()=>{if(!n)return;x(["","","","","",""]),y(!1);const D=window.setTimeout(()=>b.current[0]?.focus(),100);return()=>window.clearTimeout(D)},[n]),_.useEffect(()=>{if(!n)return;const D=A=>{A.key==="Escape"&&(f?e():(A.preventDefault(),A.stopPropagation()))};return window.addEventListener("keydown",D,{capture:!0}),()=>window.removeEventListener("keydown",D,{capture:!0})},[n,f,e]),_.useEffect(()=>{if(!n)return;const D=document.body,A=document.documentElement,P=D.style.overflow,B=D.style.paddingRight,L=window.innerWidth-A.clientWidth;L>0&&(D.style.paddingRight=`${L}px`),D.style.overflow="hidden";const W=H=>H.preventDefault();return document.addEventListener("touchmove",W,{passive:!1}),()=>{D.style.overflow=P,D.style.paddingRight=B,document.removeEventListener("touchmove",W)}},[n]);const N=(D,A)=>{if(A.length>1||A&&!/^\d$/.test(A))return;const P=[...p];P[D]=A,x(P),A&&D<5&&b.current[D+1]?.focus()},I=(D,A)=>{A.key==="Backspace"&&!p[D]&&D>0||A.key==="ArrowLeft"&&D>0?b.current[D-1]?.focus():A.key==="ArrowRight"&&D<5&&b.current[D+1]?.focus()},T=D=>{D.preventDefault();const A=D.clipboardData.getData("text").replace(/\D/g,"").slice(0,6);if(!A)return;const P=[...p];for(let L=0;L<6;L++)P[L]=A[L]||"";x(P);const B=P.findIndex(L=>L==="");b.current[B===-1?5:Math.min(B,5)]?.focus()},F=async()=>{const D=p.join("");if(D.length===6){y(!0);try{await t(D)}finally{y(!1)}}},R=p.every(D=>D!=="");return n?m.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center","aria-modal":"true",role:"dialog",children:[m.jsx("div",{className:"absolute inset-0 bg-black/30 backdrop-blur-sm",onClick:f?e:void 0}),m.jsx("div",{className:"relative w-full max-w-[408px] mx-4 bg-white rounded-lg shadow-xl",children:m.jsxs("div",{className:"flex flex-col p-6 pb-6 gap-4 max-h-[80vh] overflow-y-auto",children:[m.jsx("div",{className:"flex justify-end",children:f&&m.jsx("button",{onClick:e,className:"flex w-8 h-8 justify-center items-center rounded-full bg-white hover:bg-gray-50 transition-colors","aria-label":"Close dialog",title:"Close",children:m.jsx(T$,{width:20,height:20})})}),m.jsxs("div",{className:"flex flex-col gap-1 text-center",children:[m.jsx("h2",{className:"text-text-primary font-roboto text-[22px] font-bold leading-[32px]",children:S}),m.jsx("p",{className:"text-text-muted font-roboto text-sm leading-[20px]",children:k}),l&&m.jsx("p",{className:"text-[12px] text-gray-500 mt-1",children:l})]}),m.jsx("div",{className:"flex justify-center gap-2 mt-2",children:p.map((D,A)=>m.jsx("input",{ref:P=>b.current[A]=P,type:"text",inputMode:"numeric",maxLength:1,value:D,onChange:P=>N(A,P.target.value),onKeyDown:P=>I(A,P),onPaste:A===0?T:void 0,className:"w-12 h-[54px] text-center text-lg font-medium border border-input-border rounded bg-white focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary transition-colors","aria-label":`Digit ${A+1}`},A))}),c&&m.jsx("div",{className:"text-center text-[12px] text-red-600 -mt-1",children:c}),m.jsxs("div",{className:"text-center",children:[m.jsx("span",{className:"text-text-muted font-roboto text-sm",children:"Didn't get a code? "}),m.jsx("button",{onClick:i,className:"text-primary font-roboto text-sm underline hover:text-primary/80 transition-colors",children:"Click to Resend"})]}),m.jsx("button",{onClick:F,disabled:!R||v,className:`w-full h-12 px-4 flex justify-center items-center gap-2 rounded font-roboto text-base font-bold transition-colors ${R&&!v?"bg-primary text-white hover:bg-primary/90":"bg-primary/50 text-white cursor-not-allowed"}`,children:v?m.jsxs(m.Fragment,{children:[m.jsx(Wk,{className:"w-4 h-4 animate-spin"}),"Verifying..."]}):"Verify"})]})})]}):null}const us="https://idvapi-test.arconnet.com:1019",E4=!0,Uh=()=>typeof window<"u"&&localStorage.getItem("access")||null;function s9e({templateId:n,userId:e,shortCode:t}){const{toast:r}=pd(),s=si(),[o,i]=_.useState(null);_.useEffect(()=>{console.log("[templateVersion] Updated:",o)},[o]);const[a,l]=_.useState(!0),[c,u]=_.useState(null),[d,f]=_.useState(1),[p,x]=_.useState(!1),[v,y]=_.useState(!1),[b,w]=_.useState(!1),[S,k]=_.useState(!1),[N,I]=_.useState(!1),[T,F]=_.useState(!1),[R,D]=_.useState(!1),[A,P]=_.useState(!1),[B,L]=_.useState(()=>typeof window<"u"&&!!localStorage.getItem("access")),[W,H]=_.useState(!1),[G,M]=_.useState(!0),[j,z]=_.useState(null),[V,K]=_.useState(!1),[J,oe]=_.useState({1:!0}),[Z,de]=_.useState({}),[pe,Ce]=_.useState(1),[Ae,ze]=_.useState(!1),[et,gt]=_.useState("email"),[dt,Ct]=_.useState(null),[lt,bt]=_.useState(!1),[rn,Ft]=_.useState(!1),[vn,te]=_.useState(!1),[q,ke]=_.useState(null);_.useEffect(()=>{console.log("[submissionId] Updated:",q)},[q]);const[He,Ke]=_.useState("AAAAAAAAAAAAAAAAAAAAAA=="),[Be,ct]=_.useState(0),[Nt,Rt]=_.useState(0),sn=_.useRef(null),Kn=_.useRef(!0),[Ee,Ge]=_.useState(!1),[Q,ht]=_.useState({firstName:"",lastName:"",middleName:"",dateOfBirth:"",email:"",countryCode:"",phoneNumber:"",gender:"",address:"",city:"",postalCode:"",permanentAddress:"",permanentCity:"",permanentPostalCode:""});_.useEffect(()=>{console.log(" [formData] Updated:",Q)},[Q]);const[it,Yt]=_.useState({country:"",selectedDocument:"",uploadedDocuments:[],uploadedFiles:[],documentUploadIds:{},documentsDetails:[]}),cn=ve=>{Yt(ae=>{const ce=typeof ve=="function"?ve(ae):ve;return console.log(" doc state ->",ce),ce})},[Lt,On]=_.useState({capturedImage:null,isImageCaptured:!1}),An=()=>{if(!o)return{};const ve=o.sections.find(ce=>ce.sectionType==="personalInformation");return!ve||!ve.fieldMappings?.[0]?.structure?{}:ve.fieldMappings[0].structure.personalInfo||{}};_.useEffect(()=>{if(!t){M(!1);return}const ve=new AbortController;return(async()=>{try{M(!0);const ae=await fetch(`${us}/api/templates-link-generation/resolve?shortCode=${encodeURIComponent(t)}`,{headers:{Accept:"application/json"},signal:ve.signal});if(!ae.ok){const Pe=await ae.text().catch(()=>"");throw new Error(Pe||"Failed to resolve link")}const ce=await ae.json();z(ce?.templateVersionId??null),ce?.user?.email&&ht(Pe=>({...Pe,email:ce.user.email}))}catch(ae){ae?.name==="AbortError"||r({title:"Invalid or expired link",description:ae?.message||"Could not resolve your link.",variant:"destructive"})}finally{M(!1)}})(),()=>ve.abort()},[t,us,r]),_.useEffect(()=>{if(B)return;const ve=sessionStorage.getItem("digilocker_auth_code"),ae=sessionStorage.getItem("digilocker_skip_consent"),ce=!!ve||!!ae,Pe=typeof window<"u"&&localStorage.getItem("access");ce||Pe?(L(!0),sessionStorage.removeItem("digilocker_skip_consent")):P(!0)},[B]);const Jn=j??n;_.useEffect(()=>{if(!Jn){u("No template/version ID provided"),l(!1);return}const ve=new AbortController;return(async()=>{try{l(!0);const ae=await fetch(`${us}/api/TemplateVersion/${Jn}`,{headers:{Accept:"application/json"},signal:ve.signal});if(!ae.ok){const Pe=await ae.text().catch(()=>"");throw new Error(Pe||`Failed to fetch version ${Jn}`)}const ce=await ae.json();i(ce)}catch(ae){ae?.name!=="AbortError"&&u(ae?.message||"Failed to load template version")}finally{l(!1)}})(),()=>ve.abort()},[Jn,us]),_.useEffect(()=>{o&&e&&!q&&(async()=>{if(!(!o||!e||q))try{const ae=await fetch(`${us}/api/UserTemplateSubmissions?TemplateVersionId=${o.versionId}&UserId=${e}`,{method:"GET",headers:{Accept:"application/json"}});if(ae.ok){const Ie=await ae.json();if(Ie.items&&Ie.items.length>0){const Ye=Ie.items[0];ke(Ye.id),localStorage.setItem("submissionId",Ye.id.toString());return}}const ce=await fetch(`${us}/api/UserTemplateSubmissions`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({templateVersionId:o.versionId,userId:e})});if(!ce.ok)throw new Error("Failed to create template submission");const Pe=await ce.json();ke(Pe.id),localStorage.setItem("submissionId",Pe.id.toString())}catch(ae){console.error("Error with UserTemplateSubmission:",ae),r({title:"Initialization Error",description:"Failed to initialize form submission. Please refresh and try again.",variant:"destructive"})}})()},[o,e,q,us,r]),_.useEffect(()=>{if(q){const ve=localStorage.getItem(`personalInfoETag_${q}`);ve&&(console.log(" Loaded Personal Info eTag from localStorage:",ve),Ke(ve))}},[q]),_.useEffect(()=>{if(!q||!o)return;(async()=>{try{const ae=await fetch(`${us}/api/UserTemplateSubmissionValues/submissions/${q}/values`,{method:"GET",headers:{Accept:"application/json"}});if(!ae.ok){console.error("Failed to fetch submission values:",ae.status);return}const ce=await ae.json(),Pe=new Set;ce.forEach(vt=>{const jt=o.sections.find(tt=>tt.id===vt.templateSectionId);if(jt){Pe.add(vt.templateSectionId);try{let tt;if(typeof vt.fieldValue=="string"?tt=JSON.parse(vt.fieldValue):tt=vt.fieldValue,jt.sectionType==="personalInformation"&&(console.log(" [fetchSubmissionValues] Updating personal info fields:",tt),ht(Kt=>{const Vn={...Kt,firstName:tt.firstName??Kt.firstName,lastName:tt.lastName??Kt.lastName,middleName:tt.middleName??Kt.middleName,dateOfBirth:tt.dateOfBirth??Kt.dateOfBirth,email:tt.email??Kt.email,countryCode:tt.countryCode??Kt.countryCode,phoneNumber:tt.phoneNumber??Kt.phoneNumber,gender:tt.gender??Kt.gender,address:tt.address??Kt.address,city:tt.city??Kt.city,postalCode:tt.postalCode??Kt.postalCode,permanentAddress:tt.permanentAddress??Kt.permanentAddress,permanentCity:tt.permanentCity??Kt.permanentCity,permanentPostalCode:tt.permanentPostalCode??Kt.permanentPostalCode};return console.log(" [fetchSubmissionValues] setFormData called with:",Vn),Vn}),vt.eTag)){const Kt=vt.eTag.replace(/^W\/"|"$/g,"");console.log(" Extracted Personal Info eTag from GET:",vt.eTag),console.log(" Cleaned eTag:",Kt),Ke(Kt),localStorage.setItem(`personalInfoETag_${q}`,Kt)}if(jt.sectionType==="documents"&&tt){const Kt=tt.documents||[],Vn=[],Nn={};Kt.forEach(vr=>{const Wn=vr.documentName.toLowerCase().replace(/\s+/g,"_");Vn.push(Wn),Nn[Wn]={front:vr.frontFileId,...vr.backFileId&&{back:vr.backFileId}}}),Yt(vr=>({...vr,country:tt.country||vr.country,uploadedDocuments:Vn,documentUploadIds:Nn,documentsDetails:Kt})),Kt.length>0&&k(!0),Rt(vr=>vr+1)}jt.sectionType==="biometrics"&&tt&&(On(Kt=>({...Kt,capturedImage:tt.capturedImage||Kt.capturedImage,isImageCaptured:tt.isImageCaptured||Kt.isImageCaptured})),tt.isImageCaptured&&D(!0))}catch(tt){console.error("Error parsing fieldValue for section:",jt.sectionType,tt)}}});const Ie=o.sections.filter(vt=>vt.isActive).sort((vt,jt)=>vt.orderIndex-jt.orderIndex),Ye={};Ie.forEach((vt,jt)=>{const tt=jt+1;Pe.has(vt.id)&&(Ye[tt]=!0)}),de(Ye)}catch(ae){console.error("Error fetching submission values:",ae)}})()},[q,o,us]),_.useEffect(()=>{if(console.log("[SignalR useEffect] RUNNING:",{signalRConnection:!!sn.current,submissionId:q,templateVersionLoaded:!!o}),!sn.current||!q||!o){console.log("[SignalR useEffect] EARLY RETURN:",{signalRConnection:!!sn.current,submissionId:q,templateVersionLoaded:!!o});return}const ve=sn.current,ae=Ov();console.log(" IdentityVerificationPage - SignalR listeners active (Device ID:",ae+")");const ce=async Ie=>{if(console.log(""),console.log(" SignalR Event: personal.updated received"),console.log(""),console.log(" RAW Data:",JSON.stringify(Ie,null,2)),console.log(" Message Device ID:",Ie?.deviceId),console.log(" Current Device ID:",ae),console.log(" Device IDs Match?",Ie?.deviceId===ae),console.log(" Should Update?",Ie.deviceId&&Ie.deviceId!==ae),Ie.deviceId&&Ie.deviceId!==ae){console.log(" Different device detected - fetching updated data...");try{const Ye=await fetch(`${us}/api/UserTemplateSubmissionValues/submissions/${q}/values`,{method:"GET",headers:{Accept:"application/json"}});if(Ye.ok){const jt=(await Ye.json()).find(tt=>o.sections.find(Vn=>Vn.id===tt.templateSectionId)?.sectionType==="personalInformation");if(jt){let tt;typeof jt.fieldValue=="string"?tt=JSON.parse(jt.fieldValue):tt=jt.fieldValue,console.log(" Updating Personal Information form from other device"),console.log(" Parsed personal info data:",tt);const Kt={firstName:tt.firstName||"",lastName:tt.lastName||"",middleName:tt.middleName||"",dateOfBirth:tt.dateOfBirth||"",email:tt.email||"",countryCode:tt.countryCode||"",phoneNumber:tt.phoneNumber||"",gender:tt.gender||"",address:tt.address||"",city:tt.city||"",postalCode:tt.postalCode||"",permanentAddress:tt.permanentAddress||"",permanentCity:tt.permanentCity||"",permanentPostalCode:tt.permanentPostalCode||""};if(console.log(" New formData object:",Kt),ht(Kt),console.log(" setFormData called - form should update now"),ct(Vn=>Vn+1),console.log(" Incremented formUpdateKey to force remount"),Ie.data?.eTag){const Vn=Ie.data.eTag.replace(/^W\/"|"$/g,"");console.log(" Updating eTag:",Vn),Ke(Vn),localStorage.setItem(`personalInfoETag_${q}`,Vn)}r({title:" Update from other device",description:"Personal information has been updated from another device.",duration:3e3}),console.log(" Personal information update completed")}else console.warn(" No personal information submission found in response")}else console.error(" Failed to fetch submission values:",Ye.status)}catch(Ye){console.error(" Error refreshing personal info:",Ye)}}else console.log(" Same device - skipping update"),console.log("   Reason: deviceId match or missing");console.log(`
`)},Pe=async Ie=>{console.log(" IdentityVerificationPage - file.upload.completed:",JSON.stringify(Ie,null,2)),await new Promise(vt=>setTimeout(vt,1e3));const Ye=Ie.deviceId&&Ie.deviceId===ae;if(console.log(" Message Device ID:",Ie?.deviceId),console.log(" Current Device ID:",ae),console.log(" Device IDs Match?",Ye),console.log(" Should Update?",!Ie.deviceId||!Ye),!Ie.deviceId||!Ye){console.log(" Refreshing documents after file.upload.completed...");try{const vt=await fetch(`${us}/api/UserTemplateSubmissionValues/submissions/${q}/values`,{method:"GET",headers:{Accept:"application/json"}});if(vt.ok){const tt=(await vt.json()).find(Kt=>o.sections.find(Nn=>Nn.id===Kt.templateSectionId)?.sectionType==="documents");if(tt){const Kt=typeof tt.fieldValue=="string"?JSON.parse(tt.fieldValue):tt.fieldValue,Vn=Kt?.documents||[];console.log(" Updating Documents from other/missing device");const Nn=[],vr={};Vn.forEach(Un=>{const ur=Un.documentName.toLowerCase().replace(/\s+/g,"_");Nn.push(ur),vr[ur]={front:Un.frontFileId,...Un.backFileId&&{back:Un.backFileId},...Un.frontETag&&{frontETag:Un.frontETag},...Un.backETag&&{backETag:Un.backETag}}}),Yt(Un=>({...Un,country:Kt.country||Un.country,uploadedDocuments:Nn,documentUploadIds:vr,documentsDetails:Vn})),Vn.length>0&&k(!0),r({title:" Update from other device",description:"Documents have been updated from another device or session.",duration:3e3}),Rt(Un=>Un+1)}}}catch(vt){console.error(" Error refreshing documents:",vt)}}else console.log(" Same device - skipping update")};return ve.on("personal.updated",ce),ve.on("file.upload.completed",Pe),()=>{ve.off("personal.updated",ce),ve.off("file.upload.completed",Pe)}},[sn.current,q,o,us,r,ht,Yt,k,Ke]),_.useEffect(()=>{if(!o||Object.keys(Z).length===0||T||!Object.values(Z).some(Boolean))return;const ae=o.sections.filter(Ye=>Ye.isActive).sort((Ye,vt)=>Ye.orderIndex-vt.orderIndex),ce=[];let Pe=null;const Ie={};if(ae.forEach((Ye,vt)=>{const jt=vt+1;Z[jt]?(ce.push(Ye.name),Ie[jt]=!0):Pe===null&&(Pe=jt,Ie[jt]=!0)}),ce.length>0){const Ye=ce.length,vt=ae.length,jt=Pe||ae.length;f(jt),oe(Ie),setTimeout(()=>{const tt=Pe?ae[Pe-1]?.name:null;r({title:" Welcome Back!",description:`You've already completed ${Ye}/${vt} section${Ye>1?"s":""}: ${ce.join(", ")}${tt?`. Continue with ${tt}.`:""}`,duration:6e3}),F(!0)},500)}},[Z,o,T,r]);const nr=async(ve,ae)=>{if(!o||!e||!q)return;if(ve.sectionType==="personalInformation"){const Pe=An(),Ie={};Pe.firstName&&(Ie.firstName=Q.firstName),Pe.lastName&&(Ie.lastName=Q.lastName),Pe.middleName&&(Ie.middleName=Q.middleName),Pe.dateOfBirth&&(Ie.dateOfBirth=Q.dateOfBirth),Pe.email&&(Ie.email=Q.email),Pe.phoneNumber&&(Ie.countryCode=Q.countryCode,Ie.phoneNumber=Q.phoneNumber),Pe.gender&&(Ie.gender=Q.gender),Pe.currentAddress&&(Ie.address=Q.address,Ie.city=Q.city,Ie.postalCode=Q.postalCode),Pe.permanentAddress&&(Ie.permanentAddress=Q.permanentAddress,Ie.permanentCity=Q.permanentCity,Ie.permanentPostalCode=Q.permanentPostalCode);const Ye=JSON.stringify(Ie),vt=Ov(),jt=Uh();try{console.log(" PUT Personal Information with eTag:",He);const tt=await fetch(`${us}/api/personal-info/${q}/${ve.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"text/plain","If-Match":He,"X-Device-Fingerprint":vt,...jt?{Authorization:`Bearer ${jt}`}:{}},body:JSON.stringify({fieldValueJson:Ye})});if(!tt.ok)throw new Error(`PUT failed: ${tt.statusText}`);let Kt=null;const Vn=tt.headers.get("etag")||tt.headers.get("ETag");if(Vn)Kt=Vn,console.log(" Received eTag from headers:",Vn);else try{const Nn=await tt.text();Kt=JSON.parse(Nn)?.eTag||null,console.log(" Received eTag from body:",Kt)}catch(Nn){console.warn("Could not parse PUT response:",Nn)}if(Kt){const Nn=Kt.replace(/^W\/"|"$/g,"");console.log(" Cleaned eTag for storage/next request:",Nn),Ke(Nn),q&&localStorage.setItem(`personalInfoETag_${q}`,Nn)}console.log(" Personal Information saved successfully");try{const Nn=await fetch(`${us}/api/UserTemplateSubmissionValues/submissions/${q}/values`,{method:"GET",headers:{Accept:"application/json"}});Nn.ok&&(await Nn.json()).forEach(Un=>{if(o.sections.find(ur=>ur.id===Un.templateSectionId)?.sectionType==="personalInformation"&&Un.fieldValue)try{const ur=typeof Un.fieldValue=="string"?JSON.parse(Un.fieldValue):Un.fieldValue;ht({...ur})}catch{}})}catch(Nn){console.error("Failed to re-fetch personal info after PUT",Nn)}}catch(tt){console.error("Failed to PUT personal information section",tt)}return}let ce="";if(ve.sectionType==="documents"){const Pe={country:it.country,documents:ae||it.documentsDetails};ce=JSON.stringify(Pe)}else ve.sectionType==="biometrics"&&(ce=JSON.stringify({selfieUploaded:R,completedAt:new Date().toISOString()}));try{await fetch(`${us}/api/UserTemplateSubmissionValues/${q}/${ve.id}`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"*/*"},body:JSON.stringify({fieldValue:ce})})}catch(Pe){console.error("Failed to POST section data",Pe)}},gr=ve=>{const ce=(o?.sections||[]).filter(Pe=>Pe.isActive).sort((Pe,Ie)=>Pe.orderIndex-Ie.orderIndex)[ve-1];return ce?ce.sectionType==="personalInformation"?!!(Q.firstName||Q.lastName||Q.middleName||Q.dateOfBirth||Q.email||Q.phoneNumber||Q.gender||Q.address||Q.city||Q.postalCode||Q.permanentAddress||Q.permanentCity||Q.permanentPostalCode):ce.sectionType==="documents"?S:ce.sectionType==="biometrics"?R:!1:!1},_i=async ve=>{const ae=(o?.sections||[]).filter(ce=>ce.isActive).sort((ce,Pe)=>ce.orderIndex-Pe.orderIndex);if(pe!==ve&&pe>0){const ce=ae[pe-1];ce&&gr(pe)&&(ce.sectionType!=="documents"&&await nr(ce),r({title:"Progress Saved",description:`Your ${ce.name.toLowerCase()} data has been saved.`,duration:2e3}))}Ce(ve)};async function xt(ve,ae){const ce=Uh(),Pe=await fetch(`${us}/api/Otp/generate`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",...ce?{Authorization:`Bearer ${ce}`}:{}},body:JSON.stringify({email:ve,versionId:ae})});if(!Pe.ok){const Ie=Pe.status,Ye=await Pe.text().catch(()=>""),vt=new Error(Ye||"Failed to send OTP");throw vt.status=Ie,vt}}async function In(ve,ae,ce,Pe,Ie="10:00:00"){const Ye=Uh();if(Pe==null||ae==null){const tt=new Error("Missing submissionId or versionId for email verification");throw tt.status=400,tt}const vt=await fetch(`${us}/api/Otp/email/verify-and-issue`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",...Ye?{Authorization:`Bearer ${Ye}`}:{}},body:JSON.stringify({email:ve,otp:ce,submissionId:Pe,versionId:ae,accessTokenLifetime:Ie})});if(!vt.ok){const tt=vt.status,Kt=await vt.text().catch(()=>""),Vn=new Error(Kt||"Invalid OTP");throw Vn.status=tt,Vn}const jt=await vt.text().catch(()=>"");try{return jt?JSON.parse(jt):null}catch{return null}}async function _n(){const ve=Uh(),ae=Ov(),ce=await fetch(`${us}/api/session/heartbeat`,{method:"POST",headers:{Accept:"*/*","X-Device-Fingerprint":ae||"",...ve?{Authorization:`Bearer ${ve}`}:{}},body:""});if(!ce.ok){const Ie=ce.status,Ye=await ce.text().catch(()=>""),vt=new Error(Ye||"Failed to send heartbeat");throw vt.status=Ie,vt}const Pe=await ce.text().catch(()=>"");try{return Pe?JSON.parse(Pe):null}catch{return null}}async function xr(ve,ae,ce,Pe="whatsapp",Ie="phoneVerification"){const Ye=Uh(),vt=await fetch(`${us}/api/Otp/phone/start`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",...Ye?{Authorization:`Bearer ${Ye}`}:{}},body:JSON.stringify({phoneCountryCode:ve,phoneNationalNumber:ae,channel:Pe,purpose:Ie,versionId:ce})}),jt=vt.status;if(!vt.ok){const tt=await vt.text().catch(()=>""),Kt=new Error(tt||"Failed to start phone OTP");throw Kt.status=jt,Kt}return vt.json()}async function cr(ve,ae){const ce=Uh(),Pe=await fetch(`${us}/api/Otp/phone/verify`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",...ce?{Authorization:`Bearer ${ce}`}:{}},body:JSON.stringify({otpId:ve,code:String(ae).trim()})}),Ie=Pe.status,Ye=await Pe.text().catch(()=>"");let vt=null;try{vt=Ye?JSON.parse(Ye):null}catch{}if(!Pe.ok||vt&&vt.success===!1){const jt=(vt?.message||Ye||"Invalid OTP").toString(),tt=new Error(jt);throw tt.status=Ie,tt}return vt??{success:!0}}const kr=()=>j??o?.versionId??null,fr=()=>{if(!o)return!1;const ve=An(),ae=ve?.requiredToggles||{},ce=[];if(ve.firstName&&ce.push(Vr(Q.firstName)),ve.lastName&&ce.push(Vr(Q.lastName)),ve.middleName&&(ae.middleName||Q.middleName.trim())&&ce.push(Vr(Q.middleName)),ve.dateOfBirth&&(ae.dob||Q.dateOfBirth)&&ce.push(zu(Q.dateOfBirth)),ve.email){const Pe=Vu(Q.email),Ie=E4;ce.push(Pe),ce.push(Ie)}if(ve.phoneNumber){if(ae.phoneNumber){const Pe=!!Q.countryCode,Ie=zl(Q.countryCode,Q.phoneNumber),Ye=E4;ce.push(Pe),ce.push(Ie),ce.push(Ye)}else if(Q.phoneNumber){const Pe=!!Q.countryCode,Ie=zl(Q.countryCode,Q.phoneNumber),Ye=E4;ce.push(Pe),ce.push(Ie),ce.push(Ye)}}return ve.gender&&ae.gender&&ce.push(!!Q.gender),ve.currentAddress&&((ae.currentAddress||Q.address)&&ce.push(Ro(Q.address)),ae.currentCity?ce.push(!!Q.city&&Q.city.trim().length>=2):Q.city&&ce.push(Q.city.trim().length>=2),(ae.currentPostal||Q.postalCode)&&ce.push(_o(Q.postalCode))),ve.permanentAddress&&((ae.permanentAddress||Q.permanentAddress)&&ce.push(Ro(Q.permanentAddress)),ae.permanentCity?ce.push(!!Q.permanentCity&&Q.permanentCity.trim().length>=2):Q.permanentCity&&ce.push(Q.permanentCity.trim().length>=2),(ae.permanentPostal||Q.permanentPostalCode)&&ce.push(_o(Q.permanentPostalCode))),ce.length>0&&ce.every(Boolean)};_.useEffect(()=>{const ve=(o?.sections||[]).filter(ce=>ce.isActive).sort((ce,Pe)=>ce.orderIndex-Pe.orderIndex);if(fr()&&!Z[1]&&ve[0]&&(de(ce=>({...ce,1:!0})),nr(ve[0]),d===1&&!b)){const ce=ve[1];ve.length===1?r({title:" Verification Complete!",description:"All sections have been completed successfully.",duration:5e3}):(r({title:` ${ve[0]?.name||"Personal Information"} Completed`,description:"Your personal information has been saved. Opening next section...",duration:3e3}),w(!0),setTimeout(()=>{f(2),oe(Ie=>({...Ie,2:!0})),ce&&r({title:` ${ce.name}`,description:`Please complete the ${ce.name.toLowerCase()}.`,duration:4e3})},2e3))}},[o,p,v,Q.firstName,Q.lastName,Q.middleName,Q.dateOfBirth,Q.email,Q.countryCode,Q.phoneNumber,Q.address,Q.city,Q.postalCode,Q.permanentAddress,Q.permanentCity,Q.permanentPostalCode,S,R,d,b,Z,r]),_.useEffect(()=>{const ve=(o?.sections||[]).filter(ae=>ae.isActive).sort((ae,ce)=>ae.orderIndex-ce.orderIndex);if(d===2&&S&&!N){!Z[2]&&ve[1]&&de(Pe=>({...Pe,2:!0}));const ae=ve[2];ve.length===2?r({title:" Verification Complete!",description:"All sections have been completed successfully.",duration:5e3}):(r({title:` ${ve[1]?.name||"Document Verification"} Completed`,description:"Your documents have been uploaded. Opening next section...",duration:3e3}),I(!0),setTimeout(()=>{f(3),oe(Pe=>({...Pe,3:!0})),te(!1),ae&&r({title:` ${ae.name}`,description:`Please complete the ${ae.name.toLowerCase()}.`,duration:4e3})},2e3))}},[o,d,S,N,Z,r]),_.useEffect(()=>{const ve=(o?.sections||[]).filter(Ie=>Ie.isActive).sort((Ie,Ye)=>Ie.orderIndex-Ye.orderIndex);if(ve.length===0)return;const ae=Ie=>Ie==="personalInformation"?fr():Ie==="documents"?S:Ie==="biometrics"?R:!0,ce=ve.findIndex(Ie=>!ae(Ie.sectionType)),Pe=ce===-1?ve.length:ce+1;Pe!==d&&(f(Pe),oe(Ie=>({...Ie,[Pe]:!0})),te(!1))},[o,p,v,Q.firstName,Q.lastName,Q.middleName,Q.dateOfBirth,Q.email,Q.countryCode,Q.phoneNumber,Q.gender,Q.address,Q.city,Q.postalCode,Q.permanentAddress,Q.permanentCity,Q.permanentPostalCode,S,R]);const bn=async()=>{const ve=Q.email?.trim(),ae=kr();if(V){r({title:"Email verified",description:"This email is already verified."});return}if(!ve||!Vu(ve)){r({title:"Invalid email",description:"Please enter a valid email first."});return}if(ae==null){r({title:"Missing version",description:"No active template version found."});return}try{bt(!0),await xt(ve,ae),Ct({type:"email",recipient:ve}),gt("email"),ze(!0),r({title:"OTP sent",description:`We've sent a verification code to ${ve}.`})}catch(ce){r({title:"Failed to send OTP",description:`${ce?.status??"Unknown"}  Error from backend`,variant:"destructive"}),Ct({type:"email",recipient:ve??""}),gt("email"),ze(!0)}finally{bt(!1)}},Sr=async()=>{const ve=kr();if(ve==null){r({title:"Missing version",description:"No active template version found."});return}const ae=(Q.countryCode||"").trim(),ce=(Q.phoneNumber||"").replace(/\D+/g,"");if(!ae||!ce||!zl(Q.countryCode,Q.phoneNumber)){r({title:"Invalid phone",description:"Please enter a valid phone number first."});return}try{bt(!0);const{success:Pe,otpId:Ie,expiresAt:Ye}=await xr(ae,ce,ve,"whatsapp","phoneVerification");if(!Pe)throw new Error("Failed to start phone OTP.");Ct({type:"phone",recipient:`${ae} ${Q.phoneNumber}`,otpId:Ie,expiresAt:Ye}),gt("phone"),ze(!0),r({title:"OTP sent",description:`We've sent a verification code to ${ae} ${Q.phoneNumber}.`})}catch(Pe){r({title:"Failed to send OTP",description:`${Pe?.status??"Unknown"}  Error from backend`,variant:"destructive"}),Ct({type:"phone",recipient:`${ae} ${Q.phoneNumber}`}),gt("phone"),ze(!0)}finally{bt(!1)}},ls=async ve=>{if(!dt)return;if(dt.type==="email"){const ce=Q.email?.trim(),Pe=kr();if(!ce||Pe==null)return;try{if(!q){r({title:"Missing submission",description:"Submission ID not found. Please try again.",variant:"destructive"});return}Ft(!0);const Ie=await In(ce,Pe,ve,q,"10:00:00");try{Ie&&typeof Ie.accessToken=="string"&&localStorage.setItem("access",Ie.accessToken)}catch{}try{await _n(),r({title:"Session started",description:"Session heartbeat sent."})}catch(Ye){r({title:"Heartbeat Failed",description:`${Ye?.status??"Unknown"}  Error from backend`,variant:"destructive"})}x(!0),K(!0),r({title:"Email verified",description:"Your email was successfully verified."}),ze(!1),Ct(null)}catch(Ie){r({title:"OTP Validation Failed",description:`${Ie?.status??"Unknown"}  Error from backend`,variant:"destructive"}),x(!0),K(!0),r({title:"Email verified (dev bypass)",description:"Proceeding despite backend error."}),ze(!1),Ct(null)}finally{Ft(!1)}return}const ae=String(ve||"").trim();if(!dt.otpId){r({title:"Missing OTP",description:"No OTP session found. Please resend the code.",variant:"destructive"});return}try{Ft(!0);const{success:ce}=await cr(dt.otpId,ae);if(!ce)throw new Error("Invalid or expired code.");y(!0),r({title:"Phone verified",description:"Your phone number was successfully verified."}),ze(!1),Ct(null)}catch(ce){r({title:"OTP Validation Failed",description:`${ce?.status??"Unknown"}  Error from backend`,variant:"destructive"}),y(!0),r({title:"Phone verified (dev bypass)",description:"Proceeding despite backend error."}),ze(!1),Ct(null)}finally{Ft(!1)}},ia=async()=>{const ve=kr();if(dt?.type==="email"){const ae=Q.email?.trim();if(!ae||ve==null)return;try{bt(!0),await xt(ae,ve),r({title:"OTP resent",description:`A new OTP was sent to ${ae}.`})}catch(ce){r({title:"Failed to resend",description:`${ce?.status??"Unknown"}  Error from backend`,variant:"destructive"})}finally{bt(!1)}}if(dt?.type==="phone"){if(ve==null)return;const ae=(Q.countryCode||"").trim(),ce=(Q.phoneNumber||"").replace(/\D+/g,"");if(!ae||!ce)return;try{bt(!0);const{success:Pe,otpId:Ie,expiresAt:Ye}=await xr(ae,ce,ve,"whatsapp","phoneVerification");if(!Pe)throw new Error("Failed to start phone OTP.");Ct(vt=>vt?{...vt,otpId:Ie,expiresAt:Ye}:{type:"phone",recipient:`${ae} ${Q.phoneNumber}`,otpId:Ie,expiresAt:Ye}),r({title:"OTP resent",description:`A new OTP was sent to ${ae} ${Q.phoneNumber}.`})}catch(Pe){r({title:"Failed to resend",description:`${Pe?.status??"Unknown"}  Error from backend`,variant:"destructive"})}finally{bt(!1)}}},Nr=()=>{et==="email"&&!p||(ze(!1),Ct(null))},Te=()=>P(!1),Re=async()=>{if(L(!0),P(!1),typeof window<"u"&&localStorage.getItem("access"))return;const ae=(Q.email||"").trim(),ce=kr();if(ae&&ce!=null){Ct({type:"email",recipient:ae}),gt("email"),ze(!0);try{await xt(ae,ce)}catch(Pe){r({title:"Failed to send OTP",description:`${Pe?.status??"Unknown"}  Error from backend`,variant:"destructive"})}}},we=()=>{D(!0);const ve=Ut.find(Pe=>Pe.sectionType==="biometrics"),ae=Ut.findIndex(Pe=>Pe.sectionType==="biometrics")+1;de(Pe=>({...Pe,[ae]:!0})),ve&&nr(ve),ae===Ut.length?r({title:" Verification Complete!",description:"All sections have been completed successfully. Your identity verification is now complete.",duration:5e3}):(r({title:` ${ve?.name||"Biometric Verification"} Completed`,description:"Biometric verification completed successfully. Please continue to the next section.",duration:3e3}),setTimeout(()=>{const Pe=ae+1;if(Pe<=Ut.length){f(Pe),oe(Ye=>({...Ye,[Pe]:!0}));const Ie=Ut[Pe-1];r({title:` ${Ie?.name||"Next Section"}`,description:`Please complete the ${Ie?.name?.toLowerCase()||"next section"}.`,duration:4e3})}},2e3))},qe=async ve=>{const ae=Ut.find(ce=>ce.sectionType==="documents");ae&&(ve?(console.log(" handleDocumentUploaded called with updated documents:",ve),Yt(ce=>({...ce,documentsDetails:ve}))):console.log(" handleDocumentUploaded called without updated documents, using current state"),await nr(ae,ve))},Xe=()=>{k(!0);const ve=Ut.find(Pe=>Pe.sectionType==="documents"),ae=Ut.findIndex(Pe=>Pe.sectionType==="documents")+1;de(Pe=>({...Pe,[ae]:!0}));const ce=ae===Ut.length;N||(r(ce?{title:" Verification Complete!",description:"All sections have been completed successfully. Your identity verification is now complete.",duration:5e3}:{title:` ${ve?.name||"Document Verification"} Completed`,description:"Your documents have been successfully uploaded and verified. Moving to the next section...",duration:3e3}),I(!0)),ce||setTimeout(()=>{const Pe=ae+1;if(Pe<=Ut.length){f(Pe),oe(Ye=>({...Ye,[Pe]:!0}));const Ie=Ut[Pe-1];r({title:` ${Ie?.name||"Next Section"}`,description:`Please complete the ${Ie?.name?.toLowerCase()||"next section"}.`,duration:4e3})}},2e3)},wt=async()=>{if(!Tt()){const ve=qt();ve.length>0&&r({title:"Form Incomplete",description:`Please complete the following: ${ve.join(", ")}`,variant:"destructive"});return}if(!e||!o||!q){r({title:"Missing Information",description:"User ID, template version, or submission ID not found. Please refresh and try again.",variant:"destructive"});return}try{if(Kn.current=!1,sn.current){console.log(" Closing SignalR connection on form submission");try{await sn.current.stop(),console.log(" SignalR connection closed successfully")}catch(ae){console.error(" Error closing SignalR:",ae)}}r({title:"Submitting Form",description:"Please wait while we submit your information..."});const ve=o.sections.filter(ae=>ae.isActive);for(const ae of ve){let ce="";if(ae.sectionType==="personalInformation"){const Ie=An(),Ye={};Ie.firstName&&(Ye.firstName=Q.firstName),Ie.lastName&&(Ye.lastName=Q.lastName),Ie.middleName&&(Ye.middleName=Q.middleName),Ie.dateOfBirth&&(Ye.dateOfBirth=Q.dateOfBirth),Ie.email&&(Ye.email=Q.email),Ie.phoneNumber&&(Ye.countryCode=Q.countryCode,Ye.phoneNumber=Q.phoneNumber),Ie.gender&&(Ye.gender=Q.gender),Ie.currentAddress&&(Ye.address=Q.address,Ye.city=Q.city,Ye.postalCode=Q.postalCode),Ie.permanentAddress&&(Ye.permanentAddress=Q.permanentAddress,Ye.permanentCity=Q.permanentCity,Ye.permanentPostalCode=Q.permanentPostalCode),ce=JSON.stringify(Ye)}else ae.sectionType==="documents"?ce=JSON.stringify({country:it.country,documents:it.documentsDetails}):ae.sectionType==="biometrics"&&(ce=JSON.stringify({selfieUploaded:R,completedAt:new Date().toISOString()}));if(!(await fetch(`${us}/api/UserTemplateSubmissionValues/${q}/${ae.id}`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"*/*"},body:JSON.stringify({fieldValue:ce})})).ok)throw new Error(`Failed to submit ${ae.sectionType} section`)}r({title:"Form Submitted Successfully!",description:"Your identity verification form has been submitted."}),s("/verification-progress")}catch(ve){console.error("Form submission error:",ve),r({title:"Submission Failed",description:ve instanceof Error?ve.message:"Failed to submit form. Please try again.",variant:"destructive"})}},pt=async ve=>{if(ve>d){r({title:"Step locked",description:"You can only access unlocked steps. Complete the current step to continue.",variant:"destructive"});return}if(oe(ae=>({...ae,[ve]:!ae[ve]})),J[ve]&&Z[ve]){const ae=Ut[ve-1];ae&&await nr(ae)}};_.useEffect(()=>{oe(ve=>({...ve,[d]:!0})),d>=2&&te(!1)},[d]);const Ut=(o?.sections||[]).filter(ve=>ve.isActive).sort((ve,ae)=>ve.orderIndex-ae.orderIndex),Tt=()=>{if(!o)return!1;const ve=An(),ae=ve?.requiredToggles||{},ce=[];ve.firstName&&ce.push(Vr(Q.firstName)),ve.lastName&&ce.push(Vr(Q.lastName)),ve.middleName&&ae.middleName&&ce.push(Vr(Q.middleName)),ve.dateOfBirth&&ae.dob&&ce.push(zu(Q.dateOfBirth)),ve.email&&ce.push(Vu(Q.email)),ve.phoneNumber&&ae.phoneNumber&&(ce.push(!!Q.countryCode),ce.push(zl(Q.countryCode,Q.phoneNumber))),ve.gender&&ae.gender&&ce.push(!!Q.gender),ve.currentAddress&&(ae.currentAddress&&ce.push(Ro(Q.address)),ae.currentCity&&ce.push(!!Q.city&&Q.city.trim().length>=2),ae.currentPostal&&ce.push(_o(Q.postalCode))),ve.permanentAddress&&(ae.permanentAddress&&ce.push(Ro(Q.permanentAddress)),ae.permanentCity&&ce.push(!!Q.permanentCity&&Q.permanentCity.trim().length>=2),ae.permanentPostal&&ce.push(_o(Q.permanentPostalCode)));const Pe=ce.length>0&&ce.every(Boolean),Ie=o.sections.find(tt=>tt.sectionType==="documents"),Ye=o.sections.find(tt=>tt.sectionType==="biometrics"),vt=!!Ie?.isActive,jt=!!Ye?.isActive;return Pe&&(!vt||S)&&(!jt||R)},qt=()=>{if(!o)return["Template data not loaded"];const ve=An(),ae=ve?.requiredToggles||{},ce=[];return ve.firstName&&!Vr(Q.firstName)&&ce.push("First Name"),ve.lastName&&!Vr(Q.lastName)&&ce.push("Last Name"),ve.middleName&&ae.middleName&&!Vr(Q.middleName)&&ce.push("Middle Name"),ve.dateOfBirth&&ae.dob&&!zu(Q.dateOfBirth)&&ce.push("Date of Birth"),ve.email&&(Vu(Q.email)||ce.push("Valid Email")),ve.phoneNumber&&ae.phoneNumber&&(Q.countryCode?zl(Q.countryCode,Q.phoneNumber)||ce.push("Valid Phone Number"):ce.push("Country Code")),ve.gender&&ae.gender&&!Q.gender&&ce.push("Gender"),ve.currentAddress&&(ae.currentAddress&&!Ro(Q.address)&&ce.push("Current Address"),ae.currentCity&&(!Q.city||Q.city.trim().length<2)&&ce.push("Current City"),ae.currentPostal&&!_o(Q.postalCode)&&ce.push("Current Postal Code")),ve.permanentAddress&&(ae.permanentAddress&&!Ro(Q.permanentAddress)&&ce.push("Permanent Address"),ae.permanentCity&&(!Q.permanentCity||Q.permanentCity.trim().length<2)&&ce.push("Permanent City"),ae.permanentPostal&&!_o(Q.permanentPostalCode)&&ce.push("Permanent Postal Code")),o.sections.find(Ye=>Ye.sectionType==="documents")?.isActive&&!S&&ce.push("Document Verification"),o.sections.find(Ye=>Ye.sectionType==="biometrics")?.isActive&&!R&&ce.push("Selfie Verification"),ce};return G?m.jsx("div",{className:"w-full h-screen bg-page-background flex items-center justify-center",children:m.jsx("div",{className:"text-text-primary font-roboto text-lg",children:"Preparing"})}):a?m.jsx("div",{className:"w-full h-screen bg-page-background flex items-center justify-center",children:m.jsx("div",{className:"text-text-primary font-roboto text-lg",children:"Loading..."})}):c?m.jsx("div",{className:"w-full h-screen bg-page-background flex items-center justify-center",children:m.jsxs("div",{className:"text-destructive font-roboto text-lg",children:["Error: ",c]})}):!o||Ut.length===0?m.jsx("div",{className:"w-full h-screen bg-page-background flex items-center justify-center",children:m.jsx("div",{className:"text-destructive font-roboto text-lg",children:"No template data available"})}):m.jsxs(m.Fragment,{children:[m.jsx(xA,{isOpen:A&&!B,onClose:Te,onAgree:Re}),m.jsx(n$,{isOpen:W,onClose:()=>H(!1)}),m.jsx(zz,{isOpen:Ae,onClose:Nr,onVerify:ls,onResend:ia,type:et,recipientEmail:et==="email"?Q.email:void 0,nonDismissable:!0,recipientPhone:et==="phone"?`${Q.countryCode} ${Q.phoneNumber}`:void 0}),m.jsxs("div",{className:`w-full min-h-screen bg-page-background flex flex-col ${A&&!B||Ae?"opacity-70 pointer-events-none":""}`,children:[m.jsx(gA,{onMobileMenuToggle:()=>te(ve=>!ve),isMobileMenuOpen:vn}),m.jsx("div",{className:"flex w-full h-11 items-center flex-shrink-0 bg-background border-b border-border",children:m.jsx("div",{className:"flex flex-col items-start flex-1 px-3 sm:px-4",children:m.jsxs("div",{className:"flex h-11 justify-between items-center self-stretch",children:[m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("div",{className:"text-text-primary font-roboto text-base font-bold leading-3",children:"Identity Verification Form"}),m.jsx("div",{className:"sm:hidden flex w-8 h-8 justify-center items-center gap-2.5",children:m.jsxs("svg",{className:"w-6 h-6 transform rotate-90",viewBox:"0 0 25 25",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("path",{d:"M13.5 12.332C13.5 11.7797 13.0523 11.332 12.5 11.332C11.9477 11.332 11.5 11.7797 11.5 12.332C11.5 12.8843 11.9477 13.332 12.5 13.332C13.0523 13.332 13.5 12.8843 13.5 12.332Z",stroke:"#676879",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),m.jsx("path",{d:"M6.5 12.332C6.5 11.7797 6.05228 11.332 5.5 11.332C4.94772 11.332 4.5 11.7797 4.5 12.332C4.5 12.8843 4.94772 13.332 5.5 13.332C6.05228 13.332 6.5 12.8843 6.5 12.332Z",stroke:"#676879",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),m.jsx("path",{d:"M20.5 12.332C20.5 11.7797 20.0523 11.332 19.5 11.332C18.9477 11.332 18.5 11.7797 18.5 12.332C18.5 12.8843 18.9477 13.332 19.5 13.332C20.0523 13.332 20.5 12.8843 20.5 12.332Z",stroke:"#676879",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})})]}),m.jsx("div",{className:"flex items-center gap-3",children:m.jsx("button",{onClick:wt,className:`flex h-8 py-[9px] px-3 justify-center items-center gap-0.5 rounded ${Tt()?"bg-primary":"bg-primary opacity-50"}`,children:m.jsx("span",{className:"text-white font-roboto text-[13px] font-normal",children:"Submit"})})})]})})}),m.jsxs("div",{className:"flex w-full flex-1 overflow-hidden",children:[m.jsx("div",{className:"hidden lg:block border-r border-border",children:m.jsx(Jv,{sections:Ut,currentStep:d})}),vn&&m.jsxs("div",{className:"lg:hidden fixed inset-0 z-50 flex",children:[m.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>te(!1),"aria-hidden":!0}),m.jsxs("div",{id:"mobile-step-sidebar",className:"relative w-80 bg-white h-full border-r border-border shadow-lg overflow-auto",children:[m.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-border",children:[m.jsx("div",{className:"font-roboto font-bold",children:"Steps"}),m.jsx("button",{"aria-label":"Close menu",className:"p-1",onClick:()=>te(!1),children:""})]}),m.jsx(Jv,{sections:Ut,currentStep:d})]})]}),m.jsxs("div",{className:"flex w-full flex-1 flex-col",children:[m.jsx("div",{className:"lg:hidden px-3 py-4 bg-page-background",children:m.jsx("div",{className:"space-y-4",children:Ut.map((ve,ae)=>m.jsx(Bz,{section:ve,sectionIndex:ae+1,currentStep:d,isExpanded:!!J[ae+1],onToggle:pt,onSectionFocus:_i,formData:Q,setFormData:ht,isEmailVerified:p,isPhoneVerified:v,onSendEmailOTP:bn,onSendPhoneOTP:Sr,onIdentityDocumentComplete:Xe,onSelfieComplete:we,submissionId:q,shortCode:t,templateVersionId:o?.versionId,userId:e,isFilled:!!Z[ae+1],documentFormState:it,setDocumentFormState:cn,onDocumentUploaded:qe,biometricFormState:Lt,setBiometricFormState:On,emailLocked:V,formVersion:Be,docsVersion:Nt,connectionRef:sn,shouldMaintainConnection:Kn,onHandoffConnected:()=>Ge(!0)},`${ve.id}-${Be}-${Nt}`))})}),m.jsx("div",{className:"hidden lg:flex w-full flex-1 p-6 flex-col items-center gap-6 bg-background overflow-auto",children:m.jsx("div",{className:"flex w-full max-w-[998px] flex-col items-center gap-6",children:m.jsx("div",{className:"flex flex-col items-center gap-6 self-stretch",children:Ut.map((ve,ae)=>m.jsx(Vz,{section:ve,sectionIndex:ae+1,currentStep:d,onSectionFocus:_i,formData:Q,setFormData:ht,isEmailVerified:p,isPhoneVerified:v,onSendEmailOTP:bn,onSendPhoneOTP:Sr,onIdentityDocumentComplete:Xe,onSelfieComplete:we,submissionId:q,shortCode:t,templateVersionId:o?.versionId,userId:e,isFilled:!!Z[ae+1],isExpanded:!!J[ae+1],onToggle:pt,documentFormState:it,setDocumentFormState:cn,onDocumentUploaded:qe,biometricFormState:Lt,setBiometricFormState:On,emailLocked:V,formVersion:Be,docsVersion:Nt,connectionRef:sn,shouldMaintainConnection:Kn,onHandoffConnected:()=>Ge(!0)},`${ve.id}-${Be}-${Nt}`))})})})]})]})]})]})}function DR(){const n=si(),[e]=$X(),t=e.get("code")||void 0,[r,s]=_.useState(1),[o,i]=_.useState(null),[a,l]=_.useState(!1),[c,u]=_.useState(null),[d,f]=_.useState(""),p="Ad-5fCStWvEJoqVbxLtt26bnAqpE8-lie1RD1JYlXh2l4faiZGjFOr5O_WtRZrJuYfYzF-b2GiM_2Al2hRWKRS9EBPfoFd40G11bugUEJIEIChk9LtrWLmmit8zkyDyF24-drMfaQk5Zyl2RnZVmmMKKiitrRQcCcNMftj6E-c7KxWN0MPuuFtJ5NAwlZAb-i669e9_iz2h8_y7umUfoxzRu7HPqYZBfEufgYwcV8Hnag55i1MPKlztQgLqYdasYDL5HEmGwSr24fdOluLlnIiN8MS6VJatd",x="https://idvapi-test.arconnet.com:1019";_.useEffect(()=>{const w=e.get("code"),S=e.get("state"),k=e.get("jti");if(w&&S){console.log(" DigiLocker callback detected at root URL");try{const[N,I]=S.split(":");if(!N||N==="unknown"){console.error(" Invalid shortCode in DigiLocker state"),alert("Invalid DigiLocker callback. Please try again.");return}sessionStorage.setItem("digilocker_auth_code",w),sessionStorage.setItem("digilocker_callback_state",S),sessionStorage.setItem("digilocker_jti",k||""),sessionStorage.setItem("digilocker_callback_timestamp",Date.now().toString()),console.log(" DigiLocker data stored, redirecting to /form?code="+N),n(`/form?code=${encodeURIComponent(N)}`,{replace:!0})}catch(N){console.error(" Error processing DigiLocker callback:",N),alert("Failed to process DigiLocker response. Please try again.")}}},[e,n]),_.useEffect(()=>{const w=e.get("code");w&&v(w)},[e]);const v=async w=>{l(!0),u(null);try{const S=await fetch(`${x}/api/templates-link-generation/resolve?shortCode=${encodeURIComponent(w)}`);if(!S.ok)throw new Error("Failed to resolve shortcode");const k=await S.json();console.log("Shortcode resolved:",k),s(k.templateVersionId),i(k.userId)}catch(S){console.error("Error resolving shortcode:",S),u(S instanceof Error?S.message:"An error occurred")}finally{l(!1)}},y=w=>{w.preventDefault(),d.trim()&&n(`/form?code=${encodeURIComponent(d.trim())}`)},b=()=>{f(p),n(`/form?code=${encodeURIComponent(p)}`)};return t?a?m.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:m.jsx("div",{className:"text-gray-900 text-lg",children:"Loading template..."})}):c?m.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:m.jsx("div",{className:"max-w-md w-full",children:m.jsxs("div",{className:"text-center",children:[m.jsxs("div",{className:"text-red-600 text-lg mb-4",children:["Error: ",c]}),m.jsx("button",{onClick:()=>n("/"),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Try Again"})]})})}):m.jsx(s9e,{templateId:r,userId:o,shortCode:t||""}):m.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:m.jsxs("div",{className:"max-w-md w-full space-y-8",children:[m.jsxs("div",{children:[m.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Identity Verification"}),m.jsx("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Enter your shortCode to continue"})]}),m.jsxs("form",{className:"mt-8 space-y-6",onSubmit:y,children:[m.jsxs("div",{children:[m.jsx("label",{htmlFor:"shortcode",className:"sr-only",children:"Shortcode"}),m.jsx("input",{id:"shortcode",name:"shortcode",type:"text",required:!0,value:d,onChange:w=>f(w.target.value),className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm",placeholder:`Write shortcode here (e.g., ${p.slice(0,20)}...)`})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("button",{type:"submit",disabled:!d.trim(),className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",children:"Continue"}),m.jsxs("div",{className:"relative",children:[m.jsx("div",{className:"absolute inset-0 flex items-center",children:m.jsx("div",{className:"w-full border-t border-gray-300"})}),m.jsx("div",{className:"relative flex justify-center text-sm",children:m.jsx("span",{className:"px-2 bg-gray-50 text-gray-500",children:"or"})})]}),m.jsx("button",{type:"button",onClick:b,className:"group relative w-full flex justify-center py-2 px-4 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Try Demo Shortcode"})]})]})]})})}const o9e=()=>{const n=hc();return _.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",n.pathname)},[n.pathname]),m.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:m.jsxs("div",{className:"text-center",children:[m.jsx("h1",{className:"text-4xl font-bold mb-4",children:"404"}),m.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Oops! Page not found"}),m.jsx("a",{href:"/",className:"text-blue-500 hover:text-blue-700 underline",children:"Return to Home"})]})})};function i9e(){const n=si();return _.useEffect(()=>{const e=setTimeout(()=>{n("/verification-success")},2e3);return()=>clearTimeout(e)},[n]),m.jsxs("div",{className:"flex w-full min-h-screen flex-col bg-page-background",children:[m.jsxs("div",{className:"flex w-full h-11 items-center px-8 border-b border-[#D0D4E4] bg-white",children:[m.jsx("div",{className:"flex items-center gap-2",children:m.jsxs("svg",{width:"64",height:"16",viewBox:"0 0 64 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("path",{d:"M19.6451 6.27505C20.4605 5.29486 21.4477 4.80469 22.6065 4.80469C23.2074 4.80469 23.76 4.97008 24.2643 5.30072C24.7686 5.63143 25.1548 6.05658 25.4231 6.57622L25.5679 4.96414H27.6281V14.7073H25.5679L25.4231 13.0776C25.1548 13.5972 24.7686 14.0224 24.2643 14.353C23.76 14.6837 23.2074 14.8491 22.6065 14.8491C21.4477 14.8491 20.4605 14.359 19.6451 13.3787C18.8296 12.3867 18.4219 11.1998 18.4219 9.81804C18.4219 8.43624 18.8296 7.25524 19.6451 6.27505ZM21.3833 11.625C21.8339 12.1327 22.3812 12.3867 23.025 12.3867C23.6795 12.3867 24.2321 12.1387 24.6827 11.6426C25.1334 11.1348 25.3587 10.5266 25.3587 9.81804C25.3587 9.10947 25.1334 8.50713 24.6827 8.0111C24.2321 7.50326 23.6795 7.24938 23.025 7.24938C22.3812 7.24938 21.8339 7.50326 21.3833 8.0111C20.9327 8.50713 20.7073 9.10947 20.7073 9.81804C20.7073 10.5266 20.9327 11.1289 21.3833 11.625ZM29.5129 4.96414H31.573L31.734 6.36361C32.2598 5.38342 33.1343 4.89332 34.3575 4.89332C34.6686 4.89332 34.9369 4.91693 35.1622 4.96414L34.6954 7.35568C34.5667 7.33207 34.4755 7.3202 34.4219 7.3202C33.6707 7.3202 33.0431 7.57415 32.5387 8.08199C32.0344 8.57795 31.7823 9.42237 31.7823 10.6152V14.7073H29.5129V4.96414ZM37.3457 6.29279C38.2255 5.31253 39.2932 4.82243 40.5485 4.82243C41.2996 4.82243 42.0025 5.01729 42.657 5.40702C43.3115 5.78495 43.8534 6.29866 44.2825 6.94821L42.4156 8.31227C41.9542 7.67452 41.3319 7.35568 40.5485 7.35568C39.9262 7.35568 39.3951 7.59776 38.9551 8.08199C38.5153 8.56615 38.2953 9.15074 38.2953 9.83578C38.2953 10.5325 38.5153 11.123 38.9551 11.6072C39.3951 12.0915 39.9262 12.3335 40.5485 12.3335C41.3748 12.3335 42.0078 11.9792 42.4477 11.2707L44.3308 12.6524C43.9124 13.3256 43.3705 13.8629 42.7052 14.2645C42.04 14.666 41.3211 14.8668 40.5485 14.8668C39.2932 14.8668 38.2202 14.3766 37.3296 13.3964C36.4498 12.4044 36.0098 11.2175 36.0098 9.83578C36.0098 8.45398 36.4551 7.27298 37.3457 6.29279ZM46.619 6.29279C47.4989 5.31253 48.5665 4.82243 49.8219 4.82243C51.0773 4.82243 52.1503 5.31846 53.0409 6.31046C53.9422 7.29072 54.3929 8.46578 54.3929 9.83578C54.3929 11.2175 53.9476 12.3985 53.057 13.3787C52.1557 14.3708 51.0773 14.8668 49.8219 14.8668C48.5665 14.8668 47.4935 14.3766 46.603 13.3964C45.7231 12.4044 45.2832 11.2175 45.2832 9.83578C45.2832 8.45398 45.7285 7.27298 46.619 6.29279ZM47.5687 9.83578C47.5687 10.5325 47.7886 11.123 48.2285 11.6072C48.6685 12.0915 49.1996 12.3335 49.8219 12.3335C50.455 12.3335 50.9915 12.0915 51.4314 11.6072C51.8713 11.123 52.0913 10.5325 52.0913 9.83578C52.0913 9.15074 51.8713 8.56615 51.4314 8.08199C50.9915 7.59776 50.455 7.35568 49.8219 7.35568C49.1996 7.35568 48.6685 7.59776 48.2285 8.08199C47.7886 8.56615 47.5687 9.15074 47.5687 9.83578ZM55.8398 14.7073V4.96414H57.9L58.0448 6.38135C58.3024 5.90892 58.6404 5.531 59.0588 5.24757C59.488 4.95234 59.9709 4.80469 60.5073 4.80469C61.5803 4.80469 62.428 5.21216 63.0504 6.02703C63.6834 6.8419 63.9999 8.07605 63.9999 9.72947V14.7073H61.7466V9.72947C61.7466 8.9146 61.5696 8.30046 61.2155 7.88712C60.8722 7.46198 60.443 7.24938 59.928 7.24938C59.4022 7.24938 58.9676 7.46198 58.6243 7.88712C58.2809 8.30046 58.1092 8.9146 58.1092 9.72947V14.7073H55.8398Z",fill:"#323238"}),m.jsx("path",{d:"M14.3486 12.736C14.6548 13.3353 14.2196 14.0465 13.5466 14.0465H3.02185C2.3453 14.0465 1.91028 13.3285 2.22355 12.7288L7.54372 2.54495C7.8823 1.89684 8.81128 1.901 9.14404 2.55212L14.3486 12.736Z",stroke:"#D83A52",strokeWidth:"2.42826"})]})}),m.jsx("div",{className:"w-[1px] h-5 bg-[#D0D4E4] mx-2"}),m.jsx("div",{className:"flex items-center justify-center",children:m.jsxs("svg",{width:"80",height:"23",viewBox:"0 0 80 23",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("g",{clipPath:"url(#clip0_2641_14088)",children:m.jsx("path",{d:"M1.79875 10.2148C1.79875 8.97716 1.17188 7.95455 0 7.0957H2.72375C3.2039 7.46144 3.59293 7.93332 3.86041 8.47442C4.1279 9.01552 4.26659 9.61118 4.26563 10.2148C4.26659 10.8184 4.1279 11.4141 3.86041 11.9552C3.59293 12.4963 3.2039 12.9682 2.72375 13.3339C3.60813 13.7027 4.11125 14.6028 4.11125 15.8911V18.3457H1.645V15.8911C1.645 14.664 1.05938 13.8052 0.000625 13.3345C1.1725 12.4751 1.79875 11.4524 1.79875 10.2148ZM7.14375 10.2148C7.14375 8.97716 6.51688 7.95455 5.345 7.0957H8.06938C8.54941 7.46151 8.93832 7.93341 9.20569 8.47451C9.47307 9.01561 9.61166 9.61123 9.61063 10.2148C9.61166 10.8184 9.47307 11.414 9.20569 11.9551C8.93832 12.4962 8.54941 12.9681 8.06938 13.3339C8.95313 13.7027 9.45688 14.6028 9.45688 15.8911V18.3457H6.99V15.8911C6.99 14.664 6.40375 13.8052 5.345 13.3345C6.51688 12.4751 7.14375 11.4524 7.14375 10.2148ZM12.49 10.2148C12.49 8.97716 11.8631 7.95455 10.6913 7.0957H13.415C13.8951 7.46144 14.2842 7.93332 14.5517 8.47442C14.8191 9.01552 14.9578 9.61118 14.9569 10.2148C14.9578 10.8184 14.8191 11.4141 14.5517 11.9552C14.2842 12.4963 13.8951 12.9682 13.415 13.3339C14.2994 13.7027 14.8025 14.6028 14.8025 15.8911V18.3457H12.3356V15.8911C12.3356 14.664 11.75 13.8052 10.6913 13.3345C11.8631 12.4751 12.49 11.4524 12.49 10.2148ZM22.47 16.3017H20.6V9.14093H25.195C27.405 9.14093 28.4944 9.95977 28.4944 11.2993C28.4944 12.2094 27.96 12.8945 26.9631 13.2426C27.9906 13.3958 28.4531 13.9377 28.4531 14.9097V16.3005H26.5619V14.9916C26.5619 14.1727 26.1506 13.8458 25.0713 13.8458H22.4713V16.3017H22.47ZM25.0913 10.1842H22.47V12.8032H25.0706C26.0163 12.8032 26.6019 12.2813 26.6019 11.4631C26.6019 10.6548 26.0581 10.1842 25.0913 10.1842ZM31.7419 9.14093H29.8713V16.3017H31.7419V9.14093ZM37.4775 13.9683H35.1956V16.3005H33.3244V9.14093H37.5181C39.7281 9.14093 40.89 10.0617 40.89 11.5349C40.89 13.0582 39.7081 13.9683 37.4775 13.9683ZM37.4363 10.1842H35.1956V12.9251H37.4156C38.3819 12.9251 38.9781 12.4344 38.9781 11.5449C38.9781 10.6755 38.3819 10.1842 37.4363 10.1842ZM46.1531 13.9683H43.8713V16.3005H42V9.14093H46.1938C48.4038 9.14093 49.5656 10.0617 49.5656 11.5349C49.5656 13.0582 48.3831 13.9683 46.1531 13.9683ZM46.1119 10.1842H43.8713V12.9251H46.0913C47.0575 12.9251 47.6538 12.4344 47.6538 11.5449C47.6538 10.6755 47.0575 10.1842 46.1119 10.1842ZM52.5463 9.14093V15.2366H57.2131V16.3017H50.6756V9.14093H52.5463ZM60.2544 9.14093H58.3838V16.3017H60.2544V9.14093ZM63.0713 11.5343V16.3017H61.8375V9.14093H63.2369L68.335 13.9071V9.14093H69.5688V16.3017H68.1706L63.0713 11.5343ZM75.675 9.97977C73.8963 9.97977 72.735 11.1049 72.735 12.782C72.735 14.4384 73.845 15.4616 75.5719 15.4616H75.695C76.2813 15.4616 76.9388 15.3385 77.5456 15.1447V13.2114H74.5238V12.1888H79.375V15.5535C78.3681 16.0755 76.8463 16.4849 75.6131 16.4849H75.4488C72.6113 16.4849 70.7819 14.991 70.7819 12.8226C70.7819 10.6749 72.6631 8.95716 75.5513 8.95716H75.7156C76.9188 8.95716 78.2956 9.33533 79.3138 9.92852L78.7788 10.7974C77.8644 10.2967 76.7744 9.97977 75.7981 9.97977H75.675Z",fill:"black"})}),m.jsx("defs",{children:m.jsx("clipPath",{id:"clip0_2641_14088",children:m.jsx("rect",{width:"79.6875",height:"22.5",fill:"white"})})})]})})]}),m.jsx("div",{className:"flex flex-1 items-center justify-center p-8",children:m.jsx("div",{className:"flex flex-col items-center justify-center gap-14 max-w-2xl mx-auto",children:m.jsxs("div",{className:"flex flex-col items-center gap-6",children:[m.jsx("div",{className:"relative",children:m.jsxs("svg",{className:"w-16 h-16 animate-spin",width:"64",height:"64",viewBox:"0 0 64 64",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("path",{d:"M60 32C60 35.677 59.2758 39.318 57.8686 42.7151C56.4615 46.1123 54.399 49.199 51.799 51.799C49.199 54.399 46.1123 56.4615 42.7151 57.8686C39.318 59.2758 35.677 60 32 60C28.323 60 24.682 59.2758 21.2849 57.8686C17.8877 56.4615 14.801 54.399 12.201 51.799C9.60097 49.1989 7.5385 46.1122 6.13137 42.7151C4.72424 39.318 4 35.677 4 32C4 28.323 4.72424 24.682 6.13138 21.2849C7.53851 17.8877 9.60098 14.801 12.201 12.201C14.8011 9.60096 17.8878 7.5385 21.2849 6.13137C24.682 4.72424 28.323 4 32 4C35.677 4 39.318 4.72425 42.7152 6.13138C46.1123 7.53851 49.199 9.60098 51.799 12.201C54.399 14.8011 56.4615 17.8878 57.8686 21.2849C59.2758 24.682 60 28.323 60 32L60 32Z",stroke:"#C3C6D4",strokeWidth:"6.81579",strokeLinecap:"round",strokeLinejoin:"round"}),m.jsx("path",{d:"M32 4C36.5971 4 41.1234 5.13188 45.1794 7.29569C49.2354 9.45951 52.6962 12.5887 55.2563 16.4069C57.8164 20.2252 59.397 24.6151 59.8585 29.1889",stroke:"#258750",strokeWidth:"6.81579",strokeLinecap:"round",strokeLinejoin:"round"})]})}),m.jsxs("div",{className:"flex flex-col items-center gap-6 text-center max-w-lg",children:[m.jsx("h1",{className:"text-text-primary font-roboto text-2xl sm:text-3xl font-bold leading-tight",children:"Verification in Progress"}),m.jsx("p",{className:"text-text-secondary font-roboto text-base font-normal leading-5",children:"This may take a moment. Please do not close this window."})]})]})})})]})}function a9e(){return m.jsxs("div",{className:"flex w-full min-h-screen flex-col bg-page-background",children:[m.jsxs("div",{className:"flex w-full h-11 items-center px-8 border-b border-[#D0D4E4] bg-white",children:[m.jsx("div",{className:"flex items-center gap-2",children:m.jsx(xJ,{})}),m.jsx("div",{className:"w-[1px] h-5 bg-[#D0D4E4] mx-2"}),m.jsx("div",{className:"flex items-center justify-center",children:m.jsx(vJ,{})})]}),m.jsx("div",{className:"flex flex-1 items-center justify-center p-8",children:m.jsx("div",{className:"flex w-full max-w-4xl justify-center items-center",children:m.jsx("div",{className:"flex w-full max-w-[672px] h-[284px] p-14 flex-col justify-center items-center gap-14 rounded-2xl bg-white",children:m.jsxs("div",{className:"flex flex-col items-center gap-6 w-full max-w-[560px]",children:[m.jsxs("div",{className:"flex flex-col items-center gap-6",children:[m.jsx(yJ,{}),m.jsxs("div",{className:"flex flex-col items-center gap-6 text-center",children:[m.jsx("h1",{className:"text-[#172B4D] font-roboto text-[32px] font-bold leading-tight",children:"Verification successful"}),m.jsx("p",{className:"text-[#676879] font-roboto text-base font-normal leading-normal",children:"Your identity has been verified."})]})]}),m.jsx("button",{onClick:()=>window.location.href="/auth/login",className:"flex h-12 px-6 py-3 justify-center items-center gap-2 rounded bg-primary hover:bg-primary/90 transition-colors",children:m.jsx("span",{className:"text-white font-roboto text-base font-medium",children:"Go to Dashboard"})})]})})})})]})}const l9e={"+91":{min:10,max:10},"+1":{min:10,max:10},"+44":{min:10,max:10},"+61":{min:9,max:9},"+49":{min:10,max:11},"+33":{min:9,max:9},"+65":{min:8,max:8},"+971":{min:9,max:9},"+55":{min:10,max:11},"+81":{min:9,max:10}},uk=Vk({email:xi().min(1,"Email is required").email("Please enter a valid email address")}),c9e=Vk({countryCode:xi().min(1,"Please select a country code"),phoneNumber:xi().min(1,"Please enter a phone number").regex(/^\d+$/,"Phone number must only contain digits")}).superRefine(({countryCode:n,phoneNumber:e},t)=>{const r=l9e[n];if(!r){const o=e.length;(o<7||o>15)&&t.addIssue({code:ut.custom,path:["phoneNumber"],message:"Please enter a valid phone number (7-15 digits)"});return}const s=e.length;(s<r.min||s>r.max)&&t.addIssue({code:ut.custom,path:["phoneNumber"],message:r.min===r.max?`Phone number must be exactly ${r.min} digits for ${n}`:`Phone number must be ${r.min}-${r.max} digits for ${n}`})}),Tv=[{code:"+91",name:"India",length:10},{code:"+1",name:"United States",length:10},{code:"+44",name:"United Kingdom",length:10},{code:"+61",name:"Australia",length:9},{code:"+49",name:"Germany",length:10},{code:"+33",name:"France",length:9},{code:"+55",name:"Brazil",length:11}];function u9e(){const[n,e]=_.useState(""),[t,r]=_.useState("email"),[s,o]=_.useState(""),[i,a]=_.useState(""),[l,c]=_.useState(""),[u,d]=_.useState(""),[f,p]=_.useState(!1),[x,v]=_.useState(""),[y,b]=_.useState(""),w=si(),S=async()=>{const k=n.trim();p(!0),v("");try{if(t==="email"){const R=uk.safeParse({email:k});if(!R.success){const P=R.error.errors;o(P[0]?.message||"Please enter a valid email address."),p(!1);return}o("");const D=await fetch("/api/Otp/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:k,versionId:0})});if(!D.ok){const P=await D.json();throw new Error(P.message||"Failed to send OTP")}const A=await D.json();console.log("Email OTP sent:",A),w("/auth/otp",{state:{emailOrPhone:k,mode:"email"}});return}if(!i){c("Please select a country code."),p(!1);return}if(c(""),!k){d("Please enter a valid phone number."),p(!1);return}const N=k.replace(/\D/g,""),I=c9e.safeParse({dialCode:i,phoneNumber:N});if(!I.success){const R=I.error.errors;d(R[0]?.message||"Please enter a valid phone number."),p(!1);return}d("");const T=await fetch("/api/Otp/phone/start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phoneCountryCode:i,phoneNationalNumber:N,channel:"sms",purpose:"login_verification",versionId:0})});if(!T.ok){const R=await T.json();throw new Error(R.message||"Failed to send OTP")}const F=await T.json();console.log("Phone OTP sent:",F),w("/auth/otp",{state:{emailOrPhone:`${i}${N}`,mode:"phone",otpId:F.otpId||null}})}catch(N){console.error("Error sending OTP:",N),v(N.message||"Failed to send OTP. Please try again.")}finally{p(!1)}};return m.jsxs("div",{className:"flex w-full min-h-screen bg-white",children:[m.jsxs("div",{className:"hidden lg:flex lg:w-1/2 relative overflow-hidden bg-white",children:[m.jsxs("div",{className:"absolute inset-0",children:[m.jsx("div",{className:"absolute w-[342px] h-[342px] rounded-full bg-[#BCD2E8] blur-[115px] left-[239px] top-[301px]"}),m.jsx("div",{className:"absolute w-[465px] h-[397px] rounded-full bg-[#E0EFFE] blur-[80px] left-0 top-0"}),m.jsx("div",{className:"absolute w-[252px] h-[318px] rounded-3xl border border-black/10 bg-gradient-to-br from-[#E0EFFE] via-[#F3CFFF] to-[#F3CFFF] backdrop-blur-[7.5px] transform rotate-[6.554deg] left-[275px] top-[140px]"}),m.jsx("div",{className:"absolute w-[252px] h-[318px] rounded-3xl border border-black/10 bg-white backdrop-blur-[7.5px] left-[276px] top-[150px]"}),m.jsx("div",{className:"absolute w-[185px] h-[130px] rounded-2xl bg-[#E0EFFE] left-[309px] top-[205px]"}),m.jsx("svg",{className:"absolute w-6 h-6 left-[488px] top-[166px]",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 1C5.92487 1 1 5.92487 1 12C1 18.0751 5.92487 23 12 23C18.0751 23 23 18.0751 23 12C23 5.92487 18.0751 1 12 1ZM17.2071 9.70711C17.5976 9.31658 17.5976 8.68342 17.2071 8.29289C16.8166 7.90237 16.1834 7.90237 15.7929 8.29289L10.5 13.5858L8.20711 11.2929C7.81658 10.9024 7.18342 10.9024 6.79289 11.2929C6.40237 11.6834 6.40237 12.3166 6.79289 12.7071L9.79289 15.7071C10.1834 16.0976 10.8166 16.0976 11.2071 15.7071L17.2071 9.70711Z",fill:"#258750"})}),m.jsx("svg",{className:"absolute w-[145px] h-[121px] left-[466px] top-[140px]",viewBox:"0 0 147 123",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M54.5 7.99954C83 -7.00098 150.09 0.513069 145.701 45.8941C141.318 91.2094 66.3066 105.225 1 122.126",stroke:"black",strokeOpacity:"0.44",strokeDasharray:"2 2"})})]}),m.jsxs("div",{className:"absolute bottom-24 left-20 right-20 text-center",children:[m.jsx("h2",{className:"text-[#172B4D] font-roboto text-[32px] font-bold leading-tight mb-6",children:"Proof of identity, made simple."}),m.jsx("p",{className:"text-[#676879] font-roboto text-[13px] font-normal leading-5",children:"Easily verify your identity in seconds with our secure and seamless process."})]})]}),m.jsxs("div",{className:"flex-1 lg:w-1/2 flex flex-col",children:[m.jsx("div",{className:"lg:hidden absolute inset-0 overflow-hidden",children:m.jsxs("div",{className:"absolute w-[279px] h-[123px] transform -rotate-12 opacity-80 left-[190px] top-[214px]",children:[m.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-[#F8E4E8] to-transparent opacity-50 rounded-full blur-[35px]"}),m.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-[#E0EFFE] to-transparent opacity-50 rounded-full blur-[27px]"})]})}),m.jsx("div",{className:"flex justify-center items-center h-14 border-b border-[#D0D4E4] px-8 relative z-10",children:m.jsxs("svg",{width:"124",height:"25",viewBox:"0 0 126 28",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("path",{d:"M37.9516 10.9901C39.5704 9.21066 41.53 8.3208 43.8304 8.3208C45.0232 8.3208 46.1201 8.62106 47.1212 9.22131C48.1223 9.82169 48.889 10.5935 49.4216 11.5369L49.7091 8.61028H53.7987V26.2983H49.7091L49.4216 23.3396C48.889 24.283 48.1223 25.0548 47.1212 25.655C46.1201 26.2554 45.0232 26.5556 43.8304 26.5556C41.53 26.5556 39.5704 25.6658 37.9516 23.8862C36.3328 22.0853 35.5234 19.9306 35.5234 17.4221C35.5234 14.9136 36.3328 12.7696 37.9516 10.9901ZM41.4021 20.7025C42.2967 21.6243 43.3831 22.0853 44.661 22.0853C45.9604 22.0853 47.0573 21.6351 47.9518 20.7346C48.8464 19.8126 49.2938 18.7085 49.2938 17.4221C49.2938 16.1358 48.8464 15.0423 47.9518 14.1418C47.0573 13.2198 45.9604 12.7589 44.661 12.7589C43.3831 12.7589 42.2967 13.2198 41.4021 14.1418C40.5076 15.0423 40.0603 16.1358 40.0603 17.4221C40.0603 18.7085 40.5076 19.802 41.4021 20.7025ZM57.5403 8.61028H61.6298L61.9494 11.1509C62.9931 9.37144 64.729 8.48171 67.1572 8.48171C67.7749 8.48171 68.3074 8.52456 68.7547 8.61028L67.8281 12.9519C67.5725 12.9091 67.3915 12.8875 67.285 12.8875C65.794 12.8875 64.548 13.3485 63.5468 14.2705C62.5457 15.1709 62.0453 16.7038 62.0453 18.8693V26.2983H57.5403V8.61028ZM73.0891 11.0223C74.8357 9.24274 76.9551 8.35301 79.4471 8.35301C80.9381 8.35301 82.3333 8.70677 83.6325 9.4143C84.9319 10.1004 86.0075 11.033 86.8595 12.2122L83.1533 14.6885C82.2374 13.5308 81.0021 12.9519 79.4471 12.9519C78.2118 12.9519 77.1574 13.3914 76.2841 14.2705C75.4109 15.1494 74.9741 16.2107 74.9741 17.4543C74.9741 18.7193 75.4109 19.7912 76.2841 20.6703C77.1574 21.5494 78.2118 21.9888 79.4471 21.9888C81.0872 21.9888 82.3439 21.3456 83.2172 20.0593L86.9553 22.5677C86.1247 23.7899 85.049 24.7653 83.7284 25.4943C82.4079 26.2232 80.9808 26.5878 79.4471 26.5878C76.9551 26.5878 74.8251 25.6979 73.0571 23.9184C71.3106 22.1175 70.4373 19.9628 70.4373 17.4543C70.4373 14.9458 71.3213 12.8018 73.0891 11.0223ZM91.4977 11.0223C93.2443 9.24274 95.3636 8.35301 97.8558 8.35301C100.348 8.35301 102.478 9.25352 104.246 11.0544C106.035 12.834 106.929 14.9672 106.929 17.4543C106.929 19.9628 106.046 22.1068 104.278 23.8862C102.488 25.6873 100.348 26.5878 97.8558 26.5878C95.3636 26.5878 93.2336 25.6979 91.4658 23.9184C89.7191 22.1175 88.8459 19.9628 88.8459 17.4543C88.8459 14.9458 89.7298 12.8018 91.4977 11.0223ZM93.3828 17.4543C93.3828 18.7193 93.8194 19.7912 94.6927 20.6703C95.566 21.5494 96.6203 21.9888 97.8558 21.9888C99.1124 21.9888 100.177 21.5494 101.051 20.6703C101.924 19.7912 102.361 18.7193 102.361 17.4543C102.361 16.2107 101.924 15.1494 101.051 14.2705C100.177 13.3914 99.1124 12.9519 97.8558 12.9519C96.6203 12.9519 95.566 13.3914 94.6927 14.2705C93.8194 15.1494 93.3828 16.2107 93.3828 17.4543ZM109.802 26.2983V8.61028H113.892L114.179 11.1831C114.69 10.3255 115.361 9.63936 116.192 9.12482C117.044 8.58885 118.002 8.3208 119.067 8.3208C121.197 8.3208 122.88 9.06053 124.116 10.5399C125.372 12.0192 126 14.2597 126 17.2614V26.2983H121.527V17.2614C121.527 15.782 121.176 14.6671 120.473 13.9167C119.792 13.1449 118.94 12.7589 117.917 12.7589C116.873 12.7589 116.011 13.1449 115.329 13.9167C114.648 14.6671 114.307 15.782 114.307 17.2614V26.2983H109.802Z",fill:"#323238"}),m.jsx("path",{d:"M27.3723 22.6039C27.9964 23.7209 27.189 25.097 25.9095 25.097H4.88702C3.6005 25.097 2.79387 23.7073 3.43201 22.5902L14.0587 3.98729C14.7055 2.85516 16.3405 2.86285 16.9765 4.00102L27.3723 22.6039Z",stroke:"#D83A52",strokeWidth:"4.5177"})]})}),m.jsx("div",{className:"flex-1 flex items-center justify-center p-8 relative z-10",children:m.jsx("div",{className:"w-full max-w-[360px]",children:m.jsxs("div",{className:"flex flex-col gap-6",children:[m.jsxs("div",{className:"text-center space-y-2",children:[m.jsx("h1",{className:"text-[#172B4D] font-roboto text-[28px] font-bold leading-[42px]",children:"Welcome back!"}),m.jsx("p",{className:"text-[#676879] font-roboto text-sm font-normal leading-[22px]",children:"Get a login code via email or mobile."})]}),y&&m.jsx("div",{className:"p-3 rounded-lg bg-yellow-50 border border-yellow-200 text-yellow-800 text-sm",children:y}),m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center gap-2 bg-[#F6F7FB] rounded p-1 w-full",children:[m.jsx("button",{type:"button",onClick:()=>{r("email"),o(""),d(""),c(""),a(""),e("")},className:`flex-1 h-10 rounded text-sm font-medium ${t==="email"?"bg-white shadow text-[#172B4D]":"text-[#676879]"}`,children:"Email"}),m.jsx("button",{type:"button",onClick:()=>{r("phone"),o(""),d(""),c(""),a(""),e("")},className:`flex-1 h-10 rounded text-sm font-medium ${t==="phone"?"bg-white shadow text-[#172B4D]":"text-[#676879]"}`,children:"Mobile"})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"block text-[#323238] font-roboto text-[13px] font-medium",children:t==="email"?"Email Address":"Mobile Number"}),t==="phone"?m.jsxs("div",{className:"flex gap-2",children:[m.jsxs("div",{className:"w-36",children:[m.jsxs("select",{value:i,onChange:k=>{a(k.target.value),c(""),d("")},className:"w-full h-[54px] px-2 border border-[#C3C6D4] rounded bg-white text-[#676879] font-roboto text-base focus:outline-none focus:ring-2 focus:ring-primary",children:[m.jsx("option",{value:"",children:"Select country"}),Tv.map(k=>m.jsx("option",{value:k.code,children:`${k.code} (${k.name})`},k.code))]}),l&&m.jsx("p",{className:"text-sm text-destructive mt-1",children:l})]}),m.jsx("input",{type:"text",inputMode:"numeric",value:n,onChange:k=>{const T=k.target.value.replace(/\D/g,"").trimStart();e(T),d("")},onBlur:()=>{const k=n.trim();if(e(k),!i){c("Please select a country code.");return}const N=Tv.find(T=>T.code===i),I=k.replace(/\D/g,"");if(!I){d("Please enter a valid phone number.");return}if(N&&N.length!==void 0){if(I.length!==N.length){d("Please enter a valid phone number.");return}}else if(I.length<7||I.length>15){d("Please enter a valid phone number.");return}d("")},placeholder:i?`e.g. ${Tv.find(k=>k.code===i)?.length?"9".repeat(Tv.find(k=>k.code===i).length):"Phone number"}`:"Enter mobile number",className:"flex-1 h-[54px] px-3 py-4 border border-[#C3C6D4] rounded bg-white text-[#676879] font-roboto text-base placeholder:text-[#676879] focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"})]}):m.jsx("input",{type:"text",value:n,onChange:k=>{const I=k.target.value.trimStart();e(I),t==="email"&&o("")},onBlur:()=>{const k=n.trim();e(k),t==="email"&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(k)?o(""):o("Please enter a valid email address."))},placeholder:t==="email"?"example@domain.com":"Enter mobile number",className:"w-full h-[54px] px-3 py-4 border border-[#C3C6D4] rounded bg-white text-[#676879] font-roboto text-base placeholder:text-[#676879] focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"}),s&&m.jsx("p",{className:"text-sm text-destructive mt-1",children:s}),u&&m.jsx("p",{className:"text-sm text-destructive mt-1",children:u})]}),x&&m.jsx("div",{className:"p-3 rounded-lg bg-[#FEE2E2] border border-[#FCA5A5]",children:m.jsx("p",{className:"text-sm text-[#DC2626]",children:x})}),m.jsx("button",{onClick:S,disabled:f||(t==="email"?!n.trim()||!!s:!i||!n.trim()||!!u),className:`w-full h-12 px-4 py-3 rounded font-roboto text-base font-bold transition-colors ${n.trim()&&!f?"bg-primary hover:bg-primary/90 text-white":"bg-primary/50 text-white cursor-not-allowed"}`,children:f?m.jsxs("div",{className:"flex items-center justify-center gap-2",children:[m.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[m.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),m.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),m.jsx("span",{children:"Sending..."})]}):"Send OTP"})]})]})})}),m.jsxs("div",{className:"lg:hidden p-8 text-center relative z-10",children:[m.jsx("h2",{className:"text-[#172B4D] font-roboto text-[32px] font-bold leading-tight mb-6",children:"Proof of identity, made simple."}),m.jsx("p",{className:"text-[#676879] font-roboto text-[13px] font-normal leading-5",children:"Easily verify your identity in seconds with our secure and seamless process."})]})]})]})}function d9e(){const[n,e]=_.useState(["","","","","",""]),[t,r]=_.useState(!1),[s,o]=_.useState(!1),[i,a]=_.useState(""),l=_.useRef([]),c=hc(),u=si(),d=c.state?.emailOrPhone||"amritemail.com",f=c.state?.mode||"email",p=c.state?.otpId||null;_.useEffect(()=>{l.current[0]?.focus()},[]);const x=(k,N)=>{if(N.length>1)return;const I=[...n];I[k]=N,e(I),N&&k<5&&l.current[k+1]?.focus()},v=(k,N)=>{N.key==="Backspace"&&!n[k]&&k>0&&l.current[k-1]?.focus()},y=k=>{k.preventDefault();const N=k.clipboardData.getData("text").slice(0,6),I=[...n];for(let F=0;F<N.length&&F<6;F++)I[F]=N[F];e(I);const T=Math.min(N.length,5);l.current[T]?.focus()},b=async()=>{r(!0),a("");try{if(f==="email"){const k=await fetch("/api/Otp/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:d,versionId:0})});if(!k.ok){const N=await k.json();throw new Error(N.message||"Failed to resend OTP")}console.log("Email OTP resent successfully")}else{const k=d.match(/^(\+\d+)(\d+)$/);if(!k)throw new Error("Invalid phone number format");const[,N,I]=k,T=await fetch("/api/Otp/phone/start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phoneCountryCode:N,phoneNationalNumber:I,channel:"sms",purpose:"login_verification",versionId:0})});if(!T.ok){const R=await T.json();throw new Error(R.message||"Failed to resend OTP")}const F=await T.json();F.otpId&&u("/auth/otp",{state:{emailOrPhone:d,mode:f,otpId:F.otpId},replace:!0}),console.log("Phone OTP resent successfully")}}catch(k){console.error("Error resending OTP:",k),a(k.message||"Failed to resend OTP. Please try again.")}finally{r(!1)}},w=async()=>{const k=n.join("");if(k.length===6){o(!0),a("");try{if(f==="email"){const N=await fetch("/api/Otp/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:d,otp:k,versionId:0})});if(!N.ok){const T=await N.json();throw new Error(T.message||"Invalid OTP")}const I=await N.json();console.log("Email OTP verified:",I),u("/dashboard")}else{if(!p)throw new Error("OTP ID not found. Please request a new code.");const N=await fetch("/api/Otp/phone/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({otpId:p,code:k})});if(!N.ok){const T=await N.json();throw new Error(T.message||"Invalid OTP")}const I=await N.json();console.log("Phone OTP verified:",I),u("/dashboard")}}catch(N){console.error("Error verifying OTP:",N),a(N.message||"Invalid OTP. Please try again.")}finally{o(!1)}}},S=n.every(k=>k!=="");return m.jsxs("div",{className:"flex w-full min-h-screen bg-white",children:[m.jsxs("div",{className:"hidden lg:flex lg:w-1/2 relative overflow-hidden bg-white",children:[m.jsxs("div",{className:"absolute inset-0",children:[m.jsx("div",{className:"absolute w-[342px] h-[342px] rounded-full bg-[#BCD2E8] blur-[115px] left-[239px] top-[301px]"}),m.jsx("div",{className:"absolute w-[465px] h-[397px] rounded-full bg-[#E0EFFE] blur-[80px] left-0 top-0"}),m.jsx("div",{className:"absolute w-[252px] h-[318px] rounded-3xl border border-black/10 bg-gradient-to-br from-[#E0EFFE] via-[#F3CFFF] to-[#F3CFFF] backdrop-blur-[7.5px] transform rotate-[6.554deg] left-[275px] top-[140px]"}),m.jsx("div",{className:"absolute w-[252px] h-[318px] rounded-3xl border border-black/10 bg-white backdrop-blur-[7.5px] left-[276px] top-[150px]"}),m.jsx("div",{className:"absolute w-[185px] h-[130px] rounded-2xl bg-[#E0EFFE] left-[309px] top-[205px]"}),m.jsx("svg",{className:"absolute w-6 h-6 left-[488px] top-[166px]",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 1C5.92487 1 1 5.92487 1 12C1 18.0751 5.92487 23 12 23C18.0751 23 23 18.0751 23 12C23 5.92487 18.0751 1 12 1ZM17.2071 9.70711C17.5976 9.31658 17.5976 8.68342 17.2071 8.29289C16.8166 7.90237 16.1834 7.90237 15.7929 8.29289L10.5 13.5858L8.20711 11.2929C7.81658 10.9024 7.18342 10.9024 6.79289 11.2929C6.40237 11.6834 6.40237 12.3166 6.79289 12.7071L9.79289 15.7071C10.1834 16.0976 10.8166 16.0976 11.2071 15.7071L17.2071 9.70711Z",fill:"#258750"})}),m.jsx("svg",{className:"absolute w-[145px] h-[121px] left-[466px] top-[140px]",viewBox:"0 0 147 123",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M54.5 7.99954C83 -7.00098 150.09 0.513069 145.701 45.8941C141.318 91.2094 66.3066 105.225 1 122.126",stroke:"black",strokeOpacity:"0.44",strokeDasharray:"2 2"})})]}),m.jsxs("div",{className:"absolute bottom-24 left-20 right-20 text-center",children:[m.jsx("h2",{className:"text-[#172B4D] font-roboto text-[32px] font-bold leading-tight mb-6",children:"Proof of identity, made simple."}),m.jsx("p",{className:"text-[#676879] font-roboto text-[13px] font-normal leading-5",children:"Easily verify your identity in seconds with our secure and seamless process."})]})]}),m.jsxs("div",{className:"flex-1 lg:w-1/2 flex flex-col",children:[m.jsx("div",{className:"lg:hidden absolute inset-0 overflow-hidden",children:m.jsxs("div",{className:"absolute w-[279px] h-[123px] transform -rotate-12 opacity-80 left-[190px] top-[214px]",children:[m.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-[#F8E4E8] to-transparent opacity-50 rounded-full blur-[35px]"}),m.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-[#E0EFFE] to-transparent opacity-50 rounded-full blur-[27px]"})]})}),m.jsx("div",{className:"flex justify-center items-center h-14 border-b border-[#D0D4E4] px-8 relative z-10",children:m.jsxs("svg",{width:"124",height:"25",viewBox:"0 0 126 28",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("path",{d:"M37.9516 10.9901C39.5704 9.21066 41.53 8.3208 43.8304 8.3208C45.0232 8.3208 46.1201 8.62106 47.1212 9.22131C48.1223 9.82169 48.889 10.5935 49.4216 11.5369L49.7091 8.61028H53.7987V26.2983H49.7091L49.4216 23.3396C48.889 24.283 48.1223 25.0548 47.1212 25.655C46.1201 26.2554 45.0232 26.5556 43.8304 26.5556C41.53 26.5556 39.5704 25.6658 37.9516 23.8862C36.3328 22.0853 35.5234 19.9306 35.5234 17.4221C35.5234 14.9136 36.3328 12.7696 37.9516 10.9901ZM41.4021 20.7025C42.2967 21.6243 43.3831 22.0853 44.661 22.0853C45.9604 22.0853 47.0573 21.6351 47.9518 20.7346C48.8464 19.8126 49.2938 18.7085 49.2938 17.4221C49.2938 16.1358 48.8464 15.0423 47.9518 14.1418C47.0573 13.2198 45.9604 12.7589 44.661 12.7589C43.3831 12.7589 42.2967 13.2198 41.4021 14.1418C40.5076 15.0423 40.0603 16.1358 40.0603 17.4221C40.0603 18.7085 40.5076 19.802 41.4021 20.7025ZM57.5403 8.61028H61.6298L61.9494 11.1509C62.9931 9.37144 64.729 8.48171 67.1572 8.48171C67.7749 8.48171 68.3074 8.52456 68.7547 8.61028L67.8281 12.9519C67.5725 12.9091 67.3915 12.8875 67.285 12.8875C65.794 12.8875 64.548 13.3485 63.5468 14.2705C62.5457 15.1709 62.0453 16.7038 62.0453 18.8693V26.2983H57.5403V8.61028ZM73.0891 11.0223C74.8357 9.24274 76.9551 8.35301 79.4471 8.35301C80.9381 8.35301 82.3333 8.70677 83.6325 9.4143C84.9319 10.1004 86.0075 11.033 86.8595 12.2122L83.1533 14.6885C82.2374 13.5308 81.0021 12.9519 79.4471 12.9519C78.2118 12.9519 77.1574 13.3914 76.2841 14.2705C75.4109 15.1494 74.9741 16.2107 74.9741 17.4543C74.9741 18.7193 75.4109 19.7912 76.2841 20.6703C77.1574 21.5494 78.2118 21.9888 79.4471 21.9888C81.0872 21.9888 82.3439 21.3456 83.2172 20.0593L86.9553 22.5677C86.1247 23.7899 85.049 24.7653 83.7284 25.4943C82.4079 26.2232 80.9808 26.5878 79.4471 26.5878C76.9551 26.5878 74.8251 25.6979 73.0571 23.9184C71.3106 22.1175 70.4373 19.9628 70.4373 17.4543C70.4373 14.9458 71.3213 12.8018 73.0891 11.0223ZM91.4977 11.0223C93.2443 9.24274 95.3636 8.35301 97.8558 8.35301C100.348 8.35301 102.478 9.25352 104.246 11.0544C106.035 12.834 106.929 14.9672 106.929 17.4543C106.929 19.9628 106.046 22.1068 104.278 23.8862C102.488 25.6873 100.348 26.5878 97.8558 26.5878C95.3636 26.5878 93.2336 25.6979 91.4658 23.9184C89.7191 22.1175 88.8459 19.9628 88.8459 17.4543C88.8459 14.9458 89.7298 12.8018 91.4977 11.0223ZM93.3828 17.4543C93.3828 18.7193 93.8194 19.7912 94.6927 20.6703C95.566 21.5494 96.6203 21.9888 97.8558 21.9888C99.1124 21.9888 100.177 21.5494 101.051 20.6703C101.924 19.7912 102.361 18.7193 102.361 17.4543C102.361 16.2107 101.924 15.1494 101.051 14.2705C100.177 13.3914 99.1124 12.9519 97.8558 12.9519C96.6203 12.9519 95.566 13.3914 94.6927 14.2705C93.8194 15.1494 93.3828 16.2107 93.3828 17.4543ZM109.802 26.2983V8.61028H113.892L114.179 11.1831C114.69 10.3255 115.361 9.63936 116.192 9.12482C117.044 8.58885 118.002 8.3208 119.067 8.3208C121.197 8.3208 122.88 9.06053 124.116 10.5399C125.372 12.0192 126 14.2597 126 17.2614V26.2983H121.527V17.2614C121.527 15.782 121.176 14.6671 120.473 13.9167C119.792 13.1449 118.94 12.7589 117.917 12.7589C116.873 12.7589 116.011 13.1449 115.329 13.9167C114.648 14.6671 114.307 15.782 114.307 17.2614V26.2983H109.802Z",fill:"#323238"}),m.jsx("path",{d:"M27.3723 22.6039C27.9964 23.7209 27.189 25.097 25.9095 25.097H4.88702C3.6005 25.097 2.79387 23.7073 3.43201 22.5902L14.0587 3.98729C14.7055 2.85516 16.3405 2.86285 16.9765 4.00102L27.3723 22.6039Z",stroke:"#D83A52",strokeWidth:"4.5177"})]})}),m.jsx("div",{className:"flex-1 flex items-center justify-center p-8 relative z-10",children:m.jsx("div",{className:"w-full max-w-[360px]",children:m.jsxs("div",{className:"flex flex-col gap-6",children:[m.jsxs("div",{className:"text-center space-y-2",children:[m.jsx("h1",{className:"text-[#172B4D] font-roboto text-[28px] font-bold leading-[42px]",children:"Enter Verification Code"}),m.jsxs("p",{className:"text-[#676879] font-roboto text-sm font-normal leading-[22px]",children:["We've sent a code to ",d]})]}),m.jsx("div",{className:"flex justify-center gap-4",children:n.map((k,N)=>m.jsx("input",{ref:I=>l.current[N]=I,type:"text",value:k,onChange:I=>x(N,I.target.value),onKeyDown:I=>v(N,I),onPaste:N===0?y:void 0,disabled:s,className:"w-12 h-[54px] text-center border border-[#C3C6D4] rounded bg-white text-lg font-medium focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent disabled:opacity-50",maxLength:1},N))}),i&&m.jsx("div",{className:"p-3 rounded-lg bg-[#FEE2E2] border border-[#FCA5A5]",children:m.jsx("p",{className:"text-sm text-[#DC2626] text-center",children:i})}),m.jsx("div",{className:"text-center",children:m.jsx("button",{onClick:b,disabled:t,className:"text-[#676879] font-roboto text-sm font-normal hover:text-primary transition-colors",children:t?"Sending...":m.jsxs(m.Fragment,{children:["Didn't get a code?"," ",m.jsx("span",{className:"text-primary underline",children:"Click to Resend"})]})})}),m.jsx("button",{onClick:w,disabled:!S||s,className:`w-full h-12 px-4 py-3 rounded font-roboto text-base font-bold transition-colors ${S&&!s?"bg-primary hover:bg-primary/90 text-white":"bg-primary/50 text-white cursor-not-allowed"}`,children:s?m.jsxs("div",{className:"flex items-center justify-center gap-2",children:[m.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[m.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),m.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),m.jsx("span",{children:"Verifying..."})]}):"Log In"})]})})}),m.jsxs("div",{className:"lg:hidden p-8 text-center relative z-10",children:[m.jsx("h2",{className:"text-[#172B4D] font-roboto text-[32px] font-bold leading-tight mb-6",children:"Proof of identity, made simple."}),m.jsx("p",{className:"text-[#676879] font-roboto text-[13px] font-normal leading-5",children:"Easily verify your identity in seconds with our secure and seamless process."})]})]})]})}const f9e=({status:n})=>{const e=n==="in-progress";return m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("div",{className:`w-2 h-2 rounded-full ${e?"bg-[#C98F20]":"bg-[#616273]"}`}),m.jsx("span",{className:`font-roboto text-xs font-normal leading-5 ${e?"text-[#402C1B]":"text-[#616273]"}`,children:e?"In Progress":"Not Yet Started"})]})},h9e=({progress:n})=>{const s=67.181*Math.PI,o=s-n/100*s;return m.jsxs("div",{className:"relative w-20 h-20",children:[m.jsxs("svg",{className:"w-20 h-20 -rotate-90",width:"80",height:"80",children:[m.jsx("circle",{cx:"40",cy:"40",r:33.5905,fill:"white",stroke:"#E9EDF3",strokeWidth:4.819}),n>0&&m.jsx("circle",{cx:"40",cy:"40",r:33.5905,fill:"none",stroke:"#0073EA",strokeWidth:4.819,strokeDasharray:`${s} ${s}`,strokeDashoffset:o,strokeLinecap:"round"})]}),m.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:m.jsxs("span",{className:"text-black font-roboto text-[23px] font-bold leading-[25px]",children:[n,"%"]})})]})};function dk({title:n,documentType:e,progress:t,expiryDate:r,status:s}){const o=s==="in-progress"?"#EFDDBC":"#E9EAED";return m.jsx("div",{className:"flex flex-col items-start rounded border-l-[8px]",style:{borderLeftColor:o},children:m.jsxs("div",{className:"flex px-3 py-2 flex-col justify-center items-start self-stretch rounded-tr rounded-br border-t border-r border-b border-[#DEDEDD] bg-white",children:[m.jsxs("div",{className:"flex h-7 justify-between items-center self-stretch",children:[m.jsx("h3",{className:"flex-1 text-[#402C1B] text-left font-roboto text-sm font-bold leading-normal truncate",children:n}),m.jsx(f9e,{status:s})]}),m.jsxs("div",{className:"flex items-center gap-4 self-stretch",children:[m.jsx(h9e,{progress:t}),m.jsxs("div",{className:"flex flex-col justify-center items-start gap-1 flex-1",children:[m.jsx("span",{className:"text-[#505258] font-roboto text-xs font-normal leading-5",children:e}),m.jsxs("div",{className:"text-[#505258] font-roboto text-xs font-normal leading-5",children:[m.jsx("span",{className:"font-semibold text-[#D83A52]",children:"Expires"})," on"," ",r]})]})]})]})})}const p9e=()=>m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("div",{className:"w-2 h-2 rounded-full bg-[#D83A52]"}),m.jsx("span",{className:"font-roboto text-xs font-normal leading-5 text-[#49290E]",children:"Expired"})]});function Wz({title:n,documentType:e,expiredDate:t,issuedOn:r}){return m.jsx("div",{className:"flex flex-col items-start gap-2 rounded border border-[#DEDEDD] bg-white",children:m.jsxs("div",{className:"flex px-3 py-2 flex-col justify-center items-start self-stretch gap-2",children:[m.jsxs("div",{className:"flex h-7 justify-between items-center self-stretch",children:[m.jsx("h3",{className:"flex-1 text-[#172B4D] text-left font-roboto text-sm font-bold leading-normal truncate",children:n}),m.jsx(p9e,{})]}),m.jsxs("div",{className:"flex items-center gap-1 self-stretch",children:[m.jsx("svg",{className:"w-4 h-4",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M9.33073 1.51562V4.26932C9.33073 4.64268 9.33073 4.82937 9.4034 4.97198C9.46733 5.09742 9.56926 5.1994 9.69473 5.26332C9.83733 5.33598 10.024 5.33598 10.3974 5.33598H13.1511M9.33073 11.3359H5.33073M10.6641 8.66927H5.33073M13.3307 6.66142V11.4693C13.3307 12.5894 13.3307 13.1494 13.1127 13.5773C12.921 13.9536 12.6151 14.2595 12.2387 14.4513C11.8109 14.6693 11.2509 14.6693 10.1307 14.6693H5.86406C4.74396 14.6693 4.1839 14.6693 3.75608 14.4513C3.37976 14.2595 3.0738 13.9536 2.88205 13.5773C2.66406 13.1494 2.66406 12.5894 2.66406 11.4693V4.53594C2.66406 3.41583 2.66406 2.85578 2.88205 2.42796C3.0738 2.05163 3.37976 1.74567 3.75608 1.55392C4.1839 1.33594 4.74396 1.33594 5.86406 1.33594H8.00526C8.4944 1.33594 8.739 1.33594 8.9692 1.3912C9.17326 1.44019 9.36833 1.521 9.54733 1.63066C9.74913 1.75434 9.92206 1.92729 10.268 2.2732L12.3935 4.39868C12.7394 4.74458 12.9123 4.91754 13.036 5.11937C13.1457 5.29831 13.2265 5.4934 13.2755 5.69747C13.3307 5.92765 13.3307 6.17224 13.3307 6.66142Z",stroke:"#676879",strokeWidth:"1.33333",strokeLinecap:"round",strokeLinejoin:"round"})}),m.jsx("span",{className:"text-[#505258] font-roboto text-xs font-normal leading-5",children:"Employee ID Card"})]}),m.jsxs("div",{className:"flex justify-between items-start self-stretch",children:[m.jsxs("div",{className:"flex flex-col items-start gap-1",children:[m.jsx("span",{className:"text-[#505258] font-roboto text-xs font-normal leading-5",children:"Issued on"}),m.jsx("span",{className:"text-[#172B4D] font-roboto text-xs font-semibold leading-5",children:r})]}),m.jsxs("div",{className:"flex flex-col items-start gap-1",children:[m.jsx("span",{className:"text-[#505258] font-roboto text-xs font-normal leading-5",children:"Expired on"}),m.jsx("span",{className:"text-[#D83A52] font-roboto text-xs font-semibold leading-5",children:t})]})]}),m.jsxs("button",{className:"flex items-center gap-0.5",children:[m.jsx("svg",{className:"w-4 h-4",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M8 8.66667V12M8 5.33333H8.00667M14.6667 8C14.6667 11.6819 11.6819 14.6667 8 14.6667C4.3181 14.6667 1.33333 11.6819 1.33333 8C1.33333 4.3181 4.3181 1.33333 8 1.33333C11.6819 1.33333 14.6667 4.3181 14.6667 8Z",stroke:"#D83A52",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),m.jsx("span",{className:"text-[#D83A52] font-roboto text-xs font-normal leading-5",children:"Link expired before completion"})]})]})})}function m9e({trigger:n,onConfirm:e}){const[t,r]=_.useState(!1),s=()=>{e?.(),r(!1)};return m.jsxs(Zg,{open:t,onOpenChange:r,children:[m.jsx(YA,{asChild:!0,children:n}),m.jsx(Hp,{className:"max-w-[548px] p-0 gap-0",children:m.jsxs("div",{className:"flex items-start gap-6 p-6",children:[m.jsx("div",{className:"flex w-12 h-12 justify-center items-center flex-shrink-0 rounded-[28px] border-8 border-[#FEF3F2] bg-[#FEE4E2]",children:m.jsx("svg",{className:"w-6 h-6 flex-shrink-0",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M12 8V12M12 16H12.01M22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12Z",stroke:"#D92D20",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),m.jsxs("div",{className:"flex flex-col gap-12 flex-1",children:[m.jsxs("div",{className:"flex flex-col gap-2 pr-5",children:[m.jsx(Gp,{className:"text-[#323238] font-roboto text-base font-bold leading-4",children:"Revoke Consent"}),m.jsx("p",{className:"text-[#505258] font-roboto text-[13px] font-normal leading-5",children:"Revoking will stop verification and delete your shared data. Continue?"})]}),m.jsxs("div",{className:"flex justify-end items-center gap-2 pr-5 bg-white",children:[m.jsx("button",{onClick:()=>r(!1),className:"flex h-[38px] px-4 py-2.5 justify-center items-center rounded bg-white text-[#505258] font-roboto text-[13px] font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),m.jsx("button",{onClick:s,className:"flex h-[38px] px-4 py-2.5 justify-center items-center gap-0.5 rounded border border-[#D83A52] bg-[#D83A52] text-white font-roboto text-[13px] font-medium hover:bg-[#C02E47] transition-colors",children:"Yes, Revoke"})]})]})]})})]})}function g9e({trigger:n,data:e}){const t=e?.personalInfo||{firstName:"Opinder",lastName:"Singh",dateOfBirth:"12/08/1997",email:"opinder.singh@email.com",phoneNumber:"+91 96****1234",addressLine:"123, Carter Road,",city:"Mumbai",state:"Maharashtra",pinCode:"353729",country:"India",idDocumentNumber:"2416238128389"},r=e?.documents||[{image:"https://api.builder.io/api/v1/image/assets/TEMP/c38cf62b3314c2aa7de5c89dfdfb5b200b0d4976?width=65",name:"Filename.jpeg1",type:"JPEG",size:"Size 2.5 MB"},{image:"https://api.builder.io/api/v1/image/assets/TEMP/c38cf62b3314c2aa7de5c89dfdfb5b200b0d4976?width=65",name:"Filename.2png",type:"PNG",size:"Size 1.4 MB"}],s=e?.biometricVerified??!0;return m.jsxs(Zg,{children:[m.jsx(YA,{asChild:!0,children:n}),m.jsx(Hp,{className:"max-w-[960px] max-h-[90vh] overflow-y-auto p-0 gap-0",children:m.jsxs("div",{className:"flex flex-col gap-5 pb-5",children:[m.jsx("div",{className:"flex h-[52px] px-5 py-2.5 justify-between items-center border-b border-[#D0D4E4] bg-white rounded-t-lg sticky top-0 z-10",children:m.jsx(Gp,{className:"text-[#323238] font-figtree text-lg font-bold leading-[26px]",children:"Arcon Document Submission"})}),m.jsxs("div",{className:"flex flex-col gap-2 px-5",children:[m.jsxs("div",{className:"flex flex-col gap-0 rounded-lg bg-[#F6F7FB] p-3 pb-3",children:[m.jsx("div",{className:"flex h-[38px] items-center",children:m.jsx("h3",{className:"text-[#323238] font-roboto text-[15px] font-bold leading-3",children:"Personal Information"})}),m.jsxs("div",{className:"flex flex-col gap-2 bg-white p-2 rounded",children:[m.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 pb-2 border-b border-[#DEDEDD]",children:[m.jsxs("div",{className:"flex flex-col",children:[m.jsx("span",{className:"text-[#323238] font-roboto text-[13px] font-medium leading-[18px]",children:"First Name"}),m.jsx("span",{className:"text-[#505258] font-roboto text-[13px] font-normal leading-5",children:t.firstName})]}),m.jsxs("div",{className:"flex flex-col",children:[m.jsx("span",{className:"text-[#323238] font-roboto text-[13px] font-medium leading-[18px]",children:"Last Name"}),m.jsx("span",{className:"text-[#505258] font-roboto text-[13px] font-normal leading-5",children:t.lastName})]}),m.jsxs("div",{className:"flex flex-col",children:[m.jsx("span",{className:"text-[#172B4D] font-roboto text-[13px] font-medium leading-[11.181px]",children:"Date Of Birth"}),m.jsx("span",{className:"text-[#505258] font-roboto text-[13px] font-normal leading-5",children:t.dateOfBirth})]}),m.jsxs("div",{className:"flex flex-col",children:[m.jsx("span",{className:"text-[#172B4D] font-roboto text-[13px] font-medium leading-[11.181px]",children:"Email"}),m.jsx("span",{className:"text-[#505258] font-roboto text-[13px] font-normal leading-5 break-all",children:t.email})]})]}),m.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 pb-4 border-b border-[#DEDEDD]",children:[m.jsxs("div",{className:"flex flex-col",children:[m.jsx("span",{className:"text-[#323238] font-roboto text-[13px] font-medium leading-[18px]",children:"Phone Number"}),m.jsx("span",{className:"text-[#505258] font-roboto text-[13px] font-normal leading-5",children:t.phoneNumber})]}),m.jsxs("div",{className:"flex flex-col",children:[m.jsx("span",{className:"text-[#323238] font-roboto text-[13px] font-medium leading-[18px]",children:"Address Line"}),m.jsx("span",{className:"text-[#505258] font-roboto text-[13px] font-normal leading-5",children:t.addressLine})]}),m.jsxs("div",{className:"flex flex-col",children:[m.jsx("span",{className:"text-[#172B4D] font-roboto text-[13px] font-medium leading-[11.181px]",children:"City"}),m.jsx("span",{className:"text-[#505258] font-roboto text-[13px] font-normal leading-5",children:t.city})]}),m.jsxs("div",{className:"flex flex-col",children:[m.jsx("span",{className:"text-[#172B4D] font-roboto text-[13px] font-medium leading-[11.181px]",children:"State"}),m.jsx("span",{className:"text-[#505258] font-roboto text-[13px] font-normal leading-5",children:t.state})]})]}),m.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 pb-4",children:[m.jsxs("div",{className:"flex flex-col",children:[m.jsx("span",{className:"text-[#323238] font-roboto text-[13px] font-medium leading-[18px]",children:"Pin Code"}),m.jsx("span",{className:"text-[#505258] font-roboto text-[13px] font-normal leading-5",children:t.pinCode})]}),m.jsxs("div",{className:"flex flex-col",children:[m.jsx("span",{className:"text-[#172B4D] font-roboto text-[13px] font-medium leading-[18px]",children:"Country"}),m.jsx("span",{className:"text-[#505258] font-roboto text-[13px] font-normal leading-5",children:t.country})]}),m.jsxs("div",{className:"flex flex-col",children:[m.jsx("span",{className:"text-[#172B4D] font-roboto text-[13px] font-medium leading-[11.181px]",children:"ID Document Number"}),m.jsx("span",{className:"text-[#505258] font-roboto text-[13px] font-normal leading-5",children:t.idDocumentNumber})]}),m.jsxs("div",{className:"flex flex-col",children:[m.jsx("span",{className:"text-[#172B4D] font-roboto text-[13px] font-medium leading-[11.181px]",children:"State"}),m.jsx("span",{className:"text-[#505258] font-roboto text-[13px] font-normal leading-5",children:t.state})]})]})]})]}),m.jsxs("div",{className:"flex flex-col gap-0 rounded-lg bg-[#F6F7FB] p-3 pb-3",children:[m.jsx("div",{className:"flex h-[38px] items-center",children:m.jsx("h3",{className:"text-[#323238] font-roboto text-[15px] font-bold leading-3",children:"Document Submitted"})}),m.jsx("div",{className:"bg-white rounded overflow-x-auto",children:m.jsxs("div",{className:"min-w-[600px]",children:[m.jsxs("div",{className:"grid grid-cols-4 border-b border-[#DEDEDD]",children:[m.jsx("div",{className:"flex items-center h-[38px] px-2",children:m.jsx("span",{className:"text-[#323238] font-figtree text-[13px] font-semibold",children:"Image"})}),m.jsx("div",{className:"flex items-center h-[38px] px-2",children:m.jsx("span",{className:"text-[#323238] font-figtree text-[13px] font-semibold",children:"Name"})}),m.jsx("div",{className:"flex items-center h-[38px] px-2",children:m.jsx("span",{className:"text-[#323238] font-figtree text-[13px] font-semibold",children:"Type"})}),m.jsx("div",{className:"flex items-center h-[38px] px-2",children:m.jsx("span",{className:"text-[#323238] font-figtree text-[13px] font-semibold",children:"Size"})})]}),r.map((o,i)=>m.jsxs("div",{className:"grid grid-cols-4 border-t border-[#D0D4E4]",children:[m.jsx("div",{className:"flex items-center h-[38px] px-2",children:m.jsx("div",{className:"w-8 h-8 rounded-[0.8px] border-[0.2px] border-[#8D8F96] bg-white overflow-hidden",children:m.jsx("img",{src:o.image,alt:o.name,className:"w-full h-full object-cover"})})}),m.jsx("div",{className:"flex items-center h-[38px] px-2",children:m.jsx("span",{className:"text-[#676879] font-roboto text-[13px] font-normal leading-5 truncate",children:o.name})}),m.jsx("div",{className:"flex items-center h-[38px] px-2",children:m.jsx("span",{className:"text-[#676879] font-roboto text-[13px] font-normal leading-5",children:o.type})}),m.jsx("div",{className:"flex items-center h-[38px] px-2",children:m.jsx("span",{className:"text-[#676879] font-figtree text-[13px] font-normal leading-5",children:o.size})})]},i))]})})]}),m.jsxs("div",{className:"flex flex-col gap-0 rounded-lg bg-[#F6F7FB] p-3 pb-3",children:[m.jsx("div",{className:"flex h-[38px] items-center",children:m.jsx("h3",{className:"text-[#323238] font-roboto text-[15px] font-bold leading-3",children:"Biometric Verification"})}),m.jsx("div",{className:"bg-white p-4 rounded",children:m.jsx("div",{className:"flex items-center",children:m.jsx("span",{className:"text-[#323238] font-roboto text-[13px] font-medium leading-[18px]",children:s?"Biometric face capture is successful":"Biometric verification pending"})})})]}),m.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 rounded-lg bg-[#F6F7FB] p-3",children:[m.jsx("p",{className:"text-[#323238] font-roboto text-sm font-normal flex-1",children:"You've shared your details for identity verification. Do you wish to revoke your consent?"}),m.jsx(m9e,{trigger:m.jsx("button",{className:"flex h-8 px-2 py-2.5 justify-center items-center rounded text-[#0073EA] font-roboto text-[13px] font-medium hover:bg-[#0073EA]/10 transition-colors whitespace-nowrap",children:"Revoke Consent"}),onConfirm:()=>{console.log("Consent revoked")}})]})]})]})})]})}const x9e=()=>m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("div",{className:"w-2 h-2 rounded-full bg-[#5E9872]"}),m.jsx("span",{className:"font-roboto text-xs font-normal leading-5 text-[#1C3829]",children:"Verified"})]});function Uz({title:n,documentType:e,completedOn:t,expiresOn:r}){return m.jsx("div",{className:"flex flex-col items-start gap-2 rounded border border-[#DEDEDD] bg-white",children:m.jsxs("div",{className:"flex px-3 py-2 flex-col justify-center items-start self-stretch gap-2",children:[m.jsxs("div",{className:"flex h-7 justify-between items-center self-stretch",children:[m.jsx("h3",{className:"flex-1 text-[#172B4D] text-left font-roboto text-sm font-bold leading-normal truncate",children:n}),m.jsx(x9e,{})]}),m.jsxs("div",{className:"flex items-center gap-1 self-stretch",children:[m.jsx("svg",{className:"w-4 h-4",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M9.33073 1.51562V4.26932C9.33073 4.64268 9.33073 4.82937 9.4034 4.97198C9.46733 5.09742 9.56926 5.1994 9.69473 5.26332C9.83733 5.33598 10.024 5.33598 10.3974 5.33598H13.1511M9.33073 11.3359H5.33073M10.6641 8.66927H5.33073M13.3307 6.66142V11.4693C13.3307 12.5894 13.3307 13.1494 13.1127 13.5773C12.921 13.9536 12.6151 14.2595 12.2387 14.4513C11.8109 14.6693 11.2509 14.6693 10.1307 14.6693H5.86406C4.74396 14.6693 4.1839 14.6693 3.75608 14.4513C3.37976 14.2595 3.0738 13.9536 2.88205 13.5773C2.66406 13.1494 2.66406 12.5894 2.66406 11.4693V4.53594C2.66406 3.41583 2.66406 2.85578 2.88205 2.42796C3.0738 2.05163 3.37976 1.74567 3.75608 1.55392C4.1839 1.33594 4.74396 1.33594 5.86406 1.33594H8.00526C8.4944 1.33594 8.739 1.33594 8.9692 1.3912C9.17326 1.44019 9.36833 1.521 9.54733 1.63066C9.74913 1.75434 9.92206 1.92729 10.268 2.2732L12.3935 4.39868C12.7394 4.74458 12.9123 4.91754 13.036 5.11937C13.1457 5.29831 13.2265 5.4934 13.2755 5.69747C13.3307 5.92765 13.3307 6.17224 13.3307 6.66142Z",stroke:"#676879",strokeWidth:"1.33333",strokeLinecap:"round",strokeLinejoin:"round"})}),m.jsx("span",{className:"text-[#505258] font-roboto text-xs font-normal leading-5",children:"Employee ID Card"})]}),m.jsxs("div",{className:"flex justify-between items-start self-stretch",children:[m.jsxs("div",{className:"flex flex-col items-start gap-1",children:[m.jsx("span",{className:"text-[#505258] font-roboto text-xs font-normal leading-5",children:"Completed on"}),m.jsx("span",{className:"text-[#172B4D] font-roboto text-xs font-semibold leading-5",children:t})]}),m.jsxs("div",{className:"flex flex-col items-start gap-1",children:[m.jsx("span",{className:"text-[#505258] font-roboto text-xs font-normal leading-5",children:"Expires on"}),m.jsx("span",{className:"text-[#D83A52] font-roboto text-xs font-semibold leading-5",children:r})]})]}),m.jsx(g9e,{trigger:m.jsxs("button",{className:"flex items-center gap-0.5 text-[#0073EA] font-roboto text-xs font-normal leading-5 hover:underline",children:["View Details",m.jsx("svg",{className:"w-3 h-3",width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M2.5 6H9.5M9.5 6L6.5 3M9.5 6L6.5 9",stroke:"#0073EA",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})]})})]})})}const v9e=[{id:"1",title:"Employment Verification",documentType:"Employee ID Card",progress:15,expiryDate:"Oct 10, 2025",status:"in-progress"},{id:"2",title:"Employment Verification",documentType:"Employee ID Card",progress:0,expiryDate:"Oct 10, 2025",status:"not-started"},{id:"3",title:"Employment Verification",documentType:"Employee ID Card",progress:0,expiryDate:"N/A",status:"not-started"}],y9e=[{id:"4",title:"Arcon Document Submission",documentType:"Passport",expiredDate:"Oct 10, 2025",issuedOn:"June 05, 2025"},{id:"5",title:"Arcon Document Submission",documentType:"Passport",expiredDate:"Oct 10, 2025",issuedOn:"June 05, 2025"},{id:"6",title:"Arcon Document Submission",documentType:"Passport",expiredDate:"Oct 10, 2025",issuedOn:"June 05, 2025"}],b9e=[{id:"7",title:"Arcon Document Submission",documentType:"Passport",completedOn:"Oct 10, 2025",expiresOn:"Oct 10, 2025"},{id:"8",title:"Arcon Document Submission",documentType:"Passport",completedOn:"Oct 10, 2025",expiresOn:"Oct 10, 2025"},{id:"9",title:"Arcon Document Submission",documentType:"Passport",completedOn:"Oct 10, 2025",expiresOn:"Oct 10, 2025"}],w9e=({cards:n})=>m.jsxs("div",{className:"flex flex-col items-start gap-2.5 w-full",children:[m.jsxs("div",{className:"flex justify-between items-start w-full",children:[m.jsx("h2",{className:"text-[#172B4D] font-roboto text-base font-bold leading-[26px]",children:"Ongoing Verifications"}),m.jsx("button",{className:"flex h-7 px-3 py-2.25 justify-center items-center gap-2 rounded",children:m.jsx("span",{className:"text-[#0073EA] font-roboto text-xs font-medium leading-normal",children:"View All"})})]}),m.jsx("div",{className:"grid w-full gap-5 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3",children:n.map(e=>m.jsx("div",{className:"w-full",children:m.jsx(dk,{title:e.title,documentType:e.documentType,progress:e.progress,expiryDate:e.expiryDate,status:e.status})},e.id))})]}),C9e=({cards:n})=>m.jsxs("div",{className:"flex flex-col items-start gap-2.5 w-full",children:[m.jsxs("div",{className:"flex justify-between items-start w-full",children:[m.jsx("h2",{className:"text-[#172B4D] font-roboto text-base font-bold leading-[26px]",children:"Expired Verification"}),m.jsx("button",{className:"flex h-7 px-3 py-2.25 justify-center items-center gap-2 rounded",children:m.jsx("span",{className:"text-[#0073EA] font-roboto text-xs font-medium leading-normal",children:"View All"})})]}),m.jsx("div",{className:"grid w-full gap-5 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3",children:n.map(e=>m.jsx("div",{className:"w-full",children:m.jsx(Wz,{title:e.title,documentType:e.documentType,expiredDate:e.expiredDate,issuedOn:e.issuedOn})},e.id))})]}),k9e=({cards:n})=>m.jsxs("div",{className:"flex flex-col items-start gap-2.5 w-full",children:[m.jsxs("div",{className:"flex justify-between items-start w-full",children:[m.jsx("h2",{className:"text-[#172B4D] font-roboto text-base font-bold leading-[26px]",children:"Verified Credentials"}),m.jsx("button",{className:"flex h-7 px-3 py-2.25 justify-center items-center gap-2 rounded",children:m.jsx("span",{className:"text-[#0073EA] font-roboto text-xs font-medium leading-normal",children:"View All"})})]}),m.jsx("div",{className:"grid w-full gap-5 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3",children:n.map(e=>m.jsx("div",{className:"w-full",children:m.jsx(Uz,{title:e.title,documentType:e.documentType,completedOn:e.completedOn,expiresOn:e.expiresOn})},e.id))})]});function S9e(){const n=si(),e=hc(),[t,r]=_.useState("home");_.useEffect(()=>{const o=e.pathname||"";o.startsWith("/ongoing")?r("ongoing"):o.startsWith("/expired")?r("expired"):o.startsWith("/verified")?r("verified"):o.startsWith("/contact")?r("contact"):r("home")},[e.pathname]);const s=[{id:"home",label:"Home",icon:o=>m.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9.56584 1.11261C9.85109 1.03538 10.1518 1.03538 10.437 1.11261C10.7681 1.20227 11.0469 1.42115 11.2694 1.59584C13.1889 3.10283 15.1203 4.59457 17.0483 6.09074C17.3622 6.33431 17.6387 6.5489 17.8447 6.82749C18.0255 7.07197 18.1603 7.3474 18.2422 7.64023C18.3356 7.97391 18.3353 8.32392 18.3348 8.72123C18.3327 10.769 18.3348 12.8167 18.3348 14.8645C18.3348 15.3037 18.3348 15.6826 18.3093 15.9948C18.2823 16.3243 18.2229 16.652 18.0623 16.9673C17.8226 17.4376 17.4401 17.8201 16.9698 18.0598C16.6544 18.2205 16.3268 18.2799 15.9973 18.3068C15.3293 18.3614 14.6518 18.332 13.9821 18.3323C13.8828 18.3323 13.7643 18.3324 13.6599 18.3239C13.5388 18.314 13.3655 18.2886 13.1839 18.1961C12.9488 18.0762 12.7575 17.885 12.6377 17.6498C12.5451 17.4681 12.5198 17.2948 12.5098 17.1738C12.5013 17.0694 12.5013 16.9508 12.5014 16.8516L12.508 12.1881C12.5087 11.7207 12.5089 11.4871 12.4183 11.3086C12.3384 11.1516 12.2109 11.0238 12.054 10.9438C11.8756 10.8528 11.6419 10.8528 11.1747 10.8528H8.84143C8.37534 10.8528 8.14227 10.8528 7.96414 10.9435C7.80744 11.0232 7.67999 11.1505 7.60002 11.3071C7.50909 11.4851 7.50876 11.7181 7.50809 12.1842L7.50142 16.8516C7.50146 16.9508 7.5015 17.0694 7.49297 17.1738C7.48309 17.2948 7.45772 17.4681 7.36518 17.6498C7.24534 17.885 7.05411 18.0762 6.8189 18.1961C6.63729 18.2886 6.46395 18.314 6.34294 18.3239C6.23851 18.3324 6.11997 18.3323 6.02071 18.3323C5.35097 18.332 4.67349 18.3614 4.00556 18.3068C3.6761 18.2799 3.34843 18.2205 3.03311 18.0598C2.5627 17.8201 2.18025 17.4376 1.94057 16.9673C1.7799 16.652 1.72048 16.3243 1.69356 15.9948C1.66805 15.6826 1.66807 15.3037 1.66809 14.8644C1.66809 12.8166 1.67024 10.7689 1.66803 8.72123C1.66759 8.32392 1.66722 7.97391 1.76062 7.64023C1.84259 7.3474 1.97729 7.07197 2.15812 6.82749C2.36417 6.5489 2.64068 6.33431 2.95454 6.09075C4.88239 4.59464 6.814 3.1028 8.73343 1.59584C8.95593 1.42115 9.23468 1.20227 9.56584 1.11261Z",fill:o?"#0073EA":"#676879"})})},{id:"ongoing",label:"Ongoing Verification",icon:o=>m.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M18.9167 9.58333L17.2504 11.25L15.5833 9.58333M17.4543 10.8333C17.4845 10.5597 17.5 10.2817 17.5 10C17.5 5.85787 14.1422 2.5 10 2.5C5.85787 2.5 2.5 5.85787 2.5 10C2.5 14.1422 5.85787 17.5 10 17.5C12.3561 17.5 14.4583 16.4136 15.8333 14.7144M10 5.83333V10L12.5 11.6667",stroke:o?"#0073EA":"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),onClick:()=>n("/ongoing-verification")},{id:"expired",label:"Expired Verification",icon:o=>m.jsxs("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("g",{clipPath:"url(#clip0_11001_18676)",children:m.jsx("path",{d:"M12.5013 7.50521L7.5013 12.5052M7.5013 7.50521L12.5013 12.5052M18.3346 10.0052C18.3346 14.6075 14.6036 18.3385 10.0013 18.3385C5.39893 18.3385 1.66797 14.6075 1.66797 10.0052C1.66797 5.40283 5.39893 1.67188 10.0013 1.67188C14.6036 1.67188 18.3346 5.40283 18.3346 10.0052Z",stroke:o?"#0073EA":"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),m.jsx("defs",{children:m.jsx("clipPath",{id:"clip0_11001_18676",children:m.jsx("rect",{width:"20",height:"20",fill:"white"})})})]}),onClick:()=>n("/expired-verification")},{id:"verified",label:"Verified Credentials",icon:o=>m.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M7.5 9.16667L10 11.6667L18.3333 3.33333M13.3333 2.5H6.5C5.09987 2.5 4.3998 2.5 3.86503 2.77248C3.39462 3.01217 3.01217 3.39462 2.77248 3.86503C2.5 4.3998 2.5 5.09987 2.5 6.5V13.5C2.5 14.9002 2.5 15.6002 2.77248 16.135C3.01217 16.6054 3.39462 16.9878 3.86503 17.2275C4.3998 17.5 5.09987 17.5 6.5 17.5H13.5C14.9002 17.5 15.6002 17.5 16.135 17.2275C16.6054 16.9878 16.9878 16.6054 17.2275 16.135C17.5 15.6002 17.5 14.9002 17.5 13.5V10",stroke:o?"#0073EA":"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),onClick:()=>n("/verified-credentials")},{id:"contact",label:"Contact Admin",icon:o=>m.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M16.6654 17.5C16.6654 16.337 16.6654 15.7556 16.5219 15.2824C16.1987 14.2171 15.3649 13.3833 14.2996 13.0602C13.8264 12.9167 13.245 12.9167 12.082 12.9167H7.91536C6.7524 12.9167 6.17091 12.9167 5.69775 13.0602C4.63241 13.3833 3.79873 14.2171 3.47556 15.2824C3.33203 15.7556 3.33203 16.337 3.33203 17.5M13.7487 6.25C13.7487 8.32107 12.0698 10 9.9987 10C7.92763 10 6.2487 8.32107 6.2487 6.25C6.2487 4.17893 7.92763 2.5 9.9987 2.5C12.0698 2.5 13.7487 4.17893 13.7487 6.25Z",stroke:o?"#0073EA":"#676879",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})}),onClick:()=>n("/contact-admin")}];return m.jsxs("div",{className:"flex flex-col w-full h-screen bg-white",children:[m.jsxs("div",{className:"flex w-full h-11 px-3 lg:px-4 justify-between items-center border-b border-[#DEDEDD] bg-white",children:[m.jsx("img",{src:"https://api.builder.io/api/v1/image/assets/TEMP/4566b1e4f2b69299156b1f1c61472e06e0ad9666?width=180",alt:"Logo",className:"w-[90px] h-7 object-contain"}),m.jsx("div",{className:"flex items-center gap-2",children:m.jsx("button",{onClick:()=>n("/profile"),className:"flex w-8 h-8 p-2 justify-center items-center gap-2 rounded-full bg-[#F65F7C]",children:m.jsx("span",{className:"text-white font-roboto text-xs font-medium leading-[10px]",children:"OS"})})})]}),m.jsxs("div",{className:"flex flex-1 h-[calc(100vh-44px)] bg-white",children:[m.jsx("div",{className:"flex w-[248px] px-2 py-2 flex-col items-start gap-1 border-r border-[#D0D4E4] bg-white overflow-y-auto",children:s.map(o=>{const i=t===o.id;return m.jsxs("button",{onClick:()=>{r(o.id),o.onClick?.()},className:`flex h-[38px] items-center gap-2 self-stretch rounded ${i?"bg-[#E6F1FD] pl-1 pr-2.25":"pl-3 pr-2.25"}`,children:[i&&m.jsx("svg",{className:"w-0.5 h-[28.5px]",width:"2",height:"31",viewBox:"0 0 2 31",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M1 1V29.5",stroke:"#0073EA",strokeWidth:"2",strokeLinecap:"round"})}),o.icon(i),m.jsx("span",{className:`font-roboto text-[13px] font-medium leading-normal ${i?"text-[#172B4D]":"text-[#505258]"}`,children:o.label})]},o.id)})}),m.jsxs("main",{className:"flex flex-1 flex-col items-start bg-white overflow-y-auto",children:[m.jsx("section",{className:"w-full",children:m.jsxs("div",{className:"relative flex w-full items-center gap-2.5 rounded-b-2xl overflow-hidden h-[138px] bg-gradient-to-br from-[#02294e] via-[#084c85] to-[#0049c1] shadow-sm",style:{zIndex:1},children:[m.jsx("div",{className:"absolute inset-0 w-full h-full pointer-events-none overflow-hidden",children:m.jsx("img",{src:"https://api.builder.io/api/v1/image/assets/TEMP/38b9840b8e157e2e4686f0512b46f97b9e7cb4c5?width=2700",alt:"",className:"absolute inset-0 w-full h-full object-cover opacity-20"})}),m.jsxs("div",{className:"flex px-4 flex-col justify-center items-start gap-[2px] flex-1 relative z-10",children:[m.jsx("h1",{className:"text-white font-roboto text-2xl font-semibold leading-[30px]",children:"Welcome, Opinder Singh !"}),m.jsx("p",{className:"text-white font-roboto text-[13px] font-normal leading-[30px]",children:"Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of classical Latin"})]})]})}),m.jsxs("div",{className:"flex px-4 py-5 flex-col items-start gap-6 self-stretch",children:[m.jsx(w9e,{cards:v9e}),m.jsx(k9e,{cards:b9e}),m.jsx(C9e,{cards:y9e})]})]})]})]})}function N9e({isOpen:n,onClose:e,userEmail:t="opindersingh@email.com"}){const[r,s]=_.useState("select-method"),[o,i]=_.useState("email"),[a,l]=_.useState(t),[c,u]=_.useState("+1"),[d,f]=_.useState(""),[p,x]=_.useState(""),[v,y]=_.useState(null),[b,w]=_.useState(!1),[S,k]=_.useState(null),[N,I]=_.useState(null),T=async()=>{try{const P=await fetch("/user",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({isMfaEnabled:!0})});if(!P.ok){const L=await P.json();throw new Error(L.message||"Failed to update MFA status")}const B=await P.json();console.log("MFA status updated:",B)}catch(P){throw console.error("Error updating MFA status:",P),new Error("Failed to enable MFA. Please try again.")}},F=async()=>{w(!0),k(null),I(null);try{if(o==="email"){const P=await fetch("/api/Otp/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a,versionId:0})});if(!P.ok){const L=await P.json();throw new Error(L.message||"Failed to send verification code")}const B=await P.json();console.log("Email OTP sent:",B),I("Verification code sent to your email!"),s("verify-otp")}else{const P=await fetch("/api/Otp/phone/start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phoneCountryCode:c,phoneNationalNumber:d,channel:"sms",purpose:"mfa_verification",versionId:0})});if(!P.ok){const L=await P.json();throw new Error(L.message||"Failed to send verification code")}const B=await P.json();console.log("Phone OTP sent:",B),B.otpId&&y(B.otpId),I("Verification code sent to your phone!"),s("verify-otp")}}catch(P){console.error("Error sending verification code:",P),k(P.message||"Failed to send verification code. Please try again.")}finally{w(!1)}},R=async()=>{w(!0),k(null),I(null);try{if(o==="email"){const P=await fetch("/api/Otp/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a,otp:p,versionId:0})});if(!P.ok){const L=await P.json();throw new Error(L.message||"Invalid verification code")}const B=await P.json();console.log("Email OTP verified:",B),await T(),I("MFA enabled successfully!"),setTimeout(()=>{D()},2e3)}else{if(!v)throw new Error("OTP ID not found. Please request a new code.");const P=await fetch("/api/Otp/phone/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({otpId:v,code:p})});if(!P.ok){const L=await P.json();throw new Error(L.message||"Invalid verification code")}const B=await P.json();console.log("Phone OTP verified:",B),await T(),I("MFA enabled successfully!"),setTimeout(()=>{D()},2e3)}}catch(P){console.error("Error verifying OTP:",P),k(P.message||"Invalid verification code. Please try again.")}finally{w(!1)}},D=()=>{s("select-method"),i("email"),l(t),u("+1"),f(""),x(""),y(null),k(null),I(null),e()},A=()=>{s("select-method"),x(""),k(null),I(null)};return m.jsx(Zg,{open:n,onOpenChange:D,children:m.jsxs(Hp,{className:"max-w-[510px] p-0 gap-0 rounded-lg overflow-hidden",children:[m.jsxs("div",{className:"flex h-[52px] px-5 py-2.5 justify-between items-center border-b border-[#D0D4E4] bg-white",children:[m.jsx(Gp,{className:"text-[#172B4D] font-roboto text-lg font-bold leading-[26px]",children:"Enable MFA"}),m.jsx(ZA,{className:"flex w-7 h-7 p-2 flex-col justify-center items-center rounded-full bg-white hover:bg-gray-100",children:m.jsx("svg",{className:"w-4 h-4",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M12 4L4 12M4 4L12 12",stroke:"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),m.jsxs("div",{className:"flex px-5 py-5 flex-col items-start gap-4 bg-white",children:[S&&m.jsxs("div",{className:"flex items-start gap-2 self-stretch p-3 rounded-lg bg-[#FEE2E2] border border-[#FCA5A5]",children:[m.jsx("svg",{className:"w-5 h-5 flex-shrink-0 mt-0.5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M10 6V10M10 14H10.01M18 10C18 14.4183 14.4183 18 10 18C5.58172 18 2 14.4183 2 10C2 5.58172 5.58172 2 10 2C14.4183 2 18 5.58172 18 10Z",stroke:"#DC2626",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),m.jsx("span",{className:"text-[#DC2626] font-roboto text-[13px] font-normal leading-5",children:S})]}),N&&m.jsxs("div",{className:"flex items-start gap-2 self-stretch p-3 rounded-lg bg-[#D1FAE5] border border-[#6EE7B7]",children:[m.jsx("svg",{className:"w-5 h-5 flex-shrink-0 mt-0.5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M6 10L8.66667 12.6667L14 7.33333M18 10C18 14.4183 14.4183 18 10 18C5.58172 18 2 14.4183 2 10C2 5.58172 5.58172 2 10 2C14.4183 2 18 5.58172 18 10Z",stroke:"#059669",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),m.jsx("span",{className:"text-[#059669] font-roboto text-[13px] font-normal leading-5",children:N})]}),r==="select-method"?m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"flex flex-col items-start gap-2 self-stretch",children:[m.jsx("h3",{className:"text-[#172B4D] font-roboto text-base font-semibold leading-6",children:"Enable Multi-Factor Authentication"}),m.jsx("p",{className:"text-[#505258] font-roboto text-[13px] font-normal leading-5",children:"Choose how you want to verify your login."})]}),m.jsxs("div",{className:"flex items-start gap-4 self-stretch",children:[m.jsxs("button",{onClick:()=>i("email"),className:`flex flex-1 h-[70px] px-4 py-3 items-center gap-3 rounded-lg border ${o==="email"?"border-[#0073EA] bg-[#F0F7FF]":"border-[#D0D4E4] bg-white"}`,children:[m.jsx("div",{className:"flex w-10 h-10 p-2 justify-center items-center rounded-lg bg-[#8B5CF6]",children:m.jsx("svg",{className:"w-6 h-6",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M2 7L10.1649 12.7154C10.8261 13.1783 11.1567 13.4097 11.5163 13.4993C11.8339 13.5785 12.1661 13.5785 12.4837 13.4993C12.8433 13.4097 13.1739 13.1783 13.8351 12.7154L22 7M6.8 20H17.2C18.8802 20 19.7202 20 20.362 19.673C20.9265 19.3854 21.3854 18.9265 21.673 18.362C22 17.7202 22 16.8802 22 15.2V8.8C22 7.11984 22 6.27976 21.673 5.63803C21.3854 5.07354 20.9265 4.6146 20.362 4.32698C19.7202 4 18.8802 4 17.2 4H6.8C5.11984 4 4.27976 4 3.63803 4.32698C3.07354 4.6146 2.6146 5.07354 2.32698 5.63803C2 6.27976 2 7.11984 2 8.8V15.2C2 16.8802 2 17.7202 2.32698 18.362C2.6146 18.9265 3.07354 19.3854 3.63803 19.673C4.27976 20 5.11984 20 6.8 20Z",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),m.jsx("div",{className:"flex flex-col items-start gap-0.5 flex-1",children:m.jsx("span",{className:"text-[#172B4D] font-roboto text-sm font-semibold leading-5",children:"Email-based Verification"})}),m.jsx("div",{className:"flex w-5 h-5 justify-center items-center",children:m.jsx("div",{className:`w-5 h-5 rounded-full border-2 ${o==="email"?"border-[#0073EA]":"border-[#C3C6D4]"} flex items-center justify-center`,children:o==="email"&&m.jsx("div",{className:"w-3 h-3 rounded-full bg-[#0073EA]"})})})]}),m.jsxs("button",{onClick:()=>i("phone"),className:`flex flex-1 h-[70px] px-4 py-3 items-center gap-3 rounded-lg border ${o==="phone"?"border-[#0073EA] bg-[#F0F7FF]":"border-[#D0D4E4] bg-white"}`,children:[m.jsx("div",{className:"flex w-10 h-10 p-2 justify-center items-center rounded-lg bg-[#EC4899]",children:m.jsx("svg",{className:"w-6 h-6",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M8.38028 8.85335C9.07627 10.303 10.0251 11.6616 11.2266 12.8632C12.4282 14.0648 13.7869 15.0136 15.2365 15.7096C15.3612 15.7694 15.4235 15.7994 15.5024 15.8224C15.7828 15.9041 16.127 15.8454 16.3644 15.6754C16.4313 15.6275 16.4884 15.5704 16.6027 15.4561C16.9523 15.1064 17.1271 14.9316 17.3029 14.8174C17.9658 14.3864 18.8204 14.3864 19.4833 14.8174C19.6591 14.9316 19.8339 15.1064 20.1835 15.4561L20.3783 15.6509C20.9098 16.1824 21.1755 16.4481 21.3198 16.7335C21.6069 17.301 21.6069 17.9713 21.3198 18.5389C21.1755 18.8242 20.9098 19.09 20.3783 19.6214L20.2207 19.779C19.6911 20.3087 19.4263 20.5735 19.0662 20.7757C18.6667 21.0001 18.0462 21.1615 17.588 21.1601C17.1751 21.1589 16.8928 21.0788 16.3284 20.9186C13.295 20.0576 10.4326 18.4332 8.04466 16.0452C5.65668 13.6572 4.03221 10.7948 3.17124 7.76144C3.01103 7.19699 2.93092 6.91477 2.9297 6.50182C2.92833 6.04364 3.08969 5.42313 3.31411 5.0236C3.51636 4.66357 3.78117 4.39876 4.3108 3.86913L4.46843 3.7115C4.99987 3.18006 5.2656 2.91433 5.55098 2.76999C6.11854 2.48292 6.7888 2.48292 7.35636 2.76999C7.64174 2.91433 7.90747 3.18006 8.43891 3.7115L8.63378 3.90637C8.98338 4.25597 9.15819 4.43078 9.27247 4.60655C9.70347 5.26945 9.70347 6.12403 9.27247 6.78692C9.15819 6.96269 8.98338 7.1375 8.63378 7.4871C8.51947 7.60142 8.46231 7.65857 8.41447 7.72538C8.24446 7.96281 8.18576 8.30707 8.26748 8.58743C8.29048 8.66632 8.32041 8.72866 8.38028 8.85335Z",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),m.jsx("div",{className:"flex flex-col items-start gap-0.5 flex-1",children:m.jsx("span",{className:"text-[#172B4D] font-roboto text-sm font-semibold leading-5",children:"Phone-based Verification"})}),m.jsx("div",{className:"flex w-5 h-5 justify-center items-center",children:m.jsx("div",{className:`w-5 h-5 rounded-full border-2 ${o==="phone"?"border-[#0073EA]":"border-[#C3C6D4]"} flex items-center justify-center`,children:o==="phone"&&m.jsx("div",{className:"w-3 h-3 rounded-full bg-[#0073EA]"})})})]})]}),o==="email"&&m.jsxs("div",{className:"flex flex-col items-start gap-2 self-stretch",children:[m.jsx("label",{className:"text-[#172B4D] font-roboto text-[13px] font-semibold leading-5",children:"Email Address"}),m.jsx("input",{type:"email",value:a,onChange:P=>l(P.target.value),placeholder:"opindersingh@email.com",className:"flex h-9 px-3 py-2 items-center gap-2 self-stretch rounded border border-[#C3C6D4] bg-white text-[#505258] font-roboto text-[13px] font-normal leading-5 outline-none focus:border-[#0073EA]"})]}),o==="phone"&&m.jsxs("div",{className:"flex flex-col items-start gap-2 self-stretch",children:[m.jsx("label",{className:"text-[#172B4D] font-roboto text-[13px] font-semibold leading-5",children:"Phone Number"}),m.jsxs("div",{className:"flex gap-2 self-stretch",children:[m.jsx("input",{type:"text",value:c,onChange:P=>u(P.target.value),placeholder:"+1",className:"flex w-16 h-9 px-3 py-2 items-center gap-2 rounded border border-[#C3C6D4] bg-white text-[#505258] font-roboto text-[13px] font-normal leading-5 outline-none focus:border-[#0073EA]"}),m.jsx("input",{type:"tel",value:d,onChange:P=>f(P.target.value),placeholder:"Phone number",className:"flex flex-1 h-9 px-3 py-2 items-center gap-2 rounded border border-[#C3C6D4] bg-white text-[#505258] font-roboto text-[13px] font-normal leading-5 outline-none focus:border-[#0073EA]"})]})]})]}):m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"flex flex-col items-start gap-2 self-stretch",children:[m.jsx("h3",{className:"text-[#172B4D] font-roboto text-base font-semibold leading-6",children:"Enter Verification Code"}),m.jsx("p",{className:"text-[#505258] font-roboto text-[13px] font-normal leading-5",children:o==="email"?`We sent a verification code to ${a}`:`We sent a verification code to ${c} ${d}`})]}),m.jsxs("div",{className:"flex flex-col items-start gap-2 self-stretch",children:[m.jsx("label",{className:"text-[#172B4D] font-roboto text-[13px] font-semibold leading-5",children:"Verification Code"}),m.jsx("input",{type:"text",value:p,onChange:P=>x(P.target.value),placeholder:"Enter 6-digit code",maxLength:6,className:"flex h-9 px-3 py-2 items-center gap-2 self-stretch rounded border border-[#C3C6D4] bg-white text-[#505258] font-roboto text-[13px] font-normal leading-5 outline-none focus:border-[#0073EA]"})]}),m.jsx("button",{onClick:F,disabled:b,className:"text-[#0073EA] font-roboto text-[13px] font-medium leading-5 hover:underline",children:"Resend verification code"})]})]}),m.jsxs("div",{className:"flex h-[60px] px-5 justify-end items-center gap-2 border-t border-[#D0D4E4] bg-white",children:[r==="verify-otp"&&m.jsx("button",{onClick:A,disabled:b,className:"flex h-[38px] px-4 py-2.25 justify-center items-center gap-1 rounded bg-white hover:bg-gray-50 disabled:opacity-50",children:m.jsx("span",{className:"text-[#505258] font-roboto text-[13px] font-medium leading-normal",children:"Back"})}),m.jsx("button",{onClick:D,disabled:b,className:"flex h-[38px] px-4 py-2.25 justify-center items-center gap-1 rounded bg-white hover:bg-gray-50 disabled:opacity-50",children:m.jsx("span",{className:"text-[#505258] font-roboto text-[13px] font-medium leading-normal",children:"Cancel"})}),m.jsx("button",{onClick:r==="select-method"?F:R,disabled:b||r==="select-method"&&(o==="email"&&!a||o==="phone"&&!d)||r==="verify-otp"&&!p,className:"flex h-[38px] px-4 py-2.25 justify-center items-center gap-0.5 rounded border border-[#0073EA] bg-[#0073EA] hover:bg-[#0062C6] disabled:opacity-50 disabled:cursor-not-allowed",children:b?m.jsxs("svg",{className:"animate-spin h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[m.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),m.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):m.jsx("span",{className:"text-white font-roboto text-[13px] font-medium leading-normal",children:r==="select-method"?"Send Verification Code":"Verify & Enable MFA"})})]})]})})}function E9e(){const n=si(),[e,t]=_.useState(""),[r,s]=_.useState(!1),[o,i]=_.useState(""),[a,l]=_.useState(""),[c,u]=_.useState(""),[d,f]=_.useState(!1),[p,x]=_.useState(!1),[v,y]=_.useState(!1),[b,w]=_.useState(!1),S=[{id:"home",label:"Home",icon:N=>m.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M10.8186 2.30492C10.5258 2.07721 10.3794 1.96335 10.2178 1.91959C10.0752 1.88097 9.92484 1.88097 9.78221 1.91959C9.62057 1.96335 9.47418 2.07721 9.18141 2.30492L3.52949 6.70086C3.15168 6.99471 2.96278 7.14163 2.82669 7.32563C2.70614 7.48862 2.61633 7.67224 2.56169 7.86746C2.5 8.08785 2.5 8.32717 2.5 8.8058V14.8349C2.5 15.7683 2.5 16.235 2.68166 16.5916C2.84144 16.9052 3.09641 17.1601 3.41002 17.3199C3.76654 17.5016 4.23325 17.5016 5.16667 17.5016H6.83333C7.06669 17.5016 7.18337 17.5016 7.2725 17.4562C7.3509 17.4162 7.41464 17.3525 7.45459 17.2741C7.5 17.1849 7.5 17.0683 7.5 16.8349V11.3349C7.5 10.8682 7.5 10.6348 7.59083 10.4566C7.67072 10.2998 7.79821 10.1723 7.95501 10.0924C8.13327 10.0016 8.36662 10.0016 8.83333 10.0016H11.1667C11.6334 10.0016 11.8667 10.0016 12.045 10.0924C12.2018 10.1723 12.3293 10.2998 12.4092 10.4566C12.5 10.6348 12.5 10.8682 12.5 11.3349V16.8349C12.5 17.0683 12.5 17.1849 12.5454 17.2741C12.5854 17.3525 12.6491 17.4162 12.7275 17.4562C12.8166 17.5016 12.9333 17.5016 13.1667 17.5016H14.8333C15.7668 17.5016 16.2335 17.5016 16.59 17.3199C16.9036 17.1601 17.1586 16.9052 17.3183 16.5916C17.5 16.235 17.5 15.7683 17.5 14.8349V8.8058C17.5 8.32717 17.5 8.08785 17.4383 7.86746C17.3837 7.67224 17.2939 7.48862 17.1733 7.32563C17.0372 7.14163 16.8483 6.99471 16.4705 6.70086L10.8186 2.30492Z",stroke:N?"#0073EA":"#676879",strokeWidth:"1.36364",strokeLinecap:"round",strokeLinejoin:"round"})}),onClick:()=>n("/dashboard")},{id:"ongoing",label:"Ongoing Verification",icon:N=>m.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M18.9167 9.58333L17.2504 11.25L15.5833 9.58333M17.4543 10.8333C17.4845 10.5597 17.5 10.2817 17.5 10C17.5 5.85787 14.1422 2.5 10 2.5C5.85787 2.5 2.5 5.85787 2.5 10C2.5 14.1422 5.85787 17.5 10 17.5C12.3561 17.5 14.4583 16.4136 15.8333 14.7144M10 5.83333V10L12.5 11.6667",stroke:N?"#0073EA":"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),onClick:()=>n("/ongoing-verification")},{id:"expired",label:"Expired Verification",icon:N=>m.jsxs("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("g",{clipPath:"url(#clip0_11004_6928)",children:m.jsx("path",{d:"M12.5052 7.50521L7.50521 12.5052M7.50521 7.50521L12.5052 12.5052M18.3385 10.0052C18.3385 14.6075 14.6075 18.3385 10.0052 18.3385C5.40283 18.3385 1.67188 14.6075 1.67188 10.0052C1.67188 5.40283 5.40283 1.67188 10.0052 1.67188C14.6075 1.67188 18.3385 5.40283 18.3385 10.0052Z",stroke:N?"#0073EA":"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),m.jsx("defs",{children:m.jsx("clipPath",{id:"clip0_11004_6928",children:m.jsx("rect",{width:"20",height:"20",fill:"white"})})})]}),onClick:()=>n("/expired-verification")},{id:"verified",label:"Verified Credentials",icon:N=>m.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M7.5 9.16667L10 11.6667L18.3333 3.33333M13.3333 2.5H6.5C5.09987 2.5 4.3998 2.5 3.86503 2.77248C3.39462 3.01217 3.01217 3.39462 2.77248 3.86503C2.5 4.3998 2.5 5.09987 2.5 6.5V13.5C2.5 14.9002 2.5 15.6002 2.77248 16.135C3.01217 16.6054 3.39462 16.9878 3.86503 17.2275C4.3998 17.5 5.09987 17.5 6.5 17.5H13.5C14.9002 17.5 15.6002 17.5 16.135 17.2275C16.6054 16.9878 16.9878 16.6054 17.2275 16.135C17.5 15.6002 17.5 14.9002 17.5 13.5V10",stroke:N?"#0073EA":"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),onClick:()=>n("/verified-credentials")},{id:"contact",label:"Contact Admin",icon:N=>m.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M16.6693 17.5C16.6693 16.337 16.6693 15.7556 16.5258 15.2824C16.2026 14.2171 15.3689 13.3833 14.3035 13.0602C13.8304 12.9167 13.2489 12.9167 12.0859 12.9167H7.91927C6.7563 12.9167 6.17481 12.9167 5.70165 13.0602C4.63631 13.3833 3.80264 14.2171 3.47947 15.2824C3.33594 15.7556 3.33594 16.337 3.33594 17.5M13.7526 6.25C13.7526 8.32107 12.0737 10 10.0026 10C7.93154 10 6.2526 8.32107 6.2526 6.25C6.2526 4.17893 7.93154 2.5 10.0026 2.5C12.0737 2.5 13.7526 4.17893 13.7526 6.25Z",stroke:N?"#0073EA":"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),onClick:()=>n("/contact-admin")}],k=[{device:"Chrome on Windows",ipAddress:"192.168.1.105",logInTime:"2025-08-24 @ 5:45 PM",lastActivity:"Just Now",status:"This Device",isCurrentDevice:!0},{device:"Chrome on Android",ipAddress:"192.168.1.87",logInTime:"2025-08-21 @ 9:12 AM",lastActivity:"15 Hours Ago",status:"Active",isCurrentDevice:!1},{device:"Firefox on MacOS",ipAddress:"10.0.0.42",logInTime:"2025-08-19 @ 11:30 PM",lastActivity:"1 Day Ago",status:"Active",isCurrentDevice:!1},{device:"Safari on iPhone",ipAddress:"192.168.1.92",logInTime:"2025-08-15 @ 2:05 PM",lastActivity:"3 Days Ago",status:"Active",isCurrentDevice:!1}];return m.jsxs("div",{className:"flex flex-col w-full h-screen bg-white",children:[m.jsxs("div",{className:"flex w-full h-11 px-3 lg:px-4 justify-between items-center border-b border-[#DEDEDD] bg-white",children:[m.jsx("img",{src:"https://api.builder.io/api/v1/image/assets/TEMP/4566b1e4f2b69299156b1f1c61472e06e0ad9666?width=180",alt:"Logo",className:"w-[90px] h-7 object-contain"}),m.jsx("div",{className:"flex items-center gap-2",children:m.jsx("button",{onClick:()=>n("/profile"),className:"flex w-8 h-8 p-2 justify-center items-center gap-2 rounded-full bg-[#F65F7C]",children:m.jsx("span",{className:"text-white font-roboto text-xs font-medium leading-[10px]",children:"OS"})})})]}),m.jsxs("div",{className:"flex h-full bg-white overflow-hidden",children:[m.jsx("div",{className:"flex w-[248px] px-2 py-2 flex-col items-start gap-1 border-r border-[#D0D4E4] bg-white overflow-y-auto",children:S.map(N=>{const I=e===N.id;return m.jsxs("button",{onClick:()=>{t(N.id),N.onClick?.()},className:`flex h-[38px] items-center gap-2 self-stretch rounded ${I?"bg-[#E6F1FD] pl-1 pr-2.25":"pl-3 pr-2.25"}`,children:[I&&m.jsx("svg",{className:"w-0.5 h-[28.5px]",width:"2",height:"31",viewBox:"0 0 2 31",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M1 1V29.5",stroke:"#0073EA",strokeWidth:"2",strokeLinecap:"round"})}),N.icon(I),m.jsx("span",{className:`font-roboto text-[13px] font-medium leading-normal ${I?"text-[#172B4D]":"text-[#505258]"}`,children:N.label})]},N.id)})}),m.jsxs("div",{className:"flex flex-1 flex-col items-start bg-white overflow-y-auto",children:[m.jsx("div",{className:"flex w-full h-14 flex-col items-start border-b border-[#DEDEDD]",children:m.jsx("div",{className:"flex h-14 flex-col items-start self-stretch",children:m.jsx("div",{className:"flex px-4 py-2 items-center gap-2 flex-1 self-stretch",children:m.jsx("div",{className:"flex items-start gap-2",children:m.jsx("h1",{className:"text-[#172B4D] font-roboto text-xl font-bold leading-[30px]",children:"Profile"})})})})}),m.jsxs("div",{className:"flex flex-col items-start gap-2 self-stretch p-4",children:[m.jsxs("div",{className:"flex flex-col items-start gap-2 self-stretch rounded border border-[#DEDEDD]",children:[m.jsx("div",{className:"flex px-4 py-3 items-center gap-2.5 self-stretch",children:m.jsx("h2",{className:"text-[#172B4D] font-roboto text-base font-bold leading-6",children:"User Information"})}),m.jsx("div",{className:"w-full h-px bg-[#DEDEDD]"}),m.jsx("div",{className:"flex px-4 py-3 items-start gap-2.5 self-stretch",children:m.jsx("p",{className:"text-[#505258] font-roboto text-[13px] font-normal leading-5",children:"Fetched from Lorem Ipsum"})}),m.jsx("div",{className:"w-full h-px bg-[#DEDEDD]"}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 px-4 py-3 w-full",children:[m.jsxs("div",{className:"flex flex-col gap-1",children:[m.jsx("label",{className:"text-[#172B4D] font-roboto text-[13px] font-bold leading-5",children:"Full Name"}),m.jsx("div",{className:"text-[#505258] font-roboto text-[13px] font-normal leading-5",children:"Opinder Singh"})]}),m.jsxs("div",{className:"flex flex-col gap-1",children:[m.jsx("label",{className:"text-[#172B4D] font-roboto text-[13px] font-bold leading-5",children:"Employee ID"}),m.jsx("div",{className:"text-[#505258] font-roboto text-[13px] font-normal leading-5",children:"EMP-2345"})]}),m.jsxs("div",{className:"flex flex-col gap-1",children:[m.jsx("label",{className:"text-[#172B4D] font-roboto text-[13px] font-bold leading-5",children:"Email Address"}),m.jsx("div",{className:"text-[#505258] font-roboto text-[13px] font-normal leading-5",children:"Opinder.singh@company.com"})]}),m.jsxs("div",{className:"flex flex-col gap-1",children:[m.jsx("label",{className:"text-[#172B4D] font-roboto text-[13px] font-bold leading-5",children:"Department / Role"}),m.jsx("div",{className:"text-[#505258] font-roboto text-[13px] font-normal leading-5",children:"Information Technology - Senior Software Engineer"})]})]})]}),m.jsx("div",{className:"flex h-16 flex-col justify-center items-start gap-2 self-stretch rounded border border-[#DEDEDD]",children:m.jsxs("div",{className:"flex px-4 py-3 justify-between items-center self-stretch",children:[m.jsxs("div",{className:"flex flex-col items-start gap-1",children:[m.jsx("h2",{className:"text-[#172B4D] font-roboto text-base font-bold leading-6",children:"Change Password"}),m.jsx("p",{className:"text-[#505258] font-roboto text-[13px] font-normal leading-5",children:"Update your password to keep your account secure"})]}),m.jsx("button",{onClick:()=>s(!0),className:"flex h-8 px-3 py-2 justify-center items-center gap-2 rounded bg-[#0073EA]",children:m.jsx("span",{className:"text-white font-roboto text-[13px] font-medium leading-4",children:"Change Password"})})]})}),m.jsx("div",{className:"flex h-16 flex-col justify-center items-start gap-2 self-stretch rounded border border-[#DEDEDD]",children:m.jsxs("div",{className:"flex px-4 py-3 justify-between items-center self-stretch",children:[m.jsxs("div",{className:"flex flex-col items-start gap-1",children:[m.jsx("h2",{className:"text-[#172B4D] font-roboto text-base font-bold leading-6",children:"MFA Configuration"}),m.jsx("p",{className:"text-[#505258] font-roboto text-[13px] font-normal leading-5",children:"Multi-factor authentication adds an extra layer of security to your account"})]}),m.jsx("button",{onClick:()=>w(!0),className:"flex h-8 px-3 py-2 justify-center items-center gap-2 rounded bg-[#0073EA]",children:m.jsx("span",{className:"text-white font-roboto text-[13px] font-medium leading-4",children:"Enable MFA"})})]})}),m.jsxs("div",{className:"flex flex-col justify-center items-start gap-2 self-stretch rounded border border-[#DEDEDD]",children:[m.jsxs("div",{className:"flex px-4 py-3 items-start gap-2.5 self-stretch",children:[m.jsxs("div",{className:"flex flex-col items-start gap-1 flex-1",children:[m.jsx("h2",{className:"text-[#172B4D] font-roboto text-base font-bold leading-6",children:"Session & Security"}),m.jsx("p",{className:"text-[#505258] font-roboto text-[13px] font-normal leading-5",children:"Multi-factor authentication adds an extra layer of security to your account"})]}),m.jsxs("button",{className:"flex h-8 px-3 py-2 justify-center items-center gap-2 rounded",children:[m.jsx("svg",{className:"w-4 h-4",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M10.6693 7.33464L13.3359 7.33464M13.3359 7.33464L16.0026 7.33464M13.3359 7.33464L13.3359 4.66797M13.3359 7.33464L13.3359 10.0013M5.33594 14.668L5.33594 13.3346C5.33594 12.5992 5.33594 12.2315 5.21046 11.9499C5.09888 11.7016 4.92011 11.4896 4.69464 11.3366C4.43905 11.1634 4.10225 11.1086 3.42865 11.0013C2.31094 10.8301 1.33594 9.8551 1.33594 8.66797C1.33594 7.38126 2.38294 6.33464 3.66927 6.33464C5.18927 6.33464 5.33594 5.46797 5.33594 4.66797L5.33594 1.33464M5.33594 1.33464L2.66927 1.33464M5.33594 1.33464L8.0026 1.33464",stroke:"#0073EA",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),m.jsx("span",{className:"text-[#0073EA] font-roboto text-[13px] font-medium leading-4",children:"Refresh"})]})]}),m.jsx("div",{className:"w-full h-px bg-[#DEDEDD]"}),m.jsx("div",{className:"flex px-4 py-2 items-start gap-2.5 self-stretch",children:m.jsx("h3",{className:"text-[#172B4D] font-roboto text-sm font-semibold leading-5",children:"Active Sessions"})}),m.jsx("div",{className:"flex px-4 items-start gap-2.5 self-stretch",children:m.jsx("p",{className:"text-[#505258] font-roboto text-xs font-normal leading-[18px]",children:"Let users upload existing documents directly from their device."})}),m.jsx("div",{className:"overflow-x-auto w-full",children:m.jsxs("table",{className:"w-full",children:[m.jsx("thead",{className:"bg-[#F7F8F9]",children:m.jsxs("tr",{children:[m.jsx("th",{className:"px-4 py-2 text-left",children:m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded border-[#DEDEDD]"}),m.jsx("span",{className:"text-[#172B4D] font-roboto text-xs font-semibold leading-[18px]",children:"Device"})]})}),m.jsx("th",{className:"px-4 py-2 text-left",children:m.jsx("span",{className:"text-[#172B4D] font-roboto text-xs font-semibold leading-[18px]",children:"IP Address"})}),m.jsx("th",{className:"px-4 py-2 text-left",children:m.jsx("span",{className:"text-[#172B4D] font-roboto text-xs font-semibold leading-[18px]",children:"Log In Time"})}),m.jsx("th",{className:"px-4 py-2 text-left",children:m.jsx("span",{className:"text-[#172B4D] font-roboto text-xs font-semibold leading-[18px]",children:"Last Activity"})}),m.jsx("th",{className:"px-4 py-2 text-left",children:m.jsx("span",{className:"text-[#172B4D] font-roboto text-xs font-semibold leading-[18px]",children:"Status"})})]})}),m.jsx("tbody",{children:k.map((N,I)=>m.jsxs("tr",{className:"border-t border-[#DEDEDD]",children:[m.jsx("td",{className:"px-4 py-3",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded border-[#DEDEDD]"}),m.jsx("span",{className:"text-[#505258] font-roboto text-xs font-normal leading-[18px]",children:N.device})]})}),m.jsx("td",{className:"px-4 py-3",children:m.jsx("span",{className:"text-[#505258] font-roboto text-xs font-normal leading-[18px]",children:N.ipAddress})}),m.jsx("td",{className:"px-4 py-3",children:m.jsx("span",{className:"text-[#505258] font-roboto text-xs font-normal leading-[18px]",children:N.logInTime})}),m.jsx("td",{className:"px-4 py-3",children:m.jsx("span",{className:"text-[#505258] font-roboto text-xs font-normal leading-[18px]",children:N.lastActivity})}),m.jsx("td",{className:"px-4 py-3",children:m.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full ${N.isCurrentDevice?"bg-[#E6F4EA] text-[#1E7E34]":"bg-[#E6F1FD] text-[#0073EA]"}`,children:[m.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${N.isCurrentDevice?"bg-[#1E7E34]":"bg-[#0073EA]"}`}),m.jsx("span",{className:"font-roboto text-xs font-medium leading-[18px]",children:N.status})]})})]},I))})]})}),m.jsx("div",{className:"flex px-4 py-3 items-start gap-2.5 self-stretch",children:m.jsx("button",{className:"flex h-8 px-3 py-2 justify-center items-center gap-2 rounded bg-[#D83A52]",children:m.jsx("span",{className:"text-white font-roboto text-[13px] font-medium leading-4",children:"Logout from All Sessions"})})})]})]})]})]}),m.jsx(Zg,{open:r,onOpenChange:s,children:m.jsxs(Hp,{className:"max-w-[420px] p-0 gap-0 rounded-lg overflow-hidden",children:[m.jsxs("div",{className:"flex h-[52px] px-5 py-2.5 justify-between items-center border-b border-[#D0D4E4] bg-white",children:[m.jsx(Gp,{className:"text-[#172B4D] font-roboto text-lg font-bold leading-[26px]",children:"Change Password"}),m.jsx(ZA,{className:"flex w-7 h-7 p-2 flex-col justify-center items-center rounded-full bg-white hover:bg-gray-100",children:m.jsx("svg",{className:"w-4 h-4",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M12 4L4 12M4 4L12 12",stroke:"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),m.jsx("div",{className:"flex px-5 py-5 flex-col items-start bg-white",children:m.jsxs("div",{className:"flex flex-col items-start self-stretch gap-0",children:[m.jsxs("div",{className:"flex flex-col items-start self-stretch",children:[m.jsx("label",{className:"flex pb-2 items-start gap-2 self-stretch",children:m.jsx("span",{className:"flex h-2.5 flex-col justify-center flex-1 text-[#172B4D] font-roboto text-[13px] font-medium leading-normal",children:"Current Password"})}),m.jsxs("div",{className:"flex h-8 px-2.5 py-[15px] justify-between items-center self-stretch rounded border border-[#C3C6D4] bg-white",children:[m.jsx("input",{type:d?"text":"password",value:o,onChange:N=>i(N.target.value),placeholder:"Enter Password",className:"flex-1 text-[#676879] font-roboto text-xs font-normal leading-[22px] outline-none bg-transparent"}),m.jsx("button",{type:"button",onClick:()=>f(!d),className:"flex justify-end items-center",children:m.jsxs("svg",{className:"w-4 h-4",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("path",{d:"M1.61341 8.47807C1.52263 8.33427 1.47723 8.2624 1.45181 8.15154C1.43273 8.06827 1.43273 7.93694 1.45181 7.85367C1.47723 7.7428 1.52263 7.67094 1.61341 7.52714C2.36369 6.33916 4.59694 3.33594 8.00027 3.33594C11.4036 3.33594 13.6369 6.33916 14.3871 7.52714C14.4779 7.67094 14.5233 7.7428 14.5487 7.85367C14.5678 7.93694 14.5678 8.06827 14.5487 8.15154C14.5233 8.2624 14.4779 8.33427 14.3871 8.47807C13.6369 9.66607 11.4036 12.6693 8.00027 12.6693C4.59694 12.6693 2.36369 9.66607 1.61341 8.47807Z",stroke:"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),m.jsx("path",{d:"M8 10C9.1046 10 10 9.1046 10 8C10 6.8954 9.1046 6 8 6C6.8954 6 6 6.8954 6 8C6 9.1046 6.8954 10 8 10Z",stroke:"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]})})]})]}),m.jsxs("div",{className:"flex flex-col items-start self-stretch",children:[m.jsx("label",{className:"flex pb-2 items-start gap-2 self-stretch",children:m.jsx("span",{className:"flex h-2.5 flex-col justify-center flex-1 text-[#172B4D] font-roboto text-[13px] font-medium leading-normal",children:"New Password"})}),m.jsxs("div",{className:"flex h-8 px-2.5 py-[15px] justify-between items-center self-stretch rounded border border-[#C3C6D4] bg-white",children:[m.jsx("input",{type:p?"text":"password",value:a,onChange:N=>l(N.target.value),placeholder:"Enter Password",className:"flex-1 text-[#676879] font-roboto text-xs font-normal leading-[22px] outline-none bg-transparent"}),m.jsx("button",{type:"button",onClick:()=>x(!p),className:"flex justify-end items-center",children:m.jsxs("svg",{className:"w-4 h-4",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("path",{d:"M1.61341 8.47807C1.52263 8.33427 1.47723 8.2624 1.45181 8.15154C1.43273 8.06827 1.43273 7.93694 1.45181 7.85367C1.47723 7.7428 1.52263 7.67094 1.61341 7.52714C2.36369 6.33916 4.59694 3.33594 8.00027 3.33594C11.4036 3.33594 13.6369 6.33916 14.3871 7.52714C14.4779 7.67094 14.5233 7.7428 14.5487 7.85367C14.5678 7.93694 14.5678 8.06827 14.5487 8.15154C14.5233 8.2624 14.4779 8.33427 14.3871 8.47807C13.6369 9.66607 11.4036 12.6693 8.00027 12.6693C4.59694 12.6693 2.36369 9.66607 1.61341 8.47807Z",stroke:"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),m.jsx("path",{d:"M8 10C9.1046 10 10 9.1046 10 8C10 6.8954 9.1046 6 8 6C6.8954 6 6 6.8954 6 8C6 9.1046 6.8954 10 8 10Z",stroke:"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]})})]})]}),m.jsxs("div",{className:"flex flex-col items-start self-stretch",children:[m.jsx("label",{className:"flex pb-2 items-start gap-2 self-stretch",children:m.jsx("span",{className:"flex h-2.5 flex-col justify-center flex-1 text-[#172B4D] font-roboto text-[13px] font-medium leading-normal",children:"Confirm New Password"})}),m.jsxs("div",{className:"flex h-8 px-2.5 py-[15px] justify-between items-center self-stretch rounded border border-[#C3C6D4] bg-white",children:[m.jsx("input",{type:v?"text":"password",value:c,onChange:N=>u(N.target.value),placeholder:"Enter Password",className:"flex-1 text-[#676879] font-roboto text-xs font-normal leading-[22px] outline-none bg-transparent"}),m.jsx("button",{type:"button",onClick:()=>y(!v),className:"flex justify-end items-center",children:m.jsxs("svg",{className:"w-4 h-4",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("path",{d:"M1.61341 8.47807C1.52263 8.33427 1.47723 8.2624 1.45181 8.15154C1.43273 8.06827 1.43273 7.93694 1.45181 7.85367C1.47723 7.7428 1.52263 7.67094 1.61341 7.52714C2.36369 6.33916 4.59694 3.33594 8.00027 3.33594C11.4036 3.33594 13.6369 6.33916 14.3871 7.52714C14.4779 7.67094 14.5233 7.7428 14.5487 7.85367C14.5678 7.93694 14.5678 8.06827 14.5487 8.15154C14.5233 8.2624 14.4779 8.33427 14.3871 8.47807C13.6369 9.66607 11.4036 12.6693 8.00027 12.6693C4.59694 12.6693 2.36369 9.66607 1.61341 8.47807Z",stroke:"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),m.jsx("path",{d:"M8 10C9.1046 10 10 9.1046 10 8C10 6.8954 9.1046 6 8 6C6.8954 6 6 6.8954 6 8C6 9.1046 6.8954 10 8 10Z",stroke:"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]})})]})]})]})}),m.jsxs("div",{className:"flex h-[60px] px-5 justify-end items-center gap-2 border-t border-[#D0D4E4] bg-white",children:[m.jsx("button",{onClick:()=>{s(!1),i(""),l(""),u("")},className:"flex h-[38px] px-4 py-2.25 justify-center items-center gap-1 rounded bg-white",children:m.jsx("span",{className:"text-[#505258] font-roboto text-[13px] font-medium leading-normal",children:"Cancel"})}),m.jsx("button",{onClick:()=>{console.log("Update password logic here"),s(!1)},className:"flex h-[38px] px-4 py-2.25 justify-center items-center gap-0.5 rounded border border-[#0073EA] bg-[#0073EA]",children:m.jsx("span",{className:"text-white font-roboto text-[13px] font-medium leading-normal",children:"Update Password"})})]})]})}),m.jsx(N9e,{isOpen:b,onClose:()=>w(!1),userEmail:"Opinder.singh@company.com"})]})}const _v={minLength:8,uppercase:/[A-Z]/,number:/[0-9]/,specialChar:/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/};function Hz(n){const e={minLength:n.length>=_v.minLength,hasUppercase:_v.uppercase.test(n),hasNumber:_v.number.test(n),hasSpecialChar:_v.specialChar.test(n)},t=Object.values(e).filter(Boolean).length;let r=0,s="Weak",o="bg-red-500";return t===0?(r=0,s="Weak",o="bg-red-500"):t===1?(r=1,s="Weak",o="bg-red-500"):t===2?(r=2,s="Fair",o="bg-yellow-500"):t===3?(r=3,s="Good",o="bg-blue-500"):(r=4,s="Strong",o="bg-green-500"),{score:r,label:s,color:o,requirements:e}}function I9e(n){const e=Hz(n);return e.requirements.minLength&&e.requirements.hasUppercase&&e.requirements.hasNumber&&e.requirements.hasSpecialChar}function T9e(n,e){return n===e&&n.length>0}function _9e({strength:n,onDismiss:e}){return m.jsxs("div",{className:"flex flex-col items-start gap-2 p-2 rounded bg-[#F6F7FB] cursor-pointer transition-opacity hover:opacity-90",onClick:e,role:"button",tabIndex:0,onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),e?.())},"aria-label":"Password requirements (click to dismiss)",children:[m.jsx("p",{className:"text-xs font-medium text-[#323238] leading-normal",children:"Password must contain:"}),m.jsxs("div",{className:"flex flex-col items-start gap-1",children:[m.jsxs("div",{className:"flex items-center gap-1",children:[n.requirements.minLength?m.jsx("svg",{className:"w-5 h-5 flex-shrink-0",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M5.5 10L8.5 13L14.5 7",stroke:"#676879",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})}):m.jsx("svg",{className:"w-5 h-5 flex-shrink-0",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M14.1693 5.83594L5.83594 14.1693M5.83594 5.83594L14.1693 14.1693",stroke:"#676879",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})}),m.jsx("span",{className:"text-xs font-normal leading-5 text-[#676879]",children:"At least 8 characters"})]}),m.jsxs("div",{className:"flex items-center gap-1",children:[n.requirements.hasUppercase?m.jsx("svg",{className:"w-5 h-5 flex-shrink-0",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M5.5 10L8.5 13L14.5 7",stroke:"#676879",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})}):m.jsx("svg",{className:"w-5 h-5 flex-shrink-0",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M14.1693 5.83594L5.83594 14.1693M5.83594 5.83594L14.1693 14.1693",stroke:"#676879",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})}),m.jsx("span",{className:"text-xs font-normal leading-5 text-[#676879]",children:"One uppercase letter"})]}),m.jsxs("div",{className:"flex items-center gap-1",children:[n.requirements.hasNumber?m.jsx("svg",{className:"w-5 h-5 flex-shrink-0",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M5.5 10L8.5 13L14.5 7",stroke:"#676879",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})}):m.jsx("svg",{className:"w-5 h-5 flex-shrink-0",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M14.1693 5.83594L5.83594 14.1693M5.83594 5.83594L14.1693 14.1693",stroke:"#676879",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})}),m.jsx("span",{className:"text-xs font-normal leading-5 text-[#676879]",children:"One number"})]}),m.jsxs("div",{className:"flex items-center gap-1",children:[n.requirements.hasSpecialChar?m.jsx("svg",{className:"w-5 h-5 flex-shrink-0",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M5.5 10L8.5 13L14.5 7",stroke:"#676879",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})}):m.jsx("svg",{className:"w-5 h-5 flex-shrink-0",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M14.1693 5.83594L5.83594 14.1693M5.83594 5.83594L14.1693 14.1693",stroke:"#676879",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})}),m.jsx("span",{className:"text-xs font-normal leading-5 text-[#676879]",children:"One special character"})]})]})]})}function R9e(){const n=si(),{toast:e}=pd(),[t,r]=_.useState(""),[s,o]=_.useState(""),[i,a]=_.useState(!1),[l,c]=_.useState(!1),[u,d]=_.useState(!1),[f,p]=_.useState(!0),x=Hz(t),v=I9e(t),y=T9e(t,s),b=v&&y&&!i,w=async S=>{if(S.preventDefault(),!v){e({title:"Weak Password",description:"Password does not meet security requirements.",variant:"destructive"});return}if(!y){e({title:"Password Mismatch",description:"Passwords do not match.",variant:"destructive"});return}a(!0);try{await new Promise(k=>setTimeout(k,1500)),e({title:"Success",description:"Your password has been set successfully.",duration:3e3}),setTimeout(()=>{n("/dashboard")},1e3)}catch(k){console.error("Password setup error:",k),e({title:"Error",description:"Failed to set password. Please try again.",variant:"destructive"})}finally{a(!1)}};return m.jsxs("div",{className:"w-full h-screen bg-white flex overflow-hidden",children:[m.jsxs("div",{className:"hidden lg:flex lg:w-[607px] flex-col relative bg-white overflow-hidden flex-shrink-0 h-full",children:[m.jsxs("div",{className:"absolute inset-0",children:[m.jsxs("svg",{className:"absolute left-[190px] top-[214px] w-[279px] h-[123px] opacity-80",width:"404",height:"236",viewBox:"0 0 404 236",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsxs("g",{opacity:"0.8",children:[m.jsx("g",{filter:"url(#filter0_f_blob1)",children:m.jsx("ellipse",{cx:"250.058",cy:"117.553",rx:"85.3719",ry:"45.8769",transform:"rotate(-12.3921 250.058 117.553)",fill:"#F8E4E8",fillOpacity:"0.5"})}),m.jsx("g",{filter:"url(#filter1_f_blob1)",children:m.jsx("ellipse",{cx:"142.087",cy:"112.195",rx:"88.956",ry:"49.0935",transform:"rotate(-12.3921 142.087 112.195)",fill:"#E0EFFE",fillOpacity:"0.5"})})]}),m.jsxs("defs",{children:[m.jsxs("filter",{id:"filter0_f_blob1",x:"96.9561",y:"0",width:"306.205",height:"235.107",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[m.jsx("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),m.jsx("feBlend",{mode:"normal",in:"SourceGraphic",in2:"BackgroundImageFix",result:"shape"}),m.jsx("feGaussianBlur",{stdDeviation:"34.5659",result:"effect1_foregroundBlur_blob1"})]}),m.jsxs("filter",{id:"filter1_f_blob1",x:"0.000492096",y:"6.01343",width:"284.173",height:"212.364",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[m.jsx("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),m.jsx("feBlend",{mode:"normal",in:"SourceGraphic",in2:"BackgroundImageFix",result:"shape"}),m.jsx("feGaussianBlur",{stdDeviation:"27.2791",result:"effect1_foregroundBlur_blob1"})]})]})]}),m.jsxs("div",{className:"absolute left-[-96px] top-0 w-[677px] h-[643px]",children:[m.jsxs("svg",{className:"absolute left-[335px] top-[301px] w-[342px] h-[342px]",width:"802",height:"697",viewBox:"0 0 802 697",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("g",{filter:"url(#filter0_f_blob2)",children:m.jsx("circle",{cx:"401",cy:"401",r:"171",fill:"#BCD2E8"})}),m.jsx("defs",{children:m.jsxs("filter",{id:"filter0_f_blob2",x:"0",y:"0",width:"802",height:"802",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[m.jsx("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),m.jsx("feBlend",{mode:"normal",in:"SourceGraphic",in2:"BackgroundImageFix",result:"shape"}),m.jsx("feGaussianBlur",{stdDeviation:"115",result:"effect1_foregroundBlur_blob2"})]})})]}),m.jsxs("svg",{className:"absolute left-0 top-0 w-[465px] h-[397px]",width:"529",height:"557",viewBox:"0 0 529 557",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("g",{filter:"url(#filter0_f_blob3)",children:m.jsx("ellipse",{cx:"136.5",cy:"198.5",rx:"232.5",ry:"198.5",fill:"#E0EFFE"})}),m.jsx("defs",{children:m.jsxs("filter",{id:"filter0_f_blob3",x:"-256",y:"-160",width:"785",height:"717",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[m.jsx("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),m.jsx("feBlend",{mode:"normal",in:"SourceGraphic",in2:"BackgroundImageFix",result:"shape"}),m.jsx("feGaussianBlur",{stdDeviation:"80",result:"effect1_foregroundBlur_blob3"})]})})]})]})]}),m.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:m.jsxs("div",{className:"relative w-[252px] h-[318px]",children:[m.jsx("div",{className:"absolute w-[252px] h-[318px] rounded-3xl border border-black/10 bg-gradient-to-br from-[#E0EFFE] via-[#F3CFFF] to-[#F3CFFF]",style:{transform:"rotate(6.554deg)"}}),m.jsx("div",{className:"absolute w-[252px] h-[318px] rounded-3xl border border-black/10 bg-white backdrop-blur-[7.5px]"}),m.jsx("svg",{className:"absolute right-[-36px] top-4 w-6 h-6",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 1C5.92487 1 1 5.92487 1 12C1 18.0751 5.92487 23 12 23C18.0751 23 23 18.0751 23 12C23 5.92487 18.0751 1 12 1ZM17.2071 9.70711C17.5976 9.31658 17.5976 8.68342 17.2071 8.29289C16.8166 7.90237 16.1834 7.90237 15.7929 8.29289L10.5 13.5858L8.20711 11.2929C7.81658 10.9024 7.18342 10.9024 6.79289 11.2929C6.40237 11.6834 6.40237 12.3166 6.79289 12.7071L9.79289 15.7071C10.1834 16.0976 10.8166 16.0976 11.2071 15.7071L17.2071 9.70711Z",fill:"#258750"})}),m.jsx("div",{className:"absolute left-8 top-14 w-[185px] h-[130px] rounded-2xl bg-[#E0EFFE]"})]})}),m.jsx("div",{className:"absolute bottom-[130px] left-1/2 -translate-x-1/2 w-[461px]",children:m.jsxs("div",{className:"flex flex-col items-center gap-6",children:[m.jsx("h2",{className:"text-[#323238] text-center font-roboto text-[32px] font-bold leading-[120%]",children:"Secure your account."}),m.jsx("p",{className:"text-[#676879] text-center font-roboto text-[13px] font-medium leading-[20px]",children:"Create a strong password to protect your verified identity."})]})})]}),m.jsxs("div",{className:"flex-1 flex flex-col bg-white",children:[m.jsx("div",{className:"flex items-center justify-center h-14 gap-[33.246px] pt-[84px] pb-6",children:m.jsxs("svg",{className:"w-[124px] h-[25.176px]",width:"126",height:"27",viewBox:"0 0 126 27",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("path",{d:"M37.0043 10.1061C38.6231 8.32663 40.5827 7.43677 42.8831 7.43677C44.0759 7.43677 45.1729 7.73702 46.1739 8.33728C47.175 8.93766 47.9418 9.70947 48.4743 10.6528L48.7618 7.72625H52.8515V25.4143H48.7618L48.4743 22.4556C47.9418 23.3989 47.175 24.1708 46.1739 24.771C45.1729 25.3714 44.0759 25.6715 42.8831 25.6715C40.5827 25.6715 38.6231 24.7818 37.0043 23.0022C35.3855 21.2013 34.5762 19.0465 34.5762 16.5381C34.5762 14.0296 35.3855 11.8856 37.0043 10.1061ZM40.4548 19.8185C41.3495 20.7403 42.4358 21.2013 43.7138 21.2013C45.0131 21.2013 46.1101 20.7511 47.0045 19.8505C47.8992 18.9286 48.3465 17.8245 48.3465 16.5381C48.3465 15.2518 47.8992 14.1583 47.0045 13.2577C46.1101 12.3358 45.0131 11.8749 43.7138 11.8749C42.4358 11.8749 41.3495 12.3358 40.4548 13.2577C39.5603 14.1583 39.113 15.2518 39.113 16.5381C39.113 17.8245 39.5603 18.918 40.4548 19.8185ZM56.593 7.72625H60.6826L61.0021 10.2669C62.0458 8.48741 63.7818 7.59767 66.2099 7.59767C66.8277 7.59767 67.3601 7.64053 67.8074 7.72625L66.8808 12.0679C66.6252 12.025 66.4442 12.0035 66.3378 12.0035C64.8467 12.0035 63.6007 12.4645 62.5996 13.3865C61.5985 14.2868 61.098 15.8198 61.098 17.9852V25.4143H56.593V7.72625ZM72.1419 10.1383C73.8884 8.35871 76.0078 7.46897 78.4999 7.46897C79.9908 7.46897 81.386 7.82274 82.6853 8.53026C83.9846 9.21636 85.0603 10.1489 85.9122 11.3282L82.2061 13.8045C81.2902 12.6467 80.0548 12.0679 78.4999 12.0679C77.2645 12.0679 76.2101 12.5074 75.3368 13.3865C74.4636 14.2654 74.0269 15.3267 74.0269 16.5703C74.0269 17.8352 74.4636 18.9072 75.3368 19.7863C76.2101 20.6653 77.2645 21.1048 78.4999 21.1048C80.14 21.1048 81.3966 20.4616 82.27 19.1752L86.008 21.6836C85.1774 22.9058 84.1018 23.8813 82.7811 24.6102C81.4606 25.3392 80.0335 25.7037 78.4999 25.7037C76.0078 25.7037 73.8778 24.8139 72.1099 23.0344C70.3633 21.2335 69.49 19.0787 69.49 16.5703C69.49 14.0618 70.374 11.9178 72.1419 10.1383ZM90.5504 10.1383C92.2971 8.35871 94.4163 7.46897 96.9085 7.46897C99.4005 7.46897 101.531 8.36948 103.298 10.1704C105.088 11.95 105.982 14.0832 105.982 16.5703C105.982 19.0787 105.098 21.2227 103.33 23.0022C101.541 24.8032 99.4005 25.7037 96.9085 25.7037C94.4163 25.7037 92.2864 24.8139 90.5185 23.0344C88.7718 21.2335 87.8986 19.0787 87.8986 16.5703C87.8986 14.0618 88.7826 11.9178 90.5504 10.1383ZM92.4355 16.5703C92.4355 17.8352 92.8721 18.9072 93.7454 19.7863C94.6188 20.6653 95.673 21.1048 96.9085 21.1048C98.1652 21.1048 99.2301 20.6653 100.103 19.7863C100.977 18.9072 101.413 17.8352 101.413 16.5703C101.413 15.3267 100.977 14.2654 100.103 13.3865C99.2301 12.5074 98.1652 12.0679 96.9085 12.0679C95.673 12.0679 94.6188 12.5074 93.7454 13.3865C92.8721 14.2654 92.4355 15.3267 92.4355 16.5703ZM108.855 25.4143V7.72625H112.944L113.232 10.2991C113.743 9.44142 114.414 8.75533 115.245 8.24079C116.097 7.70482 117.055 7.43677 118.12 7.43677C120.25 7.43677 121.933 8.1765 123.168 9.65584C124.425 11.1352 125.053 13.3757 125.053 16.3773V25.4143H120.58V16.3773C120.58 14.898 120.229 13.7831 119.526 13.0327C118.844 12.2609 117.992 11.8749 116.97 11.8749C115.926 11.8749 115.064 12.2609 114.382 13.0327C113.7 13.7831 113.36 14.898 113.36 16.3773V25.4143H108.855Z",fill:"#323238"}),m.jsx("path",{d:"M26.425 21.7199C27.0492 22.8369 26.2417 24.213 24.9622 24.213H3.93975C2.65324 24.213 1.84661 22.8233 2.48474 21.7062L13.1115 3.10326C13.7582 1.97113 15.3932 1.97882 16.0293 3.11699L26.425 21.7199Z",stroke:"#D83A52",strokeWidth:"4.5177"})]})}),m.jsx("div",{className:"flex-1 overflow-auto flex items-center justify-center px-4 py-8",children:m.jsx("div",{className:"w-full max-w-[360px]",children:m.jsxs("form",{onSubmit:w,className:"flex flex-col gap-6",children:[m.jsxs("div",{className:"flex flex-col justify-center items-center gap-0",children:[m.jsx("h1",{className:"text-[#172B4D] text-center font-roboto text-[28px] font-extrabold leading-[42px]",children:"Set Your Password"}),m.jsx("p",{className:"text-[#676879] text-center font-roboto text-[14px] font-normal leading-[22px]",children:"Create a strong password to secure your account"})]}),m.jsxs("div",{className:"flex flex-col gap-2",children:[m.jsx("label",{htmlFor:"password",className:"text-[#323238] font-roboto text-[13px] font-medium leading-normal",children:"New Password"}),m.jsxs("div",{className:"relative",children:[m.jsx("input",{id:"password",type:l?"text":"password",value:t,onChange:S=>{r(S.target.value),p(!0)},className:"w-full h-[54px] px-3 py-[15px] border border-[#C3C6D4] rounded bg-white text-[#323238] font-roboto text-base leading-5 placeholder:text-[#676879] focus:outline-none focus:ring-2 focus:ring-[#0073EA] focus:border-transparent",placeholder:"Enter a strong password",disabled:i}),m.jsx("button",{type:"button",onClick:()=>c(!l),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700",disabled:i,children:l?m.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-4.803m5.596-3.856a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0m7.6 0a10.05 10.05 0 011.563 4.803m-5.596 3.856a4.872 4.872 0 005.049-7.52M3 12a9 9 0 1118 0 9 9 0 01-18 0z"})}):m.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),t&&f&&m.jsx(_9e,{strength:x,onDismiss:()=>p(!1)}),m.jsxs("div",{className:"flex flex-col gap-2",children:[m.jsx("label",{htmlFor:"confirmPassword",className:"text-[#323238] font-roboto text-[13px] font-medium leading-normal",children:"Confirm Password"}),m.jsxs("div",{className:"relative",children:[m.jsx("input",{id:"confirmPassword",type:u?"text":"password",value:s,onChange:S=>o(S.target.value),className:`w-full h-[54px] px-3 py-[15px] border rounded bg-white text-[#323238] font-roboto text-base leading-5 placeholder:text-[#676879] focus:outline-none focus:ring-2 focus:border-transparent ${s&&!y?"border-red-300 focus:ring-red-500":"border-[#C3C6D4] focus:ring-[#0073EA]"}`,placeholder:"Confirm your password",disabled:i}),m.jsx("button",{type:"button",onClick:()=>d(!u),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700",disabled:i,children:u?m.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-4.803m5.596-3.856a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0m7.6 0a10.05 10.05 0 011.563 4.803m-5.596 3.856a4.872 4.872 0 005.049-7.52M3 12a9 9 0 1118 0 9 9 0 01-18 0z"})}):m.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]}),s&&!y&&m.jsx("p",{className:"text-sm text-red-600",children:"Passwords do not match."})]}),m.jsx("button",{type:"submit",disabled:!b,className:`w-full h-12 px-4 py-[11px] rounded bg-[#0073EA] flex items-center justify-center gap-2 transition-colors ${b?"hover:bg-[#0062c7] cursor-pointer":"opacity-50 cursor-not-allowed"}`,children:m.jsx("span",{className:"text-white font-roboto text-base font-bold leading-normal",children:i?m.jsxs("span",{className:"flex items-center gap-2",children:[m.jsxs("svg",{className:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[m.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),m.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Setting Password..."]}):"Set Password"})})]})})})]})]})}const D9e=[{id:"1",title:"Employment Verification",documentType:"Employee ID Card",progress:0,expiryDate:"Oct 10, 2025",status:"not-started"},{id:"2",title:"Employment Verification",documentType:"Employee ID Card",progress:0,expiryDate:"Oct 10, 2025",status:"not-started"}],A9e=[{id:"3",title:"Employment Verification",documentType:"Employee ID Card",progress:15,expiryDate:"Oct 10, 2025",status:"in-progress"},{id:"4",title:"Employment Verification",documentType:"Employee ID Card",progress:15,expiryDate:"Oct 9, 2025",status:"in-progress"},{id:"5",title:"Employment Verification",documentType:"Employee ID Card",progress:15,expiryDate:"Oct 2, 2025",status:"in-progress"},{id:"6",title:"Employment Verification",documentType:"Employee ID Card",progress:15,expiryDate:"Sept 28, 2025",status:"in-progress"},{id:"7",title:"Employment Verification",documentType:"Employee ID Card",progress:15,expiryDate:"Sept 20, 2025",status:"in-progress"},{id:"8",title:"Employment Verification",documentType:"Employee ID Card",progress:15,expiryDate:"Sept 10, 2025",status:"in-progress"}];function $9e(){const n=si(),e=hc(),[t,r]=_.useState("home");_.useEffect(()=>{const o=e.pathname||"";o.startsWith("/ongoing")?r("ongoing"):o.startsWith("/expired")?r("expired"):o.startsWith("/verified")?r("verified"):o.startsWith("/contact")?r("contact"):r("home")},[e.pathname]);const s=[{id:"home",label:"Home",icon:o=>m.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9.56194 1.11261C9.84719 1.03538 10.1479 1.03538 10.4331 1.11261C10.7642 1.20227 11.043 1.42115 11.2655 1.59584C13.185 3.10283 15.1164 4.59457 17.0444 6.09074C17.3583 6.33431 17.6348 6.5489 17.8408 6.82749C18.0216 7.07197 18.1564 7.3474 18.2383 7.64023C18.3317 7.97391 18.3314 8.32392 18.3309 8.72123C18.3288 10.769 18.3309 12.8167 18.3309 14.8645C18.3309 15.3037 18.3309 15.6826 18.3054 15.9948C18.2784 16.3243 18.219 16.652 18.0584 16.9673C17.8187 17.4376 17.4362 17.8201 16.9659 18.0598C16.6505 18.2205 16.3229 18.2799 15.9934 18.3068C15.3254 18.3614 14.6479 18.332 13.9782 18.3323C13.8789 18.3323 13.7604 18.3324 13.656 18.3239C13.5349 18.314 13.3616 18.2886 13.18 18.1961C12.9449 18.0762 12.7536 17.885 12.6338 17.6498C12.5412 17.4681 12.5159 17.2948 12.5059 17.1738C12.4974 17.0694 12.4974 16.9508 12.4975 16.8516L12.5041 12.1881C12.5048 11.7207 12.505 11.4871 12.4144 11.3086C12.3345 11.1516 12.207 11.0238 12.0501 10.9438C11.8717 10.8528 11.638 10.8528 11.1708 10.8528H8.83752C8.37144 10.8528 8.13836 10.8528 7.96023 10.9435C7.80354 11.0232 7.67609 11.1505 7.59611 11.3071C7.50519 11.4851 7.50485 11.7181 7.50419 12.1842L7.49751 16.8516C7.49755 16.9508 7.4976 17.0694 7.48906 17.1738C7.47918 17.2948 7.45381 17.4681 7.36127 17.6498C7.24143 17.885 7.0502 18.0762 6.815 18.1961C6.63338 18.2886 6.46005 18.314 6.33904 18.3239C6.2346 18.3324 6.11606 18.3323 6.0168 18.3323C5.34706 18.332 4.66959 18.3614 4.00165 18.3068C3.6722 18.2799 3.34452 18.2205 3.0292 18.0598C2.5588 17.8201 2.17635 17.4376 1.93666 16.9673C1.776 16.652 1.71657 16.3243 1.68965 15.9948C1.66415 15.6826 1.66416 15.3037 1.66418 14.8644C1.66418 12.8166 1.66633 10.7689 1.66412 8.72123C1.66369 8.32392 1.66331 7.97391 1.75671 7.64023C1.83868 7.3474 1.97339 7.07197 2.15421 6.82749C2.36026 6.5489 2.63677 6.33431 2.95063 6.09075C4.87849 4.59464 6.8101 3.1028 8.72952 1.59584C8.95202 1.42115 9.23077 1.20227 9.56194 1.11261Z",fill:o?"#0073EA":"#676879"})}),onClick:()=>n("/dashboard")},{id:"ongoing",label:"Ongoing Verification",icon:o=>m.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M18.9167 9.58333L17.2504 11.25L15.5833 9.58333M17.4543 10.8333C17.4845 10.5597 17.5 10.2817 17.5 10C17.5 5.85787 14.1422 2.5 10 2.5C5.85787 2.5 2.5 5.85787 2.5 10C2.5 14.1422 5.85787 17.5 10 17.5C12.3561 17.5 14.4583 16.4136 15.8333 14.7144M10 5.83333V10L12.5 11.6667",stroke:o?"#0073EA":"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),onClick:()=>n("/ongoing-verification")},{id:"expired",label:"Expired Verification",icon:o=>m.jsxs("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("g",{clipPath:"url(#clip0_11001_25789)",children:m.jsx("path",{d:"M12.5052 7.50521L7.50521 12.5052M7.50521 7.50521L12.5052 12.5052M18.3385 10.0052C18.3385 14.6075 14.6075 18.3385 10.0052 18.3385C5.40283 18.3385 1.67188 14.6075 1.67188 10.0052C1.67188 5.40283 5.40283 1.67188 10.0052 1.67188C14.6075 1.67188 18.3385 5.40283 18.3385 10.0052Z",stroke:o?"#0073EA":"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),m.jsx("defs",{children:m.jsx("clipPath",{id:"clip0_11001_25789",children:m.jsx("rect",{width:"20",height:"20",fill:"white"})})})]}),onClick:()=>n("/expired-verification")},{id:"verified",label:"Verified Credentials",icon:o=>m.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M7.5 9.16667L10 11.6667L18.3333 3.33333M13.3333 2.5H6.5C5.09987 2.5 4.3998 2.5 3.86503 2.77248C3.39462 3.01217 3.01217 3.39462 2.77248 3.86503C2.5 4.3998 2.5 5.09987 2.5 6.5V13.5C2.5 14.9002 2.5 15.6002 2.77248 16.135C3.01217 16.6054 3.39462 16.9878 3.86503 17.2275C4.3998 17.5 5.09987 17.5 6.5 17.5H13.5C14.9002 17.5 15.6002 17.5 16.135 17.2275C16.6054 16.9878 16.9878 16.6054 17.2275 16.135C17.5 15.6002 17.5 14.9002 17.5 13.5V10",stroke:o?"#0073EA":"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),onClick:()=>n("/verified-credentials")},{id:"contact",label:"Contact Admin",icon:o=>m.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M16.6693 17.5C16.6693 16.337 16.6693 15.7556 16.5258 15.2824C16.2026 14.2171 15.3689 13.3833 14.3035 13.0602C13.8304 12.9167 13.2489 12.9167 12.0859 12.9167H7.91927C6.7563 12.9167 6.17481 12.9167 5.70165 13.0602C4.63631 13.3833 3.80264 14.2171 3.47947 15.2824C3.33594 15.7556 3.33594 16.337 3.33594 17.5M13.7526 6.25C13.7526 8.32107 12.0737 10 10.0026 10C7.93154 10 6.2526 8.32107 6.2526 6.25C6.2526 4.17893 7.93154 2.5 10.0026 2.5C12.0737 2.5 13.7526 4.17893 13.7526 6.25Z",stroke:o?"#0073EA":"#676879",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})}),onClick:()=>n("/contact-admin")}];return m.jsxs("div",{className:"flex flex-col w-full h-screen bg-white",children:[m.jsxs("div",{className:"flex w-full h-11 px-3 lg:px-4 justify-between items-center border-b border-[#DEDEDD] bg-white",children:[m.jsx("img",{src:"https://api.builder.io/api/v1/image/assets/TEMP/4566b1e4f2b69299156b1f1c61472e06e0ad9666?width=180",alt:"Logo",className:"w-[90px] h-7 object-contain"}),m.jsx("div",{className:"flex items-center gap-2",children:m.jsx("button",{onClick:()=>n("/profile"),className:"flex w-8 h-8 p-2 justify-center items-center gap-2 rounded-full bg-[#F65F7C]",children:m.jsx("span",{className:"text-white font-roboto text-xs font-medium leading-[10px]",children:"OS"})})})]}),m.jsxs("div",{className:"flex h-full bg-white overflow-hidden",children:[m.jsx("div",{className:"flex w-[248px] px-2 py-2 flex-col items-start gap-1 border-r border-[#D0D4E4] bg-white overflow-y-auto",children:s.map(o=>{const i=t===o.id;return m.jsxs("button",{onClick:()=>{r(o.id),o.onClick()},className:`flex h-[38px] items-center gap-2 self-stretch rounded ${i?"bg-[#E6F1FD] pl-1 pr-2.25":"pl-3 pr-2.25"}`,children:[i&&m.jsx("svg",{className:"w-0.5 h-[28.5px]",width:"2",height:"31",viewBox:"0 0 2 31",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M1 1V29.5",stroke:"#0073EA",strokeWidth:"2",strokeLinecap:"round"})}),o.icon(i),m.jsx("span",{className:`font-roboto text-[13px] font-medium leading-normal ${i?"text-[#172B4D]":"text-[#505258]"}`,children:o.label})]},o.id)})}),m.jsxs("div",{className:"flex flex-1 flex-col items-start bg-white overflow-y-auto",children:[m.jsx("div",{className:"flex h-14 flex-col items-start self-stretch",children:m.jsx("div",{className:"flex px-4 py-2 items-center gap-2 flex-1 self-stretch",children:m.jsx("div",{className:"flex items-start gap-2",children:m.jsx("h1",{className:"text-[#172B4D] font-roboto text-xl font-bold leading-[30px]",children:"Ongoing Verifications"})})})}),m.jsxs("div",{className:"flex px-4 flex-col items-start gap-2.5 flex-1 self-stretch",children:[m.jsxs("div",{className:"flex flex-col items-start gap-2.5 self-stretch",children:[m.jsx("h2",{className:"text-[#172B4D] font-roboto text-base font-bold leading-[26px]",children:"Not yet started"}),m.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5 self-stretch",children:D9e.map(o=>m.jsx("div",{className:"w-full",children:m.jsx(dk,{title:o.title,documentType:o.documentType,progress:o.progress,expiryDate:o.expiryDate,status:o.status})},o.id))})]}),m.jsxs("div",{className:"flex flex-col items-start gap-2.5 self-stretch",children:[m.jsx("h2",{className:"text-[#172B4D] font-roboto text-base font-bold leading-[26px]",children:"In Progress"}),m.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5 self-stretch",children:A9e.map(o=>m.jsx("div",{className:"w-full",children:m.jsx(dk,{title:o.title,documentType:o.documentType,progress:o.progress,expiryDate:o.expiryDate,status:o.status})},o.id))})]})]})]})]})]})}const F9e=[{id:"1",title:"Arcon Document Submission",documentType:"Employee ID Card",expiredDate:"Oct 10, 2025",issuedOn:"June 05, 2025"},{id:"2",title:"Arcon Document Submission",documentType:"Employee ID Card",expiredDate:"Oct 10, 2025",issuedOn:"June 05, 2025"},{id:"3",title:"Arcon Document Submission",documentType:"Employee ID Card",expiredDate:"Oct 10, 2025",issuedOn:"June 05, 2025"},{id:"4",title:"Arcon Document Submission",documentType:"Employee ID Card",expiredDate:"Oct 10, 2025",issuedOn:"June 05, 2025"},{id:"5",title:"Arcon Document Submission",documentType:"Employee ID Card",expiredDate:"Oct 10, 2025",issuedOn:"June 05, 2025"}];function P9e(){const n=si(),e=hc(),[t,r]=_.useState("expired");_.useEffect(()=>{const o=e.pathname||"";o.startsWith("/ongoing")?r("ongoing"):o.startsWith("/expired")?r("expired"):o.startsWith("/verified")?r("verified"):o.startsWith("/contact")?r("contact"):r("home")},[e.pathname]);const s=[{id:"home",label:"Home",icon:o=>m.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9.56194 1.11261C9.84719 1.03538 10.1479 1.03538 10.4331 1.11261C10.7642 1.20227 11.043 1.42115 11.2655 1.59584C13.185 3.10283 15.1164 4.59457 17.0444 6.09074C17.3583 6.33431 17.6348 6.5489 17.8408 6.82749C18.0216 7.07197 18.1564 7.3474 18.2383 7.64023C18.3317 7.97391 18.3314 8.32392 18.3309 8.72123C18.3288 10.769 18.3309 12.8167 18.3309 14.8645C18.3309 15.3037 18.3309 15.6826 18.3054 15.9948C18.2784 16.3243 18.219 16.652 18.0584 16.9673C17.8187 17.4376 17.4362 17.8201 16.9659 18.0598C16.6505 18.2205 16.3229 18.2799 15.9934 18.3068C15.3254 18.3614 14.6479 18.332 13.9782 18.3323C13.8789 18.3323 13.7604 18.3324 13.656 18.3239C13.5349 18.314 13.3616 18.2886 13.18 18.1961C12.9449 18.0762 12.7536 17.885 12.6338 17.6498C12.5412 17.4681 12.5159 17.2948 12.5059 17.1738C12.4974 17.0694 12.4974 16.9508 12.4975 16.8516L12.5041 12.1881C12.5048 11.7207 12.505 11.4871 12.4144 11.3086C12.3345 11.1516 12.207 11.0238 12.0501 10.9438C11.8717 10.8528 11.638 10.8528 11.1708 10.8528H8.83752C8.37144 10.8528 8.13836 10.8528 7.96023 10.9435C7.80354 11.0232 7.67609 11.1505 7.59611 11.3071C7.50519 11.4851 7.50485 11.7181 7.50419 12.1842L7.49751 16.8516C7.49755 16.9508 7.4976 17.0694 7.48906 17.1738C7.47918 17.2948 7.45381 17.4681 7.36127 17.6498C7.24143 17.885 7.0502 18.0762 6.815 18.1961C6.63338 18.2886 6.46005 18.314 6.33904 18.3239C6.2346 18.3324 6.11606 18.3323 6.0168 18.3323C5.34706 18.332 4.66959 18.3614 4.00165 18.3068C3.6722 18.2799 3.34452 18.2205 3.0292 18.0598C2.5588 17.8201 2.17635 17.4376 1.93666 16.9673C1.776 16.652 1.71657 16.3243 1.68965 15.9948C1.66415 15.6826 1.66416 15.3037 1.66418 14.8644C1.66418 12.8166 1.66633 10.7689 1.66412 8.72123C1.66369 8.32392 1.66331 7.97391 1.75671 7.64023C1.83868 7.3474 1.97339 7.07197 2.15421 6.82749C2.36026 6.5489 2.63677 6.33431 2.95063 6.09075C4.87849 4.59464 6.8101 3.1028 8.72952 1.59584C8.95202 1.42115 9.23077 1.20227 9.56194 1.11261Z",fill:o?"#0073EA":"#676879"})}),onClick:()=>n("/dashboard")},{id:"ongoing",label:"Ongoing Verification",icon:o=>m.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M18.9167 9.58333L17.2504 11.25L15.5833 9.58333M17.4543 10.8333C17.4845 10.5597 17.5 10.2817 17.5 10C17.5 5.85787 14.1422 2.5 10 2.5C5.85787 2.5 2.5 5.85787 2.5 10C2.5 14.1422 5.85787 17.5 10 17.5C12.3561 17.5 14.4583 16.4136 15.8333 14.7144M10 5.83333V10L12.5 11.6667",stroke:o?"#0073EA":"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),onClick:()=>n("/ongoing-verification")},{id:"expired",label:"Expired Verification",icon:o=>m.jsxs("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("g",{clipPath:"url(#clip0_11001_26397)",children:m.jsx("path",{d:"M12.5052 7.50521L7.50521 12.5052M7.50521 7.50521L12.5052 12.5052M18.3385 10.0052C18.3385 14.6075 14.6075 18.3385 10.0052 18.3385C5.40283 18.3385 1.67188 14.6075 1.67188 10.0052C1.67188 5.40283 5.40283 1.67188 10.0052 1.67188C14.6075 1.67188 18.3385 5.40283 18.3385 10.0052Z",stroke:o?"#0073EA":"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),m.jsx("defs",{children:m.jsx("clipPath",{id:"clip0_11001_26397",children:m.jsx("rect",{width:"20",height:"20",fill:"white"})})})]}),onClick:()=>n("/expired-verification")},{id:"verified",label:"Verified Credentials",icon:o=>m.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M7.5 9.16667L10 11.6667L18.3333 3.33333M13.3333 2.5H6.5C5.09987 2.5 4.3998 2.5 3.86503 2.77248C3.39462 3.01217 3.01217 3.39462 2.77248 3.86503C2.5 4.3998 2.5 5.09987 2.5 6.5V13.5C2.5 14.9002 2.5 15.6002 2.77248 16.135C3.01217 16.6054 3.39462 16.9878 3.86503 17.2275C4.3998 17.5 5.09987 17.5 6.5 17.5H13.5C14.9002 17.5 15.6002 17.5 16.135 17.2275C16.6054 16.9878 16.9878 16.6054 17.2275 16.135C17.5 15.6002 17.5 14.9002 17.5 13.5V10",stroke:o?"#0073EA":"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),onClick:()=>n("/verified-credentials")},{id:"contact",label:"Contact Admin",icon:o=>m.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M16.6693 17.5C16.6693 16.337 16.6693 15.7556 16.5258 15.2824C16.2026 14.2171 15.3689 13.3833 14.3035 13.0602C13.8304 12.9167 13.2489 12.9167 12.0859 12.9167H7.91927C6.7563 12.9167 6.17481 12.9167 5.70165 13.0602C4.63631 13.3833 3.80264 14.2171 3.47947 15.2824C3.33594 15.7556 3.33594 16.337 3.33594 17.5M13.7526 6.25C13.7526 8.32107 12.0737 10 10.0026 10C7.93154 10 6.2526 8.32107 6.2526 6.25C6.2526 4.17893 7.93154 2.5 10.0026 2.5C12.0737 2.5 13.7526 4.17893 13.7526 6.25Z",stroke:o?"#0073EA":"#676879",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})}),onClick:()=>n("/contact-admin")}];return m.jsxs("div",{className:"flex flex-col w-full h-screen bg-white",children:[m.jsxs("div",{className:"flex w-full h-11 px-3 lg:px-4 justify-between items-center border-b border-[#DEDEDD] bg-white",children:[m.jsx("img",{src:"https://api.builder.io/api/v1/image/assets/TEMP/4566b1e4f2b69299156b1f1c61472e06e0ad9666?width=180",alt:"Logo",className:"w-[90px] h-7 object-contain"}),m.jsx("div",{className:"flex items-center gap-2",children:m.jsx("button",{onClick:()=>n("/profile"),className:"flex w-8 h-8 p-2 justify-center items-center gap-2 rounded-full bg-[#F65F7C]",children:m.jsx("span",{className:"text-white font-roboto text-xs font-medium leading-[10px]",children:"OS"})})})]}),m.jsxs("div",{className:"flex h-full bg-white overflow-hidden",children:[m.jsx("div",{className:"flex w-[248px] px-2 py-2 flex-col items-start gap-1 border-r border-[#D0D4E4] bg-white overflow-y-auto",children:s.map(o=>{const i=t===o.id;return m.jsxs("button",{onClick:()=>{r(o.id),o.onClick()},className:`flex h-[38px] items-center gap-2 self-stretch rounded ${i?"bg-[#E6F1FD] pl-1 pr-2.25":"pl-3 pr-2.25"}`,children:[i&&m.jsx("svg",{className:"w-0.5 h-[28.5px]",width:"2",height:"31",viewBox:"0 0 2 31",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M1 1V29.5",stroke:"#0073EA",strokeWidth:"2",strokeLinecap:"round"})}),o.icon(i),m.jsx("span",{className:`font-roboto text-[13px] font-medium leading-normal ${i?"text-[#172B4D]":"text-[#505258]"}`,children:o.label})]},o.id)})}),m.jsxs("div",{className:"flex flex-1 flex-col items-start bg-white overflow-y-auto",children:[m.jsx("div",{className:"flex h-14 flex-col items-start self-stretch",children:m.jsx("div",{className:"flex px-4 py-2 items-center gap-2 flex-1 self-stretch",children:m.jsx("div",{className:"flex items-start gap-2",children:m.jsx("h1",{className:"text-[#172B4D] font-roboto text-xl font-bold leading-[30px]",children:"Expired Verification"})})})}),m.jsx("div",{className:"flex px-4 flex-col items-start gap-2.5 flex-1 self-stretch",children:m.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5 self-stretch",children:F9e.map(o=>m.jsx("div",{className:"w-full",children:m.jsx(Wz,{title:o.title,documentType:o.documentType,expiredDate:o.expiredDate,issuedOn:o.issuedOn})},o.id))})})]})]})]})}const O9e=[{id:"1",title:"Arcon Document Submission",documentType:"Employee ID Card",completedOn:"Oct 10, 2025",expiresOn:"Oct 10, 2025"},{id:"2",title:"Arcon Document Submission",documentType:"Employee ID Card",completedOn:"Oct 10, 2025",expiresOn:"Oct 10, 2025"},{id:"3",title:"Arcon Document Submission",documentType:"Employee ID Card",completedOn:"Oct 10, 2025",expiresOn:"Oct 10, 2025"},{id:"4",title:"Arcon Document Submission",documentType:"Employee ID Card",completedOn:"Oct 10, 2025",expiresOn:"Oct 10, 2025"},{id:"5",title:"Arcon Document Submission",documentType:"Employee ID Card",completedOn:"Oct 10, 2025",expiresOn:"Oct 10, 2025"},{id:"6",title:"Arcon Document Submission",documentType:"Employee ID Card",completedOn:"Oct 10, 2025",expiresOn:"Oct 10, 2025"},{id:"7",title:"Arcon Document Submission",documentType:"Employee ID Card",completedOn:"Oct 10, 2025",expiresOn:"Oct 10, 2025"}];function M9e(){const n=si(),e=hc(),[t,r]=_.useState("verified");_.useEffect(()=>{const o=e.pathname||"";o.startsWith("/ongoing")?r("ongoing"):o.startsWith("/expired")?r("expired"):o.startsWith("/verified")?r("verified"):o.startsWith("/contact")?r("contact"):r("home")},[e.pathname]);const s=[{id:"home",label:"Home",icon:o=>m.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9.56194 1.11261C9.84719 1.03538 10.1479 1.03538 10.4331 1.11261C10.7642 1.20227 11.043 1.42115 11.2655 1.59584C13.185 3.10283 15.1164 4.59457 17.0444 6.09074C17.3583 6.33431 17.6348 6.5489 17.8408 6.82749C18.0216 7.07197 18.1564 7.3474 18.2383 7.64023C18.3317 7.97391 18.3314 8.32392 18.3309 8.72123C18.3288 10.769 18.3309 12.8167 18.3309 14.8645C18.3309 15.3037 18.3309 15.6826 18.3054 15.9948C18.2784 16.3243 18.219 16.652 18.0584 16.9673C17.8187 17.4376 17.4362 17.8201 16.9659 18.0598C16.6505 18.2205 16.3229 18.2799 15.9934 18.3068C15.3254 18.3614 14.6479 18.332 13.9782 18.3323C13.8789 18.3323 13.7604 18.3324 13.656 18.3239C13.5349 18.314 13.3616 18.2886 13.18 18.1961C12.9449 18.0762 12.7536 17.885 12.6338 17.6498C12.5412 17.4681 12.5159 17.2948 12.5059 17.1738C12.4974 17.0694 12.4974 16.9508 12.4975 16.8516L12.5041 12.1881C12.5048 11.7207 12.505 11.4871 12.4144 11.3086C12.3345 11.1516 12.207 11.0238 12.0501 10.9438C11.8717 10.8528 11.638 10.8528 11.1708 10.8528H8.83752C8.37144 10.8528 8.13836 10.8528 7.96023 10.9435C7.80354 11.0232 7.67609 11.1505 7.59611 11.3071C7.50519 11.4851 7.50485 11.7181 7.50419 12.1842L7.49751 16.8516C7.49755 16.9508 7.4976 17.0694 7.48906 17.1738C7.47918 17.2948 7.45381 17.4681 7.36127 17.6498C7.24143 17.885 7.0502 18.0762 6.815 18.1961C6.63338 18.2886 6.46005 18.314 6.33904 18.3239C6.2346 18.3324 6.11606 18.3323 6.0168 18.3323C5.34706 18.332 4.66959 18.3614 4.00165 18.3068C3.6722 18.2799 3.34452 18.2205 3.0292 18.0598C2.5588 17.8201 2.17635 17.4376 1.93666 16.9673C1.776 16.652 1.71657 16.3243 1.68965 15.9948C1.66415 15.6826 1.66416 15.3037 1.66418 14.8644C1.66418 12.8166 1.66633 10.7689 1.66412 8.72123C1.66369 8.32392 1.66331 7.97391 1.75671 7.64023C1.83868 7.3474 1.97339 7.07197 2.15421 6.82749C2.36026 6.5489 2.63677 6.33431 2.95063 6.09075C4.87849 4.59464 6.8101 3.1028 8.72952 1.59584C8.95202 1.42115 9.23077 1.20227 9.56194 1.11261Z",fill:o?"#0073EA":"#676879"})}),onClick:()=>n("/dashboard")},{id:"ongoing",label:"Ongoing Verification",icon:o=>m.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M18.9167 9.58333L17.2504 11.25L15.5833 9.58333M17.4543 10.8333C17.4845 10.5597 17.5 10.2817 17.5 10C17.5 5.85787 14.1422 2.5 10 2.5C5.85787 2.5 2.5 5.85787 2.5 10C2.5 14.1422 5.85787 17.5 10 17.5C12.3561 17.5 14.4583 16.4136 15.8333 14.7144M10 5.83333V10L12.5 11.6667",stroke:o?"#0073EA":"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),onClick:()=>n("/ongoing-verification")},{id:"expired",label:"Expired Verification",icon:o=>m.jsxs("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("g",{clipPath:"url(#clip0_11001_23158)",children:m.jsx("path",{d:"M12.5052 7.50521L7.50521 12.5052M7.50521 7.50521L12.5052 12.5052M18.3385 10.0052C18.3385 14.6075 14.6075 18.3385 10.0052 18.3385C5.40283 18.3385 1.67188 14.6075 1.67188 10.0052C1.67188 5.40283 5.40283 1.67188 10.0052 1.67188C14.6075 1.67188 18.3385 5.40283 18.3385 10.0052Z",stroke:o?"#0073EA":"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),m.jsx("defs",{children:m.jsx("clipPath",{id:"clip0_11001_23158",children:m.jsx("rect",{width:"20",height:"20",fill:"white"})})})]}),onClick:()=>n("/expired-verification")},{id:"verified",label:"Verified Credentials",icon:o=>m.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M7.5 9.16667L10 11.6667L18.3333 3.33333M13.3333 2.5H6.5C5.09987 2.5 4.3998 2.5 3.86503 2.77248C3.39462 3.01217 3.01217 3.39462 2.77248 3.86503C2.5 4.3998 2.5 5.09987 2.5 6.5V13.5C2.5 14.9002 2.5 15.6002 2.77248 16.135C3.01217 16.6054 3.39462 16.9878 3.86503 17.2275C4.3998 17.5 5.09987 17.5 6.5 17.5H13.5C14.9002 17.5 15.6002 17.5 16.135 17.2275C16.6054 16.9878 16.9878 16.6054 17.2275 16.135C17.5 15.6002 17.5 14.9002 17.5 13.5V10",stroke:o?"#0073EA":"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),onClick:()=>n("/verified-credentials")},{id:"contact",label:"Contact Admin",icon:o=>m.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M16.6693 17.5C16.6693 16.337 16.6693 15.7556 16.5258 15.2824C16.2026 14.2171 15.3689 13.3833 14.3035 13.0602C13.8304 12.9167 13.2489 12.9167 12.0859 12.9167H7.91927C6.7563 12.9167 6.17481 12.9167 5.70165 13.0602C4.63631 13.3833 3.80264 14.2171 3.47947 15.2824C3.33594 15.7556 3.33594 16.337 3.33594 17.5M13.7526 6.25C13.7526 8.32107 12.0737 10 10.0026 10C7.93154 10 6.2526 8.32107 6.2526 6.25C6.2526 4.17893 7.93154 2.5 10.0026 2.5C12.0737 2.5 13.7526 4.17893 13.7526 6.25Z",stroke:o?"#0073EA":"#676879",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})}),onClick:()=>n("/contact-admin")}];return m.jsxs("div",{className:"flex flex-col w-full h-screen bg-white",children:[m.jsxs("div",{className:"flex w-full h-11 px-3 lg:px-4 justify-between items-center border-b border-[#DEDEDD] bg-white",children:[m.jsx("img",{src:"https://api.builder.io/api/v1/image/assets/TEMP/4566b1e4f2b69299156b1f1c61472e06e0ad9666?width=180",alt:"Logo",className:"w-[90px] h-7 object-contain"}),m.jsx("div",{className:"flex items-center gap-2",children:m.jsx("button",{onClick:()=>n("/profile"),className:"flex w-8 h-8 p-2 justify-center items-center gap-2 rounded-full bg-[#F65F7C]",children:m.jsx("span",{className:"text-white font-roboto text-xs font-medium leading-[10px]",children:"OS"})})})]}),m.jsxs("div",{className:"flex h-full bg-white overflow-hidden",children:[m.jsx("div",{className:"flex w-[248px] px-2 py-2 flex-col items-start gap-1 border-r border-[#D0D4E4] bg-white overflow-y-auto",children:s.map(o=>{const i=t===o.id;return m.jsxs("button",{onClick:()=>{r(o.id),o.onClick()},className:`flex h-[38px] items-center gap-2 self-stretch rounded ${i?"bg-[#E6F1FD] pl-1 pr-2.25":"pl-3 pr-2.25"}`,children:[i&&m.jsx("svg",{className:"w-0.5 h-[28.5px]",width:"2",height:"31",viewBox:"0 0 2 31",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M1 1V29.5",stroke:"#0073EA",strokeWidth:"2",strokeLinecap:"round"})}),o.icon(i),m.jsx("span",{className:`font-roboto text-[13px] font-medium leading-normal ${i?"text-[#172B4D]":"text-[#505258]"}`,children:o.label})]},o.id)})}),m.jsxs("div",{className:"flex flex-1 flex-col items-start bg-white overflow-y-auto",children:[m.jsx("div",{className:"flex h-14 flex-col items-start self-stretch",children:m.jsx("div",{className:"flex px-4 py-2 items-center gap-2 flex-1 self-stretch",children:m.jsx("div",{className:"flex items-start gap-2",children:m.jsx("h1",{className:"text-[#172B4D] font-roboto text-xl font-bold leading-[30px]",children:"Verified Credentials"})})})}),m.jsx("div",{className:"flex px-4 flex-col items-start gap-2.5 flex-1 self-stretch",children:m.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5 self-stretch",children:O9e.map(o=>m.jsx("div",{className:"w-full",children:m.jsx(Uz,{title:o.title,documentType:o.documentType,completedOn:o.completedOn,expiresOn:o.expiresOn})},o.id))})})]})]})]})}function AR(){const n=si(),{toast:e}=pd(),[t,r]=_.useState("contact"),s=hc();_.useEffect(()=>{const Z=s.pathname||"";Z.startsWith("/ongoing")?r("ongoing"):Z.startsWith("/expired")?r("expired"):Z.startsWith("/verified")?r("verified"):Z.startsWith("/contact")?r("contact"):r("home")},[s.pathname]);const[o,i]=_.useState(""),[a,l]=_.useState(""),[c,u]=_.useState(""),[d,f]=_.useState(null),[p,x]=_.useState(!1),[v,y]=_.useState(!1),b=_.useRef(null),w=_.useRef(null);_.useEffect(()=>{b.current&&a&&b.current.innerHTML!==a&&(b.current.innerHTML=a,u(b.current.innerText||""))},[a]);const S=(Z,de)=>{try{document.execCommand(Z,!1,de||void 0);const pe=b.current?.innerHTML||"",Ce=b.current?.innerText||"";l(pe),u(Ce),b.current?.focus()}catch{}},k=()=>{const Z=window.getSelection();if(!Z||Z.rangeCount===0)return;const Ce=`<code style="background:#f6f8fa;padding:2px 4px;border-radius:4px;font-family:monospace">${Z.getRangeAt(0).toString()}</code>`;document.execCommand("insertHTML",!1,Ce);const Ae=b.current?.innerHTML||"",ze=b.current?.innerText||"";l(Ae),u(ze),b.current?.focus()},[N,I]=_.useState(!1),[T,F]=_.useState(!1),[R,D]=_.useState(!1),[A,P]=_.useState(!1),[B,L]=_.useState(!1),[W,H]=_.useState(null),G=()=>{if(!b.current)return;const Z=window.getSelection();if(!Z||!Z.anchorNode||!b.current.contains(Z.anchorNode)){I(!1),F(!1),D(!1),P(!1),L(!1),H(null);return}try{I(document.queryCommandState("bold")),F(document.queryCommandState("italic")),D(document.queryCommandState("underline")),P(document.queryCommandState("strikeThrough")),L(document.queryCommandState("justifyLeft"));const de=document.queryCommandValue("foreColor");H(de||null)}catch{}};_.useEffect(()=>(document.addEventListener("selectionchange",G),()=>document.removeEventListener("selectionchange",G)),[]);const M=(Z,de)=>{S(Z,de),setTimeout(G,0)},j=()=>{k(),setTimeout(G,0)},z=[{id:"home",label:"Home",icon:Z=>m.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9.56194 1.11261C9.84719 1.03538 10.1479 1.03538 10.4331 1.11261C10.7642 1.20227 11.043 1.42115 11.2655 1.59584C13.185 3.10283 15.1164 4.59457 17.0444 6.09074C17.3583 6.33431 17.6348 6.5489 17.8408 6.82749C18.0216 7.07197 18.1564 7.3474 18.2383 7.64023C18.3317 7.97391 18.3314 8.32392 18.3309 8.72123C18.3288 10.769 18.3309 12.8167 18.3309 14.8645C18.3309 15.3037 18.3309 15.6826 18.3054 15.9948C18.2784 16.3243 18.219 16.652 18.0584 16.9673C17.8187 17.4376 17.4362 17.8201 16.9659 18.0598C16.6505 18.2205 16.3229 18.2799 15.9934 18.3068C15.3254 18.3614 14.6479 18.332 13.9782 18.3323C13.8789 18.3323 13.7604 18.3324 13.656 18.3239C13.5349 18.314 13.3616 18.2886 13.18 18.1961C12.9449 18.0762 12.7536 17.885 12.6338 17.6498C12.5412 17.4681 12.5159 17.2948 12.5059 17.1738C12.4974 17.0694 12.4974 16.9508 12.4975 16.8516L12.5041 12.1881C12.5048 11.7207 12.505 11.4871 12.4144 11.3086C12.3345 11.1516 12.207 11.0238 12.0501 10.9438C11.8717 10.8528 11.638 10.8528 11.1708 10.8528H8.83752C8.37144 10.8528 8.13836 10.8528 7.96023 10.9435C7.80354 11.0232 7.67609 11.1505 7.59611 11.3071C7.50519 11.4851 7.50485 11.7181 7.50419 12.1842L7.49751 16.8516C7.49755 16.9508 7.4976 17.0694 7.48906 17.1738C7.47918 17.2948 7.45381 17.4681 7.36127 17.6498C7.24143 17.885 7.0502 18.0762 6.815 18.1961C6.63338 18.2886 6.46005 18.314 6.33904 18.3239C6.2346 18.3324 6.11606 18.3323 6.0168 18.3323C5.34706 18.332 4.66959 18.3614 4.00165 18.3068C3.6722 18.2799 3.34452 18.2205 3.0292 18.0598C2.5588 17.8201 2.17635 17.4376 1.93666 16.9673C1.77605 16.652 1.71661 16.3243 1.68963 15.9948C1.66406 15.6826 1.66406 15.3037 1.66406 14.8645C1.66406 12.8167 1.66627 10.769 1.66406 8.72123C1.66359 8.32392 1.66333 7.97391 1.75672 7.64023C1.83866 7.3474 1.97345 7.07197 2.15419 6.82749C2.36025 6.5489 2.63674 6.33431 2.95063 6.09074C4.87865 4.59457 6.81004 3.10283 8.72954 1.59584C8.95201 1.42115 9.23079 1.20227 9.56194 1.11261Z",fill:Z?"#0073EA":"#676879"})}),onClick:()=>n("/dashboard")},{id:"ongoing",label:"Ongoing Verification",icon:Z=>m.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M18.9167 9.58333L17.2504 11.25L15.5833 9.58333M17.4543 10.8333C17.4845 10.5597 17.5 10.2817 17.5 10C17.5 5.85787 14.1422 2.5 10 2.5C5.85787 2.5 2.5 5.85787 2.5 10C2.5 14.1422 5.85787 17.5 10 17.5C12.3561 17.5 14.4583 16.4136 15.8333 14.7144M10 5.83333V10L12.5 11.6667",stroke:Z?"#0073EA":"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),onClick:()=>n("/ongoing-verification")},{id:"expired",label:"Expired Verification",icon:Z=>m.jsxs("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("g",{clipPath:"url(#clip0_11001_26397)",children:m.jsx("path",{d:"M12.5052 7.50521L7.50521 12.5052M7.50521 7.50521L12.5052 12.5052M18.3385 10.0052C18.3385 14.6075 14.6075 18.3385 10.0052 18.3385C5.40283 18.3385 1.67188 14.6075 1.67188 10.0052C1.67188 5.40283 5.40283 1.67188 10.0052 1.67188C14.6075 1.67188 18.3385 5.40283 18.3385 10.0052Z",stroke:Z?"#0073EA":"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),m.jsx("defs",{children:m.jsx("clipPath",{id:"clip0_11001_26397",children:m.jsx("rect",{width:"20",height:"20",fill:"white"})})})]}),onClick:()=>n("/expired-verification")},{id:"verified",label:"Verified Credentials",icon:Z=>m.jsx("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M7.5 9.16667L10 11.6667L18.3333 3.33333M13.3333 2.5H6.5C5.09987 2.5 4.3998 2.5 3.86503 2.77248C3.39462 3.01217 3.01217 3.39462 2.77248 3.86503C2.5 4.3998 2.5 5.09987 2.5 6.5V13.5C2.5 14.9002 2.5 15.6002 2.77248 16.135C3.01217 16.6054 3.39462 16.9878 3.86503 17.2275C4.3998 17.5 5.09987 17.5 6.5 17.5H13.5C14.9002 17.5 15.6002 17.5 16.135 17.2275C16.6054 16.9878 16.9878 16.6054 17.2275 16.135C17.5 15.6002 17.5 14.9002 17.5 13.5V10",stroke:Z?"#0073EA":"#676879",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),onClick:()=>n("/verified-credentials")},{id:"contact",label:"Contact Admin",icon:Z=>m.jsxs("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.32195 12.0938C9.10747 12.0942 10.8931 12.0942 12.6786 12.0938C13.2841 12.0936 13.6968 12.0935 14.0571 12.1571C15.7822 12.4613 17.1328 13.8118 17.437 15.5369C17.5005 15.8973 17.5004 16.3098 17.5003 16.9154C17.5002 17.0474 17.5043 17.1803 17.4813 17.3108C17.3901 17.8283 16.9848 18.2335 16.4673 18.3248C16.3539 18.3448 16.2343 18.3442 16.1748 18.3438C12.0589 18.3218 7.94165 18.3218 3.8257 18.3438C3.76623 18.3442 3.64668 18.3448 3.5332 18.3248C3.0157 18.2335 2.61051 17.8283 2.51925 17.3108C2.49624 17.1803 2.50029 17.0474 2.50025 16.9154C2.50012 16.3098 2.50003 15.8973 2.56357 15.5369C2.86775 13.8118 4.21835 12.4613 5.9434 12.1571C6.30374 12.0935 6.71638 12.0936 7.32195 12.0938Z",fill:Z?"#0073EA":"#676879"}),m.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.42188 6.23958C5.42188 3.70828 7.4739 1.65625 10.0052 1.65625C12.5365 1.65625 14.5886 3.70828 14.5886 6.23958C14.5886 8.77092 12.5365 10.8229 10.0052 10.8229C7.4739 10.8229 5.42188 8.77092 5.42188 6.23958Z",fill:Z?"#0073EA":"#676879"})]}),onClick:()=>n("/contact-admin")}],V=Z=>{Z.preventDefault(),Z.stopPropagation(),Z.type==="dragenter"||Z.type==="dragover"?y(!0):Z.type==="dragleave"&&y(!1)},K=Z=>{Z.preventDefault(),Z.stopPropagation(),y(!1),Z.dataTransfer.files&&Z.dataTransfer.files[0]&&f(Z.dataTransfer.files[0])},J=Z=>{Z.target.files&&Z.target.files[0]&&f(Z.target.files[0])},oe=async Z=>{if(Z.preventDefault(),!(!o.trim()||!c.trim())){x(!0);try{await new Promise(de=>setTimeout(de,600)),e({title:"Message sent successfully",description:"Admin will respond shortly."}),i(""),l(""),u(""),b.current&&(b.current.innerHTML=""),f(null)}catch{e({title:"Failed to send message",description:"Please try again later.",variant:"destructive"})}finally{x(!1)}}};return m.jsxs("div",{className:"flex flex-col w-full h-screen bg-white",children:[m.jsxs("div",{className:"flex w-full h-11 px-3 lg:px-4 justify-between items-center border-b border-[#DEDEDD] bg-white",children:[m.jsx("img",{src:"https://api.builder.io/api/v1/image/assets/TEMP/4566b1e4f2b69299156b1f1c61472e06e0ad9666?width=180",alt:"Logo",className:"w-[90px] h-7 object-contain"}),m.jsx("div",{className:"flex items-center gap-2",children:m.jsx("button",{onClick:()=>n("/profile"),className:"flex w-8 h-8 p-2 justify-center items-center gap-2 rounded-full bg-[#F65F7C]",children:m.jsx("span",{className:"text-white font-roboto text-xs font-medium leading-[10px]",children:"OS"})})})]}),m.jsxs("div",{className:"flex h-full bg-white overflow-hidden",children:[m.jsx("div",{className:"flex w-[248px] px-2 py-2 flex-col items-start gap-1 border-r border-[#D0D4E4] bg-white overflow-y-auto",children:z.map(Z=>{const de=t===Z.id;return m.jsxs("button",{onClick:()=>{r(Z.id),Z.onClick()},className:`flex h-[38px] items-center gap-2 self-stretch rounded ${de?"bg-[#E6F1FD] pl-1 pr-2.25":"pl-3 pr-2.25"}`,children:[de&&m.jsx("svg",{className:"w-0.5 h-[28.5px]",width:"2",height:"31",viewBox:"0 0 2 31",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M1 1V29.5",stroke:"#0073EA",strokeWidth:"2",strokeLinecap:"round"})}),Z.icon(de),m.jsx("span",{className:`font-roboto text-[13px] font-medium leading-normal ${de?"text-[#172B4D]":"text-[#505258]"}`,children:Z.label})]},Z.id)})}),m.jsxs("div",{className:"flex flex-1 flex-col items-start bg-white overflow-y-auto",children:[m.jsx("div",{className:"flex h-14 flex-col items-start self-stretch border-b border-[#DEDEDD]",children:m.jsx("div",{className:"flex px-4 py-2 items-center gap-2 flex-1 self-stretch",children:m.jsxs("div",{className:"flex items-start gap-2",children:[m.jsx("h1",{className:"text-[#172B4D] font-roboto text-xl font-bold leading-[30px]",children:"Contact Admin"}),m.jsxs("svg",{className:"w-5 h-5",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("g",{clipPath:"url(#clip0_contact_info)",children:m.jsx("path",{d:"M9.9974 13.3307V9.9974M9.9974 6.66406H10.0057M18.3307 9.9974C18.3307 14.5997 14.5997 18.3307 9.9974 18.3307C5.39502 18.3307 1.66406 14.5997 1.66406 9.9974C1.66406 5.39502 5.39502 1.66406 9.9974 1.66406C14.5997 1.66406 18.3307 5.39502 18.3307 9.9974Z",stroke:"#505258",strokeWidth:"1.66667",strokeLinecap:"round",strokeLinejoin:"round"})}),m.jsx("defs",{children:m.jsx("clipPath",{id:"clip0_contact_info",children:m.jsx("rect",{width:"20",height:"20",fill:"white"})})})]})]})})}),m.jsx("div",{className:"flex px-4 py-[18px] flex-col items-end gap-1 flex-1 self-stretch",children:m.jsx("form",{onSubmit:oe,className:"w-full max-w-[993px]",children:m.jsxs("div",{className:"flex flex-col items-start gap-4 rounded border border-[#DEDEDD] bg-white p-4 shadow-[0_3px_8px_0_rgba(0,0,0,0.20)]",children:[m.jsxs("div",{className:"flex flex-col items-start self-stretch",children:[m.jsx("label",{className:"flex pb-2 items-start gap-2 self-stretch",children:m.jsx("span",{className:"flex h-[10px] flex-col justify-center flex-1 text-[#172B4D] font-roboto text-[13px] font-medium leading-[18px]",children:"Subject Line"})}),m.jsx("input",{type:"text",value:o,onChange:Z=>i(Z.target.value),placeholder:"Eg. Question about document submission",className:"flex h-[38px] px-3 py-[15px] justify-between items-center self-stretch rounded border border-[#C3C6D4] bg-white text-[#676879] font-roboto text-[13px] font-normal leading-5 outline-none focus:border-[#0073EA]",required:!0})]}),m.jsxs("div",{className:"flex flex-col items-start self-stretch",children:[m.jsx("label",{className:"flex pb-2 items-start gap-2 self-stretch",children:m.jsx("span",{className:"flex h-[10px] flex-col justify-center flex-1 text-[#172B4D] font-roboto text-[13px] font-medium leading-[18px]",children:"Message"})}),m.jsxs("div",{className:"w-full rounded border border-[#C3C6D4] bg-white overflow-hidden",children:[m.jsxs("div",{className:"flex items-center gap-2 px-2 py-1 border-b border-[#C3C6D4] bg-white",children:[m.jsx("button",{type:"button",onClick:()=>M("undo"),className:"p-1 rounded hover:bg-gray-100",children:m.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M12.5 6.25H4.88438L7.12625 4.00875L6.25 3.125L2.5 6.875L6.25 10.625L7.12625 9.74062L4.88625 7.5H12.5C13.4946 7.5 14.4484 7.89509 15.1517 8.59835C15.8549 9.30161 16.25 10.2554 16.25 11.25C16.25 12.2446 15.8549 13.1984 15.1517 13.9017C14.4484 14.6049 13.4946 15 12.5 15H7.5V16.25H12.5C13.8261 16.25 15.0979 15.7232 16.0355 14.7855C16.9732 13.8479 17.5 12.5761 17.5 11.25C17.5 9.92392 16.9732 8.65215 16.0355 7.71447C15.0979 6.77678 13.8261 6.25 12.5 6.25Z",fill:"#212529"})})}),m.jsx("button",{type:"button",onClick:()=>M("redo"),className:"p-1 rounded hover:bg-gray-100",children:m.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M7.5 6.25H15.1156L12.8737 4.00875L13.75 3.125L17.5 6.875L13.75 10.625L12.8737 9.74062L15.1137 7.5H7.5C6.50544 7.5 5.55161 7.89509 4.84835 8.59835C4.14509 9.30161 3.75 10.2554 3.75 11.25C3.75 12.2446 4.14509 13.1984 4.84835 13.9017C5.55161 14.6049 6.50544 15 7.5 15H12.5V16.25H7.5C6.17392 16.25 4.90215 15.7232 3.96447 14.7855C3.02678 13.8479 2.5 12.5761 2.5 11.25C2.5 9.92392 3.02678 8.65215 3.96447 7.71447C4.90215 6.77678 6.17392 6.25 7.5 6.25Z",fill:"#212529"})})}),m.jsx("div",{className:"h-8 px-2 flex items-center rounded text-sm bg-white border border-transparent",children:m.jsx("span",{className:"text-sm text-[#212529]",children:"Normal text"})}),m.jsx("div",{className:"w-px h-6 bg-[#E9ECEF] mx-1"}),m.jsx("button",{type:"button",onClick:()=>M("justifyLeft"),className:`p-1 rounded hover:bg-gray-100 ${B?"bg-[#E6F1FD]":""}`,children:m.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M7.5 3.75H16.25V5H7.5V3.75ZM7.5 7.5H13.75V8.75H7.5V7.5ZM7.5 11.25H16.25V12.5H7.5V11.25ZM7.5 15H13.75V16.25H7.5V15ZM3.75 2.5H5V17.5H3.75V2.5Z",fill:"#212529"})})}),m.jsx("input",{ref:w,type:"color",className:"hidden",onChange:Z=>M("foreColor",Z.target.value)}),m.jsx("button",{type:"button",onClick:()=>w.current?.click(),className:`p-1 rounded hover:bg-gray-100 ${W?"bg-[#E6F1FD]":""}`,children:m.jsx("div",{className:"w-4 h-4 rounded-sm",style:{background:W||"#212529"}})}),m.jsx("div",{className:"ml-2 w-px h-6 bg-[#E9ECEF] mr-1"}),m.jsx("button",{type:"button",onClick:()=>M("bold"),className:`p-1 rounded hover:bg-gray-100 font-bold ${N?"bg-[#E6F1FD]":""}`,children:m.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M11.4062 15.625H5.625V4.375H10.9375C11.5639 4.37504 12.1771 4.55435 12.7048 4.89174C13.2325 5.22914 13.6526 5.71052 13.9155 6.27903C14.1784 6.84754 14.2731 7.47942 14.1884 8.10001C14.1037 8.72061 13.8431 9.30399 13.4375 9.78125C13.9673 10.205 14.3528 10.7825 14.5408 11.4344C14.7289 12.0862 14.7102 12.7803 14.4875 13.4211C14.2647 14.0619 13.8488 14.6179 13.297 15.0126C12.7452 15.4073 12.0847 15.6213 11.4062 15.625Z",fill:"#212529"})})}),m.jsx("button",{type:"button",onClick:()=>M("italic"),className:`p-1 rounded hover:bg-gray-100 italic ${T?"bg-[#E6F1FD]":""}`,children:m.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M15.625 5.625V4.375H7.5V5.625H10.7125L7.98125 14.375H4.375V15.625H12.5V14.375H9.2875L12.0187 5.625H15.625Z",fill:"#212529"})})}),m.jsx("button",{type:"button",onClick:()=>M("underline"),className:`p-1 rounded hover:bg-gray-100 ${R?"bg-[#E6F1FD]":""}`,children:m.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M2.5 16.25H17.5V17.5H2.5V16.25ZM10 14.375C8.83968 14.375 7.72688 13.9141 6.90641 13.0936C6.08594 12.2731 5.625 11.1603 5.625 10V3.125H6.875V10C6.875 10.8288 7.20424 11.6237 7.79029 12.2097C8.37634 12.7958 9.1712 13.125 10 13.125C10.8288 13.125 11.6237 12.7958 12.2097 12.2097C12.7958 11.6237 13.125 10.8288 13.125 10V3.125H14.375V10C14.375 11.1603 13.9141 12.2731 13.0936 13.0936C12.2731 13.9141 11.1603 14.375 10 14.375Z",fill:"#212529"})})}),m.jsx("button",{type:"button",onClick:()=>M("strikeThrough"),className:`p-1 rounded hover:bg-gray-100 line-through ${A?"bg-[#E6F1FD]":""}`,children:m.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M17.5 9.37538H11.2225C10.945 9.30076 10.6662 9.23096 10.3863 9.16601C8.63125 8.75101 7.63875 8.44726 7.63875 7.02663C7.6245 6.78139 7.66081 6.53584 7.74542 6.30522C7.83004 6.0746 7.96115 5.86384 8.13062 5.68601C8.6615 5.24944 9.32644 5.00889 10.0137 5.00476C11.7825 4.96101 12.5981 5.56101 13.265 6.47351L14.2744 5.73601C13.8019 5.05748 13.1578 4.51654 12.4078 4.16845C11.6578 3.82036 10.8288 3.6776 10.0056 3.75476C8.99439 3.76121 8.01887 4.12947 7.25563 4.79288C6.96634 5.08632 6.74024 5.4359 6.59125 5.82008C6.44227 6.20426 6.37356 6.61488 6.38937 7.02663C6.36197 7.47718 6.4466 7.92751 6.63572 8.33737C6.82483 8.74723 7.11254 9.10385 7.47312 9.37538H2.5V10.6254H11.0325C12.2619 10.9816 12.9969 11.4454 13.0156 12.7241C13.0359 12.9973 12.9985 13.2717 12.9056 13.5294C12.8128 13.7871 12.6667 14.0223 12.4769 14.2198C11.8155 14.7411 10.9938 15.017 10.1519 15.0004C9.52345 14.9822 8.90738 14.8213 8.35029 14.5299C7.7932 14.2385 7.30966 13.8243 6.93625 13.3185L5.97812 14.121C6.46358 14.768 7.08994 15.2959 7.80972 15.6648C8.52951 16.0338 9.32384 16.234 10.1325 16.2504H10.195C11.3492 16.2636 12.4695 15.86 13.35 15.1135C13.6625 14.7984 13.9054 14.4213 14.0632 14.0065C14.2209 13.5917 14.2898 13.1485 14.2656 12.7054C14.289 11.9474 14.0332 11.2072 13.5469 10.6254H17.5V9.37538Z",fill:"#212529"})})}),m.jsx("button",{type:"button",onClick:()=>j(),className:"p-1 rounded hover:bg-gray-100",children:m.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:m.jsx("path",{d:"M19.375 10L15 14.375L14.1187 13.4938L17.6063 10L14.1187 6.50625L15 5.625L19.375 10ZM0.625 10L5 5.625L5.88125 6.50625L2.39375 10L5.88125 13.4938L5 14.375L0.625 10Z",fill:"#212529"})})})]}),m.jsxs("div",{className:"relative w-full",children:[m.jsx("div",{ref:b,contentEditable:!0,suppressContentEditableWarning:!0,onInput:()=>{const Z=b.current?.innerHTML||"",de=b.current?.innerText||"";l(Z),u(de),setTimeout(G,0)},className:"w-full min-h-[202px] p-3 text-[#676879] font-roboto text-[13px] font-normal leading-5 outline-none resize-none","aria-multiline":!0}),!c&&m.jsx("div",{className:"pointer-events-none absolute top-3 left-3 text-[#9aa0a6]",children:"Describe your question or concern in detail...."})]})]})]}),m.jsxs("div",{className:"flex flex-col items-start self-stretch",children:[m.jsx("label",{className:"flex pb-2 items-start gap-2 self-stretch",children:m.jsx("span",{className:"flex h-[10px] flex-col justify-center flex-1 text-[#172B4D] font-roboto text-[13px] font-medium leading-[18px]",children:"Attachment (Optional)"})}),m.jsxs("div",{className:`flex h-[72px] px-[284px] justify-center items-center gap-2 self-stretch rounded-lg border border-dashed ${v?"border-[#0073EA] bg-[#E6F1FD]":"border-[#C3C6D4] bg-white"} cursor-pointer relative`,onDragEnter:V,onDragLeave:V,onDragOver:V,onDrop:K,children:[m.jsx("input",{type:"file",onChange:J,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",accept:".jpg,.jpeg,.png,.svg,.xls,.xlsx"}),m.jsxs("div",{className:"flex items-center gap-2 pointer-events-none",children:[m.jsxs("div",{className:"relative w-[33px] h-[34px]",children:[m.jsxs("svg",{className:"absolute left-0 top-0",width:"28",height:"28",viewBox:"0 0 29 29",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M15.3433 2.3039C15.3446 2.33205 15.3446 2.34758 15.3446 2.37864V7.59236C15.3446 7.89031 15.3445 8.18048 15.3647 8.42622C15.3866 8.69608 15.4387 9.01453 15.602 9.33495C15.8283 9.77923 16.1895 10.1404 16.6338 10.3668C16.9542 10.5301 17.2727 10.5821 17.5426 10.6041C17.7883 10.6242 18.0784 10.6242 18.3764 10.6241H23.5902C23.6211 10.6241 23.6366 10.6241 23.6648 10.6255C24.2478 10.6533 24.7603 11.166 24.7878 11.749C24.7891 11.7771 24.7891 11.7863 24.7891 11.8046V20.3534C24.7891 21.3038 24.7891 22.088 24.7369 22.727C24.6827 23.3905 24.5663 24.0005 24.2743 24.5736C23.8216 25.4621 23.0992 26.1844 22.2107 26.6372C21.6377 26.9291 21.0277 27.0455 20.3641 27.0997C19.7252 27.1519 18.9409 27.1519 17.9906 27.1519H10.3375C9.38721 27.1519 8.6029 27.1519 7.964 27.0997C7.30041 27.0455 6.69041 26.9291 6.11744 26.6372C5.2289 26.1844 4.50649 25.4621 4.05376 24.5736C3.76181 24.0005 3.64545 23.3905 3.59124 22.727C3.53904 22.088 3.53905 21.3038 3.53906 20.3534V7.97814C3.53905 7.02784 3.53904 6.24353 3.59124 5.60462C3.64545 4.94103 3.76181 4.33104 4.05376 3.75807C4.50649 2.86952 5.2289 2.14712 6.11744 1.69439C6.69041 1.40245 7.30041 1.28608 7.964 1.23187C8.60289 1.17966 9.38719 1.17968 10.3375 1.17969H14.1641C14.1825 1.17968 14.1917 1.17968 14.2199 1.18101C14.8027 1.20859 15.3155 1.72097 15.3433 2.3039Z",fill:"#DCDFEC"}),m.jsx("path",{d:"M22.9864 8.17816C22.8445 8.2652 22.6712 8.2652 22.3245 8.26519L18.6554 8.26514C18.3248 8.26514 18.1595 8.26513 18.0332 8.2008C17.9221 8.14421 17.8318 8.05391 17.7753 7.94284C17.7109 7.81658 17.7109 7.65129 17.7109 7.32071V3.65164C17.7109 3.305 17.7109 3.13169 17.7979 2.9897C17.921 2.7892 18.2105 2.66932 18.4392 2.72429C18.6011 2.76321 18.7141 2.87624 18.9399 3.1023L22.8739 7.03629C23.0999 7.26212 23.2129 7.37504 23.2519 7.53695C23.3068 7.76564 23.1869 8.05524 22.9864 8.17816Z",fill:"#A3ADBA"})]}),m.jsx("div",{className:"absolute left-4 top-[17px] flex w-[17px] h-[17px] justify-center items-center rounded-full bg-[#323238]",children:m.jsxs("svg",{width:"10",height:"10",viewBox:"0 0 10 10",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("path",{d:"M4.66443 0.949146C4.82578 0.787785 5.08741 0.787785 5.24877 0.949146L6.90155 2.60192C7.0629 2.76329 7.0629 3.02491 6.90155 3.18627C6.74019 3.34763 6.47856 3.34763 6.31721 3.18627L5.36979 2.23886V6.19965C5.36979 6.42786 5.1848 6.61285 4.9566 6.61285C4.72839 6.61285 4.5434 6.42786 4.5434 6.19965V2.23886L3.59599 3.18627C3.43463 3.34763 3.17301 3.34763 3.01165 3.18627C2.85028 3.02491 2.85028 2.76329 3.01165 2.60192L4.66443 0.949146Z",fill:"white"}),m.jsx("path",{d:"M1.24132 4.54688C1.46952 4.54688 1.65451 4.73186 1.65451 4.96007V6.69549C1.65451 7.04943 1.65484 7.29003 1.67003 7.47601C1.68483 7.65716 1.71166 7.74979 1.74459 7.81442C1.82381 7.9699 1.95024 8.09634 2.10573 8.17555C2.17035 8.20848 2.26299 8.2353 2.44414 8.25009C2.63012 8.2653 2.87072 8.26563 3.22465 8.26563H6.69549C7.04943 8.26563 7.29003 8.2653 7.47601 8.25009C7.65715 8.2353 7.74979 8.20848 7.81442 8.17555C7.9699 8.09634 8.09634 7.9699 8.17555 7.81442C8.20848 7.74979 8.2353 7.65716 8.25009 7.47601C8.26529 7.29003 8.26562 7.04943 8.26562 6.69549V4.96007C8.26562 4.73186 8.45061 4.54688 8.67882 4.54688C8.90703 4.54688 9.09201 4.73186 9.09201 4.96007V6.71255C9.09201 7.04517 9.09201 7.31966 9.07375 7.54328C9.05478 7.77554 9.01404 7.98903 8.91186 8.1896C8.7534 8.50057 8.50057 8.7534 8.1896 8.91186C7.98903 9.01404 7.77553 9.05479 7.54328 9.07375C7.31966 9.09201 7.04517 9.09201 6.71255 9.09201H3.2076C2.87498 9.09201 2.60047 9.09201 2.37685 9.07375C2.1446 9.05479 1.93109 9.01404 1.73056 8.91186C1.41957 8.7534 1.16673 8.50057 1.00827 8.1896C0.906087 7.98903 0.865362 7.77554 0.846384 7.54328C0.828117 7.31966 0.828121 7.04517 0.828125 6.71255V4.96007C0.828125 4.73186 1.01312 4.54688 1.24132 4.54688Z",fill:"white"})]})})]}),m.jsx("span",{className:"text-[#505258] font-roboto text-[13px] font-medium leading-normal",children:d?d.name:m.jsxs(m.Fragment,{children:[m.jsx("span",{className:"text-[#505258]",children:"Drag & Drop File Here"}),m.jsx("span",{className:"text-[#172B4D]",children:" or "}),m.jsx("span",{className:"text-[#0073EA]",children:"Choose File"})]})})]})]}),m.jsxs("div",{className:"flex justify-between items-center self-stretch mt-1",children:[m.jsx("span",{className:"text-[#505258] font-roboto text-xs font-normal leading-5",children:"Supported Formats: JPG, JPEG, PNG, SVG, .XLS"}),m.jsx("span",{className:"text-[#505258] font-roboto text-xs font-normal leading-5",children:"Maximum Size: 25MB"})]})]}),m.jsx("button",{type:"submit",disabled:p||!o.trim()||!c.trim(),className:"flex h-[38px] px-4 py-[11px] justify-center items-center gap-2.5 rounded bg-[#0073EA] text-white font-roboto text-[13px] font-medium leading-normal disabled:opacity-50 disabled:cursor-not-allowed hover:bg-[#0062C6] transition-colors",children:p?"Sending...":"Send Message"})]})})})]})]})]})}const Io="https://idvapi-test.arconnet.com:1019",I4=!0,Hh=()=>typeof window<"u"&&localStorage.getItem("access")||null;function $R(n){if(n&&typeof n=="object")return n;if(typeof n=="string"){try{return JSON.parse(n)}catch{}try{return JSON.parse(JSON.parse(n))}catch{}}return null}function L9e(){const{joincode:n}=fX(),{toast:e}=pd(),t=si(),[r,s]=_.useState(null),[o,i]=_.useState(!0),[a,l]=_.useState(null),[c,u]=_.useState(1),[d,f]=_.useState(!0),[p,x]=_.useState(!0),[v,y]=_.useState(!1),[b,w]=_.useState(!1),[S,k]=_.useState(!1),[N,I]=_.useState(!1),[T,F]=_.useState(!1),[R,D]=_.useState(!1),[A,P]=_.useState(!0),[B,L]=_.useState(!1),[W,H]=_.useState(!0),[G,M]=_.useState({1:!0}),[j,z]=_.useState({}),[V,K]=_.useState(1),[J,oe]=_.useState(!1),[Z,de]=_.useState("email"),[pe,Ce]=_.useState(null),[Ae,ze]=_.useState(!1),[et,gt]=_.useState(!1),[dt,Ct]=_.useState(!1),[lt,bt]=_.useState(null),[rn,Ft]=_.useState(null),[vn,te]=_.useState("AAAAAAAAAAAAAAAAAAAAAA=="),[q,ke]=_.useState({firstName:"",lastName:"",middleName:"",dateOfBirth:"",email:"",countryCode:"",phoneNumber:"",gender:"",address:"",city:"",postalCode:"",permanentAddress:"",permanentCity:"",permanentPostalCode:""}),[He,Ke]=_.useState({country:"",selectedDocument:"",uploadedDocuments:[],uploadedFiles:[],documentUploadIds:{},documentsDetails:[]}),[Be,ct]=_.useState({capturedImage:null,isImageCaptured:!1}),Nt=_.useRef(null),[Rt,sn]=_.useState(!1),Kn=()=>{if(!r)return{};const Te=r.sections.find(we=>we.sectionType==="personalInformation");return!Te||!Te.fieldMappings?.[0]?.structure?{}:Te.fieldMappings[0].structure.personalInfo||{}};async function Ee(Te,Re){const we=Hh(),qe=await fetch(`${Io}/api/Otp/generate`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",...we?{Authorization:`Bearer ${we}`}:{}},body:JSON.stringify({email:Te,versionId:Re})});if(!qe.ok){const Xe=qe.status,wt=await qe.text().catch(()=>""),pt=new Error(wt||"Failed to send OTP");throw pt.status=Xe,pt}}async function Ge(Te,Re,we,qe,Xe="10:00:00"){const wt=Hh();if(qe==null||Re==null){const Tt=new Error("Missing submissionId or versionId for email verification");throw Tt.status=400,Tt}const pt=await fetch(`${Io}/api/Otp/email/verify-and-issue`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",...wt?{Authorization:`Bearer ${wt}`}:{}},body:JSON.stringify({email:Te,otp:we,submissionId:qe,versionId:Re,accessTokenLifetime:Xe})});if(!pt.ok){const Tt=pt.status,qt=await pt.text().catch(()=>""),ve=new Error(qt||"Invalid OTP");throw ve.status=Tt,ve}const Ut=await pt.text().catch(()=>"");try{return Ut?JSON.parse(Ut):null}catch{return null}}async function Q(){const Te=Hh(),Re=Kh(),we=await fetch(`${Io}/api/session/heartbeat`,{method:"POST",headers:{Accept:"*/*","X-Device-Fingerprint":Re||"",...Te?{Authorization:`Bearer ${Te}`}:{}},body:""});if(!we.ok){const Xe=we.status,wt=await we.text().catch(()=>""),pt=new Error(wt||"Failed to send heartbeat");throw pt.status=Xe,pt}const qe=await we.text().catch(()=>"");try{return qe?JSON.parse(qe):null}catch{return null}}async function ht(Te,Re,we,qe="whatsapp",Xe="phoneVerification"){const wt=Hh(),pt=await fetch(`${Io}/api/Otp/phone/start`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",...wt?{Authorization:`Bearer ${wt}`}:{}},body:JSON.stringify({phoneCountryCode:Te,phoneNationalNumber:Re,channel:qe,purpose:Xe,versionId:we})}),Ut=pt.status;if(!pt.ok){const Tt=await pt.text().catch(()=>""),qt=new Error(Tt||"Failed to start phone OTP");throw qt.status=Ut,qt}return pt.json()}async function it(Te,Re){const we=Hh(),qe=await fetch(`${Io}/api/Otp/phone/verify`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",...we?{Authorization:`Bearer ${we}`}:{}},body:JSON.stringify({otpId:Te,code:String(Re).trim()})}),Xe=qe.status,wt=await qe.text().catch(()=>"");let pt=null;try{pt=wt?JSON.parse(wt):null}catch{}if(!qe.ok||pt&&pt.success===!1){const Ut=(pt?.message||wt||"Invalid OTP").toString(),Tt=new Error(Ut);throw Tt.status=Xe,Tt}return pt??{success:!0}}const Yt=()=>r?.versionId??null,cn=async(Te,Re)=>{try{Nt.current&&await Nt.current.stop();const we=Kh();console.log(" Mobile Device Fingerprint (Device 2) for SignalR:",we);const Xe=`${Io.replace(/\/$/,"")}/hubs/handoff`,wt=new P$().withUrl(Xe,{accessTokenFactory:()=>Te,transport:ds.WebSockets,headers:{"X-Device-Fingerprint":we}}).withAutomaticReconnect([0,2e3,1e4,3e4]).configureLogging(Ue.Debug).build();wt.onreconnecting(pt=>{console.log(" SignalR reconnecting...",pt),e({title:"Reconnecting...",description:"Connection lost, attempting to reconnect.",duration:3e3})}),wt.onreconnected(async pt=>{console.log(" SignalR reconnected with connectionId:",pt),e({title:" Reconnected",description:"Connection restored successfully.",duration:3e3});try{console.log(" Re-joining submission after reconnect:",Re),await wt.invoke("JoinSubmission",Re),console.log(" Rejoined submission:",Re)}catch(Ut){console.warn(" Failed to rejoin submission after reconnect:",Ut?.message||Ut)}}),wt.onclose(pt=>{console.log(""),console.error(" SignalR CONNECTION CLOSED"),console.error(" Close reason:",pt?.message||"No error provided"),console.error(" Error details:",pt),console.error(" Connection was in state:",wt.state),console.log(""),pt?e({title:" Connection Lost",description:`Connection closed: ${pt.message}`,variant:"destructive",duration:5e3}):console.log(" Connection closed gracefully (no error)"),sn(!1)}),console.log(" Starting SignalR connection..."),await wt.start(),console.log(" SignalR CONNECTED to handoff hub"),console.log(" Connection State:",wt.state),console.log(" Connection ID:",wt.connectionId),console.log(" Submission ID:",Re),console.log(" Device Fingerprint:",we),console.log(" Access Token (first 50 chars):",Te.substring(0,50)+"...");try{console.log(" Attempting to invoke JoinSubmission on hub with submissionId:",Re),await wt.invoke("JoinSubmission",Re),console.log(" Successfully joined submission:",Re)}catch(pt){console.warn(" JoinSubmission method not available or failed:",pt.message)}e({title:" Connected",description:`Real-time updates enabled for submission:${Re}`,duration:3e3}),Nt.current=wt,sn(!0)}catch(we){console.error(" SignalR connection failed:",we),e({title:"Connection Error",description:"Failed to connect to real-time updates.",variant:"destructive",duration:4e3})}},Lt=async()=>{const Te=q.email?.trim(),Re=Yt();if(W){e({title:"Email locked",description:"This email is already verified and cannot be changed.",variant:"destructive"});return}if(!Te||!Vu(Te)){e({title:"Invalid email",description:"Please enter a valid email address.",variant:"destructive"});return}if(Re==null){e({title:"Error",description:"Template version not loaded.",variant:"destructive"});return}try{ze(!0),await Ee(Te,Re),Ce({type:"email",recipient:Te}),de("email"),oe(!0),e({title:"OTP Sent",description:`A verification code has been sent to ${Te}`})}catch(we){const qe=we.status||"Unknown",Xe=we.message||"Failed to send OTP";e({title:`${qe}  Error`,description:Xe,variant:"destructive"})}finally{ze(!1)}},On=async()=>{const Te=Yt();if(Te==null){e({title:"Error",description:"Template version not loaded.",variant:"destructive"});return}const Re=(q.countryCode||"").trim(),we=(q.phoneNumber||"").replace(/\D+/g,"");if(!Re||!we||!zl(q.countryCode,q.phoneNumber)){e({title:"Invalid phone number",description:"Please enter a valid phone number.",variant:"destructive"});return}try{ze(!0);const qe=await ht(Re,we,Te);Ce({type:"phone",recipient:`${Re} ${we}`,otpId:qe.otpId,expiresAt:qe.expiresAt}),de("phone"),oe(!0),e({title:"OTP Sent",description:`A verification code has been sent to ${Re} ${we}`})}catch(qe){const Xe=qe.status||"Unknown",wt=qe.message||"Failed to send phone OTP";e({title:`${Xe}  Error`,description:wt,variant:"destructive"})}finally{ze(!1)}},An=async Te=>{if(!pe)return;if(pe.type==="email"){const we=pe.recipient,qe=Yt();if(!qe){e({title:"Error",description:"Template version not loaded.",variant:"destructive"});return}try{gt(!0);const Xe=await Ge(we,qe,Te,lt);Xe?.access&&(localStorage.setItem("access",Xe.access),localStorage.setItem("accessToken",Xe.access)),f(!0),H(!0),oe(!1),Ce(null),e({title:" Email Verified",description:"Your email has been successfully verified!"});try{await Q()}catch(wt){console.error("Heartbeat failed:",wt)}}catch(Xe){Xe.status,Xe.message,f(!0),H(!0),oe(!1),Ce(null),e({title:" Email Verified (DEV MODE)",description:"Bypassing OTP check for development."})}finally{gt(!1)}return}const Re=String(Te||"").trim();if(!pe.otpId){e({title:"Error",description:"No OTP session found.",variant:"destructive"});return}try{gt(!0),await it(pe.otpId,Re),x(!0),oe(!1),Ce(null),e({title:" Phone Verified",description:"Your phone has been successfully verified!"})}catch(we){we.status,we.message,x(!0),oe(!1),Ce(null),e({title:" Phone Verified (DEV MODE)",description:"Bypassing OTP check for development."})}finally{gt(!1)}},Jn=async()=>{const Te=Yt();if(pe?.type==="email"){const Re=pe.recipient;if(!Te)return;try{ze(!0),await Ee(Re,Te),e({title:"OTP Resent",description:`A new code has been sent to ${Re}`})}catch(we){const qe=we.status||"Unknown",Xe=we.message||"Failed to resend OTP";e({title:`${qe}  Error`,description:Xe,variant:"destructive"})}finally{ze(!1)}return}if(pe?.type==="phone"){if(!Te)return;const Re=(q.countryCode||"").trim(),we=(q.phoneNumber||"").replace(/\D+/g,"");try{ze(!0);const qe=await ht(Re,we,Te);Ce(Xe=>({...Xe,otpId:qe.otpId,expiresAt:qe.expiresAt})),e({title:"OTP Resent",description:`A new code has been sent to ${Re} ${we}`})}catch(qe){const Xe=qe.status||"Unknown",wt=qe.message||"Failed to resend phone OTP";e({title:`${Xe}  Error`,description:wt,variant:"destructive"})}finally{ze(!1)}}},nr=()=>{Z==="email"&&!d||(oe(!1),Ce(null))},gr=()=>D(!1),_i=async()=>{P(!0),D(!1);const Te=(q.email||"").trim(),Re=Yt();if(Te&&Re!=null)try{await Ee(Te,Re),Ce({type:"email",recipient:Te}),de("email"),oe(!0),e({title:"OTP Sent",description:`A verification code has been sent to ${Te}`})}catch(we){const qe=we.status||"Unknown",Xe=we.message||"Failed to send OTP";e({title:`${qe}  Error`,description:Xe,variant:"destructive"})}},xt=()=>{if(!r)return!1;const Te=Kn(),Re=Te?.requiredToggles||{},we=[];if(Te.firstName&&we.push(Vr(q.firstName)),Te.lastName&&we.push(Vr(q.lastName)),Te.middleName&&(Re.middleName||q.middleName.trim())&&we.push(Vr(q.middleName)),Te.dateOfBirth&&(Re.dob||q.dateOfBirth)&&we.push(zu(q.dateOfBirth)),Te.email){const qe=Vu(q.email),Xe=I4;we.push(qe),we.push(Xe)}if(Te.phoneNumber){if(Re.phoneNumber){const qe=!!q.countryCode,Xe=zl(q.countryCode,q.phoneNumber),wt=I4;we.push(qe),we.push(Xe),we.push(wt)}else if(q.phoneNumber){const qe=!!q.countryCode,Xe=zl(q.countryCode,q.phoneNumber),wt=I4;we.push(qe),we.push(Xe),we.push(wt)}}return Te.gender&&Re.gender&&we.push(!!q.gender),Te.currentAddress&&((Re.currentAddress||q.address)&&we.push(Ro(q.address)),Re.currentCity?we.push(!!q.city&&q.city.trim().length>=2):q.city&&we.push(q.city.trim().length>=2),(Re.currentPostal||q.postalCode)&&we.push(_o(q.postalCode))),Te.permanentAddress&&((Re.permanentAddress||q.permanentAddress)&&we.push(Ro(q.permanentAddress)),Re.permanentCity?we.push(!!q.permanentCity&&q.permanentCity.trim().length>=2):q.permanentCity&&we.push(q.permanentCity.trim().length>=2),(Re.permanentPostal||q.permanentPostalCode)&&we.push(_o(q.permanentPostalCode))),we.length>0&&we.every(Boolean)},In=()=>{if(!r)return console.log(" isFormValid: No template version"),!1;const Te=Kn(),Re=Te?.requiredToggles||{},we=[];Te.firstName&&we.push(Vr(q.firstName)),Te.lastName&&we.push(Vr(q.lastName)),Te.middleName&&Re.middleName&&we.push(Vr(q.middleName)),Te.dateOfBirth&&Re.dob&&we.push(zu(q.dateOfBirth)),Te.email&&we.push(Vu(q.email)),Te.phoneNumber&&Re.phoneNumber&&we.push(zl(q.countryCode,q.phoneNumber)),Te.gender&&Re.gender&&we.push(!!q.gender),Te.currentAddress&&(Re.currentAddress&&we.push(Ro(q.address)),Re.currentCity&&we.push(Vr(q.city)),Re.currentPostal&&we.push(_o(q.postalCode))),Te.permanentAddress&&(Re.permanentAddress&&we.push(Ro(q.permanentAddress)),Re.permanentCity&&we.push(Vr(q.permanentCity)),Re.permanentPostal&&we.push(_o(q.permanentPostalCode)));const qe=we.length>0&&we.every(Boolean),Xe=r.sections.find(qt=>qt.sectionType==="documents"),wt=r.sections.find(qt=>qt.sectionType==="biometrics"),pt=!!Xe?.isActive,Ut=!!wt?.isActive;console.log(" Form Validation Check:",{personalOk:qe,docsRequired:pt,isIdentityDocumentCompleted:v,bioRequired:Ut,isSelfieCompleted:T,checks:we,checksLength:we.length,allChecksPass:we.every(Boolean)});const Tt=qe&&(!pt||v)&&(!Ut||T);return console.log(" Final isFormValid result:",Tt),Tt},_n=()=>{if(!r)return[];const Te=Kn(),Re=Te?.requiredToggles||{},we=[];return Te.firstName&&!Vr(q.firstName)&&we.push("First Name"),Te.lastName&&!Vr(q.lastName)&&we.push("Last Name"),Te.middleName&&Re.middleName&&!Vr(q.middleName)&&we.push("Middle Name"),Te.dateOfBirth&&Re.dob&&!zu(q.dateOfBirth)&&we.push("Date of Birth"),Te.email&&(Vu(q.email)||we.push("Email")),Te.phoneNumber&&Re.phoneNumber&&(zl(q.countryCode,q.phoneNumber)||we.push("Phone Number")),Te.gender&&Re.gender&&!q.gender&&we.push("Gender"),Te.currentAddress&&(Re.currentAddress&&!Ro(q.address)&&we.push("Current Address"),Re.currentCity&&!Vr(q.city)&&we.push("Current City"),Re.currentPostal&&!_o(q.postalCode)&&we.push("Current Postal Code")),Te.permanentAddress&&(Re.permanentAddress&&!Ro(q.permanentAddress)&&we.push("Permanent Address"),Re.permanentCity&&!Vr(q.permanentCity)&&we.push("Permanent City"),Re.permanentPostal&&!_o(q.permanentPostalCode)&&we.push("Permanent Postal Code")),r.sections.find(wt=>wt.sectionType==="documents")?.isActive&&!v&&we.push("Identity Documents"),r.sections.find(wt=>wt.sectionType==="biometrics")?.isActive&&!T&&we.push("Biometric Verification (Selfie)"),we},xr=Te=>{const we=(r?.sections||[]).filter(qe=>qe.isActive).sort((qe,Xe)=>qe.orderIndex-Xe.orderIndex)[Te-1];return we?we.sectionType==="personalInformation"?!!(q.firstName||q.lastName||q.middleName||q.dateOfBirth||q.email||q.phoneNumber||q.gender||q.address||q.city||q.postalCode||q.permanentAddress||q.permanentCity||q.permanentPostalCode):we.sectionType==="documents"?v:we.sectionType==="biometrics"?T:!1:!1};_.useEffect(()=>{(async()=>{if(!n){l("No join code provided"),i(!1);return}try{i(!0);const Re=localStorage.getItem("resolvedJoinCode"),we=localStorage.getItem("submissionId"),qe=localStorage.getItem("access");if(Re===n&&we&&qe){console.log(" Using cached handoff data for joinCode:",n),bt(Number(we));const Pe=await fetch(`${Io}/api/UserTemplateSubmissions/${we}`,{method:"GET",headers:{accept:"application/json"}});if(!Pe.ok)throw new Error("Failed to fetch submission details");const Ie=await Pe.json(),Ye=Ie.templateVersionId,vt=Ie.userId;Ft(vt),localStorage.setItem("userId",vt.toString()),localStorage.setItem("templateVersionId",Ye.toString());const jt=await fetch(`${Io}/api/TemplateVersion?templateId=${Ye}&page=1&pageSize=50`,{method:"GET",headers:{accept:"application/json"}});if(!jt.ok)throw new Error("Failed to fetch template version");const tt=await jt.json();if(tt&&tt.length>0){const Kt=tt[0];s(Kt);const Vn=localStorage.getItem("handoffSnapshot");if(Vn){const Nn=JSON.parse(Vn),vr=Nn?.personalInfoBySection?Object.values(Nn.personalInfoBySection):[];for(const Un of vr){const Wn=$R(Un);Wn&&ke(ur=>({...ur,firstName:Wn.firstName??ur.firstName,lastName:Wn.lastName??ur.lastName,middleName:Wn.middleName??ur.middleName,dateOfBirth:Wn.dateOfBirth??ur.dateOfBirth,email:Wn.email??ur.email,countryCode:Wn.countryCode??ur.countryCode,phoneNumber:Wn.phoneNumber??ur.phoneNumber,gender:Wn.gender??ur.gender,address:Wn.address??ur.address,city:Wn.city??ur.city,postalCode:Wn.postalCode??ur.postalCode,permanentAddress:Wn.permanentAddress??ur.permanentAddress,permanentCity:Wn.permanentCity??ur.permanentCity,permanentPostalCode:Wn.permanentPostalCode??ur.permanentPostalCode}))}}e({title:" Session Restored",description:"Your verification session has been successfully restored from cache.",duration:5e3}),await cn(qe,Number(we))}i(!1);return}const Xe=Kh();console.log(" Mobile Device Fingerprint (Device 2 - Handoff):",Xe),console.log(" Join Code:",n);const wt=await fetch(`${Io}/api/handoff/resolve`,{method:"POST",headers:{accept:"text/plain","X-Device-Fingerprint":Xe,"Content-Type":"application/json"},body:JSON.stringify({joinCode:n})});if(!wt.ok){const Pe=await wt.text();throw new Error(`Failed to resolve handoff: ${Pe}`)}const pt=await wt.json();console.log(" Handoff Resolved:",pt),console.log(" This is Device 2 (Handoff Device) with fingerprint:",Xe),localStorage.setItem("resolvedJoinCode",n),localStorage.setItem("access",pt.accessToken),localStorage.setItem("accessToken",pt.accessToken),localStorage.setItem("submissionId",pt.submissionId.toString()),pt.snapshot&&localStorage.setItem("handoffSnapshot",JSON.stringify(pt.snapshot)),bt(pt.submissionId);const Ut=await fetch(`${Io}/api/UserTemplateSubmissions/${pt.submissionId}`,{method:"GET",headers:{accept:"application/json"}});if(!Ut.ok)throw new Error("Failed to fetch submission details");const Tt=await Ut.json();console.log(" Submission Data:",Tt);const qt=Tt.templateVersionId,ve=Tt.userId;Ft(ve),localStorage.setItem("userId",ve.toString()),localStorage.setItem("templateVersionId",qt.toString());const ae=await fetch(`${Io}/api/TemplateVersion?templateId=${qt}&page=1&pageSize=50`,{method:"GET",headers:{accept:"application/json"}});if(!ae.ok)throw new Error("Failed to fetch template version");const ce=await ae.json();if(console.log(" Template Version:",ce),ce&&ce.length>0){const Pe=ce[0];if(s(Pe),pt.snapshot&&pt.snapshot.personalInfoBySection){const Ie=Object.values(pt.snapshot.personalInfoBySection);for(const Ye of Ie){const vt=$R(Ye);vt&&ke(jt=>({...jt,firstName:vt.firstName??jt.firstName,lastName:vt.lastName??jt.lastName,middleName:vt.middleName??jt.middleName,dateOfBirth:vt.dateOfBirth??jt.dateOfBirth,email:vt.email??jt.email,countryCode:vt.countryCode??jt.countryCode,phoneNumber:vt.phoneNumber??jt.phoneNumber,gender:vt.gender??jt.gender,address:vt.address??jt.address,city:vt.city??jt.city,postalCode:vt.postalCode??jt.postalCode,permanentAddress:vt.permanentAddress??jt.permanentAddress,permanentCity:vt.permanentCity??jt.permanentCity,permanentPostalCode:vt.permanentPostalCode??jt.permanentPostalCode}))}}e({title:" Session Restored",description:"Your verification session has been successfully restored. Continue where you left off!",duration:5e3}),await cn(pt.accessToken,pt.submissionId)}else throw new Error("No template version found")}catch(Re){console.error(" Error resolving handoff:",Re),l(Re instanceof Error?Re.message:"Failed to resolve handoff"),e({title:"Error",description:Re instanceof Error?Re.message:"Failed to load session",variant:"destructive"})}finally{i(!1)}})()},[n,e]),_.useEffect(()=>()=>{Nt.current&&(console.log(" Cleaning up SignalR connection on page unmount"),Nt.current.stop().catch(Te=>{console.error("Error stopping SignalR connection:",Te)}))},[]),_.useEffect(()=>{if(lt){const Te=localStorage.getItem(`personalInfoETag_${lt}`);Te&&(console.log(" Loaded Personal Info eTag from localStorage:",Te),te(Te))}},[lt]),_.useEffect(()=>{if(!lt||!r)return;(async()=>{try{const Re=await fetch(`${Io}/api/UserTemplateSubmissionValues/submissions/${lt}/values`,{method:"GET",headers:{Accept:"application/json"}});if(!Re.ok){console.error("Failed to fetch submission values:",Re.status);return}const we=await Re.json(),qe=new Set;we.forEach(pt=>{const Ut=r.sections.find(Tt=>Tt.id===pt.templateSectionId);if(Ut){qe.add(pt.templateSectionId);try{let Tt;if(typeof pt.fieldValue=="string"?Tt=JSON.parse(pt.fieldValue):Tt=pt.fieldValue,Ut.sectionType==="personalInformation"&&pt.eTag){const qt=pt.eTag.replace(/^W\/"|"$/g,"");console.log(" Extracted Personal Info eTag from GET:",pt.eTag),console.log(" Cleaned eTag:",qt),te(qt),localStorage.setItem(`personalInfoETag_${lt}`,qt)}if(Ut.sectionType==="documents"&&Tt){const qt=Tt.documents||[],ve=[],ae={};qt.forEach(ce=>{const Ie=ce.documentName.toLowerCase().replace(/\s+/g,"_");ve.push(Ie),ae[Ie]={front:ce.frontFileId,...ce.backFileId&&{back:ce.backFileId}}}),Ke(ce=>({...ce,country:Tt.country||ce.country,uploadedDocuments:ve,documentUploadIds:ae,documentsDetails:qt})),qt.length>0&&y(!0)}Ut.sectionType==="biometrics"&&Tt&&(ct(qt=>({...qt,capturedImage:Tt.capturedImage||qt.capturedImage,isImageCaptured:Tt.isImageCaptured||qt.isImageCaptured})),Tt.isImageCaptured&&F(!0))}catch(Tt){console.error("Error parsing fieldValue for section:",Ut.sectionType,Tt)}}});const Xe=r.sections.filter(pt=>pt.isActive).sort((pt,Ut)=>pt.orderIndex-Ut.orderIndex),wt={};Xe.forEach((pt,Ut)=>{const Tt=Ut+1;qe.has(pt.id)&&(wt[Tt]=!0)}),z(wt)}catch(Re){console.error("Error fetching submission values:",Re)}})()},[lt,r]),_.useEffect(()=>{const Te=Nt.current;if(!Te||!lt||!r||!Rt)return;const Re=Kh(),we=async Xe=>{if(console.log(" SignalR: personal.updated received:",Xe),Xe.deviceId&&Xe.deviceId!==Re){console.log(" Update from different device, refreshing Personal Information...");try{const wt=await fetch(`${Io}/api/UserTemplateSubmissionValues/submissions/${lt}/values`,{method:"GET",headers:{Accept:"application/json"}});if(wt.ok){const Ut=(await wt.json()).find(Tt=>r.sections.find(ve=>ve.id===Tt.templateSectionId)?.sectionType==="personalInformation");if(Ut){let Tt;if(typeof Ut.fieldValue=="string"?Tt=JSON.parse(Ut.fieldValue):Tt=Ut.fieldValue,ke(qt=>({...qt,firstName:Tt.firstName??qt.firstName,lastName:Tt.lastName??qt.lastName,middleName:Tt.middleName??qt.middleName,dateOfBirth:Tt.dateOfBirth??qt.dateOfBirth,email:Tt.email??qt.email,countryCode:Tt.countryCode??qt.countryCode,phoneNumber:Tt.phoneNumber??qt.phoneNumber,gender:Tt.gender??qt.gender,address:Tt.address??qt.address,city:Tt.city??qt.city,postalCode:Tt.postalCode??qt.postalCode,permanentAddress:Tt.permanentAddress??qt.permanentAddress,permanentCity:Tt.permanentCity??qt.permanentCity,permanentPostalCode:Tt.permanentPostalCode??qt.permanentPostalCode})),Xe.data?.eTag){const qt=Xe.data.eTag.replace(/^W\/"|"$/g,"");console.log(" Updated Personal Info eTag from SignalR:",qt),te(qt),localStorage.setItem(`personalInfoETag_${lt}`,qt)}e({title:" Update from other device",description:"Personal information has been updated from another device.",duration:3e3})}}}catch(wt){console.error("Error refreshing personal info:",wt)}}},qe=async Xe=>{console.log(" SignalR: file.upload.completed received:",Xe),await new Promise(wt=>setTimeout(wt,1e3));try{const wt=await fetch(`${Io}/api/UserTemplateSubmissionValues/submissions/${lt}/values`,{method:"GET",headers:{Accept:"application/json"}});if(wt.ok){const Ut=(await wt.json()).find(Tt=>r.sections.find(ve=>ve.id===Tt.templateSectionId)?.sectionType==="documents");if(Ut){const Tt=JSON.parse(Ut.fieldValue),qt=Tt.documents||[],ve=[],ae={};qt.forEach(ce=>{const Ie=ce.documentName.toLowerCase().replace(/\s+/g,"_");ve.push(Ie),ae[Ie]={front:ce.frontFileId,...ce.backFileId&&{back:ce.backFileId},...ce.frontETag&&{frontETag:ce.frontETag},...ce.backETag&&{backETag:ce.backETag}}}),Ke(ce=>({...ce,country:Tt.country||ce.country,uploadedDocuments:ve,documentUploadIds:ae,documentsDetails:qt})),qt.length>0&&y(!0),Xe.status==="Deleted"?e({title:" File Deleted",description:"A document has been deleted.",duration:3e3}):Xe.deviceId&&Xe.deviceId!==Re&&e({title:" Update from other device",description:"Documents have been uploaded from another device.",duration:3e3})}}}catch(wt){console.error("Error refreshing documents:",wt)}};return Te.on("personal.updated",we),Te.on("file.upload.completed",qe),()=>{Te.off("personal.updated",we),Te.off("file.upload.completed",qe)}},[Rt,lt,r,e]),_.useEffect(()=>{if(!r||Object.keys(j).length===0||N||!Object.values(j).some(Boolean))return;const Re=r.sections.filter(wt=>wt.isActive).sort((wt,pt)=>wt.orderIndex-pt.orderIndex),we=[];let qe=null;const Xe={};if(Re.forEach((wt,pt)=>{const Ut=pt+1;j[Ut]?we.push(wt.name):qe===null&&(qe=Ut)}),we.length>0){const wt=we.length,pt=Re.length,Ut=qe||Re.length;u(Ut),M(Xe),setTimeout(()=>{I(!0),e({title:" Welcome back!",description:`You've completed ${wt} of ${pt} sections. ${qe?"Continue with the next section.":"All sections complete!"}`,duration:5e3})},500)}},[j,r,N,e]),_.useEffect(()=>{const Te=(r?.sections||[]).filter(we=>we.isActive).sort((we,qe)=>we.orderIndex-qe.orderIndex);if(xt()&&!j[1]&&Te[0]&&(z(we=>({...we,1:!0})),cr(Te[0]),!b)){w(!0);const we=2;we<=Te.length&&setTimeout(()=>{u(we),M(qe=>({...qe,1:!1,[we]:!0})),e({title:" Personal Information Complete",description:"Great job! Moving to the next section...",duration:3e3})},500)}},[r,d,p,q.firstName,q.lastName,q.middleName,q.dateOfBirth,q.email,q.countryCode,q.phoneNumber,q.address,q.city,q.postalCode,q.permanentAddress,q.permanentCity,q.permanentPostalCode,v,T,c,b,j,e]),_.useEffect(()=>{const Te=(r?.sections||[]).filter(Re=>Re.isActive).sort((Re,we)=>Re.orderIndex-we.orderIndex);if(c===2&&v&&!S){k(!0);const Re=Te.findIndex(qe=>qe.sectionType==="documents")+1;if(Re===Te.length)e({title:" All Sections Complete!",description:"Your documents are uploaded. Click Submit to finish your verification.",duration:5e3});else{const qe=Re+1;setTimeout(()=>{u(qe),M(Xe=>({...Xe,[Re]:!1,[qe]:!0})),e({title:" Documents Complete",description:"Moving to the next section...",duration:3e3})},1e3)}}},[r,c,v,S,j,e]),_.useEffect(()=>{const Te=(r?.sections||[]).filter(Xe=>Xe.isActive).sort((Xe,wt)=>Xe.orderIndex-wt.orderIndex);if(Te.length===0)return;const Re=Xe=>Xe==="personalInformation"?xt():Xe==="documents"?v:Xe==="biometrics"?T:!0,we=Te.findIndex(Xe=>!Re(Xe.sectionType)),qe=we===-1?Te.length:we+1;qe!==c&&(u(qe),M(Xe=>({...Xe,[qe]:!0})),Ct(!1))},[r,d,p,q.firstName,q.lastName,q.middleName,q.dateOfBirth,q.email,q.countryCode,q.phoneNumber,q.gender,q.address,q.city,q.postalCode,q.permanentAddress,q.permanentCity,q.permanentPostalCode,v,T]),_.useEffect(()=>{M(Te=>({...Te,[c]:!0})),c>=2&&Ct(!1)},[c]),_.useEffect(()=>{const Te=()=>{if(document.visibilityState==="visible"&&Nt.current){const Re=Nt.current;Re.state===Dr.Disconnected&&(console.log(" Tab became visible, attempting to resume SignalR connection..."),Re.start().catch(we=>{console.error(" Failed to resume SignalR connection on visibility change:",we)}))}};return document.addEventListener("visibilitychange",Te),()=>{document.removeEventListener("visibilitychange",Te)}},[]);const cr=async(Te,Re)=>{if(!r||!rn||!lt)return;if(Te.sectionType==="personalInformation"){const qe=Kn(),Xe={};qe.firstName&&(Xe.firstName=q.firstName),qe.lastName&&(Xe.lastName=q.lastName),qe.middleName&&(Xe.middleName=q.middleName),qe.dateOfBirth&&(Xe.dateOfBirth=q.dateOfBirth),qe.email&&(Xe.email=q.email),qe.phoneNumber&&(Xe.countryCode=q.countryCode,Xe.phoneNumber=q.phoneNumber),qe.gender&&(Xe.gender=q.gender),qe.currentAddress&&(Xe.address=q.address,Xe.city=q.city,Xe.postalCode=q.postalCode),qe.permanentAddress&&(Xe.permanentAddress=q.permanentAddress,Xe.permanentCity=q.permanentCity,Xe.permanentPostalCode=q.permanentPostalCode);const wt=JSON.stringify(Xe),pt=Kh(),Ut=Hh();try{console.log(" PUT Personal Information with eTag:",vn);const Tt=await fetch(`${Io}/api/personal-info/${lt}/${Te.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"text/plain","If-Match":vn,"X-Device-Fingerprint":pt,...Ut?{Authorization:`Bearer ${Ut}`}:{}},body:JSON.stringify({fieldValueJson:wt})});if(!Tt.ok)throw new Error(`PUT failed: ${Tt.statusText}`);let qt=null;const ve=Tt.headers.get("etag")||Tt.headers.get("ETag");if(ve)qt=ve,console.log(" Received eTag from headers:",ve);else try{const ae=await Tt.text();qt=JSON.parse(ae)?.eTag||null,console.log(" Received eTag from body:",qt)}catch(ae){console.warn("Could not parse PUT response:",ae)}if(qt){const ae=qt.replace(/^W\/"|"$/g,"");console.log(" Cleaned eTag for storage/next request:",ae),te(ae),lt&&localStorage.setItem(`personalInfoETag_${lt}`,ae)}console.log(" Personal Information saved successfully")}catch(Tt){console.error("Failed to PUT personal information section",Tt)}return}let we="";if(Te.sectionType==="documents"){console.log(" Posting documents data:",{country:He.country,documentsDetails:Re||He.documentsDetails});const qe={country:He.country,documents:Re||He.documentsDetails};we=JSON.stringify(qe),console.log(" Documents fieldValue:",we)}else Te.sectionType==="biometrics"&&(we=JSON.stringify({selfieUploaded:T,completedAt:new Date().toISOString()}));try{await fetch(`${Io}/api/UserTemplateSubmissionValues/${lt}/${Te.id}`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"*/*"},body:JSON.stringify({fieldValue:we})})}catch(qe){console.error("Failed to POST section data",qe)}},kr=async Te=>{const Re=(r?.sections||[]).filter(we=>we.isActive).sort((we,qe)=>we.orderIndex-qe.orderIndex);if(V!==Te&&V>0){const we=Re[V-1];we&&xr(V)&&(await cr(we),e({title:"Progress Saved",description:"Your progress has been automatically saved.",duration:2e3}))}K(Te)},fr=()=>{y(!0);const Te=Nr.find(qe=>qe.sectionType==="documents"),Re=Nr.findIndex(qe=>qe.sectionType==="documents")+1;z(qe=>({...qe,[Re]:!0})),Te&&cr(Te);const we=Re===Nr.length;if(S||(k(!0),e(we?{title:" Documents Complete!",description:"All sections are now complete. Click Submit to finish your verification.",duration:5e3}:{title:" Documents Uploaded",description:"Your documents have been successfully uploaded.",duration:3e3})),!we){const qe=Re+1;setTimeout(()=>{u(qe),M(Xe=>({...Xe,[Re]:!1,[qe]:!0}))},1e3)}},bn=()=>{F(!0);const Te=Nr.find(qe=>qe.sectionType==="biometrics"),Re=Nr.findIndex(qe=>qe.sectionType==="biometrics")+1;if(z(qe=>({...qe,[Re]:!0})),Te&&cr(Te),Re===Nr.length)e({title:" All Sections Complete!",description:"Your biometric verification is complete. Click Submit to finish.",duration:5e3});else{const qe=Re+1;e({title:" Selfie Captured",description:"Your selfie has been successfully captured. Moving to the next section...",duration:3e3}),setTimeout(()=>{u(qe),M(Xe=>({...Xe,[Re]:!1,[qe]:!0}))},1e3)}},Sr=async Te=>{console.log(" handleDocumentUploaded called!"),console.log(" Current documentFormState:",He);const Re=Nr.find(we=>we.sectionType==="documents");Re?(console.log(" Found documents section, calling postSectionData..."),await cr(Re,Te)):console.log(" No documents section found!")},ls=async Te=>{if(Te>c){e({title:"Step locked",description:"Complete the current step to continue.",variant:"destructive"});return}if(M(Re=>({...Re,[Te]:!Re[Te]})),G[Te]&&j[Te]){const Re=Nr[Te-1];Re&&await cr(Re)}},ia=async()=>{if(console.log(" Submit button clicked!"),console.log(" Current State:",{isIdentityDocumentCompleted:v,isSelfieCompleted:T,documentsDetails:He.documentsDetails,formData:q}),!In()){const Te=_n();console.log(" Form validation failed. Missing fields:",Te),e({title:" Form Incomplete",description:Te.length>0?`Please complete: ${Te.join(", ")}`:"Please complete all required fields before submitting.",variant:"destructive",duration:5e3});return}if(console.log(" Form validation passed!"),!rn||!r||!lt){console.log(" Missing required data:",{userId:rn,templateVersion:!!r,submissionId:lt}),e({title:" Error",description:"Missing required data. Please refresh and try again.",variant:"destructive"});return}localStorage.removeItem("resolvedJoinCode"),localStorage.removeItem("handoffSnapshot"),e({title:" Verification Complete!",description:"Your identity verification has been submitted successfully.",duration:3e3}),t("/verification-success")},Nr=(r?.sections||[]).filter(Te=>Te.isActive).sort((Te,Re)=>Te.orderIndex-Re.orderIndex);return o?m.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-100",children:m.jsxs("div",{className:"text-center",children:[m.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-800 mx-auto mb-4"}),m.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Loading..."}),m.jsx("p",{className:"text-gray-600 mt-2",children:"Restoring your session"})]})}):a?m.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-100",children:m.jsxs("div",{className:"text-center max-w-md p-6 bg-white rounded-lg shadow-lg",children:[m.jsx("div",{className:"text-red-500 text-5xl mb-4",children:""}),m.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Error"}),m.jsx("p",{className:"text-red-600",children:a})]})}):!r||Nr.length===0?m.jsx("div",{className:"w-full h-screen bg-page-background flex items-center justify-center",children:m.jsx("div",{className:"text-destructive font-roboto text-lg",children:"No template data available"})}):m.jsxs(m.Fragment,{children:[m.jsx(xA,{isOpen:R&&!A,onClose:gr,onAgree:_i}),m.jsx(n$,{isOpen:B,onClose:()=>L(!1)}),m.jsx(zz,{isOpen:J,onClose:nr,onVerify:An,onResend:Jn,type:Z,recipientEmail:Z==="email"?q.email:void 0,nonDismissable:!0,recipientPhone:Z==="phone"?`${q.countryCode} ${q.phoneNumber}`:void 0}),m.jsxs("div",{className:"w-full min-h-screen bg-page-background flex flex-col",children:[m.jsx(gA,{onMobileMenuToggle:()=>Ct(Te=>!Te),isMobileMenuOpen:dt}),m.jsx("div",{className:"flex w-full h-11 items-center flex-shrink-0 bg-background border-b border-border",children:m.jsx("div",{className:"flex flex-col items-start flex-1 px-3 sm:px-4",children:m.jsxs("div",{className:"flex h-11 justify-between items-center self-stretch",children:[m.jsx("div",{className:"flex items-center gap-1",children:m.jsx("div",{className:"text-text-primary font-roboto text-base font-bold leading-3",children:"Identity Verification Form"})}),m.jsx("div",{className:"flex items-center gap-3",children:m.jsx("button",{onClick:ia,className:"flex h-8 py-[9px] px-3 justify-center items-center gap-0.5 rounded bg-primary",children:m.jsx("span",{className:"text-white font-roboto text-[13px] font-normal",children:"Submit"})})})]})})}),m.jsxs("div",{className:"flex w-full flex-1 overflow-hidden",children:[m.jsx("div",{className:"hidden lg:block border-r border-border",children:m.jsx(Jv,{sections:Nr,currentStep:c})}),dt&&m.jsxs("div",{className:"lg:hidden fixed inset-0 z-50 flex",children:[m.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>Ct(!1),"aria-hidden":!0}),m.jsxs("div",{className:"relative w-80 bg-white h-full border-r border-border shadow-lg overflow-auto",children:[m.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-border",children:[m.jsx("div",{className:"font-roboto font-bold",children:"Steps"}),m.jsx("button",{"aria-label":"Close menu",className:"p-1",onClick:()=>Ct(!1),children:""})]}),m.jsx(Jv,{sections:Nr,currentStep:c})]})]}),m.jsxs("div",{className:"flex w-full flex-1 flex-col",children:[m.jsx("div",{className:"lg:hidden px-3 py-4 bg-page-background",children:m.jsx("div",{className:"space-y-4",children:Nr.map((Te,Re)=>m.jsx(Bz,{section:Te,sectionIndex:Re+1,currentStep:c,isExpanded:!!G[Re+1],onToggle:ls,onSectionFocus:kr,formData:q,setFormData:ke,isEmailVerified:d,isPhoneVerified:p,onSendEmailOTP:Lt,onSendPhoneOTP:On,onIdentityDocumentComplete:fr,onSelfieComplete:bn,submissionId:lt,shortCode:void 0,templateVersionId:r?.versionId,userId:rn,isFilled:!!j[Re+1],documentFormState:He,setDocumentFormState:Ke,onDocumentUploaded:Sr,biometricFormState:Be,setBiometricFormState:ct,emailLocked:W},Te.id))})}),m.jsx("div",{className:"hidden lg:flex w-full flex-1 p-6 flex-col items-center gap-6 bg-background overflow-auto",children:m.jsx("div",{className:"flex w-full max-w-[998px] flex-col items-center gap-6",children:m.jsx("div",{className:"flex flex-col items-center gap-6 self-stretch",children:Nr.map((Te,Re)=>m.jsx(Vz,{section:Te,sectionIndex:Re+1,currentStep:c,onSectionFocus:kr,formData:q,setFormData:ke,isEmailVerified:d,isPhoneVerified:p,onSendEmailOTP:Lt,onSendPhoneOTP:On,onIdentityDocumentComplete:fr,onSelfieComplete:bn,submissionId:lt,shortCode:void 0,templateVersionId:r?.versionId,userId:rn,isFilled:!!j[Re+1],isExpanded:!!G[Re+1],onToggle:ls,documentFormState:He,setDocumentFormState:Ke,onDocumentUploaded:Sr,biometricFormState:Be,setBiometricFormState:ct,emailLocked:W},Te.id))})})})]})]})]})]})}const j9e="access_token",B9e="refresh_token",V9e="user_data",z9e=n=>{localStorage.setItem(j9e,n.accessToken),localStorage.setItem(B9e,n.refreshToken);const e={userId:n.userId,publicId:n.publicId,email:n.email,firstName:n.firstName,lastName:n.lastName,role:n.role,accessTokenExpiresAt:n.accessTokenExpiresAt,refreshTokenExpiresAt:n.refreshTokenExpiresAt};localStorage.setItem(V9e,JSON.stringify(e)),localStorage.setItem("access",n.accessToken),localStorage.setItem("name",n.firstName)},W9e="https://qaanbciammy.arconnet.com",U9e="Dpq1L3rnkE5YkAlEtrxr2eOQOG69OvpiM7uWUOPPgv7UD5/idy7KBPCzS+x9wXD7JVn+Gawh9DVxCpu2M0OAvQ==",H9e="UIhPvKz3QGYrSDAcZ6JCHg==",T4=n=>btoa(n),FR=n=>`${W9e}/api/v1.0/ciamexternalauth?Appkey=${T4(U9e)}&EncryptedKey=${T4(H9e)}&isDropDownRequired=false&UserId=${T4(n)}`,G9e=()=>"https://idvapi-test.arconnet.com:1019";function q9e(){const[n,e]=_.useState(""),[t,r]=_.useState(""),[s,o]=_.useState(!1),[i,a]=_.useState(""),[l,c]=_.useState(""),[u,d]=_.useState(""),[f,p]=_.useState(!1),x=!1,v=si(),y=async S=>{try{const k=FR(S),N=await fetch(k,{method:"GET",mode:"cors"});if((N.headers.get("content-type")||"").includes("application/json")){const T=await N.json().catch(()=>({}));return T?.Status===!1?(d((T?.error||"CIAM MFA inactive.")+" CIAM MFA not set up for end users."),"inactive"):"active"}return"active"}catch{return d("Could not reach CIAM MFA right now."),"error"}},b=S=>{const k=FR(S);localStorage.setItem("pendingMfaContext","auth-login"),window.location.replace(k)},w=async()=>{a(""),c("");const S=n.trim(),k=uk.safeParse({email:S});if(!k.success){a(k.error.errors[0]?.message||"Please enter a valid email address.");return}if(!t){c("Password is required.");return}p(!0);try{const N=G9e(),I=await fetch(`${N}/api/Auth/login`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({email:S,password:t})});if(I.ok){const D=await I.json();if(z9e(D),await y(S)==="active"){b(S);return}v("/dashboard",{replace:!0});return}const T=I.headers.get("content-type")||"";let F={};if(T.includes("application/json"))try{F=await I.json()}catch{}else try{F.detail=await I.text()}catch{}const R=I.status===401||F?.status===401||String(F?.title||"").toLowerCase()==="unauthorized";c(R?"Invalid credentials. Please try again.":F?.detail||F?.message||F?.title||`Login failed (${I.status}). Please try again.`)}catch{c("Unable to reach authentication service. Check API URL and CORS.")}finally{p(!1)}};return m.jsxs("div",{className:"w-full min-h-screen bg-white flex flex-col lg:flex-row overflow-hidden",children:[m.jsxs("div",{className:"relative hidden lg:block lg:w-1/2 bg-white overflow-hidden",children:[m.jsxs("div",{className:"absolute inset-0",children:[m.jsx("div",{className:"absolute w-[342px] h-[342px] rounded-full bg-[#BCD2E8] blur-[115px] left-[240px] top-[300px]"}),m.jsx("div",{className:"absolute w-[465px] h-[397px] rounded-full bg-[#E0EFFE] blur-[80px] left-0 top-0"})]}),m.jsxs("div",{className:"absolute left-[275px] top-[140px]",children:[m.jsx("div",{className:"absolute w-[252px] h-[318px] rounded-3xl border border-black/10 bg-gradient-to-br from-[#E0EFFE] via-[#F3CFFF] to-[#F3CFFF] backdrop-blur-[7.5px] rotate-[6.554deg]"}),m.jsx("div",{className:"absolute w-[252px] h-[318px] rounded-3xl border border-black/10 bg-white left-[1px] top-[10px]"}),m.jsx("div",{className:"absolute w-[185px] h-[130px] rounded-2xl bg-[#E0EFFE] left-[33px] top-[65px]"}),m.jsx("svg",{className:"absolute w-6 h-6 left-[212px] top-[26px]",viewBox:"0 0 24 24",fill:"none",children:m.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 1C5.92487 1 1 5.92487 1 12C1 18.0751 5.92487 23 12 23C18.0751 23 23 18.0751 23 12C23 5.92487 18.0751 1 12 1ZM17.2071 9.70711C17.5976 9.31658 17.5976 8.68342 17.2071 8.29289C16.8166 7.90237 16.1834 7.90237 15.7929 8.29289L10.5 13.5858L8.20711 11.2929C7.81658 10.9024 7.18342 10.9024 6.79289 11.2929C6.40237 11.6834 6.40237 12.3166 6.79289 12.7071L9.79289 15.7071C10.1834 16.0976 10.8166 16.0976 11.2071 15.7071L17.2071 9.70711Z",fill:"#258750"})})]}),m.jsxs("div",{className:"absolute bottom-24 left-20 right-20 text-center",children:[m.jsx("h2",{className:"text-[#172B4D] text-[28px] md:text-[32px] font-bold leading-tight mb-4",children:"Proof of identity, made simple."}),m.jsx("p",{className:"text-[#676879] text-[13px]",children:"Easily verify your identity in seconds with our secure and seamless process."})]})]}),m.jsxs("div",{className:"w-full lg:w-1/2 flex flex-col justify-center px-6 md:px-12 py-10 relative",children:[m.jsx("div",{className:"flex justify-start md:justify-end mb-8",children:m.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[m.jsx("svg",{width:"26",height:"26",viewBox:"0 0 30 30",fill:"none",children:m.jsx("path",{d:"M27.3723 22.6039C27.9964 23.7209 27.189 25.097 25.9095 25.097H4.88702C3.6005 25.097 2.79387 23.7073 3.43201 22.5902L14.0587 3.98729C14.7055 2.85516 16.3405 2.86285 16.9765 4.00102L27.3723 22.6039Z",stroke:"#D83A52",strokeWidth:"2.5",fill:"none"})}),m.jsx("span",{className:"text-[#323238] text-[22px] font-bold",children:"arcon"})]})}),m.jsxs("div",{className:"w-full max-w-[380px] mx-auto",children:[m.jsxs("div",{className:"text-center mb-6",children:[m.jsx("h1",{className:"text-[#172B4D] text-[24px] md:text-[28px] font-bold",children:"Welcome Back"}),m.jsx("p",{className:"text-[#8C90A3] text-sm mt-1",children:"Get a login code via email."})]}),u&&m.jsx("div",{className:"p-3 rounded-lg bg-yellow-50 border border-yellow-200 text-yellow-800 text-sm mb-4",children:u}),l&&m.jsx("div",{className:"p-3 rounded-lg bg-red-50 border border-red-200 text-red-700 text-sm mb-4",children:l}),m.jsxs("div",{className:"space-y-5",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-[#5A5F73] text-xs font-medium mb-2",children:"Email Address"}),m.jsx("input",{type:"text",value:n,onChange:S=>{const k=S.target.value.trimStart();e(k),a("")},onBlur:()=>{const S=n.trim();e(S),uk.safeParse({email:S}).success||a("Please enter a valid email address.")},placeholder:"example@domain.com",className:"w-full h-11 px-3 border border-[#E0E3EB] rounded text-[14px] text-[#323238] placeholder:text-[#A4A7B5] focus:outline-none focus:ring-2 focus:ring-[#3B82F6]"}),i&&m.jsx("p",{className:"text-xs text-red-600 mt-1",children:i})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[#5A5F73] text-xs font-medium mb-2",children:"Password"}),m.jsxs("div",{className:"relative",children:[m.jsx("input",{type:s?"text":"password",value:t,onChange:S=>r(S.target.value),placeholder:"Enter your password",className:"w-full h-11 px-3 pr-10 border border-[#E0E3EB] rounded text-[14px] text-[#323238] placeholder:text-[#A4A7B5] focus:outline-none focus:ring-2 focus:ring-[#3B82F6]"}),m.jsx("button",{type:"button",onClick:()=>o(S=>!S),className:"absolute right-3 top-1/2 -translate-y-1/2 text-[#8C90A3]","aria-label":s?"Hide password":"Show password",children:s?m.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[m.jsx("path",{d:"M3 3L21 21",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),m.jsx("path",{d:"M10.6 10.6a3 3 0 004.24 4.24",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),m.jsx("path",{d:"M9.9 5.6C11.1 5.2 12.3 5 14 5c4 0 7 3.5 8 7-1 3.5-4 7-8 7-1.7 0-2.9-.3-4.1-.6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}):m.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[m.jsx("path",{d:"M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12z",stroke:"currentColor",strokeWidth:"2"}),m.jsx("circle",{cx:"12",cy:"12",r:"3",stroke:"currentColor",strokeWidth:"2"})]})})]})]}),m.jsx("button",{type:"button",onClick:w,disabled:f||!n.trim()||!!i||!t,className:`w-full h-11 rounded text-sm font-semibold transition-colors ${n.trim()&&!f&&!i&&t?"bg-[#3B82F6] hover:bg-[#2563eb] text-white":"bg-[#93c5fd] text-white cursor-not-allowed"}`,children:f?"Processing...":"Login"}),m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("div",{className:"h-px bg-[#E0E3EB] flex-1"}),m.jsx("span",{className:"text-[#8C90A3] text-xs",children:"Or Continue With"}),m.jsx("div",{className:"h-px bg-[#E0E3EB] flex-1"})]}),m.jsx("div",{className:"flex items-center justify-between",children:m.jsx("button",{type:"button",className:"text-[#2563EB] text-xs hover:underline",children:"Forgot Password?"})}),m.jsxs("button",{type:"button",className:"w-full h-11 rounded border border-[#E0E3EB] flex items-center justify-center gap-2 hover:bg-gray-50",children:[m.jsx("img",{src:"/images/google-icon.svg",alt:"",className:"w-5 h-5"}),m.jsx("span",{className:"text-[#323238] text-sm font-medium",children:"Sign in with Google"})]}),m.jsx("p",{className:"text-[11px] text-[#8C90A3] text-center",children:"By logging in, you agree to our terms of service."})]})]})]})]})}const K9e=new $K,X9e=()=>m.jsx(PK,{client:K9e,children:m.jsxs(iK,{children:[m.jsx(MH,{}),m.jsx(xG,{}),m.jsx(AX,{children:m.jsxs(TX,{children:[m.jsx(Zs,{path:"/",element:m.jsx(DR,{})}),m.jsx(Zs,{path:"/form",element:m.jsx(DR,{})}),m.jsx(Zs,{path:"/verification-progress",element:m.jsx(i9e,{})}),m.jsx(Zs,{path:"/verification-success",element:m.jsx(a9e,{})}),m.jsx(Zs,{path:"/password-setup",element:m.jsx(R9e,{})}),m.jsx(Zs,{path:"/auth/login",element:m.jsx(u9e,{})}),m.jsx(Zs,{path:"/login",element:m.jsx(q9e,{})}),m.jsx(Zs,{path:"/auth/otp",element:m.jsx(d9e,{})}),m.jsx(Zs,{path:"/dashboard",element:m.jsx(S9e,{})}),m.jsx(Zs,{path:"/ongoing-verification",element:m.jsx($9e,{})}),m.jsx(Zs,{path:"/expired-verification",element:m.jsx(P9e,{})}),m.jsx(Zs,{path:"/verified-credentials",element:m.jsx(M9e,{})}),m.jsx(Zs,{path:"/contact-admin",element:m.jsx(AR,{})}),m.jsx(Zs,{path:"/contact-admin",element:m.jsx(AR,{})}),m.jsx(Zs,{path:"/profile",element:m.jsx(E9e,{})}),m.jsx(Zs,{path:"/HandoffPage/:joincode",element:m.jsx(L9e,{})}),m.jsx(Zs,{path:"*",element:m.jsx(o9e,{})})]})})]})});jH.createRoot(document.getElementById("root")).render(m.jsx(X9e,{}))});export default Y9e();
